(function(){const b=document.createElement("link").relList;if(b&&b.supports&&b.supports("modulepreload"))return;for(const C of document.querySelectorAll('link[rel="modulepreload"]'))P(C);new MutationObserver(C=>{for(const O of C)if(O.type==="childList")for(const R of O.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&P(R)}).observe(document,{childList:!0,subtree:!0});function k(C){const O={};return C.integrity&&(O.integrity=C.integrity),C.referrerPolicy&&(O.referrerPolicy=C.referrerPolicy),C.crossOrigin==="use-credentials"?O.credentials="include":C.crossOrigin==="anonymous"?O.credentials="omit":O.credentials="same-origin",O}function P(C){if(C.ep)return;C.ep=!0;const O=k(C);fetch(C.href,O)}})();function Uf(S){return S&&S.__esModule&&Object.prototype.hasOwnProperty.call(S,"default")?S.default:S}var Cp={exports:{}},Cf={},Pp={exports:{}},Kn={};var Tm;function My(){if(Tm)return Kn;Tm=1;var S=Symbol.for("react.element"),b=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),P=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),O=Symbol.for("react.provider"),R=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),K=Symbol.for("react.suspense"),ne=Symbol.for("react.memo"),ee=Symbol.for("react.lazy"),B=Symbol.iterator;function q(Le){return Le===null||typeof Le!="object"?null:(Le=B&&Le[B]||Le["@@iterator"],typeof Le=="function"?Le:null)}var ue={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ce=Object.assign,de={};function Pe(Le,rt,an){this.props=Le,this.context=rt,this.refs=de,this.updater=an||ue}Pe.prototype.isReactComponent={},Pe.prototype.setState=function(Le,rt){if(typeof Le!="object"&&typeof Le!="function"&&Le!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Le,rt,"setState")},Pe.prototype.forceUpdate=function(Le){this.updater.enqueueForceUpdate(this,Le,"forceUpdate")};function je(){}je.prototype=Pe.prototype;function Te(Le,rt,an){this.props=Le,this.context=rt,this.refs=de,this.updater=an||ue}var qe=Te.prototype=new je;qe.constructor=Te,ce(qe,Pe.prototype),qe.isPureReactComponent=!0;var tt=Array.isArray,nt=Object.prototype.hasOwnProperty,it={current:null},Ge={key:!0,ref:!0,__self:!0,__source:!0};function ht(Le,rt,an){var Pt,yn={},zn=null,Rn=null;if(rt!=null)for(Pt in rt.ref!==void 0&&(Rn=rt.ref),rt.key!==void 0&&(zn=""+rt.key),rt)nt.call(rt,Pt)&&!Ge.hasOwnProperty(Pt)&&(yn[Pt]=rt[Pt]);var Re=arguments.length-2;if(Re===1)yn.children=an;else if(1<Re){for(var ei=Array(Re),Cn=0;Cn<Re;Cn++)ei[Cn]=arguments[Cn+2];yn.children=ei}if(Le&&Le.defaultProps)for(Pt in Re=Le.defaultProps,Re)yn[Pt]===void 0&&(yn[Pt]=Re[Pt]);return{$$typeof:S,type:Le,key:zn,ref:Rn,props:yn,_owner:it.current}}function mt(Le,rt){return{$$typeof:S,type:Le.type,key:rt,ref:Le.ref,props:Le.props,_owner:Le._owner}}function Kt(Le){return typeof Le=="object"&&Le!==null&&Le.$$typeof===S}function St(Le){var rt={"=":"=0",":":"=2"};return"$"+Le.replace(/[=:]/g,function(an){return rt[an]})}var Ht=/\/+/g;function Vt(Le,rt){return typeof Le=="object"&&Le!==null&&Le.key!=null?St(""+Le.key):rt.toString(36)}function ct(Le,rt,an,Pt,yn){var zn=typeof Le;(zn==="undefined"||zn==="boolean")&&(Le=null);var Rn=!1;if(Le===null)Rn=!0;else switch(zn){case"string":case"number":Rn=!0;break;case"object":switch(Le.$$typeof){case S:case b:Rn=!0}}if(Rn)return Rn=Le,yn=yn(Rn),Le=Pt===""?"."+Vt(Rn,0):Pt,tt(yn)?(an="",Le!=null&&(an=Le.replace(Ht,"$&/")+"/"),ct(yn,rt,an,"",function(Cn){return Cn})):yn!=null&&(Kt(yn)&&(yn=mt(yn,an+(!yn.key||Rn&&Rn.key===yn.key?"":(""+yn.key).replace(Ht,"$&/")+"/")+Le)),rt.push(yn)),1;if(Rn=0,Pt=Pt===""?".":Pt+":",tt(Le))for(var Re=0;Re<Le.length;Re++){zn=Le[Re];var ei=Pt+Vt(zn,Re);Rn+=ct(zn,rt,an,ei,yn)}else if(ei=q(Le),typeof ei=="function")for(Le=ei.call(Le),Re=0;!(zn=Le.next()).done;)zn=zn.value,ei=Pt+Vt(zn,Re++),Rn+=ct(zn,rt,an,ei,yn);else if(zn==="object")throw rt=String(Le),Error("Objects are not valid as a React child (found: "+(rt==="[object Object]"?"object with keys {"+Object.keys(Le).join(", ")+"}":rt)+"). If you meant to render a collection of children, use an array instead.");return Rn}function en(Le,rt,an){if(Le==null)return Le;var Pt=[],yn=0;return ct(Le,Pt,"","",function(zn){return rt.call(an,zn,yn++)}),Pt}function fn(Le){if(Le._status===-1){var rt=Le._result;rt=rt(),rt.then(function(an){(Le._status===0||Le._status===-1)&&(Le._status=1,Le._result=an)},function(an){(Le._status===0||Le._status===-1)&&(Le._status=2,Le._result=an)}),Le._status===-1&&(Le._status=0,Le._result=rt)}if(Le._status===1)return Le._result.default;throw Le._result}var rn={current:null},wt={transition:null},Ft={ReactCurrentDispatcher:rn,ReactCurrentBatchConfig:wt,ReactCurrentOwner:it};function et(){throw Error("act(...) is not supported in production builds of React.")}return Kn.Children={map:en,forEach:function(Le,rt,an){en(Le,function(){rt.apply(this,arguments)},an)},count:function(Le){var rt=0;return en(Le,function(){rt++}),rt},toArray:function(Le){return en(Le,function(rt){return rt})||[]},only:function(Le){if(!Kt(Le))throw Error("React.Children.only expected to receive a single React element child.");return Le}},Kn.Component=Pe,Kn.Fragment=k,Kn.Profiler=C,Kn.PureComponent=Te,Kn.StrictMode=P,Kn.Suspense=K,Kn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ft,Kn.act=et,Kn.cloneElement=function(Le,rt,an){if(Le==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Le+".");var Pt=ce({},Le.props),yn=Le.key,zn=Le.ref,Rn=Le._owner;if(rt!=null){if(rt.ref!==void 0&&(zn=rt.ref,Rn=it.current),rt.key!==void 0&&(yn=""+rt.key),Le.type&&Le.type.defaultProps)var Re=Le.type.defaultProps;for(ei in rt)nt.call(rt,ei)&&!Ge.hasOwnProperty(ei)&&(Pt[ei]=rt[ei]===void 0&&Re!==void 0?Re[ei]:rt[ei])}var ei=arguments.length-2;if(ei===1)Pt.children=an;else if(1<ei){Re=Array(ei);for(var Cn=0;Cn<ei;Cn++)Re[Cn]=arguments[Cn+2];Pt.children=Re}return{$$typeof:S,type:Le.type,key:yn,ref:zn,props:Pt,_owner:Rn}},Kn.createContext=function(Le){return Le={$$typeof:R,_currentValue:Le,_currentValue2:Le,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Le.Provider={$$typeof:O,_context:Le},Le.Consumer=Le},Kn.createElement=ht,Kn.createFactory=function(Le){var rt=ht.bind(null,Le);return rt.type=Le,rt},Kn.createRef=function(){return{current:null}},Kn.forwardRef=function(Le){return{$$typeof:h,render:Le}},Kn.isValidElement=Kt,Kn.lazy=function(Le){return{$$typeof:ee,_payload:{_status:-1,_result:Le},_init:fn}},Kn.memo=function(Le,rt){return{$$typeof:ne,type:Le,compare:rt===void 0?null:rt}},Kn.startTransition=function(Le){var rt=wt.transition;wt.transition={};try{Le()}finally{wt.transition=rt}},Kn.unstable_act=et,Kn.useCallback=function(Le,rt){return rn.current.useCallback(Le,rt)},Kn.useContext=function(Le){return rn.current.useContext(Le)},Kn.useDebugValue=function(){},Kn.useDeferredValue=function(Le){return rn.current.useDeferredValue(Le)},Kn.useEffect=function(Le,rt){return rn.current.useEffect(Le,rt)},Kn.useId=function(){return rn.current.useId()},Kn.useImperativeHandle=function(Le,rt,an){return rn.current.useImperativeHandle(Le,rt,an)},Kn.useInsertionEffect=function(Le,rt){return rn.current.useInsertionEffect(Le,rt)},Kn.useLayoutEffect=function(Le,rt){return rn.current.useLayoutEffect(Le,rt)},Kn.useMemo=function(Le,rt){return rn.current.useMemo(Le,rt)},Kn.useReducer=function(Le,rt,an){return rn.current.useReducer(Le,rt,an)},Kn.useRef=function(Le){return rn.current.useRef(Le)},Kn.useState=function(Le){return rn.current.useState(Le)},Kn.useSyncExternalStore=function(Le,rt,an){return rn.current.useSyncExternalStore(Le,rt,an)},Kn.useTransition=function(){return rn.current.useTransition()},Kn.version="18.3.1",Kn}var Cm;function Vf(){return Cm||(Cm=1,Pp.exports=My()),Pp.exports}var Pm;function Ay(){if(Pm)return Cf;Pm=1;var S=Vf(),b=Symbol.for("react.element"),k=Symbol.for("react.fragment"),P=Object.prototype.hasOwnProperty,C=S.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,O={key:!0,ref:!0,__self:!0,__source:!0};function R(h,K,ne){var ee,B={},q=null,ue=null;ne!==void 0&&(q=""+ne),K.key!==void 0&&(q=""+K.key),K.ref!==void 0&&(ue=K.ref);for(ee in K)P.call(K,ee)&&!O.hasOwnProperty(ee)&&(B[ee]=K[ee]);if(h&&h.defaultProps)for(ee in K=h.defaultProps,K)B[ee]===void 0&&(B[ee]=K[ee]);return{$$typeof:b,type:h,key:q,ref:ue,props:B,_owner:C.current}}return Cf.Fragment=k,Cf.jsx=R,Cf.jsxs=R,Cf}var Mm;function Ly(){return Mm||(Mm=1,Cp.exports=Ay()),Cp.exports}var Fe=Ly(),Ki=Vf();const Mg=Uf(Ki);var zd={},Mp={exports:{}},Ga={},Ap={exports:{}},Lp={};var Am;function Ry(){return Am||(Am=1,(function(S){function b(wt,Ft){var et=wt.length;wt.push(Ft);e:for(;0<et;){var Le=et-1>>>1,rt=wt[Le];if(0<C(rt,Ft))wt[Le]=Ft,wt[et]=rt,et=Le;else break e}}function k(wt){return wt.length===0?null:wt[0]}function P(wt){if(wt.length===0)return null;var Ft=wt[0],et=wt.pop();if(et!==Ft){wt[0]=et;e:for(var Le=0,rt=wt.length,an=rt>>>1;Le<an;){var Pt=2*(Le+1)-1,yn=wt[Pt],zn=Pt+1,Rn=wt[zn];if(0>C(yn,et))zn<rt&&0>C(Rn,yn)?(wt[Le]=Rn,wt[zn]=et,Le=zn):(wt[Le]=yn,wt[Pt]=et,Le=Pt);else if(zn<rt&&0>C(Rn,et))wt[Le]=Rn,wt[zn]=et,Le=zn;else break e}}return Ft}function C(wt,Ft){var et=wt.sortIndex-Ft.sortIndex;return et!==0?et:wt.id-Ft.id}if(typeof performance=="object"&&typeof performance.now=="function"){var O=performance;S.unstable_now=function(){return O.now()}}else{var R=Date,h=R.now();S.unstable_now=function(){return R.now()-h}}var K=[],ne=[],ee=1,B=null,q=3,ue=!1,ce=!1,de=!1,Pe=typeof setTimeout=="function"?setTimeout:null,je=typeof clearTimeout=="function"?clearTimeout:null,Te=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function qe(wt){for(var Ft=k(ne);Ft!==null;){if(Ft.callback===null)P(ne);else if(Ft.startTime<=wt)P(ne),Ft.sortIndex=Ft.expirationTime,b(K,Ft);else break;Ft=k(ne)}}function tt(wt){if(de=!1,qe(wt),!ce)if(k(K)!==null)ce=!0,fn(nt);else{var Ft=k(ne);Ft!==null&&rn(tt,Ft.startTime-wt)}}function nt(wt,Ft){ce=!1,de&&(de=!1,je(ht),ht=-1),ue=!0;var et=q;try{for(qe(Ft),B=k(K);B!==null&&(!(B.expirationTime>Ft)||wt&&!St());){var Le=B.callback;if(typeof Le=="function"){B.callback=null,q=B.priorityLevel;var rt=Le(B.expirationTime<=Ft);Ft=S.unstable_now(),typeof rt=="function"?B.callback=rt:B===k(K)&&P(K),qe(Ft)}else P(K);B=k(K)}if(B!==null)var an=!0;else{var Pt=k(ne);Pt!==null&&rn(tt,Pt.startTime-Ft),an=!1}return an}finally{B=null,q=et,ue=!1}}var it=!1,Ge=null,ht=-1,mt=5,Kt=-1;function St(){return!(S.unstable_now()-Kt<mt)}function Ht(){if(Ge!==null){var wt=S.unstable_now();Kt=wt;var Ft=!0;try{Ft=Ge(!0,wt)}finally{Ft?Vt():(it=!1,Ge=null)}}else it=!1}var Vt;if(typeof Te=="function")Vt=function(){Te(Ht)};else if(typeof MessageChannel<"u"){var ct=new MessageChannel,en=ct.port2;ct.port1.onmessage=Ht,Vt=function(){en.postMessage(null)}}else Vt=function(){Pe(Ht,0)};function fn(wt){Ge=wt,it||(it=!0,Vt())}function rn(wt,Ft){ht=Pe(function(){wt(S.unstable_now())},Ft)}S.unstable_IdlePriority=5,S.unstable_ImmediatePriority=1,S.unstable_LowPriority=4,S.unstable_NormalPriority=3,S.unstable_Profiling=null,S.unstable_UserBlockingPriority=2,S.unstable_cancelCallback=function(wt){wt.callback=null},S.unstable_continueExecution=function(){ce||ue||(ce=!0,fn(nt))},S.unstable_forceFrameRate=function(wt){0>wt||125<wt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):mt=0<wt?Math.floor(1e3/wt):5},S.unstable_getCurrentPriorityLevel=function(){return q},S.unstable_getFirstCallbackNode=function(){return k(K)},S.unstable_next=function(wt){switch(q){case 1:case 2:case 3:var Ft=3;break;default:Ft=q}var et=q;q=Ft;try{return wt()}finally{q=et}},S.unstable_pauseExecution=function(){},S.unstable_requestPaint=function(){},S.unstable_runWithPriority=function(wt,Ft){switch(wt){case 1:case 2:case 3:case 4:case 5:break;default:wt=3}var et=q;q=wt;try{return Ft()}finally{q=et}},S.unstable_scheduleCallback=function(wt,Ft,et){var Le=S.unstable_now();switch(typeof et=="object"&&et!==null?(et=et.delay,et=typeof et=="number"&&0<et?Le+et:Le):et=Le,wt){case 1:var rt=-1;break;case 2:rt=250;break;case 5:rt=1073741823;break;case 4:rt=1e4;break;default:rt=5e3}return rt=et+rt,wt={id:ee++,callback:Ft,priorityLevel:wt,startTime:et,expirationTime:rt,sortIndex:-1},et>Le?(wt.sortIndex=et,b(ne,wt),k(K)===null&&wt===k(ne)&&(de?(je(ht),ht=-1):de=!0,rn(tt,et-Le))):(wt.sortIndex=rt,b(K,wt),ce||ue||(ce=!0,fn(nt))),wt},S.unstable_shouldYield=St,S.unstable_wrapCallback=function(wt){var Ft=q;return function(){var et=q;q=Ft;try{return wt.apply(this,arguments)}finally{q=et}}}})(Lp)),Lp}var Lm;function Ny(){return Lm||(Lm=1,Ap.exports=Ry()),Ap.exports}var Rm;function Dy(){if(Rm)return Ga;Rm=1;var S=Vf(),b=Ny();function k(a){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+a,g=1;g<arguments.length;g++)l+="&args[]="+encodeURIComponent(arguments[g]);return"Minified React error #"+a+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var P=new Set,C={};function O(a,l){R(a,l),R(a+"Capture",l)}function R(a,l){for(C[a]=l,a=0;a<l.length;a++)P.add(l[a])}var h=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),K=Object.prototype.hasOwnProperty,ne=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ee={},B={};function q(a){return K.call(B,a)?!0:K.call(ee,a)?!1:ne.test(a)?B[a]=!0:(ee[a]=!0,!1)}function ue(a,l,g,E){if(g!==null&&g.type===0)return!1;switch(typeof l){case"function":case"symbol":return!0;case"boolean":return E?!1:g!==null?!g.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function ce(a,l,g,E){if(l===null||typeof l>"u"||ue(a,l,g,E))return!0;if(E)return!1;if(g!==null)switch(g.type){case 3:return!l;case 4:return l===!1;case 5:return isNaN(l);case 6:return isNaN(l)||1>l}return!1}function de(a,l,g,E,N,j,te){this.acceptsBooleans=l===2||l===3||l===4,this.attributeName=E,this.attributeNamespace=N,this.mustUseProperty=g,this.propertyName=a,this.type=l,this.sanitizeURL=j,this.removeEmptyString=te}var Pe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){Pe[a]=new de(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var l=a[0];Pe[l]=new de(l,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){Pe[a]=new de(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){Pe[a]=new de(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){Pe[a]=new de(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){Pe[a]=new de(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){Pe[a]=new de(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){Pe[a]=new de(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){Pe[a]=new de(a,5,!1,a.toLowerCase(),null,!1,!1)});var je=/[\-:]([a-z])/g;function Te(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var l=a.replace(je,Te);Pe[l]=new de(l,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var l=a.replace(je,Te);Pe[l]=new de(l,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var l=a.replace(je,Te);Pe[l]=new de(l,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){Pe[a]=new de(a,1,!1,a.toLowerCase(),null,!1,!1)}),Pe.xlinkHref=new de("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){Pe[a]=new de(a,1,!1,a.toLowerCase(),null,!0,!0)});function qe(a,l,g,E){var N=Pe.hasOwnProperty(l)?Pe[l]:null;(N!==null?N.type!==0:E||!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(ce(l,g,N,E)&&(g=null),E||N===null?q(l)&&(g===null?a.removeAttribute(l):a.setAttribute(l,""+g)):N.mustUseProperty?a[N.propertyName]=g===null?N.type===3?!1:"":g:(l=N.attributeName,E=N.attributeNamespace,g===null?a.removeAttribute(l):(N=N.type,g=N===3||N===4&&g===!0?"":""+g,E?a.setAttributeNS(E,l,g):a.setAttribute(l,g))))}var tt=S.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,nt=Symbol.for("react.element"),it=Symbol.for("react.portal"),Ge=Symbol.for("react.fragment"),ht=Symbol.for("react.strict_mode"),mt=Symbol.for("react.profiler"),Kt=Symbol.for("react.provider"),St=Symbol.for("react.context"),Ht=Symbol.for("react.forward_ref"),Vt=Symbol.for("react.suspense"),ct=Symbol.for("react.suspense_list"),en=Symbol.for("react.memo"),fn=Symbol.for("react.lazy"),rn=Symbol.for("react.offscreen"),wt=Symbol.iterator;function Ft(a){return a===null||typeof a!="object"?null:(a=wt&&a[wt]||a["@@iterator"],typeof a=="function"?a:null)}var et=Object.assign,Le;function rt(a){if(Le===void 0)try{throw Error()}catch(g){var l=g.stack.trim().match(/\n( *(at )?)/);Le=l&&l[1]||""}return`
`+Le+a}var an=!1;function Pt(a,l){if(!a||an)return"";an=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(l)if(l=function(){throw Error()},Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(Ke){var E=Ke}Reflect.construct(a,[],l)}else{try{l.call()}catch(Ke){E=Ke}a.call(l.prototype)}else{try{throw Error()}catch(Ke){E=Ke}a()}}catch(Ke){if(Ke&&E&&typeof Ke.stack=="string"){for(var N=Ke.stack.split(`
`),j=E.stack.split(`
`),te=N.length-1,xe=j.length-1;1<=te&&0<=xe&&N[te]!==j[xe];)xe--;for(;1<=te&&0<=xe;te--,xe--)if(N[te]!==j[xe]){if(te!==1||xe!==1)do if(te--,xe--,0>xe||N[te]!==j[xe]){var Ce=`
`+N[te].replace(" at new "," at ");return a.displayName&&Ce.includes("<anonymous>")&&(Ce=Ce.replace("<anonymous>",a.displayName)),Ce}while(1<=te&&0<=xe);break}}}finally{an=!1,Error.prepareStackTrace=g}return(a=a?a.displayName||a.name:"")?rt(a):""}function yn(a){switch(a.tag){case 5:return rt(a.type);case 16:return rt("Lazy");case 13:return rt("Suspense");case 19:return rt("SuspenseList");case 0:case 2:case 15:return a=Pt(a.type,!1),a;case 11:return a=Pt(a.type.render,!1),a;case 1:return a=Pt(a.type,!0),a;default:return""}}function zn(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case Ge:return"Fragment";case it:return"Portal";case mt:return"Profiler";case ht:return"StrictMode";case Vt:return"Suspense";case ct:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case St:return(a.displayName||"Context")+".Consumer";case Kt:return(a._context.displayName||"Context")+".Provider";case Ht:var l=a.render;return a=a.displayName,a||(a=l.displayName||l.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case en:return l=a.displayName||null,l!==null?l:zn(a.type)||"Memo";case fn:l=a._payload,a=a._init;try{return zn(a(l))}catch{}}return null}function Rn(a){var l=a.type;switch(a.tag){case 24:return"Cache";case 9:return(l.displayName||"Context")+".Consumer";case 10:return(l._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=l.render,a=a.displayName||a.name||"",l.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return l;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return zn(l);case 8:return l===ht?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l}return null}function Re(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function ei(a){var l=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function Cn(a){var l=ei(a)?"checked":"value",g=Object.getOwnPropertyDescriptor(a.constructor.prototype,l),E=""+a[l];if(!a.hasOwnProperty(l)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var N=g.get,j=g.set;return Object.defineProperty(a,l,{configurable:!0,get:function(){return N.call(this)},set:function(te){E=""+te,j.call(this,te)}}),Object.defineProperty(a,l,{enumerable:g.enumerable}),{getValue:function(){return E},setValue:function(te){E=""+te},stopTracking:function(){a._valueTracker=null,delete a[l]}}}}function Wt(a){a._valueTracker||(a._valueTracker=Cn(a))}function we(a){if(!a)return!1;var l=a._valueTracker;if(!l)return!0;var g=l.getValue(),E="";return a&&(E=ei(a)?a.checked?"true":"false":a.value),a=E,a!==g?(l.setValue(a),!0):!1}function Gi(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function Ur(a,l){var g=l.checked;return et({},l,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:g??a._wrapperState.initialChecked})}function Rr(a,l){var g=l.defaultValue==null?"":l.defaultValue,E=l.checked!=null?l.checked:l.defaultChecked;g=Re(l.value!=null?l.value:g),a._wrapperState={initialChecked:E,initialValue:g,controlled:l.type==="checkbox"||l.type==="radio"?l.checked!=null:l.value!=null}}function We(a,l){l=l.checked,l!=null&&qe(a,"checked",l,!1)}function ds(a,l){We(a,l);var g=Re(l.value),E=l.type;if(g!=null)E==="number"?(g===0&&a.value===""||a.value!=g)&&(a.value=""+g):a.value!==""+g&&(a.value=""+g);else if(E==="submit"||E==="reset"){a.removeAttribute("value");return}l.hasOwnProperty("value")?ot(a,l.type,g):l.hasOwnProperty("defaultValue")&&ot(a,l.type,Re(l.defaultValue)),l.checked==null&&l.defaultChecked!=null&&(a.defaultChecked=!!l.defaultChecked)}function To(a,l,g){if(l.hasOwnProperty("value")||l.hasOwnProperty("defaultValue")){var E=l.type;if(!(E!=="submit"&&E!=="reset"||l.value!==void 0&&l.value!==null))return;l=""+a._wrapperState.initialValue,g||l===a.value||(a.value=l),a.defaultValue=l}g=a.name,g!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,g!==""&&(a.name=g)}function ot(a,l,g){(l!=="number"||Gi(a.ownerDocument)!==a)&&(g==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+g&&(a.defaultValue=""+g))}var ai=Array.isArray;function ps(a,l,g,E){if(a=a.options,l){l={};for(var N=0;N<g.length;N++)l["$"+g[N]]=!0;for(g=0;g<a.length;g++)N=l.hasOwnProperty("$"+a[g].value),a[g].selected!==N&&(a[g].selected=N),N&&E&&(a[g].defaultSelected=!0)}else{for(g=""+Re(g),l=null,N=0;N<a.length;N++){if(a[N].value===g){a[N].selected=!0,E&&(a[N].defaultSelected=!0);return}l!==null||a[N].disabled||(l=a[N])}l!==null&&(l.selected=!0)}}function pr(a,l){if(l.dangerouslySetInnerHTML!=null)throw Error(k(91));return et({},l,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function As(a,l){var g=l.value;if(g==null){if(g=l.children,l=l.defaultValue,g!=null){if(l!=null)throw Error(k(92));if(ai(g)){if(1<g.length)throw Error(k(93));g=g[0]}l=g}l==null&&(l=""),g=l}a._wrapperState={initialValue:Re(g)}}function vn(a,l){var g=Re(l.value),E=Re(l.defaultValue);g!=null&&(g=""+g,g!==a.value&&(a.value=g),l.defaultValue==null&&a.defaultValue!==g&&(a.defaultValue=g)),E!=null&&(a.defaultValue=""+E)}function ir(a){var l=a.textContent;l===a._wrapperState.initialValue&&l!==""&&l!==null&&(a.value=l)}function sa(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function aa(a,l){return a==null||a==="http://www.w3.org/1999/xhtml"?sa(l):a==="http://www.w3.org/2000/svg"&&l==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var Je,Vr=(function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(l,g,E,N){MSApp.execUnsafeLocalFunction(function(){return a(l,g,E,N)})}:a})(function(a,l){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=l;else{for(Je=Je||document.createElement("div"),Je.innerHTML="<svg>"+l.valueOf().toString()+"</svg>",l=Je.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;l.firstChild;)a.appendChild(l.firstChild)}});function dn(a,l){if(l){var g=a.firstChild;if(g&&g===a.lastChild&&g.nodeType===3){g.nodeValue=l;return}}a.textContent=l}var tn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Pa=["Webkit","ms","Moz","O"];Object.keys(tn).forEach(function(a){Pa.forEach(function(l){l=l+a.charAt(0).toUpperCase()+a.substring(1),tn[l]=tn[a]})});function _t(a,l,g){return l==null||typeof l=="boolean"||l===""?"":g||typeof l!="number"||l===0||tn.hasOwnProperty(a)&&tn[a]?(""+l).trim():l+"px"}function In(a,l){a=a.style;for(var g in l)if(l.hasOwnProperty(g)){var E=g.indexOf("--")===0,N=_t(g,l[g],E);g==="float"&&(g="cssFloat"),E?a.setProperty(g,N):a[g]=N}}var dt=et({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mr(a,l){if(l){if(dt[a]&&(l.children!=null||l.dangerouslySetInnerHTML!=null))throw Error(k(137,a));if(l.dangerouslySetInnerHTML!=null){if(l.children!=null)throw Error(k(60));if(typeof l.dangerouslySetInnerHTML!="object"||!("__html"in l.dangerouslySetInnerHTML))throw Error(k(61))}if(l.style!=null&&typeof l.style!="object")throw Error(k(62))}}function qr(a,l){if(a.indexOf("-")===-1)return typeof l.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var pn=null;function ki(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Sr=null,Mi=null,gr=null;function _e(a){if(a=du(a)){if(typeof Sr!="function")throw Error(k(280));var l=a.stateNode;l&&(l=pu(l),Sr(a.stateNode,a.type,l))}}function Y(a){Mi?gr?gr.push(a):gr=[a]:Mi=a}function W(){if(Mi){var a=Mi,l=gr;if(gr=Mi=null,_e(a),l)for(a=0;a<l.length;a++)_e(l[a])}}function ae(a,l){return a(l)}function se(){}var Ee=!1;function Me(a,l,g){if(Ee)return a(l,g);Ee=!0;try{return ae(a,l,g)}finally{Ee=!1,(Mi!==null||gr!==null)&&(se(),W())}}function Oe(a,l){var g=a.stateNode;if(g===null)return null;var E=pu(g);if(E===null)return null;g=E[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(E=!E.disabled)||(a=a.type,E=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!E;break e;default:a=!1}if(a)return null;if(g&&typeof g!="function")throw Error(k(231,l,typeof g));return g}var ke=!1;if(h)try{var Ye={};Object.defineProperty(Ye,"passive",{get:function(){ke=!0}}),window.addEventListener("test",Ye,Ye),window.removeEventListener("test",Ye,Ye)}catch{ke=!1}function lt(a,l,g,E,N,j,te,xe,Ce){var Ke=Array.prototype.slice.call(arguments,3);try{l.apply(g,Ke)}catch(gt){this.onError(gt)}}var Ze=!1,vt=null,jt=!1,Jt=null,Fn={onError:function(a){Ze=!0,vt=a}};function bn(a,l,g,E,N,j,te,xe,Ce){Ze=!1,vt=null,lt.apply(Fn,arguments)}function kn(a,l,g,E,N,j,te,xe,Ce){if(bn.apply(this,arguments),Ze){if(Ze){var Ke=vt;Ze=!1,vt=null}else throw Error(k(198));jt||(jt=!0,Jt=Ke)}}function Sn(a){var l=a,g=a;if(a.alternate)for(;l.return;)l=l.return;else{a=l;do l=a,(l.flags&4098)!==0&&(g=l.return),a=l.return;while(a)}return l.tag===3?g:null}function pi(a){if(a.tag===13){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function ti(a){if(Sn(a)!==a)throw Error(k(188))}function xn(a){var l=a.alternate;if(!l){if(l=Sn(a),l===null)throw Error(k(188));return l!==a?null:a}for(var g=a,E=l;;){var N=g.return;if(N===null)break;var j=N.alternate;if(j===null){if(E=N.return,E!==null){g=E;continue}break}if(N.child===j.child){for(j=N.child;j;){if(j===g)return ti(N),a;if(j===E)return ti(N),l;j=j.sibling}throw Error(k(188))}if(g.return!==E.return)g=N,E=j;else{for(var te=!1,xe=N.child;xe;){if(xe===g){te=!0,g=N,E=j;break}if(xe===E){te=!0,E=N,g=j;break}xe=xe.sibling}if(!te){for(xe=j.child;xe;){if(xe===g){te=!0,g=j,E=N;break}if(xe===E){te=!0,E=j,g=N;break}xe=xe.sibling}if(!te)throw Error(k(189))}}if(g.alternate!==E)throw Error(k(190))}if(g.tag!==3)throw Error(k(188));return g.stateNode.current===g?a:l}function Zn(a){return a=xn(a),a!==null?ri(a):null}function ri(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var l=ri(a);if(l!==null)return l;a=a.sibling}return null}var Si=b.unstable_scheduleCallback,Bn=b.unstable_cancelCallback,Er=b.unstable_shouldYield,Co=b.unstable_requestPaint,hn=b.unstable_now,Za=b.unstable_getCurrentPriorityLevel,Ha=b.unstable_ImmediatePriority,yr=b.unstable_UserBlockingPriority,rr=b.unstable_NormalPriority,hc=b.unstable_LowPriority,Ei=b.unstable_IdlePriority,Fi=null,sr=null;function Qr(a){if(sr&&typeof sr.onCommitFiberRoot=="function")try{sr.onCommitFiberRoot(Fi,a,void 0,(a.current.flags&128)===128)}catch{}}var Xn=Math.clz32?Math.clz32:Bi,Xo=Math.log,ms=Math.LN2;function Bi(a){return a>>>=0,a===0?32:31-(Xo(a)/ms|0)|0}var Ma=64,Ir=4194304;function Ls(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function Ai(a,l){var g=a.pendingLanes;if(g===0)return 0;var E=0,N=a.suspendedLanes,j=a.pingedLanes,te=g&268435455;if(te!==0){var xe=te&~N;xe!==0?E=Ls(xe):(j&=te,j!==0&&(E=Ls(j)))}else te=g&~N,te!==0?E=Ls(te):j!==0&&(E=Ls(j));if(E===0)return 0;if(l!==0&&l!==E&&(l&N)===0&&(N=E&-E,j=l&-l,N>=j||N===16&&(j&4194240)!==0))return l;if((E&4)!==0&&(E|=g&16),l=a.entangledLanes,l!==0)for(a=a.entanglements,l&=E;0<l;)g=31-Xn(l),N=1<<g,E|=a[g],l&=~N;return E}function Aa(a,l){switch(a){case 1:case 2:case 4:return l+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Wo(a,l){for(var g=a.suspendedLanes,E=a.pingedLanes,N=a.expirationTimes,j=a.pendingLanes;0<j;){var te=31-Xn(j),xe=1<<te,Ce=N[te];Ce===-1?((xe&g)===0||(xe&E)!==0)&&(N[te]=Aa(xe,l)):Ce<=l&&(a.expiredLanes|=xe),j&=~xe}}function Nr(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function oa(){var a=Ma;return Ma<<=1,(Ma&4194240)===0&&(Ma=64),a}function Vn(a){for(var l=[],g=0;31>g;g++)l.push(a);return l}function Xa(a,l,g){a.pendingLanes|=l,l!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,l=31-Xn(l),a[l]=g}function au(a,l){var g=a.pendingLanes&~l;a.pendingLanes=l,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=l,a.mutableReadLanes&=l,a.entangledLanes&=l,l=a.entanglements;var E=a.eventTimes;for(a=a.expirationTimes;0<g;){var N=31-Xn(g),j=1<<N;l[N]=0,E[N]=-1,a[N]=-1,g&=~j}}function la(a,l){var g=a.entangledLanes|=l;for(a=a.entanglements;g;){var E=31-Xn(g),N=1<<E;N&l|a[E]&l&&(a[E]|=l),g&=~N}}var qn=0;function Po(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var Mo,Wa,Ya,Yo,mi,Rs=!1,yl=[],_r=null,Ii=null,Wn=null,ji=new Map,La=new Map,gs=[],Ko="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ao(a,l){switch(a){case"focusin":case"focusout":_r=null;break;case"dragenter":case"dragleave":Ii=null;break;case"mouseover":case"mouseout":Wn=null;break;case"pointerover":case"pointerout":ji.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":La.delete(l.pointerId)}}function Ns(a,l,g,E,N,j){return a===null||a.nativeEvent!==j?(a={blockedOn:l,domEventName:g,eventSystemFlags:E,nativeEvent:j,targetContainers:[N]},l!==null&&(l=du(l),l!==null&&Wa(l)),a):(a.eventSystemFlags|=E,l=a.targetContainers,N!==null&&l.indexOf(N)===-1&&l.push(N),a)}function Lu(a,l,g,E,N){switch(l){case"focusin":return _r=Ns(_r,a,l,g,E,N),!0;case"dragenter":return Ii=Ns(Ii,a,l,g,E,N),!0;case"mouseover":return Wn=Ns(Wn,a,l,g,E,N),!0;case"pointerover":var j=N.pointerId;return ji.set(j,Ns(ji.get(j)||null,a,l,g,E,N)),!0;case"gotpointercapture":return j=N.pointerId,La.set(j,Ns(La.get(j)||null,a,l,g,E,N)),!0}return!1}function Hn(a){var l=po(a.target);if(l!==null){var g=Sn(l);if(g!==null){if(l=g.tag,l===13){if(l=pi(g),l!==null){a.blockedOn=l,mi(a.priority,function(){Ya(g)});return}}else if(l===3&&g.stateNode.current.memoizedState.isDehydrated){a.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Dr(a){if(a.blockedOn!==null)return!1;for(var l=a.targetContainers;0<l.length;){var g=Lo(a.domEventName,a.eventSystemFlags,l[0],a.nativeEvent);if(g===null){g=a.nativeEvent;var E=new g.constructor(g.type,g);pn=E,g.target.dispatchEvent(E),pn=null}else return l=du(g),l!==null&&Wa(l),a.blockedOn=g,!1;l.shift()}return!0}function _l(a,l,g){Dr(a)&&g.delete(l)}function Ru(){Rs=!1,_r!==null&&Dr(_r)&&(_r=null),Ii!==null&&Dr(Ii)&&(Ii=null),Wn!==null&&Dr(Wn)&&(Wn=null),ji.forEach(_l),La.forEach(_l)}function Ds(a,l){a.blockedOn===l&&(a.blockedOn=null,Rs||(Rs=!0,b.unstable_scheduleCallback(b.unstable_NormalPriority,Ru)))}function zs(a){function l(N){return Ds(N,a)}if(0<yl.length){Ds(yl[0],a);for(var g=1;g<yl.length;g++){var E=yl[g];E.blockedOn===a&&(E.blockedOn=null)}}for(_r!==null&&Ds(_r,a),Ii!==null&&Ds(Ii,a),Wn!==null&&Ds(Wn,a),ji.forEach(l),La.forEach(l),g=0;g<gs.length;g++)E=gs[g],E.blockedOn===a&&(E.blockedOn=null);for(;0<gs.length&&(g=gs[0],g.blockedOn===null);)Hn(g),g.blockedOn===null&&gs.shift()}var Li=tt.ReactCurrentBatchConfig,Ra=!0;function Jo(a,l,g,E){var N=qn,j=Li.transition;Li.transition=null;try{qn=1,Gr(a,l,g,E)}finally{qn=N,Li.transition=j}}function vl(a,l,g,E){var N=qn,j=Li.transition;Li.transition=null;try{qn=4,Gr(a,l,g,E)}finally{qn=N,Li.transition=j}}function Gr(a,l,g,E){if(Ra){var N=Lo(a,l,g,E);if(N===null)fu(a,l,E,xl,g),Ao(a,E);else if(Lu(N,a,l,g,E))E.stopPropagation();else if(Ao(a,E),l&4&&-1<Ko.indexOf(a)){for(;N!==null;){var j=du(N);if(j!==null&&Mo(j),j=Lo(a,l,g,E),j===null&&fu(a,l,E,xl,g),j===N)break;N=j}N!==null&&E.stopPropagation()}else fu(a,l,E,null,g)}}var xl=null;function Lo(a,l,g,E){if(xl=null,a=ki(E),a=po(a),a!==null)if(l=Sn(a),l===null)a=null;else if(g=l.tag,g===13){if(a=pi(l),a!==null)return a;a=null}else if(g===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;a=null}else l!==a&&(a=null);return xl=a,null}function vr(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Za()){case Ha:return 1;case yr:return 4;case rr:case hc:return 16;case Ei:return 536870912;default:return 16}default:return 16}}var Ji=null,Gn=null,Qi=null;function Ka(){if(Qi)return Qi;var a,l=Gn,g=l.length,E,N="value"in Ji?Ji.value:Ji.textContent,j=N.length;for(a=0;a<g&&l[a]===N[a];a++);var te=g-a;for(E=1;E<=te&&l[g-E]===N[j-E];E++);return Qi=N.slice(a,1<E?1-E:void 0)}function ua(a){var l=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&l===13&&(a=13)):a=l,a===10&&(a=13),32<=a||a===13?a:0}function ca(){return!0}function wl(){return!1}function er(a){function l(g,E,N,j,te){this._reactName=g,this._targetInst=N,this.type=E,this.nativeEvent=j,this.target=te,this.currentTarget=null;for(var xe in a)a.hasOwnProperty(xe)&&(g=a[xe],this[xe]=g?g(j):j[xe]);return this.isDefaultPrevented=(j.defaultPrevented!=null?j.defaultPrevented:j.returnValue===!1)?ca:wl,this.isPropagationStopped=wl,this}return et(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=ca)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=ca)},persist:function(){},isPersistent:ca}),l}var Ja={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zr=er(Ja),Qa=et({},Ja,{view:0,detail:0}),Nu=er(Qa),bl,kl,ys,Qo=et({},Qa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nl,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==ys&&(ys&&a.type==="mousemove"?(bl=a.screenX-ys.screenX,kl=a.screenY-ys.screenY):kl=bl=0,ys=a),bl)},movementY:function(a){return"movementY"in a?a.movementY:kl}}),Du=er(Qo),zu=et({},Qo,{dataTransfer:0}),_s=er(zu),$r=et({},Qa,{relatedTarget:0}),Ro=er($r),Ou=et({},Ja,{animationName:0,elapsedTime:0,pseudoElement:0}),fc=er(Ou),Sl=et({},Ja,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),ou=er(Sl),El=et({},Ja,{data:0}),el=er(El),es={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},tl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ui={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function eo(a){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(a):(a=Ui[a])?!!l[a]:!1}function nl(){return eo}var Il=et({},Qa,{key:function(a){if(a.key){var l=es[a.key]||a.key;if(l!=="Unidentified")return l}return a.type==="keypress"?(a=ua(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?tl[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nl,charCode:function(a){return a.type==="keypress"?ua(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?ua(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),il=er(Il),Tl=et({},Qo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Os=er(Tl),lu=et({},Qa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nl}),dc=er(lu),Ri=et({},Ja,{propertyName:0,elapsedTime:0,pseudoElement:0}),pc=er(Ri),Mn=et({},Qo,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Cl=er(Mn),oi=[9,13,27,32],Jn=h&&"CompositionEvent"in window,ts=null;h&&"documentMode"in document&&(ts=document.documentMode);var rl=h&&"TextEvent"in window&&!ts,to=h&&(!Jn||ts&&8<ts&&11>=ts),Pl=" ",Na=!1;function no(a,l){switch(a){case"keyup":return oi.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Zr(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Da=!1;function uu(a,l){switch(a){case"compositionend":return Zr(l);case"keypress":return l.which!==32?null:(Na=!0,Pl);case"textInput":return a=l.data,a===Pl&&Na?null:a;default:return null}}function cu(a,l){if(Da)return a==="compositionend"||!Jn&&no(a,l)?(a=Ka(),Qi=Gn=Ji=null,Da=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return to&&l.locale!=="ko"?null:l.data;default:return null}}var za={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function io(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l==="input"?!!za[a.type]:l==="textarea"}function ro(a,l,g,E){Y(E),l=Rl(l,"onChange"),0<l.length&&(g=new zr("onChange","change",null,g,E),a.push({event:g,listeners:l}))}var Fs=null,Bs=null;function No(a){Bu(a,0)}function ha(a){var l=ma(a);if(we(l))return a}function so(a,l){if(a==="change")return l}var Ml=!1;if(h){var sl;if(h){var jn="oninput"in document;if(!jn){var js=document.createElement("div");js.setAttribute("oninput","return;"),jn=typeof js.oninput=="function"}sl=jn}else sl=!1;Ml=sl&&(!document.documentMode||9<document.documentMode)}function Fu(){Fs&&(Fs.detachEvent("onpropertychange",Al),Bs=Fs=null)}function Al(a){if(a.propertyName==="value"&&ha(Bs)){var l=[];ro(l,Bs,a,ki(a)),Me(No,l)}}function ar(a,l,g){a==="focusin"?(Fu(),Fs=l,Bs=g,Fs.attachEvent("onpropertychange",Al)):a==="focusout"&&Fu()}function vs(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return ha(Bs)}function f(a,l){if(a==="click")return ha(l)}function i(a,l){if(a==="input"||a==="change")return ha(l)}function s(a,l){return a===l&&(a!==0||1/a===1/l)||a!==a&&l!==l}var c=typeof Object.is=="function"?Object.is:s;function w(a,l){if(c(a,l))return!0;if(typeof a!="object"||a===null||typeof l!="object"||l===null)return!1;var g=Object.keys(a),E=Object.keys(l);if(g.length!==E.length)return!1;for(E=0;E<g.length;E++){var N=g[E];if(!K.call(l,N)||!c(a[N],l[N]))return!1}return!0}function L(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function F(a,l){var g=L(a);a=0;for(var E;g;){if(g.nodeType===3){if(E=a+g.textContent.length,a<=l&&E>=l)return{node:g,offset:l-a};a=E}e:{for(;g;){if(g.nextSibling){g=g.nextSibling;break e}g=g.parentNode}g=void 0}g=L(g)}}function H(a,l){return a&&l?a===l?!0:a&&a.nodeType===3?!1:l&&l.nodeType===3?H(a,l.parentNode):"contains"in a?a.contains(l):a.compareDocumentPosition?!!(a.compareDocumentPosition(l)&16):!1:!1}function re(){for(var a=window,l=Gi();l instanceof a.HTMLIFrameElement;){try{var g=typeof l.contentWindow.location.href=="string"}catch{g=!1}if(g)a=l.contentWindow;else break;l=Gi(a.document)}return l}function fe(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l&&(l==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||l==="textarea"||a.contentEditable==="true")}function De(a){var l=re(),g=a.focusedElem,E=a.selectionRange;if(l!==g&&g&&g.ownerDocument&&H(g.ownerDocument.documentElement,g)){if(E!==null&&fe(g)){if(l=E.start,a=E.end,a===void 0&&(a=l),"selectionStart"in g)g.selectionStart=l,g.selectionEnd=Math.min(a,g.value.length);else if(a=(l=g.ownerDocument||document)&&l.defaultView||window,a.getSelection){a=a.getSelection();var N=g.textContent.length,j=Math.min(E.start,N);E=E.end===void 0?j:Math.min(E.end,N),!a.extend&&j>E&&(N=E,E=j,j=N),N=F(g,j);var te=F(g,E);N&&te&&(a.rangeCount!==1||a.anchorNode!==N.node||a.anchorOffset!==N.offset||a.focusNode!==te.node||a.focusOffset!==te.offset)&&(l=l.createRange(),l.setStart(N.node,N.offset),a.removeAllRanges(),j>E?(a.addRange(l),a.extend(te.node,te.offset)):(l.setEnd(te.node,te.offset),a.addRange(l)))}}for(l=[],a=g;a=a.parentNode;)a.nodeType===1&&l.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof g.focus=="function"&&g.focus(),g=0;g<l.length;g++)a=l[g],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var $e=h&&"documentMode"in document&&11>=document.documentMode,ut=null,At=null,Gt=null,on=!1;function Nn(a,l,g){var E=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;on||ut==null||ut!==Gi(E)||(E=ut,"selectionStart"in E&&fe(E)?E={start:E.selectionStart,end:E.selectionEnd}:(E=(E.ownerDocument&&E.ownerDocument.defaultView||window).getSelection(),E={anchorNode:E.anchorNode,anchorOffset:E.anchorOffset,focusNode:E.focusNode,focusOffset:E.focusOffset}),Gt&&w(Gt,E)||(Gt=E,E=Rl(At,"onSelect"),0<E.length&&(l=new zr("onSelect","select",null,l,g),a.push({event:l,listeners:E}),l.target=ut)))}function An(a,l){var g={};return g[a.toLowerCase()]=l.toLowerCase(),g["Webkit"+a]="webkit"+l,g["Moz"+a]="moz"+l,g}var Un={animationend:An("Animation","AnimationEnd"),animationiteration:An("Animation","AnimationIteration"),animationstart:An("Animation","AnimationStart"),transitionend:An("Transition","TransitionEnd")},Ti={},Yn={};h&&(Yn=document.createElement("div").style,"AnimationEvent"in window||(delete Un.animationend.animation,delete Un.animationiteration.animation,delete Un.animationstart.animation),"TransitionEvent"in window||delete Un.transitionend.transition);function xr(a){if(Ti[a])return Ti[a];if(!Un[a])return a;var l=Un[a],g;for(g in l)if(l.hasOwnProperty(g)&&g in Yn)return Ti[a]=l[g];return a}var ao=xr("animationend"),Ll=xr("animationiteration"),vi=xr("animationstart"),Hr=xr("transitionend"),Tr=new Map,oo="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xs(a,l){Tr.set(a,l),O(l,[a])}for(var Oa=0;Oa<oo.length;Oa++){var Us=oo[Oa],lo=Us.toLowerCase(),mc=Us[0].toUpperCase()+Us.slice(1);xs(lo,"on"+mc)}xs(ao,"onAnimationEnd"),xs(Ll,"onAnimationIteration"),xs(vi,"onAnimationStart"),xs("dblclick","onDoubleClick"),xs("focusin","onFocus"),xs("focusout","onBlur"),xs(Hr,"onTransitionEnd"),R("onMouseEnter",["mouseout","mouseover"]),R("onMouseLeave",["mouseout","mouseover"]),R("onPointerEnter",["pointerout","pointerover"]),R("onPointerLeave",["pointerout","pointerover"]),O("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),O("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),O("onBeforeInput",["compositionend","keypress","textInput","paste"]),O("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),O("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),O("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Do="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),gc=new Set("cancel close invalid load scroll toggle".split(" ").concat(Do));function hu(a,l,g){var E=a.type||"unknown-event";a.currentTarget=g,kn(E,l,void 0,a),a.currentTarget=null}function Bu(a,l){l=(l&4)!==0;for(var g=0;g<a.length;g++){var E=a[g],N=E.event;E=E.listeners;e:{var j=void 0;if(l)for(var te=E.length-1;0<=te;te--){var xe=E[te],Ce=xe.instance,Ke=xe.currentTarget;if(xe=xe.listener,Ce!==j&&N.isPropagationStopped())break e;hu(N,xe,Ke),j=Ce}else for(te=0;te<E.length;te++){if(xe=E[te],Ce=xe.instance,Ke=xe.currentTarget,xe=xe.listener,Ce!==j&&N.isPropagationStopped())break e;hu(N,xe,Ke),j=Ce}}}if(jt)throw a=Jt,jt=!1,Jt=null,a}function gi(a,l){var g=l[Dn];g===void 0&&(g=l[Dn]=new Set);var E=a+"__bubble";g.has(E)||(ju(l,a,2,!1),g.add(E))}function uo(a,l,g){var E=0;l&&(E|=4),ju(g,a,E,l)}var al="_reactListening"+Math.random().toString(36).slice(2);function co(a){if(!a[al]){a[al]=!0,P.forEach(function(g){g!=="selectionchange"&&(gc.has(g)||uo(g,!1,a),uo(g,!0,a))});var l=a.nodeType===9?a:a.ownerDocument;l===null||l[al]||(l[al]=!0,uo("selectionchange",!1,l))}}function ju(a,l,g,E){switch(vr(l)){case 1:var N=Jo;break;case 4:N=vl;break;default:N=Gr}g=N.bind(null,l,g,a),N=void 0,!ke||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(N=!0),E?N!==void 0?a.addEventListener(l,g,{capture:!0,passive:N}):a.addEventListener(l,g,!0):N!==void 0?a.addEventListener(l,g,{passive:N}):a.addEventListener(l,g,!1)}function fu(a,l,g,E,N){var j=E;if((l&1)===0&&(l&2)===0&&E!==null)e:for(;;){if(E===null)return;var te=E.tag;if(te===3||te===4){var xe=E.stateNode.containerInfo;if(xe===N||xe.nodeType===8&&xe.parentNode===N)break;if(te===4)for(te=E.return;te!==null;){var Ce=te.tag;if((Ce===3||Ce===4)&&(Ce=te.stateNode.containerInfo,Ce===N||Ce.nodeType===8&&Ce.parentNode===N))return;te=te.return}for(;xe!==null;){if(te=po(xe),te===null)return;if(Ce=te.tag,Ce===5||Ce===6){E=j=te;continue e}xe=xe.parentNode}}E=E.return}Me(function(){var Ke=j,gt=ki(g),xt=[];e:{var pt=Tr.get(a);if(pt!==void 0){var Rt=zr,$t=a;switch(a){case"keypress":if(ua(g)===0)break e;case"keydown":case"keyup":Rt=il;break;case"focusin":$t="focus",Rt=Ro;break;case"focusout":$t="blur",Rt=Ro;break;case"beforeblur":case"afterblur":Rt=Ro;break;case"click":if(g.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Rt=Du;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Rt=_s;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Rt=dc;break;case ao:case Ll:case vi:Rt=fc;break;case Hr:Rt=pc;break;case"scroll":Rt=Nu;break;case"wheel":Rt=Cl;break;case"copy":case"cut":case"paste":Rt=ou;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Rt=Os}var nn=(l&4)!==0,tr=!nn&&a==="scroll",He=nn?pt!==null?pt+"Capture":null:pt;nn=[];for(var Ne=Ke,Xe;Ne!==null;){Xe=Ne;var Tt=Xe.stateNode;if(Xe.tag===5&&Tt!==null&&(Xe=Tt,He!==null&&(Tt=Oe(Ne,He),Tt!=null&&nn.push(ol(Ne,Tt,Xe)))),tr)break;Ne=Ne.return}0<nn.length&&(pt=new Rt(pt,$t,null,g,gt),xt.push({event:pt,listeners:nn}))}}if((l&7)===0){e:{if(pt=a==="mouseover"||a==="pointerover",Rt=a==="mouseout"||a==="pointerout",pt&&g!==pn&&($t=g.relatedTarget||g.fromElement)&&(po($t)||$t[pa]))break e;if((Rt||pt)&&(pt=gt.window===gt?gt:(pt=gt.ownerDocument)?pt.defaultView||pt.parentWindow:window,Rt?($t=g.relatedTarget||g.toElement,Rt=Ke,$t=$t?po($t):null,$t!==null&&(tr=Sn($t),$t!==tr||$t.tag!==5&&$t.tag!==6)&&($t=null)):(Rt=null,$t=Ke),Rt!==$t)){if(nn=Du,Tt="onMouseLeave",He="onMouseEnter",Ne="mouse",(a==="pointerout"||a==="pointerover")&&(nn=Os,Tt="onPointerLeave",He="onPointerEnter",Ne="pointer"),tr=Rt==null?pt:ma(Rt),Xe=$t==null?pt:ma($t),pt=new nn(Tt,Ne+"leave",Rt,g,gt),pt.target=tr,pt.relatedTarget=Xe,Tt=null,po(gt)===Ke&&(nn=new nn(He,Ne+"enter",$t,g,gt),nn.target=Xe,nn.relatedTarget=tr,Tt=nn),tr=Tt,Rt&&$t)t:{for(nn=Rt,He=$t,Ne=0,Xe=nn;Xe;Xe=ho(Xe))Ne++;for(Xe=0,Tt=He;Tt;Tt=ho(Tt))Xe++;for(;0<Ne-Xe;)nn=ho(nn),Ne--;for(;0<Xe-Ne;)He=ho(He),Xe--;for(;Ne--;){if(nn===He||He!==null&&nn===He.alternate)break t;nn=ho(nn),He=ho(He)}nn=null}else nn=null;Rt!==null&&Nl(xt,pt,Rt,nn,!1),$t!==null&&tr!==null&&Nl(xt,tr,$t,nn,!0)}}e:{if(pt=Ke?ma(Ke):window,Rt=pt.nodeName&&pt.nodeName.toLowerCase(),Rt==="select"||Rt==="input"&&pt.type==="file")var ln=so;else if(io(pt))if(Ml)ln=i;else{ln=vs;var _n=ar}else(Rt=pt.nodeName)&&Rt.toLowerCase()==="input"&&(pt.type==="checkbox"||pt.type==="radio")&&(ln=f);if(ln&&(ln=ln(a,Ke))){ro(xt,ln,g,gt);break e}_n&&_n(a,pt,Ke),a==="focusout"&&(_n=pt._wrapperState)&&_n.controlled&&pt.type==="number"&&ot(pt,"number",pt.value)}switch(_n=Ke?ma(Ke):window,a){case"focusin":(io(_n)||_n.contentEditable==="true")&&(ut=_n,At=Ke,Gt=null);break;case"focusout":Gt=At=ut=null;break;case"mousedown":on=!0;break;case"contextmenu":case"mouseup":case"dragend":on=!1,Nn(xt,g,gt);break;case"selectionchange":if($e)break;case"keydown":case"keyup":Nn(xt,g,gt)}var un;if(Jn)e:{switch(a){case"compositionstart":var Tn="onCompositionStart";break e;case"compositionend":Tn="onCompositionEnd";break e;case"compositionupdate":Tn="onCompositionUpdate";break e}Tn=void 0}else Da?no(a,g)&&(Tn="onCompositionEnd"):a==="keydown"&&g.keyCode===229&&(Tn="onCompositionStart");Tn&&(to&&g.locale!=="ko"&&(Da||Tn!=="onCompositionStart"?Tn==="onCompositionEnd"&&Da&&(un=Ka()):(Ji=gt,Gn="value"in Ji?Ji.value:Ji.textContent,Da=!0)),_n=Rl(Ke,Tn),0<_n.length&&(Tn=new el(Tn,a,null,g,gt),xt.push({event:Tn,listeners:_n}),un?Tn.data=un:(un=Zr(g),un!==null&&(Tn.data=un)))),(un=rl?uu(a,g):cu(a,g))&&(Ke=Rl(Ke,"onBeforeInput"),0<Ke.length&&(gt=new el("onBeforeInput","beforeinput",null,g,gt),xt.push({event:gt,listeners:Ke}),gt.data=un))}Bu(xt,l)})}function ol(a,l,g){return{instance:a,listener:l,currentTarget:g}}function Rl(a,l){for(var g=l+"Capture",E=[];a!==null;){var N=a,j=N.stateNode;N.tag===5&&j!==null&&(N=j,j=Oe(a,g),j!=null&&E.unshift(ol(a,j,N)),j=Oe(a,l),j!=null&&E.push(ol(a,j,N))),a=a.return}return E}function ho(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function Nl(a,l,g,E,N){for(var j=l._reactName,te=[];g!==null&&g!==E;){var xe=g,Ce=xe.alternate,Ke=xe.stateNode;if(Ce!==null&&Ce===E)break;xe.tag===5&&Ke!==null&&(xe=Ke,N?(Ce=Oe(g,j),Ce!=null&&te.unshift(ol(g,Ce,xe))):N||(Ce=Oe(g,j),Ce!=null&&te.push(ol(g,Ce,xe)))),g=g.return}te.length!==0&&a.push({event:l,listeners:te})}var ih=/\r\n?/g,Vs=/\u0000|\uFFFD/g;function fa(a){return(typeof a=="string"?a:""+a).replace(ih,`
`).replace(Vs,"")}function Dl(a,l,g){if(l=fa(l),fa(a)!==l&&g)throw Error(k(425))}function ns(){}var fo=null,yc=null;function _c(a,l){return a==="textarea"||a==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var Uu=typeof setTimeout=="function"?setTimeout:void 0,rh=typeof clearTimeout=="function"?clearTimeout:void 0,Vu=typeof Promise=="function"?Promise:void 0,zl=typeof queueMicrotask=="function"?queueMicrotask:typeof Vu<"u"?function(a){return Vu.resolve(null).then(a).catch(qs)}:Uu;function qs(a){setTimeout(function(){throw a})}function zt(a,l){var g=l,E=0;do{var N=g.nextSibling;if(a.removeChild(g),N&&N.nodeType===8)if(g=N.data,g==="/$"){if(E===0){a.removeChild(N),zs(l);return}E--}else g!=="$"&&g!=="$?"&&g!=="$!"||E++;g=N}while(g);zs(l)}function da(a){for(;a!=null;a=a.nextSibling){var l=a.nodeType;if(l===1||l===3)break;if(l===8){if(l=a.data,l==="$"||l==="$!"||l==="$?")break;if(l==="/$")return null}}return a}function qu(a){a=a.previousSibling;for(var l=0;a;){if(a.nodeType===8){var g=a.data;if(g==="$"||g==="$!"||g==="$?"){if(l===0)return a;l--}else g==="/$"&&l++}a=a.previousSibling}return null}var ll=Math.random().toString(36).slice(2),Xr="__reactFiber$"+ll,Fa="__reactProps$"+ll,pa="__reactContainer$"+ll,Dn="__reactEvents$"+ll,vc="__reactListeners$"+ll,Kh="__reactHandles$"+ll;function po(a){var l=a[Xr];if(l)return l;for(var g=a.parentNode;g;){if(l=g[pa]||g[Xr]){if(g=l.alternate,l.child!==null||g!==null&&g.child!==null)for(a=qu(a);a!==null;){if(g=a[Xr])return g;a=qu(a)}return l}a=g,g=a.parentNode}return null}function du(a){return a=a[Xr]||a[pa],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function ma(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(k(33))}function pu(a){return a[Fa]||null}var mu=[],ul=-1;function zo(a){return{current:a}}function yi(a){0>ul||(a.current=mu[ul],mu[ul]=null,ul--)}function xi(a,l){ul++,mu[ul]=a.current,a.current=l}var Oo={},ui=zo(Oo),On=zo(!1),Gs=Oo;function mo(a,l){var g=a.type.contextTypes;if(!g)return Oo;var E=a.stateNode;if(E&&E.__reactInternalMemoizedUnmaskedChildContext===l)return E.__reactInternalMemoizedMaskedChildContext;var N={},j;for(j in g)N[j]=l[j];return E&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=l,a.__reactInternalMemoizedMaskedChildContext=N),N}function Cr(a){return a=a.childContextTypes,a!=null}function gu(){yi(On),yi(ui)}function Ol(a,l,g){if(ui.current!==Oo)throw Error(k(168));xi(ui,l),xi(On,g)}function Fl(a,l,g){var E=a.stateNode;if(l=l.childContextTypes,typeof E.getChildContext!="function")return g;E=E.getChildContext();for(var N in E)if(!(N in l))throw Error(k(108,Rn(a)||"Unknown",N));return et({},g,E)}function ws(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Oo,Gs=ui.current,xi(ui,a),xi(On,On.current),!0}function Bl(a,l,g){var E=a.stateNode;if(!E)throw Error(k(169));g?(a=Fl(a,l,Gs),E.__reactInternalMemoizedMergedChildContext=a,yi(On),yi(ui),xi(ui,a)):yi(On),xi(On,g)}var Ot=null,sn=!1,jl=!1;function yu(a){Ot===null?Ot=[a]:Ot.push(a)}function xc(a){sn=!0,yu(a)}function _(){if(!jl&&Ot!==null){jl=!0;var a=0,l=qn;try{var g=Ot;for(qn=1;a<g.length;a++){var E=g[a];do E=E(!0);while(E!==null)}Ot=null,sn=!1}catch(N){throw Ot!==null&&(Ot=Ot.slice(a+1)),Si(Ha,_),N}finally{qn=l,jl=!1}}return null}var e=[],o=0,d=null,p=0,y=[],T=0,A=null,D=1,U="";function $(a,l){e[o++]=p,e[o++]=d,d=a,p=l}function Z(a,l,g){y[T++]=D,y[T++]=U,y[T++]=A,A=a;var E=D;a=U;var N=32-Xn(E)-1;E&=~(1<<N),g+=1;var j=32-Xn(l)+N;if(30<j){var te=N-N%5;j=(E&(1<<te)-1).toString(32),E>>=te,N-=te,D=1<<32-Xn(l)+N|g<<N|E,U=j+a}else D=1<<j|g<<N|E,U=a}function Q(a){a.return!==null&&($(a,1),Z(a,1,0))}function oe(a){for(;a===d;)d=e[--o],e[o]=null,p=e[--o],e[o]=null;for(;a===A;)A=y[--T],y[T]=null,U=y[--T],y[T]=null,D=y[--T],y[T]=null}var he=null,pe=null,ge=!1,ve=null;function Se(a,l){var g=Ks(5,null,null,0);g.elementType="DELETED",g.stateNode=l,g.return=a,l=a.deletions,l===null?(a.deletions=[g],a.flags|=16):l.push(g)}function me(a,l){switch(a.tag){case 5:var g=a.type;return l=l.nodeType!==1||g.toLowerCase()!==l.nodeName.toLowerCase()?null:l,l!==null?(a.stateNode=l,he=a,pe=da(l.firstChild),!0):!1;case 6:return l=a.pendingProps===""||l.nodeType!==3?null:l,l!==null?(a.stateNode=l,he=a,pe=null,!0):!1;case 13:return l=l.nodeType!==8?null:l,l!==null?(g=A!==null?{id:D,overflow:U}:null,a.memoizedState={dehydrated:l,treeContext:g,retryLane:1073741824},g=Ks(18,null,null,0),g.stateNode=l,g.return=a,a.child=g,he=a,pe=null,!0):!1;default:return!1}}function Ae(a){return(a.mode&1)!==0&&(a.flags&128)===0}function ze(a){if(ge){var l=pe;if(l){var g=l;if(!me(a,l)){if(Ae(a))throw Error(k(418));l=da(g.nextSibling);var E=he;l&&me(a,l)?Se(E,g):(a.flags=a.flags&-4097|2,ge=!1,he=a)}}else{if(Ae(a))throw Error(k(418));a.flags=a.flags&-4097|2,ge=!1,he=a}}}function Ve(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;he=a}function at(a){if(a!==he)return!1;if(!ge)return Ve(a),ge=!0,!1;var l;if((l=a.tag!==3)&&!(l=a.tag!==5)&&(l=a.type,l=l!=="head"&&l!=="body"&&!_c(a.type,a.memoizedProps)),l&&(l=pe)){if(Ae(a))throw yt(),Error(k(418));for(;l;)Se(a,l),l=da(l.nextSibling)}if(Ve(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(k(317));e:{for(a=a.nextSibling,l=0;a;){if(a.nodeType===8){var g=a.data;if(g==="/$"){if(l===0){pe=da(a.nextSibling);break e}l--}else g!=="$"&&g!=="$!"&&g!=="$?"||l++}a=a.nextSibling}pe=null}}else pe=he?da(a.stateNode.nextSibling):null;return!0}function yt(){for(var a=pe;a;)a=da(a.nextSibling)}function kt(){pe=he=null,ge=!1}function Lt(a){ve===null?ve=[a]:ve.push(a)}var Et=tt.ReactCurrentBatchConfig;function bt(a,l,g){if(a=g.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(g._owner){if(g=g._owner,g){if(g.tag!==1)throw Error(k(309));var E=g.stateNode}if(!E)throw Error(k(147,a));var N=E,j=""+a;return l!==null&&l.ref!==null&&typeof l.ref=="function"&&l.ref._stringRef===j?l.ref:(l=function(te){var xe=N.refs;te===null?delete xe[j]:xe[j]=te},l._stringRef=j,l)}if(typeof a!="string")throw Error(k(284));if(!g._owner)throw Error(k(290,a))}return a}function Ut(a,l){throw a=Object.prototype.toString.call(l),Error(k(31,a==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":a))}function gn(a){var l=a._init;return l(a._payload)}function It(a){function l(He,Ne){if(a){var Xe=He.deletions;Xe===null?(He.deletions=[Ne],He.flags|=16):Xe.push(Ne)}}function g(He,Ne){if(!a)return null;for(;Ne!==null;)l(He,Ne),Ne=Ne.sibling;return null}function E(He,Ne){for(He=new Map;Ne!==null;)Ne.key!==null?He.set(Ne.key,Ne):He.set(Ne.index,Ne),Ne=Ne.sibling;return He}function N(He,Ne){return He=Jl(He,Ne),He.index=0,He.sibling=null,He}function j(He,Ne,Xe){return He.index=Xe,a?(Xe=He.alternate,Xe!==null?(Xe=Xe.index,Xe<Ne?(He.flags|=2,Ne):Xe):(He.flags|=2,Ne)):(He.flags|=1048576,Ne)}function te(He){return a&&He.alternate===null&&(He.flags|=2),He}function xe(He,Ne,Xe,Tt){return Ne===null||Ne.tag!==6?(Ne=Va(Xe,He.mode,Tt),Ne.return=He,Ne):(Ne=N(Ne,Xe),Ne.return=He,Ne)}function Ce(He,Ne,Xe,Tt){var ln=Xe.type;return ln===Ge?gt(He,Ne,Xe.props.children,Tt,Xe.key):Ne!==null&&(Ne.elementType===ln||typeof ln=="object"&&ln!==null&&ln.$$typeof===fn&&gn(ln)===Ne.type)?(Tt=N(Ne,Xe.props),Tt.ref=bt(He,Ne,Xe),Tt.return=He,Tt):(Tt=Xc(Xe.type,Xe.key,Xe.props,null,He.mode,Tt),Tt.ref=bt(He,Ne,Xe),Tt.return=He,Tt)}function Ke(He,Ne,Xe,Tt){return Ne===null||Ne.tag!==4||Ne.stateNode.containerInfo!==Xe.containerInfo||Ne.stateNode.implementation!==Xe.implementation?(Ne=Vo(Xe,He.mode,Tt),Ne.return=He,Ne):(Ne=N(Ne,Xe.children||[]),Ne.return=He,Ne)}function gt(He,Ne,Xe,Tt,ln){return Ne===null||Ne.tag!==7?(Ne=Ql(Xe,He.mode,Tt,ln),Ne.return=He,Ne):(Ne=N(Ne,Xe),Ne.return=He,Ne)}function xt(He,Ne,Xe){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number")return Ne=Va(""+Ne,He.mode,Xe),Ne.return=He,Ne;if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case nt:return Xe=Xc(Ne.type,Ne.key,Ne.props,null,He.mode,Xe),Xe.ref=bt(He,null,Ne),Xe.return=He,Xe;case it:return Ne=Vo(Ne,He.mode,Xe),Ne.return=He,Ne;case fn:var Tt=Ne._init;return xt(He,Tt(Ne._payload),Xe)}if(ai(Ne)||Ft(Ne))return Ne=Ql(Ne,He.mode,Xe,null),Ne.return=He,Ne;Ut(He,Ne)}return null}function pt(He,Ne,Xe,Tt){var ln=Ne!==null?Ne.key:null;if(typeof Xe=="string"&&Xe!==""||typeof Xe=="number")return ln!==null?null:xe(He,Ne,""+Xe,Tt);if(typeof Xe=="object"&&Xe!==null){switch(Xe.$$typeof){case nt:return Xe.key===ln?Ce(He,Ne,Xe,Tt):null;case it:return Xe.key===ln?Ke(He,Ne,Xe,Tt):null;case fn:return ln=Xe._init,pt(He,Ne,ln(Xe._payload),Tt)}if(ai(Xe)||Ft(Xe))return ln!==null?null:gt(He,Ne,Xe,Tt,null);Ut(He,Xe)}return null}function Rt(He,Ne,Xe,Tt,ln){if(typeof Tt=="string"&&Tt!==""||typeof Tt=="number")return He=He.get(Xe)||null,xe(Ne,He,""+Tt,ln);if(typeof Tt=="object"&&Tt!==null){switch(Tt.$$typeof){case nt:return He=He.get(Tt.key===null?Xe:Tt.key)||null,Ce(Ne,He,Tt,ln);case it:return He=He.get(Tt.key===null?Xe:Tt.key)||null,Ke(Ne,He,Tt,ln);case fn:var _n=Tt._init;return Rt(He,Ne,Xe,_n(Tt._payload),ln)}if(ai(Tt)||Ft(Tt))return He=He.get(Xe)||null,gt(Ne,He,Tt,ln,null);Ut(Ne,Tt)}return null}function $t(He,Ne,Xe,Tt){for(var ln=null,_n=null,un=Ne,Tn=Ne=0,Lr=null;un!==null&&Tn<Xe.length;Tn++){un.index>Tn?(Lr=un,un=null):Lr=un.sibling;var si=pt(He,un,Xe[Tn],Tt);if(si===null){un===null&&(un=Lr);break}a&&un&&si.alternate===null&&l(He,un),Ne=j(si,Ne,Tn),_n===null?ln=si:_n.sibling=si,_n=si,un=Lr}if(Tn===Xe.length)return g(He,un),ge&&$(He,Tn),ln;if(un===null){for(;Tn<Xe.length;Tn++)un=xt(He,Xe[Tn],Tt),un!==null&&(Ne=j(un,Ne,Tn),_n===null?ln=un:_n.sibling=un,_n=un);return ge&&$(He,Tn),ln}for(un=E(He,un);Tn<Xe.length;Tn++)Lr=Rt(un,He,Tn,Xe[Tn],Tt),Lr!==null&&(a&&Lr.alternate!==null&&un.delete(Lr.key===null?Tn:Lr.key),Ne=j(Lr,Ne,Tn),_n===null?ln=Lr:_n.sibling=Lr,_n=Lr);return a&&un.forEach(function(dl){return l(He,dl)}),ge&&$(He,Tn),ln}function nn(He,Ne,Xe,Tt){var ln=Ft(Xe);if(typeof ln!="function")throw Error(k(150));if(Xe=ln.call(Xe),Xe==null)throw Error(k(151));for(var _n=ln=null,un=Ne,Tn=Ne=0,Lr=null,si=Xe.next();un!==null&&!si.done;Tn++,si=Xe.next()){un.index>Tn?(Lr=un,un=null):Lr=un.sibling;var dl=pt(He,un,si.value,Tt);if(dl===null){un===null&&(un=Lr);break}a&&un&&dl.alternate===null&&l(He,un),Ne=j(dl,Ne,Tn),_n===null?ln=dl:_n.sibling=dl,_n=dl,un=Lr}if(si.done)return g(He,un),ge&&$(He,Tn),ln;if(un===null){for(;!si.done;Tn++,si=Xe.next())si=xt(He,si.value,Tt),si!==null&&(Ne=j(si,Ne,Tn),_n===null?ln=si:_n.sibling=si,_n=si);return ge&&$(He,Tn),ln}for(un=E(He,un);!si.done;Tn++,si=Xe.next())si=Rt(un,He,Tn,si.value,Tt),si!==null&&(a&&si.alternate!==null&&un.delete(si.key===null?Tn:si.key),Ne=j(si,Ne,Tn),_n===null?ln=si:_n.sibling=si,_n=si);return a&&un.forEach(function(gp){return l(He,gp)}),ge&&$(He,Tn),ln}function tr(He,Ne,Xe,Tt){if(typeof Xe=="object"&&Xe!==null&&Xe.type===Ge&&Xe.key===null&&(Xe=Xe.props.children),typeof Xe=="object"&&Xe!==null){switch(Xe.$$typeof){case nt:e:{for(var ln=Xe.key,_n=Ne;_n!==null;){if(_n.key===ln){if(ln=Xe.type,ln===Ge){if(_n.tag===7){g(He,_n.sibling),Ne=N(_n,Xe.props.children),Ne.return=He,He=Ne;break e}}else if(_n.elementType===ln||typeof ln=="object"&&ln!==null&&ln.$$typeof===fn&&gn(ln)===_n.type){g(He,_n.sibling),Ne=N(_n,Xe.props),Ne.ref=bt(He,_n,Xe),Ne.return=He,He=Ne;break e}g(He,_n);break}else l(He,_n);_n=_n.sibling}Xe.type===Ge?(Ne=Ql(Xe.props.children,He.mode,Tt,Xe.key),Ne.return=He,He=Ne):(Tt=Xc(Xe.type,Xe.key,Xe.props,null,He.mode,Tt),Tt.ref=bt(He,Ne,Xe),Tt.return=He,He=Tt)}return te(He);case it:e:{for(_n=Xe.key;Ne!==null;){if(Ne.key===_n)if(Ne.tag===4&&Ne.stateNode.containerInfo===Xe.containerInfo&&Ne.stateNode.implementation===Xe.implementation){g(He,Ne.sibling),Ne=N(Ne,Xe.children||[]),Ne.return=He,He=Ne;break e}else{g(He,Ne);break}else l(He,Ne);Ne=Ne.sibling}Ne=Vo(Xe,He.mode,Tt),Ne.return=He,He=Ne}return te(He);case fn:return _n=Xe._init,tr(He,Ne,_n(Xe._payload),Tt)}if(ai(Xe))return $t(He,Ne,Xe,Tt);if(Ft(Xe))return nn(He,Ne,Xe,Tt);Ut(He,Xe)}return typeof Xe=="string"&&Xe!==""||typeof Xe=="number"?(Xe=""+Xe,Ne!==null&&Ne.tag===6?(g(He,Ne.sibling),Ne=N(Ne,Xe),Ne.return=He,He=Ne):(g(He,Ne),Ne=Va(Xe,He.mode,Tt),Ne.return=He,He=Ne),te(He)):g(He,Ne)}return tr}var Ct=It(!0),mn=It(!1),li=zo(null),En=null,Pn=null,ci=null;function wr(){ci=Pn=En=null}function bs(a){var l=li.current;yi(li),a._currentValue=l}function hi(a,l,g){for(;a!==null;){var E=a.alternate;if((a.childLanes&l)!==l?(a.childLanes|=l,E!==null&&(E.childLanes|=l)):E!==null&&(E.childLanes&l)!==l&&(E.childLanes|=l),a===g)break;a=a.return}}function or(a,l){En=a,ci=Pn=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&l)!==0&&(Is=!0),a.firstContext=null)}function wi(a){var l=a._currentValue;if(ci!==a)if(a={context:a,memoizedValue:l,next:null},Pn===null){if(En===null)throw Error(k(308));Pn=a,En.dependencies={lanes:0,firstContext:a}}else Pn=Pn.next=a;return l}var $i=null;function Pr(a){$i===null?$i=[a]:$i.push(a)}function ga(a,l,g,E){var N=l.interleaved;return N===null?(g.next=g,Pr(l)):(g.next=N.next,N.next=g),l.interleaved=g,is(a,E)}function is(a,l){a.lanes|=l;var g=a.alternate;for(g!==null&&(g.lanes|=l),g=a,a=a.return;a!==null;)a.childLanes|=l,g=a.alternate,g!==null&&(g.childLanes|=l),g=a,a=a.return;return g.tag===3?g.stateNode:null}var ya=!1;function Fo(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ks(a,l){a=a.updateQueue,l.updateQueue===a&&(l.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function $s(a,l){return{eventTime:a,lane:l,tag:0,payload:null,callback:null,next:null}}function Ba(a,l,g){var E=a.updateQueue;if(E===null)return null;if(E=E.shared,(ni&2)!==0){var N=E.pending;return N===null?l.next=l:(l.next=N.next,N.next=l),E.pending=l,is(a,g)}return N=E.interleaved,N===null?(l.next=l,Pr(E)):(l.next=N.next,N.next=l),E.interleaved=l,is(a,g)}function Wr(a,l,g){if(l=l.updateQueue,l!==null&&(l=l.shared,(g&4194240)!==0)){var E=l.lanes;E&=a.pendingLanes,g|=E,l.lanes=g,la(a,g)}}function Ss(a,l){var g=a.updateQueue,E=a.alternate;if(E!==null&&(E=E.updateQueue,g===E)){var N=null,j=null;if(g=g.firstBaseUpdate,g!==null){do{var te={eventTime:g.eventTime,lane:g.lane,tag:g.tag,payload:g.payload,callback:g.callback,next:null};j===null?N=j=te:j=j.next=te,g=g.next}while(g!==null);j===null?N=j=l:j=j.next=l}else N=j=l;g={baseState:E.baseState,firstBaseUpdate:N,lastBaseUpdate:j,shared:E.shared,effects:E.effects},a.updateQueue=g;return}a=g.lastBaseUpdate,a===null?g.firstBaseUpdate=l:a.next=l,g.lastBaseUpdate=l}function _a(a,l,g,E){var N=a.updateQueue;ya=!1;var j=N.firstBaseUpdate,te=N.lastBaseUpdate,xe=N.shared.pending;if(xe!==null){N.shared.pending=null;var Ce=xe,Ke=Ce.next;Ce.next=null,te===null?j=Ke:te.next=Ke,te=Ce;var gt=a.alternate;gt!==null&&(gt=gt.updateQueue,xe=gt.lastBaseUpdate,xe!==te&&(xe===null?gt.firstBaseUpdate=Ke:xe.next=Ke,gt.lastBaseUpdate=Ce))}if(j!==null){var xt=N.baseState;te=0,gt=Ke=Ce=null,xe=j;do{var pt=xe.lane,Rt=xe.eventTime;if((E&pt)===pt){gt!==null&&(gt=gt.next={eventTime:Rt,lane:0,tag:xe.tag,payload:xe.payload,callback:xe.callback,next:null});e:{var $t=a,nn=xe;switch(pt=l,Rt=g,nn.tag){case 1:if($t=nn.payload,typeof $t=="function"){xt=$t.call(Rt,xt,pt);break e}xt=$t;break e;case 3:$t.flags=$t.flags&-65537|128;case 0:if($t=nn.payload,pt=typeof $t=="function"?$t.call(Rt,xt,pt):$t,pt==null)break e;xt=et({},xt,pt);break e;case 2:ya=!0}}xe.callback!==null&&xe.lane!==0&&(a.flags|=64,pt=N.effects,pt===null?N.effects=[xe]:pt.push(xe))}else Rt={eventTime:Rt,lane:pt,tag:xe.tag,payload:xe.payload,callback:xe.callback,next:null},gt===null?(Ke=gt=Rt,Ce=xt):gt=gt.next=Rt,te|=pt;if(xe=xe.next,xe===null){if(xe=N.shared.pending,xe===null)break;pt=xe,xe=pt.next,pt.next=null,N.lastBaseUpdate=pt,N.shared.pending=null}}while(!0);if(gt===null&&(Ce=xt),N.baseState=Ce,N.firstBaseUpdate=Ke,N.lastBaseUpdate=gt,l=N.shared.interleaved,l!==null){N=l;do te|=N.lane,N=N.next;while(N!==l)}else j===null&&(N.shared.lanes=0);ku|=te,a.lanes=te,a.memoizedState=xt}}function Zs(a,l,g){if(a=l.effects,l.effects=null,a!==null)for(l=0;l<a.length;l++){var E=a[l],N=E.callback;if(N!==null){if(E.callback=null,E=g,typeof N!="function")throw Error(k(191,N));N.call(E)}}}var Xi={},Ci=zo(Xi),Mr=zo(Xi),Ln=zo(Xi);function Es(a){if(a===Xi)throw Error(k(174));return a}function Bo(a,l){switch(xi(Ln,l),xi(Mr,a),xi(Ci,Xi),a=l.nodeType,a){case 9:case 11:l=(l=l.documentElement)?l.namespaceURI:aa(null,"");break;default:a=a===8?l.parentNode:l,l=a.namespaceURI||null,a=a.tagName,l=aa(l,a)}yi(Ci),xi(Ci,l)}function va(){yi(Ci),yi(Mr),yi(Ln)}function wc(a){Es(Ln.current);var l=Es(Ci.current),g=aa(l,a.type);l!==g&&(xi(Mr,a),xi(Ci,g))}function bc(a){Mr.current===a&&(yi(Ci),yi(Mr))}var Ni=zo(0);function xa(a){for(var l=a;l!==null;){if(l.tag===13){var g=l.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||g.data==="$?"||g.data==="$!"))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var Gu=[];function Ul(){for(var a=0;a<Gu.length;a++)Gu[a]._workInProgressVersionPrimary=null;Gu.length=0}var jo=tt.ReactCurrentDispatcher,Vl=tt.ReactCurrentBatchConfig,ja=0,fi=null,Vi=null,lr=null,kc=!1,$u=!1,Sc=0,Jh=0;function br(){throw Error(k(321))}function ql(a,l){if(l===null)return!1;for(var g=0;g<l.length&&g<a.length;g++)if(!c(a[g],l[g]))return!1;return!0}function go(a,l,g,E,N,j){if(ja=j,fi=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,jo.current=a===null||a.memoizedState===null?hh:rp,a=g(E,N),$u){j=0;do{if($u=!1,Sc=0,25<=j)throw Error(k(301));j+=1,lr=Vi=null,l.updateQueue=null,jo.current=Yf,a=g(E,N)}while($u)}if(jo.current=ch,l=Vi!==null&&Vi.next!==null,ja=0,lr=Vi=fi=null,kc=!1,l)throw Error(k(300));return a}function wa(){var a=Sc!==0;return Sc=0,a}function Yr(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return lr===null?fi.memoizedState=lr=a:lr=lr.next=a,lr}function ba(){if(Vi===null){var a=fi.alternate;a=a!==null?a.memoizedState:null}else a=Vi.next;var l=lr===null?fi.memoizedState:lr.next;if(l!==null)lr=l,Vi=a;else{if(a===null)throw Error(k(310));Vi=a,a={memoizedState:Vi.memoizedState,baseState:Vi.baseState,baseQueue:Vi.baseQueue,queue:Vi.queue,next:null},lr===null?fi.memoizedState=lr=a:lr=lr.next=a}return lr}function yo(a,l){return typeof l=="function"?l(a):l}function Qh(a){var l=ba(),g=l.queue;if(g===null)throw Error(k(311));g.lastRenderedReducer=a;var E=Vi,N=E.baseQueue,j=g.pending;if(j!==null){if(N!==null){var te=N.next;N.next=j.next,j.next=te}E.baseQueue=N=j,g.pending=null}if(N!==null){j=N.next,E=E.baseState;var xe=te=null,Ce=null,Ke=j;do{var gt=Ke.lane;if((ja&gt)===gt)Ce!==null&&(Ce=Ce.next={lane:0,action:Ke.action,hasEagerState:Ke.hasEagerState,eagerState:Ke.eagerState,next:null}),E=Ke.hasEagerState?Ke.eagerState:a(E,Ke.action);else{var xt={lane:gt,action:Ke.action,hasEagerState:Ke.hasEagerState,eagerState:Ke.eagerState,next:null};Ce===null?(xe=Ce=xt,te=E):Ce=Ce.next=xt,fi.lanes|=gt,ku|=gt}Ke=Ke.next}while(Ke!==null&&Ke!==j);Ce===null?te=E:Ce.next=xe,c(E,l.memoizedState)||(Is=!0),l.memoizedState=E,l.baseState=te,l.baseQueue=Ce,g.lastRenderedState=E}if(a=g.interleaved,a!==null){N=a;do j=N.lane,fi.lanes|=j,ku|=j,N=N.next;while(N!==a)}else N===null&&(g.lanes=0);return[l.memoizedState,g.dispatch]}function sh(a){var l=ba(),g=l.queue;if(g===null)throw Error(k(311));g.lastRenderedReducer=a;var E=g.dispatch,N=g.pending,j=l.memoizedState;if(N!==null){g.pending=null;var te=N=N.next;do j=a(j,te.action),te=te.next;while(te!==N);c(j,l.memoizedState)||(Is=!0),l.memoizedState=j,l.baseQueue===null&&(l.baseState=j),g.lastRenderedState=j}return[j,E]}function Wi(){}function ah(a,l){var g=fi,E=ba(),N=l(),j=!c(E.memoizedState,N);if(j&&(E.memoizedState=N,Is=!0),E=E.queue,Tc($l.bind(null,g,E,a),[a]),E.getSnapshot!==l||j||lr!==null&&lr.memoizedState.tag&1){if(g.flags|=2048,Ic(9,Gl.bind(null,g,E,N,l),void 0,null),Ar===null)throw Error(k(349));(ja&30)!==0||ef(g,l,N)}return N}function ef(a,l,g){a.flags|=16384,a={getSnapshot:l,value:g},l=fi.updateQueue,l===null?(l={lastEffect:null,stores:null},fi.updateQueue=l,l.stores=[a]):(g=l.stores,g===null?l.stores=[a]:g.push(a))}function Gl(a,l,g,E){l.value=g,l.getSnapshot=E,Ec(l)&&oh(a)}function $l(a,l,g){return g(function(){Ec(l)&&oh(a)})}function Ec(a){var l=a.getSnapshot;a=a.value;try{var g=l();return!c(a,g)}catch{return!0}}function oh(a){var l=is(a,1);l!==null&&vo(l,a,1,-1)}function tf(a){var l=Yr();return typeof a=="function"&&(a=a()),l.memoizedState=l.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:yo,lastRenderedState:a},l.queue=a,a=a.dispatch=Hu.bind(null,fi,a),[l.memoizedState,a]}function Ic(a,l,g,E){return a={tag:a,create:l,destroy:g,deps:E,next:null},l=fi.updateQueue,l===null?(l={lastEffect:null,stores:null},fi.updateQueue=l,l.lastEffect=a.next=a):(g=l.lastEffect,g===null?l.lastEffect=a.next=a:(E=g.next,g.next=a,a.next=E,l.lastEffect=a)),a}function nf(){return ba().memoizedState}function lh(a,l,g,E){var N=Yr();fi.flags|=a,N.memoizedState=Ic(1|l,g,void 0,E===void 0?null:E)}function Zu(a,l,g,E){var N=ba();E=E===void 0?null:E;var j=void 0;if(Vi!==null){var te=Vi.memoizedState;if(j=te.destroy,E!==null&&ql(E,te.deps)){N.memoizedState=Ic(l,g,j,E);return}}fi.flags|=a,N.memoizedState=Ic(1|l,g,j,E)}function Zf(a,l){return lh(8390656,8,a,l)}function Tc(a,l){return Zu(2048,8,a,l)}function rf(a,l){return Zu(4,2,a,l)}function sf(a,l){return Zu(4,4,a,l)}function _u(a,l){if(typeof l=="function")return a=a(),l(a),function(){l(null)};if(l!=null)return a=a(),l.current=a,function(){l.current=null}}function Hf(a,l,g){return g=g!=null?g.concat([a]):null,Zu(4,4,_u.bind(null,l,a),g)}function vu(){}function Cc(a,l){var g=ba();l=l===void 0?null:l;var E=g.memoizedState;return E!==null&&l!==null&&ql(l,E[1])?E[0]:(g.memoizedState=[a,l],a)}function Pc(a,l){var g=ba();l=l===void 0?null:l;var E=g.memoizedState;return E!==null&&l!==null&&ql(l,E[1])?E[0]:(a=a(),g.memoizedState=[a,l],a)}function af(a,l,g){return(ja&21)===0?(a.baseState&&(a.baseState=!1,Is=!0),a.memoizedState=g):(c(g,l)||(g=oa(),fi.lanes|=g,ku|=g,a.baseState=!0),l)}function Xf(a,l){var g=qn;qn=g!==0&&4>g?g:4,a(!0);var E=Vl.transition;Vl.transition={};try{a(!1),l()}finally{qn=g,Vl.transition=E}}function Wf(){return ba().memoizedState}function rs(a,l,g){var E=Kl(a);if(g={lane:E,action:g,hasEagerState:!1,eagerState:null,next:null},uh(a))of(l,g);else if(g=ga(a,l,g,E),g!==null){var N=Ts();vo(g,a,E,N),Xu(g,l,E)}}function Hu(a,l,g){var E=Kl(a),N={lane:E,action:g,hasEagerState:!1,eagerState:null,next:null};if(uh(a))of(l,N);else{var j=a.alternate;if(a.lanes===0&&(j===null||j.lanes===0)&&(j=l.lastRenderedReducer,j!==null))try{var te=l.lastRenderedState,xe=j(te,g);if(N.hasEagerState=!0,N.eagerState=xe,c(xe,te)){var Ce=l.interleaved;Ce===null?(N.next=N,Pr(l)):(N.next=Ce.next,Ce.next=N),l.interleaved=N;return}}catch{}g=ga(a,l,N,E),g!==null&&(N=Ts(),vo(g,a,E,N),Xu(g,l,E))}}function uh(a){var l=a.alternate;return a===fi||l!==null&&l===fi}function of(a,l){$u=kc=!0;var g=a.pending;g===null?l.next=l:(l.next=g.next,g.next=l),a.pending=l}function Xu(a,l,g){if((g&4194240)!==0){var E=l.lanes;E&=a.pendingLanes,g|=E,l.lanes=g,la(a,g)}}var ch={readContext:wi,useCallback:br,useContext:br,useEffect:br,useImperativeHandle:br,useInsertionEffect:br,useLayoutEffect:br,useMemo:br,useReducer:br,useRef:br,useState:br,useDebugValue:br,useDeferredValue:br,useTransition:br,useMutableSource:br,useSyncExternalStore:br,useId:br,unstable_isNewReconciler:!1},hh={readContext:wi,useCallback:function(a,l){return Yr().memoizedState=[a,l===void 0?null:l],a},useContext:wi,useEffect:Zf,useImperativeHandle:function(a,l,g){return g=g!=null?g.concat([a]):null,lh(4194308,4,_u.bind(null,l,a),g)},useLayoutEffect:function(a,l){return lh(4194308,4,a,l)},useInsertionEffect:function(a,l){return lh(4,2,a,l)},useMemo:function(a,l){var g=Yr();return l=l===void 0?null:l,a=a(),g.memoizedState=[a,l],a},useReducer:function(a,l,g){var E=Yr();return l=g!==void 0?g(l):l,E.memoizedState=E.baseState=l,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:l},E.queue=a,a=a.dispatch=rs.bind(null,fi,a),[E.memoizedState,a]},useRef:function(a){var l=Yr();return a={current:a},l.memoizedState=a},useState:tf,useDebugValue:vu,useDeferredValue:function(a){return Yr().memoizedState=a},useTransition:function(){var a=tf(!1),l=a[0];return a=Xf.bind(null,a[1]),Yr().memoizedState=a,[l,a]},useMutableSource:function(){},useSyncExternalStore:function(a,l,g){var E=fi,N=Yr();if(ge){if(g===void 0)throw Error(k(407));g=g()}else{if(g=l(),Ar===null)throw Error(k(349));(ja&30)!==0||ef(E,l,g)}N.memoizedState=g;var j={value:g,getSnapshot:l};return N.queue=j,Zf($l.bind(null,E,j,a),[a]),E.flags|=2048,Ic(9,Gl.bind(null,E,j,g,l),void 0,null),g},useId:function(){var a=Yr(),l=Ar.identifierPrefix;if(ge){var g=U,E=D;g=(E&~(1<<32-Xn(E)-1)).toString(32)+g,l=":"+l+"R"+g,g=Sc++,0<g&&(l+="H"+g.toString(32)),l+=":"}else g=Jh++,l=":"+l+"r"+g.toString(32)+":";return a.memoizedState=l},unstable_isNewReconciler:!1},rp={readContext:wi,useCallback:Cc,useContext:wi,useEffect:Tc,useImperativeHandle:Hf,useInsertionEffect:rf,useLayoutEffect:sf,useMemo:Pc,useReducer:Qh,useRef:nf,useState:function(){return Qh(yo)},useDebugValue:vu,useDeferredValue:function(a){var l=ba();return af(l,Vi.memoizedState,a)},useTransition:function(){var a=Qh(yo)[0],l=ba().memoizedState;return[a,l]},useMutableSource:Wi,useSyncExternalStore:ah,useId:Wf,unstable_isNewReconciler:!1},Yf={readContext:wi,useCallback:Cc,useContext:wi,useEffect:Tc,useImperativeHandle:Hf,useInsertionEffect:rf,useLayoutEffect:sf,useMemo:Pc,useReducer:sh,useRef:nf,useState:function(){return sh(yo)},useDebugValue:vu,useDeferredValue:function(a){var l=ba();return Vi===null?l.memoizedState=a:af(l,Vi.memoizedState,a)},useTransition:function(){var a=sh(yo)[0],l=ba().memoizedState;return[a,l]},useMutableSource:Wi,useSyncExternalStore:ah,useId:Wf,unstable_isNewReconciler:!1};function Ua(a,l){if(a&&a.defaultProps){l=et({},l),a=a.defaultProps;for(var g in a)l[g]===void 0&&(l[g]=a[g]);return l}return l}function fh(a,l,g,E){l=a.memoizedState,g=g(E,l),g=g==null?l:et({},l,g),a.memoizedState=g,a.lanes===0&&(a.updateQueue.baseState=g)}var dh={isMounted:function(a){return(a=a._reactInternals)?Sn(a)===a:!1},enqueueSetState:function(a,l,g){a=a._reactInternals;var E=Ts(),N=Kl(a),j=$s(E,N);j.payload=l,g!=null&&(j.callback=g),l=Ba(a,j,N),l!==null&&(vo(l,a,N,E),Wr(l,a,N))},enqueueReplaceState:function(a,l,g){a=a._reactInternals;var E=Ts(),N=Kl(a),j=$s(E,N);j.tag=1,j.payload=l,g!=null&&(j.callback=g),l=Ba(a,j,N),l!==null&&(vo(l,a,N,E),Wr(l,a,N))},enqueueForceUpdate:function(a,l){a=a._reactInternals;var g=Ts(),E=Kl(a),N=$s(g,E);N.tag=2,l!=null&&(N.callback=l),l=Ba(a,N,E),l!==null&&(vo(l,a,E,g),Wr(l,a,E))}};function ph(a,l,g,E,N,j,te){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(E,j,te):l.prototype&&l.prototype.isPureReactComponent?!w(g,E)||!w(N,j):!0}function lf(a,l,g){var E=!1,N=Oo,j=l.contextType;return typeof j=="object"&&j!==null?j=wi(j):(N=Cr(l)?Gs:ui.current,E=l.contextTypes,j=(E=E!=null)?mo(a,N):Oo),l=new l(g,j),a.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=dh,a.stateNode=l,l._reactInternals=a,E&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=N,a.__reactInternalMemoizedMaskedChildContext=j),l}function mh(a,l,g,E){a=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(g,E),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(g,E),l.state!==a&&dh.enqueueReplaceState(l,l.state,null)}function xu(a,l,g,E){var N=a.stateNode;N.props=g,N.state=a.memoizedState,N.refs={},Fo(a);var j=l.contextType;typeof j=="object"&&j!==null?N.context=wi(j):(j=Cr(l)?Gs:ui.current,N.context=mo(a,j)),N.state=a.memoizedState,j=l.getDerivedStateFromProps,typeof j=="function"&&(fh(a,l,j,g),N.state=a.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof N.getSnapshotBeforeUpdate=="function"||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||(l=N.state,typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount(),l!==N.state&&dh.enqueueReplaceState(N,N.state,null),_a(a,g,N,E),N.state=a.memoizedState),typeof N.componentDidMount=="function"&&(a.flags|=4194308)}function Or(a,l){try{var g="",E=l;do g+=yn(E),E=E.return;while(E);var N=g}catch(j){N=`
Error generating stack: `+j.message+`
`+j.stack}return{value:a,source:l,stack:N,digest:null}}function gh(a,l,g){return{value:a,source:null,stack:g??null,digest:l??null}}function Mc(a,l){try{console.error(l.value)}catch(g){setTimeout(function(){throw g})}}var sp=typeof WeakMap=="function"?WeakMap:Map;function uf(a,l,g){g=$s(-1,g),g.tag=3,g.payload={element:null};var E=l.value;return g.callback=function(){jc||(jc=!0,Th=E),Mc(a,l)},g}function Kf(a,l,g){g=$s(-1,g),g.tag=3;var E=a.type.getDerivedStateFromError;if(typeof E=="function"){var N=l.value;g.payload=function(){return E(N)},g.callback=function(){Mc(a,l)}}var j=a.stateNode;return j!==null&&typeof j.componentDidCatch=="function"&&(g.callback=function(){Mc(a,l),typeof E!="function"&&($n===null?$n=new Set([this]):$n.add(this));var te=l.stack;this.componentDidCatch(l.value,{componentStack:te!==null?te:""})}),g}function Jf(a,l,g){var E=a.pingCache;if(E===null){E=a.pingCache=new sp;var N=new Set;E.set(l,N)}else N=E.get(l),N===void 0&&(N=new Set,E.set(l,N));N.has(g)||(N.add(g),a=hp.bind(null,a,l,g),l.then(a,a))}function Qf(a){do{var l;if((l=a.tag===13)&&(l=a.memoizedState,l=l!==null?l.dehydrated!==null:!0),l)return a;a=a.return}while(a!==null);return null}function ed(a,l,g,E,N){return(a.mode&1)===0?(a===l?a.flags|=65536:(a.flags|=128,g.flags|=131072,g.flags&=-52805,g.tag===1&&(g.alternate===null?g.tag=17:(l=$s(-1,1),l.tag=2,Ba(g,l,1))),g.lanes|=1),a):(a.flags|=65536,a.lanes=N,a)}var td=tt.ReactCurrentOwner,Is=!1;function ur(a,l,g,E){l.child=a===null?mn(l,null,g,E):Ct(l,a.child,g,E)}function Wu(a,l,g,E,N){g=g.render;var j=l.ref;return or(l,N),E=go(a,l,g,E,j,N),g=wa(),a!==null&&!Is?(l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~N,ka(a,l,N)):(ge&&g&&Q(l),l.flags|=1,ur(a,l,E,N),l.child)}function nd(a,l,g,E,N){if(a===null){var j=g.type;return typeof j=="function"&&!Hc(j)&&j.defaultProps===void 0&&g.compare===null&&g.defaultProps===void 0?(l.tag=15,l.type=j,id(a,l,j,E,N)):(a=Xc(g.type,null,E,l,l.mode,N),a.ref=l.ref,a.return=l,l.child=a)}if(j=a.child,(a.lanes&N)===0){var te=j.memoizedProps;if(g=g.compare,g=g!==null?g:w,g(te,E)&&a.ref===l.ref)return ka(a,l,N)}return l.flags|=1,a=Jl(j,E),a.ref=l.ref,a.return=l,l.child=a}function id(a,l,g,E,N){if(a!==null){var j=a.memoizedProps;if(w(j,E)&&a.ref===l.ref)if(Is=!1,l.pendingProps=E=j,(a.lanes&N)!==0)(a.flags&131072)!==0&&(Is=!0);else return l.lanes=a.lanes,ka(a,l,N)}return cf(a,l,g,E,N)}function rd(a,l,g){var E=l.pendingProps,N=E.children,j=a!==null?a.memoizedState:null;if(E.mode==="hidden")if((l.mode&1)===0)l.memoizedState={baseLanes:0,cachePool:null,transitions:null},xi(Ju,os),os|=g;else{if((g&1073741824)===0)return a=j!==null?j.baseLanes|g:g,l.lanes=l.childLanes=1073741824,l.memoizedState={baseLanes:a,cachePool:null,transitions:null},l.updateQueue=null,xi(Ju,os),os|=a,null;l.memoizedState={baseLanes:0,cachePool:null,transitions:null},E=j!==null?j.baseLanes:g,xi(Ju,os),os|=E}else j!==null?(E=j.baseLanes|g,l.memoizedState=null):E=g,xi(Ju,os),os|=E;return ur(a,l,N,g),l.child}function sd(a,l){var g=l.ref;(a===null&&g!==null||a!==null&&a.ref!==g)&&(l.flags|=512,l.flags|=2097152)}function cf(a,l,g,E,N){var j=Cr(g)?Gs:ui.current;return j=mo(l,j),or(l,N),g=go(a,l,g,E,j,N),E=wa(),a!==null&&!Is?(l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~N,ka(a,l,N)):(ge&&E&&Q(l),l.flags|=1,ur(a,l,g,N),l.child)}function ad(a,l,g,E,N){if(Cr(g)){var j=!0;ws(l)}else j=!1;if(or(l,N),l.stateNode===null)Rc(a,l),lf(l,g,E),xu(l,g,E,N),E=!0;else if(a===null){var te=l.stateNode,xe=l.memoizedProps;te.props=xe;var Ce=te.context,Ke=g.contextType;typeof Ke=="object"&&Ke!==null?Ke=wi(Ke):(Ke=Cr(g)?Gs:ui.current,Ke=mo(l,Ke));var gt=g.getDerivedStateFromProps,xt=typeof gt=="function"||typeof te.getSnapshotBeforeUpdate=="function";xt||typeof te.UNSAFE_componentWillReceiveProps!="function"&&typeof te.componentWillReceiveProps!="function"||(xe!==E||Ce!==Ke)&&mh(l,te,E,Ke),ya=!1;var pt=l.memoizedState;te.state=pt,_a(l,E,te,N),Ce=l.memoizedState,xe!==E||pt!==Ce||On.current||ya?(typeof gt=="function"&&(fh(l,g,gt,E),Ce=l.memoizedState),(xe=ya||ph(l,g,xe,E,pt,Ce,Ke))?(xt||typeof te.UNSAFE_componentWillMount!="function"&&typeof te.componentWillMount!="function"||(typeof te.componentWillMount=="function"&&te.componentWillMount(),typeof te.UNSAFE_componentWillMount=="function"&&te.UNSAFE_componentWillMount()),typeof te.componentDidMount=="function"&&(l.flags|=4194308)):(typeof te.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=E,l.memoizedState=Ce),te.props=E,te.state=Ce,te.context=Ke,E=xe):(typeof te.componentDidMount=="function"&&(l.flags|=4194308),E=!1)}else{te=l.stateNode,ks(a,l),xe=l.memoizedProps,Ke=l.type===l.elementType?xe:Ua(l.type,xe),te.props=Ke,xt=l.pendingProps,pt=te.context,Ce=g.contextType,typeof Ce=="object"&&Ce!==null?Ce=wi(Ce):(Ce=Cr(g)?Gs:ui.current,Ce=mo(l,Ce));var Rt=g.getDerivedStateFromProps;(gt=typeof Rt=="function"||typeof te.getSnapshotBeforeUpdate=="function")||typeof te.UNSAFE_componentWillReceiveProps!="function"&&typeof te.componentWillReceiveProps!="function"||(xe!==xt||pt!==Ce)&&mh(l,te,E,Ce),ya=!1,pt=l.memoizedState,te.state=pt,_a(l,E,te,N);var $t=l.memoizedState;xe!==xt||pt!==$t||On.current||ya?(typeof Rt=="function"&&(fh(l,g,Rt,E),$t=l.memoizedState),(Ke=ya||ph(l,g,Ke,E,pt,$t,Ce)||!1)?(gt||typeof te.UNSAFE_componentWillUpdate!="function"&&typeof te.componentWillUpdate!="function"||(typeof te.componentWillUpdate=="function"&&te.componentWillUpdate(E,$t,Ce),typeof te.UNSAFE_componentWillUpdate=="function"&&te.UNSAFE_componentWillUpdate(E,$t,Ce)),typeof te.componentDidUpdate=="function"&&(l.flags|=4),typeof te.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof te.componentDidUpdate!="function"||xe===a.memoizedProps&&pt===a.memoizedState||(l.flags|=4),typeof te.getSnapshotBeforeUpdate!="function"||xe===a.memoizedProps&&pt===a.memoizedState||(l.flags|=1024),l.memoizedProps=E,l.memoizedState=$t),te.props=E,te.state=$t,te.context=Ce,E=Ke):(typeof te.componentDidUpdate!="function"||xe===a.memoizedProps&&pt===a.memoizedState||(l.flags|=4),typeof te.getSnapshotBeforeUpdate!="function"||xe===a.memoizedProps&&pt===a.memoizedState||(l.flags|=1024),E=!1)}return hf(a,l,g,E,j,N)}function hf(a,l,g,E,N,j){sd(a,l);var te=(l.flags&128)!==0;if(!E&&!te)return N&&Bl(l,g,!1),ka(a,l,j);E=l.stateNode,td.current=l;var xe=te&&typeof g.getDerivedStateFromError!="function"?null:E.render();return l.flags|=1,a!==null&&te?(l.child=Ct(l,a.child,null,j),l.child=Ct(l,null,xe,j)):ur(a,l,xe,j),l.memoizedState=E.state,N&&Bl(l,g,!0),l.child}function yh(a){var l=a.stateNode;l.pendingContext?Ol(a,l.pendingContext,l.pendingContext!==l.context):l.context&&Ol(a,l.context,!1),Bo(a,l.containerInfo)}function od(a,l,g,E,N){return kt(),Lt(N),l.flags|=256,ur(a,l,g,E),l.child}var Zl={dehydrated:null,treeContext:null,retryLane:0};function ff(a){return{baseLanes:a,cachePool:null,transitions:null}}function Zi(a,l,g){var E=l.pendingProps,N=Ni.current,j=!1,te=(l.flags&128)!==0,xe;if((xe=te)||(xe=a!==null&&a.memoizedState===null?!1:(N&2)!==0),xe?(j=!0,l.flags&=-129):(a===null||a.memoizedState!==null)&&(N|=1),xi(Ni,N&1),a===null)return ze(l),a=l.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((l.mode&1)===0?l.lanes=1:a.data==="$!"?l.lanes=8:l.lanes=1073741824,null):(te=E.children,a=E.fallback,j?(E=l.mode,j=l.child,te={mode:"hidden",children:te},(E&1)===0&&j!==null?(j.childLanes=0,j.pendingProps=te):j=eu(te,E,0,null),a=Ql(a,E,g,null),j.return=l,a.return=l,j.sibling=a,l.child=j,l.child.memoizedState=ff(g),l.memoizedState=Zl,a):Yu(l,te));if(N=a.memoizedState,N!==null&&(xe=N.dehydrated,xe!==null))return _h(a,l,te,E,xe,N,g);if(j){j=E.fallback,te=l.mode,N=a.child,xe=N.sibling;var Ce={mode:"hidden",children:E.children};return(te&1)===0&&l.child!==N?(E=l.child,E.childLanes=0,E.pendingProps=Ce,l.deletions=null):(E=Jl(N,Ce),E.subtreeFlags=N.subtreeFlags&14680064),xe!==null?j=Jl(xe,j):(j=Ql(j,te,g,null),j.flags|=2),j.return=l,E.return=l,E.sibling=j,l.child=E,E=j,j=l.child,te=a.child.memoizedState,te=te===null?ff(g):{baseLanes:te.baseLanes|g,cachePool:null,transitions:te.transitions},j.memoizedState=te,j.childLanes=a.childLanes&~g,l.memoizedState=Zl,E}return j=a.child,a=j.sibling,E=Jl(j,{mode:"visible",children:E.children}),(l.mode&1)===0&&(E.lanes=g),E.return=l,E.sibling=null,a!==null&&(g=l.deletions,g===null?(l.deletions=[a],l.flags|=16):g.push(a)),l.child=E,l.memoizedState=null,E}function Yu(a,l){return l=eu({mode:"visible",children:l},a.mode,0,null),l.return=a,a.child=l}function Ac(a,l,g,E){return E!==null&&Lt(E),Ct(l,a.child,null,g),a=Yu(l,l.pendingProps.children),a.flags|=2,l.memoizedState=null,a}function _h(a,l,g,E,N,j,te){if(g)return l.flags&256?(l.flags&=-257,E=gh(Error(k(422))),Ac(a,l,te,E)):l.memoizedState!==null?(l.child=a.child,l.flags|=128,null):(j=E.fallback,N=l.mode,E=eu({mode:"visible",children:E.children},N,0,null),j=Ql(j,N,te,null),j.flags|=2,E.return=l,j.return=l,E.sibling=j,l.child=E,(l.mode&1)!==0&&Ct(l,a.child,null,te),l.child.memoizedState=ff(te),l.memoizedState=Zl,j);if((l.mode&1)===0)return Ac(a,l,te,null);if(N.data==="$!"){if(E=N.nextSibling&&N.nextSibling.dataset,E)var xe=E.dgst;return E=xe,j=Error(k(419)),E=gh(j,E,void 0),Ac(a,l,te,E)}if(xe=(te&a.childLanes)!==0,Is||xe){if(E=Ar,E!==null){switch(te&-te){case 4:N=2;break;case 16:N=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:N=32;break;case 536870912:N=268435456;break;default:N=0}N=(N&(E.suspendedLanes|te))!==0?0:N,N!==0&&N!==j.retryLane&&(j.retryLane=N,is(a,N),vo(E,a,N,-1))}return Mh(),E=gh(Error(k(421))),Ac(a,l,te,E)}return N.data==="$?"?(l.flags|=128,l.child=a.child,l=kd.bind(null,a),N._reactRetry=l,null):(a=j.treeContext,pe=da(N.nextSibling),he=l,ge=!0,ve=null,a!==null&&(y[T++]=D,y[T++]=U,y[T++]=A,D=a.id,U=a.overflow,A=l),l=Yu(l,E.children),l.flags|=4096,l)}function Lc(a,l,g){a.lanes|=l;var E=a.alternate;E!==null&&(E.lanes|=l),hi(a.return,l,g)}function wu(a,l,g,E,N){var j=a.memoizedState;j===null?a.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:E,tail:g,tailMode:N}:(j.isBackwards=l,j.rendering=null,j.renderingStartTime=0,j.last=E,j.tail=g,j.tailMode=N)}function df(a,l,g){var E=l.pendingProps,N=E.revealOrder,j=E.tail;if(ur(a,l,E.children,g),E=Ni.current,(E&2)!==0)E=E&1|2,l.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=l.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Lc(a,g,l);else if(a.tag===19)Lc(a,g,l);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}E&=1}if(xi(Ni,E),(l.mode&1)===0)l.memoizedState=null;else switch(N){case"forwards":for(g=l.child,N=null;g!==null;)a=g.alternate,a!==null&&xa(a)===null&&(N=g),g=g.sibling;g=N,g===null?(N=l.child,l.child=null):(N=g.sibling,g.sibling=null),wu(l,!1,N,g,j);break;case"backwards":for(g=null,N=l.child,l.child=null;N!==null;){if(a=N.alternate,a!==null&&xa(a)===null){l.child=N;break}a=N.sibling,N.sibling=g,g=N,N=a}wu(l,!0,g,null,j);break;case"together":wu(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function Rc(a,l){(l.mode&1)===0&&a!==null&&(a.alternate=null,l.alternate=null,l.flags|=2)}function ka(a,l,g){if(a!==null&&(l.dependencies=a.dependencies),ku|=l.lanes,(g&l.childLanes)===0)return null;if(a!==null&&l.child!==a.child)throw Error(k(153));if(l.child!==null){for(a=l.child,g=Jl(a,a.pendingProps),l.child=g,g.return=l;a.sibling!==null;)a=a.sibling,g=g.sibling=Jl(a,a.pendingProps),g.return=l;g.sibling=null}return l.child}function pf(a,l,g){switch(l.tag){case 3:yh(l),kt();break;case 5:wc(l);break;case 1:Cr(l.type)&&ws(l);break;case 4:Bo(l,l.stateNode.containerInfo);break;case 10:var E=l.type._context,N=l.memoizedProps.value;xi(li,E._currentValue),E._currentValue=N;break;case 13:if(E=l.memoizedState,E!==null)return E.dehydrated!==null?(xi(Ni,Ni.current&1),l.flags|=128,null):(g&l.child.childLanes)!==0?Zi(a,l,g):(xi(Ni,Ni.current&1),a=ka(a,l,g),a!==null?a.sibling:null);xi(Ni,Ni.current&1);break;case 19:if(E=(g&l.childLanes)!==0,(a.flags&128)!==0){if(E)return df(a,l,g);l.flags|=128}if(N=l.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),xi(Ni,Ni.current),E)break;return null;case 22:case 23:return l.lanes=0,rd(a,l,g)}return ka(a,l,g)}var vh,Nc,xh,mf;vh=function(a,l){for(var g=l.child;g!==null;){if(g.tag===5||g.tag===6)a.appendChild(g.stateNode);else if(g.tag!==4&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===l)break;for(;g.sibling===null;){if(g.return===null||g.return===l)return;g=g.return}g.sibling.return=g.return,g=g.sibling}},Nc=function(){},xh=function(a,l,g,E){var N=a.memoizedProps;if(N!==E){a=l.stateNode,Es(Ci.current);var j=null;switch(g){case"input":N=Ur(a,N),E=Ur(a,E),j=[];break;case"select":N=et({},N,{value:void 0}),E=et({},E,{value:void 0}),j=[];break;case"textarea":N=pr(a,N),E=pr(a,E),j=[];break;default:typeof N.onClick!="function"&&typeof E.onClick=="function"&&(a.onclick=ns)}mr(g,E);var te;g=null;for(Ke in N)if(!E.hasOwnProperty(Ke)&&N.hasOwnProperty(Ke)&&N[Ke]!=null)if(Ke==="style"){var xe=N[Ke];for(te in xe)xe.hasOwnProperty(te)&&(g||(g={}),g[te]="")}else Ke!=="dangerouslySetInnerHTML"&&Ke!=="children"&&Ke!=="suppressContentEditableWarning"&&Ke!=="suppressHydrationWarning"&&Ke!=="autoFocus"&&(C.hasOwnProperty(Ke)?j||(j=[]):(j=j||[]).push(Ke,null));for(Ke in E){var Ce=E[Ke];if(xe=N?.[Ke],E.hasOwnProperty(Ke)&&Ce!==xe&&(Ce!=null||xe!=null))if(Ke==="style")if(xe){for(te in xe)!xe.hasOwnProperty(te)||Ce&&Ce.hasOwnProperty(te)||(g||(g={}),g[te]="");for(te in Ce)Ce.hasOwnProperty(te)&&xe[te]!==Ce[te]&&(g||(g={}),g[te]=Ce[te])}else g||(j||(j=[]),j.push(Ke,g)),g=Ce;else Ke==="dangerouslySetInnerHTML"?(Ce=Ce?Ce.__html:void 0,xe=xe?xe.__html:void 0,Ce!=null&&xe!==Ce&&(j=j||[]).push(Ke,Ce)):Ke==="children"?typeof Ce!="string"&&typeof Ce!="number"||(j=j||[]).push(Ke,""+Ce):Ke!=="suppressContentEditableWarning"&&Ke!=="suppressHydrationWarning"&&(C.hasOwnProperty(Ke)?(Ce!=null&&Ke==="onScroll"&&gi("scroll",a),j||xe===Ce||(j=[])):(j=j||[]).push(Ke,Ce))}g&&(j=j||[]).push("style",g);var Ke=j;(l.updateQueue=Ke)&&(l.flags|=4)}},mf=function(a,l,g,E){g!==E&&(l.flags|=4)};function Ku(a,l){if(!ge)switch(a.tailMode){case"hidden":l=a.tail;for(var g=null;l!==null;)l.alternate!==null&&(g=l),l=l.sibling;g===null?a.tail=null:g.sibling=null;break;case"collapsed":g=a.tail;for(var E=null;g!==null;)g.alternate!==null&&(E=g),g=g.sibling;E===null?l||a.tail===null?a.tail=null:a.tail.sibling=null:E.sibling=null}}function ss(a){var l=a.alternate!==null&&a.alternate.child===a.child,g=0,E=0;if(l)for(var N=a.child;N!==null;)g|=N.lanes|N.childLanes,E|=N.subtreeFlags&14680064,E|=N.flags&14680064,N.return=a,N=N.sibling;else for(N=a.child;N!==null;)g|=N.lanes|N.childLanes,E|=N.subtreeFlags,E|=N.flags,N.return=a,N=N.sibling;return a.subtreeFlags|=E,a.childLanes=g,l}function ap(a,l,g){var E=l.pendingProps;switch(oe(l),l.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ss(l),null;case 1:return Cr(l.type)&&gu(),ss(l),null;case 3:return E=l.stateNode,va(),yi(On),yi(ui),Ul(),E.pendingContext&&(E.context=E.pendingContext,E.pendingContext=null),(a===null||a.child===null)&&(at(l)?l.flags|=4:a===null||a.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,ve!==null&&(vf(ve),ve=null))),Nc(a,l),ss(l),null;case 5:bc(l);var N=Es(Ln.current);if(g=l.type,a!==null&&l.stateNode!=null)xh(a,l,g,E,N),a.ref!==l.ref&&(l.flags|=512,l.flags|=2097152);else{if(!E){if(l.stateNode===null)throw Error(k(166));return ss(l),null}if(a=Es(Ci.current),at(l)){E=l.stateNode,g=l.type;var j=l.memoizedProps;switch(E[Xr]=l,E[Fa]=j,a=(l.mode&1)!==0,g){case"dialog":gi("cancel",E),gi("close",E);break;case"iframe":case"object":case"embed":gi("load",E);break;case"video":case"audio":for(N=0;N<Do.length;N++)gi(Do[N],E);break;case"source":gi("error",E);break;case"img":case"image":case"link":gi("error",E),gi("load",E);break;case"details":gi("toggle",E);break;case"input":Rr(E,j),gi("invalid",E);break;case"select":E._wrapperState={wasMultiple:!!j.multiple},gi("invalid",E);break;case"textarea":As(E,j),gi("invalid",E)}mr(g,j),N=null;for(var te in j)if(j.hasOwnProperty(te)){var xe=j[te];te==="children"?typeof xe=="string"?E.textContent!==xe&&(j.suppressHydrationWarning!==!0&&Dl(E.textContent,xe,a),N=["children",xe]):typeof xe=="number"&&E.textContent!==""+xe&&(j.suppressHydrationWarning!==!0&&Dl(E.textContent,xe,a),N=["children",""+xe]):C.hasOwnProperty(te)&&xe!=null&&te==="onScroll"&&gi("scroll",E)}switch(g){case"input":Wt(E),To(E,j,!0);break;case"textarea":Wt(E),ir(E);break;case"select":case"option":break;default:typeof j.onClick=="function"&&(E.onclick=ns)}E=N,l.updateQueue=E,E!==null&&(l.flags|=4)}else{te=N.nodeType===9?N:N.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=sa(g)),a==="http://www.w3.org/1999/xhtml"?g==="script"?(a=te.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof E.is=="string"?a=te.createElement(g,{is:E.is}):(a=te.createElement(g),g==="select"&&(te=a,E.multiple?te.multiple=!0:E.size&&(te.size=E.size))):a=te.createElementNS(a,g),a[Xr]=l,a[Fa]=E,vh(a,l,!1,!1),l.stateNode=a;e:{switch(te=qr(g,E),g){case"dialog":gi("cancel",a),gi("close",a),N=E;break;case"iframe":case"object":case"embed":gi("load",a),N=E;break;case"video":case"audio":for(N=0;N<Do.length;N++)gi(Do[N],a);N=E;break;case"source":gi("error",a),N=E;break;case"img":case"image":case"link":gi("error",a),gi("load",a),N=E;break;case"details":gi("toggle",a),N=E;break;case"input":Rr(a,E),N=Ur(a,E),gi("invalid",a);break;case"option":N=E;break;case"select":a._wrapperState={wasMultiple:!!E.multiple},N=et({},E,{value:void 0}),gi("invalid",a);break;case"textarea":As(a,E),N=pr(a,E),gi("invalid",a);break;default:N=E}mr(g,N),xe=N;for(j in xe)if(xe.hasOwnProperty(j)){var Ce=xe[j];j==="style"?In(a,Ce):j==="dangerouslySetInnerHTML"?(Ce=Ce?Ce.__html:void 0,Ce!=null&&Vr(a,Ce)):j==="children"?typeof Ce=="string"?(g!=="textarea"||Ce!=="")&&dn(a,Ce):typeof Ce=="number"&&dn(a,""+Ce):j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&j!=="autoFocus"&&(C.hasOwnProperty(j)?Ce!=null&&j==="onScroll"&&gi("scroll",a):Ce!=null&&qe(a,j,Ce,te))}switch(g){case"input":Wt(a),To(a,E,!1);break;case"textarea":Wt(a),ir(a);break;case"option":E.value!=null&&a.setAttribute("value",""+Re(E.value));break;case"select":a.multiple=!!E.multiple,j=E.value,j!=null?ps(a,!!E.multiple,j,!1):E.defaultValue!=null&&ps(a,!!E.multiple,E.defaultValue,!0);break;default:typeof N.onClick=="function"&&(a.onclick=ns)}switch(g){case"button":case"input":case"select":case"textarea":E=!!E.autoFocus;break e;case"img":E=!0;break e;default:E=!1}}E&&(l.flags|=4)}l.ref!==null&&(l.flags|=512,l.flags|=2097152)}return ss(l),null;case 6:if(a&&l.stateNode!=null)mf(a,l,a.memoizedProps,E);else{if(typeof E!="string"&&l.stateNode===null)throw Error(k(166));if(g=Es(Ln.current),Es(Ci.current),at(l)){if(E=l.stateNode,g=l.memoizedProps,E[Xr]=l,(j=E.nodeValue!==g)&&(a=he,a!==null))switch(a.tag){case 3:Dl(E.nodeValue,g,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&Dl(E.nodeValue,g,(a.mode&1)!==0)}j&&(l.flags|=4)}else E=(g.nodeType===9?g:g.ownerDocument).createTextNode(E),E[Xr]=l,l.stateNode=E}return ss(l),null;case 13:if(yi(Ni),E=l.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(ge&&pe!==null&&(l.mode&1)!==0&&(l.flags&128)===0)yt(),kt(),l.flags|=98560,j=!1;else if(j=at(l),E!==null&&E.dehydrated!==null){if(a===null){if(!j)throw Error(k(318));if(j=l.memoizedState,j=j!==null?j.dehydrated:null,!j)throw Error(k(317));j[Xr]=l}else kt(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;ss(l),j=!1}else ve!==null&&(vf(ve),ve=null),j=!0;if(!j)return l.flags&65536?l:null}return(l.flags&128)!==0?(l.lanes=g,l):(E=E!==null,E!==(a!==null&&a.memoizedState!==null)&&E&&(l.child.flags|=8192,(l.mode&1)!==0&&(a===null||(Ni.current&1)!==0?kr===0&&(kr=3):Mh())),l.updateQueue!==null&&(l.flags|=4),ss(l),null);case 4:return va(),Nc(a,l),a===null&&co(l.stateNode.containerInfo),ss(l),null;case 10:return bs(l.type._context),ss(l),null;case 17:return Cr(l.type)&&gu(),ss(l),null;case 19:if(yi(Ni),j=l.memoizedState,j===null)return ss(l),null;if(E=(l.flags&128)!==0,te=j.rendering,te===null)if(E)Ku(j,!1);else{if(kr!==0||a!==null&&(a.flags&128)!==0)for(a=l.child;a!==null;){if(te=xa(a),te!==null){for(l.flags|=128,Ku(j,!1),E=te.updateQueue,E!==null&&(l.updateQueue=E,l.flags|=4),l.subtreeFlags=0,E=g,g=l.child;g!==null;)j=g,a=E,j.flags&=14680066,te=j.alternate,te===null?(j.childLanes=0,j.lanes=a,j.child=null,j.subtreeFlags=0,j.memoizedProps=null,j.memoizedState=null,j.updateQueue=null,j.dependencies=null,j.stateNode=null):(j.childLanes=te.childLanes,j.lanes=te.lanes,j.child=te.child,j.subtreeFlags=0,j.deletions=null,j.memoizedProps=te.memoizedProps,j.memoizedState=te.memoizedState,j.updateQueue=te.updateQueue,j.type=te.type,a=te.dependencies,j.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),g=g.sibling;return xi(Ni,Ni.current&1|2),l.child}a=a.sibling}j.tail!==null&&hn()>Di&&(l.flags|=128,E=!0,Ku(j,!1),l.lanes=4194304)}else{if(!E)if(a=xa(te),a!==null){if(l.flags|=128,E=!0,g=a.updateQueue,g!==null&&(l.updateQueue=g,l.flags|=4),Ku(j,!0),j.tail===null&&j.tailMode==="hidden"&&!te.alternate&&!ge)return ss(l),null}else 2*hn()-j.renderingStartTime>Di&&g!==1073741824&&(l.flags|=128,E=!0,Ku(j,!1),l.lanes=4194304);j.isBackwards?(te.sibling=l.child,l.child=te):(g=j.last,g!==null?g.sibling=te:l.child=te,j.last=te)}return j.tail!==null?(l=j.tail,j.rendering=l,j.tail=l.sibling,j.renderingStartTime=hn(),l.sibling=null,g=Ni.current,xi(Ni,E?g&1|2:g&1),l):(ss(l),null);case 22:case 23:return qc(),E=l.memoizedState!==null,a!==null&&a.memoizedState!==null!==E&&(l.flags|=8192),E&&(l.mode&1)!==0?(os&1073741824)!==0&&(ss(l),l.subtreeFlags&6&&(l.flags|=8192)):ss(l),null;case 24:return null;case 25:return null}throw Error(k(156,l.tag))}function op(a,l){switch(oe(l),l.tag){case 1:return Cr(l.type)&&gu(),a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 3:return va(),yi(On),yi(ui),Ul(),a=l.flags,(a&65536)!==0&&(a&128)===0?(l.flags=a&-65537|128,l):null;case 5:return bc(l),null;case 13:if(yi(Ni),a=l.memoizedState,a!==null&&a.dehydrated!==null){if(l.alternate===null)throw Error(k(340));kt()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 19:return yi(Ni),null;case 4:return va(),null;case 10:return bs(l.type._context),null;case 22:case 23:return qc(),null;case 24:return null;default:return null}}var wh=!1,as=!1,Hl=typeof WeakSet=="function"?WeakSet:Set,Yt=null;function bu(a,l){var g=a.ref;if(g!==null)if(typeof g=="function")try{g(null)}catch(E){qi(a,l,E)}else g.current=null}function Xl(a,l,g){try{g()}catch(E){qi(a,l,E)}}var ld=!1;function lp(a,l){if(fo=Ra,a=re(),fe(a)){if("selectionStart"in a)var g={start:a.selectionStart,end:a.selectionEnd};else e:{g=(g=a.ownerDocument)&&g.defaultView||window;var E=g.getSelection&&g.getSelection();if(E&&E.rangeCount!==0){g=E.anchorNode;var N=E.anchorOffset,j=E.focusNode;E=E.focusOffset;try{g.nodeType,j.nodeType}catch{g=null;break e}var te=0,xe=-1,Ce=-1,Ke=0,gt=0,xt=a,pt=null;t:for(;;){for(var Rt;xt!==g||N!==0&&xt.nodeType!==3||(xe=te+N),xt!==j||E!==0&&xt.nodeType!==3||(Ce=te+E),xt.nodeType===3&&(te+=xt.nodeValue.length),(Rt=xt.firstChild)!==null;)pt=xt,xt=Rt;for(;;){if(xt===a)break t;if(pt===g&&++Ke===N&&(xe=te),pt===j&&++gt===E&&(Ce=te),(Rt=xt.nextSibling)!==null)break;xt=pt,pt=xt.parentNode}xt=Rt}g=xe===-1||Ce===-1?null:{start:xe,end:Ce}}else g=null}g=g||{start:0,end:0}}else g=null;for(yc={focusedElem:a,selectionRange:g},Ra=!1,Yt=l;Yt!==null;)if(l=Yt,a=l.child,(l.subtreeFlags&1028)!==0&&a!==null)a.return=l,Yt=a;else for(;Yt!==null;){l=Yt;try{var $t=l.alternate;if((l.flags&1024)!==0)switch(l.tag){case 0:case 11:case 15:break;case 1:if($t!==null){var nn=$t.memoizedProps,tr=$t.memoizedState,He=l.stateNode,Ne=He.getSnapshotBeforeUpdate(l.elementType===l.type?nn:Ua(l.type,nn),tr);He.__reactInternalSnapshotBeforeUpdate=Ne}break;case 3:var Xe=l.stateNode.containerInfo;Xe.nodeType===1?Xe.textContent="":Xe.nodeType===9&&Xe.documentElement&&Xe.removeChild(Xe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(k(163))}}catch(Tt){qi(l,l.return,Tt)}if(a=l.sibling,a!==null){a.return=l.return,Yt=a;break}Yt=l.return}return $t=ld,ld=!1,$t}function Dc(a,l,g){var E=l.updateQueue;if(E=E!==null?E.lastEffect:null,E!==null){var N=E=E.next;do{if((N.tag&a)===a){var j=N.destroy;N.destroy=void 0,j!==void 0&&Xl(l,g,j)}N=N.next}while(N!==E)}}function zc(a,l){if(l=l.updateQueue,l=l!==null?l.lastEffect:null,l!==null){var g=l=l.next;do{if((g.tag&a)===a){var E=g.create;g.destroy=E()}g=g.next}while(g!==l)}}function bh(a){var l=a.ref;if(l!==null){var g=a.stateNode;a.tag,a=g,typeof l=="function"?l(a):l.current=a}}function ud(a){var l=a.alternate;l!==null&&(a.alternate=null,ud(l)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(l=a.stateNode,l!==null&&(delete l[Xr],delete l[Fa],delete l[Dn],delete l[vc],delete l[Kh])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function cd(a){return a.tag===5||a.tag===3||a.tag===4}function hd(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||cd(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function gf(a,l,g){var E=a.tag;if(E===5||E===6)a=a.stateNode,l?g.nodeType===8?g.parentNode.insertBefore(a,l):g.insertBefore(a,l):(g.nodeType===8?(l=g.parentNode,l.insertBefore(a,g)):(l=g,l.appendChild(a)),g=g._reactRootContainer,g!=null||l.onclick!==null||(l.onclick=ns));else if(E!==4&&(a=a.child,a!==null))for(gf(a,l,g),a=a.sibling;a!==null;)gf(a,l,g),a=a.sibling}function Oc(a,l,g){var E=a.tag;if(E===5||E===6)a=a.stateNode,l?g.insertBefore(a,l):g.appendChild(a);else if(E!==4&&(a=a.child,a!==null))for(Oc(a,l,g),a=a.sibling;a!==null;)Oc(a,l,g),a=a.sibling}var cr=null,Sa=!1;function Wl(a,l,g){for(g=g.child;g!==null;)fd(a,l,g),g=g.sibling}function fd(a,l,g){if(sr&&typeof sr.onCommitFiberUnmount=="function")try{sr.onCommitFiberUnmount(Fi,g)}catch{}switch(g.tag){case 5:as||bu(g,l);case 6:var E=cr,N=Sa;cr=null,Wl(a,l,g),cr=E,Sa=N,cr!==null&&(Sa?(a=cr,g=g.stateNode,a.nodeType===8?a.parentNode.removeChild(g):a.removeChild(g)):cr.removeChild(g.stateNode));break;case 18:cr!==null&&(Sa?(a=cr,g=g.stateNode,a.nodeType===8?zt(a.parentNode,g):a.nodeType===1&&zt(a,g),zs(a)):zt(cr,g.stateNode));break;case 4:E=cr,N=Sa,cr=g.stateNode.containerInfo,Sa=!0,Wl(a,l,g),cr=E,Sa=N;break;case 0:case 11:case 14:case 15:if(!as&&(E=g.updateQueue,E!==null&&(E=E.lastEffect,E!==null))){N=E=E.next;do{var j=N,te=j.destroy;j=j.tag,te!==void 0&&((j&2)!==0||(j&4)!==0)&&Xl(g,l,te),N=N.next}while(N!==E)}Wl(a,l,g);break;case 1:if(!as&&(bu(g,l),E=g.stateNode,typeof E.componentWillUnmount=="function"))try{E.props=g.memoizedProps,E.state=g.memoizedState,E.componentWillUnmount()}catch(xe){qi(g,l,xe)}Wl(a,l,g);break;case 21:Wl(a,l,g);break;case 22:g.mode&1?(as=(E=as)||g.memoizedState!==null,Wl(a,l,g),as=E):Wl(a,l,g);break;default:Wl(a,l,g)}}function yf(a){var l=a.updateQueue;if(l!==null){a.updateQueue=null;var g=a.stateNode;g===null&&(g=a.stateNode=new Hl),l.forEach(function(E){var N=Sd.bind(null,a,E);g.has(E)||(g.add(E),E.then(N,N))})}}function _o(a,l){var g=l.deletions;if(g!==null)for(var E=0;E<g.length;E++){var N=g[E];try{var j=a,te=l,xe=te;e:for(;xe!==null;){switch(xe.tag){case 5:cr=xe.stateNode,Sa=!1;break e;case 3:cr=xe.stateNode.containerInfo,Sa=!0;break e;case 4:cr=xe.stateNode.containerInfo,Sa=!0;break e}xe=xe.return}if(cr===null)throw Error(k(160));fd(j,te,N),cr=null,Sa=!1;var Ce=N.alternate;Ce!==null&&(Ce.return=null),N.return=null}catch(Ke){qi(N,l,Ke)}}if(l.subtreeFlags&12854)for(l=l.child;l!==null;)dd(l,a),l=l.sibling}function dd(a,l){var g=a.alternate,E=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(_o(l,a),Hs(a),E&4){try{Dc(3,a,a.return),zc(3,a)}catch(nn){qi(a,a.return,nn)}try{Dc(5,a,a.return)}catch(nn){qi(a,a.return,nn)}}break;case 1:_o(l,a),Hs(a),E&512&&g!==null&&bu(g,g.return);break;case 5:if(_o(l,a),Hs(a),E&512&&g!==null&&bu(g,g.return),a.flags&32){var N=a.stateNode;try{dn(N,"")}catch(nn){qi(a,a.return,nn)}}if(E&4&&(N=a.stateNode,N!=null)){var j=a.memoizedProps,te=g!==null?g.memoizedProps:j,xe=a.type,Ce=a.updateQueue;if(a.updateQueue=null,Ce!==null)try{xe==="input"&&j.type==="radio"&&j.name!=null&&We(N,j),qr(xe,te);var Ke=qr(xe,j);for(te=0;te<Ce.length;te+=2){var gt=Ce[te],xt=Ce[te+1];gt==="style"?In(N,xt):gt==="dangerouslySetInnerHTML"?Vr(N,xt):gt==="children"?dn(N,xt):qe(N,gt,xt,Ke)}switch(xe){case"input":ds(N,j);break;case"textarea":vn(N,j);break;case"select":var pt=N._wrapperState.wasMultiple;N._wrapperState.wasMultiple=!!j.multiple;var Rt=j.value;Rt!=null?ps(N,!!j.multiple,Rt,!1):pt!==!!j.multiple&&(j.defaultValue!=null?ps(N,!!j.multiple,j.defaultValue,!0):ps(N,!!j.multiple,j.multiple?[]:"",!1))}N[Fa]=j}catch(nn){qi(a,a.return,nn)}}break;case 6:if(_o(l,a),Hs(a),E&4){if(a.stateNode===null)throw Error(k(162));N=a.stateNode,j=a.memoizedProps;try{N.nodeValue=j}catch(nn){qi(a,a.return,nn)}}break;case 3:if(_o(l,a),Hs(a),E&4&&g!==null&&g.memoizedState.isDehydrated)try{zs(l.containerInfo)}catch(nn){qi(a,a.return,nn)}break;case 4:_o(l,a),Hs(a);break;case 13:_o(l,a),Hs(a),N=a.child,N.flags&8192&&(j=N.memoizedState!==null,N.stateNode.isHidden=j,!j||N.alternate!==null&&N.alternate.memoizedState!==null||(Su=hn())),E&4&&yf(a);break;case 22:if(gt=g!==null&&g.memoizedState!==null,a.mode&1?(as=(Ke=as)||gt,_o(l,a),as=Ke):_o(l,a),Hs(a),E&8192){if(Ke=a.memoizedState!==null,(a.stateNode.isHidden=Ke)&&!gt&&(a.mode&1)!==0)for(Yt=a,gt=a.child;gt!==null;){for(xt=Yt=gt;Yt!==null;){switch(pt=Yt,Rt=pt.child,pt.tag){case 0:case 11:case 14:case 15:Dc(4,pt,pt.return);break;case 1:bu(pt,pt.return);var $t=pt.stateNode;if(typeof $t.componentWillUnmount=="function"){E=pt,g=pt.return;try{l=E,$t.props=l.memoizedProps,$t.state=l.memoizedState,$t.componentWillUnmount()}catch(nn){qi(E,g,nn)}}break;case 5:bu(pt,pt.return);break;case 22:if(pt.memoizedState!==null){yd(xt);continue}}Rt!==null?(Rt.return=pt,Yt=Rt):yd(xt)}gt=gt.sibling}e:for(gt=null,xt=a;;){if(xt.tag===5){if(gt===null){gt=xt;try{N=xt.stateNode,Ke?(j=N.style,typeof j.setProperty=="function"?j.setProperty("display","none","important"):j.display="none"):(xe=xt.stateNode,Ce=xt.memoizedProps.style,te=Ce!=null&&Ce.hasOwnProperty("display")?Ce.display:null,xe.style.display=_t("display",te))}catch(nn){qi(a,a.return,nn)}}}else if(xt.tag===6){if(gt===null)try{xt.stateNode.nodeValue=Ke?"":xt.memoizedProps}catch(nn){qi(a,a.return,nn)}}else if((xt.tag!==22&&xt.tag!==23||xt.memoizedState===null||xt===a)&&xt.child!==null){xt.child.return=xt,xt=xt.child;continue}if(xt===a)break e;for(;xt.sibling===null;){if(xt.return===null||xt.return===a)break e;gt===xt&&(gt=null),xt=xt.return}gt===xt&&(gt=null),xt.sibling.return=xt.return,xt=xt.sibling}}break;case 19:_o(l,a),Hs(a),E&4&&yf(a);break;case 21:break;default:_o(l,a),Hs(a)}}function Hs(a){var l=a.flags;if(l&2){try{e:{for(var g=a.return;g!==null;){if(cd(g)){var E=g;break e}g=g.return}throw Error(k(160))}switch(E.tag){case 5:var N=E.stateNode;E.flags&32&&(dn(N,""),E.flags&=-33);var j=hd(a);Oc(a,j,N);break;case 3:case 4:var te=E.stateNode.containerInfo,xe=hd(a);gf(a,xe,te);break;default:throw Error(k(161))}}catch(Ce){qi(a,a.return,Ce)}a.flags&=-3}l&4096&&(a.flags&=-4097)}function pd(a,l,g){Yt=a,md(a)}function md(a,l,g){for(var E=(a.mode&1)!==0;Yt!==null;){var N=Yt,j=N.child;if(N.tag===22&&E){var te=N.memoizedState!==null||wh;if(!te){var xe=N.alternate,Ce=xe!==null&&xe.memoizedState!==null||as;xe=wh;var Ke=as;if(wh=te,(as=Ce)&&!Ke)for(Yt=N;Yt!==null;)te=Yt,Ce=te.child,te.tag===22&&te.memoizedState!==null?_d(N):Ce!==null?(Ce.return=te,Yt=Ce):_d(N);for(;j!==null;)Yt=j,md(j),j=j.sibling;Yt=N,wh=xe,as=Ke}gd(a)}else(N.subtreeFlags&8772)!==0&&j!==null?(j.return=N,Yt=j):gd(a)}}function gd(a){for(;Yt!==null;){var l=Yt;if((l.flags&8772)!==0){var g=l.alternate;try{if((l.flags&8772)!==0)switch(l.tag){case 0:case 11:case 15:as||zc(5,l);break;case 1:var E=l.stateNode;if(l.flags&4&&!as)if(g===null)E.componentDidMount();else{var N=l.elementType===l.type?g.memoizedProps:Ua(l.type,g.memoizedProps);E.componentDidUpdate(N,g.memoizedState,E.__reactInternalSnapshotBeforeUpdate)}var j=l.updateQueue;j!==null&&Zs(l,j,E);break;case 3:var te=l.updateQueue;if(te!==null){if(g=null,l.child!==null)switch(l.child.tag){case 5:g=l.child.stateNode;break;case 1:g=l.child.stateNode}Zs(l,te,g)}break;case 5:var xe=l.stateNode;if(g===null&&l.flags&4){g=xe;var Ce=l.memoizedProps;switch(l.type){case"button":case"input":case"select":case"textarea":Ce.autoFocus&&g.focus();break;case"img":Ce.src&&(g.src=Ce.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(l.memoizedState===null){var Ke=l.alternate;if(Ke!==null){var gt=Ke.memoizedState;if(gt!==null){var xt=gt.dehydrated;xt!==null&&zs(xt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(k(163))}as||l.flags&512&&bh(l)}catch(pt){qi(l,l.return,pt)}}if(l===a){Yt=null;break}if(g=l.sibling,g!==null){g.return=l.return,Yt=g;break}Yt=l.return}}function yd(a){for(;Yt!==null;){var l=Yt;if(l===a){Yt=null;break}var g=l.sibling;if(g!==null){g.return=l.return,Yt=g;break}Yt=l.return}}function _d(a){for(;Yt!==null;){var l=Yt;try{switch(l.tag){case 0:case 11:case 15:var g=l.return;try{zc(4,l)}catch(Ce){qi(l,g,Ce)}break;case 1:var E=l.stateNode;if(typeof E.componentDidMount=="function"){var N=l.return;try{E.componentDidMount()}catch(Ce){qi(l,N,Ce)}}var j=l.return;try{bh(l)}catch(Ce){qi(l,j,Ce)}break;case 5:var te=l.return;try{bh(l)}catch(Ce){qi(l,te,Ce)}}}catch(Ce){qi(l,l.return,Ce)}if(l===a){Yt=null;break}var xe=l.sibling;if(xe!==null){xe.return=l.return,Yt=xe;break}Yt=l.return}}var up=Math.ceil,kh=tt.ReactCurrentDispatcher,Sh=tt.ReactCurrentOwner,Xs=tt.ReactCurrentBatchConfig,ni=0,Ar=null,hr=null,Kr=0,os=0,Ju=zo(0),kr=0,Fc=null,ku=0,Eh=0,Ih=0,Bc=null,Ws=null,Su=0,Di=1/0,Uo=null,jc=!1,Th=null,$n=null,Qu=!1,cl=null,Uc=0,Ea=0,Yl=null,Vc=-1,Ch=0;function Ts(){return(ni&6)!==0?hn():Vc!==-1?Vc:Vc=hn()}function Kl(a){return(a.mode&1)===0?1:(ni&2)!==0&&Kr!==0?Kr&-Kr:Et.transition!==null?(Ch===0&&(Ch=oa()),Ch):(a=qn,a!==0||(a=window.event,a=a===void 0?16:vr(a.type)),a)}function vo(a,l,g,E){if(50<Ea)throw Ea=0,Yl=null,Error(k(185));Xa(a,g,E),((ni&2)===0||a!==Ar)&&(a===Ar&&((ni&2)===0&&(Eh|=g),kr===4&&xo(a,Kr)),Ys(a,E),g===1&&ni===0&&(l.mode&1)===0&&(Di=hn()+500,sn&&_()))}function Ys(a,l){var g=a.callbackNode;Wo(a,l);var E=Ai(a,a===Ar?Kr:0);if(E===0)g!==null&&Bn(g),a.callbackNode=null,a.callbackPriority=0;else if(l=E&-E,a.callbackPriority!==l){if(g!=null&&Bn(g),l===1)a.tag===0?xc(Eu.bind(null,a)):yu(Eu.bind(null,a)),zl(function(){(ni&6)===0&&_()}),g=null;else{switch(Po(E)){case 1:g=Ha;break;case 4:g=yr;break;case 16:g=rr;break;case 536870912:g=Ei;break;default:g=rr}g=bf(g,vd.bind(null,a))}a.callbackPriority=l,a.callbackNode=g}}function vd(a,l){if(Vc=-1,Ch=0,(ni&6)!==0)throw Error(k(327));var g=a.callbackNode;if(bo()&&a.callbackNode!==g)return null;var E=Ai(a,a===Ar?Kr:0);if(E===0)return null;if((E&30)!==0||(E&a.expiredLanes)!==0||l)l=Gc(a,E);else{l=E;var N=ni;ni|=2;var j=wd();(Ar!==a||Kr!==l)&&(Uo=null,Di=hn()+500,Iu(a,l));do try{xf();break}catch(xe){xd(a,xe)}while(!0);wr(),kh.current=j,ni=N,hr!==null?l=0:(Ar=null,Kr=0,l=kr)}if(l!==0){if(l===2&&(N=Nr(a),N!==0&&(E=N,l=_f(a,N))),l===1)throw g=Fc,Iu(a,0),xo(a,E),Ys(a,hn()),g;if(l===6)xo(a,E);else{if(N=a.current.alternate,(E&30)===0&&!cp(N)&&(l=Gc(a,E),l===2&&(j=Nr(a),j!==0&&(E=j,l=_f(a,j))),l===1))throw g=Fc,Iu(a,0),xo(a,E),Ys(a,hn()),g;switch(a.finishedWork=N,a.finishedLanes=E,l){case 0:case 1:throw Error(k(345));case 2:wo(a,Ws,Uo);break;case 3:if(xo(a,E),(E&130023424)===E&&(l=Su+500-hn(),10<l)){if(Ai(a,0)!==0)break;if(N=a.suspendedLanes,(N&E)!==E){Ts(),a.pingedLanes|=a.suspendedLanes&N;break}a.timeoutHandle=Uu(wo.bind(null,a,Ws,Uo),l);break}wo(a,Ws,Uo);break;case 4:if(xo(a,E),(E&4194240)===E)break;for(l=a.eventTimes,N=-1;0<E;){var te=31-Xn(E);j=1<<te,te=l[te],te>N&&(N=te),E&=~j}if(E=N,E=hn()-E,E=(120>E?120:480>E?480:1080>E?1080:1920>E?1920:3e3>E?3e3:4320>E?4320:1960*up(E/1960))-E,10<E){a.timeoutHandle=Uu(wo.bind(null,a,Ws,Uo),E);break}wo(a,Ws,Uo);break;case 5:wo(a,Ws,Uo);break;default:throw Error(k(329))}}}return Ys(a,hn()),a.callbackNode===g?vd.bind(null,a):null}function _f(a,l){var g=Bc;return a.current.memoizedState.isDehydrated&&(Iu(a,l).flags|=256),a=Gc(a,l),a!==2&&(l=Ws,Ws=g,l!==null&&vf(l)),a}function vf(a){Ws===null?Ws=a:Ws.push.apply(Ws,a)}function cp(a){for(var l=a;;){if(l.flags&16384){var g=l.updateQueue;if(g!==null&&(g=g.stores,g!==null))for(var E=0;E<g.length;E++){var N=g[E],j=N.getSnapshot;N=N.value;try{if(!c(j(),N))return!1}catch{return!1}}}if(g=l.child,l.subtreeFlags&16384&&g!==null)g.return=l,l=g;else{if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function xo(a,l){for(l&=~Ih,l&=~Eh,a.suspendedLanes|=l,a.pingedLanes&=~l,a=a.expirationTimes;0<l;){var g=31-Xn(l),E=1<<g;a[g]=-1,l&=~E}}function Eu(a){if((ni&6)!==0)throw Error(k(327));bo();var l=Ai(a,0);if((l&1)===0)return Ys(a,hn()),null;var g=Gc(a,l);if(a.tag!==0&&g===2){var E=Nr(a);E!==0&&(l=E,g=_f(a,E))}if(g===1)throw g=Fc,Iu(a,0),xo(a,l),Ys(a,hn()),g;if(g===6)throw Error(k(345));return a.finishedWork=a.current.alternate,a.finishedLanes=l,wo(a,Ws,Uo),Ys(a,hn()),null}function Ph(a,l){var g=ni;ni|=1;try{return a(l)}finally{ni=g,ni===0&&(Di=hn()+500,sn&&_())}}function hl(a){cl!==null&&cl.tag===0&&(ni&6)===0&&bo();var l=ni;ni|=1;var g=Xs.transition,E=qn;try{if(Xs.transition=null,qn=1,a)return a()}finally{qn=E,Xs.transition=g,ni=l,(ni&6)===0&&_()}}function qc(){os=Ju.current,yi(Ju)}function Iu(a,l){a.finishedWork=null,a.finishedLanes=0;var g=a.timeoutHandle;if(g!==-1&&(a.timeoutHandle=-1,rh(g)),hr!==null)for(g=hr.return;g!==null;){var E=g;switch(oe(E),E.tag){case 1:E=E.type.childContextTypes,E!=null&&gu();break;case 3:va(),yi(On),yi(ui),Ul();break;case 5:bc(E);break;case 4:va();break;case 13:yi(Ni);break;case 19:yi(Ni);break;case 10:bs(E.type._context);break;case 22:case 23:qc()}g=g.return}if(Ar=a,hr=a=Jl(a.current,null),Kr=os=l,kr=0,Fc=null,Ih=Eh=ku=0,Ws=Bc=null,$i!==null){for(l=0;l<$i.length;l++)if(g=$i[l],E=g.interleaved,E!==null){g.interleaved=null;var N=E.next,j=g.pending;if(j!==null){var te=j.next;j.next=N,E.next=te}g.pending=E}$i=null}return a}function xd(a,l){do{var g=hr;try{if(wr(),jo.current=ch,kc){for(var E=fi.memoizedState;E!==null;){var N=E.queue;N!==null&&(N.pending=null),E=E.next}kc=!1}if(ja=0,lr=Vi=fi=null,$u=!1,Sc=0,Sh.current=null,g===null||g.return===null){kr=1,Fc=l,hr=null;break}e:{var j=a,te=g.return,xe=g,Ce=l;if(l=Kr,xe.flags|=32768,Ce!==null&&typeof Ce=="object"&&typeof Ce.then=="function"){var Ke=Ce,gt=xe,xt=gt.tag;if((gt.mode&1)===0&&(xt===0||xt===11||xt===15)){var pt=gt.alternate;pt?(gt.updateQueue=pt.updateQueue,gt.memoizedState=pt.memoizedState,gt.lanes=pt.lanes):(gt.updateQueue=null,gt.memoizedState=null)}var Rt=Qf(te);if(Rt!==null){Rt.flags&=-257,ed(Rt,te,xe,j,l),Rt.mode&1&&Jf(j,Ke,l),l=Rt,Ce=Ke;var $t=l.updateQueue;if($t===null){var nn=new Set;nn.add(Ce),l.updateQueue=nn}else $t.add(Ce);break e}else{if((l&1)===0){Jf(j,Ke,l),Mh();break e}Ce=Error(k(426))}}else if(ge&&xe.mode&1){var tr=Qf(te);if(tr!==null){(tr.flags&65536)===0&&(tr.flags|=256),ed(tr,te,xe,j,l),Lt(Or(Ce,xe));break e}}j=Ce=Or(Ce,xe),kr!==4&&(kr=2),Bc===null?Bc=[j]:Bc.push(j),j=te;do{switch(j.tag){case 3:j.flags|=65536,l&=-l,j.lanes|=l;var He=uf(j,Ce,l);Ss(j,He);break e;case 1:xe=Ce;var Ne=j.type,Xe=j.stateNode;if((j.flags&128)===0&&(typeof Ne.getDerivedStateFromError=="function"||Xe!==null&&typeof Xe.componentDidCatch=="function"&&($n===null||!$n.has(Xe)))){j.flags|=65536,l&=-l,j.lanes|=l;var Tt=Kf(j,xe,l);Ss(j,Tt);break e}}j=j.return}while(j!==null)}fl(g)}catch(ln){l=ln,hr===g&&g!==null&&(hr=g=g.return);continue}break}while(!0)}function wd(){var a=kh.current;return kh.current=ch,a===null?ch:a}function Mh(){(kr===0||kr===3||kr===2)&&(kr=4),Ar===null||(ku&268435455)===0&&(Eh&268435455)===0||xo(Ar,Kr)}function Gc(a,l){var g=ni;ni|=2;var E=wd();(Ar!==a||Kr!==l)&&(Uo=null,Iu(a,l));do try{Cs();break}catch(N){xd(a,N)}while(!0);if(wr(),ni=g,kh.current=E,hr!==null)throw Error(k(261));return Ar=null,Kr=0,kr}function Cs(){for(;hr!==null;)wf(hr)}function xf(){for(;hr!==null&&!Er();)wf(hr)}function wf(a){var l=Ed(a.alternate,a,os);a.memoizedProps=a.pendingProps,l===null?fl(a):hr=l,Sh.current=null}function fl(a){var l=a;do{var g=l.alternate;if(a=l.return,(l.flags&32768)===0){if(g=ap(g,l,os),g!==null){hr=g;return}}else{if(g=op(g,l),g!==null){g.flags&=32767,hr=g;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{kr=6,hr=null;return}}if(l=l.sibling,l!==null){hr=l;return}hr=l=a}while(l!==null);kr===0&&(kr=5)}function wo(a,l,g){var E=qn,N=Xs.transition;try{Xs.transition=null,qn=1,$c(a,l,g,E)}finally{Xs.transition=N,qn=E}return null}function $c(a,l,g,E){do bo();while(cl!==null);if((ni&6)!==0)throw Error(k(327));g=a.finishedWork;var N=a.finishedLanes;if(g===null)return null;if(a.finishedWork=null,a.finishedLanes=0,g===a.current)throw Error(k(177));a.callbackNode=null,a.callbackPriority=0;var j=g.lanes|g.childLanes;if(au(a,j),a===Ar&&(hr=Ar=null,Kr=0),(g.subtreeFlags&2064)===0&&(g.flags&2064)===0||Qu||(Qu=!0,bf(rr,function(){return bo(),null})),j=(g.flags&15990)!==0,(g.subtreeFlags&15990)!==0||j){j=Xs.transition,Xs.transition=null;var te=qn;qn=1;var xe=ni;ni|=4,Sh.current=null,lp(a,g),dd(g,a),De(yc),Ra=!!fo,yc=fo=null,a.current=g,pd(g),Co(),ni=xe,qn=te,Xs.transition=j}else a.current=g;if(Qu&&(Qu=!1,cl=a,Uc=N),j=a.pendingLanes,j===0&&($n=null),Qr(g.stateNode),Ys(a,hn()),l!==null)for(E=a.onRecoverableError,g=0;g<l.length;g++)N=l[g],E(N.value,{componentStack:N.stack,digest:N.digest});if(jc)throw jc=!1,a=Th,Th=null,a;return(Uc&1)!==0&&a.tag!==0&&bo(),j=a.pendingLanes,(j&1)!==0?a===Yl?Ea++:(Ea=0,Yl=a):Ea=0,_(),null}function bo(){if(cl!==null){var a=Po(Uc),l=Xs.transition,g=qn;try{if(Xs.transition=null,qn=16>a?16:a,cl===null)var E=!1;else{if(a=cl,cl=null,Uc=0,(ni&6)!==0)throw Error(k(331));var N=ni;for(ni|=4,Yt=a.current;Yt!==null;){var j=Yt,te=j.child;if((Yt.flags&16)!==0){var xe=j.deletions;if(xe!==null){for(var Ce=0;Ce<xe.length;Ce++){var Ke=xe[Ce];for(Yt=Ke;Yt!==null;){var gt=Yt;switch(gt.tag){case 0:case 11:case 15:Dc(8,gt,j)}var xt=gt.child;if(xt!==null)xt.return=gt,Yt=xt;else for(;Yt!==null;){gt=Yt;var pt=gt.sibling,Rt=gt.return;if(ud(gt),gt===Ke){Yt=null;break}if(pt!==null){pt.return=Rt,Yt=pt;break}Yt=Rt}}}var $t=j.alternate;if($t!==null){var nn=$t.child;if(nn!==null){$t.child=null;do{var tr=nn.sibling;nn.sibling=null,nn=tr}while(nn!==null)}}Yt=j}}if((j.subtreeFlags&2064)!==0&&te!==null)te.return=j,Yt=te;else e:for(;Yt!==null;){if(j=Yt,(j.flags&2048)!==0)switch(j.tag){case 0:case 11:case 15:Dc(9,j,j.return)}var He=j.sibling;if(He!==null){He.return=j.return,Yt=He;break e}Yt=j.return}}var Ne=a.current;for(Yt=Ne;Yt!==null;){te=Yt;var Xe=te.child;if((te.subtreeFlags&2064)!==0&&Xe!==null)Xe.return=te,Yt=Xe;else e:for(te=Ne;Yt!==null;){if(xe=Yt,(xe.flags&2048)!==0)try{switch(xe.tag){case 0:case 11:case 15:zc(9,xe)}}catch(ln){qi(xe,xe.return,ln)}if(xe===te){Yt=null;break e}var Tt=xe.sibling;if(Tt!==null){Tt.return=xe.return,Yt=Tt;break e}Yt=xe.return}}if(ni=N,_(),sr&&typeof sr.onPostCommitFiberRoot=="function")try{sr.onPostCommitFiberRoot(Fi,a)}catch{}E=!0}return E}finally{qn=g,Xs.transition=l}}return!1}function Zc(a,l,g){l=Or(g,l),l=uf(a,l,1),a=Ba(a,l,1),l=Ts(),a!==null&&(Xa(a,1,l),Ys(a,l))}function qi(a,l,g){if(a.tag===3)Zc(a,a,g);else for(;l!==null;){if(l.tag===3){Zc(l,a,g);break}else if(l.tag===1){var E=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof E.componentDidCatch=="function"&&($n===null||!$n.has(E))){a=Or(g,a),a=Kf(l,a,1),l=Ba(l,a,1),a=Ts(),l!==null&&(Xa(l,1,a),Ys(l,a));break}}l=l.return}}function hp(a,l,g){var E=a.pingCache;E!==null&&E.delete(l),l=Ts(),a.pingedLanes|=a.suspendedLanes&g,Ar===a&&(Kr&g)===g&&(kr===4||kr===3&&(Kr&130023424)===Kr&&500>hn()-Su?Iu(a,0):Ih|=g),Ys(a,l)}function bd(a,l){l===0&&((a.mode&1)===0?l=1:(l=Ir,Ir<<=1,(Ir&130023424)===0&&(Ir=4194304)));var g=Ts();a=is(a,l),a!==null&&(Xa(a,l,g),Ys(a,g))}function kd(a){var l=a.memoizedState,g=0;l!==null&&(g=l.retryLane),bd(a,g)}function Sd(a,l){var g=0;switch(a.tag){case 13:var E=a.stateNode,N=a.memoizedState;N!==null&&(g=N.retryLane);break;case 19:E=a.stateNode;break;default:throw Error(k(314))}E!==null&&E.delete(l),bd(a,g)}var Ed;Ed=function(a,l,g){if(a!==null)if(a.memoizedProps!==l.pendingProps||On.current)Is=!0;else{if((a.lanes&g)===0&&(l.flags&128)===0)return Is=!1,pf(a,l,g);Is=(a.flags&131072)!==0}else Is=!1,ge&&(l.flags&1048576)!==0&&Z(l,p,l.index);switch(l.lanes=0,l.tag){case 2:var E=l.type;Rc(a,l),a=l.pendingProps;var N=mo(l,ui.current);or(l,g),N=go(null,l,E,a,N,g);var j=wa();return l.flags|=1,typeof N=="object"&&N!==null&&typeof N.render=="function"&&N.$$typeof===void 0?(l.tag=1,l.memoizedState=null,l.updateQueue=null,Cr(E)?(j=!0,ws(l)):j=!1,l.memoizedState=N.state!==null&&N.state!==void 0?N.state:null,Fo(l),N.updater=dh,l.stateNode=N,N._reactInternals=l,xu(l,E,a,g),l=hf(null,l,E,!0,j,g)):(l.tag=0,ge&&j&&Q(l),ur(null,l,N,g),l=l.child),l;case 16:E=l.elementType;e:{switch(Rc(a,l),a=l.pendingProps,N=E._init,E=N(E._payload),l.type=E,N=l.tag=fp(E),a=Ua(E,a),N){case 0:l=cf(null,l,E,a,g);break e;case 1:l=ad(null,l,E,a,g);break e;case 11:l=Wu(null,l,E,a,g);break e;case 14:l=nd(null,l,E,Ua(E.type,a),g);break e}throw Error(k(306,E,""))}return l;case 0:return E=l.type,N=l.pendingProps,N=l.elementType===E?N:Ua(E,N),cf(a,l,E,N,g);case 1:return E=l.type,N=l.pendingProps,N=l.elementType===E?N:Ua(E,N),ad(a,l,E,N,g);case 3:e:{if(yh(l),a===null)throw Error(k(387));E=l.pendingProps,j=l.memoizedState,N=j.element,ks(a,l),_a(l,E,null,g);var te=l.memoizedState;if(E=te.element,j.isDehydrated)if(j={element:E,isDehydrated:!1,cache:te.cache,pendingSuspenseBoundaries:te.pendingSuspenseBoundaries,transitions:te.transitions},l.updateQueue.baseState=j,l.memoizedState=j,l.flags&256){N=Or(Error(k(423)),l),l=od(a,l,E,g,N);break e}else if(E!==N){N=Or(Error(k(424)),l),l=od(a,l,E,g,N);break e}else for(pe=da(l.stateNode.containerInfo.firstChild),he=l,ge=!0,ve=null,g=mn(l,null,E,g),l.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling;else{if(kt(),E===N){l=ka(a,l,g);break e}ur(a,l,E,g)}l=l.child}return l;case 5:return wc(l),a===null&&ze(l),E=l.type,N=l.pendingProps,j=a!==null?a.memoizedProps:null,te=N.children,_c(E,N)?te=null:j!==null&&_c(E,j)&&(l.flags|=32),sd(a,l),ur(a,l,te,g),l.child;case 6:return a===null&&ze(l),null;case 13:return Zi(a,l,g);case 4:return Bo(l,l.stateNode.containerInfo),E=l.pendingProps,a===null?l.child=Ct(l,null,E,g):ur(a,l,E,g),l.child;case 11:return E=l.type,N=l.pendingProps,N=l.elementType===E?N:Ua(E,N),Wu(a,l,E,N,g);case 7:return ur(a,l,l.pendingProps,g),l.child;case 8:return ur(a,l,l.pendingProps.children,g),l.child;case 12:return ur(a,l,l.pendingProps.children,g),l.child;case 10:e:{if(E=l.type._context,N=l.pendingProps,j=l.memoizedProps,te=N.value,xi(li,E._currentValue),E._currentValue=te,j!==null)if(c(j.value,te)){if(j.children===N.children&&!On.current){l=ka(a,l,g);break e}}else for(j=l.child,j!==null&&(j.return=l);j!==null;){var xe=j.dependencies;if(xe!==null){te=j.child;for(var Ce=xe.firstContext;Ce!==null;){if(Ce.context===E){if(j.tag===1){Ce=$s(-1,g&-g),Ce.tag=2;var Ke=j.updateQueue;if(Ke!==null){Ke=Ke.shared;var gt=Ke.pending;gt===null?Ce.next=Ce:(Ce.next=gt.next,gt.next=Ce),Ke.pending=Ce}}j.lanes|=g,Ce=j.alternate,Ce!==null&&(Ce.lanes|=g),hi(j.return,g,l),xe.lanes|=g;break}Ce=Ce.next}}else if(j.tag===10)te=j.type===l.type?null:j.child;else if(j.tag===18){if(te=j.return,te===null)throw Error(k(341));te.lanes|=g,xe=te.alternate,xe!==null&&(xe.lanes|=g),hi(te,g,l),te=j.sibling}else te=j.child;if(te!==null)te.return=j;else for(te=j;te!==null;){if(te===l){te=null;break}if(j=te.sibling,j!==null){j.return=te.return,te=j;break}te=te.return}j=te}ur(a,l,N.children,g),l=l.child}return l;case 9:return N=l.type,E=l.pendingProps.children,or(l,g),N=wi(N),E=E(N),l.flags|=1,ur(a,l,E,g),l.child;case 14:return E=l.type,N=Ua(E,l.pendingProps),N=Ua(E.type,N),nd(a,l,E,N,g);case 15:return id(a,l,l.type,l.pendingProps,g);case 17:return E=l.type,N=l.pendingProps,N=l.elementType===E?N:Ua(E,N),Rc(a,l),l.tag=1,Cr(E)?(a=!0,ws(l)):a=!1,or(l,g),lf(l,E,N),xu(l,E,N,g),hf(null,l,E,!0,a,g);case 19:return df(a,l,g);case 22:return rd(a,l,g)}throw Error(k(156,l.tag))};function bf(a,l){return Si(a,l)}function Id(a,l,g,E){this.tag=a,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=E,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ks(a,l,g,E){return new Id(a,l,g,E)}function Hc(a){return a=a.prototype,!(!a||!a.isReactComponent)}function fp(a){if(typeof a=="function")return Hc(a)?1:0;if(a!=null){if(a=a.$$typeof,a===Ht)return 11;if(a===en)return 14}return 2}function Jl(a,l){var g=a.alternate;return g===null?(g=Ks(a.tag,l,a.key,a.mode),g.elementType=a.elementType,g.type=a.type,g.stateNode=a.stateNode,g.alternate=a,a.alternate=g):(g.pendingProps=l,g.type=a.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=a.flags&14680064,g.childLanes=a.childLanes,g.lanes=a.lanes,g.child=a.child,g.memoizedProps=a.memoizedProps,g.memoizedState=a.memoizedState,g.updateQueue=a.updateQueue,l=a.dependencies,g.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},g.sibling=a.sibling,g.index=a.index,g.ref=a.ref,g}function Xc(a,l,g,E,N,j){var te=2;if(E=a,typeof a=="function")Hc(a)&&(te=1);else if(typeof a=="string")te=5;else e:switch(a){case Ge:return Ql(g.children,N,j,l);case ht:te=8,N|=8;break;case mt:return a=Ks(12,g,l,N|2),a.elementType=mt,a.lanes=j,a;case Vt:return a=Ks(13,g,l,N),a.elementType=Vt,a.lanes=j,a;case ct:return a=Ks(19,g,l,N),a.elementType=ct,a.lanes=j,a;case rn:return eu(g,N,j,l);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Kt:te=10;break e;case St:te=9;break e;case Ht:te=11;break e;case en:te=14;break e;case fn:te=16,E=null;break e}throw Error(k(130,a==null?a:typeof a,""))}return l=Ks(te,g,l,N),l.elementType=a,l.type=E,l.lanes=j,l}function Ql(a,l,g,E){return a=Ks(7,a,E,l),a.lanes=g,a}function eu(a,l,g,E){return a=Ks(22,a,E,l),a.elementType=rn,a.lanes=g,a.stateNode={isHidden:!1},a}function Va(a,l,g){return a=Ks(6,a,null,l),a.lanes=g,a}function Vo(a,l,g){return l=Ks(4,a.children!==null?a.children:[],a.key,l),l.lanes=g,l.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},l}function Td(a,l,g,E,N){this.tag=l,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Vn(0),this.expirationTimes=Vn(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vn(0),this.identifierPrefix=E,this.onRecoverableError=N,this.mutableSourceEagerHydrationData=null}function Wc(a,l,g,E,N,j,te,xe,Ce){return a=new Td(a,l,g,xe,Ce),l===1?(l=1,j===!0&&(l|=8)):l=0,j=Ks(3,null,null,l),a.current=j,j.stateNode=a,j.memoizedState={element:E,isDehydrated:g,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fo(j),a}function dp(a,l,g){var E=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:it,key:E==null?null:""+E,children:a,containerInfo:l,implementation:g}}function Cd(a){if(!a)return Oo;a=a._reactInternals;e:{if(Sn(a)!==a||a.tag!==1)throw Error(k(170));var l=a;do{switch(l.tag){case 3:l=l.stateNode.context;break e;case 1:if(Cr(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break e}}l=l.return}while(l!==null);throw Error(k(171))}if(a.tag===1){var g=a.type;if(Cr(g))return Fl(a,g,l)}return l}function Yc(a,l,g,E,N,j,te,xe,Ce){return a=Wc(g,E,!0,a,N,j,te,xe,Ce),a.context=Cd(null),g=a.current,E=Ts(),N=Kl(g),j=$s(E,N),j.callback=l??null,Ba(g,j,N),a.current.lanes=N,Xa(a,N,E),Ys(a,E),a}function ec(a,l,g,E){var N=l.current,j=Ts(),te=Kl(N);return g=Cd(g),l.context===null?l.context=g:l.pendingContext=g,l=$s(j,te),l.payload={element:a},E=E===void 0?null:E,E!==null&&(l.callback=E),a=Ba(N,l,te),a!==null&&(vo(a,N,te,j),Wr(a,N,te)),te}function Ah(a){return a=a.current,a.child?(a.child.tag===5,a.child.stateNode):null}function Lh(a,l){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var g=a.retryLane;a.retryLane=g!==0&&g<l?g:l}}function Kc(a,l){Lh(a,l),(a=a.alternate)&&Lh(a,l)}function tc(){return null}var kf=typeof reportError=="function"?reportError:function(a){console.error(a)};function Rh(a){this._internalRoot=a}nc.prototype.render=Rh.prototype.render=function(a){var l=this._internalRoot;if(l===null)throw Error(k(409));ec(a,l,null,null)},nc.prototype.unmount=Rh.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var l=a.containerInfo;hl(function(){ec(null,a,null,null)}),l[pa]=null}};function nc(a){this._internalRoot=a}nc.prototype.unstable_scheduleHydration=function(a){if(a){var l=Yo();a={blockedOn:null,target:a,priority:l};for(var g=0;g<gs.length&&l!==0&&l<gs[g].priority;g++);gs.splice(g,0,a),g===0&&Hn(a)}};function Nh(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function Tu(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function Sf(){}function pp(a,l,g,E,N){if(N){if(typeof E=="function"){var j=E;E=function(){var Ke=Ah(te);j.call(Ke)}}var te=Yc(l,E,a,0,null,!1,!1,"",Sf);return a._reactRootContainer=te,a[pa]=te.current,co(a.nodeType===8?a.parentNode:a),hl(),te}for(;N=a.lastChild;)a.removeChild(N);if(typeof E=="function"){var xe=E;E=function(){var Ke=Ah(Ce);xe.call(Ke)}}var Ce=Wc(a,0,!1,null,null,!1,!1,"",Sf);return a._reactRootContainer=Ce,a[pa]=Ce.current,co(a.nodeType===8?a.parentNode:a),hl(function(){ec(l,Ce,g,E)}),Ce}function Dh(a,l,g,E,N){var j=g._reactRootContainer;if(j){var te=j;if(typeof N=="function"){var xe=N;N=function(){var Ce=Ah(te);xe.call(Ce)}}ec(l,te,a,N)}else te=pp(g,l,a,N,E);return Ah(te)}Mo=function(a){switch(a.tag){case 3:var l=a.stateNode;if(l.current.memoizedState.isDehydrated){var g=Ls(l.pendingLanes);g!==0&&(la(l,g|1),Ys(l,hn()),(ni&6)===0&&(Di=hn()+500,_()))}break;case 13:hl(function(){var E=is(a,1);if(E!==null){var N=Ts();vo(E,a,1,N)}}),Kc(a,1)}},Wa=function(a){if(a.tag===13){var l=is(a,134217728);if(l!==null){var g=Ts();vo(l,a,134217728,g)}Kc(a,134217728)}},Ya=function(a){if(a.tag===13){var l=Kl(a),g=is(a,l);if(g!==null){var E=Ts();vo(g,a,l,E)}Kc(a,l)}},Yo=function(){return qn},mi=function(a,l){var g=qn;try{return qn=a,l()}finally{qn=g}},Sr=function(a,l,g){switch(l){case"input":if(ds(a,g),l=g.name,g.type==="radio"&&l!=null){for(g=a;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll("input[name="+JSON.stringify(""+l)+'][type="radio"]'),l=0;l<g.length;l++){var E=g[l];if(E!==a&&E.form===a.form){var N=pu(E);if(!N)throw Error(k(90));we(E),ds(E,N)}}}break;case"textarea":vn(a,g);break;case"select":l=g.value,l!=null&&ps(a,!!g.multiple,l,!1)}},ae=Ph,se=hl;var Pd={usingClientEntryPoint:!1,Events:[du,ma,pu,Y,W,Ph]},Jc={findFiberByHostInstance:po,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},mp={bundleType:Jc.bundleType,version:Jc.version,rendererPackageName:Jc.rendererPackageName,rendererConfig:Jc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:tt.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=Zn(a),a===null?null:a.stateNode},findFiberByHostInstance:Jc.findFiberByHostInstance||tc,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var zh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!zh.isDisabled&&zh.supportsFiber)try{Fi=zh.inject(mp),sr=zh}catch{}}return Ga.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pd,Ga.createPortal=function(a,l){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Nh(l))throw Error(k(200));return dp(a,l,null,g)},Ga.createRoot=function(a,l){if(!Nh(a))throw Error(k(299));var g=!1,E="",N=kf;return l!=null&&(l.unstable_strictMode===!0&&(g=!0),l.identifierPrefix!==void 0&&(E=l.identifierPrefix),l.onRecoverableError!==void 0&&(N=l.onRecoverableError)),l=Wc(a,1,!1,null,null,g,!1,E,N),a[pa]=l.current,co(a.nodeType===8?a.parentNode:a),new Rh(l)},Ga.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var l=a._reactInternals;if(l===void 0)throw typeof a.render=="function"?Error(k(188)):(a=Object.keys(a).join(","),Error(k(268,a)));return a=Zn(l),a=a===null?null:a.stateNode,a},Ga.flushSync=function(a){return hl(a)},Ga.hydrate=function(a,l,g){if(!Tu(l))throw Error(k(200));return Dh(null,a,l,!0,g)},Ga.hydrateRoot=function(a,l,g){if(!Nh(a))throw Error(k(405));var E=g!=null&&g.hydratedSources||null,N=!1,j="",te=kf;if(g!=null&&(g.unstable_strictMode===!0&&(N=!0),g.identifierPrefix!==void 0&&(j=g.identifierPrefix),g.onRecoverableError!==void 0&&(te=g.onRecoverableError)),l=Yc(l,null,a,1,g??null,N,!1,j,te),a[pa]=l.current,co(a),E)for(a=0;a<E.length;a++)g=E[a],N=g._getVersion,N=N(g._source),l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[g,N]:l.mutableSourceEagerHydrationData.push(g,N);return new nc(l)},Ga.render=function(a,l,g){if(!Tu(l))throw Error(k(200));return Dh(null,a,l,!1,g)},Ga.unmountComponentAtNode=function(a){if(!Tu(a))throw Error(k(40));return a._reactRootContainer?(hl(function(){Dh(null,null,a,!1,function(){a._reactRootContainer=null,a[pa]=null})}),!0):!1},Ga.unstable_batchedUpdates=Ph,Ga.unstable_renderSubtreeIntoContainer=function(a,l,g,E){if(!Tu(g))throw Error(k(200));if(a==null||a._reactInternals===void 0)throw Error(k(38));return Dh(a,l,g,!1,E)},Ga.version="18.3.1-next-f1338f8080-20240426",Ga}var Nm;function zy(){if(Nm)return Mp.exports;Nm=1;function S(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(S)}catch(b){console.error(b)}}return S(),Mp.exports=Dy(),Mp.exports}var Dm;function Oy(){if(Dm)return zd;Dm=1;var S=zy();return zd.createRoot=S.createRoot,zd.hydrateRoot=S.hydrateRoot,zd}var Fy=Oy();const By=Uf(Fy),jy={},zm=S=>{let b;const k=new Set,P=(ee,B)=>{const q=typeof ee=="function"?ee(b):ee;if(!Object.is(q,b)){const ue=b;b=B??(typeof q!="object"||q===null)?q:Object.assign({},b,q),k.forEach(ce=>ce(b,ue))}},C=()=>b,K={setState:P,getState:C,getInitialState:()=>ne,subscribe:ee=>(k.add(ee),()=>k.delete(ee)),destroy:()=>{(jy?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),k.clear()}},ne=b=S(P,C,K);return K},Uy=S=>S?zm(S):zm;var Rp={exports:{}},Np={},Dp={exports:{}},zp={};var Om;function Vy(){if(Om)return zp;Om=1;var S=Vf();function b(B,q){return B===q&&(B!==0||1/B===1/q)||B!==B&&q!==q}var k=typeof Object.is=="function"?Object.is:b,P=S.useState,C=S.useEffect,O=S.useLayoutEffect,R=S.useDebugValue;function h(B,q){var ue=q(),ce=P({inst:{value:ue,getSnapshot:q}}),de=ce[0].inst,Pe=ce[1];return O(function(){de.value=ue,de.getSnapshot=q,K(de)&&Pe({inst:de})},[B,ue,q]),C(function(){return K(de)&&Pe({inst:de}),B(function(){K(de)&&Pe({inst:de})})},[B]),R(ue),ue}function K(B){var q=B.getSnapshot;B=B.value;try{var ue=q();return!k(B,ue)}catch{return!0}}function ne(B,q){return q()}var ee=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ne:h;return zp.useSyncExternalStore=S.useSyncExternalStore!==void 0?S.useSyncExternalStore:ee,zp}var Fm;function qy(){return Fm||(Fm=1,Dp.exports=Vy()),Dp.exports}var Bm;function Gy(){if(Bm)return Np;Bm=1;var S=Vf(),b=qy();function k(ne,ee){return ne===ee&&(ne!==0||1/ne===1/ee)||ne!==ne&&ee!==ee}var P=typeof Object.is=="function"?Object.is:k,C=b.useSyncExternalStore,O=S.useRef,R=S.useEffect,h=S.useMemo,K=S.useDebugValue;return Np.useSyncExternalStoreWithSelector=function(ne,ee,B,q,ue){var ce=O(null);if(ce.current===null){var de={hasValue:!1,value:null};ce.current=de}else de=ce.current;ce=h(function(){function je(it){if(!Te){if(Te=!0,qe=it,it=q(it),ue!==void 0&&de.hasValue){var Ge=de.value;if(ue(Ge,it))return tt=Ge}return tt=it}if(Ge=tt,P(qe,it))return Ge;var ht=q(it);return ue!==void 0&&ue(Ge,ht)?(qe=it,Ge):(qe=it,tt=ht)}var Te=!1,qe,tt,nt=B===void 0?null:B;return[function(){return je(ee())},nt===null?void 0:function(){return je(nt())}]},[ee,B,q,ue]);var Pe=C(ne,ce[0],ce[1]);return R(function(){de.hasValue=!0,de.value=Pe},[Pe]),K(Pe),Pe},Np}var jm;function $y(){return jm||(jm=1,Rp.exports=Gy()),Rp.exports}var Zy=$y();const Hy=Uf(Zy),Ag={},{useDebugValue:Xy}=Mg,{useSyncExternalStoreWithSelector:Wy}=Hy;let Um=!1;const Yy=S=>S;function Ky(S,b=Yy,k){(Ag?"production":void 0)!=="production"&&k&&!Um&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Um=!0);const P=Wy(S.subscribe,S.getState,S.getServerState||S.getInitialState,b,k);return Xy(P),P}const Vm=S=>{(Ag?"production":void 0)!=="production"&&typeof S!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const b=typeof S=="function"?Uy(S):S,k=(P,C)=>Ky(b,P,C);return Object.assign(k,b),k},Jy=S=>S?Vm(S):Vm;var $a=63710088e-1,Lg={centimeters:$a*100,centimetres:$a*100,degrees:360/(2*Math.PI),feet:$a*3.28084,inches:$a*39.37,kilometers:$a/1e3,kilometres:$a/1e3,meters:$a,metres:$a,miles:$a/1609.344,millimeters:$a*1e3,millimetres:$a*1e3,nauticalmiles:$a/1852,radians:1,yards:$a*1.0936};function sm(S,b,k={}){const P={type:"Feature"};return(k.id===0||k.id)&&(P.id=k.id),k.bbox&&(P.bbox=k.bbox),P.properties=b||{},P.geometry=S,P}function $h(S,b,k={}){if(!S)throw new Error("coordinates is required");if(!Array.isArray(S))throw new Error("coordinates must be an Array");if(S.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Gm(S[0])||!Gm(S[1]))throw new Error("coordinates must contain numbers");return sm({type:"Point",coordinates:S},b,k)}function am(S,b,k={}){for(const C of S){if(C.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(C[C.length-1].length!==C[0].length)throw new Error("First and last Position are not equivalent.");for(let O=0;O<C[C.length-1].length;O++)if(C[C.length-1][O]!==C[0][O])throw new Error("First and last Position are not equivalent.")}return sm({type:"Polygon",coordinates:S},b,k)}function Of(S,b={}){const k={type:"FeatureCollection"};return b.id&&(k.id=b.id),b.bbox&&(k.bbox=b.bbox),k.features=S,k}function Qy(S,b="kilometers"){const k=Lg[b];if(!k)throw new Error(b+" units is invalid");return S*k}function Rg(S,b="kilometers"){const k=Lg[b];if(!k)throw new Error(b+" units is invalid");return S/k}function qm(S){return S%(2*Math.PI)*180/Math.PI}function Op(S){return S%360*Math.PI/180}function Gm(S){return!isNaN(S)&&S!==null&&!Array.isArray(S)}function e_(S){return S!==null&&typeof S=="object"&&!Array.isArray(S)}function Ng(S){if(!S)throw new Error("coord is required");if(!Array.isArray(S)){if(S.type==="Feature"&&S.geometry!==null&&S.geometry.type==="Point")return[...S.geometry.coordinates];if(S.type==="Point")return[...S.coordinates]}if(Array.isArray(S)&&S.length>=2&&!Array.isArray(S[0])&&!Array.isArray(S[1]))return[...S];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function t_(S,b,k){if(!S)throw new Error("No featureCollection passed");if(!S||S.type!=="FeatureCollection")throw new Error("Invalid input to "+k+", FeatureCollection required");for(const P of S.features){if(!P||P.type!=="Feature"||!P.geometry)throw new Error("Invalid input to "+k+", Feature with geometry required");if(!P.geometry||P.geometry.type!==b)throw new Error("Invalid input to "+k+": must be a "+b+", given "+P.geometry.type)}}function n_(S){return S.type==="Feature"?S.geometry:S}function i_(S,b,k,P={}){const C=Ng(S),O=Op(C[0]),R=Op(C[1]),h=Op(k),K=Rg(b,P.units),ne=Math.asin(Math.sin(R)*Math.cos(K)+Math.cos(R)*Math.sin(K)*Math.cos(h)),ee=O+Math.atan2(Math.sin(h)*Math.sin(K)*Math.cos(R),Math.cos(K)-Math.sin(R)*Math.sin(ne)),B=qm(ee),q=qm(ne);return C[2]!==void 0?$h([B,q,C[2]],P.properties):$h([B,q],P.properties)}function Dg(S,b,k){if(S!==null)for(var P,C,O,R,h,K,ne,ee=0,B=0,q,ue=S.type,ce=ue==="FeatureCollection",de=ue==="Feature",Pe=ce?S.features.length:1,je=0;je<Pe;je++){ne=ce?S.features[je].geometry:de?S.geometry:S,q=ne?ne.type==="GeometryCollection":!1,h=q?ne.geometries.length:1;for(var Te=0;Te<h;Te++){var qe=0,tt=0;if(R=q?ne.geometries[Te]:ne,R!==null){K=R.coordinates;var nt=R.type;switch(ee=0,nt){case null:break;case"Point":if(b(K,B,je,qe,tt)===!1)return!1;B++,qe++;break;case"LineString":case"MultiPoint":for(P=0;P<K.length;P++){if(b(K[P],B,je,qe,tt)===!1)return!1;B++,nt==="MultiPoint"&&qe++}nt==="LineString"&&qe++;break;case"Polygon":case"MultiLineString":for(P=0;P<K.length;P++){for(C=0;C<K[P].length-ee;C++){if(b(K[P][C],B,je,qe,tt)===!1)return!1;B++}nt==="MultiLineString"&&qe++,nt==="Polygon"&&tt++}nt==="Polygon"&&qe++;break;case"MultiPolygon":for(P=0;P<K.length;P++){for(tt=0,C=0;C<K[P].length;C++){for(O=0;O<K[P][C].length-ee;O++){if(b(K[P][C][O],B,je,qe,tt)===!1)return!1;B++}tt++}qe++}break;case"GeometryCollection":for(P=0;P<R.geometries.length;P++)if(Dg(R.geometries[P],b)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function $m(S,b){if(S.type==="Feature")b(S,0);else if(S.type==="FeatureCollection")for(var k=0;k<S.features.length&&b(S.features[k],k)!==!1;k++);}function zg(S,b){var k,P,C,O,R,h,K,ne,ee,B,q=0,ue=S.type==="FeatureCollection",ce=S.type==="Feature",de=ue?S.features.length:1;for(k=0;k<de;k++){for(h=ue?S.features[k].geometry:ce?S.geometry:S,ne=ue?S.features[k].properties:ce?S.properties:{},ee=ue?S.features[k].bbox:ce?S.bbox:void 0,B=ue?S.features[k].id:ce?S.id:void 0,K=h?h.type==="GeometryCollection":!1,R=K?h.geometries.length:1,C=0;C<R;C++){if(O=K?h.geometries[C]:h,O===null){if(b(null,q,ne,ee,B)===!1)return!1;continue}switch(O.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(b(O,q,ne,ee,B)===!1)return!1;break}case"GeometryCollection":{for(P=0;P<O.geometries.length;P++)if(b(O.geometries[P],q,ne,ee,B)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}q++}}function oc(S,b={}){if(S.bbox!=null&&b.recompute!==!0)return S.bbox;const k=[1/0,1/0,-1/0,-1/0];return Dg(S,P=>{k[0]>P[0]&&(k[0]=P[0]),k[1]>P[1]&&(k[1]=P[1]),k[2]<P[0]&&(k[2]=P[0]),k[3]<P[1]&&(k[3]=P[1])}),k}function Og(S,b={}){const k=Number(S[0]),P=Number(S[1]),C=Number(S[2]),O=Number(S[3]);if(S.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const R=[k,P];return am([[R,[C,P],[C,O],[k,O],R]],b.properties,{bbox:S,id:b.id})}const Mu=11102230246251565e-32,na=134217729,r_=(3+8*Mu)*Mu;function Fp(S,b,k,P,C){let O,R,h,K,ne=b[0],ee=P[0],B=0,q=0;ee>ne==ee>-ne?(O=ne,ne=b[++B]):(O=ee,ee=P[++q]);let ue=0;if(B<S&&q<k)for(ee>ne==ee>-ne?(R=ne+O,h=O-(R-ne),ne=b[++B]):(R=ee+O,h=O-(R-ee),ee=P[++q]),O=R,h!==0&&(C[ue++]=h);B<S&&q<k;)ee>ne==ee>-ne?(R=O+ne,K=R-O,h=O-(R-K)+(ne-K),ne=b[++B]):(R=O+ee,K=R-O,h=O-(R-K)+(ee-K),ee=P[++q]),O=R,h!==0&&(C[ue++]=h);for(;B<S;)R=O+ne,K=R-O,h=O-(R-K)+(ne-K),ne=b[++B],O=R,h!==0&&(C[ue++]=h);for(;q<k;)R=O+ee,K=R-O,h=O-(R-K)+(ee-K),ee=P[++q],O=R,h!==0&&(C[ue++]=h);return(O!==0||ue===0)&&(C[ue++]=O),ue}function s_(S,b){let k=b[0];for(let P=1;P<S;P++)k+=b[P];return k}function qf(S){return new Float64Array(S)}const a_=(3+16*Mu)*Mu,o_=(2+12*Mu)*Mu,l_=(9+64*Mu)*Mu*Mu,jh=qf(4),Zm=qf(8),Hm=qf(12),Xm=qf(16),Ta=qf(4);function u_(S,b,k,P,C,O,R){let h,K,ne,ee,B,q,ue,ce,de,Pe,je,Te,qe,tt,nt,it,Ge,ht;const mt=S-C,Kt=k-C,St=b-O,Ht=P-O;tt=mt*Ht,q=na*mt,ue=q-(q-mt),ce=mt-ue,q=na*Ht,de=q-(q-Ht),Pe=Ht-de,nt=ce*Pe-(tt-ue*de-ce*de-ue*Pe),it=St*Kt,q=na*St,ue=q-(q-St),ce=St-ue,q=na*Kt,de=q-(q-Kt),Pe=Kt-de,Ge=ce*Pe-(it-ue*de-ce*de-ue*Pe),je=nt-Ge,B=nt-je,jh[0]=nt-(je+B)+(B-Ge),Te=tt+je,B=Te-tt,qe=tt-(Te-B)+(je-B),je=qe-it,B=qe-je,jh[1]=qe-(je+B)+(B-it),ht=Te+je,B=ht-Te,jh[2]=Te-(ht-B)+(je-B),jh[3]=ht;let Vt=s_(4,jh),ct=o_*R;if(Vt>=ct||-Vt>=ct||(B=S-mt,h=S-(mt+B)+(B-C),B=k-Kt,ne=k-(Kt+B)+(B-C),B=b-St,K=b-(St+B)+(B-O),B=P-Ht,ee=P-(Ht+B)+(B-O),h===0&&K===0&&ne===0&&ee===0)||(ct=l_*R+r_*Math.abs(Vt),Vt+=mt*ee+Ht*h-(St*ne+Kt*K),Vt>=ct||-Vt>=ct))return Vt;tt=h*Ht,q=na*h,ue=q-(q-h),ce=h-ue,q=na*Ht,de=q-(q-Ht),Pe=Ht-de,nt=ce*Pe-(tt-ue*de-ce*de-ue*Pe),it=K*Kt,q=na*K,ue=q-(q-K),ce=K-ue,q=na*Kt,de=q-(q-Kt),Pe=Kt-de,Ge=ce*Pe-(it-ue*de-ce*de-ue*Pe),je=nt-Ge,B=nt-je,Ta[0]=nt-(je+B)+(B-Ge),Te=tt+je,B=Te-tt,qe=tt-(Te-B)+(je-B),je=qe-it,B=qe-je,Ta[1]=qe-(je+B)+(B-it),ht=Te+je,B=ht-Te,Ta[2]=Te-(ht-B)+(je-B),Ta[3]=ht;const en=Fp(4,jh,4,Ta,Zm);tt=mt*ee,q=na*mt,ue=q-(q-mt),ce=mt-ue,q=na*ee,de=q-(q-ee),Pe=ee-de,nt=ce*Pe-(tt-ue*de-ce*de-ue*Pe),it=St*ne,q=na*St,ue=q-(q-St),ce=St-ue,q=na*ne,de=q-(q-ne),Pe=ne-de,Ge=ce*Pe-(it-ue*de-ce*de-ue*Pe),je=nt-Ge,B=nt-je,Ta[0]=nt-(je+B)+(B-Ge),Te=tt+je,B=Te-tt,qe=tt-(Te-B)+(je-B),je=qe-it,B=qe-je,Ta[1]=qe-(je+B)+(B-it),ht=Te+je,B=ht-Te,Ta[2]=Te-(ht-B)+(je-B),Ta[3]=ht;const fn=Fp(en,Zm,4,Ta,Hm);tt=h*ee,q=na*h,ue=q-(q-h),ce=h-ue,q=na*ee,de=q-(q-ee),Pe=ee-de,nt=ce*Pe-(tt-ue*de-ce*de-ue*Pe),it=K*ne,q=na*K,ue=q-(q-K),ce=K-ue,q=na*ne,de=q-(q-ne),Pe=ne-de,Ge=ce*Pe-(it-ue*de-ce*de-ue*Pe),je=nt-Ge,B=nt-je,Ta[0]=nt-(je+B)+(B-Ge),Te=tt+je,B=Te-tt,qe=tt-(Te-B)+(je-B),je=qe-it,B=qe-je,Ta[1]=qe-(je+B)+(B-it),ht=Te+je,B=ht-Te,Ta[2]=Te-(ht-B)+(je-B),Ta[3]=ht;const rn=Fp(fn,Hm,4,Ta,Xm);return Xm[rn-1]}function c_(S,b,k,P,C,O){const R=(b-O)*(k-C),h=(S-C)*(P-O),K=R-h,ne=Math.abs(R+h);return Math.abs(K)>=a_*ne?K:-u_(S,b,k,P,C,O,ne)}function h_(S,b){var k,P,C=0,O,R,h,K,ne,ee,B,q=S[0],ue=S[1],ce=b.length;for(k=0;k<ce;k++){P=0;var de=b[k],Pe=de.length-1;if(ee=de[0],ee[0]!==de[Pe][0]&&ee[1]!==de[Pe][1])throw new Error("First and last coordinates in a ring must be the same");for(R=ee[0]-q,h=ee[1]-ue,P;P<Pe;P++){if(B=de[P+1],K=B[0]-q,ne=B[1]-ue,h===0&&ne===0){if(K<=0&&R>=0||R<=0&&K>=0)return 0}else if(ne>=0&&h<=0||ne<=0&&h>=0){if(O=c_(R,K,h,ne,0,0),O===0)return 0;(O>0&&ne>0&&h<=0||O<0&&ne<=0&&h>0)&&C++}ee=B,h=ne,R=K}}return C%2!==0}function Zp(S,b,k={}){if(!S)throw new Error("point is required");if(!b)throw new Error("polygon is required");const P=Ng(S),C=n_(b),O=C.type,R=b.bbox;let h=C.coordinates;if(R&&f_(P,R)===!1)return!1;O==="Polygon"&&(h=[h]);let K=!1;for(var ne=0;ne<h.length;++ne){const ee=h_(P,h[ne]);if(ee===0)return!k.ignoreBoundary;ee&&(K=!0)}return K}function f_(S,b){return b[0]<=S[0]&&b[1]<=S[1]&&b[2]>=S[0]&&b[3]>=S[1]}function d_(S,b={}){const k=oc(S),P=(k[0]+k[2])/2,C=(k[1]+k[3])/2;return $h([P,C],b.properties,b)}var Vd={exports:{}},p_=Vd.exports,Wm;function m_(){return Wm||(Wm=1,(function(S,b){(function(k,P){S.exports=P()})(p_,(function(){function k(f,i){(i==null||i>f.length)&&(i=f.length);for(var s=0,c=Array(i);s<i;s++)c[s]=f[s];return c}function P(f,i,s){return i=ee(i),(function(c,w){if(w&&(typeof w=="object"||typeof w=="function"))return w;if(w!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(L){if(L===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return L})(c)})(f,q()?Reflect.construct(i,s||[],ee(f).constructor):i.apply(f,s))}function C(f,i){if(!(f instanceof i))throw new TypeError("Cannot call a class as a function")}function O(f,i,s){if(q())return Reflect.construct.apply(null,arguments);var c=[null];c.push.apply(c,i);var w=new(f.bind.apply(f,c));return s&&ue(w,s.prototype),w}function R(f,i){for(var s=0;s<i.length;s++){var c=i[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(f,Pe(c.key),c)}}function h(f,i,s){return i&&R(f.prototype,i),s&&R(f,s),Object.defineProperty(f,"prototype",{writable:!1}),f}function K(f,i){var s=typeof Symbol<"u"&&f[Symbol.iterator]||f["@@iterator"];if(!s){if(Array.isArray(f)||(s=je(f))||i){s&&(f=s);var c=0,w=function(){};return{s:w,n:function(){return c>=f.length?{done:!0}:{done:!1,value:f[c++]}},e:function(re){throw re},f:w}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var L,F=!0,H=!1;return{s:function(){s=s.call(f)},n:function(){var re=s.next();return F=re.done,re},e:function(re){H=!0,L=re},f:function(){try{F||s.return==null||s.return()}finally{if(H)throw L}}}}function ne(){return ne=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(f,i,s){var c=(function(L,F){for(;!{}.hasOwnProperty.call(L,F)&&(L=ee(L))!==null;);return L})(f,i);if(c){var w=Object.getOwnPropertyDescriptor(c,i);return w.get?w.get.call(arguments.length<3?f:s):w.value}},ne.apply(null,arguments)}function ee(f){return ee=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},ee(f)}function B(f,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");f.prototype=Object.create(i&&i.prototype,{constructor:{value:f,writable:!0,configurable:!0}}),Object.defineProperty(f,"prototype",{writable:!1}),i&&ue(f,i)}function q(){try{var f=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(q=function(){return!!f})()}function ue(f,i){return ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,c){return s.__proto__=c,s},ue(f,i)}function ce(f,i,s,c){var w=ne(ee(1&c?f.prototype:f),i,s);return 2&c&&typeof w=="function"?function(L){return w.apply(s,L)}:w}function de(f){return(function(i){if(Array.isArray(i))return k(i)})(f)||(function(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)})(f)||je(f)||(function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function Pe(f){var i=(function(s,c){if(typeof s!="object"||!s)return s;var w=s[Symbol.toPrimitive];if(w!==void 0){var L=w.call(s,c);if(typeof L!="object")return L;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(f,"string");return typeof i=="symbol"?i:i+""}function je(f,i){if(f){if(typeof f=="string")return k(f,i);var s={}.toString.call(f).slice(8,-1);return s==="Object"&&f.constructor&&(s=f.constructor.name),s==="Map"||s==="Set"?Array.from(f):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?k(f,i):void 0}}function Te(f){var i=typeof Map=="function"?new Map:void 0;return Te=function(s){if(s===null||!(function(w){try{return Function.toString.call(w).indexOf("[native code]")!==-1}catch{return typeof w=="function"}})(s))return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(i!==void 0){if(i.has(s))return i.get(s);i.set(s,c)}function c(){return O(s,arguments,ee(this).constructor)}return c.prototype=Object.create(s.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),ue(c,s)},Te(f)}var qe=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(i){this._quadrantSegments=i,this._quadrantSegments===0&&(this._joinStyle=f.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=f.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),i<=0&&(this._quadrantSegments=1),this._joinStyle!==f.JOIN_ROUND&&(this._quadrantSegments=f.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(i){this._joinStyle=i}},{key:"setSimplifyFactor",value:function(i){this._simplifyFactor=i<0?0:i}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(i){this._endCapStyle=i}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(i){this._mitreLimit=i}},{key:"setSingleSided",value:function(i){this._isSingleSided=i}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=f.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=f.CAP_ROUND,this._joinStyle=f.JOIN_ROUND,this._mitreLimit=f.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=f.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var i=arguments[0];this.setQuadrantSegments(i)}else if(arguments.length===2){var s=arguments[0],c=arguments[1];this.setQuadrantSegments(s),this.setEndCapStyle(c)}else if(arguments.length===4){var w=arguments[0],L=arguments[1],F=arguments[2],H=arguments[3];this.setQuadrantSegments(w),this.setEndCapStyle(L),this.setJoinStyle(F),this.setMitreLimit(H)}}}},{key:"bufferDistanceError",value:function(i){var s=Math.PI/2/i;return 1-Math.cos(s/2)}}])})();qe.CAP_ROUND=1,qe.CAP_FLAT=2,qe.CAP_SQUARE=3,qe.JOIN_ROUND=1,qe.JOIN_MITRE=2,qe.JOIN_BEVEL=3,qe.DEFAULT_QUADRANT_SEGMENTS=8,qe.DEFAULT_MITRE_LIMIT=5,qe.DEFAULT_SIMPLIFY_FACTOR=.01;var tt=(function(f){function i(s){var c;return C(this,i),(c=P(this,i,[s])).name=Object.keys({Exception:i})[0],c}return B(i,f),h(i,[{key:"toString",value:function(){return this.message}}])})(Te(Error)),nt=(function(f){function i(s){var c;return C(this,i),(c=P(this,i,[s])).name=Object.keys({IllegalArgumentException:i})[0],c}return B(i,f),h(i)})(tt),it=(function(){return h((function f(){C(this,f)}),[{key:"filter",value:function(f){}}])})();function Ge(){}function ht(){}function mt(){}var Kt,St,Ht,Vt,ct,en,fn,rn,wt=(function(){return h((function f(){C(this,f)}),null,[{key:"equalsWithTolerance",value:function(f,i,s){return Math.abs(f-i)<=s}}])})(),Ft=(function(){return h((function f(i,s){C(this,f),this.low=s||0,this.high=i||0}),null,[{key:"toBinaryString",value:function(f){var i,s="";for(i=2147483648;i>0;i>>>=1)s+=(f.high&i)===i?"1":"0";for(i=2147483648;i>0;i>>>=1)s+=(f.low&i)===i?"1":"0";return s}}])})();function et(){}function Le(){}et.NaN=NaN,et.isNaN=function(f){return Number.isNaN(f)},et.isInfinite=function(f){return!Number.isFinite(f)},et.MAX_VALUE=Number.MAX_VALUE,et.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,et.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(en=2146435072,fn=new Float64Array(1),rn=new Int32Array(fn.buffer),et.doubleToLongBits=function(f){fn[0]=f;var i=0|rn[0],s=0|rn[1];return(s&en)===en&&1048575&s&&i!==0&&(i=0,s=2146959360),new Ft(s,i)},et.longBitsToDouble=function(f){return rn[0]=f.low,rn[1]=f.high,fn[0]}):(Kt=1023,St=Math.log2,Ht=Math.floor,Vt=Math.pow,ct=(function(){for(var f=53;f>0;f--){var i=Vt(2,f)-1;if(Ht(St(i))+1===f)return i}return 0})(),et.doubleToLongBits=function(f){var i,s,c,w,L,F,H,re,fe;if(f<0||1/f===Number.NEGATIVE_INFINITY?(F=1<<31,f=-f):F=0,f===0)return new Ft(re=F,fe=0);if(f===1/0)return new Ft(re=2146435072|F,fe=0);if(f!=f)return new Ft(re=2146959360,fe=0);if(w=0,fe=0,(i=Ht(f))>1)if(i<=ct)(w=Ht(St(i)))<=20?(fe=0,re=i<<20-w&1048575):(fe=i%(s=Vt(2,c=w-20))<<32-c,re=i/s&1048575);else for(c=i,fe=0;(c=Ht(s=c/2))!==0;)w++,fe>>>=1,fe|=(1&re)<<31,re>>>=1,s!==c&&(re|=524288);if(H=w+Kt,L=i===0,i=f-i,w<52&&i!==0)for(c=0;;){if((s=2*i)>=1?(i=s-1,L?(H--,L=!1):(c<<=1,c|=1,w++)):(i=s,L?--H==0&&(w++,L=!1):(c<<=1,w++)),w===20)re|=c,c=0;else if(w===52){fe|=c;break}if(s===1){w<20?re|=c<<20-w:w<52&&(fe|=c<<52-w);break}}return re|=H<<20,new Ft(re|=F,fe)},et.longBitsToDouble=function(f){var i,s,c,w,L=f.high,F=f.low,H=L&1<<31?-1:1;for(c=((2146435072&L)>>20)-Kt,w=0,s=1<<19,i=1;i<=20;i++)L&s&&(w+=Vt(2,-i)),s>>>=1;for(s=1<<31,i=21;i<=52;i++)F&s&&(w+=Vt(2,-i)),s>>>=1;if(c===-1023){if(w===0)return 0*H;c=-1022}else{if(c===1024)return w===0?H/0:NaN;w+=1}return H*w*Vt(2,c)});var rt=(function(f){function i(s){var c;return C(this,i),(c=P(this,i,[s])).name=Object.keys({RuntimeException:i})[0],c}return B(i,f),h(i)})(tt),an=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,null,[{key:"constructor_",value:function(){if(arguments.length===0)rt.constructor_.call(this);else if(arguments.length===1){var s=arguments[0];rt.constructor_.call(this,s)}}}])})(rt),Pt=(function(){function f(){C(this,f)}return h(f,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)f.shouldNeverReachHere(null);else if(arguments.length===1){var i=arguments[0];throw new an("Should never reach here"+(i!==null?": "+i:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var i=arguments[0];f.isTrue(i,null)}else if(arguments.length===2){var s=arguments[1];if(!arguments[0])throw s===null?new an:new an(s)}}},{key:"equals",value:function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];f.equals(i,s,null)}else if(arguments.length===3){var c=arguments[0],w=arguments[1],L=arguments[2];if(!w.equals(c))throw new an("Expected "+c+" but encountered "+w+(L!==null?": "+L:""))}}}])})(),yn=new ArrayBuffer(8),zn=new Float64Array(yn),Rn=new Int32Array(yn),Re=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"getM",value:function(){return et.NaN}},{key:"setOrdinate",value:function(i,s){switch(i){case f.X:this.x=s;break;case f.Y:this.y=s;break;case f.Z:this.setZ(s);break;default:throw new nt("Invalid ordinate index: "+i)}}},{key:"equals2D",value:function(){if(arguments.length===1){var i=arguments[0];return this.x===i.x&&this.y===i.y}if(arguments.length===2){var s=arguments[0],c=arguments[1];return!!wt.equalsWithTolerance(this.x,s.x,c)&&!!wt.equalsWithTolerance(this.y,s.y,c)}}},{key:"setM",value:function(i){throw new nt("Invalid ordinate index: "+f.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(i){switch(i){case f.X:return this.x;case f.Y:return this.y;case f.Z:return this.getZ()}throw new nt("Invalid ordinate index: "+i)}},{key:"equals3D",value:function(i){return this.x===i.x&&this.y===i.y&&(this.getZ()===i.getZ()||et.isNaN(this.getZ())&&et.isNaN(i.getZ()))}},{key:"equals",value:function(i){return i instanceof f&&this.equals2D(i)}},{key:"equalInZ",value:function(i,s){return wt.equalsWithTolerance(this.getZ(),i.getZ(),s)}},{key:"setX",value:function(i){this.x=i}},{key:"compareTo",value:function(i){var s=i;return this.x<s.x?-1:this.x>s.x?1:this.y<s.y?-1:this.y>s.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(i){this.z=i}},{key:"clone",value:function(){try{return null}catch(i){if(i instanceof CloneNotSupportedException)return Pt.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw i}}},{key:"copy",value:function(){return new f(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(i){var s=this.x-i.x,c=this.y-i.y,w=this.getZ()-i.getZ();return Math.sqrt(s*s+c*c+w*w)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(i){this.y=i}},{key:"distance",value:function(i){var s=this.x-i.x,c=this.y-i.y;return Math.sqrt(s*s+c*c)}},{key:"hashCode",value:function(){var i=17;return i=37*(i=37*i+f.hashCode(this.x))+f.hashCode(this.y)}},{key:"setCoordinate",value:function(i){this.x=i.x,this.y=i.y,this.z=i.getZ()}},{key:"interfaces_",get:function(){return[Ge,ht,mt]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)f.constructor_.call(this,0,0);else if(arguments.length===1){var i=arguments[0];f.constructor_.call(this,i.x,i.y,i.getZ())}else if(arguments.length===2){var s=arguments[0],c=arguments[1];f.constructor_.call(this,s,c,f.NULL_ORDINATE)}else if(arguments.length===3){var w=arguments[0],L=arguments[1],F=arguments[2];this.x=w,this.y=L,this.z=F}}},{key:"hashCode",value:function(i){return zn[0]=i,Rn[0]^Rn[1]}}])})(),ei=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"compare",value:function(i,s){var c=f.compare(i.x,s.x);if(c!==0)return c;var w=f.compare(i.y,s.y);return w!==0?w:this._dimensionsToTest<=2?0:f.compare(i.getZ(),s.getZ())}},{key:"interfaces_",get:function(){return[Le]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)f.constructor_.call(this,2);else if(arguments.length===1){var i=arguments[0];if(i!==2&&i!==3)throw new nt("only 2 or 3 dimensions may be specified");this._dimensionsToTest=i}}},{key:"compare",value:function(i,s){return i<s?-1:i>s?1:et.isNaN(i)?et.isNaN(s)?0:-1:et.isNaN(s)?1:0}}])})();Re.DimensionalComparator=ei,Re.NULL_ORDINATE=et.NaN,Re.X=0,Re.Y=1,Re.Z=2,Re.M=3;var Cn=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(i){if(!(i instanceof f))return!1;var s=i;return this.isNull()?s.isNull():this._maxx===s.getMaxX()&&this._maxy===s.getMaxY()&&this._minx===s.getMinX()&&this._miny===s.getMinY()}},{key:"intersection",value:function(i){if(this.isNull()||i.isNull()||!this.intersects(i))return new f;var s=this._minx>i._minx?this._minx:i._minx,c=this._miny>i._miny?this._miny:i._miny;return new f(s,this._maxx<i._maxx?this._maxx:i._maxx,c,this._maxy<i._maxy?this._maxy:i._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof Re){var i=arguments[0];return this.covers(i.x,i.y)}if(arguments[0]instanceof f){var s=arguments[0];return!this.isNull()&&!s.isNull()&&s.getMinX()>=this._minx&&s.getMaxX()<=this._maxx&&s.getMinY()>=this._miny&&s.getMaxY()<=this._maxy}}else if(arguments.length===2){var c=arguments[0],w=arguments[1];return!this.isNull()&&c>=this._minx&&c<=this._maxx&&w>=this._miny&&w<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof f){var i=arguments[0];return!this.isNull()&&!i.isNull()&&!(i._minx>this._maxx||i._maxx<this._minx||i._miny>this._maxy||i._maxy<this._miny)}if(arguments[0]instanceof Re){var s=arguments[0];return this.intersects(s.x,s.y)}}else if(arguments.length===2){if(arguments[0]instanceof Re&&arguments[1]instanceof Re){var c=arguments[0],w=arguments[1];return!this.isNull()&&!((c.x<w.x?c.x:w.x)>this._maxx)&&!((c.x>w.x?c.x:w.x)<this._minx)&&!((c.y<w.y?c.y:w.y)>this._maxy)&&!((c.y>w.y?c.y:w.y)<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var L=arguments[0],F=arguments[1];return!this.isNull()&&!(L>this._maxx||L<this._minx||F>this._maxy||F<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var i=this.getWidth(),s=this.getHeight();return Math.sqrt(i*i+s*s)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof Re){var i=arguments[0];this.expandToInclude(i.x,i.y)}else if(arguments[0]instanceof f){var s=arguments[0];if(s.isNull())return null;this.isNull()?(this._minx=s.getMinX(),this._maxx=s.getMaxX(),this._miny=s.getMinY(),this._maxy=s.getMaxY()):(s._minx<this._minx&&(this._minx=s._minx),s._maxx>this._maxx&&(this._maxx=s._maxx),s._miny<this._miny&&(this._miny=s._miny),s._maxy>this._maxy&&(this._maxy=s._maxy))}}else if(arguments.length===2){var c=arguments[0],w=arguments[1];this.isNull()?(this._minx=c,this._maxx=c,this._miny=w,this._maxy=w):(c<this._minx&&(this._minx=c),c>this._maxx&&(this._maxx=c),w<this._miny&&(this._miny=w),w>this._maxy&&(this._maxy=w))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var i=this.getWidth(),s=this.getHeight();return i<s?i:s}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(i){var s=i;return this.isNull()?s.isNull()?0:-1:s.isNull()?1:this._minx<s._minx?-1:this._minx>s._minx?1:this._miny<s._miny?-1:this._miny>s._miny?1:this._maxx<s._maxx?-1:this._maxx>s._maxx?1:this._maxy<s._maxy?-1:this._maxy>s._maxy?1:0}},{key:"translate",value:function(i,s){if(this.isNull())return null;this.init(this.getMinX()+i,this.getMaxX()+i,this.getMinY()+s,this.getMaxY()+s)}},{key:"copy",value:function(){return new f(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(i){return!(!this.isNull()&&!i.isNull())||i._minx>this._maxx||i._maxx<this._minx||i._miny>this._maxy||i._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var i=this.getWidth(),s=this.getHeight();return i>s?i:s}},{key:"expandBy",value:function(){if(arguments.length===1){var i=arguments[0];this.expandBy(i,i)}else if(arguments.length===2){var s=arguments[0],c=arguments[1];if(this.isNull())return null;this._minx-=s,this._maxx+=s,this._miny-=c,this._maxy+=c,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof f){var i=arguments[0];return this.covers(i)}if(arguments[0]instanceof Re){var s=arguments[0];return this.covers(s)}}else if(arguments.length===2){var c=arguments[0],w=arguments[1];return this.covers(c,w)}}},{key:"centre",value:function(){return this.isNull()?null:new Re((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Re){var i=arguments[0];this.init(i.x,i.x,i.y,i.y)}else if(arguments[0]instanceof f){var s=arguments[0];this._minx=s._minx,this._maxx=s._maxx,this._miny=s._miny,this._maxy=s._maxy}}else if(arguments.length===2){var c=arguments[0],w=arguments[1];this.init(c.x,w.x,c.y,w.y)}else if(arguments.length===4){var L=arguments[0],F=arguments[1],H=arguments[2],re=arguments[3];L<F?(this._minx=L,this._maxx=F):(this._minx=F,this._maxx=L),H<re?(this._miny=H,this._maxy=re):(this._miny=re,this._maxy=H)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(i){if(this.intersects(i))return 0;var s=0;this._maxx<i._minx?s=i._minx-this._maxx:this._minx>i._maxx&&(s=this._minx-i._maxx);var c=0;return this._maxy<i._miny?c=i._miny-this._maxy:this._miny>i._maxy&&(c=this._miny-i._maxy),s===0?c:c===0?s:Math.sqrt(s*s+c*c)}},{key:"hashCode",value:function(){var i=17;return i=37*(i=37*(i=37*(i=37*i+Re.hashCode(this._minx))+Re.hashCode(this._maxx))+Re.hashCode(this._miny))+Re.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[Ge,mt]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Re){var i=arguments[0];this.init(i.x,i.x,i.y,i.y)}else if(arguments[0]instanceof f){var s=arguments[0];this.init(s)}}else if(arguments.length===2){var c=arguments[0],w=arguments[1];this.init(c.x,w.x,c.y,w.y)}else if(arguments.length===4){var L=arguments[0],F=arguments[1],H=arguments[2],re=arguments[3];this.init(L,F,H,re)}}},{key:"intersects",value:function(){if(arguments.length===3){var i=arguments[0],s=arguments[1],c=arguments[2];return c.x>=(i.x<s.x?i.x:s.x)&&c.x<=(i.x>s.x?i.x:s.x)&&c.y>=(i.y<s.y?i.y:s.y)&&c.y<=(i.y>s.y?i.y:s.y)}if(arguments.length===4){var w=arguments[0],L=arguments[1],F=arguments[2],H=arguments[3],re=Math.min(F.x,H.x),fe=Math.max(F.x,H.x),De=Math.min(w.x,L.x),$e=Math.max(w.x,L.x);return!(De>fe)&&!($e<re)&&(re=Math.min(F.y,H.y),fe=Math.max(F.y,H.y),De=Math.min(w.y,L.y),$e=Math.max(w.y,L.y),!(De>fe)&&!($e<re))}}}])})(),Wt=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===f.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(i){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(i){return this===i||this.equalsExact(i,0)}},{key:"geometryChanged",value:function(){this.apply(f.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(i){return i!==null&&this.norm().equalsExact(i.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var i;if(arguments.length===1){var s=arguments[0];return i=s,this.getTypeCode()!==i.getTypeCode()?this.getTypeCode()-i.getTypeCode():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(s)}if(arguments.length===2){var c=arguments[0],w=arguments[1];return i=c,this.getTypeCode()!==i.getTypeCode()?this.getTypeCode()-i.getTypeCode():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(c,w)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(i){if(i.getTypeCode()===f.TYPECODE_GEOMETRYCOLLECTION)throw new nt("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(i,s,c){return c===0?i.equals(s):i.distance(s)<=c}},{key:"norm",value:function(){var i=this.copy();return i.normalize(),i}},{key:"reverse",value:function(){var i=this.reverseInternal();return this.envelope!=null&&(i.envelope=this.envelope.copy()),i.setSRID(this.getSRID()),i}},{key:"copy",value:function(){var i=this.copyInternal();return i.envelope=this._envelope==null?null:this._envelope.copy(),i._SRID=this._SRID,i._userData=this._userData,i}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Cn(this._envelope)}},{key:"setSRID",value:function(i){this._SRID=i}},{key:"setUserData",value:function(i){this._userData=i}},{key:"compare",value:function(i,s){for(var c=i.iterator(),w=s.iterator();c.hasNext()&&w.hasNext();){var L=c.next(),F=w.next(),H=L.compareTo(F);if(H!==0)return H}return c.hasNext()?1:w.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(i){return this.getClass()===i.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===f.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===f.TYPECODE_MULTIPOINT||this.getTypeCode()===f.TYPECODE_MULTILINESTRING||this.getTypeCode()===f.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[ht,Ge,mt]}},{key:"getClass",value:function(){return f}}],[{key:"hasNonEmptyElements",value:function(i){for(var s=0;s<i.length;s++)if(!i[s].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(i){for(var s=0;s<i.length;s++)if(i[s]===null)return!0;return!1}}])})();Wt.constructor_=function(f){f&&(this._envelope=null,this._userData=null,this._factory=f,this._SRID=f.getSRID())},Wt.TYPECODE_POINT=0,Wt.TYPECODE_MULTIPOINT=1,Wt.TYPECODE_LINESTRING=2,Wt.TYPECODE_LINEARRING=3,Wt.TYPECODE_MULTILINESTRING=4,Wt.TYPECODE_POLYGON=5,Wt.TYPECODE_MULTIPOLYGON=6,Wt.TYPECODE_GEOMETRYCOLLECTION=7,Wt.TYPENAME_POINT="Point",Wt.TYPENAME_MULTIPOINT="MultiPoint",Wt.TYPENAME_LINESTRING="LineString",Wt.TYPENAME_LINEARRING="LinearRing",Wt.TYPENAME_MULTILINESTRING="MultiLineString",Wt.TYPENAME_POLYGON="Polygon",Wt.TYPENAME_MULTIPOLYGON="MultiPolygon",Wt.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",Wt.geometryChangedFilter={get interfaces_(){return[it]},filter:function(f){f.geometryChangedAction()}};var we=(function(){function f(){C(this,f)}return h(f,null,[{key:"toLocationSymbol",value:function(i){switch(i){case f.EXTERIOR:return"e";case f.BOUNDARY:return"b";case f.INTERIOR:return"i";case f.NONE:return"-"}throw new nt("Unknown location value: "+i)}}])})();we.INTERIOR=0,we.BOUNDARY=1,we.EXTERIOR=2,we.NONE=-1;var Gi=(function(){return h((function f(){C(this,f)}),[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}])})(),Ur=(function(f){function i(s){var c;return C(this,i),(c=P(this,i,[s])).name=Object.keys({NoSuchElementException:i})[0],c}return B(i,f),h(i)})(tt),Rr=(function(f){function i(s){var c;return C(this,i),(c=P(this,i,[s])).name=Object.keys({UnsupportedOperationException:i})[0],c}return B(i,f),h(i)})(tt),We=(function(f){function i(){return C(this,i),P(this,i,arguments)}return B(i,f),h(i,[{key:"contains",value:function(){}}])})(Gi),ds=(function(f){function i(s){var c;return C(this,i),(c=P(this,i)).map=new Map,s instanceof Gi&&c.addAll(s),c}return B(i,f),h(i,[{key:"contains",value:function(s){var c=s.hashCode?s.hashCode():s;return!!this.map.has(c)}},{key:"add",value:function(s){var c=s.hashCode?s.hashCode():s;return!this.map.has(c)&&!!this.map.set(c,s)}},{key:"addAll",value:function(s){var c,w=K(s);try{for(w.s();!(c=w.n()).done;){var L=c.value;this.add(L)}}catch(F){w.e(F)}finally{w.f()}return!0}},{key:"remove",value:function(){throw new Rr}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new To(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])})(We),To=(function(){return h((function f(i){C(this,f),this.iterator=i.values();var s=this.iterator.next(),c=s.done,w=s.value;this.done=c,this.value=w}),[{key:"next",value:function(){if(this.done)throw new Ur;var f=this.value,i=this.iterator.next(),s=i.done,c=i.value;return this.done=s,this.value=c,f}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new Rr}}])})(),ot=(function(){function f(){C(this,f)}return h(f,null,[{key:"opposite",value:function(i){return i===f.LEFT?f.RIGHT:i===f.RIGHT?f.LEFT:i}}])})();ot.ON=0,ot.LEFT=1,ot.RIGHT=2;var ai=(function(f){function i(s){var c;return C(this,i),(c=P(this,i,[s])).name=Object.keys({EmptyStackException:i})[0],c}return B(i,f),h(i)})(tt),ps=(function(f){function i(s){var c;return C(this,i),(c=P(this,i,[s])).name=Object.keys({IndexOutOfBoundsException:i})[0],c}return B(i,f),h(i)})(tt),pr=(function(f){function i(){return C(this,i),P(this,i,arguments)}return B(i,f),h(i,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])})(Gi),As=(function(f){function i(){var s;return C(this,i),(s=P(this,i)).array=[],s}return B(i,f),h(i,[{key:"add",value:function(s){return this.array.push(s),!0}},{key:"get",value:function(s){if(s<0||s>=this.size())throw new ps;return this.array[s]}},{key:"push",value:function(s){return this.array.push(s),s}},{key:"pop",value:function(){if(this.array.length===0)throw new ai;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new ai;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(s){return this.array.indexOf(s)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])})(pr);function vn(f,i){return f.interfaces_&&f.interfaces_.indexOf(i)>-1}var ir=(function(){return h((function f(i){C(this,f),this.str=i}),[{key:"append",value:function(f){this.str+=f}},{key:"setCharAt",value:function(f,i){this.str=this.str.substr(0,f)+i+this.str.substr(f+1)}},{key:"toString",value:function(){return this.str}}])})(),sa=(function(){function f(i){C(this,f),this.value=i}return h(f,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(i){return this.value<i?-1:this.value>i?1:0}}],[{key:"compare",value:function(i,s){return i<s?-1:i>s?1:0}},{key:"isNan",value:function(i){return Number.isNaN(i)}},{key:"valueOf",value:function(i){return new f(i)}}])})(),aa=(function(){return h((function f(){C(this,f)}),null,[{key:"isWhitespace",value:function(f){return f<=32&&f>=0||f===127}},{key:"toUpperCase",value:function(f){return f.toUpperCase()}}])})(),Je=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"le",value:function(i){return this._hi<i._hi||this._hi===i._hi&&this._lo<=i._lo}},{key:"extractSignificantDigits",value:function(i,s){var c=this.abs(),w=f.magnitude(c._hi),L=f.TEN.pow(w);(c=c.divide(L)).gt(f.TEN)?(c=c.divide(f.TEN),w+=1):c.lt(f.ONE)&&(c=c.multiply(f.TEN),w-=1);for(var F=w+1,H=new ir,re=f.MAX_PRINT_DIGITS-1,fe=0;fe<=re;fe++){i&&fe===F&&H.append(".");var De=Math.trunc(c._hi);if(De<0)break;var $e=!1,ut=0;De>9?($e=!0,ut="9"):ut="0"+De,H.append(ut),c=c.subtract(f.valueOf(De)).multiply(f.TEN),$e&&c.selfAdd(f.TEN);var At=!0,Gt=f.magnitude(c._hi);if(Gt<0&&Math.abs(Gt)>=re-fe&&(At=!1),!At)break}return s[0]=w,H.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof f){var i=arguments[0];return this.add(i.negate())}if(typeof arguments[0]=="number"){var s=arguments[0];return this.add(-s)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof f){var i=arguments[0];return this._hi===i._hi&&this._lo===i._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof f){var i=arguments[0];return this.isNaN()?this:this.selfAdd(-i._hi,-i._lo)}if(typeof arguments[0]=="number"){var s=arguments[0];return this.isNaN()?this:this.selfAdd(-s,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(i){return this.le(i)?this:i}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof f){var i=arguments[0];return this.selfDivide(i._hi,i._lo)}if(typeof arguments[0]=="number"){var s=arguments[0];return this.selfDivide(s,0)}}else if(arguments.length===2){var c,w,L,F,H=arguments[0],re=arguments[1],fe=null,De=null,$e=null,ut=null;return L=this._hi/H,ut=(fe=($e=f.SPLIT*L)-(fe=$e-L))*(De=(ut=f.SPLIT*H)-(De=ut-H))-(F=L*H)+fe*(w=H-De)+(c=L-fe)*De+c*w,ut=L+($e=(this._hi-F-ut+this._lo-L*re)/H),this._hi=ut,this._lo=L-ut+$e,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof f){var i,s,c,w,L=arguments[0],F=null,H=null,re=null,fe=null;return i=(c=this._hi/L._hi)-(F=(re=f.SPLIT*c)-(F=re-c)),fe=F*(H=(fe=f.SPLIT*L._hi)-(H=fe-L._hi))-(w=c*L._hi)+F*(s=L._hi-H)+i*H+i*s,new f(fe=c+(re=(this._hi-w-fe+this._lo-c*L._lo)/L._hi),c-fe+re)}if(typeof arguments[0]=="number"){var De=arguments[0];return et.isNaN(De)?f.createNaN():f.copy(this).selfDivide(De,0)}}},{key:"ge",value:function(i){return this._hi>i._hi||this._hi===i._hi&&this._lo>=i._lo}},{key:"pow",value:function(i){if(i===0)return f.valueOf(1);var s=new f(this),c=f.valueOf(1),w=Math.abs(i);if(w>1)for(;w>0;)w%2==1&&c.selfMultiply(s),(w/=2)>0&&(s=s.sqr());else c=s;return i<0?c.reciprocal():c}},{key:"ceil",value:function(){if(this.isNaN())return f.NaN;var i=Math.ceil(this._hi),s=0;return i===this._hi&&(s=Math.ceil(this._lo)),new f(i,s)}},{key:"compareTo",value:function(i){var s=i;return this._hi<s._hi?-1:this._hi>s._hi?1:this._lo<s._lo?-1:this._lo>s._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof f){var i=arguments[0];return this.init(i),this}if(typeof arguments[0]=="number"){var s=arguments[0];return this.init(s),this}}},{key:"max",value:function(i){return this.ge(i)?this:i}},{key:"sqrt",value:function(){if(this.isZero())return f.valueOf(0);if(this.isNegative())return f.NaN;var i=1/Math.sqrt(this._hi),s=this._hi*i,c=f.valueOf(s),w=this.subtract(c.sqr())._hi*(.5*i);return c.add(w)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof f){var i=arguments[0];return this.selfAdd(i._hi,i._lo)}if(typeof arguments[0]=="number"){var s,c,w,L,F,H=arguments[0],re=null;return re=(w=this._hi+H)-(L=w-this._hi),c=(F=(re=H-L+(this._hi-re))+this._lo)+(w-(s=w+F)),this._hi=s+c,this._lo=c+(s-this._hi),this}}else if(arguments.length===2){var fe,De,$e,ut,At=arguments[0],Gt=arguments[1],on=null,Nn=null,An=null;$e=this._hi+At,De=this._lo+Gt,Nn=$e-(An=$e-this._hi),on=De-(ut=De-this._lo);var Un=(fe=$e+(An=(Nn=At-An+(this._hi-Nn))+De))+(An=(on=Gt-ut+(this._lo-on))+(An+($e-fe))),Ti=An+(fe-Un);return this._hi=Un,this._lo=Ti,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof f){var i=arguments[0];return this.selfMultiply(i._hi,i._lo)}if(typeof arguments[0]=="number"){var s=arguments[0];return this.selfMultiply(s,0)}}else if(arguments.length===2){var c,w,L=arguments[0],F=arguments[1],H=null,re=null,fe=null,De=null;H=(fe=f.SPLIT*this._hi)-this._hi,De=f.SPLIT*L,H=fe-H,c=this._hi-H,re=De-L;var $e=(fe=this._hi*L)+(De=H*(re=De-re)-fe+H*(w=L-re)+c*re+c*w+(this._hi*F+this._lo*L)),ut=De+(H=fe-$e);return this._hi=$e,this._lo=ut,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return f.NaN;var i=Math.floor(this._hi),s=0;return i===this._hi&&(s=Math.floor(this._lo)),new f(i,s)}},{key:"negate",value:function(){return this.isNaN()?this:new f(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(i){if(i instanceof CloneNotSupportedException)return null;throw i}}},{key:"multiply",value:function(){if(arguments[0]instanceof f){var i=arguments[0];return i.isNaN()?f.createNaN():f.copy(this).selfMultiply(i)}if(typeof arguments[0]=="number"){var s=arguments[0];return et.isNaN(s)?f.createNaN():f.copy(this).selfMultiply(s,0)}}},{key:"isNaN",value:function(){return et.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var i=f.magnitude(this._hi);return i>=-3&&i<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var i=this.getSpecialNumberString();if(i!==null)return i;var s=new Array(1).fill(null),c=this.extractSignificantDigits(!0,s),w=s[0]+1,L=c;if(c.charAt(0)===".")L="0"+c;else if(w<0)L="0."+f.stringOfChar("0",-w)+c;else if(c.indexOf(".")===-1){var F=w-c.length;L=c+f.stringOfChar("0",F)+".0"}return this.isNegative()?"-"+L:L}},{key:"reciprocal",value:function(){var i,s,c,w,L=null,F=null,H=null,re=null;i=(c=1/this._hi)-(L=(H=f.SPLIT*c)-(L=H-c)),F=(re=f.SPLIT*this._hi)-this._hi;var fe=c+(H=(1-(w=c*this._hi)-(re=L*(F=re-F)-w+L*(s=this._hi-F)+i*F+i*s)-c*this._lo)/this._hi);return new f(fe,c-fe+H)}},{key:"toSciNotation",value:function(){if(this.isZero())return f.SCI_NOT_ZERO;var i=this.getSpecialNumberString();if(i!==null)return i;var s=new Array(1).fill(null),c=this.extractSignificantDigits(!1,s),w=f.SCI_NOT_EXPONENT_CHAR+s[0];if(c.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+c);var L="";c.length>1&&(L=c.substring(1));var F=c.charAt(0)+"."+L;return this.isNegative()?"-"+F+w:F+w}},{key:"abs",value:function(){return this.isNaN()?f.NaN:this.isNegative()?this.negate():new f(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(i){return this._hi<i._hi||this._hi===i._hi&&this._lo<i._lo}},{key:"add",value:function(){if(arguments[0]instanceof f){var i=arguments[0];return f.copy(this).selfAdd(i)}if(typeof arguments[0]=="number"){var s=arguments[0];return f.copy(this).selfAdd(s)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var i=arguments[0];this._hi=i,this._lo=0}else if(arguments[0]instanceof f){var s=arguments[0];this._hi=s._hi,this._lo=s._lo}}else if(arguments.length===2){var c=arguments[0],w=arguments[1];this._hi=c,this._lo=w}}},{key:"gt",value:function(i){return this._hi>i._hi||this._hi===i._hi&&this._lo>i._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?f.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[mt,Ge,ht]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var i=arguments[0];this.init(i)}else if(arguments[0]instanceof f){var s=arguments[0];this.init(s)}else if(typeof arguments[0]=="string"){var c=arguments[0];f.constructor_.call(this,f.parse(c))}}else if(arguments.length===2){var w=arguments[0],L=arguments[1];this.init(w,L)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],s=arguments[1],c=arguments[2],w=arguments[3];return f.determinant(f.valueOf(i),f.valueOf(s),f.valueOf(c),f.valueOf(w))}if(arguments[3]instanceof f&&arguments[2]instanceof f&&arguments[0]instanceof f&&arguments[1]instanceof f){var L=arguments[1],F=arguments[2],H=arguments[3];return arguments[0].multiply(H).selfSubtract(L.multiply(F))}}},{key:"sqr",value:function(i){return f.valueOf(i).selfMultiply(i)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var i=arguments[0];return f.parse(i)}if(typeof arguments[0]=="number")return new f(arguments[0])}},{key:"sqrt",value:function(i){return f.valueOf(i).sqrt()}},{key:"parse",value:function(i){for(var s=0,c=i.length;aa.isWhitespace(i.charAt(s));)s++;var w=!1;if(s<c){var L=i.charAt(s);L!=="-"&&L!=="+"||(s++,L==="-"&&(w=!0))}for(var F=new f,H=0,re=0,fe=0,De=!1;!(s>=c);){var $e=i.charAt(s);if(s++,aa.isDigit($e)){var ut=$e-"0";F.selfMultiply(f.TEN),F.selfAdd(ut),H++}else{if($e!=="."){if($e==="e"||$e==="E"){var At=i.substring(s);try{fe=sa.parseInt(At)}catch(Un){throw Un instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+At+" in string "+i):Un}break}throw new NumberFormatException("Unexpected character '"+$e+"' at position "+s+" in string "+i)}re=H,De=!0}}var Gt=F;De||(re=H);var on=H-re-fe;if(on===0)Gt=F;else if(on>0){var Nn=f.TEN.pow(on);Gt=F.divide(Nn)}else if(on<0){var An=f.TEN.pow(-on);Gt=F.multiply(An)}return w?Gt.negate():Gt}},{key:"createNaN",value:function(){return new f(et.NaN,et.NaN)}},{key:"copy",value:function(i){return new f(i)}},{key:"magnitude",value:function(i){var s=Math.abs(i),c=Math.log(s)/Math.log(10),w=Math.trunc(Math.floor(c));return 10*Math.pow(10,w)<=s&&(w+=1),w}},{key:"stringOfChar",value:function(i,s){for(var c=new ir,w=0;w<s;w++)c.append(i);return c.toString()}}])})();Je.PI=new Je(3.141592653589793,12246467991473532e-32),Je.TWO_PI=new Je(6.283185307179586,24492935982947064e-32),Je.PI_2=new Je(1.5707963267948966,6123233995736766e-32),Je.E=new Je(2.718281828459045,14456468917292502e-32),Je.NaN=new Je(et.NaN,et.NaN),Je.EPS=123259516440783e-46,Je.SPLIT=134217729,Je.MAX_PRINT_DIGITS=32,Je.TEN=Je.valueOf(10),Je.ONE=Je.valueOf(1),Je.SCI_NOT_EXPONENT_CHAR="E",Je.SCI_NOT_ZERO="0.0E0";var Vr=(function(){function f(){C(this,f)}return h(f,null,[{key:"orientationIndex",value:function(i,s,c){var w=f.orientationIndexFilter(i,s,c);if(w<=1)return w;var L=Je.valueOf(s.x).selfAdd(-i.x),F=Je.valueOf(s.y).selfAdd(-i.y),H=Je.valueOf(c.x).selfAdd(-s.x),re=Je.valueOf(c.y).selfAdd(-s.y);return L.selfMultiply(re).selfSubtract(F.selfMultiply(H)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof Je&&arguments[2]instanceof Je&&arguments[0]instanceof Je&&arguments[1]instanceof Je){var i=arguments[1],s=arguments[2],c=arguments[3];return arguments[0].multiply(c).selfSubtract(i.multiply(s)).signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var w=arguments[0],L=arguments[1],F=arguments[2],H=arguments[3],re=Je.valueOf(w),fe=Je.valueOf(L),De=Je.valueOf(F),$e=Je.valueOf(H);return re.multiply($e).selfSubtract(fe.multiply(De)).signum()}}},{key:"intersection",value:function(i,s,c,w){var L=new Je(i.y).selfSubtract(s.y),F=new Je(s.x).selfSubtract(i.x),H=new Je(i.x).selfMultiply(s.y).selfSubtract(new Je(s.x).selfMultiply(i.y)),re=new Je(c.y).selfSubtract(w.y),fe=new Je(w.x).selfSubtract(c.x),De=new Je(c.x).selfMultiply(w.y).selfSubtract(new Je(w.x).selfMultiply(c.y)),$e=F.multiply(De).selfSubtract(fe.multiply(H)),ut=re.multiply(H).selfSubtract(L.multiply(De)),At=L.multiply(fe).selfSubtract(re.multiply(F)),Gt=$e.selfDivide(At).doubleValue(),on=ut.selfDivide(At).doubleValue();return et.isNaN(Gt)||et.isInfinite(Gt)||et.isNaN(on)||et.isInfinite(on)?null:new Re(Gt,on)}},{key:"orientationIndexFilter",value:function(i,s,c){var w=null,L=(i.x-c.x)*(s.y-c.y),F=(i.y-c.y)*(s.x-c.x),H=L-F;if(L>0){if(F<=0)return f.signum(H);w=L+F}else{if(!(L<0)||F>=0)return f.signum(H);w=-L-F}var re=f.DP_SAFE_EPSILON*w;return H>=re||-H>=re?f.signum(H):2}},{key:"signum",value:function(i){return i>0?1:i<0?-1:0}}])})();Vr.DP_SAFE_EPSILON=1e-15;var dn=(function(){return h((function f(){C(this,f)}),[{key:"getM",value:function(f){if(this.hasM()){var i=this.getDimension()-this.getMeasures();return this.getOrdinate(f,i)}return et.NaN}},{key:"setOrdinate",value:function(f,i,s){}},{key:"getZ",value:function(f){return this.hasZ()?this.getOrdinate(f,2):et.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(f,i){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(f){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(f){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(f){}},{key:"copy",value:function(){}},{key:"getY",value:function(f){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[ht]}}])})();dn.X=0,dn.Y=1,dn.Z=2,dn.M=3;var tn=(function(){function f(){C(this,f)}return h(f,null,[{key:"index",value:function(i,s,c){return Vr.orientationIndex(i,s,c)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var i=arguments[0],s=i.length-1;if(s<3)throw new nt("Ring has fewer than 4 points, so orientation cannot be determined");for(var c=i[0],w=0,L=1;L<=s;L++){var F=i[L];F.y>c.y&&(c=F,w=L)}var H=w;do(H-=1)<0&&(H=s);while(i[H].equals2D(c)&&H!==w);var re=w;do re=(re+1)%s;while(i[re].equals2D(c)&&re!==w);var fe=i[H],De=i[re];if(fe.equals2D(c)||De.equals2D(c)||fe.equals2D(De))return!1;var $e=f.index(fe,c,De);return $e===0?fe.x>De.x:$e>0}if(vn(arguments[0],dn)){var ut=arguments[0],At=ut.size()-1;if(At<3)throw new nt("Ring has fewer than 4 points, so orientation cannot be determined");for(var Gt=ut.getCoordinate(0),on=0,Nn=1;Nn<=At;Nn++){var An=ut.getCoordinate(Nn);An.y>Gt.y&&(Gt=An,on=Nn)}var Un=null,Ti=on;do(Ti-=1)<0&&(Ti=At),Un=ut.getCoordinate(Ti);while(Un.equals2D(Gt)&&Ti!==on);var Yn=null,xr=on;do xr=(xr+1)%At,Yn=ut.getCoordinate(xr);while(Yn.equals2D(Gt)&&xr!==on);if(Un.equals2D(Gt)||Yn.equals2D(Gt)||Un.equals2D(Yn))return!1;var ao=f.index(Un,Gt,Yn);return ao===0?Un.x>Yn.x:ao>0}}}])})();tn.CLOCKWISE=-1,tn.RIGHT=tn.CLOCKWISE,tn.COUNTERCLOCKWISE=1,tn.LEFT=tn.COUNTERCLOCKWISE,tn.COLLINEAR=0,tn.STRAIGHT=tn.COLLINEAR;var Pa=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(f,i){var s=this.getRightmostSideOfSegment(f,i);return s<0&&(s=this.getRightmostSideOfSegment(f,i-1)),s<0&&(this._minCoord=null,this.checkForRightmostCoordinate(f)),s}},{key:"findRightmostEdgeAtVertex",value:function(){var f=this._minDe.getEdge().getCoordinates();Pt.isTrue(this._minIndex>0&&this._minIndex<f.length,"rightmost point expected to be interior vertex of edge");var i=f[this._minIndex-1],s=f[this._minIndex+1],c=tn.index(this._minCoord,s,i),w=!1;(i.y<this._minCoord.y&&s.y<this._minCoord.y&&c===tn.COUNTERCLOCKWISE||i.y>this._minCoord.y&&s.y>this._minCoord.y&&c===tn.CLOCKWISE)&&(w=!0),w&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(f,i){var s=f.getEdge().getCoordinates();if(i<0||i+1>=s.length||s[i].y===s[i+1].y)return-1;var c=ot.LEFT;return s[i].y<s[i+1].y&&(c=ot.RIGHT),c}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(f){for(var i=f.getEdge().getCoordinates(),s=0;s<i.length-1;s++)(this._minCoord===null||i[s].x>this._minCoord.x)&&(this._minDe=f,this._minIndex=s,this._minCoord=i[s])}},{key:"findRightmostEdgeAtNode",value:function(){var f=this._minDe.getNode().getEdges();this._minDe=f.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(f){for(var i=f.iterator();i.hasNext();){var s=i.next();s.isForward()&&this.checkForRightmostCoordinate(s)}Pt.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===ot.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}])})(),_t=(function(f){function i(s,c){var w;return C(this,i),(w=P(this,i,[c?s+" [ "+c+" ]":s])).pt=c?new Re(c):void 0,w.name=Object.keys({TopologyException:i})[0],w}return B(i,f),h(i,[{key:"getCoordinate",value:function(){return this.pt}}])})(rt),In=(function(){return h((function f(){C(this,f),this.array=[]}),[{key:"addLast",value:function(f){this.array.push(f)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}])})(),dt=(function(f){function i(s){var c;return C(this,i),(c=P(this,i)).array=[],s instanceof Gi&&c.addAll(s),c}return B(i,f),h(i,[{key:"interfaces_",get:function(){return[pr,Gi]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(s){return arguments.length===1?this.array.push(s):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(s){var c,w=K(s);try{for(w.s();!(c=w.n()).done;){var L=c.value;this.array.push(L)}}catch(F){w.e(F)}finally{w.f()}}},{key:"set",value:function(s,c){var w=this.array[s];return this.array[s]=c,w}},{key:"iterator",value:function(){return new mr(this)}},{key:"get",value:function(s){if(s<0||s>=this.size())throw new ps;return this.array[s]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(s){s?this.array.sort((function(c,w){return s.compare(c,w)})):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(s){for(var c=0,w=this.array.length;c<w;c++)if(this.array[c]===s)return!!this.array.splice(c,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])})(pr),mr=(function(){return h((function f(i){C(this,f),this.arrayList=i,this.position=0}),[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Ur;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(f){return this.arrayList.set(this.position-1,f)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}])})(),qr=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"clearVisitedEdges",value:function(){for(var f=this._dirEdgeList.iterator();f.hasNext();)f.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(f){for(var i=null,s=f.getEdges().iterator();s.hasNext();){var c=s.next();if(c.isVisited()||c.getSym().isVisited()){i=c;break}}if(i===null)throw new _t("unable to find edge to compute depths at "+f.getCoordinate());f.getEdges().computeDepths(i);for(var w=f.getEdges().iterator();w.hasNext();){var L=w.next();L.setVisited(!0),this.copySymDepths(L)}}},{key:"computeDepth",value:function(f){this.clearVisitedEdges();var i=this._finder.getEdge();i.getNode(),i.getLabel(),i.setEdgeDepths(ot.RIGHT,f),this.copySymDepths(i),this.computeDepths(i)}},{key:"create",value:function(f){this.addReachable(f),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var f=this._dirEdgeList.iterator();f.hasNext();){var i=f.next();i.getDepth(ot.RIGHT)>=1&&i.getDepth(ot.LEFT)<=0&&!i.isInteriorAreaEdge()&&i.setInResult(!0)}}},{key:"computeDepths",value:function(f){var i=new ds,s=new In,c=f.getNode();for(s.addLast(c),i.add(c),f.setVisited(!0);!s.isEmpty();){var w=s.removeFirst();i.add(w),this.computeNodeDepth(w);for(var L=w.getEdges().iterator();L.hasNext();){var F=L.next().getSym();if(!F.isVisited()){var H=F.getNode();i.contains(H)||(s.addLast(H),i.add(H))}}}}},{key:"compareTo",value:function(f){var i=f;return this._rightMostCoord.x<i._rightMostCoord.x?-1:this._rightMostCoord.x>i._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var f=new Cn,i=this._dirEdgeList.iterator();i.hasNext();)for(var s=i.next().getEdge().getCoordinates(),c=0;c<s.length-1;c++)f.expandToInclude(s[c]);this._env=f}return this._env}},{key:"addReachable",value:function(f){var i=new As;for(i.add(f);!i.empty();){var s=i.pop();this.add(s,i)}}},{key:"copySymDepths",value:function(f){var i=f.getSym();i.setDepth(ot.LEFT,f.getDepth(ot.RIGHT)),i.setDepth(ot.RIGHT,f.getDepth(ot.LEFT))}},{key:"add",value:function(f,i){f.setVisited(!0),this._nodes.add(f);for(var s=f.getEdges().iterator();s.hasNext();){var c=s.next();this._dirEdgeList.add(c);var w=c.getSym().getNode();w.isVisited()||i.push(w)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[Ge]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new dt,this._nodes=new dt,this._rightMostCoord=null,this._env=null,this._finder=new Pa}}])})(),pn=(function(){return h((function f(){C(this,f)}),null,[{key:"intersection",value:function(f,i,s,c){var w=f.x<i.x?f.x:i.x,L=f.y<i.y?f.y:i.y,F=f.x>i.x?f.x:i.x,H=f.y>i.y?f.y:i.y,re=s.x<c.x?s.x:c.x,fe=s.y<c.y?s.y:c.y,De=s.x>c.x?s.x:c.x,$e=s.y>c.y?s.y:c.y,ut=((w>re?w:re)+(F<De?F:De))/2,At=((L>fe?L:fe)+(H<$e?H:$e))/2,Gt=f.x-ut,on=f.y-At,Nn=i.x-ut,An=i.y-At,Un=s.x-ut,Ti=s.y-At,Yn=c.x-ut,xr=c.y-At,ao=on-An,Ll=Nn-Gt,vi=Gt*An-Nn*on,Hr=Ti-xr,Tr=Yn-Un,oo=Un*xr-Yn*Ti,xs=ao*Tr-Hr*Ll,Oa=(Ll*oo-Tr*vi)/xs,Us=(Hr*vi-ao*oo)/xs;return et.isNaN(Oa)||et.isInfinite(Oa)||et.isNaN(Us)||et.isInfinite(Us)?null:new Re(Oa+ut,Us+At)}}])})(),ki=(function(){return h((function f(){C(this,f)}),null,[{key:"arraycopy",value:function(f,i,s,c,w){for(var L=0,F=i;F<i+w;F++)s[c+L]=f[F],L++}},{key:"getProperty",value:function(f){return{"line.separator":`
`}[f]}}])})(),Sr=(function(){function f(){C(this,f)}return h(f,null,[{key:"log10",value:function(i){var s=Math.log(i);return et.isInfinite(s)||et.isNaN(s)?s:s/f.LOG_10}},{key:"min",value:function(i,s,c,w){var L=i;return s<L&&(L=s),c<L&&(L=c),w<L&&(L=w),L}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],s=arguments[1],c=arguments[2];return i<s?s:i>c?c:i}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var w=arguments[0],L=arguments[1],F=arguments[2];return w<L?L:w>F?F:w}}},{key:"wrap",value:function(i,s){return i<0?s- -i%s:i%s}},{key:"max",value:function(){if(arguments.length===3){var i=arguments[1],s=arguments[2],c=arguments[0];return i>c&&(c=i),s>c&&(c=s),c}if(arguments.length===4){var w=arguments[1],L=arguments[2],F=arguments[3],H=arguments[0];return w>H&&(H=w),L>H&&(H=L),F>H&&(H=F),H}}},{key:"average",value:function(i,s){return(i+s)/2}}])})();Sr.LOG_10=Math.log(10);var Mi=(function(){function f(){C(this,f)}return h(f,null,[{key:"segmentToSegment",value:function(i,s,c,w){if(i.equals(s))return f.pointToSegment(i,c,w);if(c.equals(w))return f.pointToSegment(w,i,s);var L=!1;if(Cn.intersects(i,s,c,w)){var F=(s.x-i.x)*(w.y-c.y)-(s.y-i.y)*(w.x-c.x);if(F===0)L=!0;else{var H=(i.y-c.y)*(w.x-c.x)-(i.x-c.x)*(w.y-c.y),re=((i.y-c.y)*(s.x-i.x)-(i.x-c.x)*(s.y-i.y))/F,fe=H/F;(fe<0||fe>1||re<0||re>1)&&(L=!0)}}else L=!0;return L?Sr.min(f.pointToSegment(i,c,w),f.pointToSegment(s,c,w),f.pointToSegment(c,i,s),f.pointToSegment(w,i,s)):0}},{key:"pointToSegment",value:function(i,s,c){if(s.x===c.x&&s.y===c.y)return i.distance(s);var w=(c.x-s.x)*(c.x-s.x)+(c.y-s.y)*(c.y-s.y),L=((i.x-s.x)*(c.x-s.x)+(i.y-s.y)*(c.y-s.y))/w;if(L<=0)return i.distance(s);if(L>=1)return i.distance(c);var F=((s.y-i.y)*(c.x-s.x)-(s.x-i.x)*(c.y-s.y))/w;return Math.abs(F)*Math.sqrt(w)}},{key:"pointToLinePerpendicular",value:function(i,s,c){var w=(c.x-s.x)*(c.x-s.x)+(c.y-s.y)*(c.y-s.y),L=((s.y-i.y)*(c.x-s.x)-(s.x-i.x)*(c.y-s.y))/w;return Math.abs(L)*Math.sqrt(w)}},{key:"pointToSegmentString",value:function(i,s){if(s.length===0)throw new nt("Line array must contain at least one vertex");for(var c=i.distance(s[0]),w=0;w<s.length-1;w++){var L=f.pointToSegment(i,s[w],s[w+1]);L<c&&(c=L)}return c}}])})(),gr=(function(){return h((function f(){C(this,f)}),[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||vn(arguments[0],dn);else if(arguments.length!==2){if(arguments.length===3){var f=arguments[0],i=arguments[1];return this.create(f,i)}}}}])})(),_e=(function(){return h((function f(){C(this,f)}),[{key:"filter",value:function(f){}}])})(),Y=(function(){return h((function f(){C(this,f)}),null,[{key:"ofLine",value:function(f){var i=f.size();if(i<=1)return 0;var s=0,c=new Re;f.getCoordinate(0,c);for(var w=c.x,L=c.y,F=1;F<i;F++){f.getCoordinate(F,c);var H=c.x,re=c.y,fe=H-w,De=re-L;s+=Math.sqrt(fe*fe+De*De),w=H,L=re}return s}}])})(),W=h((function f(){C(this,f)})),ae=(function(){function f(){C(this,f)}return h(f,null,[{key:"copyCoord",value:function(i,s,c,w){for(var L=Math.min(i.getDimension(),c.getDimension()),F=0;F<L;F++)c.setOrdinate(w,F,i.getOrdinate(s,F))}},{key:"isRing",value:function(i){var s=i.size();return s===0||!(s<=3)&&i.getOrdinate(0,dn.X)===i.getOrdinate(s-1,dn.X)&&i.getOrdinate(0,dn.Y)===i.getOrdinate(s-1,dn.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(vn(arguments[0],dn)&&Number.isInteger(arguments[1])){var i=arguments[0],s=arguments[1];f.scroll(i,s,f.isRing(i))}else if(vn(arguments[0],dn)&&arguments[1]instanceof Re){var c=arguments[0],w=arguments[1],L=f.indexOf(w,c);if(L<=0)return null;f.scroll(c,L)}}else if(arguments.length===3){var F=arguments[0],H=arguments[1],re=arguments[2];if(H<=0)return null;for(var fe=F.copy(),De=re?F.size()-1:F.size(),$e=0;$e<De;$e++)for(var ut=0;ut<F.getDimension();ut++)F.setOrdinate($e,ut,fe.getOrdinate((H+$e)%De,ut));if(re)for(var At=0;At<F.getDimension();At++)F.setOrdinate(De,At,F.getOrdinate(0,At))}}},{key:"isEqual",value:function(i,s){var c=i.size();if(c!==s.size())return!1;for(var w=Math.min(i.getDimension(),s.getDimension()),L=0;L<c;L++)for(var F=0;F<w;F++){var H=i.getOrdinate(L,F),re=s.getOrdinate(L,F);if(i.getOrdinate(L,F)!==s.getOrdinate(L,F)&&(!et.isNaN(H)||!et.isNaN(re)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var i=arguments[0];return f.minCoordinateIndex(i,0,i.size()-1)}if(arguments.length===3){for(var s=arguments[0],c=arguments[2],w=-1,L=null,F=arguments[1];F<=c;F++){var H=s.getCoordinate(F);(L===null||L.compareTo(H)>0)&&(L=H,w=F)}return w}}},{key:"extend",value:function(i,s,c){var w=i.create(c,s.getDimension()),L=s.size();if(f.copy(s,0,w,0,L),L>0)for(var F=L;F<c;F++)f.copy(s,L-1,w,F,1);return w}},{key:"reverse",value:function(i){for(var s=i.size()-1,c=Math.trunc(s/2),w=0;w<=c;w++)f.swap(i,w,s-w)}},{key:"swap",value:function(i,s,c){if(s===c)return null;for(var w=0;w<i.getDimension();w++){var L=i.getOrdinate(s,w);i.setOrdinate(s,w,i.getOrdinate(c,w)),i.setOrdinate(c,w,L)}}},{key:"copy",value:function(i,s,c,w,L){for(var F=0;F<L;F++)f.copyCoord(i,s+F,c,w+F)}},{key:"ensureValidRing",value:function(i,s){var c=s.size();return c===0?s:c<=3?f.createClosedRing(i,s,4):s.getOrdinate(0,dn.X)===s.getOrdinate(c-1,dn.X)&&s.getOrdinate(0,dn.Y)===s.getOrdinate(c-1,dn.Y)?s:f.createClosedRing(i,s,c+1)}},{key:"indexOf",value:function(i,s){for(var c=0;c<s.size();c++)if(i.x===s.getOrdinate(c,dn.X)&&i.y===s.getOrdinate(c,dn.Y))return c;return-1}},{key:"createClosedRing",value:function(i,s,c){var w=i.create(c,s.getDimension()),L=s.size();f.copy(s,0,w,0,L);for(var F=L;F<c;F++)f.copy(s,0,w,F,1);return w}},{key:"minCoordinate",value:function(i){for(var s=null,c=0;c<i.size();c++){var w=i.getCoordinate(c);(s===null||s.compareTo(w)>0)&&(s=w)}return s}}])})(),se=(function(){function f(){C(this,f)}return h(f,null,[{key:"toDimensionSymbol",value:function(i){switch(i){case f.FALSE:return f.SYM_FALSE;case f.TRUE:return f.SYM_TRUE;case f.DONTCARE:return f.SYM_DONTCARE;case f.P:return f.SYM_P;case f.L:return f.SYM_L;case f.A:return f.SYM_A}throw new nt("Unknown dimension value: "+i)}},{key:"toDimensionValue",value:function(i){switch(aa.toUpperCase(i)){case f.SYM_FALSE:return f.FALSE;case f.SYM_TRUE:return f.TRUE;case f.SYM_DONTCARE:return f.DONTCARE;case f.SYM_P:return f.P;case f.SYM_L:return f.L;case f.SYM_A:return f.A}throw new nt("Unknown dimension symbol: "+i)}}])})();se.P=0,se.L=1,se.A=2,se.FALSE=-1,se.TRUE=-2,se.DONTCARE=-3,se.SYM_FALSE="F",se.SYM_TRUE="T",se.SYM_DONTCARE="*",se.SYM_P="0",se.SYM_L="1",se.SYM_A="2";var Ee=(function(){return h((function f(){C(this,f)}),[{key:"filter",value:function(f){}}])})(),Me=(function(){return h((function f(){C(this,f)}),[{key:"filter",value:function(f,i){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}])})(),Oe=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new Cn:this._points.expandEnvelope(new Cn)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new i(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Wt){var s=arguments[0],c=arguments[1];if(!this.isEquivalentClass(s))return!1;var w=s;if(this._points.size()!==w._points.size())return!1;for(var L=0;L<this._points.size();L++)if(!this.equal(this._points.getCoordinate(L),w._points.getCoordinate(L),c))return!1;return!0}return ce(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var s=0;s<Math.trunc(this._points.size()/2);s++){var c=this._points.size()-1-s;if(!this._points.getCoordinate(s).equals(this._points.getCoordinate(c))){if(this._points.getCoordinate(s).compareTo(this._points.getCoordinate(c))>0){var w=this._points.copy();ae.reverse(w),this._points=w}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?se.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var s=this._points.copy();return ae.reverse(s),this.getFactory().createLineString(s)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return Wt.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return Y.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var s=arguments[0],c=0,w=0;c<this._points.size()&&w<s._points.size();){var L=this._points.getCoordinate(c).compareTo(s._points.getCoordinate(w));if(L!==0)return L;c++,w++}return c<this._points.size()?1:w<s._points.size()?-1:0}if(arguments.length===2){var F=arguments[0];return arguments[1].compare(this._points,F._points)}}},{key:"apply",value:function(){if(vn(arguments[0],_e))for(var s=arguments[0],c=0;c<this._points.size();c++)s.filter(this._points.getCoordinate(c));else if(vn(arguments[0],Me)){var w=arguments[0];if(this._points.size()===0)return null;for(var L=0;L<this._points.size()&&(w.filter(this._points,L),!w.isDone());L++);w.isGeometryChanged()&&this.geometryChanged()}else vn(arguments[0],Ee)?arguments[0].filter(this):vn(arguments[0],it)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new Rr}},{key:"isEquivalentClass",value:function(s){return s instanceof i}},{key:"getCoordinateN",value:function(s){return this._points.getCoordinate(s)}},{key:"getGeometryType",value:function(){return Wt.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(s){if(s===null&&(s=this.getFactory().getCoordinateSequenceFactory().create([])),s.size()===1)throw new nt("Invalid number of points in LineString (found "+s.size()+" - must be 0 or >= 2)");this._points=s}},{key:"isCoordinate",value:function(s){for(var c=0;c<this._points.size();c++)if(this._points.getCoordinate(c).equals(s))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(s){return this.getFactory().createPoint(this._points.getCoordinate(s))}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var s=arguments[0],c=arguments[1];Wt.constructor_.call(this,c),this.init(s)}}}}])})(Wt),ke=h((function f(){C(this,f)})),Ye=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new Cn;var s=new Cn;return s.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),s}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new i(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Wt){var s=arguments[0],c=arguments[1];return!!this.isEquivalentClass(s)&&(!(!this.isEmpty()||!s.isEmpty())||this.isEmpty()===s.isEmpty()&&this.equal(s.getCoordinate(),this.getCoordinate(),c))}return ce(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return se.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return Wt.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var s=arguments[0];return this.getCoordinate().compareTo(s.getCoordinate())}if(arguments.length===2){var c=arguments[0];return arguments[1].compare(this._coordinates,c._coordinates)}}},{key:"apply",value:function(){if(vn(arguments[0],_e)){var s=arguments[0];if(this.isEmpty())return null;s.filter(this.getCoordinate())}else if(vn(arguments[0],Me)){var c=arguments[0];if(this.isEmpty())return null;c.filter(this._coordinates,0),c.isGeometryChanged()&&this.geometryChanged()}else vn(arguments[0],Ee)?arguments[0].filter(this):vn(arguments[0],it)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Wt.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(s){s===null&&(s=this.getFactory().getCoordinateSequenceFactory().create([])),Pt.isTrue(s.size()<=1),this._coordinates=s}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[ke]}}],[{key:"constructor_",value:function(){this._coordinates=null;var s=arguments[0],c=arguments[1];Wt.constructor_.call(this,c),this.init(s)}}])})(Wt),lt=(function(){function f(){C(this,f)}return h(f,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var i=arguments[0];return Math.abs(f.ofRingSigned(i))}if(vn(arguments[0],dn)){var s=arguments[0];return Math.abs(f.ofRingSigned(s))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var i=arguments[0];if(i.length<3)return 0;for(var s=0,c=i[0].x,w=1;w<i.length-1;w++){var L=i[w].x-c,F=i[w+1].y;s+=L*(i[w-1].y-F)}return s/2}if(vn(arguments[0],dn)){var H=arguments[0],re=H.size();if(re<3)return 0;var fe=new Re,De=new Re,$e=new Re;H.getCoordinate(0,De),H.getCoordinate(1,$e);var ut=De.x;$e.x-=ut;for(var At=0,Gt=1;Gt<re-1;Gt++)fe.y=De.y,De.x=$e.x,De.y=$e.y,H.getCoordinate(Gt+1,$e),$e.x-=ut,At+=De.x*(fe.y-$e.y);return At/2}}}])})(),Ze=(function(){return h((function f(){C(this,f)}),null,[{key:"sort",value:function(){var f=arguments,i=arguments[0];if(arguments.length===1)i.sort((function(ut,At){return ut.compareTo(At)}));else if(arguments.length===2)i.sort((function(ut,At){return f[1].compare(ut,At)}));else if(arguments.length===3){var s=i.slice(arguments[1],arguments[2]);s.sort();var c=i.slice(0,arguments[1]).concat(s,i.slice(arguments[2],i.length));i.splice(0,i.length);var w,L=K(c);try{for(L.s();!(w=L.n()).done;){var F=w.value;i.push(F)}}catch(ut){L.e(ut)}finally{L.f()}}else if(arguments.length===4){var H=i.slice(arguments[1],arguments[2]);H.sort((function(ut,At){return f[3].compare(ut,At)}));var re=i.slice(0,arguments[1]).concat(H,i.slice(arguments[2],i.length));i.splice(0,i.length);var fe,De=K(re);try{for(De.s();!(fe=De.n()).done;){var $e=fe.value;i.push($e)}}catch(ut){De.e(ut)}finally{De.f()}}}},{key:"asList",value:function(f){var i,s=new dt,c=K(f);try{for(c.s();!(i=c.n()).done;){var w=i.value;s.add(w)}}catch(L){c.e(L)}finally{c.f()}return s}},{key:"copyOf",value:function(f,i){return f.slice(0,i)}}])})(),vt=h((function f(){C(this,f)})),jt=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var s=new Array(this.getNumPoints()).fill(null),c=-1,w=this._shell.getCoordinates(),L=0;L<w.length;L++)s[++c]=w[L];for(var F=0;F<this._holes.length;F++)for(var H=this._holes[F].getCoordinates(),re=0;re<H.length;re++)s[++c]=H[re];return s}},{key:"getArea",value:function(){var s=0;s+=lt.ofRing(this._shell.getCoordinateSequence());for(var c=0;c<this._holes.length;c++)s-=lt.ofRing(this._holes[c].getCoordinateSequence());return s}},{key:"copyInternal",value:function(){for(var s=this._shell.copy(),c=new Array(this._holes.length).fill(null),w=0;w<this._holes.length;w++)c[w]=this._holes[w].copy();return new i(s,c,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var s=this._shell.getCoordinateSequence(),c=this.getEnvelopeInternal(),w=0;w<5;w++){var L=s.getX(w);if(L!==c.getMinX()&&L!==c.getMaxX())return!1;var F=s.getY(w);if(F!==c.getMinY()&&F!==c.getMaxY())return!1}for(var H=s.getX(0),re=s.getY(0),fe=1;fe<=4;fe++){var De=s.getX(fe),$e=s.getY(fe);if(De!==H==($e!==re))return!1;H=De,re=$e}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Wt){var s=arguments[0],c=arguments[1];if(!this.isEquivalentClass(s))return!1;var w=s,L=this._shell,F=w._shell;if(!L.equalsExact(F,c)||this._holes.length!==w._holes.length)return!1;for(var H=0;H<this._holes.length;H++)if(!this._holes[H].equalsExact(w._holes[H],c))return!1;return!0}return ce(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var s=0;s<this._holes.length;s++)this._holes[s]=this.normalized(this._holes[s],!1);Ze.sort(this._holes)}else if(arguments.length===2){var c=arguments[0],w=arguments[1];if(c.isEmpty())return null;var L=c.getCoordinateSequence(),F=ae.minCoordinateIndex(L,0,L.size()-2);ae.scroll(L,F,!0),tn.isCCW(L)===w&&ae.reverse(L)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var s=this.getExteriorRing().reverse(),c=new Array(this.getNumInteriorRing()).fill(null),w=0;w<c.length;w++)c[w]=this.getInteriorRingN(w).reverse();return this.getFactory().createPolygon(s,c)}},{key:"getTypeCode",value:function(){return Wt.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var s=0;s+=this._shell.getLength();for(var c=0;c<this._holes.length;c++)s+=this._holes[c].getLength();return s}},{key:"getNumPoints",value:function(){for(var s=this._shell.getNumPoints(),c=0;c<this._holes.length;c++)s+=this._holes[c].getNumPoints();return s}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(s,c){var w=s.copy();return this.normalize(w,c),w}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var s=arguments[0],c=this._shell,w=s._shell;return c.compareToSameClass(w)}if(arguments.length===2){var L=arguments[1],F=arguments[0],H=this._shell,re=F._shell,fe=H.compareToSameClass(re,L);if(fe!==0)return fe;for(var De=this.getNumInteriorRing(),$e=F.getNumInteriorRing(),ut=0;ut<De&&ut<$e;){var At=this.getInteriorRingN(ut),Gt=F.getInteriorRingN(ut),on=At.compareToSameClass(Gt,L);if(on!==0)return on;ut++}return ut<De?1:ut<$e?-1:0}}},{key:"apply",value:function(){if(vn(arguments[0],_e)){var s=arguments[0];this._shell.apply(s);for(var c=0;c<this._holes.length;c++)this._holes[c].apply(s)}else if(vn(arguments[0],Me)){var w=arguments[0];if(this._shell.apply(w),!w.isDone())for(var L=0;L<this._holes.length&&(this._holes[L].apply(w),!w.isDone());L++);w.isGeometryChanged()&&this.geometryChanged()}else if(vn(arguments[0],Ee))arguments[0].filter(this);else if(vn(arguments[0],it)){var F=arguments[0];F.filter(this),this._shell.apply(F);for(var H=0;H<this._holes.length;H++)this._holes[H].apply(F)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var s=new Array(this._holes.length+1).fill(null);s[0]=this._shell;for(var c=0;c<this._holes.length;c++)s[c+1]=this._holes[c];return s.length<=1?this.getFactory().createLinearRing(s[0].getCoordinateSequence()):this.getFactory().createMultiLineString(s)}},{key:"getGeometryType",value:function(){return Wt.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(s){return this._holes[s]}},{key:"interfaces_",get:function(){return[vt]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var s=arguments[0],c=arguments[1],w=arguments[2];if(Wt.constructor_.call(this,w),s===null&&(s=this.getFactory().createLinearRing()),c===null&&(c=[]),Wt.hasNullElements(c))throw new nt("holes must not contain null elements");if(s.isEmpty()&&Wt.hasNonEmptyElements(c))throw new nt("shell is empty but holes are not");this._shell=s,this._holes=c}}])})(Wt),Jt=(function(f){function i(){return C(this,i),P(this,i,arguments)}return B(i,f),h(i)})(We),Fn=(function(f){function i(s){var c;return C(this,i),(c=P(this,i)).array=[],s instanceof Gi&&c.addAll(s),c}return B(i,f),h(i,[{key:"contains",value:function(s){var c,w=K(this.array);try{for(w.s();!(c=w.n()).done;)if(c.value.compareTo(s)===0)return!0}catch(L){w.e(L)}finally{w.f()}return!1}},{key:"add",value:function(s){if(this.contains(s))return!1;for(var c=0,w=this.array.length;c<w;c++)if(this.array[c].compareTo(s)===1)return!!this.array.splice(c,0,s);return this.array.push(s),!0}},{key:"addAll",value:function(s){var c,w=K(s);try{for(w.s();!(c=w.n()).done;){var L=c.value;this.add(L)}}catch(F){w.e(F)}finally{w.f()}return!0}},{key:"remove",value:function(){throw new Rr}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new bn(this.array)}}])})(Jt),bn=(function(){return h((function f(i){C(this,f),this.array=i,this.position=0}),[{key:"next",value:function(){if(this.position===this.array.length)throw new Ur;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new Rr}}])})(),kn=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"computeEnvelopeInternal",value:function(){for(var s=new Cn,c=0;c<this._geometries.length;c++)s.expandToInclude(this._geometries[c].getEnvelopeInternal());return s}},{key:"getGeometryN",value:function(s){return this._geometries[s]}},{key:"getCoordinates",value:function(){for(var s=new Array(this.getNumPoints()).fill(null),c=-1,w=0;w<this._geometries.length;w++)for(var L=this._geometries[w].getCoordinates(),F=0;F<L.length;F++)s[++c]=L[F];return s}},{key:"getArea",value:function(){for(var s=0,c=0;c<this._geometries.length;c++)s+=this._geometries[c].getArea();return s}},{key:"copyInternal",value:function(){for(var s=new Array(this._geometries.length).fill(null),c=0;c<s.length;c++)s[c]=this._geometries[c].copy();return new i(s,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Wt){var s=arguments[0],c=arguments[1];if(!this.isEquivalentClass(s))return!1;var w=s;if(this._geometries.length!==w._geometries.length)return!1;for(var L=0;L<this._geometries.length;L++)if(!this._geometries[L].equalsExact(w._geometries[L],c))return!1;return!0}return ce(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var s=0;s<this._geometries.length;s++)this._geometries[s].normalize();Ze.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var s=se.FALSE,c=0;c<this._geometries.length;c++)s=Math.max(s,this._geometries[c].getBoundaryDimension());return s}},{key:"reverseInternal",value:function(){for(var s=this._geometries.length,c=new dt(s),w=0;w<s;w++)c.add(this._geometries[w].reverse());return this.getFactory().buildGeometry(c)}},{key:"getTypeCode",value:function(){return Wt.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var s=se.FALSE,c=0;c<this._geometries.length;c++)s=Math.max(s,this._geometries[c].getDimension());return s}},{key:"getLength",value:function(){for(var s=0,c=0;c<this._geometries.length;c++)s+=this._geometries[c].getLength();return s}},{key:"getNumPoints",value:function(){for(var s=0,c=0;c<this._geometries.length;c++)s+=this._geometries[c].getNumPoints();return s}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var s=arguments[0],c=new Fn(Ze.asList(this._geometries)),w=new Fn(Ze.asList(s._geometries));return this.compare(c,w)}if(arguments.length===2){for(var L=arguments[1],F=arguments[0],H=this.getNumGeometries(),re=F.getNumGeometries(),fe=0;fe<H&&fe<re;){var De=this.getGeometryN(fe),$e=F.getGeometryN(fe),ut=De.compareToSameClass($e,L);if(ut!==0)return ut;fe++}return fe<H?1:fe<re?-1:0}}},{key:"apply",value:function(){if(vn(arguments[0],_e))for(var s=arguments[0],c=0;c<this._geometries.length;c++)this._geometries[c].apply(s);else if(vn(arguments[0],Me)){var w=arguments[0];if(this._geometries.length===0)return null;for(var L=0;L<this._geometries.length&&(this._geometries[L].apply(w),!w.isDone());L++);w.isGeometryChanged()&&this.geometryChanged()}else if(vn(arguments[0],Ee)){var F=arguments[0];F.filter(this);for(var H=0;H<this._geometries.length;H++)this._geometries[H].apply(F)}else if(vn(arguments[0],it)){var re=arguments[0];re.filter(this);for(var fe=0;fe<this._geometries.length;fe++)this._geometries[fe].apply(re)}}},{key:"getBoundary",value:function(){return Wt.checkNotGeometryCollection(this),Pt.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return Wt.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var s=0;s<this._geometries.length;s++)if(!this._geometries[s].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var s=arguments[0],c=arguments[1];if(Wt.constructor_.call(this,c),s===null&&(s=[]),Wt.hasNullElements(s))throw new nt("geometries must not contain null elements");this._geometries=s}}}}])})(Wt),Sn=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"copyInternal",value:function(){for(var s=new Array(this._geometries.length).fill(null),c=0;c<s.length;c++)s[c]=this._geometries[c].copy();return new i(s,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Wt){var s=arguments[0],c=arguments[1];return!!this.isEquivalentClass(s)&&ce(i,"equalsExact",this,1).call(this,s,c)}return ce(i,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var s=arguments[0];return this._geometries[s].getCoordinate()}return ce(i,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return se.FALSE}},{key:"getTypeCode",value:function(){return Wt.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Wt.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[ke]}}],[{key:"constructor_",value:function(){var s=arguments[0],c=arguments[1];kn.constructor_.call(this,s,c)}}])})(kn),pi=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"copyInternal",value:function(){return new i(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return se.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||ce(i,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var s=this._points.copy();return ae.reverse(s),this.getFactory().createLinearRing(s)}},{key:"getTypeCode",value:function(){return Wt.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!ce(i,"isClosed",this,1).call(this))throw new nt("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<i.MINIMUM_VALID_SIZE)throw new nt("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return Wt.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var s=arguments[0],c=arguments[1];Oe.constructor_.call(this,s,c),this.validateConstruction()}}])})(Oe);pi.MINIMUM_VALID_SIZE=4;var ti=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"setOrdinate",value:function(s,c){switch(s){case i.X:this.x=c;break;case i.Y:this.y=c;break;default:throw new nt("Invalid ordinate index: "+s)}}},{key:"getZ",value:function(){return Re.NULL_ORDINATE}},{key:"getOrdinate",value:function(s){switch(s){case i.X:return this.x;case i.Y:return this.y}throw new nt("Invalid ordinate index: "+s)}},{key:"setZ",value:function(s){throw new nt("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(s){this.x=s.x,this.y=s.y,this.z=s.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)Re.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof i){var s=arguments[0];Re.constructor_.call(this,s.x,s.y)}else if(arguments[0]instanceof Re){var c=arguments[0];Re.constructor_.call(this,c.x,c.y)}}else if(arguments.length===2){var w=arguments[0],L=arguments[1];Re.constructor_.call(this,w,L,Re.NULL_ORDINATE)}}}])})(Re);ti.X=0,ti.Y=1,ti.Z=-1,ti.M=-1;var xn=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(s,c){switch(s){case i.X:this.x=c;break;case i.Y:this.y=c;break;case i.M:this._m=c;break;default:throw new nt("Invalid ordinate index: "+s)}}},{key:"setM",value:function(s){this._m=s}},{key:"getZ",value:function(){return Re.NULL_ORDINATE}},{key:"getOrdinate",value:function(s){switch(s){case i.X:return this.x;case i.Y:return this.y;case i.M:return this._m}throw new nt("Invalid ordinate index: "+s)}},{key:"setZ",value:function(s){throw new nt("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(s){this.x=s.x,this.y=s.y,this.z=s.getZ(),this._m=s.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Re.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof i){var s=arguments[0];Re.constructor_.call(this,s.x,s.y),this._m=s._m}else if(arguments[0]instanceof Re){var c=arguments[0];Re.constructor_.call(this,c.x,c.y),this._m=this.getM()}}else if(arguments.length===3){var w=arguments[0],L=arguments[1],F=arguments[2];Re.constructor_.call(this,w,L,Re.NULL_ORDINATE),this._m=F}}}])})(Re);xn.X=0,xn.Y=1,xn.Z=-1,xn.M=2;var Zn=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(s,c){switch(s){case Re.X:this.x=c;break;case Re.Y:this.y=c;break;case Re.Z:this.z=c;break;case Re.M:this._m=c;break;default:throw new nt("Invalid ordinate index: "+s)}}},{key:"setM",value:function(s){this._m=s}},{key:"getOrdinate",value:function(s){switch(s){case Re.X:return this.x;case Re.Y:return this.y;case Re.Z:return this.getZ();case Re.M:return this.getM()}throw new nt("Invalid ordinate index: "+s)}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(s){this.x=s.x,this.y=s.y,this.z=s.getZ(),this._m=s.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Re.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof i){var s=arguments[0];Re.constructor_.call(this,s),this._m=s._m}else if(arguments[0]instanceof Re){var c=arguments[0];Re.constructor_.call(this,c),this._m=this.getM()}}else if(arguments.length===4){var w=arguments[0],L=arguments[1],F=arguments[2],H=arguments[3];Re.constructor_.call(this,w,L,F),this._m=H}}}])})(Re),ri=(function(){function f(){C(this,f)}return h(f,null,[{key:"measures",value:function(i){return i instanceof ti?0:i instanceof xn||i instanceof Zn?1:0}},{key:"dimension",value:function(i){return i instanceof ti?2:i instanceof xn?3:i instanceof Zn?4:3}},{key:"create",value:function(){if(arguments.length===1){var i=arguments[0];return f.create(i,0)}if(arguments.length===2){var s=arguments[0],c=arguments[1];return s===2?new ti:s===3&&c===0?new Re:s===3&&c===1?new xn:s===4&&c===1?new Zn:new Re}}}])})(),Si=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"getCoordinate",value:function(s){return this.get(s)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&vn(arguments[0],Gi)){for(var s=arguments[1],c=!1,w=arguments[0].iterator();w.hasNext();)this.add(w.next(),s),c=!0;return c}return ce(i,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var s=ce(i,"clone",this,1).call(this),c=0;c<this.size();c++)s.add(c,this.get(c).clone());return s}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(i.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(i.coordArrayType);for(var s=this.size(),c=new Array(s).fill(null),w=0;w<s;w++)c[w]=this.get(s-w-1);return c}}},{key:"add",value:function(){if(arguments.length===1){var s=arguments[0];return ce(i,"add",this,1).call(this,s)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var c=arguments[0],w=arguments[1];return this.add(c,w,!0),!0}if(arguments[0]instanceof Re&&typeof arguments[1]=="boolean"){var L=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(L))return null;ce(i,"add",this,1).call(this,L)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var F=arguments[0],H=arguments[1];return this.add(F,H),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var re=arguments[0],fe=arguments[1];if(arguments[2])for(var De=0;De<re.length;De++)this.add(re[De],fe);else for(var $e=re.length-1;$e>=0;$e--)this.add(re[$e],fe);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Re){var ut=arguments[0],At=arguments[1];if(!arguments[2]){var Gt=this.size();if(Gt>0&&(ut>0&&this.get(ut-1).equals2D(At)||ut<Gt&&this.get(ut).equals2D(At)))return null}ce(i,"add",this,1).call(this,ut,At)}}else if(arguments.length===4){var on=arguments[0],Nn=arguments[1],An=arguments[2],Un=arguments[3],Ti=1;An>Un&&(Ti=-1);for(var Yn=An;Yn!==Un;Yn+=Ti)this.add(on[Yn],Nn);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var s=this.get(0).copy();this.add(s,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var s=arguments[0];this.ensureCapacity(s.length),this.add(s,!0)}else if(arguments.length===2){var c=arguments[0],w=arguments[1];this.ensureCapacity(c.length),this.add(c,w)}}}}])})(dt);Si.coordArrayType=new Array(0).fill(null);var Bn=(function(){function f(){C(this,f)}return h(f,null,[{key:"isRing",value:function(i){return!(i.length<4)&&!!i[0].equals2D(i[i.length-1])}},{key:"ptNotInList",value:function(i,s){for(var c=0;c<i.length;c++){var w=i[c];if(f.indexOf(w,s)<0)return w}return null}},{key:"scroll",value:function(i,s){var c=f.indexOf(s,i);if(c<0)return null;var w=new Array(i.length).fill(null);ki.arraycopy(i,c,w,0,i.length-c),ki.arraycopy(i,0,w,i.length-c,c),ki.arraycopy(w,0,i,0,i.length)}},{key:"equals",value:function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];if(i===s)return!0;if(i===null||s===null||i.length!==s.length)return!1;for(var c=0;c<i.length;c++)if(!i[c].equals(s[c]))return!1;return!0}if(arguments.length===3){var w=arguments[0],L=arguments[1],F=arguments[2];if(w===L)return!0;if(w===null||L===null||w.length!==L.length)return!1;for(var H=0;H<w.length;H++)if(F.compare(w[H],L[H])!==0)return!1;return!0}}},{key:"intersection",value:function(i,s){for(var c=new Si,w=0;w<i.length;w++)s.intersects(i[w])&&c.add(i[w],!0);return c.toCoordinateArray()}},{key:"measures",value:function(i){if(i===null||i.length===0)return 0;var s,c=0,w=K(i);try{for(w.s();!(s=w.n()).done;){var L=s.value;c=Math.max(c,ri.measures(L))}}catch(F){w.e(F)}finally{w.f()}return c}},{key:"hasRepeatedPoints",value:function(i){for(var s=1;s<i.length;s++)if(i[s-1].equals(i[s]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(i){return f.hasRepeatedPoints(i)?new Si(i,!1).toCoordinateArray():i}},{key:"reverse",value:function(i){for(var s=i.length-1,c=Math.trunc(s/2),w=0;w<=c;w++){var L=i[w];i[w]=i[s-w],i[s-w]=L}}},{key:"removeNull",value:function(i){for(var s=0,c=0;c<i.length;c++)i[c]!==null&&s++;var w=new Array(s).fill(null);if(s===0)return w;for(var L=0,F=0;F<i.length;F++)i[F]!==null&&(w[L++]=i[F]);return w}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var i=arguments[0],s=new Array(i.length).fill(null),c=0;c<i.length;c++)s[c]=i[c].copy();return s}if(arguments.length===5)for(var w=arguments[0],L=arguments[1],F=arguments[2],H=arguments[3],re=arguments[4],fe=0;fe<re;fe++)F[H+fe]=w[L+fe].copy()}},{key:"isEqualReversed",value:function(i,s){for(var c=0;c<i.length;c++){var w=i[c],L=s[i.length-c-1];if(w.compareTo(L)!==0)return!1}return!0}},{key:"envelope",value:function(i){for(var s=new Cn,c=0;c<i.length;c++)s.expandToInclude(i[c]);return s}},{key:"toCoordinateArray",value:function(i){return i.toArray(f.coordArrayType)}},{key:"dimension",value:function(i){if(i===null||i.length===0)return 3;var s,c=0,w=K(i);try{for(w.s();!(s=w.n()).done;){var L=s.value;c=Math.max(c,ri.dimension(L))}}catch(F){w.e(F)}finally{w.f()}return c}},{key:"atLeastNCoordinatesOrNothing",value:function(i,s){return s.length>=i?s:[]}},{key:"indexOf",value:function(i,s){for(var c=0;c<s.length;c++)if(i.equals(s[c]))return c;return-1}},{key:"increasingDirection",value:function(i){for(var s=0;s<Math.trunc(i.length/2);s++){var c=i.length-1-s,w=i[s].compareTo(i[c]);if(w!==0)return w}return 1}},{key:"compare",value:function(i,s){for(var c=0;c<i.length&&c<s.length;){var w=i[c].compareTo(s[c]);if(w!==0)return w;c++}return c<s.length?-1:c<i.length?1:0}},{key:"minCoordinate",value:function(i){for(var s=null,c=0;c<i.length;c++)(s===null||s.compareTo(i[c])>0)&&(s=i[c]);return s}},{key:"extract",value:function(i,s,c){s=Sr.clamp(s,0,i.length);var w=(c=Sr.clamp(c,-1,i.length))-s+1;c<0&&(w=0),s>=i.length&&(w=0),c<s&&(w=0);var L=new Array(w).fill(null);if(w===0)return L;for(var F=0,H=s;H<=c;H++)L[F++]=i[H];return L}}])})(),Er=(function(){return h((function f(){C(this,f)}),[{key:"compare",value:function(f,i){var s=f,c=i;return Bn.compare(s,c)}},{key:"interfaces_",get:function(){return[Le]}}])})(),Co=(function(){return h((function f(){C(this,f)}),[{key:"compare",value:function(f,i){var s=f,c=i;if(s.length<c.length)return-1;if(s.length>c.length)return 1;if(s.length===0)return 0;var w=Bn.compare(s,c);return Bn.isEqualReversed(s,c)?0:w}},{key:"OLDcompare",value:function(f,i){var s=f,c=i;if(s.length<c.length)return-1;if(s.length>c.length)return 1;if(s.length===0)return 0;for(var w=Bn.increasingDirection(s),L=Bn.increasingDirection(c),F=w>0?0:s.length-1,H=L>0?0:s.length-1,re=0;re<s.length;re++){var fe=s[F].compareTo(c[H]);if(fe!==0)return fe;F+=w,H+=L}return 0}},{key:"interfaces_",get:function(){return[Le]}}])})();Bn.ForwardComparator=Er,Bn.BidirectionalComparator=Co,Bn.coordArrayType=new Array(0).fill(null);var hn=(function(){return h((function f(i){C(this,f),this.str=i}),[{key:"append",value:function(f){this.str+=f}},{key:"setCharAt",value:function(f,i){this.str=this.str.substr(0,f)+i+this.str.substr(f+1)}},{key:"toString",value:function(){return this.str}}])})(),Za=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"getM",value:function(i){return this.hasM()?this._coordinates[i].getM():et.NaN}},{key:"setOrdinate",value:function(i,s,c){switch(s){case dn.X:this._coordinates[i].x=c;break;case dn.Y:this._coordinates[i].y=c;break;default:this._coordinates[i].setOrdinate(s,c)}}},{key:"getZ",value:function(i){return this.hasZ()?this._coordinates[i].getZ():et.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(i,s){switch(s){case dn.X:return this._coordinates[i].x;case dn.Y:return this._coordinates[i].y;default:return this._coordinates[i].getOrdinate(s)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var i=arguments[0];return this._coordinates[i]}if(arguments.length===2){var s=arguments[0];arguments[1].setCoordinate(this._coordinates[s])}}},{key:"getCoordinateCopy",value:function(i){var s=this.createCoordinate();return s.setCoordinate(this._coordinates[i]),s}},{key:"createCoordinate",value:function(){return ri.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(i){return this._coordinates[i].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(i){for(var s=0;s<this._coordinates.length;s++)i.expandToInclude(this._coordinates[s]);return i}},{key:"copy",value:function(){for(var i=new Array(this.size()).fill(null),s=0;s<this._coordinates.length;s++){var c=this.createCoordinate();c.setCoordinate(this._coordinates[s]),i[s]=c}return new f(i,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var i=new hn(17*this._coordinates.length);i.append("("),i.append(this._coordinates[0]);for(var s=1;s<this._coordinates.length;s++)i.append(", "),i.append(this._coordinates[s]);return i.append(")"),i.toString()}return"()"}},{key:"getY",value:function(i){return this._coordinates[i].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[dn,mt]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var i=arguments[0];f.constructor_.call(this,i,Bn.dimension(i),Bn.measures(i))}else if(Number.isInteger(arguments[0])){var s=arguments[0];this._coordinates=new Array(s).fill(null);for(var c=0;c<s;c++)this._coordinates[c]=new Re}else if(vn(arguments[0],dn)){var w=arguments[0];if(w===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=w.getDimension(),this._measures=w.getMeasures(),this._coordinates=new Array(w.size()).fill(null);for(var L=0;L<this._coordinates.length;L++)this._coordinates[L]=w.getCoordinateCopy(L)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var F=arguments[0],H=arguments[1];f.constructor_.call(this,F,H,Bn.measures(F))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var re=arguments[0],fe=arguments[1];this._coordinates=new Array(re).fill(null),this._dimension=fe;for(var De=0;De<re;De++)this._coordinates[De]=ri.create(fe)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var $e=arguments[0],ut=arguments[1],At=arguments[2];this._dimension=ut,this._measures=At,this._coordinates=$e===null?new Array(0).fill(null):$e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Gt=arguments[0],on=arguments[1],Nn=arguments[2];this._coordinates=new Array(Gt).fill(null),this._dimension=on,this._measures=Nn;for(var An=0;An<Gt;An++)this._coordinates[An]=this.createCoordinate()}}}}])})(),Ha=(function(){function f(){C(this,f)}return h(f,[{key:"readResolve",value:function(){return f.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array)return new Za(arguments[0]);if(vn(arguments[0],dn))return new Za(arguments[0])}else{if(arguments.length===2){var i=arguments[1];return i>3&&(i=3),i<2&&(i=2),new Za(arguments[0],i)}if(arguments.length===3){var s=arguments[2],c=arguments[1]-s;return s>1&&(s=1),c>3&&(c=3),c<2&&(c=2),new Za(arguments[0],c+s,s)}}}},{key:"interfaces_",get:function(){return[gr,mt]}}],[{key:"instance",value:function(){return f.instanceObject}}])})();Ha.instanceObject=new Ha;var yr=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"copyInternal",value:function(){for(var s=new Array(this._geometries.length).fill(null),c=0;c<s.length;c++)s[c]=this._geometries[c].copy();return new i(s,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Wt){var s=arguments[0],c=arguments[1];return!!this.isEquivalentClass(s)&&ce(i,"equalsExact",this,1).call(this,s,c)}return ce(i,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return Wt.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var s=new dt,c=0;c<this._geometries.length;c++)for(var w=this._geometries[c].getBoundary(),L=0;L<w.getNumGeometries();L++)s.add(w.getGeometryN(L));var F=new Array(s.size()).fill(null);return this.getFactory().createMultiLineString(s.toArray(F))}},{key:"getGeometryType",value:function(){return Wt.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[vt]}}],[{key:"constructor_",value:function(){var s=arguments[0],c=arguments[1];kn.constructor_.call(this,s,c)}}])})(kn),rr=(function(){return h((function f(){C(this,f)}),[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}])})(),hc=(function(f){function i(){var s;return C(this,i),(s=P(this,i)).map=new Map,s}return B(i,f),h(i,[{key:"get",value:function(s){return this.map.get(s)||null}},{key:"put",value:function(s,c){return this.map.set(s,c),c}},{key:"values",value:function(){for(var s=new dt,c=this.map.values(),w=c.next();!w.done;)s.add(w.value),w=c.next();return s}},{key:"entrySet",value:function(){var s=new ds;return this.map.entries().forEach((function(c){return s.add(c)})),s}},{key:"size",value:function(){return this.map.size()}}])})(rr),Ei=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"equals",value:function(i){if(!(i instanceof f))return!1;var s=i;return this._modelType===s._modelType&&this._scale===s._scale}},{key:"compareTo",value:function(i){var s=i,c=this.getMaximumSignificantDigits(),w=s.getMaximumSignificantDigits();return sa.compare(c,w)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===f.FLOATING||this._modelType===f.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var i="UNKNOWN";return this._modelType===f.FLOATING?i="Floating":this._modelType===f.FLOATING_SINGLE?i="Floating-Single":this._modelType===f.FIXED&&(i="Fixed (Scale="+this.getScale()+")"),i}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var i=arguments[0];return et.isNaN(i)||this._modelType===f.FLOATING_SINGLE?i:this._modelType===f.FIXED?Math.round(i*this._scale)/this._scale:i}if(arguments[0]instanceof Re){var s=arguments[0];if(this._modelType===f.FLOATING)return null;s.x=this.makePrecise(s.x),s.y=this.makePrecise(s.y)}}},{key:"getMaximumSignificantDigits",value:function(){var i=16;return this._modelType===f.FLOATING?i=16:this._modelType===f.FLOATING_SINGLE?i=6:this._modelType===f.FIXED&&(i=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),i}},{key:"setScale",value:function(i){this._scale=Math.abs(i)}},{key:"interfaces_",get:function(){return[mt,Ge]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=f.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Fi){var i=arguments[0];this._modelType=i,i===f.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var s=arguments[0];this._modelType=f.FIXED,this.setScale(s)}else if(arguments[0]instanceof f){var c=arguments[0];this._modelType=c._modelType,this._scale=c._scale}}}},{key:"mostPrecise",value:function(i,s){return i.compareTo(s)>=0?i:s}}])})(),Fi=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"readResolve",value:function(){return f.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[mt]}}],[{key:"constructor_",value:function(){this._name=null;var i=arguments[0];this._name=i,f.nameToTypeMap.put(i,this)}}])})();Fi.nameToTypeMap=new hc,Ei.Type=Fi,Ei.FIXED=new Fi("FIXED"),Ei.FLOATING=new Fi("FLOATING"),Ei.FLOATING_SINGLE=new Fi("FLOATING SINGLE"),Ei.maximumPreciseValue=9007199254740992;var sr=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"copyInternal",value:function(){for(var s=new Array(this._geometries.length).fill(null),c=0;c<s.length;c++)s[c]=this._geometries[c].copy();return new i(s,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Wt){var s=arguments[0],c=arguments[1];return!!this.isEquivalentClass(s)&&ce(i,"equalsExact",this,1).call(this,s,c)}return ce(i,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?se.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var s=0;s<this._geometries.length;s++)if(!this._geometries[s].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return Wt.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new Rr}},{key:"getGeometryType",value:function(){return Wt.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[W]}}],[{key:"constructor_",value:function(){var s=arguments[0],c=arguments[1];kn.constructor_.call(this,s,c)}}])})(kn),Qr=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"createEmpty",value:function(i){switch(i){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new nt("Invalid dimension: "+i)}}},{key:"toGeometry",value:function(i){return i.isNull()?this.createPoint():i.getMinX()===i.getMaxX()&&i.getMinY()===i.getMaxY()?this.createPoint(new Re(i.getMinX(),i.getMinY())):i.getMinX()===i.getMaxX()||i.getMinY()===i.getMaxY()?this.createLineString([new Re(i.getMinX(),i.getMinY()),new Re(i.getMaxX(),i.getMaxY())]):this.createPolygon(this.createLinearRing([new Re(i.getMinX(),i.getMinY()),new Re(i.getMinX(),i.getMaxY()),new Re(i.getMaxX(),i.getMaxY()),new Re(i.getMaxX(),i.getMinY()),new Re(i.getMinX(),i.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var i=arguments[0];return this.createLineString(i!==null?this.getCoordinateSequenceFactory().create(i):null)}if(vn(arguments[0],dn))return new Oe(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return arguments.length===0?new sr(null,this):arguments.length===1?new sr(arguments[0],this):void 0}},{key:"buildGeometry",value:function(i){for(var s=null,c=!1,w=!1,L=i.iterator();L.hasNext();){var F=L.next(),H=F.getTypeCode();s===null&&(s=H),H!==s&&(c=!0),F instanceof kn&&(w=!0)}if(s===null)return this.createGeometryCollection();if(c||w)return this.createGeometryCollection(f.toGeometryArray(i));var re=i.iterator().next();if(i.size()>1){if(re instanceof jt)return this.createMultiPolygon(f.toPolygonArray(i));if(re instanceof Oe)return this.createMultiLineString(f.toLineStringArray(i));if(re instanceof Ye)return this.createMultiPoint(f.toPointArray(i));Pt.shouldNeverReachHere("Unhandled geometry type: "+re.getGeometryType())}return re}},{key:"createMultiPointFromCoords",value:function(i){return this.createMultiPoint(i!==null?this.getCoordinateSequenceFactory().create(i):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Re){var i=arguments[0];return this.createPoint(i!==null?this.getCoordinateSequenceFactory().create([i]):null)}if(vn(arguments[0],dn))return new Ye(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(vn(arguments[0],dn)){var i=arguments[0];return this.createPolygon(this.createLinearRing(i))}if(arguments[0]instanceof Array){var s=arguments[0];return this.createPolygon(this.createLinearRing(s))}if(arguments[0]instanceof pi){var c=arguments[0];return this.createPolygon(c,null)}}else if(arguments.length===2)return new jt(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return arguments.length===0?new kn(null,this):arguments.length===1?new kn(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var i=arguments[0];return this.createLinearRing(i!==null?this.getCoordinateSequenceFactory().create(i):null)}if(vn(arguments[0],dn))return new pi(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return arguments.length===0?new yr(null,this):arguments.length===1?new yr(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new Sn(null,this);if(arguments.length===1){if(arguments[0]instanceof Array)return new Sn(arguments[0],this);if(vn(arguments[0],dn)){var i=arguments[0];if(i===null)return this.createMultiPoint(new Array(0).fill(null));for(var s=new Array(i.size()).fill(null),c=0;c<i.size();c++){var w=this.getCoordinateSequenceFactory().create(1,i.getDimension(),i.getMeasures());ae.copy(i,c,w,0,1),s[c]=this.createPoint(w)}return this.createMultiPoint(s)}}}},{key:"interfaces_",get:function(){return[mt]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)f.constructor_.call(this,new Ei,0);else if(arguments.length===1){if(vn(arguments[0],gr)){var i=arguments[0];f.constructor_.call(this,new Ei,0,i)}else if(arguments[0]instanceof Ei){var s=arguments[0];f.constructor_.call(this,s,0,f.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var c=arguments[0],w=arguments[1];f.constructor_.call(this,c,w,f.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var L=arguments[0],F=arguments[1],H=arguments[2];this._precisionModel=L,this._coordinateSequenceFactory=H,this._SRID=F}}},{key:"toMultiPolygonArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toGeometryArray",value:function(i){if(i===null)return null;var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return Ha.instance()}},{key:"toMultiLineStringArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toLineStringArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toMultiPointArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toLinearRingArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toPointArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toPolygonArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"createPointFromInternalCoord",value:function(i,s){return s.getPrecisionModel().makePrecise(i),s.getFactory().createPoint(i)}}])})(),Xn="XY",Xo="XYZ",ms="XYM",Bi="XYZM",Ma={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},Ir="EMPTY",Ls=1,Ai=2,Aa=3,Wo=4,Nr=5,oa=6;for(var Vn in Ma)Ma[Vn].toUpperCase();var Xa=(function(){return h((function f(i){C(this,f),this.wkt=i,this.index_=-1}),[{key:"isAlpha_",value:function(f){return f>="a"&&f<="z"||f>="A"&&f<="Z"}},{key:"isNumeric_",value:function(f,i){return f>="0"&&f<="9"||f=="."&&!(i!==void 0&&i)}},{key:"isWhiteSpace_",value:function(f){return f==" "||f=="	"||f=="\r"||f==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var f,i=this.nextChar_(),s=this.index_,c=i;if(i=="(")f=Ai;else if(i==",")f=Nr;else if(i==")")f=Aa;else if(this.isNumeric_(i)||i=="-")f=Wo,c=this.readNumber_();else if(this.isAlpha_(i))f=Ls,c=this.readText_();else{if(this.isWhiteSpace_(i))return this.nextToken();if(i!=="")throw new Error("Unexpected character: "+i);f=oa}return{position:s,value:c,type:f}}},{key:"readNumber_",value:function(){var f,i=this.index_,s=!1,c=!1;do f=="."?s=!0:f!="e"&&f!="E"||(c=!0),f=this.nextChar_();while(this.isNumeric_(f,s)||!c&&(f=="e"||f=="E")||c&&(f=="-"||f=="+"));return parseFloat(this.wkt.substring(i,this.index_--))}},{key:"readText_",value:function(){var f,i=this.index_;do f=this.nextChar_();while(this.isAlpha_(f));return this.wkt.substring(i,this.index_--).toUpperCase()}}])})(),au=(function(){return h((function f(i,s){C(this,f),this.lexer_=i,this.token_,this.layout_=Xn,this.factory=s}),[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(f){return this.token_.type==f}},{key:"match",value:function(f){var i=this.isTokenType(f);return i&&this.consume_(),i}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var f=Xn,i=this.token_;if(this.isTokenType(Ls)){var s=i.value;s==="Z"?f=Xo:s==="M"?f=ms:s==="ZM"&&(f=Bi),f!==Xn&&this.consume_()}return f}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(Ai)){var f=[];do f.push(this.parseGeometry_());while(this.match(Nr));if(this.match(Aa))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(Ai)){var f=this.parsePoint_();if(this.match(Aa))return f}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(Ai)){var f=this.parsePointList_();if(this.match(Aa))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(Ai)){var f=this.parseLineStringTextList_();if(this.match(Aa))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var f;if(this.match(Ai)){if(f=this.token_.type==Ai?this.parsePointTextList_():this.parsePointList_(),this.match(Aa))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(Ai)){var f=this.parseLineStringTextList_();if(this.match(Aa))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(Ai)){var f=this.parsePolygonTextList_();if(this.match(Aa))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var f=[],i=this.layout_.length,s=0;s<i;++s){var c=this.token_;if(!this.match(Wo))break;f.push(c.value)}if(f.length==i)return f;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var f=[this.parsePoint_()];this.match(Nr);)f.push(this.parsePoint_());return f}},{key:"parsePointTextList_",value:function(){for(var f=[this.parsePointText_()];this.match(Nr);)f.push(this.parsePointText_());return f}},{key:"parseLineStringTextList_",value:function(){for(var f=[this.parseLineStringText_()];this.match(Nr);)f.push(this.parseLineStringText_());return f}},{key:"parsePolygonTextList_",value:function(){for(var f=[this.parsePolygonText_()];this.match(Nr);)f.push(this.parsePolygonText_());return f}},{key:"isEmptyGeometry_",value:function(){var f=this.isTokenType(Ls)&&this.token_.value==Ir;return f&&this.consume_(),f}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var f=this.factory,i=function(on){return O(Re,de(on))},s=function(on){var Nn=on.map((function(An){return f.createLinearRing(An.map(i))}));return Nn.length>1?f.createPolygon(Nn[0],Nn.slice(1)):f.createPolygon(Nn[0])},c=this.token_;if(this.match(Ls)){var w=c.value;if(this.layout_=this.parseGeometryLayout_(),w=="GEOMETRYCOLLECTION"){var L=this.parseGeometryCollectionText_();return f.createGeometryCollection(L)}switch(w){case"POINT":var F=this.parsePointText_();return F?f.createPoint(O(Re,de(F))):f.createPoint();case"LINESTRING":var H=this.parseLineStringText_().map(i);return f.createLineString(H);case"LINEARRING":var re=this.parseLineStringText_().map(i);return f.createLinearRing(re);case"POLYGON":var fe=this.parsePolygonText_();return fe&&fe.length!==0?s(fe):f.createPolygon();case"MULTIPOINT":var De=this.parseMultiPointText_();if(!De||De.length===0)return f.createMultiPoint();var $e=De.map(i).map((function(on){return f.createPoint(on)}));return f.createMultiPoint($e);case"MULTILINESTRING":var ut=this.parseMultiLineStringText_().map((function(on){return f.createLineString(on.map(i))}));return f.createMultiLineString(ut);case"MULTIPOLYGON":var At=this.parseMultiPolygonText_();if(!At||At.length===0)return f.createMultiPolygon();var Gt=At.map(s);return f.createMultiPolygon(Gt);default:throw new Error("Invalid geometry type: "+w)}}throw new Error(this.formatErrorMessage_())}}])})();function la(f){if(f.isEmpty())return"";var i=f.getCoordinate(),s=[i.x,i.y];return i.z===void 0||Number.isNaN(i.z)||s.push(i.z),i.m===void 0||Number.isNaN(i.m)||s.push(i.m),s.join(" ")}function qn(f){for(var i=f.getCoordinates().map((function(L){var F=[L.x,L.y];return L.z===void 0||Number.isNaN(L.z)||F.push(L.z),L.m===void 0||Number.isNaN(L.m)||F.push(L.m),F})),s=[],c=0,w=i.length;c<w;++c)s.push(i[c].join(" "));return s.join(", ")}function Po(f){var i=[];i.push("("+qn(f.getExteriorRing())+")");for(var s=0,c=f.getNumInteriorRing();s<c;++s)i.push("("+qn(f.getInteriorRingN(s))+")");return i.join(", ")}var Mo={Point:la,LineString:qn,LinearRing:qn,Polygon:Po,MultiPoint:function(f){for(var i=[],s=0,c=f.getNumGeometries();s<c;++s)i.push("("+la(f.getGeometryN(s))+")");return i.join(", ")},MultiLineString:function(f){for(var i=[],s=0,c=f.getNumGeometries();s<c;++s)i.push("("+qn(f.getGeometryN(s))+")");return i.join(", ")},MultiPolygon:function(f){for(var i=[],s=0,c=f.getNumGeometries();s<c;++s)i.push("("+Po(f.getGeometryN(s))+")");return i.join(", ")},GeometryCollection:function(f){for(var i=[],s=0,c=f.getNumGeometries();s<c;++s)i.push(Wa(f.getGeometryN(s)));return i.join(", ")}};function Wa(f){var i=f.getGeometryType(),s=Mo[i];i=i.toUpperCase();var c=(function(w){var L="";if(w.isEmpty())return L;var F=w.getCoordinate();return F.z===void 0||Number.isNaN(F.z)||(L+="Z"),F.m===void 0||Number.isNaN(F.m)||(L+="M"),L})(f);return c.length>0&&(i+=" "+c),f.isEmpty()?i+" "+Ir:i+" ("+s(f)+")"}var Ya=(function(){return h((function f(i){C(this,f),this.geometryFactory=i||new Qr,this.precisionModel=this.geometryFactory.getPrecisionModel()}),[{key:"read",value:function(f){var i=new Xa(f);return new au(i,this.geometryFactory).parse()}},{key:"write",value:function(f){return Wa(f)}}])})(),Yo=(function(){return h((function f(i){C(this,f),this.parser=new Ya(i)}),[{key:"write",value:function(f){return this.parser.write(f)}}],[{key:"toLineString",value:function(f,i){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+f.x+" "+f.y+", "+i.x+" "+i.y+" )"}}])})(),mi=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"getIndexAlongSegment",value:function(i,s){return this.computeIntLineIndex(),this._intLineIndex[i][s]}},{key:"getTopologySummary",value:function(){var i=new hn;return this.isEndPoint()&&i.append(" endpoint"),this._isProper&&i.append(" proper"),this.isCollinear()&&i.append(" collinear"),i.toString()}},{key:"computeIntersection",value:function(i,s,c,w){this._inputLines[0][0]=i,this._inputLines[0][1]=s,this._inputLines[1][0]=c,this._inputLines[1][1]=w,this._result=this.computeIntersect(i,s,c,w)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var i=arguments[0];this.getEdgeDistance(i,0)>this.getEdgeDistance(i,1)?(this._intLineIndex[i][0]=0,this._intLineIndex[i][1]=1):(this._intLineIndex[i][0]=1,this._intLineIndex[i][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(i){this._precisionModel=i}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var i=arguments[0],s=0;s<this._result;s++)if(!this._intPt[s].equals2D(this._inputLines[i][0])&&!this._intPt[s].equals2D(this._inputLines[i][1]))return!0;return!1}}},{key:"getIntersection",value:function(i){return this._intPt[i]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==f.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(i,s){return f.computeEdgeDistance(this._intPt[s],this._inputLines[i][0],this._inputLines[i][1])}},{key:"isCollinear",value:function(){return this._result===f.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return Yo.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Yo.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(i,s){return this._inputLines[i][s]}},{key:"isIntersection",value:function(i){for(var s=0;s<this._result;s++)if(this._intPt[s].equals2D(i))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(i,s){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[i][s]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Re,this._intPt[1]=new Re,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(i,s,c){var w=Math.abs(c.x-s.x),L=Math.abs(c.y-s.y),F=-1;if(i.equals(s))F=0;else if(i.equals(c))F=w>L?w:L;else{var H=Math.abs(i.x-s.x),re=Math.abs(i.y-s.y);(F=w>L?H:re)!==0||i.equals(s)||(F=Math.max(H,re))}return Pt.isTrue(!(F===0&&!i.equals(s)),"Bad distance calculation"),F}},{key:"nonRobustComputeEdgeDistance",value:function(i,s,c){var w=i.x-s.x,L=i.y-s.y,F=Math.sqrt(w*w+L*L);return Pt.isTrue(!(F===0&&!i.equals(s)),"Invalid distance calculation"),F}}])})();mi.DONT_INTERSECT=0,mi.DO_INTERSECT=1,mi.COLLINEAR=2,mi.NO_INTERSECTION=0,mi.POINT_INTERSECTION=1,mi.COLLINEAR_INTERSECTION=2;var Rs=(function(f){function i(){return C(this,i),P(this,i)}return B(i,f),h(i,[{key:"isInSegmentEnvelopes",value:function(s){var c=new Cn(this._inputLines[0][0],this._inputLines[0][1]),w=new Cn(this._inputLines[1][0],this._inputLines[1][1]);return c.contains(s)&&w.contains(s)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return ce(i,"computeIntersection",this,1).apply(this,arguments);var s=arguments[0],c=arguments[1],w=arguments[2];if(this._isProper=!1,Cn.intersects(c,w,s)&&tn.index(c,w,s)===0&&tn.index(w,c,s)===0)return this._isProper=!0,(s.equals(c)||s.equals(w))&&(this._isProper=!1),this._result=mi.POINT_INTERSECTION,null;this._result=mi.NO_INTERSECTION}},{key:"intersection",value:function(s,c,w,L){var F=this.intersectionSafe(s,c,w,L);return this.isInSegmentEnvelopes(F)||(F=new Re(i.nearestEndpoint(s,c,w,L))),this._precisionModel!==null&&this._precisionModel.makePrecise(F),F}},{key:"checkDD",value:function(s,c,w,L,F){var H=Vr.intersection(s,c,w,L),re=this.isInSegmentEnvelopes(H);ki.out.println("DD in env = "+re+"  --------------------- "+H),F.distance(H)>1e-4&&ki.out.println("Distance = "+F.distance(H))}},{key:"intersectionSafe",value:function(s,c,w,L){var F=pn.intersection(s,c,w,L);return F===null&&(F=i.nearestEndpoint(s,c,w,L)),F}},{key:"computeCollinearIntersection",value:function(s,c,w,L){var F=Cn.intersects(s,c,w),H=Cn.intersects(s,c,L),re=Cn.intersects(w,L,s),fe=Cn.intersects(w,L,c);return F&&H?(this._intPt[0]=w,this._intPt[1]=L,mi.COLLINEAR_INTERSECTION):re&&fe?(this._intPt[0]=s,this._intPt[1]=c,mi.COLLINEAR_INTERSECTION):F&&re?(this._intPt[0]=w,this._intPt[1]=s,!w.equals(s)||H||fe?mi.COLLINEAR_INTERSECTION:mi.POINT_INTERSECTION):F&&fe?(this._intPt[0]=w,this._intPt[1]=c,!w.equals(c)||H||re?mi.COLLINEAR_INTERSECTION:mi.POINT_INTERSECTION):H&&re?(this._intPt[0]=L,this._intPt[1]=s,!L.equals(s)||F||fe?mi.COLLINEAR_INTERSECTION:mi.POINT_INTERSECTION):H&&fe?(this._intPt[0]=L,this._intPt[1]=c,!L.equals(c)||F||re?mi.COLLINEAR_INTERSECTION:mi.POINT_INTERSECTION):mi.NO_INTERSECTION}},{key:"computeIntersect",value:function(s,c,w,L){if(this._isProper=!1,!Cn.intersects(s,c,w,L))return mi.NO_INTERSECTION;var F=tn.index(s,c,w),H=tn.index(s,c,L);if(F>0&&H>0||F<0&&H<0)return mi.NO_INTERSECTION;var re=tn.index(w,L,s),fe=tn.index(w,L,c);return re>0&&fe>0||re<0&&fe<0?mi.NO_INTERSECTION:F===0&&H===0&&re===0&&fe===0?this.computeCollinearIntersection(s,c,w,L):(F===0||H===0||re===0||fe===0?(this._isProper=!1,s.equals2D(w)||s.equals2D(L)?this._intPt[0]=s:c.equals2D(w)||c.equals2D(L)?this._intPt[0]=c:F===0?this._intPt[0]=new Re(w):H===0?this._intPt[0]=new Re(L):re===0?this._intPt[0]=new Re(s):fe===0&&(this._intPt[0]=new Re(c))):(this._isProper=!0,this._intPt[0]=this.intersection(s,c,w,L)),mi.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(s,c,w,L){var F=s,H=Mi.pointToSegment(s,w,L),re=Mi.pointToSegment(c,w,L);return re<H&&(H=re,F=c),(re=Mi.pointToSegment(w,s,c))<H&&(H=re,F=w),(re=Mi.pointToSegment(L,s,c))<H&&(H=re,F=L),F}}])})(mi),yl=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"countSegment",value:function(i,s){if(i.x<this._p.x&&s.x<this._p.x)return null;if(this._p.x===s.x&&this._p.y===s.y)return this._isPointOnSegment=!0,null;if(i.y===this._p.y&&s.y===this._p.y){var c=i.x,w=s.x;return c>w&&(c=s.x,w=i.x),this._p.x>=c&&this._p.x<=w&&(this._isPointOnSegment=!0),null}if(i.y>this._p.y&&s.y<=this._p.y||s.y>this._p.y&&i.y<=this._p.y){var L=tn.index(i,s,this._p);if(L===tn.COLLINEAR)return this._isPointOnSegment=!0,null;s.y<i.y&&(L=-L),L===tn.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==we.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?we.BOUNDARY:this._crossingCount%2==1?we.INTERIOR:we.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var i=arguments[0];this._p=i}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof Re&&vn(arguments[1],dn)){for(var i=arguments[1],s=new f(arguments[0]),c=new Re,w=new Re,L=1;L<i.size();L++)if(i.getCoordinate(L,c),i.getCoordinate(L-1,w),s.countSegment(c,w),s.isOnSegment())return s.getLocation();return s.getLocation()}if(arguments[0]instanceof Re&&arguments[1]instanceof Array){for(var F=arguments[1],H=new f(arguments[0]),re=1;re<F.length;re++){var fe=F[re],De=F[re-1];if(H.countSegment(fe,De),H.isOnSegment())return H.getLocation()}return H.getLocation()}}}])})(),_r=(function(){function f(){C(this,f)}return h(f,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof Re&&vn(arguments[1],dn)){for(var i=arguments[0],s=arguments[1],c=new Rs,w=new Re,L=new Re,F=s.size(),H=1;H<F;H++)if(s.getCoordinate(H-1,w),s.getCoordinate(H,L),c.computeIntersection(i,w,L),c.hasIntersection())return!0;return!1}if(arguments[0]instanceof Re&&arguments[1]instanceof Array){for(var re=arguments[0],fe=arguments[1],De=new Rs,$e=1;$e<fe.length;$e++){var ut=fe[$e-1],At=fe[$e];if(De.computeIntersection(re,ut,At),De.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(i,s){return yl.locatePointInRing(i,s)}},{key:"isInRing",value:function(i,s){return f.locateInRing(i,s)!==we.EXTERIOR}}])})(),Ii=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"setAllLocations",value:function(i){for(var s=0;s<this.location.length;s++)this.location[s]=i}},{key:"isNull",value:function(){for(var i=0;i<this.location.length;i++)if(this.location[i]!==we.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(i){for(var s=0;s<this.location.length;s++)this.location[s]===we.NONE&&(this.location[s]=i)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(i){if(i.location.length>this.location.length){var s=new Array(3).fill(null);s[ot.ON]=this.location[ot.ON],s[ot.LEFT]=we.NONE,s[ot.RIGHT]=we.NONE,this.location=s}for(var c=0;c<this.location.length;c++)this.location[c]===we.NONE&&c<i.location.length&&(this.location[c]=i.location[c])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var i=this.location[ot.LEFT];this.location[ot.LEFT]=this.location[ot.RIGHT],this.location[ot.RIGHT]=i}},{key:"toString",value:function(){var i=new ir;return this.location.length>1&&i.append(we.toLocationSymbol(this.location[ot.LEFT])),i.append(we.toLocationSymbol(this.location[ot.ON])),this.location.length>1&&i.append(we.toLocationSymbol(this.location[ot.RIGHT])),i.toString()}},{key:"setLocations",value:function(i,s,c){this.location[ot.ON]=i,this.location[ot.LEFT]=s,this.location[ot.RIGHT]=c}},{key:"get",value:function(i){return i<this.location.length?this.location[i]:we.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var i=0;i<this.location.length;i++)if(this.location[i]===we.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var i=arguments[0];this.setLocation(ot.ON,i)}else if(arguments.length===2){var s=arguments[0],c=arguments[1];this.location[s]=c}}},{key:"init",value:function(i){this.location=new Array(i).fill(null),this.setAllLocations(we.NONE)}},{key:"isEqualOnSide",value:function(i,s){return this.location[s]===i.location[s]}},{key:"allPositionsEqual",value:function(i){for(var s=0;s<this.location.length;s++)if(this.location[s]!==i)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var i=arguments[0];this.init(i.length)}else if(Number.isInteger(arguments[0])){var s=arguments[0];this.init(1),this.location[ot.ON]=s}else if(arguments[0]instanceof f){var c=arguments[0];if(this.init(c.location.length),c!==null)for(var w=0;w<this.location.length;w++)this.location[w]=c.location[w]}}else if(arguments.length===3){var L=arguments[0],F=arguments[1],H=arguments[2];this.init(3),this.location[ot.ON]=L,this.location[ot.LEFT]=F,this.location[ot.RIGHT]=H}}}])})(),Wn=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"getGeometryCount",value:function(){var i=0;return this.elt[0].isNull()||i++,this.elt[1].isNull()||i++,i}},{key:"setAllLocations",value:function(i,s){this.elt[i].setAllLocations(s)}},{key:"isNull",value:function(i){return this.elt[i].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var i=arguments[0];this.setAllLocationsIfNull(0,i),this.setAllLocationsIfNull(1,i)}else if(arguments.length===2){var s=arguments[0],c=arguments[1];this.elt[s].setAllLocationsIfNull(c)}}},{key:"isLine",value:function(i){return this.elt[i].isLine()}},{key:"merge",value:function(i){for(var s=0;s<2;s++)this.elt[s]===null&&i.elt[s]!==null?this.elt[s]=new Ii(i.elt[s]):this.elt[s].merge(i.elt[s])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var i=arguments[0];return this.elt[i].get(ot.ON)}if(arguments.length===2){var s=arguments[0],c=arguments[1];return this.elt[s].get(c)}}},{key:"toString",value:function(){var i=new ir;return this.elt[0]!==null&&(i.append("A:"),i.append(this.elt[0].toString())),this.elt[1]!==null&&(i.append(" B:"),i.append(this.elt[1].toString())),i.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var i=arguments[0];return this.elt[i].isArea()}}},{key:"isAnyNull",value:function(i){return this.elt[i].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];this.elt[i].setLocation(ot.ON,s)}else if(arguments.length===3){var c=arguments[0],w=arguments[1],L=arguments[2];this.elt[c].setLocation(w,L)}}},{key:"isEqualOnSide",value:function(i,s){return this.elt[0].isEqualOnSide(i.elt[0],s)&&this.elt[1].isEqualOnSide(i.elt[1],s)}},{key:"allPositionsEqual",value:function(i,s){return this.elt[i].allPositionsEqual(s)}},{key:"toLine",value:function(i){this.elt[i].isArea()&&(this.elt[i]=new Ii(this.elt[i].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var i=arguments[0];this.elt[0]=new Ii(i),this.elt[1]=new Ii(i)}else if(arguments[0]instanceof f){var s=arguments[0];this.elt[0]=new Ii(s.elt[0]),this.elt[1]=new Ii(s.elt[1])}}else if(arguments.length===2){var c=arguments[0],w=arguments[1];this.elt[0]=new Ii(we.NONE),this.elt[1]=new Ii(we.NONE),this.elt[c].setLocation(w)}else if(arguments.length===3){var L=arguments[0],F=arguments[1],H=arguments[2];this.elt[0]=new Ii(L,F,H),this.elt[1]=new Ii(L,F,H)}else if(arguments.length===4){var re=arguments[0],fe=arguments[1],De=arguments[2],$e=arguments[3];this.elt[0]=new Ii(we.NONE,we.NONE,we.NONE),this.elt[1]=new Ii(we.NONE,we.NONE,we.NONE),this.elt[re].setLocations(fe,De,$e)}}},{key:"toLineLabel",value:function(i){for(var s=new f(we.NONE),c=0;c<2;c++)s.setLocation(c,i.getLocation(c));return s}}])})(),ji=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var f=new Array(this._pts.size()).fill(null),i=0;i<this._pts.size();i++)f[i]=this._pts.get(i);this._ring=this._geometryFactory.createLinearRing(f),this._isHole=tn.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(f){this._startDe=f;var i=f,s=!0;do{if(i===null)throw new _t("Found null DirectedEdge");if(i.getEdgeRing()===this)throw new _t("Directed Edge visited twice during ring-building at "+i.getCoordinate());this._edges.add(i);var c=i.getLabel();Pt.isTrue(c.isArea()),this.mergeLabel(c),this.addPoints(i.getEdge(),i.isForward(),s),s=!1,this.setEdgeRing(i,this),i=this.getNext(i)}while(i!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(f){return this._pts.get(f)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var f=this._startDe;do{var i=f.getNode().getEdges().getOutgoingDegree(this);i>this._maxNodeDegree&&(this._maxNodeDegree=i),f=this.getNext(f)}while(f!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(f,i,s){var c=f.getCoordinates();if(i){var w=1;s&&(w=0);for(var L=w;L<c.length;L++)this._pts.add(c[L])}else{var F=c.length-2;s&&(F=c.length-1);for(var H=F;H>=0;H--)this._pts.add(c[H])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var f=this._startDe;do f.getEdge().setInResult(!0),f=f.getNext();while(f!==this._startDe)}},{key:"containsPoint",value:function(f){var i=this.getLinearRing();if(!i.getEnvelopeInternal().contains(f)||!_r.isInRing(f,i.getCoordinates()))return!1;for(var s=this._holes.iterator();s.hasNext();)if(s.next().containsPoint(f))return!1;return!0}},{key:"addHole",value:function(f){this._holes.add(f)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var f=arguments[0];this.mergeLabel(f,0),this.mergeLabel(f,1)}else if(arguments.length===2){var i=arguments[1],s=arguments[0].getLocation(i,ot.RIGHT);if(s===we.NONE)return null;if(this._label.getLocation(i)===we.NONE)return this._label.setLocation(i,s),null}}},{key:"setShell",value:function(f){this._shell=f,f!==null&&f.addHole(this)}},{key:"toPolygon",value:function(f){for(var i=new Array(this._holes.size()).fill(null),s=0;s<this._holes.size();s++)i[s]=this._holes.get(s).getLinearRing();return f.createPolygon(this.getLinearRing(),i)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new dt,this._pts=new dt,this._label=new Wn(we.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new dt,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var f=arguments[0],i=arguments[1];this._geometryFactory=i,this.computePoints(f),this.computeRing()}}}}])})(),La=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"setEdgeRing",value:function(s,c){s.setMinEdgeRing(c)}},{key:"getNext",value:function(s){return s.getNextMin()}}],[{key:"constructor_",value:function(){var s=arguments[0],c=arguments[1];ji.constructor_.call(this,s,c)}}])})(ji),gs=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"buildMinimalRings",value:function(){var s=new dt,c=this._startDe;do{if(c.getMinEdgeRing()===null){var w=new La(c,this._geometryFactory);s.add(w)}c=c.getNext()}while(c!==this._startDe);return s}},{key:"setEdgeRing",value:function(s,c){s.setEdgeRing(c)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var s=this._startDe;do s.getNode().getEdges().linkMinimalDirectedEdges(this),s=s.getNext();while(s!==this._startDe)}},{key:"getNext",value:function(s){return s.getNext()}}],[{key:"constructor_",value:function(){var s=arguments[0],c=arguments[1];ji.constructor_.call(this,s,c)}}])})(ji),Ko=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"setVisited",value:function(f){this._isVisited=f}},{key:"setInResult",value:function(f){this._isInResult=f}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(f){this._label=f}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(f){this._isCovered=f,this._isCoveredSet=!0}},{key:"updateIM",value:function(f){Pt.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(f)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var f=arguments[0];this._label=f}}}}])})(),Ao=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"isIncidentEdgeInResult",value:function(){for(var s=this.getEdges().getEdges().iterator();s.hasNext();)if(s.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(s){s.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(s){}},{key:"computeMergedLocation",value:function(s,c){var w=we.NONE;if(w=this._label.getLocation(c),!s.isNull(c)){var L=s.getLocation(c);w!==we.BOUNDARY&&(w=L)}return w}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return ce(i,"setLabel",this,1).apply(this,arguments);var s=arguments[0],c=arguments[1];this._label===null?this._label=new Wn(s,c):this._label.setLocation(s,c)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof i){var s=arguments[0];this.mergeLabel(s._label)}else if(arguments[0]instanceof Wn)for(var c=arguments[0],w=0;w<2;w++){var L=this.computeMergedLocation(c,w);this._label.getLocation(w)===we.NONE&&this._label.setLocation(w,L)}}},{key:"add",value:function(s){this._edges.insert(s),s.setNode(this)}},{key:"setLabelBoundary",value:function(s){if(this._label===null)return null;var c=we.NONE;this._label!==null&&(c=this._label.getLocation(s));var w=null;switch(c){case we.BOUNDARY:w=we.INTERIOR;break;case we.INTERIOR:default:w=we.BOUNDARY}this._label.setLocation(s,w)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var s=arguments[0],c=arguments[1];this._coord=s,this._edges=c,this._label=new Wn(0,we.NONE)}}])})(Ko),Ns=(function(f){function i(){return C(this,i),P(this,i,arguments)}return B(i,f),h(i)})(rr);function Lu(f){return f==null?0:f.color}function Hn(f){return f==null?null:f.parent}function Dr(f,i){f!==null&&(f.color=i)}function _l(f){return f==null?null:f.left}function Ru(f){return f==null?null:f.right}var Ds=(function(f){function i(){var s;return C(this,i),(s=P(this,i)).root_=null,s.size_=0,s}return B(i,f),h(i,[{key:"get",value:function(s){for(var c=this.root_;c!==null;){var w=s.compareTo(c.key);if(w<0)c=c.left;else{if(!(w>0))return c.value;c=c.right}}return null}},{key:"put",value:function(s,c){if(this.root_===null)return this.root_={key:s,value:c,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var w,L,F=this.root_;do if(w=F,(L=s.compareTo(F.key))<0)F=F.left;else{if(!(L>0)){var H=F.value;return F.value=c,H}F=F.right}while(F!==null);var re={key:s,left:null,right:null,value:c,parent:w,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return L<0?w.left=re:w.right=re,this.fixAfterInsertion(re),this.size_++,null}},{key:"fixAfterInsertion",value:function(s){var c;for(s.color=1;s!=null&&s!==this.root_&&s.parent.color===1;)Hn(s)===_l(Hn(Hn(s)))?Lu(c=Ru(Hn(Hn(s))))===1?(Dr(Hn(s),0),Dr(c,0),Dr(Hn(Hn(s)),1),s=Hn(Hn(s))):(s===Ru(Hn(s))&&(s=Hn(s),this.rotateLeft(s)),Dr(Hn(s),0),Dr(Hn(Hn(s)),1),this.rotateRight(Hn(Hn(s)))):Lu(c=_l(Hn(Hn(s))))===1?(Dr(Hn(s),0),Dr(c,0),Dr(Hn(Hn(s)),1),s=Hn(Hn(s))):(s===_l(Hn(s))&&(s=Hn(s),this.rotateRight(s)),Dr(Hn(s),0),Dr(Hn(Hn(s)),1),this.rotateLeft(Hn(Hn(s))));this.root_.color=0}},{key:"values",value:function(){var s=new dt,c=this.getFirstEntry();if(c!==null)for(s.add(c.value);(c=i.successor(c))!==null;)s.add(c.value);return s}},{key:"entrySet",value:function(){var s=new ds,c=this.getFirstEntry();if(c!==null)for(s.add(c);(c=i.successor(c))!==null;)s.add(c);return s}},{key:"rotateLeft",value:function(s){if(s!=null){var c=s.right;s.right=c.left,c.left!=null&&(c.left.parent=s),c.parent=s.parent,s.parent==null?this.root_=c:s.parent.left===s?s.parent.left=c:s.parent.right=c,c.left=s,s.parent=c}}},{key:"rotateRight",value:function(s){if(s!=null){var c=s.left;s.left=c.right,c.right!=null&&(c.right.parent=s),c.parent=s.parent,s.parent==null?this.root_=c:s.parent.right===s?s.parent.right=c:s.parent.left=c,c.right=s,s.parent=c}}},{key:"getFirstEntry",value:function(){var s=this.root_;if(s!=null)for(;s.left!=null;)s=s.left;return s}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(s){for(var c=this.root_;c!==null;){var w=s.compareTo(c.key);if(w<0)c=c.left;else{if(!(w>0))return!0;c=c.right}}return!1}}],[{key:"successor",value:function(s){var c;if(s===null)return null;if(s.right!==null){for(c=s.right;c.left!==null;)c=c.left;return c}c=s.parent;for(var w=s;c!==null&&w===c.right;)w=c,c=c.parent;return c}}])})(Ns),zs=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"find",value:function(f){return this.nodeMap.get(f)}},{key:"addNode",value:function(){if(arguments[0]instanceof Re){var f=arguments[0],i=this.nodeMap.get(f);return i===null&&(i=this.nodeFact.createNode(f),this.nodeMap.put(f,i)),i}if(arguments[0]instanceof Ao){var s=arguments[0],c=this.nodeMap.get(s.getCoordinate());return c===null?(this.nodeMap.put(s.getCoordinate(),s),s):(c.mergeLabel(s),c)}}},{key:"print",value:function(f){for(var i=this.iterator();i.hasNext();)i.next().print(f)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(f){for(var i=new dt,s=this.iterator();s.hasNext();){var c=s.next();c.getLabel().getLocation(f)===we.BOUNDARY&&i.add(c)}return i}},{key:"add",value:function(f){var i=f.getCoordinate();this.addNode(i).add(f)}}],[{key:"constructor_",value:function(){this.nodeMap=new Ds,this.nodeFact=null;var f=arguments[0];this.nodeFact=f}}])})(),Li=(function(){function f(){C(this,f)}return h(f,null,[{key:"isNorthern",value:function(i){return i===f.NE||i===f.NW}},{key:"isOpposite",value:function(i,s){return i!==s&&(i-s+4)%4===2}},{key:"commonHalfPlane",value:function(i,s){if(i===s)return i;if((i-s+4)%4===2)return-1;var c=i<s?i:s;return c===0&&(i>s?i:s)===3?3:c}},{key:"isInHalfPlane",value:function(i,s){return s===f.SE?i===f.SE||i===f.SW:i===s||i===s+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],s=arguments[1];if(i===0&&s===0)throw new nt("Cannot compute the quadrant for point ( "+i+", "+s+" )");return i>=0?s>=0?f.NE:f.SE:s>=0?f.NW:f.SW}if(arguments[0]instanceof Re&&arguments[1]instanceof Re){var c=arguments[0],w=arguments[1];if(w.x===c.x&&w.y===c.y)throw new nt("Cannot compute the quadrant for two identical points "+c);return w.x>=c.x?w.y>=c.y?f.NE:f.SE:w.y>=c.y?f.NW:f.SW}}}])})();Li.NE=0,Li.NW=1,Li.SW=2,Li.SE=3;var Ra=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"compareDirection",value:function(i){return this._dx===i._dx&&this._dy===i._dy?0:this._quadrant>i._quadrant?1:this._quadrant<i._quadrant?-1:tn.index(i._p0,i._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(i){this._node=i}},{key:"print",value:function(i){var s=Math.atan2(this._dy,this._dx),c=this.getClass().getName(),w=c.lastIndexOf("."),L=c.substring(w+1);i.print("  "+L+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+s+"   "+this._label)}},{key:"compareTo",value:function(i){var s=i;return this.compareDirection(s)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var i=Math.atan2(this._dy,this._dx),s=this.getClass().getName(),c=s.lastIndexOf(".");return"  "+s.substring(c+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+i+"   "+this._label}},{key:"computeLabel",value:function(i){}},{key:"init",value:function(i,s){this._p0=i,this._p1=s,this._dx=s.x-i.x,this._dy=s.y-i.y,this._quadrant=Li.quadrant(this._dx,this._dy),Pt.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[Ge]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var i=arguments[0];this._edge=i}else if(arguments.length===3){var s=arguments[0],c=arguments[1],w=arguments[2];f.constructor_.call(this,s,c,w,null)}else if(arguments.length===4){var L=arguments[0],F=arguments[1],H=arguments[2],re=arguments[3];f.constructor_.call(this,L),this.init(F,H),this._label=re}}}])})(),Jo=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(s){return this._depth[s]}},{key:"setVisited",value:function(s){this._isVisited=s}},{key:"computeDirectedLabel",value:function(){this._label=new Wn(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(s,c){if(this._depth[s]!==-999&&this._depth[s]!==c)throw new _t("assigned depths do not match",this.getCoordinate());this._depth[s]=c}},{key:"isInteriorAreaEdge",value:function(){for(var s=!0,c=0;c<2;c++)this._label.isArea(c)&&this._label.getLocation(c,ot.LEFT)===we.INTERIOR&&this._label.getLocation(c,ot.RIGHT)===we.INTERIOR||(s=!1);return s}},{key:"setNextMin",value:function(s){this._nextMin=s}},{key:"print",value:function(s){ce(i,"print",this,1).call(this,s),s.print(" "+this._depth[ot.LEFT]+"/"+this._depth[ot.RIGHT]),s.print(" ("+this.getDepthDelta()+")"),this._isInResult&&s.print(" inResult")}},{key:"setMinEdgeRing",value:function(s){this._minEdgeRing=s}},{key:"isLineEdge",value:function(){var s=this._label.isLine(0)||this._label.isLine(1),c=!this._label.isArea(0)||this._label.allPositionsEqual(0,we.EXTERIOR),w=!this._label.isArea(1)||this._label.allPositionsEqual(1,we.EXTERIOR);return s&&c&&w}},{key:"setEdgeRing",value:function(s){this._edgeRing=s}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var s=this._edge.getDepthDelta();return this._isForward||(s=-s),s}},{key:"setInResult",value:function(s){this._isInResult=s}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(s){this.print(s),s.print(" "),this._isForward?this._edge.print(s):this._edge.printReverse(s)}},{key:"setSym",value:function(s){this._sym=s}},{key:"setVisitedEdge",value:function(s){this.setVisited(s),this._sym.setVisited(s)}},{key:"setEdgeDepths",value:function(s,c){var w=this.getEdge().getDepthDelta();this._isForward||(w=-w);var L=1;s===ot.LEFT&&(L=-1);var F=ot.opposite(s),H=c+w*L;this.setDepth(s,c),this.setDepth(F,H)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(s){this._next=s}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var s=arguments[0],c=arguments[1];if(Ra.constructor_.call(this,s),this._isForward=c,c)this.init(s.getCoordinate(0),s.getCoordinate(1));else{var w=s.getNumPoints()-1;this.init(s.getCoordinate(w),s.getCoordinate(w-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(s,c){return s===we.EXTERIOR&&c===we.INTERIOR?1:s===we.INTERIOR&&c===we.EXTERIOR?-1:0}}])})(Ra),vl=(function(){return h((function f(){C(this,f)}),[{key:"createNode",value:function(f){return new Ao(f,null)}}])})(),Gr=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"printEdges",value:function(f){f.println("Edges:");for(var i=0;i<this._edges.size();i++){f.println("edge "+i+":");var s=this._edges.get(i);s.print(f),s.eiList.print(f)}}},{key:"find",value:function(f){return this._nodes.find(f)}},{key:"addNode",value:function(){if(arguments[0]instanceof Ao){var f=arguments[0];return this._nodes.addNode(f)}if(arguments[0]instanceof Re){var i=arguments[0];return this._nodes.addNode(i)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var f=this._nodes.iterator();f.hasNext();)f.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(f){ki.out.println(f)}},{key:"isBoundaryNode",value:function(f,i){var s=this._nodes.find(i);if(s===null)return!1;var c=s.getLabel();return c!==null&&c.getLocation(f)===we.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var f=this._nodes.iterator();f.hasNext();)f.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(f,i,s,c){return!!f.equals(s)&&tn.index(f,i,c)===tn.COLLINEAR&&Li.quadrant(f,i)===Li.quadrant(s,c)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(f){ki.out.print(f)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(f,i){for(var s=0;s<this._edges.size();s++){var c=this._edges.get(s),w=c.getCoordinates();if(this.matchInSameDirection(f,i,w[0],w[1])||this.matchInSameDirection(f,i,w[w.length-1],w[w.length-2]))return c}return null}},{key:"insertEdge",value:function(f){this._edges.add(f)}},{key:"findEdgeEnd",value:function(f){for(var i=this.getEdgeEnds().iterator();i.hasNext();){var s=i.next();if(s.getEdge()===f)return s}return null}},{key:"addEdges",value:function(f){for(var i=f.iterator();i.hasNext();){var s=i.next();this._edges.add(s);var c=new Jo(s,!0),w=new Jo(s,!1);c.setSym(w),w.setSym(c),this.add(c),this.add(w)}}},{key:"add",value:function(f){this._nodes.add(f),this._edgeEndList.add(f)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(f,i){for(var s=0;s<this._edges.size();s++){var c=this._edges.get(s),w=c.getCoordinates();if(f.equals(w[0])&&i.equals(w[1]))return c}return null}}],[{key:"constructor_",value:function(){if(this._edges=new dt,this._nodes=null,this._edgeEndList=new dt,arguments.length===0)this._nodes=new zs(new vl);else if(arguments.length===1){var f=arguments[0];this._nodes=new zs(f)}}},{key:"linkResultDirectedEdges",value:function(f){for(var i=f.iterator();i.hasNext();)i.next().getEdges().linkResultDirectedEdges()}}])})(),xl=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"sortShellsAndHoles",value:function(i,s,c){for(var w=i.iterator();w.hasNext();){var L=w.next();L.isHole()?c.add(L):s.add(L)}}},{key:"computePolygons",value:function(i){for(var s=new dt,c=i.iterator();c.hasNext();){var w=c.next().toPolygon(this._geometryFactory);s.add(w)}return s}},{key:"placeFreeHoles",value:function(i,s){for(var c=s.iterator();c.hasNext();){var w=c.next();if(w.getShell()===null){var L=f.findEdgeRingContaining(w,i);if(L===null)throw new _t("unable to assign hole to a shell",w.getCoordinate(0));w.setShell(L)}}}},{key:"buildMinimalEdgeRings",value:function(i,s,c){for(var w=new dt,L=i.iterator();L.hasNext();){var F=L.next();if(F.getMaxNodeDegree()>2){F.linkDirectedEdgesForMinimalEdgeRings();var H=F.buildMinimalRings(),re=this.findShell(H);re!==null?(this.placePolygonHoles(re,H),s.add(re)):c.addAll(H)}else w.add(F)}return w}},{key:"buildMaximalEdgeRings",value:function(i){for(var s=new dt,c=i.iterator();c.hasNext();){var w=c.next();if(w.isInResult()&&w.getLabel().isArea()&&w.getEdgeRing()===null){var L=new gs(w,this._geometryFactory);s.add(L),L.setInResult()}}return s}},{key:"placePolygonHoles",value:function(i,s){for(var c=s.iterator();c.hasNext();){var w=c.next();w.isHole()&&w.setShell(i)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(i){for(var s=0,c=null,w=i.iterator();w.hasNext();){var L=w.next();L.isHole()||(c=L,s++)}return Pt.isTrue(s<=1,"found two shells in MinimalEdgeRing list"),c}},{key:"add",value:function(){if(arguments.length===1){var i=arguments[0];this.add(i.getEdgeEnds(),i.getNodes())}else if(arguments.length===2){var s=arguments[0],c=arguments[1];Gr.linkResultDirectedEdges(c);var w=this.buildMaximalEdgeRings(s),L=new dt,F=this.buildMinimalEdgeRings(w,this._shellList,L);this.sortShellsAndHoles(F,this._shellList,L),this.placeFreeHoles(this._shellList,L)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new dt;var i=arguments[0];this._geometryFactory=i}},{key:"findEdgeRingContaining",value:function(i,s){for(var c=i.getLinearRing(),w=c.getEnvelopeInternal(),L=c.getCoordinateN(0),F=null,H=null,re=s.iterator();re.hasNext();){var fe=re.next(),De=fe.getLinearRing(),$e=De.getEnvelopeInternal();if(!$e.equals(w)&&$e.contains(w)){L=Bn.ptNotInList(c.getCoordinates(),De.getCoordinates());var ut=!1;_r.isInRing(L,De.getCoordinates())&&(ut=!0),ut&&(F===null||H.contains($e))&&(H=(F=fe).getLinearRing().getEnvelopeInternal())}}return F}}])})(),Lo=(function(){return h((function f(){C(this,f)}),[{key:"getBounds",value:function(){}}])})(),vr=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[Lo,mt]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var f=arguments[0],i=arguments[1];this._bounds=f,this._item=i}}])})(),Ji=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"poll",value:function(){if(this.isEmpty())return null;var f=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),f}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(f){for(var i=null,s=this._items.get(f);2*f<=this._size&&((i=2*f)!==this._size&&this._items.get(i+1).compareTo(this._items.get(i))<0&&i++,this._items.get(i).compareTo(s)<0);f=i)this._items.set(f,this._items.get(i));this._items.set(f,s)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(f){this._items.add(null),this._size+=1;var i=this._size;for(this._items.set(0,f);f.compareTo(this._items.get(Math.trunc(i/2)))<0;i/=2)this._items.set(i,this._items.get(Math.trunc(i/2)));this._items.set(i,f)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new dt,this._items.add(null)}}])})(),Gn=(function(){return h((function f(){C(this,f)}),[{key:"insert",value:function(f,i){}},{key:"remove",value:function(f,i){}},{key:"query",value:function(){}}])})(),Qi=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(f){Pt.isTrue(this._bounds===null),this._childBoundables.add(f)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[Lo,mt]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new dt,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var f=arguments[0];this._level=f}}}}])})(),Ka={reverseOrder:function(){return{compare:function(f,i){return i.compareTo(f)}}},min:function(f){return Ka.sort(f),f.get(0)},sort:function(f,i){var s=f.toArray();i?Ze.sort(s,i):Ze.sort(s);for(var c=f.iterator(),w=0,L=s.length;w<L;w++)c.next(),c.set(s[w])},singletonList:function(f){var i=new dt;return i.add(f),i}},ua=(function(){function f(){C(this,f)}return h(f,null,[{key:"maxDistance",value:function(i,s,c,w,L,F,H,re){var fe=f.distance(i,s,L,F);return fe=Math.max(fe,f.distance(i,s,H,re)),fe=Math.max(fe,f.distance(c,w,L,F)),fe=Math.max(fe,f.distance(c,w,H,re))}},{key:"distance",value:function(i,s,c,w){var L=c-i,F=w-s;return Math.sqrt(L*L+F*F)}},{key:"maximumDistance",value:function(i,s){var c=Math.min(i.getMinX(),s.getMinX()),w=Math.min(i.getMinY(),s.getMinY()),L=Math.max(i.getMaxX(),s.getMaxX()),F=Math.max(i.getMaxY(),s.getMaxY());return f.distance(c,w,L,F)}},{key:"minMaxDistance",value:function(i,s){var c=i.getMinX(),w=i.getMinY(),L=i.getMaxX(),F=i.getMaxY(),H=s.getMinX(),re=s.getMinY(),fe=s.getMaxX(),De=s.getMaxY(),$e=f.maxDistance(c,w,c,F,H,re,H,De);return $e=Math.min($e,f.maxDistance(c,w,c,F,H,re,fe,re)),$e=Math.min($e,f.maxDistance(c,w,c,F,fe,De,H,De)),$e=Math.min($e,f.maxDistance(c,w,c,F,fe,De,fe,re)),$e=Math.min($e,f.maxDistance(c,w,L,w,H,re,H,De)),$e=Math.min($e,f.maxDistance(c,w,L,w,H,re,fe,re)),$e=Math.min($e,f.maxDistance(c,w,L,w,fe,De,H,De)),$e=Math.min($e,f.maxDistance(c,w,L,w,fe,De,fe,re)),$e=Math.min($e,f.maxDistance(L,F,c,F,H,re,H,De)),$e=Math.min($e,f.maxDistance(L,F,c,F,H,re,fe,re)),$e=Math.min($e,f.maxDistance(L,F,c,F,fe,De,H,De)),$e=Math.min($e,f.maxDistance(L,F,c,F,fe,De,fe,re)),$e=Math.min($e,f.maxDistance(L,F,L,w,H,re,H,De)),$e=Math.min($e,f.maxDistance(L,F,L,w,H,re,fe,re)),$e=Math.min($e,f.maxDistance(L,F,L,w,fe,De,H,De)),$e=Math.min($e,f.maxDistance(L,F,L,w,fe,De,fe,re))}}])})(),ca=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"maximumDistance",value:function(){return ua.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(i,s){var c=f.isComposite(this._boundable1),w=f.isComposite(this._boundable2);if(c&&w)return f.area(this._boundable1)>f.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,i,s),null):(this.expand(this._boundable2,this._boundable1,!0,i,s),null);if(c)return this.expand(this._boundable1,this._boundable2,!1,i,s),null;if(w)return this.expand(this._boundable2,this._boundable1,!0,i,s),null;throw new nt("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(f.isComposite(this._boundable1)||f.isComposite(this._boundable2))}},{key:"compareTo",value:function(i){var s=i;return this._distance<s._distance?-1:this._distance>s._distance?1:0}},{key:"expand",value:function(i,s,c,w,L){for(var F=i.getChildBoundables().iterator();F.hasNext();){var H=F.next(),re=null;(re=c?new f(s,H,this._itemDistance):new f(H,s,this._itemDistance)).getDistance()<L&&w.add(re)}}},{key:"getBoundable",value:function(i){return i===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[Ge]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var i=arguments[0],s=arguments[1],c=arguments[2];this._boundable1=i,this._boundable2=s,this._itemDistance=c,this._distance=this.distance()}},{key:"area",value:function(i){return i.getBounds().getArea()}},{key:"isComposite",value:function(i){return i instanceof Qi}}])})(),wl=(function(){return h((function f(){C(this,f)}),[{key:"visitItem",value:function(f){}}])})(),er=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"queryInternal",value:function(){if(vn(arguments[2],wl)&&arguments[0]instanceof Object&&arguments[1]instanceof Qi)for(var i=arguments[0],s=arguments[2],c=arguments[1].getChildBoundables(),w=0;w<c.size();w++){var L=c.get(w);this.getIntersectsOp().intersects(L.getBounds(),i)&&(L instanceof Qi?this.queryInternal(i,L,s):L instanceof vr?s.visitItem(L.getItem()):Pt.shouldNeverReachHere())}else if(vn(arguments[2],pr)&&arguments[0]instanceof Object&&arguments[1]instanceof Qi)for(var F=arguments[0],H=arguments[2],re=arguments[1].getChildBoundables(),fe=0;fe<re.size();fe++){var De=re.get(fe);this.getIntersectsOp().intersects(De.getBounds(),F)&&(De instanceof Qi?this.queryInternal(F,De,H):De instanceof vr?H.add(De.getItem()):Pt.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(i){return i.get(i.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var i=0,s=arguments[0].getChildBoundables().iterator();s.hasNext();){var c=s.next();c instanceof Qi?i+=this.size(c):c instanceof vr&&(i+=1)}return i}}},{key:"removeItem",value:function(i,s){for(var c=null,w=i.getChildBoundables().iterator();w.hasNext();){var L=w.next();L instanceof vr&&L.getItem()===s&&(c=L)}return c!==null&&(i.getChildBoundables().remove(c),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var i=this.itemsTree(this._root);return i===null?new dt:i}if(arguments.length===1){for(var s=arguments[0],c=new dt,w=s.getChildBoundables().iterator();w.hasNext();){var L=w.next();if(L instanceof Qi){var F=this.itemsTree(L);F!==null&&c.add(F)}else L instanceof vr?c.add(L.getItem()):Pt.shouldNeverReachHere()}return c.size()<=0?null:c}}},{key:"insert",value:function(i,s){Pt.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new vr(i,s))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var i=arguments[0],s=new dt;return this.boundablesAtLevel(i,this._root,s),s}if(arguments.length===3){var c=arguments[0],w=arguments[1],L=arguments[2];if(Pt.isTrue(c>-2),w.getLevel()===c)return L.add(w),null;for(var F=w.getChildBoundables().iterator();F.hasNext();){var H=F.next();H instanceof Qi?this.boundablesAtLevel(c,H,L):(Pt.isTrue(H instanceof vr),c===-1&&L.add(H))}return null}}},{key:"query",value:function(){if(arguments.length===1){var i=arguments[0];this.build();var s=new dt;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.queryInternal(i,this._root,s),s}if(arguments.length===2){var c=arguments[0],w=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.queryInternal(c,this._root,w)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.remove(i,this._root,s)}if(arguments.length===3){var c=arguments[0],w=arguments[1],L=arguments[2],F=this.removeItem(w,L);if(F)return!0;for(var H=null,re=w.getChildBoundables().iterator();re.hasNext();){var fe=re.next();if(this.getIntersectsOp().intersects(fe.getBounds(),c)&&fe instanceof Qi&&(F=this.remove(c,fe,L))){H=fe;break}}return H!==null&&H.getChildBoundables().isEmpty()&&w.getChildBoundables().remove(H),F}}},{key:"createHigherLevels",value:function(i,s){Pt.isTrue(!i.isEmpty());var c=this.createParentBoundables(i,s+1);return c.size()===1?c.get(0):this.createHigherLevels(c,s+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var i=0,s=arguments[0].getChildBoundables().iterator();s.hasNext();){var c=s.next();if(c instanceof Qi){var w=this.depth(c);w>i&&(i=w)}}return i+1}}},{key:"createParentBoundables",value:function(i,s){Pt.isTrue(!i.isEmpty());var c=new dt;c.add(this.createNode(s));var w=new dt(i);Ka.sort(w,this.getComparator());for(var L=w.iterator();L.hasNext();){var F=L.next();this.lastNode(c).getChildBoundables().size()===this.getNodeCapacity()&&c.add(this.createNode(s)),this.lastNode(c).addChildBoundable(F)}return c}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[mt]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new dt,this._nodeCapacity=null,arguments.length===0)f.constructor_.call(this,f.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var i=arguments[0];Pt.isTrue(i>1,"Node capacity must be greater than 1"),this._nodeCapacity=i}}},{key:"compareDoubles",value:function(i,s){return i>s?1:i<s?-1:0}}])})();er.IntersectsOp=function(){},er.DEFAULT_NODE_CAPACITY=10;var Ja=(function(){return h((function f(){C(this,f)}),[{key:"distance",value:function(f,i){}}])})(),zr=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"createParentBoundablesFromVerticalSlices",value:function(s,c){Pt.isTrue(s.length>0);for(var w=new dt,L=0;L<s.length;L++)w.addAll(this.createParentBoundablesFromVerticalSlice(s[L],c));return w}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var s=arguments[0],c=arguments[1];return this.nearestNeighbourK(s,et.POSITIVE_INFINITY,c)}if(arguments.length===3){var w=arguments[0],L=arguments[2],F=arguments[1],H=new Ji;H.add(w);for(var re=new Ji;!H.isEmpty()&&F>=0;){var fe=H.poll(),De=fe.getDistance();if(De>=F)break;fe.isLeaves()?re.size()<L?re.add(fe):(re.peek().getDistance()>De&&(re.poll(),re.add(fe)),F=re.peek().getDistance()):fe.expandToQueue(H,F)}return i.getItems(re)}}},{key:"createNode",value:function(s){return new Qa(s)}},{key:"size",value:function(){return arguments.length===0?ce(i,"size",this,1).call(this):ce(i,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Cn))return ce(i,"insert",this,1).apply(this,arguments);var s=arguments[0],c=arguments[1];if(s.isNull())return null;ce(i,"insert",this,1).call(this,s,c)}},{key:"getIntersectsOp",value:function(){return i.intersectsOp}},{key:"verticalSlices",value:function(s,c){for(var w=Math.trunc(Math.ceil(s.size()/c)),L=new Array(c).fill(null),F=s.iterator(),H=0;H<c;H++){L[H]=new dt;for(var re=0;F.hasNext()&&re<w;){var fe=F.next();L[H].add(fe),re++}}return L}},{key:"query",value:function(){if(arguments.length===1){var s=arguments[0];return ce(i,"query",this,1).call(this,s)}if(arguments.length===2){var c=arguments[0],w=arguments[1];ce(i,"query",this,1).call(this,c,w)}}},{key:"getComparator",value:function(){return i.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(s,c){return ce(i,"createParentBoundables",this,1).call(this,s,c)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Cn){var s=arguments[0],c=arguments[1];return ce(i,"remove",this,1).call(this,s,c)}return ce(i,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?ce(i,"depth",this,1).call(this):ce(i,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(s,c){Pt.isTrue(!s.isEmpty());var w=Math.trunc(Math.ceil(s.size()/this.getNodeCapacity())),L=new dt(s);Ka.sort(L,i.xComparator);var F=this.verticalSlices(L,Math.trunc(Math.ceil(Math.sqrt(w))));return this.createParentBoundablesFromVerticalSlices(F,c)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(vn(arguments[0],Ja)){var s=arguments[0];if(this.isEmpty())return null;var c=new ca(this.getRoot(),this.getRoot(),s);return this.nearestNeighbour(c)}if(arguments[0]instanceof ca){var w=arguments[0],L=et.POSITIVE_INFINITY,F=null,H=new Ji;for(H.add(w);!H.isEmpty()&&L>0;){var re=H.poll(),fe=re.getDistance();if(fe>=L)break;re.isLeaves()?(L=fe,F=re):re.expandToQueue(H,L)}return F===null?null:[F.getBoundable(0).getItem(),F.getBoundable(1).getItem()]}}else{if(arguments.length===2){var De=arguments[0],$e=arguments[1];if(this.isEmpty()||De.isEmpty())return null;var ut=new ca(this.getRoot(),De.getRoot(),$e);return this.nearestNeighbour(ut)}if(arguments.length===3){var At=arguments[2],Gt=new vr(arguments[0],arguments[1]),on=new ca(this.getRoot(),Gt,At);return this.nearestNeighbour(on)[0]}if(arguments.length===4){var Nn=arguments[2],An=arguments[3],Un=new vr(arguments[0],arguments[1]),Ti=new ca(this.getRoot(),Un,Nn);return this.nearestNeighbourK(Ti,An)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var s=arguments[0],c=arguments[1],w=et.POSITIVE_INFINITY,L=new Ji;for(L.add(s);!L.isEmpty();){var F=L.poll(),H=F.getDistance();if(H>c)return!1;if(F.maximumDistance()<=c)return!0;if(F.isLeaves()){if((w=H)<=c)return!0}else F.expandToQueue(L,w)}return!1}if(arguments.length===3){var re=arguments[0],fe=arguments[1],De=arguments[2],$e=new ca(this.getRoot(),re.getRoot(),fe);return this.isWithinDistance($e,De)}}},{key:"interfaces_",get:function(){return[Gn,mt]}}],[{key:"constructor_",value:function(){if(arguments.length===0)i.constructor_.call(this,i.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var s=arguments[0];er.constructor_.call(this,s)}}},{key:"centreX",value:function(s){return i.avg(s.getMinX(),s.getMaxX())}},{key:"avg",value:function(s,c){return(s+c)/2}},{key:"getItems",value:function(s){for(var c=new Array(s.size()).fill(null),w=0;!s.isEmpty();){var L=s.poll();c[w]=L.getBoundable(0).getItem(),w++}return c}},{key:"centreY",value:function(s){return i.avg(s.getMinY(),s.getMaxY())}}])})(er),Qa=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"computeBounds",value:function(){for(var s=null,c=this.getChildBoundables().iterator();c.hasNext();){var w=c.next();s===null?s=new Cn(w.getBounds()):s.expandToInclude(w.getBounds())}return s}}],[{key:"constructor_",value:function(){var s=arguments[0];Qi.constructor_.call(this,s)}}])})(Qi);zr.STRtreeNode=Qa,zr.xComparator=new((function(){return h((function f(){C(this,f)}),[{key:"interfaces_",get:function(){return[Le]}},{key:"compare",value:function(f,i){return er.compareDoubles(zr.centreX(f.getBounds()),zr.centreX(i.getBounds()))}}])})()),zr.yComparator=new((function(){return h((function f(){C(this,f)}),[{key:"interfaces_",get:function(){return[Le]}},{key:"compare",value:function(f,i){return er.compareDoubles(zr.centreY(f.getBounds()),zr.centreY(i.getBounds()))}}])})()),zr.intersectsOp=new((function(){return h((function f(){C(this,f)}),[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(f,i){return f.intersects(i)}}])})()),zr.DEFAULT_NODE_CAPACITY=10;var Nu=(function(){function f(){C(this,f)}return h(f,null,[{key:"relativeSign",value:function(i,s){return i<s?-1:i>s?1:0}},{key:"compare",value:function(i,s,c){if(s.equals2D(c))return 0;var w=f.relativeSign(s.x,c.x),L=f.relativeSign(s.y,c.y);switch(i){case 0:return f.compareValue(w,L);case 1:return f.compareValue(L,w);case 2:return f.compareValue(L,-w);case 3:return f.compareValue(-w,L);case 4:return f.compareValue(-w,-L);case 5:return f.compareValue(-L,-w);case 6:return f.compareValue(-L,w);case 7:return f.compareValue(w,-L)}return Pt.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(i,s){return i<0?-1:i>0?1:s<0?-1:s>0?1:0}}])})(),bl=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(f){f.print(this.coord),f.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(f){var i=f;return this.segmentIndex<i.segmentIndex?-1:this.segmentIndex>i.segmentIndex?1:this.coord.equals2D(i.coord)?0:this._isInterior?i._isInterior?Nu.compare(this._segmentOctant,this.coord,i.coord):1:-1}},{key:"isEndPoint",value:function(f){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===f}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[Ge]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var f=arguments[0],i=arguments[1],s=arguments[2],c=arguments[3];this._segString=f,this.coord=new Re(i),this.segmentIndex=s,this._segmentOctant=c,this._isInterior=!i.equals2D(f.getCoordinate(s))}}])})(),kl=(function(){return h((function f(){C(this,f)}),[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}])})(),ys=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"getSplitCoordinates",value:function(){var f=new Si;this.addEndpoints();for(var i=this.iterator(),s=i.next();i.hasNext();){var c=i.next();this.addEdgeCoordinates(s,c,f),s=c}return f.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var f=new dt;this.findCollapsesFromInsertedNodes(f),this.findCollapsesFromExistingVertices(f);for(var i=f.iterator();i.hasNext();){var s=i.next().intValue();this.add(this._edge.getCoordinate(s),s)}}},{key:"createSplitEdgePts",value:function(f,i){var s=i.segmentIndex-f.segmentIndex+2;if(s===2)return[new Re(f.coord),new Re(i.coord)];var c=this._edge.getCoordinate(i.segmentIndex),w=i.isInterior()||!i.coord.equals2D(c);w||s--;var L=new Array(s).fill(null),F=0;L[F++]=new Re(f.coord);for(var H=f.segmentIndex+1;H<=i.segmentIndex;H++)L[F++]=this._edge.getCoordinate(H);return w&&(L[F]=new Re(i.coord)),L}},{key:"print",value:function(f){f.println("Intersections:");for(var i=this.iterator();i.hasNext();)i.next().print(f)}},{key:"findCollapsesFromExistingVertices",value:function(f){for(var i=0;i<this._edge.size()-2;i++){var s=this._edge.getCoordinate(i);this._edge.getCoordinate(i+1);var c=this._edge.getCoordinate(i+2);s.equals2D(c)&&f.add(sa.valueOf(i+1))}}},{key:"addEdgeCoordinates",value:function(f,i,s){var c=this.createSplitEdgePts(f,i);s.add(c,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(f){this.addEndpoints(),this.addCollapsedNodes();for(var i=this.iterator(),s=i.next();i.hasNext();){var c=i.next(),w=this.createSplitEdge(s,c);f.add(w),s=c}}},{key:"findCollapseIndex",value:function(f,i,s){if(!f.coord.equals2D(i.coord))return!1;var c=i.segmentIndex-f.segmentIndex;return i.isInterior()||c--,c===1&&(s[0]=f.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(f){for(var i=new Array(1).fill(null),s=this.iterator(),c=s.next();s.hasNext();){var w=s.next();this.findCollapseIndex(c,w,i)&&f.add(sa.valueOf(i[0])),c=w}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var f=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(f),f)}},{key:"createSplitEdge",value:function(f,i){var s=this.createSplitEdgePts(f,i);return new _s(s,this._edge.getData())}},{key:"add",value:function(f,i){var s=new bl(this._edge,f,i,this._edge.getSegmentOctant(i)),c=this._nodeMap.get(s);return c!==null?(Pt.isTrue(c.coord.equals2D(f),"Found equal nodes with different coordinates"),c):(this._nodeMap.put(s,s),s)}},{key:"checkSplitEdgesCorrectness",value:function(f){var i=this._edge.getCoordinates(),s=f.get(0).getCoordinate(0);if(!s.equals2D(i[0]))throw new rt("bad split edge start point at "+s);var c=f.get(f.size()-1).getCoordinates(),w=c[c.length-1];if(!w.equals2D(i[i.length-1]))throw new rt("bad split edge end point at "+w)}}],[{key:"constructor_",value:function(){this._nodeMap=new Ds,this._edge=null;var f=arguments[0];this._edge=f}}])})(),Qo=(function(){function f(){C(this,f)}return h(f,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],s=arguments[1];if(i===0&&s===0)throw new nt("Cannot compute the octant for point ( "+i+", "+s+" )");var c=Math.abs(i),w=Math.abs(s);return i>=0?s>=0?c>=w?0:1:c>=w?7:6:s>=0?c>=w?3:2:c>=w?4:5}if(arguments[0]instanceof Re&&arguments[1]instanceof Re){var L=arguments[0],F=arguments[1],H=F.x-L.x,re=F.y-L.y;if(H===0&&re===0)throw new nt("Cannot compute the octant for two identical points "+L);return f.octant(H,re)}}}])})(),Du=(function(){return h((function f(){C(this,f)}),[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(f){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(f){}},{key:"getData",value:function(){}}])})(),zu=(function(){return h((function f(){C(this,f)}),[{key:"addIntersection",value:function(f,i){}},{key:"interfaces_",get:function(){return[Du]}}])})(),_s=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(i){return this._pts[i]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(i){return i===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(i),this.getCoordinate(i+1))}},{key:"setData",value:function(i){this._data=i}},{key:"safeOctant",value:function(i,s){return i.equals2D(s)?0:Qo.octant(i,s)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];this.addIntersectionNode(i,s)}else if(arguments.length===4){var c=arguments[1],w=arguments[3],L=new Re(arguments[0].getIntersection(w));this.addIntersection(L,c)}}},{key:"toString",value:function(){return Yo.toLineString(new Za(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(i,s){var c=s,w=c+1;if(w<this._pts.length){var L=this._pts[w];i.equals2D(L)&&(c=w)}return this._nodeList.add(i,c)}},{key:"addIntersections",value:function(i,s,c){for(var w=0;w<i.getIntersectionNum();w++)this.addIntersection(i,s,c,w)}},{key:"interfaces_",get:function(){return[zu]}}],[{key:"constructor_",value:function(){this._nodeList=new ys(this),this._pts=null,this._data=null;var i=arguments[0],s=arguments[1];this._pts=i,this._data=s}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var i=arguments[0],s=new dt;return f.getNodedSubstrings(i,s),s}if(arguments.length===2)for(var c=arguments[1],w=arguments[0].iterator();w.hasNext();)w.next().getNodeList().addSplitEdges(c)}}])})(),$r=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof f){var i=arguments[0],s=tn.index(this.p0,this.p1,i.p0),c=tn.index(this.p0,this.p1,i.p1);return s>=0&&c>=0||s<=0&&c<=0?Math.max(s,c):0}if(arguments[0]instanceof Re){var w=arguments[0];return tn.index(this.p0,this.p1,w)}}},{key:"toGeometry",value:function(i){return i.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(i){if(!(i instanceof f))return!1;var s=i;return this.p0.equals(s.p0)&&this.p1.equals(s.p1)}},{key:"intersection",value:function(i){var s=new Rs;return s.computeIntersection(this.p0,this.p1,i.p0,i.p1),s.hasIntersection()?s.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof Re){var i=arguments[0];if(i.equals(this.p0)||i.equals(this.p1))return new Re(i);var s=this.projectionFactor(i),c=new Re;return c.x=this.p0.x+s*(this.p1.x-this.p0.x),c.y=this.p0.y+s*(this.p1.y-this.p0.y),c}if(arguments[0]instanceof f){var w=arguments[0],L=this.projectionFactor(w.p0),F=this.projectionFactor(w.p1);if(L>=1&&F>=1||L<=0&&F<=0)return null;var H=this.project(w.p0);L<0&&(H=this.p0),L>1&&(H=this.p1);var re=this.project(w.p1);return F<0&&(re=this.p0),F>1&&(re=this.p1),new f(H,re)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(i){return i===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(i){return Mi.pointToLinePerpendicular(i,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return f.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(i){if(i.equals(this.p0))return 0;if(i.equals(this.p1))return 1;var s=this.p1.x-this.p0.x,c=this.p1.y-this.p0.y,w=s*s+c*c;return w<=0?et.NaN:((i.x-this.p0.x)*s+(i.y-this.p0.y)*c)/w}},{key:"closestPoints",value:function(i){var s=this.intersection(i);if(s!==null)return[s,s];var c=new Array(2).fill(null),w=et.MAX_VALUE,L=null,F=this.closestPoint(i.p0);w=F.distance(i.p0),c[0]=F,c[1]=i.p0;var H=this.closestPoint(i.p1);(L=H.distance(i.p1))<w&&(w=L,c[0]=H,c[1]=i.p1);var re=i.closestPoint(this.p0);(L=re.distance(this.p0))<w&&(w=L,c[0]=this.p0,c[1]=re);var fe=i.closestPoint(this.p1);return(L=fe.distance(this.p1))<w&&(w=L,c[0]=this.p1,c[1]=fe),c}},{key:"closestPoint",value:function(i){var s=this.projectionFactor(i);return s>0&&s<1?this.project(i):this.p0.distance(i)<this.p1.distance(i)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(i){var s=i,c=this.p0.compareTo(s.p0);return c!==0?c:this.p1.compareTo(s.p1)}},{key:"reverse",value:function(){var i=this.p0;this.p0=this.p1,this.p1=i}},{key:"equalsTopo",value:function(i){return this.p0.equals(i.p0)&&this.p1.equals(i.p1)||this.p0.equals(i.p1)&&this.p1.equals(i.p0)}},{key:"lineIntersection",value:function(i){return pn.intersection(this.p0,this.p1,i.p0,i.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(i,s){var c=this.p0.x+i*(this.p1.x-this.p0.x),w=this.p0.y+i*(this.p1.y-this.p0.y),L=this.p1.x-this.p0.x,F=this.p1.y-this.p0.y,H=Math.sqrt(L*L+F*F),re=0,fe=0;if(s!==0){if(H<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");re=s*L/H,fe=s*F/H}return new Re(c-fe,w+re)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var i=arguments[0];this.setCoordinates(i.p0,i.p1)}else if(arguments.length===2){var s=arguments[0],c=arguments[1];this.p0.x=s.x,this.p0.y=s.y,this.p1.x=c.x,this.p1.y=c.y}}},{key:"segmentFraction",value:function(i){var s=this.projectionFactor(i);return s<0?s=0:(s>1||et.isNaN(s))&&(s=1),s}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(i){var s=this.p1.getY()-this.p0.getY(),c=this.p0.getX()-this.p1.getX(),w=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),L=s*s+c*c,F=s*s-c*c,H=i.getX(),re=i.getY();return new Re((-F*H-2*s*c*re-2*s*w)/L,(F*re-2*s*c*H-2*c*w)/L)}},{key:"distance",value:function(){if(arguments[0]instanceof f){var i=arguments[0];return Mi.segmentToSegment(this.p0,this.p1,i.p0,i.p1)}if(arguments[0]instanceof Re){var s=arguments[0];return Mi.pointToSegment(s,this.p0,this.p1)}}},{key:"pointAlong",value:function(i){var s=new Re;return s.x=this.p0.x+i*(this.p1.x-this.p0.x),s.y=this.p0.y+i*(this.p1.y-this.p0.y),s}},{key:"hashCode",value:function(){var i=et.doubleToLongBits(this.p0.x);i^=31*et.doubleToLongBits(this.p0.y);var s=Math.trunc(i)^Math.trunc(i>>32),c=et.doubleToLongBits(this.p1.x);return c^=31*et.doubleToLongBits(this.p1.y),s^(Math.trunc(c)^Math.trunc(c>>32))}},{key:"interfaces_",get:function(){return[Ge,mt]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)f.constructor_.call(this,new Re,new Re);else if(arguments.length===1){var i=arguments[0];f.constructor_.call(this,i.p0,i.p1)}else if(arguments.length===2){var s=arguments[0],c=arguments[1];this.p0=s,this.p1=c}else if(arguments.length===4){var w=arguments[0],L=arguments[1],F=arguments[2],H=arguments[3];f.constructor_.call(this,new Re(w,L),new Re(F,H))}}},{key:"midPoint",value:function(i,s){return new Re((i.x+s.x)/2,(i.y+s.y)/2)}}])})(),Ro=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var f=arguments[1],i=arguments[2],s=arguments[3];arguments[0].getLineSegment(f,this._overlapSeg1),i.getLineSegment(s,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new $r,this._overlapSeg2=new $r}}])})(),Ou=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"getLineSegment",value:function(f,i){i.p0=this._pts[f],i.p1=this._pts[f+1]}},{key:"computeSelect",value:function(f,i,s,c){var w=this._pts[i],L=this._pts[s];if(s-i==1)return c.select(this,i),null;if(!f.intersects(w,L))return null;var F=Math.trunc((i+s)/2);i<F&&this.computeSelect(f,i,F,c),F<s&&this.computeSelect(f,F,s,c)}},{key:"getCoordinates",value:function(){for(var f=new Array(this._end-this._start+1).fill(null),i=0,s=this._start;s<=this._end;s++)f[i++]=this._pts[s];return f}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var f=arguments[0],i=arguments[1];this.computeOverlaps(this._start,this._end,f,f._start,f._end,i)}else if(arguments.length===6){var s=arguments[0],c=arguments[1],w=arguments[2],L=arguments[3],F=arguments[4],H=arguments[5];if(c-s==1&&F-L==1)return H.overlap(this,s,w,L),null;if(!this.overlaps(s,c,w,L,F))return null;var re=Math.trunc((s+c)/2),fe=Math.trunc((L+F)/2);s<re&&(L<fe&&this.computeOverlaps(s,re,w,L,fe,H),fe<F&&this.computeOverlaps(s,re,w,fe,F,H)),re<c&&(L<fe&&this.computeOverlaps(re,c,w,L,fe,H),fe<F&&this.computeOverlaps(re,c,w,fe,F,H))}}},{key:"setId",value:function(f){this._id=f}},{key:"select",value:function(f,i){this.computeSelect(f,this._start,this._end,i)}},{key:"getEnvelope",value:function(){if(this._env===null){var f=this._pts[this._start],i=this._pts[this._end];this._env=new Cn(f,i)}return this._env}},{key:"overlaps",value:function(f,i,s,c,w){return Cn.intersects(this._pts[f],this._pts[i],s._pts[c],s._pts[w])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var f=arguments[0],i=arguments[1],s=arguments[2],c=arguments[3];this._pts=f,this._start=i,this._end=s,this._context=c}}])})(),fc=(function(){function f(){C(this,f)}return h(f,null,[{key:"findChainEnd",value:function(i,s){for(var c=s;c<i.length-1&&i[c].equals2D(i[c+1]);)c++;if(c>=i.length-1)return i.length-1;for(var w=Li.quadrant(i[c],i[c+1]),L=s+1;L<i.length&&!(!i[L-1].equals2D(i[L])&&Li.quadrant(i[L-1],i[L])!==w);)L++;return L-1}},{key:"getChains",value:function(){if(arguments.length===1){var i=arguments[0];return f.getChains(i,null)}if(arguments.length===2){var s=arguments[0],c=arguments[1],w=new dt,L=0;do{var F=f.findChainEnd(s,L),H=new Ou(s,L,F,c);w.add(H),L=F}while(L<s.length-1);return w}}}])})(),Sl=(function(){return h((function f(){C(this,f)}),[{key:"computeNodes",value:function(f){}},{key:"getNodedSubstrings",value:function(){}}])})(),ou=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"setSegmentIntersector",value:function(f){this._segInt=f}},{key:"interfaces_",get:function(){return[Sl]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var f=arguments[0];this.setSegmentIntersector(f)}}}}])})(),El=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return _s.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(s){for(var c=fc.getChains(s.getCoordinates(),s).iterator();c.hasNext();){var w=c.next();w.setId(this._idCounter++),this._index.insert(w.getEnvelope(),w),this._monoChains.add(w)}}},{key:"computeNodes",value:function(s){this._nodedSegStrings=s;for(var c=s.iterator();c.hasNext();)this.add(c.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var s=new el(this._segInt),c=this._monoChains.iterator();c.hasNext();)for(var w=c.next(),L=this._index.query(w.getEnvelope()).iterator();L.hasNext();){var F=L.next();if(F.getId()>w.getId()&&(w.computeOverlaps(F,s),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new dt,this._index=new zr,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var s=arguments[0];ou.constructor_.call(this,s)}}}}])})(ou),el=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"overlap",value:function(){if(arguments.length!==4)return ce(i,"overlap",this,1).apply(this,arguments);var s=arguments[1],c=arguments[2],w=arguments[3],L=arguments[0].getContext(),F=c.getContext();this._si.processIntersections(L,s,F,w)}}],[{key:"constructor_",value:function(){this._si=null;var s=arguments[0];this._si=s}}])})(Ro);El.SegmentOverlapAction=el;var es=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"isDeletable",value:function(i,s,c,w){var L=this._inputLine[i],F=this._inputLine[s],H=this._inputLine[c];return!!this.isConcave(L,F,H)&&!!this.isShallow(L,F,H,w)&&this.isShallowSampled(L,F,i,c,w)}},{key:"deleteShallowConcavities",value:function(){for(var i=1,s=this.findNextNonDeletedIndex(i),c=this.findNextNonDeletedIndex(s),w=!1;c<this._inputLine.length;){var L=!1;this.isDeletable(i,s,c,this._distanceTol)&&(this._isDeleted[s]=f.DELETE,L=!0,w=!0),i=L?c:s,s=this.findNextNonDeletedIndex(i),c=this.findNextNonDeletedIndex(s)}return w}},{key:"isShallowConcavity",value:function(i,s,c,w){return tn.index(i,s,c)===this._angleOrientation&&Mi.pointToSegment(s,i,c)<w}},{key:"isShallowSampled",value:function(i,s,c,w,L){var F=Math.trunc((w-c)/f.NUM_PTS_TO_CHECK);F<=0&&(F=1);for(var H=c;H<w;H+=F)if(!this.isShallow(i,s,this._inputLine[H],L))return!1;return!0}},{key:"isConcave",value:function(i,s,c){var w=tn.index(i,s,c)===this._angleOrientation;return w}},{key:"simplify",value:function(i){this._distanceTol=Math.abs(i),i<0&&(this._angleOrientation=tn.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var s=!1;do s=this.deleteShallowConcavities();while(s);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(i){for(var s=i+1;s<this._inputLine.length&&this._isDeleted[s]===f.DELETE;)s++;return s}},{key:"isShallow",value:function(i,s,c,w){return Mi.pointToSegment(s,i,c)<w}},{key:"collapseLine",value:function(){for(var i=new Si,s=0;s<this._inputLine.length;s++)this._isDeleted[s]!==f.DELETE&&i.add(this._inputLine[s]);return i.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=tn.COUNTERCLOCKWISE;var i=arguments[0];this._inputLine=i}},{key:"simplify",value:function(i,s){return new f(i).simplify(s)}}])})();es.INIT=0,es.DELETE=1,es.KEEP=1,es.NUM_PTS_TO_CHECK=10;var tl=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"getCoordinates",value:function(){return this._ptList.toArray(f.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(i){this._precisionModel=i}},{key:"addPt",value:function(i){var s=new Re(i);if(this._precisionModel.makePrecise(s),this.isRedundant(s))return null;this._ptList.add(s)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(i,s){if(s)for(var c=0;c<i.length;c++)this.addPt(i[c]);else for(var w=i.length-1;w>=0;w--)this.addPt(i[w])}},{key:"isRedundant",value:function(i){if(this._ptList.size()<1)return!1;var s=this._ptList.get(this._ptList.size()-1);return i.distance(s)<this._minimimVertexDistance}},{key:"toString",value:function(){return new Qr().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var i=new Re(this._ptList.get(0)),s=this._ptList.get(this._ptList.size()-1);if(i.equals(s))return null;this._ptList.add(i)}},{key:"setMinimumVertexDistance",value:function(i){this._minimimVertexDistance=i}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new dt}}])})();tl.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Ui=(function(){function f(){C(this,f)}return h(f,null,[{key:"toDegrees",value:function(i){return 180*i/Math.PI}},{key:"normalize",value:function(i){for(;i>Math.PI;)i-=f.PI_TIMES_2;for(;i<=-Math.PI;)i+=f.PI_TIMES_2;return i}},{key:"angle",value:function(){if(arguments.length===1){var i=arguments[0];return Math.atan2(i.y,i.x)}if(arguments.length===2){var s=arguments[0],c=arguments[1],w=c.x-s.x,L=c.y-s.y;return Math.atan2(L,w)}}},{key:"isAcute",value:function(i,s,c){var w=i.x-s.x,L=i.y-s.y;return w*(c.x-s.x)+L*(c.y-s.y)>0}},{key:"isObtuse",value:function(i,s,c){var w=i.x-s.x,L=i.y-s.y;return w*(c.x-s.x)+L*(c.y-s.y)<0}},{key:"interiorAngle",value:function(i,s,c){var w=f.angle(s,i),L=f.angle(s,c);return Math.abs(L-w)}},{key:"normalizePositive",value:function(i){if(i<0){for(;i<0;)i+=f.PI_TIMES_2;i>=f.PI_TIMES_2&&(i=0)}else{for(;i>=f.PI_TIMES_2;)i-=f.PI_TIMES_2;i<0&&(i=0)}return i}},{key:"angleBetween",value:function(i,s,c){var w=f.angle(s,i),L=f.angle(s,c);return f.diff(w,L)}},{key:"diff",value:function(i,s){var c=null;return(c=i<s?s-i:i-s)>Math.PI&&(c=2*Math.PI-c),c}},{key:"toRadians",value:function(i){return i*Math.PI/180}},{key:"getTurn",value:function(i,s){var c=Math.sin(s-i);return c>0?f.COUNTERCLOCKWISE:c<0?f.CLOCKWISE:f.NONE}},{key:"angleBetweenOriented",value:function(i,s,c){var w=f.angle(s,i),L=f.angle(s,c)-w;return L<=-Math.PI?L+f.PI_TIMES_2:L>Math.PI?L-f.PI_TIMES_2:L}}])})();Ui.PI_TIMES_2=2*Math.PI,Ui.PI_OVER_2=Math.PI/2,Ui.PI_OVER_4=Math.PI/4,Ui.COUNTERCLOCKWISE=tn.COUNTERCLOCKWISE,Ui.CLOCKWISE=tn.CLOCKWISE,Ui.NONE=tn.COLLINEAR;var eo=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"addNextSegment",value:function(i,s){if(this._s0=this._s1,this._s1=this._s2,this._s2=i,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var c=tn.index(this._s0,this._s1,this._s2),w=c===tn.CLOCKWISE&&this._side===ot.LEFT||c===tn.COUNTERCLOCKWISE&&this._side===ot.RIGHT;c===0?this.addCollinear(s):w?this.addOutsideTurn(c,s):this.addInsideTurn(c,s)}},{key:"addLineEndCap",value:function(i,s){var c=new $r(i,s),w=new $r;this.computeOffsetSegment(c,ot.LEFT,this._distance,w);var L=new $r;this.computeOffsetSegment(c,ot.RIGHT,this._distance,L);var F=s.x-i.x,H=s.y-i.y,re=Math.atan2(H,F);switch(this._bufParams.getEndCapStyle()){case qe.CAP_ROUND:this._segList.addPt(w.p1),this.addDirectedFillet(s,re+Math.PI/2,re-Math.PI/2,tn.CLOCKWISE,this._distance),this._segList.addPt(L.p1);break;case qe.CAP_FLAT:this._segList.addPt(w.p1),this._segList.addPt(L.p1);break;case qe.CAP_SQUARE:var fe=new Re;fe.x=Math.abs(this._distance)*Math.cos(re),fe.y=Math.abs(this._distance)*Math.sin(re);var De=new Re(w.p1.x+fe.x,w.p1.y+fe.y),$e=new Re(L.p1.x+fe.x,L.p1.y+fe.y);this._segList.addPt(De),this._segList.addPt($e)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(i,s,c,w){var L=pn.intersection(s.p0,s.p1,c.p0,c.p1);if(L!==null&&(w<=0?1:L.distance(i)/Math.abs(w))<=this._bufParams.getMitreLimit())return this._segList.addPt(L),null;this.addLimitedMitreJoin(s,c,w,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(i,s){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*f.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===qe.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===qe.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(s&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,i,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(i){this._segList.addPt(new Re(i.x+this._distance,i.y+this._distance)),this._segList.addPt(new Re(i.x+this._distance,i.y-this._distance)),this._segList.addPt(new Re(i.x-this._distance,i.y-this._distance)),this._segList.addPt(new Re(i.x-this._distance,i.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(i,s){this._segList.addPts(i,s)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(i,s,c,w,L){var F=s.x-i.x,H=s.y-i.y,re=Math.atan2(H,F),fe=c.x-i.x,De=c.y-i.y,$e=Math.atan2(De,fe);w===tn.CLOCKWISE?re<=$e&&(re+=2*Math.PI):re>=$e&&(re-=2*Math.PI),this._segList.addPt(s),this.addDirectedFillet(i,re,$e,w,L),this._segList.addPt(c)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(i,s,c){this._s1=i,this._s2=s,this._side=c,this._seg1.setCoordinates(i,s),this.computeOffsetSegment(this._seg1,c,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(i,s,c,w){var L=this._seg0.p1,F=Ui.angle(L,this._seg0.p0),H=Ui.angleBetweenOriented(this._seg0.p0,L,this._seg1.p1)/2,re=Ui.normalize(F+H),fe=Ui.normalize(re+Math.PI),De=w*c,$e=c-De*Math.abs(Math.sin(H)),ut=L.x+De*Math.cos(fe),At=L.y+De*Math.sin(fe),Gt=new Re(ut,At),on=new $r(L,Gt),Nn=on.pointAlongOffset(1,$e),An=on.pointAlongOffset(1,-$e);this._side===ot.LEFT?(this._segList.addPt(Nn),this._segList.addPt(An)):(this._segList.addPt(An),this._segList.addPt(Nn))}},{key:"addDirectedFillet",value:function(i,s,c,w,L){var F=w===tn.CLOCKWISE?-1:1,H=Math.abs(s-c),re=Math.trunc(H/this._filletAngleQuantum+.5);if(re<1)return null;for(var fe=H/re,De=new Re,$e=0;$e<re;$e++){var ut=s+F*$e*fe;De.x=i.x+L*Math.cos(ut),De.y=i.y+L*Math.sin(ut),this._segList.addPt(De)}}},{key:"computeOffsetSegment",value:function(i,s,c,w){var L=s===ot.LEFT?1:-1,F=i.p1.x-i.p0.x,H=i.p1.y-i.p0.y,re=Math.sqrt(F*F+H*H),fe=L*c*F/re,De=L*c*H/re;w.p0.x=i.p0.x-De,w.p0.y=i.p0.y+fe,w.p1.x=i.p1.x-De,w.p1.y=i.p1.y+fe}},{key:"addInsideTurn",value:function(i,s){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*f.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var c=new Re((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(c);var w=new Re((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(w)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(i){var s=new Re(i.x+this._distance,i.y);this._segList.addPt(s),this.addDirectedFillet(i,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(i,s){this._segList.addPt(i.p1),this._segList.addPt(s.p0)}},{key:"init",value:function(i){this._distance=i,this._maxCurveSegmentError=i*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new tl,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(i*f.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(i){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===qe.JOIN_BEVEL||this._bufParams.getJoinStyle()===qe.JOIN_MITRE?(i&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,tn.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new $r,this._seg1=new $r,this._offset0=new $r,this._offset1=new $r,this._side=0,this._hasNarrowConcaveAngle=!1;var i=arguments[0],s=arguments[1],c=arguments[2];this._precisionModel=i,this._bufParams=s,this._li=new Rs,this._filletAngleQuantum=Math.PI/2/s.getQuadrantSegments(),s.getQuadrantSegments()>=8&&s.getJoinStyle()===qe.JOIN_ROUND&&(this._closingSegLengthFactor=f.MAX_CLOSING_SEG_LEN_FACTOR),this.init(c)}}])})();eo.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,eo.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,eo.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,eo.MAX_CLOSING_SEG_LEN_FACTOR=80;var nl=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"getOffsetCurve",value:function(i,s){if(this._distance=s,s===0)return null;var c=s<0,w=Math.abs(s),L=this.getSegGen(w);i.length<=1?this.computePointCurve(i[0],L):this.computeOffsetCurve(i,c,L);var F=L.getCoordinates();return c&&Bn.reverse(F),F}},{key:"computeSingleSidedBufferCurve",value:function(i,s,c){var w=this.simplifyTolerance(this._distance);if(s){c.addSegments(i,!0);var L=es.simplify(i,-w),F=L.length-1;c.initSideSegments(L[F],L[F-1],ot.LEFT),c.addFirstSegment();for(var H=F-2;H>=0;H--)c.addNextSegment(L[H],!0)}else{c.addSegments(i,!1);var re=es.simplify(i,w),fe=re.length-1;c.initSideSegments(re[0],re[1],ot.LEFT),c.addFirstSegment();for(var De=2;De<=fe;De++)c.addNextSegment(re[De],!0)}c.addLastSegment(),c.closeRing()}},{key:"computeRingBufferCurve",value:function(i,s,c){var w=this.simplifyTolerance(this._distance);s===ot.RIGHT&&(w=-w);var L=es.simplify(i,w),F=L.length-1;c.initSideSegments(L[F-1],L[0],s);for(var H=1;H<=F;H++){var re=H!==1;c.addNextSegment(L[H],re)}c.closeRing()}},{key:"computeLineBufferCurve",value:function(i,s){var c=this.simplifyTolerance(this._distance),w=es.simplify(i,c),L=w.length-1;s.initSideSegments(w[0],w[1],ot.LEFT);for(var F=2;F<=L;F++)s.addNextSegment(w[F],!0);s.addLastSegment(),s.addLineEndCap(w[L-1],w[L]);var H=es.simplify(i,-c),re=H.length-1;s.initSideSegments(H[re],H[re-1],ot.LEFT);for(var fe=re-2;fe>=0;fe--)s.addNextSegment(H[fe],!0);s.addLastSegment(),s.addLineEndCap(H[1],H[0]),s.closeRing()}},{key:"computePointCurve",value:function(i,s){switch(this._bufParams.getEndCapStyle()){case qe.CAP_ROUND:s.createCircle(i);break;case qe.CAP_SQUARE:s.createSquare(i)}}},{key:"getLineCurve",value:function(i,s){if(this._distance=s,this.isLineOffsetEmpty(s))return null;var c=Math.abs(s),w=this.getSegGen(c);if(i.length<=1)this.computePointCurve(i[0],w);else if(this._bufParams.isSingleSided()){var L=s<0;this.computeSingleSidedBufferCurve(i,L,w)}else this.computeLineBufferCurve(i,w);return w.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(i){return i*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(i,s,c){if(this._distance=c,i.length<=2)return this.getLineCurve(i,c);if(c===0)return f.copyCoordinates(i);var w=this.getSegGen(c);return this.computeRingBufferCurve(i,s,w),w.getCoordinates()}},{key:"computeOffsetCurve",value:function(i,s,c){var w=this.simplifyTolerance(this._distance);if(s){var L=es.simplify(i,-w),F=L.length-1;c.initSideSegments(L[F],L[F-1],ot.LEFT),c.addFirstSegment();for(var H=F-2;H>=0;H--)c.addNextSegment(L[H],!0)}else{var re=es.simplify(i,w),fe=re.length-1;c.initSideSegments(re[0],re[1],ot.LEFT),c.addFirstSegment();for(var De=2;De<=fe;De++)c.addNextSegment(re[De],!0)}c.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(i){return i===0||i<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(i){return new eo(this._precisionModel,this._bufParams,i)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var i=arguments[0],s=arguments[1];this._precisionModel=i,this._bufParams=s}},{key:"copyCoordinates",value:function(i){for(var s=new Array(i.length).fill(null),c=0;c<s.length;c++)s[c]=new Re(i[c]);return s}}])})(),Il=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var f=arguments[0],i=new dt,s=this._subgraphs.iterator();s.hasNext();){var c=s.next(),w=c.getEnvelope();f.y<w.getMinY()||f.y>w.getMaxY()||this.findStabbedSegments(f,c.getDirectedEdges(),i)}return i}if(arguments.length===3){if(vn(arguments[2],pr)&&arguments[0]instanceof Re&&arguments[1]instanceof Jo){for(var L=arguments[0],F=arguments[1],H=arguments[2],re=F.getEdge().getCoordinates(),fe=0;fe<re.length-1;fe++)if(this._seg.p0=re[fe],this._seg.p1=re[fe+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<L.x||this._seg.isHorizontal()||L.y<this._seg.p0.y||L.y>this._seg.p1.y||tn.index(this._seg.p0,this._seg.p1,L)===tn.RIGHT)){var De=F.getDepth(ot.LEFT);this._seg.p0.equals(re[fe])||(De=F.getDepth(ot.RIGHT));var $e=new il(this._seg,De);H.add($e)}}else if(vn(arguments[2],pr)&&arguments[0]instanceof Re&&vn(arguments[1],pr))for(var ut=arguments[0],At=arguments[2],Gt=arguments[1].iterator();Gt.hasNext();){var on=Gt.next();on.isForward()&&this.findStabbedSegments(ut,on,At)}}}},{key:"getDepth",value:function(f){var i=this.findStabbedSegments(f);return i.size()===0?0:Ka.min(i)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new $r;var f=arguments[0];this._subgraphs=f}}])})(),il=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"compareTo",value:function(f){var i=f;if(this._upwardSeg.minX()>=i._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=i._upwardSeg.minX())return-1;var s=this._upwardSeg.orientationIndex(i._upwardSeg);return s!==0||(s=-1*i._upwardSeg.orientationIndex(this._upwardSeg))!==0?s:this._upwardSeg.compareTo(i._upwardSeg)}},{key:"compareX",value:function(f,i){var s=f.p0.compareTo(i.p0);return s!==0?s:f.p1.compareTo(i.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[Ge]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var f=arguments[0],i=arguments[1];this._upwardSeg=new $r(f),this._leftDepth=i}}])})();Il.DepthSegment=il;var Tl=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,null,[{key:"constructor_",value:function(){tt.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])})(tt),Os=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"getY",value:function(){var i=this.y/this.w;if(et.isNaN(i)||et.isInfinite(i))throw new Tl;return i}},{key:"getX",value:function(){var i=this.x/this.w;if(et.isNaN(i)||et.isInfinite(i))throw new Tl;return i}},{key:"getCoordinate",value:function(){var i=new Re;return i.x=this.getX(),i.y=this.getY(),i}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var i=arguments[0];this.x=i.x,this.y=i.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],c=arguments[1];this.x=s,this.y=c,this.w=1}else if(arguments[0]instanceof f&&arguments[1]instanceof f){var w=arguments[0],L=arguments[1];this.x=w.y*L.w-L.y*w.w,this.y=L.x*w.w-w.x*L.w,this.w=w.x*L.y-L.x*w.y}else if(arguments[0]instanceof Re&&arguments[1]instanceof Re){var F=arguments[0],H=arguments[1];this.x=F.y-H.y,this.y=H.x-F.x,this.w=F.x*H.y-H.x*F.y}}else if(arguments.length===3){var re=arguments[0],fe=arguments[1],De=arguments[2];this.x=re,this.y=fe,this.w=De}else if(arguments.length===4){var $e=arguments[0],ut=arguments[1],At=arguments[2],Gt=arguments[3],on=$e.y-ut.y,Nn=ut.x-$e.x,An=$e.x*ut.y-ut.x*$e.y,Un=At.y-Gt.y,Ti=Gt.x-At.x,Yn=At.x*Gt.y-Gt.x*At.y;this.x=Nn*Yn-Ti*An,this.y=Un*An-on*Yn,this.w=on*Ti-Un*Nn}}}])})(),lu=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"area",value:function(){return f.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return f.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(i){if(i===null)throw new nt("Supplied point is null.");return f.interpolateZ(i,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return f.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return f.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return f.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return f.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return f.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return f.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var i=arguments[0],s=arguments[1],c=arguments[2];this.p0=i,this.p1=s,this.p2=c}},{key:"area",value:function(i,s,c){return Math.abs(((c.x-i.x)*(s.y-i.y)-(s.x-i.x)*(c.y-i.y))/2)}},{key:"signedArea",value:function(i,s,c){return((c.x-i.x)*(s.y-i.y)-(s.x-i.x)*(c.y-i.y))/2}},{key:"det",value:function(i,s,c,w){return i*w-s*c}},{key:"interpolateZ",value:function(i,s,c,w){var L=s.x,F=s.y,H=c.x-L,re=w.x-L,fe=c.y-F,De=w.y-F,$e=H*De-re*fe,ut=i.x-L,At=i.y-F,Gt=(De*ut-re*At)/$e,on=(-fe*ut+H*At)/$e;return s.getZ()+Gt*(c.getZ()-s.getZ())+on*(w.getZ()-s.getZ())}},{key:"longestSideLength",value:function(i,s,c){var w=i.distance(s),L=s.distance(c),F=c.distance(i),H=w;return L>H&&(H=L),F>H&&(H=F),H}},{key:"circumcentreDD",value:function(i,s,c){var w=Je.valueOf(i.x).subtract(c.x),L=Je.valueOf(i.y).subtract(c.y),F=Je.valueOf(s.x).subtract(c.x),H=Je.valueOf(s.y).subtract(c.y),re=Je.determinant(w,L,F,H).multiply(2),fe=w.sqr().add(L.sqr()),De=F.sqr().add(H.sqr()),$e=Je.determinant(L,fe,H,De),ut=Je.determinant(w,fe,F,De),At=Je.valueOf(c.x).subtract($e.divide(re)).doubleValue(),Gt=Je.valueOf(c.y).add(ut.divide(re)).doubleValue();return new Re(At,Gt)}},{key:"isAcute",value:function(i,s,c){return!!Ui.isAcute(i,s,c)&&!!Ui.isAcute(s,c,i)&&!!Ui.isAcute(c,i,s)}},{key:"circumcentre",value:function(i,s,c){var w=c.x,L=c.y,F=i.x-w,H=i.y-L,re=s.x-w,fe=s.y-L,De=2*f.det(F,H,re,fe),$e=f.det(H,F*F+H*H,fe,re*re+fe*fe),ut=f.det(F,F*F+H*H,re,re*re+fe*fe);return new Re(w-$e/De,L+ut/De)}},{key:"perpendicularBisector",value:function(i,s){var c=s.x-i.x,w=s.y-i.y,L=new Os(i.x+c/2,i.y+w/2,1),F=new Os(i.x-w+c/2,i.y+c+w/2,1);return new Os(L,F)}},{key:"angleBisector",value:function(i,s,c){var w=s.distance(i),L=w/(w+s.distance(c)),F=c.x-i.x,H=c.y-i.y;return new Re(i.x+L*F,i.y+L*H)}},{key:"area3D",value:function(i,s,c){var w=s.x-i.x,L=s.y-i.y,F=s.getZ()-i.getZ(),H=c.x-i.x,re=c.y-i.y,fe=c.getZ()-i.getZ(),De=L*fe-F*re,$e=F*H-w*fe,ut=w*re-L*H,At=De*De+$e*$e+ut*ut,Gt=Math.sqrt(At)/2;return Gt}},{key:"centroid",value:function(i,s,c){var w=(i.x+s.x+c.x)/3,L=(i.y+s.y+c.y)/3;return new Re(w,L)}},{key:"inCentre",value:function(i,s,c){var w=s.distance(c),L=i.distance(c),F=i.distance(s),H=w+L+F,re=(w*i.x+L*s.x+F*c.x)/H,fe=(w*i.y+L*s.y+F*c.y)/H;return new Re(re,fe)}}])})(),dc=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"addRingSide",value:function(f,i,s,c,w){if(i===0&&f.length<pi.MINIMUM_VALID_SIZE)return null;var L=c,F=w;f.length>=pi.MINIMUM_VALID_SIZE&&tn.isCCW(f)&&(L=w,F=c,s=ot.opposite(s));var H=this._curveBuilder.getRingCurve(f,s,i);this.addCurve(H,L,F)}},{key:"addRingBothSides",value:function(f,i){this.addRingSide(f,i,ot.LEFT,we.EXTERIOR,we.INTERIOR),this.addRingSide(f,i,ot.RIGHT,we.INTERIOR,we.EXTERIOR)}},{key:"addPoint",value:function(f){if(this._distance<=0)return null;var i=f.getCoordinates(),s=this._curveBuilder.getLineCurve(i,this._distance);this.addCurve(s,we.EXTERIOR,we.INTERIOR)}},{key:"addPolygon",value:function(f){var i=this._distance,s=ot.LEFT;this._distance<0&&(i=-this._distance,s=ot.RIGHT);var c=f.getExteriorRing(),w=Bn.removeRepeatedPoints(c.getCoordinates());if(this._distance<0&&this.isErodedCompletely(c,this._distance)||this._distance<=0&&w.length<3)return null;this.addRingSide(w,i,s,we.EXTERIOR,we.INTERIOR);for(var L=0;L<f.getNumInteriorRing();L++){var F=f.getInteriorRingN(L),H=Bn.removeRepeatedPoints(F.getCoordinates());this._distance>0&&this.isErodedCompletely(F,-this._distance)||this.addRingSide(H,i,ot.opposite(s),we.INTERIOR,we.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(f,i){var s=new lu(f[0],f[1],f[2]),c=s.inCentre();return Mi.pointToSegment(c,s.p0,s.p1)<Math.abs(i)}},{key:"addLineString",value:function(f){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var i=Bn.removeRepeatedPoints(f.getCoordinates());if(Bn.isRing(i)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(i,this._distance);else{var s=this._curveBuilder.getLineCurve(i,this._distance);this.addCurve(s,we.EXTERIOR,we.INTERIOR)}}},{key:"addCurve",value:function(f,i,s){if(f===null||f.length<2)return null;var c=new _s(f,new Wn(0,we.BOUNDARY,i,s));this._curveList.add(c)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(f){if(f.isEmpty())return null;if(f instanceof jt)this.addPolygon(f);else if(f instanceof Oe)this.addLineString(f);else if(f instanceof Ye)this.addPoint(f);else if(f instanceof Sn)this.addCollection(f);else if(f instanceof sr)this.addCollection(f);else if(f instanceof yr)this.addCollection(f);else{if(!(f instanceof kn))throw new Rr(f.getGeometryType());this.addCollection(f)}}},{key:"isErodedCompletely",value:function(f,i){var s=f.getCoordinates();if(s.length<4)return i<0;if(s.length===4)return this.isTriangleErodedCompletely(s,i);var c=f.getEnvelopeInternal(),w=Math.min(c.getHeight(),c.getWidth());return i<0&&2*Math.abs(i)>w}},{key:"addCollection",value:function(f){for(var i=0;i<f.getNumGeometries();i++){var s=f.getGeometryN(i);this.add(s)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new dt;var f=arguments[0],i=arguments[1],s=arguments[2];this._inputGeom=f,this._distance=i,this._curveBuilder=s}}])})(),Ri=(function(){return h((function f(){C(this,f)}),[{key:"locate",value:function(f){}}])})(),pc=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,f.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Ur;var i=this._parent.getGeometryN(this._index++);return i instanceof kn?(this._subcollectionIterator=new f(i),this._subcollectionIterator.next()):i}},{key:"remove",value:function(){throw new Rr(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[kl]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var i=arguments[0];this._parent=i,this._atStart=!0,this._index=0,this._max=i.getNumGeometries()}},{key:"isAtomic",value:function(i){return!(i instanceof kn)}}])})(),Mn=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"locate",value:function(i){return f.locate(i,this._geom)}},{key:"interfaces_",get:function(){return[Ri]}}],[{key:"constructor_",value:function(){this._geom=null;var i=arguments[0];this._geom=i}},{key:"locatePointInPolygon",value:function(i,s){if(s.isEmpty())return we.EXTERIOR;var c=s.getExteriorRing(),w=f.locatePointInRing(i,c);if(w!==we.INTERIOR)return w;for(var L=0;L<s.getNumInteriorRing();L++){var F=s.getInteriorRingN(L),H=f.locatePointInRing(i,F);if(H===we.BOUNDARY)return we.BOUNDARY;if(H===we.INTERIOR)return we.EXTERIOR}return we.INTERIOR}},{key:"locatePointInRing",value:function(i,s){return s.getEnvelopeInternal().intersects(i)?_r.locateInRing(i,s.getCoordinates()):we.EXTERIOR}},{key:"containsPointInPolygon",value:function(i,s){return we.EXTERIOR!==f.locatePointInPolygon(i,s)}},{key:"locateInGeometry",value:function(i,s){if(s instanceof jt)return f.locatePointInPolygon(i,s);if(s instanceof kn)for(var c=new pc(s);c.hasNext();){var w=c.next();if(w!==s){var L=f.locateInGeometry(i,w);if(L!==we.EXTERIOR)return L}}return we.EXTERIOR}},{key:"isContained",value:function(i,s){return we.EXTERIOR!==f.locate(i,s)}},{key:"locate",value:function(i,s){return s.isEmpty()?we.EXTERIOR:s.getEnvelopeInternal().intersects(i)?f.locateInGeometry(i,s):we.EXTERIOR}}])})(),Cl=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"getNextCW",value:function(f){this.getEdges();var i=this._edgeList.indexOf(f),s=i-1;return i===0&&(s=this._edgeList.size()-1),this._edgeList.get(s)}},{key:"propagateSideLabels",value:function(f){for(var i=we.NONE,s=this.iterator();s.hasNext();){var c=s.next().getLabel();c.isArea(f)&&c.getLocation(f,ot.LEFT)!==we.NONE&&(i=c.getLocation(f,ot.LEFT))}if(i===we.NONE)return null;for(var w=i,L=this.iterator();L.hasNext();){var F=L.next(),H=F.getLabel();if(H.getLocation(f,ot.ON)===we.NONE&&H.setLocation(f,ot.ON,w),H.isArea(f)){var re=H.getLocation(f,ot.LEFT),fe=H.getLocation(f,ot.RIGHT);if(fe!==we.NONE){if(fe!==w)throw new _t("side location conflict",F.getCoordinate());re===we.NONE&&Pt.shouldNeverReachHere("found single null side (at "+F.getCoordinate()+")"),w=re}else Pt.isTrue(H.getLocation(f,ot.LEFT)===we.NONE,"found single null side"),H.setLocation(f,ot.RIGHT,w),H.setLocation(f,ot.LEFT,w)}}}},{key:"getCoordinate",value:function(){var f=this.iterator();return f.hasNext()?f.next().getCoordinate():null}},{key:"print",value:function(f){ki.out.println("EdgeEndStar:   "+this.getCoordinate());for(var i=this.iterator();i.hasNext();)i.next().print(f)}},{key:"isAreaLabelsConsistent",value:function(f){return this.computeEdgeEndLabels(f.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(f){var i=this.getEdges();if(i.size()<=0)return!0;var s=i.size()-1,c=i.get(s).getLabel().getLocation(f,ot.LEFT);Pt.isTrue(c!==we.NONE,"Found unlabelled area edge");for(var w=c,L=this.iterator();L.hasNext();){var F=L.next().getLabel();Pt.isTrue(F.isArea(f),"Found non-area edge");var H=F.getLocation(f,ot.LEFT),re=F.getLocation(f,ot.RIGHT);if(H===re||re!==w)return!1;w=H}return!0}},{key:"findIndex",value:function(f){this.iterator();for(var i=0;i<this._edgeList.size();i++)if(this._edgeList.get(i)===f)return i;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new dt(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(f,i,s){return this._ptInAreaLocation[f]===we.NONE&&(this._ptInAreaLocation[f]=Mn.locate(i,s[f].getGeometry())),this._ptInAreaLocation[f]}},{key:"toString",value:function(){var f=new ir;f.append("EdgeEndStar:   "+this.getCoordinate()),f.append(`
`);for(var i=this.iterator();i.hasNext();){var s=i.next();f.append(s),f.append(`
`)}return f.toString()}},{key:"computeEdgeEndLabels",value:function(f){for(var i=this.iterator();i.hasNext();)i.next().computeLabel(f)}},{key:"computeLabelling",value:function(f){this.computeEdgeEndLabels(f[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var i=[!1,!1],s=this.iterator();s.hasNext();)for(var c=s.next().getLabel(),w=0;w<2;w++)c.isLine(w)&&c.getLocation(w)===we.BOUNDARY&&(i[w]=!0);for(var L=this.iterator();L.hasNext();)for(var F=L.next(),H=F.getLabel(),re=0;re<2;re++)if(H.isAnyNull(re)){var fe=we.NONE;if(i[re])fe=we.EXTERIOR;else{var De=F.getCoordinate();fe=this.getLocation(re,De,f)}H.setAllLocationsIfNull(re,fe)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(f,i){this._edgeMap.put(f,i),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new Ds,this._edgeList=null,this._ptInAreaLocation=[we.NONE,we.NONE]}}])})(),oi=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var s=null,c=null,w=this._SCANNING_FOR_INCOMING,L=0;L<this._resultAreaEdgeList.size();L++){var F=this._resultAreaEdgeList.get(L),H=F.getSym();if(F.getLabel().isArea())switch(s===null&&F.isInResult()&&(s=F),w){case this._SCANNING_FOR_INCOMING:if(!H.isInResult())continue;c=H,w=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!F.isInResult())continue;c.setNext(F),w=this._SCANNING_FOR_INCOMING}}if(w===this._LINKING_TO_OUTGOING){if(s===null)throw new _t("no outgoing dirEdge found",this.getCoordinate());Pt.isTrue(s.isInResult(),"unable to link last incoming dirEdge"),c.setNext(s)}}},{key:"insert",value:function(s){var c=s;this.insertEdgeEnd(c,c)}},{key:"getRightmostEdge",value:function(){var s=this.getEdges(),c=s.size();if(c<1)return null;var w=s.get(0);if(c===1)return w;var L=s.get(c-1),F=w.getQuadrant(),H=L.getQuadrant();return Li.isNorthern(F)&&Li.isNorthern(H)?w:Li.isNorthern(F)||Li.isNorthern(H)?w.getDy()!==0?w:L.getDy()!==0?L:(Pt.shouldNeverReachHere("found two horizontal edges incident on node"),null):L}},{key:"print",value:function(s){ki.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var c=this.iterator();c.hasNext();){var w=c.next();s.print("out "),w.print(s),s.println(),s.print("in "),w.getSym().print(s),s.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new dt;for(var s=this.iterator();s.hasNext();){var c=s.next();(c.isInResult()||c.getSym().isInResult())&&this._resultAreaEdgeList.add(c)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(s){for(var c=this.iterator();c.hasNext();){var w=c.next().getLabel();w.setAllLocationsIfNull(0,s.getLocation(0)),w.setAllLocationsIfNull(1,s.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var s=null,c=null,w=this._edgeList.size()-1;w>=0;w--){var L=this._edgeList.get(w),F=L.getSym();c===null&&(c=F),s!==null&&F.setNext(s),s=L}c.setNext(s)}},{key:"computeDepths",value:function(){if(arguments.length===1){var s=arguments[0],c=this.findIndex(s),w=s.getDepth(ot.LEFT),L=s.getDepth(ot.RIGHT),F=this.computeDepths(c+1,this._edgeList.size(),w);if(this.computeDepths(0,c,F)!==L)throw new _t("depth mismatch at "+s.getCoordinate())}else if(arguments.length===3){for(var H=arguments[1],re=arguments[2],fe=arguments[0];fe<H;fe++){var De=this._edgeList.get(fe);De.setEdgeDepths(ot.RIGHT,re),re=De.getDepth(ot.LEFT)}return re}}},{key:"mergeSymLabels",value:function(){for(var s=this.iterator();s.hasNext();){var c=s.next();c.getLabel().merge(c.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(s){for(var c=null,w=null,L=this._SCANNING_FOR_INCOMING,F=this._resultAreaEdgeList.size()-1;F>=0;F--){var H=this._resultAreaEdgeList.get(F),re=H.getSym();switch(c===null&&H.getEdgeRing()===s&&(c=H),L){case this._SCANNING_FOR_INCOMING:if(re.getEdgeRing()!==s)continue;w=re,L=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(H.getEdgeRing()!==s)continue;w.setNextMin(H),L=this._SCANNING_FOR_INCOMING}}L===this._LINKING_TO_OUTGOING&&(Pt.isTrue(c!==null,"found null for first outgoing dirEdge"),Pt.isTrue(c.getEdgeRing()===s,"unable to link last incoming dirEdge"),w.setNextMin(c))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var s=0,c=this.iterator();c.hasNext();)c.next().isInResult()&&s++;return s}if(arguments.length===1){for(var w=arguments[0],L=0,F=this.iterator();F.hasNext();)F.next().getEdgeRing()===w&&L++;return L}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var s=we.NONE,c=this.iterator();c.hasNext();){var w=c.next(),L=w.getSym();if(!w.isLineEdge()){if(w.isInResult()){s=we.INTERIOR;break}if(L.isInResult()){s=we.EXTERIOR;break}}}if(s===we.NONE)return null;for(var F=s,H=this.iterator();H.hasNext();){var re=H.next(),fe=re.getSym();re.isLineEdge()?re.getEdge().setCovered(F===we.INTERIOR):(re.isInResult()&&(F=we.EXTERIOR),fe.isInResult()&&(F=we.INTERIOR))}}},{key:"computeLabelling",value:function(s){ce(i,"computeLabelling",this,1).call(this,s),this._label=new Wn(we.NONE);for(var c=this.iterator();c.hasNext();)for(var w=c.next().getEdge().getLabel(),L=0;L<2;L++){var F=w.getLocation(L);F!==we.INTERIOR&&F!==we.BOUNDARY||this._label.setLocation(L,we.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])})(Cl),Jn=(function(f){function i(){return C(this,i),P(this,i)}return B(i,f),h(i,[{key:"createNode",value:function(s){return new Ao(s,new oi)}}])})(vl),ts=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"compareTo",value:function(i){var s=i;return f.compareOriented(this._pts,this._orientation,s._pts,s._orientation)}},{key:"interfaces_",get:function(){return[Ge]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var i=arguments[0];this._pts=i,this._orientation=f.orientation(i)}},{key:"orientation",value:function(i){return Bn.increasingDirection(i)===1}},{key:"compareOriented",value:function(i,s,c,w){for(var L=s?1:-1,F=w?1:-1,H=s?i.length:-1,re=w?c.length:-1,fe=s?0:i.length-1,De=w?0:c.length-1;;){var $e=i[fe].compareTo(c[De]);if($e!==0)return $e;var ut=(fe+=L)===H,At=(De+=F)===re;if(ut&&!At)return-1;if(!ut&&At)return 1;if(ut&&At)return 0}}}])})(),rl=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"print",value:function(f){f.print("MULTILINESTRING ( ");for(var i=0;i<this._edges.size();i++){var s=this._edges.get(i);i>0&&f.print(","),f.print("(");for(var c=s.getCoordinates(),w=0;w<c.length;w++)w>0&&f.print(","),f.print(c[w].x+" "+c[w].y);f.println(")")}f.print(")  ")}},{key:"addAll",value:function(f){for(var i=f.iterator();i.hasNext();)this.add(i.next())}},{key:"findEdgeIndex",value:function(f){for(var i=0;i<this._edges.size();i++)if(this._edges.get(i).equals(f))return i;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(f){return this._edges.get(f)}},{key:"findEqualEdge",value:function(f){var i=new ts(f.getCoordinates());return this._ocaMap.get(i)}},{key:"add",value:function(f){this._edges.add(f);var i=new ts(f.getCoordinates());this._ocaMap.put(i,f)}}],[{key:"constructor_",value:function(){this._edges=new dt,this._ocaMap=new Ds}}])})(),to=(function(){return h((function f(){C(this,f)}),[{key:"processIntersections",value:function(f,i,s,c){}},{key:"isDone",value:function(){}}])})(),Pl=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"isTrivialIntersection",value:function(i,s,c,w){if(i===c&&this._li.getIntersectionNum()===1){if(f.isAdjacentSegments(s,w))return!0;if(i.isClosed()){var L=i.size()-1;if(s===0&&w===L||w===0&&s===L)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(i,s,c,w){if(i===c&&s===w)return null;this.numTests++;var L=i.getCoordinates()[s],F=i.getCoordinates()[s+1],H=c.getCoordinates()[w],re=c.getCoordinates()[w+1];this._li.computeIntersection(L,F,H,re),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(i,s,c,w)||(this._hasIntersection=!0,i.addIntersections(this._li,s,0),c.addIntersections(this._li,w,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[to]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var i=arguments[0];this._li=i}},{key:"isAdjacentSegments",value:function(i,s){return Math.abs(i-s)===1}}])})(),Na=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(f){f.print(this.coord),f.print(" seg # = "+this.segmentIndex),f.println(" dist = "+this.dist)}},{key:"compareTo",value:function(f){var i=f;return this.compare(i.segmentIndex,i.dist)}},{key:"isEndPoint",value:function(f){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===f}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(f,i){return this.segmentIndex<f?-1:this.segmentIndex>f?1:this.dist<i?-1:this.dist>i?1:0}},{key:"interfaces_",get:function(){return[Ge]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var f=arguments[0],i=arguments[1],s=arguments[2];this.coord=new Re(f),this.segmentIndex=i,this.dist=s}}])})(),no=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"print",value:function(f){f.println("Intersections:");for(var i=this.iterator();i.hasNext();)i.next().print(f)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(f){this.addEndpoints();for(var i=this.iterator(),s=i.next();i.hasNext();){var c=i.next(),w=this.createSplitEdge(s,c);f.add(w),s=c}}},{key:"addEndpoints",value:function(){var f=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[f],f,0)}},{key:"createSplitEdge",value:function(f,i){var s=i.segmentIndex-f.segmentIndex+2,c=this.edge.pts[i.segmentIndex],w=i.dist>0||!i.coord.equals2D(c);w||s--;var L=new Array(s).fill(null),F=0;L[F++]=new Re(f.coord);for(var H=f.segmentIndex+1;H<=i.segmentIndex;H++)L[F++]=this.edge.pts[H];return w&&(L[F]=i.coord),new io(L,new Wn(this.edge._label))}},{key:"add",value:function(f,i,s){var c=new Na(f,i,s),w=this._nodeMap.get(c);return w!==null?w:(this._nodeMap.put(c,c),c)}},{key:"isIntersection",value:function(f){for(var i=this.iterator();i.hasNext();)if(i.next().coord.equals(f))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new Ds,this.edge=null;var f=arguments[0];this.edge=f}}])})(),Zr=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])||f.isTrue(this._matrix[we.INTERIOR][we.BOUNDARY])||f.isTrue(this._matrix[we.BOUNDARY][we.INTERIOR])||f.isTrue(this._matrix[we.BOUNDARY][we.BOUNDARY]))&&this._matrix[we.EXTERIOR][we.INTERIOR]===se.FALSE&&this._matrix[we.EXTERIOR][we.BOUNDARY]===se.FALSE}},{key:"isCoveredBy",value:function(){return(f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])||f.isTrue(this._matrix[we.INTERIOR][we.BOUNDARY])||f.isTrue(this._matrix[we.BOUNDARY][we.INTERIOR])||f.isTrue(this._matrix[we.BOUNDARY][we.BOUNDARY]))&&this._matrix[we.INTERIOR][we.EXTERIOR]===se.FALSE&&this._matrix[we.BOUNDARY][we.EXTERIOR]===se.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var i=arguments[0],s=0;s<i.length;s++){var c=Math.trunc(s/3),w=s%3;this._matrix[c][w]=se.toDimensionValue(i.charAt(s))}else if(arguments.length===3){var L=arguments[0],F=arguments[1],H=arguments[2];this._matrix[L][F]=H}}},{key:"isContains",value:function(){return f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])&&this._matrix[we.EXTERIOR][we.INTERIOR]===se.FALSE&&this._matrix[we.EXTERIOR][we.BOUNDARY]===se.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var i=arguments[0],s=0;s<i.length;s++){var c=Math.trunc(s/3),w=s%3;this.setAtLeast(c,w,se.toDimensionValue(i.charAt(s)))}else if(arguments.length===3){var L=arguments[0],F=arguments[1],H=arguments[2];this._matrix[L][F]<H&&(this._matrix[L][F]=H)}}},{key:"setAtLeastIfValid",value:function(i,s,c){i>=0&&s>=0&&this.setAtLeast(i,s,c)}},{key:"isWithin",value:function(){return f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])&&this._matrix[we.INTERIOR][we.EXTERIOR]===se.FALSE&&this._matrix[we.BOUNDARY][we.EXTERIOR]===se.FALSE}},{key:"isTouches",value:function(i,s){return i>s?this.isTouches(s,i):(i===se.A&&s===se.A||i===se.L&&s===se.L||i===se.L&&s===se.A||i===se.P&&s===se.A||i===se.P&&s===se.L)&&this._matrix[we.INTERIOR][we.INTERIOR]===se.FALSE&&(f.isTrue(this._matrix[we.INTERIOR][we.BOUNDARY])||f.isTrue(this._matrix[we.BOUNDARY][we.INTERIOR])||f.isTrue(this._matrix[we.BOUNDARY][we.BOUNDARY]))}},{key:"isOverlaps",value:function(i,s){return i===se.P&&s===se.P||i===se.A&&s===se.A?f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])&&f.isTrue(this._matrix[we.INTERIOR][we.EXTERIOR])&&f.isTrue(this._matrix[we.EXTERIOR][we.INTERIOR]):i===se.L&&s===se.L&&this._matrix[we.INTERIOR][we.INTERIOR]===1&&f.isTrue(this._matrix[we.INTERIOR][we.EXTERIOR])&&f.isTrue(this._matrix[we.EXTERIOR][we.INTERIOR])}},{key:"isEquals",value:function(i,s){return i===s&&f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])&&this._matrix[we.INTERIOR][we.EXTERIOR]===se.FALSE&&this._matrix[we.BOUNDARY][we.EXTERIOR]===se.FALSE&&this._matrix[we.EXTERIOR][we.INTERIOR]===se.FALSE&&this._matrix[we.EXTERIOR][we.BOUNDARY]===se.FALSE}},{key:"toString",value:function(){for(var i=new hn("123456789"),s=0;s<3;s++)for(var c=0;c<3;c++)i.setCharAt(3*s+c,se.toDimensionSymbol(this._matrix[s][c]));return i.toString()}},{key:"setAll",value:function(i){for(var s=0;s<3;s++)for(var c=0;c<3;c++)this._matrix[s][c]=i}},{key:"get",value:function(i,s){return this._matrix[i][s]}},{key:"transpose",value:function(){var i=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=i,i=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=i,i=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=i,this}},{key:"matches",value:function(i){if(i.length!==9)throw new nt("Should be length 9: "+i);for(var s=0;s<3;s++)for(var c=0;c<3;c++)if(!f.matches(this._matrix[s][c],i.charAt(3*s+c)))return!1;return!0}},{key:"add",value:function(i){for(var s=0;s<3;s++)for(var c=0;c<3;c++)this.setAtLeast(s,c,i.get(s,c))}},{key:"isDisjoint",value:function(){return this._matrix[we.INTERIOR][we.INTERIOR]===se.FALSE&&this._matrix[we.INTERIOR][we.BOUNDARY]===se.FALSE&&this._matrix[we.BOUNDARY][we.INTERIOR]===se.FALSE&&this._matrix[we.BOUNDARY][we.BOUNDARY]===se.FALSE}},{key:"isCrosses",value:function(i,s){return i===se.P&&s===se.L||i===se.P&&s===se.A||i===se.L&&s===se.A?f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])&&f.isTrue(this._matrix[we.INTERIOR][we.EXTERIOR]):i===se.L&&s===se.P||i===se.A&&s===se.P||i===se.A&&s===se.L?f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])&&f.isTrue(this._matrix[we.EXTERIOR][we.INTERIOR]):i===se.L&&s===se.L&&this._matrix[we.INTERIOR][we.INTERIOR]===0}},{key:"interfaces_",get:function(){return[ht]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map((function(){return Array(3)})),this.setAll(se.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var i=arguments[0];f.constructor_.call(this),this.set(i)}else if(arguments[0]instanceof f){var s=arguments[0];f.constructor_.call(this),this._matrix[we.INTERIOR][we.INTERIOR]=s._matrix[we.INTERIOR][we.INTERIOR],this._matrix[we.INTERIOR][we.BOUNDARY]=s._matrix[we.INTERIOR][we.BOUNDARY],this._matrix[we.INTERIOR][we.EXTERIOR]=s._matrix[we.INTERIOR][we.EXTERIOR],this._matrix[we.BOUNDARY][we.INTERIOR]=s._matrix[we.BOUNDARY][we.INTERIOR],this._matrix[we.BOUNDARY][we.BOUNDARY]=s._matrix[we.BOUNDARY][we.BOUNDARY],this._matrix[we.BOUNDARY][we.EXTERIOR]=s._matrix[we.BOUNDARY][we.EXTERIOR],this._matrix[we.EXTERIOR][we.INTERIOR]=s._matrix[we.EXTERIOR][we.INTERIOR],this._matrix[we.EXTERIOR][we.BOUNDARY]=s._matrix[we.EXTERIOR][we.BOUNDARY],this._matrix[we.EXTERIOR][we.EXTERIOR]=s._matrix[we.EXTERIOR][we.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var i=arguments[0],s=arguments[1];return s===se.SYM_DONTCARE||s===se.SYM_TRUE&&(i>=0||i===se.TRUE)||s===se.SYM_FALSE&&i===se.FALSE||s===se.SYM_P&&i===se.P||s===se.SYM_L&&i===se.L||s===se.SYM_A&&i===se.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var c=arguments[1];return new f(arguments[0]).matches(c)}}},{key:"isTrue",value:function(i){return i>=0||i===se.TRUE}}])})(),Da=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(i){return i===null||i.length===0?null:(this.ensureCapacity(this._size+i.length),ki.arraycopy(i,0,this._data,this._size,i.length),void(this._size+=i.length))}},{key:"ensureCapacity",value:function(i){if(i<=this._data.length)return null;var s=Math.max(i,2*this._data.length);this._data=Ze.copyOf(this._data,s)}},{key:"toArray",value:function(){var i=new Array(this._size).fill(null);return ki.arraycopy(this._data,0,i,0,this._size),i}},{key:"add",value:function(i){this.ensureCapacity(this._size+1),this._data[this._size]=i,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)f.constructor_.call(this,10);else if(arguments.length===1){var i=arguments[0];this._data=new Array(i).fill(null)}}}])})(),uu=(function(){function f(){C(this,f)}return h(f,[{key:"getChainStartIndices",value:function(i){var s=0,c=new Da(Math.trunc(i.length/2));c.add(s);do{var w=this.findChainEnd(i,s);c.add(w),s=w}while(s<i.length-1);return c.toArray()}},{key:"findChainEnd",value:function(i,s){for(var c=Li.quadrant(i[s],i[s+1]),w=s+1;w<i.length&&Li.quadrant(i[w-1],i[w])===c;)w++;return w-1}},{key:"OLDgetChainStartIndices",value:function(i){var s=0,c=new dt;c.add(s);do{var w=this.findChainEnd(i,s);c.add(w),s=w}while(s<i.length-1);return f.toIntArray(c)}}],[{key:"toIntArray",value:function(i){for(var s=new Array(i.size()).fill(null),c=0;c<s.length;c++)s[c]=i.get(c).intValue();return s}}])})(),cu=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(f){var i=this.pts[this.startIndex[f]].x,s=this.pts[this.startIndex[f+1]].x;return i>s?i:s}},{key:"getMinX",value:function(f){var i=this.pts[this.startIndex[f]].x,s=this.pts[this.startIndex[f+1]].x;return i<s?i:s}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var f=arguments[0],i=arguments[1],s=arguments[2],c=arguments[3];this.computeIntersectsForChain(this.startIndex[f],this.startIndex[f+1],i,i.startIndex[s],i.startIndex[s+1],c)}else if(arguments.length===6){var w=arguments[0],L=arguments[1],F=arguments[2],H=arguments[3],re=arguments[4],fe=arguments[5];if(L-w==1&&re-H==1)return fe.addIntersections(this.e,w,F.e,H),null;if(!this.overlaps(w,L,F,H,re))return null;var De=Math.trunc((w+L)/2),$e=Math.trunc((H+re)/2);w<De&&(H<$e&&this.computeIntersectsForChain(w,De,F,H,$e,fe),$e<re&&this.computeIntersectsForChain(w,De,F,$e,re,fe)),De<L&&(H<$e&&this.computeIntersectsForChain(De,L,F,H,$e,fe),$e<re&&this.computeIntersectsForChain(De,L,F,$e,re,fe))}}},{key:"overlaps",value:function(f,i,s,c,w){return Cn.intersects(this.pts[f],this.pts[i],s.pts[c],s.pts[w])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(f,i){for(var s=0;s<this.startIndex.length-1;s++)for(var c=0;c<f.startIndex.length-1;c++)this.computeIntersectsForChain(s,f,c,i)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var f=arguments[0];this.e=f,this.pts=f.getCoordinates();var i=new uu;this.startIndex=i.getChainStartIndices(this.pts)}}])})(),za=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"getDepth",value:function(i,s){return this._depth[i][s]}},{key:"setDepth",value:function(i,s,c){this._depth[i][s]=c}},{key:"isNull",value:function(){if(arguments.length===0){for(var i=0;i<2;i++)for(var s=0;s<3;s++)if(this._depth[i][s]!==f.NULL_VALUE)return!1;return!0}if(arguments.length===1){var c=arguments[0];return this._depth[c][1]===f.NULL_VALUE}if(arguments.length===2){var w=arguments[0],L=arguments[1];return this._depth[w][L]===f.NULL_VALUE}}},{key:"normalize",value:function(){for(var i=0;i<2;i++)if(!this.isNull(i)){var s=this._depth[i][1];this._depth[i][2]<s&&(s=this._depth[i][2]),s<0&&(s=0);for(var c=1;c<3;c++){var w=0;this._depth[i][c]>s&&(w=1),this._depth[i][c]=w}}}},{key:"getDelta",value:function(i){return this._depth[i][ot.RIGHT]-this._depth[i][ot.LEFT]}},{key:"getLocation",value:function(i,s){return this._depth[i][s]<=0?we.EXTERIOR:we.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var i=arguments[0],s=0;s<2;s++)for(var c=1;c<3;c++){var w=i.getLocation(s,c);w!==we.EXTERIOR&&w!==we.INTERIOR||(this.isNull(s,c)?this._depth[s][c]=f.depthAtLocation(w):this._depth[s][c]+=f.depthAtLocation(w))}else if(arguments.length===3){var L=arguments[0],F=arguments[1];arguments[2]===we.INTERIOR&&this._depth[L][F]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var i=0;i<2;i++)for(var s=0;s<3;s++)this._depth[i][s]=f.NULL_VALUE}},{key:"depthAtLocation",value:function(i){return i===we.EXTERIOR?0:i===we.INTERIOR?1:f.NULL_VALUE}}])})();za.NULL_VALUE=-1;var io=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var s=new Array(2).fill(null);return s[0]=this.pts[0],s[1]=this.pts[1],new i(s,Wn.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(s){this._isIsolated=s}},{key:"setName",value:function(s){this._name=s}},{key:"equals",value:function(s){if(!(s instanceof i))return!1;var c=s;if(this.pts.length!==c.pts.length)return!1;for(var w=!0,L=!0,F=this.pts.length,H=0;H<this.pts.length;H++)if(this.pts[H].equals2D(c.pts[H])||(w=!1),this.pts[H].equals2D(c.pts[--F])||(L=!1),!w&&!L)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var s=arguments[0];return this.pts[s]}}},{key:"print",value:function(s){s.print("edge "+this._name+": "),s.print("LINESTRING (");for(var c=0;c<this.pts.length;c++)c>0&&s.print(","),s.print(this.pts[c].x+" "+this.pts[c].y);s.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(s){i.updateIM(this._label,s)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(s){s.print("edge "+this._name+": ");for(var c=this.pts.length-1;c>=0;c--)s.print(this.pts[c]+" ");s.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new cu(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new Cn;for(var s=0;s<this.pts.length;s++)this._env.expandToInclude(this.pts[s])}return this._env}},{key:"addIntersection",value:function(s,c,w,L){var F=new Re(s.getIntersection(L)),H=c,re=s.getEdgeDistance(w,L),fe=H+1;if(fe<this.pts.length){var De=this.pts[fe];F.equals2D(De)&&(H=fe,re=0)}this.eiList.add(F,H,re)}},{key:"toString",value:function(){var s=new hn;s.append("edge "+this._name+": "),s.append("LINESTRING (");for(var c=0;c<this.pts.length;c++)c>0&&s.append(","),s.append(this.pts[c].x+" "+this.pts[c].y);return s.append(")  "+this._label+" "+this._depthDelta),s.toString()}},{key:"isPointwiseEqual",value:function(s){if(this.pts.length!==s.pts.length)return!1;for(var c=0;c<this.pts.length;c++)if(!this.pts[c].equals2D(s.pts[c]))return!1;return!0}},{key:"setDepthDelta",value:function(s){this._depthDelta=s}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(s,c,w){for(var L=0;L<s.getIntersectionNum();L++)this.addIntersection(s,c,w,L)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new no(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new za,this._depthDelta=0,arguments.length===1){var s=arguments[0];i.constructor_.call(this,s,null)}else if(arguments.length===2){var c=arguments[0],w=arguments[1];this.pts=c,this._label=w}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Zr&&arguments[0]instanceof Wn))return ce(i,"updateIM",this).apply(this,arguments);var s=arguments[0],c=arguments[1];c.setAtLeastIfValid(s.getLocation(0,ot.ON),s.getLocation(1,ot.ON),1),s.isArea()&&(c.setAtLeastIfValid(s.getLocation(0,ot.LEFT),s.getLocation(1,ot.LEFT),2),c.setAtLeastIfValid(s.getLocation(0,ot.RIGHT),s.getLocation(1,ot.RIGHT),2))}}])})(Ko),ro=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"setWorkingPrecisionModel",value:function(i){this._workingPrecisionModel=i}},{key:"insertUniqueEdge",value:function(i){var s=this._edgeList.findEqualEdge(i);if(s!==null){var c=s.getLabel(),w=i.getLabel();s.isPointwiseEqual(i)||(w=new Wn(i.getLabel())).flip(),c.merge(w);var L=f.depthDelta(w),F=s.getDepthDelta()+L;s.setDepthDelta(F)}else this._edgeList.add(i),i.setDepthDelta(f.depthDelta(i.getLabel()))}},{key:"buildSubgraphs",value:function(i,s){for(var c=new dt,w=i.iterator();w.hasNext();){var L=w.next(),F=L.getRightmostCoordinate(),H=new Il(c).getDepth(F);L.computeDepth(H),L.findResultEdges(),c.add(L),s.add(L.getDirectedEdges(),L.getNodes())}}},{key:"createSubgraphs",value:function(i){for(var s=new dt,c=i.getNodes().iterator();c.hasNext();){var w=c.next();if(!w.isVisited()){var L=new qr;L.create(w),s.add(L)}}return Ka.sort(s,Ka.reverseOrder()),s}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(i){if(this._workingNoder!==null)return this._workingNoder;var s=new El,c=new Rs;return c.setPrecisionModel(i),s.setSegmentIntersector(new Pl(c)),s}},{key:"buffer",value:function(i,s){var c=this._workingPrecisionModel;c===null&&(c=i.getPrecisionModel()),this._geomFact=i.getFactory();var w=new nl(c,this._bufParams),L=new dc(i,s,w).getCurves();if(L.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(L,c),this._graph=new Gr(new Jn),this._graph.addEdges(this._edgeList.getEdges());var F=this.createSubgraphs(this._graph),H=new xl(this._geomFact);this.buildSubgraphs(F,H);var re=H.getPolygons();return re.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(re)}},{key:"computeNodedEdges",value:function(i,s){var c=this.getNoder(s);c.computeNodes(i);for(var w=c.getNodedSubstrings().iterator();w.hasNext();){var L=w.next(),F=L.getCoordinates();if(F.length!==2||!F[0].equals2D(F[1])){var H=L.getData(),re=new io(L.getCoordinates(),new Wn(H));this.insertUniqueEdge(re)}}}},{key:"setNoder",value:function(i){this._workingNoder=i}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new rl;var i=arguments[0];this._bufParams=i}},{key:"depthDelta",value:function(i){var s=i.getLocation(0,ot.LEFT),c=i.getLocation(0,ot.RIGHT);return s===we.INTERIOR&&c===we.EXTERIOR?1:s===we.EXTERIOR&&c===we.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(i){for(var s=new Qr,c=new dt;i.hasNext();){var w=i.next(),L=s.createLineString(w.getCoordinates());c.add(L)}return s.buildGeometry(c)}}])})(),Fs=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"rescale",value:function(){if(vn(arguments[0],Gi))for(var i=arguments[0].iterator();i.hasNext();){var s=i.next();this.rescale(s.getCoordinates())}else if(arguments[0]instanceof Array){for(var c=arguments[0],w=0;w<c.length;w++)c[w].x=c[w].x/this._scaleFactor+this._offsetX,c[w].y=c[w].y/this._scaleFactor+this._offsetY;c.length===2&&c[0].equals2D(c[1])&&ki.out.println(c)}}},{key:"scale",value:function(){if(vn(arguments[0],Gi)){for(var i=arguments[0],s=new dt(i.size()),c=i.iterator();c.hasNext();){var w=c.next();s.add(new _s(this.scale(w.getCoordinates()),w.getData()))}return s}if(arguments[0]instanceof Array){for(var L=arguments[0],F=new Array(L.length).fill(null),H=0;H<L.length;H++)F[H]=new Re(Math.round((L[H].x-this._offsetX)*this._scaleFactor),Math.round((L[H].y-this._offsetY)*this._scaleFactor),L[H].getZ());return Bn.removeRepeatedPoints(F)}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var i=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(i),i}},{key:"computeNodes",value:function(i){var s=i;this._isScaled&&(s=this.scale(i)),this._noder.computeNodes(s)}},{key:"interfaces_",get:function(){return[Sl]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var i=arguments[0],s=arguments[1];f.constructor_.call(this,i,s,0,0)}else if(arguments.length===4){var c=arguments[0],w=arguments[1];this._noder=c,this._scaleFactor=w,this._isScaled=!this.isIntegerPrecision()}}}])})(),Bs=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var i=this._segStrings.iterator();i.hasNext();){var s=i.next().getCoordinates();this.checkEndPtVertexIntersections(s[0],this._segStrings),this.checkEndPtVertexIntersections(s[s.length-1],this._segStrings)}else if(arguments.length===2){for(var c=arguments[0],w=arguments[1].iterator();w.hasNext();)for(var L=w.next().getCoordinates(),F=1;F<L.length-1;F++)if(L[F].equals(c))throw new rt("found endpt/interior pt intersection at index "+F+" :pt "+c)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var i=this._segStrings.iterator();i.hasNext();)for(var s=i.next(),c=this._segStrings.iterator();c.hasNext();){var w=c.next();this.checkInteriorIntersections(s,w)}else if(arguments.length===2)for(var L=arguments[0],F=arguments[1],H=L.getCoordinates(),re=F.getCoordinates(),fe=0;fe<H.length-1;fe++)for(var De=0;De<re.length-1;De++)this.checkInteriorIntersections(L,fe,F,De);else if(arguments.length===4){var $e=arguments[0],ut=arguments[1],At=arguments[2],Gt=arguments[3];if($e===At&&ut===Gt)return null;var on=$e.getCoordinates()[ut],Nn=$e.getCoordinates()[ut+1],An=At.getCoordinates()[Gt],Un=At.getCoordinates()[Gt+1];if(this._li.computeIntersection(on,Nn,An,Un),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,on,Nn)||this.hasInteriorIntersection(this._li,An,Un)))throw new rt("found non-noded intersection at "+on+"-"+Nn+" and "+An+"-"+Un)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var i=this._segStrings.iterator();i.hasNext();){var s=i.next();this.checkCollapses(s)}else if(arguments.length===1)for(var c=arguments[0].getCoordinates(),w=0;w<c.length-2;w++)this.checkCollapse(c[w],c[w+1],c[w+2])}},{key:"hasInteriorIntersection",value:function(i,s,c){for(var w=0;w<i.getIntersectionNum();w++){var L=i.getIntersection(w);if(!L.equals(s)&&!L.equals(c))return!0}return!1}},{key:"checkCollapse",value:function(i,s,c){if(i.equals(c))throw new rt("found non-noded collapse at "+f.fact.createLineString([i,s,c]))}}],[{key:"constructor_",value:function(){this._li=new Rs,this._segStrings=null;var i=arguments[0];this._segStrings=i}}])})();Bs.fact=new Qr;var No=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"intersectsScaled",value:function(i,s){var c=Math.min(i.x,s.x),w=Math.max(i.x,s.x),L=Math.min(i.y,s.y),F=Math.max(i.y,s.y),H=this._maxx<c||this._minx>w||this._maxy<L||this._miny>F;if(H)return!1;var re=this.intersectsToleranceSquare(i,s);return Pt.isTrue(!(H&&re),"Found bad envelope test"),re}},{key:"initCorners",value:function(i){var s=.5;this._minx=i.x-s,this._maxx=i.x+s,this._miny=i.y-s,this._maxy=i.y+s,this._corner[0]=new Re(this._maxx,this._maxy),this._corner[1]=new Re(this._minx,this._maxy),this._corner[2]=new Re(this._minx,this._miny),this._corner[3]=new Re(this._maxx,this._miny)}},{key:"intersects",value:function(i,s){return this._scaleFactor===1?this.intersectsScaled(i,s):(this.copyScaled(i,this._p0Scaled),this.copyScaled(s,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(i){return Math.round(i*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(i,s){s.x=this.scale(i.x),s.y=this.scale(i.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var i=f.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Cn(this._originalPt.x-i,this._originalPt.x+i,this._originalPt.y-i,this._originalPt.y+i)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(i,s){return this._li.computeIntersection(i,s,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(i,s,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(i,s,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(i,s,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(i,s){var c=!1,w=!1;return this._li.computeIntersection(i,s,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(i,s,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(c=!0),this._li.computeIntersection(i,s,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(w=!0),this._li.computeIntersection(i,s,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!c||!w)||!!i.equals(this._pt)||!!s.equals(this._pt))))}},{key:"addSnappedNode",value:function(i,s){var c=i.getCoordinate(s),w=i.getCoordinate(s+1);return!!this.intersects(c,w)&&(i.addIntersection(this.getCoordinate(),s),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var i=arguments[0],s=arguments[1],c=arguments[2];if(this._originalPt=i,this._pt=i,this._scaleFactor=s,this._li=c,s<=0)throw new nt("Scale factor must be non-zero");s!==1&&(this._pt=new Re(this.scale(i.x),this.scale(i.y)),this._p0Scaled=new Re,this._p1Scaled=new Re),this.initCorners(this._pt)}}])})();No.SAFE_ENV_EXPANSION_FACTOR=.75;var ha=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var f=arguments[1];arguments[0].getLineSegment(f,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new $r}}])})(),so=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"snap",value:function(){if(arguments.length===1){var f=arguments[0];return this.snap(f,null,-1)}if(arguments.length===3){var i=arguments[0],s=arguments[1],c=arguments[2],w=i.getSafeEnvelope(),L=new Ml(i,s,c);return this._index.query(w,new((function(){return h((function F(){C(this,F)}),[{key:"interfaces_",get:function(){return[wl]}},{key:"visitItem",value:function(F){F.select(w,L)}}])})())),L.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var f=arguments[0];this._index=f}}])})(),Ml=(function(f){function i(){var s;return C(this,i),s=P(this,i),i.constructor_.apply(s,arguments),s}return B(i,f),h(i,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof Ou))return ce(i,"select",this,1).apply(this,arguments);var s=arguments[1],c=arguments[0].getContext();if(this._parentEdge===c&&(s===this._hotPixelVertexIndex||s+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(c,s)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var s=arguments[0],c=arguments[1],w=arguments[2];this._hotPixel=s,this._parentEdge=c,this._hotPixelVertexIndex=w}}])})(ha);so.HotPixelSnapAction=Ml;var sl=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"processIntersections",value:function(f,i,s,c){if(f===s&&i===c)return null;var w=f.getCoordinates()[i],L=f.getCoordinates()[i+1],F=s.getCoordinates()[c],H=s.getCoordinates()[c+1];if(this._li.computeIntersection(w,L,F,H),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var re=0;re<this._li.getIntersectionNum();re++)this._interiorIntersections.add(this._li.getIntersection(re));f.addIntersections(this._li,i,0),s.addIntersections(this._li,c,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[to]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var f=arguments[0];this._li=f,this._interiorIntersections=new dt}}])})(),jn=(function(){return h((function f(){C(this,f),f.constructor_.apply(this,arguments)}),[{key:"checkCorrectness",value:function(f){var i=_s.getNodedSubstrings(f),s=new Bs(i);try{s.checkValid()}catch(c){if(!(c instanceof tt))throw c;c.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return _s.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(f,i){var s=this.findInteriorIntersections(f,i);this.computeIntersectionSnaps(s),this.computeVertexSnaps(f)}},{key:"findInteriorIntersections",value:function(f,i){var s=new sl(i);return this._noder.setSegmentIntersector(s),this._noder.computeNodes(f),s.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(vn(arguments[0],Gi))for(var f=arguments[0].iterator();f.hasNext();){var i=f.next();this.computeVertexSnaps(i)}else if(arguments[0]instanceof _s)for(var s=arguments[0],c=s.getCoordinates(),w=0;w<c.length;w++){var L=new No(c[w],this._scaleFactor,this._li);this._pointSnapper.snap(L,s,w)&&s.addIntersection(c[w],w)}}},{key:"computeNodes",value:function(f){this._nodedSegStrings=f,this._noder=new El,this._pointSnapper=new so(this._noder.getIndex()),this.snapRound(f,this._li)}},{key:"computeIntersectionSnaps",value:function(f){for(var i=f.iterator();i.hasNext();){var s=i.next(),c=new No(s,this._scaleFactor,this._li);this._pointSnapper.snap(c)}}},{key:"interfaces_",get:function(){return[Sl]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var f=arguments[0];this._pm=f,this._li=new Rs,this._li.setPrecisionModel(f),this._scaleFactor=f.getScale()}}])})(),js=(function(){function f(){C(this,f),f.constructor_.apply(this,arguments)}return h(f,[{key:"bufferFixedPrecision",value:function(i){var s=new Fs(new jn(new Ei(1)),i.getScale()),c=new ro(this._bufParams);c.setWorkingPrecisionModel(i),c.setNoder(s),this._resultGeometry=c.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var i=f.MAX_PRECISION_DIGITS;i>=0;i--){try{this.bufferReducedPrecision(i)}catch(L){if(!(L instanceof _t))throw L;this._saveException=L}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var s=arguments[0],c=f.precisionScaleFactor(this._argGeom,this._distance,s),w=new Ei(c);this.bufferFixedPrecision(w)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var i=this._argGeom.getFactory().getPrecisionModel();i.getType()===Ei.FIXED?this.bufferFixedPrecision(i):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(i){this._bufParams.setQuadrantSegments(i)}},{key:"bufferOriginalPrecision",value:function(){try{var i=new ro(this._bufParams);this._resultGeometry=i.buffer(this._argGeom,this._distance)}catch(s){if(!(s instanceof rt))throw s;this._saveException=s}}},{key:"getResultGeometry",value:function(i){return this._distance=i,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(i){this._bufParams.setEndCapStyle(i)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new qe,this._resultGeometry=null,this._saveException=null,arguments.length===1){var i=arguments[0];this._argGeom=i}else if(arguments.length===2){var s=arguments[0],c=arguments[1];this._argGeom=s,this._bufParams=c}}},{key:"bufferOp",value:function(){if(arguments.length===2){var i=arguments[1];return new f(arguments[0]).getResultGeometry(i)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Wt&&typeof arguments[1]=="number"){var s=arguments[1],c=arguments[2],w=new f(arguments[0]);return w.setQuadrantSegments(c),w.getResultGeometry(s)}if(arguments[2]instanceof qe&&arguments[0]instanceof Wt&&typeof arguments[1]=="number"){var L=arguments[1];return new f(arguments[0],arguments[2]).getResultGeometry(L)}}else if(arguments.length===4){var F=arguments[1],H=arguments[2],re=arguments[3],fe=new f(arguments[0]);return fe.setQuadrantSegments(H),fe.setEndCapStyle(re),fe.getResultGeometry(F)}}},{key:"precisionScaleFactor",value:function(i,s,c){var w=i.getEnvelopeInternal(),L=Sr.max(Math.abs(w.getMaxX()),Math.abs(w.getMaxY()),Math.abs(w.getMinX()),Math.abs(w.getMinY()))+2*(s>0?s:0),F=c-Math.trunc(Math.log(L)/Math.log(10)+1);return Math.pow(10,F)}}])})();js.CAP_ROUND=qe.CAP_ROUND,js.CAP_BUTT=qe.CAP_FLAT,js.CAP_FLAT=qe.CAP_FLAT,js.CAP_SQUARE=qe.CAP_SQUARE,js.MAX_PRECISION_DIGITS=12;var Fu=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Al=(function(){return h((function f(i){C(this,f),this.geometryFactory=i||new Qr}),[{key:"read",value:function(f){var i,s=(i=typeof f=="string"?JSON.parse(f):f).type;if(!ar[s])throw new Error("Unknown GeoJSON type: "+i.type);return Fu.indexOf(s)!==-1?ar[s].call(this,i.coordinates):s==="GeometryCollection"?ar[s].call(this,i.geometries):ar[s].call(this,i)}},{key:"write",value:function(f){var i=f.getGeometryType();if(!vs[i])throw new Error("Geometry is not supported");return vs[i].call(this,f)}}])})(),ar={Feature:function(f){var i={};for(var s in f)i[s]=f[s];if(f.geometry){var c=f.geometry.type;if(!ar[c])throw new Error("Unknown GeoJSON type: "+f.type);i.geometry=this.read(f.geometry)}return f.bbox&&(i.bbox=ar.bbox.call(this,f.bbox)),i},FeatureCollection:function(f){var i={};if(f.features){i.features=[];for(var s=0;s<f.features.length;++s)i.features.push(this.read(f.features[s]))}return f.bbox&&(i.bbox=this.parse.bbox.call(this,f.bbox)),i},coordinates:function(f){for(var i=[],s=0;s<f.length;++s){var c=f[s];i.push(O(Re,de(c)))}return i},bbox:function(f){return this.geometryFactory.createLinearRing([new Re(f[0],f[1]),new Re(f[2],f[1]),new Re(f[2],f[3]),new Re(f[0],f[3]),new Re(f[0],f[1])])},Point:function(f){var i=O(Re,de(f));return this.geometryFactory.createPoint(i)},MultiPoint:function(f){for(var i=[],s=0;s<f.length;++s)i.push(ar.Point.call(this,f[s]));return this.geometryFactory.createMultiPoint(i)},LineString:function(f){var i=ar.coordinates.call(this,f);return this.geometryFactory.createLineString(i)},MultiLineString:function(f){for(var i=[],s=0;s<f.length;++s)i.push(ar.LineString.call(this,f[s]));return this.geometryFactory.createMultiLineString(i)},Polygon:function(f){for(var i=ar.coordinates.call(this,f[0]),s=this.geometryFactory.createLinearRing(i),c=[],w=1;w<f.length;++w){var L=f[w],F=ar.coordinates.call(this,L),H=this.geometryFactory.createLinearRing(F);c.push(H)}return this.geometryFactory.createPolygon(s,c)},MultiPolygon:function(f){for(var i=[],s=0;s<f.length;++s){var c=f[s];i.push(ar.Polygon.call(this,c))}return this.geometryFactory.createMultiPolygon(i)},GeometryCollection:function(f){for(var i=[],s=0;s<f.length;++s){var c=f[s];i.push(this.read(c))}return this.geometryFactory.createGeometryCollection(i)}},vs={coordinate:function(f){var i=[f.x,f.y];return f.z&&i.push(f.z),f.m&&i.push(f.m),i},Point:function(f){return{type:"Point",coordinates:vs.coordinate.call(this,f.getCoordinate())}},MultiPoint:function(f){for(var i=[],s=0;s<f._geometries.length;++s){var c=f._geometries[s],w=vs.Point.call(this,c);i.push(w.coordinates)}return{type:"MultiPoint",coordinates:i}},LineString:function(f){for(var i=[],s=f.getCoordinates(),c=0;c<s.length;++c){var w=s[c];i.push(vs.coordinate.call(this,w))}return{type:"LineString",coordinates:i}},MultiLineString:function(f){for(var i=[],s=0;s<f._geometries.length;++s){var c=f._geometries[s],w=vs.LineString.call(this,c);i.push(w.coordinates)}return{type:"MultiLineString",coordinates:i}},Polygon:function(f){var i=[],s=vs.LineString.call(this,f._shell);i.push(s.coordinates);for(var c=0;c<f._holes.length;++c){var w=f._holes[c],L=vs.LineString.call(this,w);i.push(L.coordinates)}return{type:"Polygon",coordinates:i}},MultiPolygon:function(f){for(var i=[],s=0;s<f._geometries.length;++s){var c=f._geometries[s],w=vs.Polygon.call(this,c);i.push(w.coordinates)}return{type:"MultiPolygon",coordinates:i}},GeometryCollection:function(f){for(var i=[],s=0;s<f._geometries.length;++s){var c=f._geometries[s],w=c.getGeometryType();i.push(vs[w].call(this,c))}return{type:"GeometryCollection",geometries:i}}};return{BufferOp:js,GeoJSONReader:(function(){return h((function f(i){C(this,f),this.parser=new Al(i||new Qr)}),[{key:"read",value:function(f){return this.parser.read(f)}}])})(),GeoJSONWriter:(function(){return h((function f(){C(this,f),this.parser=new Al(this.geometryFactory)}),[{key:"write",value:function(f){return this.parser.write(f)}}])})()}}))})(Vd)),Vd.exports}var g_=m_();const y_=Uf(g_);function cc(){return new Hd}function Hd(){this.reset()}Hd.prototype={constructor:Hd,reset:function(){this.s=this.t=0},add:function(S){Ym(Od,S,this.t),Ym(this,Od.s,this.s),this.s?this.t+=Od.t:this.s=Od.t},valueOf:function(){return this.s}};var Od=new Hd;function Ym(S,b,k){var P=S.s=b+k,C=P-b,O=P-C;S.t=b-O+(k-C)}var Hi=1e-6,di=Math.PI,ru=di/2,Km=di/4,su=di*2,rc=180/di,Zo=di/180,fs=Math.abs,__=Math.atan,Zh=Math.atan2,fr=Math.cos,dr=Math.sin,Yh=Math.sqrt;function Fg(S){return S>1?0:S<-1?di:Math.acos(S)}function nh(S){return S>1?ru:S<-1?-ru:Math.asin(S)}function Nf(){}function Xd(S,b){S&&Qm.hasOwnProperty(S.type)&&Qm[S.type](S,b)}var Jm={Feature:function(S,b){Xd(S.geometry,b)},FeatureCollection:function(S,b){for(var k=S.features,P=-1,C=k.length;++P<C;)Xd(k[P].geometry,b)}},Qm={Sphere:function(S,b){b.sphere()},Point:function(S,b){S=S.coordinates,b.point(S[0],S[1],S[2])},MultiPoint:function(S,b){for(var k=S.coordinates,P=-1,C=k.length;++P<C;)S=k[P],b.point(S[0],S[1],S[2])},LineString:function(S,b){Hp(S.coordinates,b,0)},MultiLineString:function(S,b){for(var k=S.coordinates,P=-1,C=k.length;++P<C;)Hp(k[P],b,0)},Polygon:function(S,b){eg(S.coordinates,b)},MultiPolygon:function(S,b){for(var k=S.coordinates,P=-1,C=k.length;++P<C;)eg(k[P],b)},GeometryCollection:function(S,b){for(var k=S.geometries,P=-1,C=k.length;++P<C;)Xd(k[P],b)}};function Hp(S,b,k){var P=-1,C=S.length-k,O;for(b.lineStart();++P<C;)O=S[P],b.point(O[0],O[1],O[2]);b.lineEnd()}function eg(S,b){var k=-1,P=S.length;for(b.polygonStart();++k<P;)Hp(S[k],b,1);b.polygonEnd()}function v_(S,b){S&&Jm.hasOwnProperty(S.type)?Jm[S.type](S,b):Xd(S,b)}cc();cc();function Xp(S){return[Zh(S[1],S[0]),nh(S[2])]}function Hh(S){var b=S[0],k=S[1],P=fr(k);return[P*fr(b),P*dr(b),dr(k)]}function Fd(S,b){return S[0]*b[0]+S[1]*b[1]+S[2]*b[2]}function Wd(S,b){return[S[1]*b[2]-S[2]*b[1],S[2]*b[0]-S[0]*b[2],S[0]*b[1]-S[1]*b[0]]}function Bp(S,b){S[0]+=b[0],S[1]+=b[1],S[2]+=b[2]}function Bd(S,b){return[S[0]*b,S[1]*b,S[2]*b]}function Wp(S){var b=Yh(S[0]*S[0]+S[1]*S[1]+S[2]*S[2]);S[0]/=b,S[1]/=b,S[2]/=b}cc();function Bg(S,b){function k(P,C){return P=S(P,C),b(P[0],P[1])}return S.invert&&b.invert&&(k.invert=function(P,C){return P=b.invert(P,C),P&&S.invert(P[0],P[1])}),k}function Yp(S,b){return[S>di?S-su:S<-di?S+su:S,b]}Yp.invert=Yp;function x_(S,b,k){return(S%=su)?b||k?Bg(ng(S),ig(b,k)):ng(S):b||k?ig(b,k):Yp}function tg(S){return function(b,k){return b+=S,[b>di?b-su:b<-di?b+su:b,k]}}function ng(S){var b=tg(S);return b.invert=tg(-S),b}function ig(S,b){var k=fr(S),P=dr(S),C=fr(b),O=dr(b);function R(h,K){var ne=fr(K),ee=fr(h)*ne,B=dr(h)*ne,q=dr(K),ue=q*k+ee*P;return[Zh(B*C-ue*O,ee*k-q*P),nh(ue*C+B*O)]}return R.invert=function(h,K){var ne=fr(K),ee=fr(h)*ne,B=dr(h)*ne,q=dr(K),ue=q*C-B*O;return[Zh(B*C+q*O,ee*k+ue*P),nh(ue*k-ee*P)]},R}function w_(S,b,k,P,C,O){if(k){var R=fr(b),h=dr(b),K=P*k;C==null?(C=b+P*su,O=b-K/2):(C=rg(R,C),O=rg(R,O),(P>0?C<O:C>O)&&(C+=P*su));for(var ne,ee=C;P>0?ee>O:ee<O;ee-=K)ne=Xp([R,-h*fr(ee),-h*dr(ee)]),S.point(ne[0],ne[1])}}function rg(S,b){b=Hh(b),b[0]-=S,Wp(b);var k=Fg(-b[1]);return((-b[2]<0?-k:k)+su-Hi)%su}function jg(){var S=[],b;return{point:function(k,P){b.push([k,P])},lineStart:function(){S.push(b=[])},lineEnd:Nf,rejoin:function(){S.length>1&&S.push(S.pop().concat(S.shift()))},result:function(){var k=S;return S=[],b=null,k}}}function b_(S,b,k,P,C,O){var R=S[0],h=S[1],K=b[0],ne=b[1],ee=0,B=1,q=K-R,ue=ne-h,ce;if(ce=k-R,!(!q&&ce>0)){if(ce/=q,q<0){if(ce<ee)return;ce<B&&(B=ce)}else if(q>0){if(ce>B)return;ce>ee&&(ee=ce)}if(ce=C-R,!(!q&&ce<0)){if(ce/=q,q<0){if(ce>B)return;ce>ee&&(ee=ce)}else if(q>0){if(ce<ee)return;ce<B&&(B=ce)}if(ce=P-h,!(!ue&&ce>0)){if(ce/=ue,ue<0){if(ce<ee)return;ce<B&&(B=ce)}else if(ue>0){if(ce>B)return;ce>ee&&(ee=ce)}if(ce=O-h,!(!ue&&ce<0)){if(ce/=ue,ue<0){if(ce>B)return;ce>ee&&(ee=ce)}else if(ue>0){if(ce<ee)return;ce<B&&(B=ce)}return ee>0&&(S[0]=R+ee*q,S[1]=h+ee*ue),B<1&&(b[0]=R+B*q,b[1]=h+B*ue),!0}}}}}function qd(S,b){return fs(S[0]-b[0])<Hi&&fs(S[1]-b[1])<Hi}function jd(S,b,k,P){this.x=S,this.z=b,this.o=k,this.e=P,this.v=!1,this.n=this.p=null}function Ug(S,b,k,P,C){var O=[],R=[],h,K;if(S.forEach(function(ce){if(!((de=ce.length-1)<=0)){var de,Pe=ce[0],je=ce[de],Te;if(qd(Pe,je)){for(C.lineStart(),h=0;h<de;++h)C.point((Pe=ce[h])[0],Pe[1]);C.lineEnd();return}O.push(Te=new jd(Pe,ce,null,!0)),R.push(Te.o=new jd(Pe,null,Te,!1)),O.push(Te=new jd(je,ce,null,!1)),R.push(Te.o=new jd(je,null,Te,!0))}}),!!O.length){for(R.sort(b),sg(O),sg(R),h=0,K=R.length;h<K;++h)R[h].e=k=!k;for(var ne=O[0],ee,B;;){for(var q=ne,ue=!0;q.v;)if((q=q.n)===ne)return;ee=q.z,C.lineStart();do{if(q.v=q.o.v=!0,q.e){if(ue)for(h=0,K=ee.length;h<K;++h)C.point((B=ee[h])[0],B[1]);else P(q.x,q.n.x,1,C);q=q.n}else{if(ue)for(ee=q.p.z,h=ee.length-1;h>=0;--h)C.point((B=ee[h])[0],B[1]);else P(q.x,q.p.x,-1,C);q=q.p}q=q.o,ee=q.z,ue=!ue}while(!q.v);C.lineEnd()}}}function sg(S){if(b=S.length){for(var b,k=0,P=S[0],C;++k<b;)P.n=C=S[k],C.p=P,P=C;P.n=C=S[0],C.p=P}}function Vg(S,b){return S<b?-1:S>b?1:S>=b?0:NaN}function k_(S){return S.length===1&&(S=S_(S)),{left:function(b,k,P,C){for(P==null&&(P=0),C==null&&(C=b.length);P<C;){var O=P+C>>>1;S(b[O],k)<0?P=O+1:C=O}return P},right:function(b,k,P,C){for(P==null&&(P=0),C==null&&(C=b.length);P<C;){var O=P+C>>>1;S(b[O],k)>0?C=O:P=O+1}return P}}}function S_(S){return function(b,k){return Vg(S(b),k)}}k_(Vg);function qg(S){for(var b=S.length,k,P=-1,C=0,O,R;++P<b;)C+=S[P].length;for(O=new Array(C);--b>=0;)for(R=S[b],k=R.length;--k>=0;)O[--C]=R[k];return O}var Df=1e9,Ud=-Df;function E_(S,b,k,P){function C(ne,ee){return S<=ne&&ne<=k&&b<=ee&&ee<=P}function O(ne,ee,B,q){var ue=0,ce=0;if(ne==null||(ue=R(ne,B))!==(ce=R(ee,B))||K(ne,ee)<0^B>0)do q.point(ue===0||ue===3?S:k,ue>1?P:b);while((ue=(ue+B+4)%4)!==ce);else q.point(ee[0],ee[1])}function R(ne,ee){return fs(ne[0]-S)<Hi?ee>0?0:3:fs(ne[0]-k)<Hi?ee>0?2:1:fs(ne[1]-b)<Hi?ee>0?1:0:ee>0?3:2}function h(ne,ee){return K(ne.x,ee.x)}function K(ne,ee){var B=R(ne,1),q=R(ee,1);return B!==q?B-q:B===0?ee[1]-ne[1]:B===1?ne[0]-ee[0]:B===2?ne[1]-ee[1]:ee[0]-ne[0]}return function(ne){var ee=ne,B=jg(),q,ue,ce,de,Pe,je,Te,qe,tt,nt,it,Ge={point:ht,lineStart:Ht,lineEnd:Vt,polygonStart:Kt,polygonEnd:St};function ht(en,fn){C(en,fn)&&ee.point(en,fn)}function mt(){for(var en=0,fn=0,rn=ue.length;fn<rn;++fn)for(var wt=ue[fn],Ft=1,et=wt.length,Le=wt[0],rt,an,Pt=Le[0],yn=Le[1];Ft<et;++Ft)rt=Pt,an=yn,Le=wt[Ft],Pt=Le[0],yn=Le[1],an<=P?yn>P&&(Pt-rt)*(P-an)>(yn-an)*(S-rt)&&++en:yn<=P&&(Pt-rt)*(P-an)<(yn-an)*(S-rt)&&--en;return en}function Kt(){ee=B,q=[],ue=[],it=!0}function St(){var en=mt(),fn=it&&en,rn=(q=qg(q)).length;(fn||rn)&&(ne.polygonStart(),fn&&(ne.lineStart(),O(null,null,1,ne),ne.lineEnd()),rn&&Ug(q,h,en,O,ne),ne.polygonEnd()),ee=ne,q=ue=ce=null}function Ht(){Ge.point=ct,ue&&ue.push(ce=[]),nt=!0,tt=!1,Te=qe=NaN}function Vt(){q&&(ct(de,Pe),je&&tt&&B.rejoin(),q.push(B.result())),Ge.point=ht,tt&&ee.lineEnd()}function ct(en,fn){var rn=C(en,fn);if(ue&&ce.push([en,fn]),nt)de=en,Pe=fn,je=rn,nt=!1,rn&&(ee.lineStart(),ee.point(en,fn));else if(rn&&tt)ee.point(en,fn);else{var wt=[Te=Math.max(Ud,Math.min(Df,Te)),qe=Math.max(Ud,Math.min(Df,qe))],Ft=[en=Math.max(Ud,Math.min(Df,en)),fn=Math.max(Ud,Math.min(Df,fn))];b_(wt,Ft,S,b,k,P)?(tt||(ee.lineStart(),ee.point(wt[0],wt[1])),ee.point(Ft[0],Ft[1]),rn||ee.lineEnd(),it=!1):rn&&(ee.lineStart(),ee.point(en,fn),it=!1)}Te=en,qe=fn,tt=rn}return Ge}}var jp=cc();function I_(S,b){var k=b[0],P=b[1],C=[dr(k),-fr(k),0],O=0,R=0;jp.reset();for(var h=0,K=S.length;h<K;++h)if(ee=(ne=S[h]).length)for(var ne,ee,B=ne[ee-1],q=B[0],ue=B[1]/2+Km,ce=dr(ue),de=fr(ue),Pe=0;Pe<ee;++Pe,q=Te,ce=tt,de=nt,B=je){var je=ne[Pe],Te=je[0],qe=je[1]/2+Km,tt=dr(qe),nt=fr(qe),it=Te-q,Ge=it>=0?1:-1,ht=Ge*it,mt=ht>di,Kt=ce*tt;if(jp.add(Zh(Kt*Ge*dr(ht),de*nt+Kt*fr(ht))),O+=mt?it+Ge*su:it,mt^q>=k^Te>=k){var St=Wd(Hh(B),Hh(je));Wp(St);var Ht=Wd(C,St);Wp(Ht);var Vt=(mt^it>=0?-1:1)*nh(Ht[2]);(P>Vt||P===Vt&&(St[0]||St[1]))&&(R+=mt^it>=0?1:-1)}}return(O<-Hi||O<Hi&&jp<-Hi)^R&1}cc();function ag(S){return S}cc();cc();var Xh=1/0,Yd=Xh,Ff=-Xh,Kd=Ff,og={point:T_,lineStart:Nf,lineEnd:Nf,polygonStart:Nf,polygonEnd:Nf,result:function(){var S=[[Xh,Yd],[Ff,Kd]];return Ff=Kd=-(Yd=Xh=1/0),S}};function T_(S,b){S<Xh&&(Xh=S),S>Ff&&(Ff=S),b<Yd&&(Yd=b),b>Kd&&(Kd=b)}cc();function Gg(S,b,k,P){return function(C,O){var R=b(O),h=C.invert(P[0],P[1]),K=jg(),ne=b(K),ee=!1,B,q,ue,ce={point:de,lineStart:je,lineEnd:Te,polygonStart:function(){ce.point=qe,ce.lineStart=tt,ce.lineEnd=nt,q=[],B=[]},polygonEnd:function(){ce.point=de,ce.lineStart=je,ce.lineEnd=Te,q=qg(q);var it=I_(B,h);q.length?(ee||(O.polygonStart(),ee=!0),Ug(q,P_,it,k,O)):it&&(ee||(O.polygonStart(),ee=!0),O.lineStart(),k(null,null,1,O),O.lineEnd()),ee&&(O.polygonEnd(),ee=!1),q=B=null},sphere:function(){O.polygonStart(),O.lineStart(),k(null,null,1,O),O.lineEnd(),O.polygonEnd()}};function de(it,Ge){var ht=C(it,Ge);S(it=ht[0],Ge=ht[1])&&O.point(it,Ge)}function Pe(it,Ge){var ht=C(it,Ge);R.point(ht[0],ht[1])}function je(){ce.point=Pe,R.lineStart()}function Te(){ce.point=de,R.lineEnd()}function qe(it,Ge){ue.push([it,Ge]);var ht=C(it,Ge);ne.point(ht[0],ht[1])}function tt(){ne.lineStart(),ue=[]}function nt(){qe(ue[0][0],ue[0][1]),ne.lineEnd();var it=ne.clean(),Ge=K.result(),ht,mt=Ge.length,Kt,St,Ht;if(ue.pop(),B.push(ue),ue=null,!!mt){if(it&1){if(St=Ge[0],(Kt=St.length-1)>0){for(ee||(O.polygonStart(),ee=!0),O.lineStart(),ht=0;ht<Kt;++ht)O.point((Ht=St[ht])[0],Ht[1]);O.lineEnd()}return}mt>1&&it&2&&Ge.push(Ge.pop().concat(Ge.shift())),q.push(Ge.filter(C_))}}return ce}}function C_(S){return S.length>1}function P_(S,b){return((S=S.x)[0]<0?S[1]-ru-Hi:ru-S[1])-((b=b.x)[0]<0?b[1]-ru-Hi:ru-b[1])}const lg=Gg(function(){return!0},M_,L_,[-di,-ru]);function M_(S){var b=NaN,k=NaN,P=NaN,C;return{lineStart:function(){S.lineStart(),C=1},point:function(O,R){var h=O>0?di:-di,K=fs(O-b);fs(K-di)<Hi?(S.point(b,k=(k+R)/2>0?ru:-ru),S.point(P,k),S.lineEnd(),S.lineStart(),S.point(h,k),S.point(O,k),C=0):P!==h&&K>=di&&(fs(b-P)<Hi&&(b-=P*Hi),fs(O-h)<Hi&&(O-=h*Hi),k=A_(b,k,O,R),S.point(P,k),S.lineEnd(),S.lineStart(),S.point(h,k),C=0),S.point(b=O,k=R),P=h},lineEnd:function(){S.lineEnd(),b=k=NaN},clean:function(){return 2-C}}}function A_(S,b,k,P){var C,O,R=dr(S-k);return fs(R)>Hi?__((dr(b)*(O=fr(P))*dr(k)-dr(P)*(C=fr(b))*dr(S))/(C*O*R)):(b+P)/2}function L_(S,b,k,P){var C;if(S==null)C=k*ru,P.point(-di,C),P.point(0,C),P.point(di,C),P.point(di,0),P.point(di,-C),P.point(0,-C),P.point(-di,-C),P.point(-di,0),P.point(-di,C);else if(fs(S[0]-b[0])>Hi){var O=S[0]<b[0]?di:-di;C=k*O/2,P.point(-O,C),P.point(0,C),P.point(O,C)}else P.point(b[0],b[1])}function R_(S,b){var k=fr(S),P=k>0,C=fs(k)>Hi;function O(ee,B,q,ue){w_(ue,S,b,q,ee,B)}function R(ee,B){return fr(ee)*fr(B)>k}function h(ee){var B,q,ue,ce,de;return{lineStart:function(){ce=ue=!1,de=1},point:function(Pe,je){var Te=[Pe,je],qe,tt=R(Pe,je),nt=P?tt?0:ne(Pe,je):tt?ne(Pe+(Pe<0?di:-di),je):0;if(!B&&(ce=ue=tt)&&ee.lineStart(),tt!==ue&&(qe=K(B,Te),(!qe||qd(B,qe)||qd(Te,qe))&&(Te[0]+=Hi,Te[1]+=Hi,tt=R(Te[0],Te[1]))),tt!==ue)de=0,tt?(ee.lineStart(),qe=K(Te,B),ee.point(qe[0],qe[1])):(qe=K(B,Te),ee.point(qe[0],qe[1]),ee.lineEnd()),B=qe;else if(C&&B&&P^tt){var it;!(nt&q)&&(it=K(Te,B,!0))&&(de=0,P?(ee.lineStart(),ee.point(it[0][0],it[0][1]),ee.point(it[1][0],it[1][1]),ee.lineEnd()):(ee.point(it[1][0],it[1][1]),ee.lineEnd(),ee.lineStart(),ee.point(it[0][0],it[0][1])))}tt&&(!B||!qd(B,Te))&&ee.point(Te[0],Te[1]),B=Te,ue=tt,q=nt},lineEnd:function(){ue&&ee.lineEnd(),B=null},clean:function(){return de|(ce&&ue)<<1}}}function K(ee,B,q){var ue=Hh(ee),ce=Hh(B),de=[1,0,0],Pe=Wd(ue,ce),je=Fd(Pe,Pe),Te=Pe[0],qe=je-Te*Te;if(!qe)return!q&&ee;var tt=k*je/qe,nt=-k*Te/qe,it=Wd(de,Pe),Ge=Bd(de,tt),ht=Bd(Pe,nt);Bp(Ge,ht);var mt=it,Kt=Fd(Ge,mt),St=Fd(mt,mt),Ht=Kt*Kt-St*(Fd(Ge,Ge)-1);if(!(Ht<0)){var Vt=Yh(Ht),ct=Bd(mt,(-Kt-Vt)/St);if(Bp(ct,Ge),ct=Xp(ct),!q)return ct;var en=ee[0],fn=B[0],rn=ee[1],wt=B[1],Ft;fn<en&&(Ft=en,en=fn,fn=Ft);var et=fn-en,Le=fs(et-di)<Hi,rt=Le||et<Hi;if(!Le&&wt<rn&&(Ft=rn,rn=wt,wt=Ft),rt?Le?rn+wt>0^ct[1]<(fs(ct[0]-en)<Hi?rn:wt):rn<=ct[1]&&ct[1]<=wt:et>di^(en<=ct[0]&&ct[0]<=fn)){var an=Bd(mt,(-Kt+Vt)/St);return Bp(an,Ge),[ct,Xp(an)]}}}function ne(ee,B){var q=P?S:di-S,ue=0;return ee<-q?ue|=1:ee>q&&(ue|=2),B<-q?ue|=4:B>q&&(ue|=8),ue}return Gg(R,h,O,P?[0,-S]:[-di,S-di])}function $g(S){return function(b){var k=new Kp;for(var P in S)k[P]=S[P];return k.stream=b,k}}function Kp(){}Kp.prototype={constructor:Kp,point:function(S,b){this.stream.point(S,b)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Zg(S,b,k){var P=b[1][0]-b[0][0],C=b[1][1]-b[0][1],O=S.clipExtent&&S.clipExtent();S.scale(150).translate([0,0]),O!=null&&S.clipExtent(null),v_(k,S.stream(og));var R=og.result(),h=Math.min(P/(R[1][0]-R[0][0]),C/(R[1][1]-R[0][1])),K=+b[0][0]+(P-h*(R[1][0]+R[0][0]))/2,ne=+b[0][1]+(C-h*(R[1][1]+R[0][1]))/2;return O!=null&&S.clipExtent(O),S.scale(h*150).translate([K,ne])}function N_(S,b,k){return Zg(S,[[0,0],b],k)}var ug=16,D_=fr(30*Zo);function cg(S,b){return+b?O_(S,b):z_(S)}function z_(S){return $g({point:function(b,k){b=S(b,k),this.stream.point(b[0],b[1])}})}function O_(S,b){function k(P,C,O,R,h,K,ne,ee,B,q,ue,ce,de,Pe){var je=ne-P,Te=ee-C,qe=je*je+Te*Te;if(qe>4*b&&de--){var tt=R+q,nt=h+ue,it=K+ce,Ge=Yh(tt*tt+nt*nt+it*it),ht=nh(it/=Ge),mt=fs(fs(it)-1)<Hi||fs(O-B)<Hi?(O+B)/2:Zh(nt,tt),Kt=S(mt,ht),St=Kt[0],Ht=Kt[1],Vt=St-P,ct=Ht-C,en=Te*Vt-je*ct;(en*en/qe>b||fs((je*Vt+Te*ct)/qe-.5)>.3||R*q+h*ue+K*ce<D_)&&(k(P,C,O,R,h,K,St,Ht,mt,tt/=Ge,nt/=Ge,it,de,Pe),Pe.point(St,Ht),k(St,Ht,mt,tt,nt,it,ne,ee,B,q,ue,ce,de,Pe))}}return function(P){var C,O,R,h,K,ne,ee,B,q,ue,ce,de,Pe={point:je,lineStart:Te,lineEnd:tt,polygonStart:function(){P.polygonStart(),Pe.lineStart=nt},polygonEnd:function(){P.polygonEnd(),Pe.lineStart=Te}};function je(ht,mt){ht=S(ht,mt),P.point(ht[0],ht[1])}function Te(){B=NaN,Pe.point=qe,P.lineStart()}function qe(ht,mt){var Kt=Hh([ht,mt]),St=S(ht,mt);k(B,q,ee,ue,ce,de,B=St[0],q=St[1],ee=ht,ue=Kt[0],ce=Kt[1],de=Kt[2],ug,P),P.point(B,q)}function tt(){Pe.point=je,P.lineEnd()}function nt(){Te(),Pe.point=it,Pe.lineEnd=Ge}function it(ht,mt){qe(C=ht,mt),O=B,R=q,h=ue,K=ce,ne=de,Pe.point=qe}function Ge(){k(B,q,ee,ue,ce,de,O,R,C,h,K,ne,ug,P),Pe.lineEnd=tt,tt()}return Pe}}var F_=$g({point:function(S,b){this.stream.point(S*Zo,b*Zo)}});function B_(S){return j_(function(){return S})()}function j_(S){var b,k=150,P=480,C=250,O,R,h=0,K=0,ne=0,ee=0,B=0,q,ue,ce=null,de=lg,Pe=null,je,Te,qe,tt=ag,nt=.5,it=cg(St,nt),Ge,ht;function mt(ct){return ct=ue(ct[0]*Zo,ct[1]*Zo),[ct[0]*k+O,R-ct[1]*k]}function Kt(ct){return ct=ue.invert((ct[0]-O)/k,(R-ct[1])/k),ct&&[ct[0]*rc,ct[1]*rc]}function St(ct,en){return ct=b(ct,en),[ct[0]*k+O,R-ct[1]*k]}mt.stream=function(ct){return Ge&&ht===ct?Ge:Ge=F_(de(q,it(tt(ht=ct))))},mt.clipAngle=function(ct){return arguments.length?(de=+ct?R_(ce=ct*Zo,6*Zo):(ce=null,lg),Vt()):ce*rc},mt.clipExtent=function(ct){return arguments.length?(tt=ct==null?(Pe=je=Te=qe=null,ag):E_(Pe=+ct[0][0],je=+ct[0][1],Te=+ct[1][0],qe=+ct[1][1]),Vt()):Pe==null?null:[[Pe,je],[Te,qe]]},mt.scale=function(ct){return arguments.length?(k=+ct,Ht()):k},mt.translate=function(ct){return arguments.length?(P=+ct[0],C=+ct[1],Ht()):[P,C]},mt.center=function(ct){return arguments.length?(h=ct[0]%360*Zo,K=ct[1]%360*Zo,Ht()):[h*rc,K*rc]},mt.rotate=function(ct){return arguments.length?(ne=ct[0]%360*Zo,ee=ct[1]%360*Zo,B=ct.length>2?ct[2]%360*Zo:0,Ht()):[ne*rc,ee*rc,B*rc]},mt.precision=function(ct){return arguments.length?(it=cg(St,nt=ct*ct),Vt()):Yh(nt)},mt.fitExtent=function(ct,en){return Zg(mt,ct,en)},mt.fitSize=function(ct,en){return N_(mt,ct,en)};function Ht(){ue=Bg(q=x_(ne,ee,B),b);var ct=b(h,K);return O=P-ct[0]*k,R=C+ct[1]*k,Vt()}function Vt(){return Ge=ht=null,mt}return function(){return b=S.apply(this,arguments),mt.invert=b.invert&&Kt,Ht()}}function Hg(S){return function(b,k){var P=fr(b),C=fr(k),O=S(P*C);return[O*C*dr(b),O*dr(k)]}}function Xg(S){return function(b,k){var P=Yh(b*b+k*k),C=S(P),O=dr(C),R=fr(C);return[Zh(b*O,P*R),nh(P&&k*O/P)]}}var U_=Hg(function(S){return Yh(2/(1+S))});U_.invert=Xg(function(S){return 2*nh(S/2)});var Wg=Hg(function(S){return(S=Fg(S))&&S/dr(S)});Wg.invert=Xg(function(S){return S});function V_(){return B_(Wg).scale(79.4188).clipAngle(180-.001)}function hg(S,b){return[S,b]}hg.invert=hg;var{BufferOp:q_,GeoJSONReader:G_,GeoJSONWriter:$_}=y_;function Z_(S,b,k){k=k||{};var P=k.units||"kilometers",C=k.steps||8;if(!S)throw new Error("geojson is required");if(typeof k!="object")throw new Error("options must be an object");if(typeof C!="number")throw new Error("steps must be an number");if(b===void 0)throw new Error("radius is required");if(C<=0)throw new Error("steps must be greater than 0");var O=[];switch(S.type){case"GeometryCollection":return zg(S,function(R){var h=Gd(R,b,P,C);h&&O.push(h)}),Of(O);case"FeatureCollection":return $m(S,function(R){var h=Gd(R,b,P,C);h&&$m(h,function(K){K&&O.push(K)})}),Of(O)}return Gd(S,b,P,C)}function Gd(S,b,k,P){var C=S.properties||{},O=S.type==="Feature"?S.geometry:S;if(O.type==="GeometryCollection"){var R=[];return zg(S,function(de){var Pe=Gd(de,b,k,P);Pe&&R.push(Pe)}),Of(R)}var h=H_(O),K={type:O.type,coordinates:Kg(O.coordinates,h)},ne=new G_,ee=ne.read(K),B=Qy(Rg(b,k),"meters"),q=q_.bufferOp(ee,B,P),ue=new $_;if(q=ue.write(q),!Yg(q.coordinates)){var ce={type:q.type,coordinates:Jg(q.coordinates,h)};return sm(ce,C)}}function Yg(S){return Array.isArray(S[0])?Yg(S[0]):isNaN(S[0])}function Kg(S,b){return typeof S[0]!="object"?b(S):S.map(function(k){return Kg(k,b)})}function Jg(S,b){return typeof S[0]!="object"?b.invert(S):S.map(function(k){return Jg(k,b)})}function H_(S){var b=d_(S).geometry.coordinates,k=[-b[0],-b[1]];return V_().rotate(k).scale($a)}function X_(S,b,k={}){const P=k.steps||64,C=k.properties?k.properties:!Array.isArray(S)&&S.type==="Feature"&&S.properties?S.properties:{},O=[];for(let R=0;R<P;R++)O.push(i_(S,b,R*-360/P,k).geometry.coordinates);return O.push(O[0]),am([O],C)}function Qg(S){const b={};return S&&Object.keys(S).forEach(k=>{const P=S[k];typeof P=="object"?P===null?b[k]=null:Array.isArray(P)?b[k]=P.map(C=>C):b[k]=Qg(P):b[k]=P}),b}function fg(S){return function(){return S}}function W_(S){return S[0]}function Y_(S){return S[1]}function Jd(){this._=null}function ip(S){S.U=S.C=S.L=S.R=S.P=S.N=null}Jd.prototype={constructor:Jd,insert:function(S,b){var k,P,C;if(S){if(b.P=S,b.N=S.N,S.N&&(S.N.P=b),S.N=b,S.R){for(S=S.R;S.L;)S=S.L;S.L=b}else S.R=b;k=S}else this._?(S=dg(this._),b.P=null,b.N=S,S.P=S.L=b,k=S):(b.P=b.N=null,this._=b,k=null);for(b.L=b.R=null,b.U=k,b.C=!0,S=b;k&&k.C;)P=k.U,k===P.L?(C=P.R,C&&C.C?(k.C=C.C=!1,P.C=!0,S=P):(S===k.R&&(Pf(this,k),S=k,k=S.U),k.C=!1,P.C=!0,Mf(this,P))):(C=P.L,C&&C.C?(k.C=C.C=!1,P.C=!0,S=P):(S===k.L&&(Mf(this,k),S=k,k=S.U),k.C=!1,P.C=!0,Pf(this,P))),k=S.U;this._.C=!1},remove:function(S){S.N&&(S.N.P=S.P),S.P&&(S.P.N=S.N),S.N=S.P=null;var b=S.U,k,P=S.L,C=S.R,O,R;if(P?C?O=dg(C):O=P:O=C,b?b.L===S?b.L=O:b.R=O:this._=O,P&&C?(R=O.C,O.C=S.C,O.L=P,P.U=O,O!==C?(b=O.U,O.U=S.U,S=O.R,b.L=S,O.R=C,C.U=O):(O.U=b,b=O,S=O.R)):(R=S.C,S=O),S&&(S.U=b),!R){if(S&&S.C){S.C=!1;return}do{if(S===this._)break;if(S===b.L){if(k=b.R,k.C&&(k.C=!1,b.C=!0,Pf(this,b),k=b.R),k.L&&k.L.C||k.R&&k.R.C){(!k.R||!k.R.C)&&(k.L.C=!1,k.C=!0,Mf(this,k),k=b.R),k.C=b.C,b.C=k.R.C=!1,Pf(this,b),S=this._;break}}else if(k=b.L,k.C&&(k.C=!1,b.C=!0,Mf(this,b),k=b.L),k.L&&k.L.C||k.R&&k.R.C){(!k.L||!k.L.C)&&(k.R.C=!1,k.C=!0,Pf(this,k),k=b.L),k.C=b.C,b.C=k.L.C=!1,Mf(this,b),S=this._;break}k.C=!0,S=b,b=b.U}while(!S.C);S&&(S.C=!1)}}};function Pf(S,b){var k=b,P=b.R,C=k.U;C?C.L===k?C.L=P:C.R=P:S._=P,P.U=C,k.U=P,k.R=P.L,k.R&&(k.R.U=k),P.L=k}function Mf(S,b){var k=b,P=b.L,C=k.U;C?C.L===k?C.L=P:C.R=P:S._=P,P.U=C,k.U=P,k.L=P.R,k.L&&(k.L.U=k),P.R=k}function dg(S){for(;S.L;)S=S.L;return S}function zf(S,b,k,P){var C=[null,null],O=ra.push(C)-1;return C.left=S,C.right=b,k&&Qd(C,S,b,k),P&&Qd(C,b,S,P),Io[S.index].halfedges.push(O),Io[b.index].halfedges.push(O),C}function Af(S,b,k){var P=[b,k];return P.left=S,P}function Qd(S,b,k,P){!S[0]&&!S[1]?(S[0]=P,S.left=b,S.right=k):S.left===k?S[1]=P:S[0]=P}function K_(S,b,k,P,C){var O=S[0],R=S[1],h=O[0],K=O[1],ne=R[0],ee=R[1],B=0,q=1,ue=ne-h,ce=ee-K,de;if(de=b-h,!(!ue&&de>0)){if(de/=ue,ue<0){if(de<B)return;de<q&&(q=de)}else if(ue>0){if(de>q)return;de>B&&(B=de)}if(de=P-h,!(!ue&&de<0)){if(de/=ue,ue<0){if(de>q)return;de>B&&(B=de)}else if(ue>0){if(de<B)return;de<q&&(q=de)}if(de=k-K,!(!ce&&de>0)){if(de/=ce,ce<0){if(de<B)return;de<q&&(q=de)}else if(ce>0){if(de>q)return;de>B&&(B=de)}if(de=C-K,!(!ce&&de<0)){if(de/=ce,ce<0){if(de>q)return;de>B&&(B=de)}else if(ce>0){if(de<B)return;de<q&&(q=de)}return!(B>0)&&!(q<1)||(B>0&&(S[0]=[h+B*ue,K+B*ce]),q<1&&(S[1]=[h+q*ue,K+q*ce])),!0}}}}}function J_(S,b,k,P,C){var O=S[1];if(O)return!0;var R=S[0],h=S.left,K=S.right,ne=h[0],ee=h[1],B=K[0],q=K[1],ue=(ne+B)/2,ce=(ee+q)/2,de,Pe;if(q===ee){if(ue<b||ue>=P)return;if(ne>B){if(!R)R=[ue,k];else if(R[1]>=C)return;O=[ue,C]}else{if(!R)R=[ue,C];else if(R[1]<k)return;O=[ue,k]}}else if(de=(ne-B)/(q-ee),Pe=ce-de*ue,de<-1||de>1)if(ne>B){if(!R)R=[(k-Pe)/de,k];else if(R[1]>=C)return;O=[(C-Pe)/de,C]}else{if(!R)R=[(C-Pe)/de,C];else if(R[1]<k)return;O=[(k-Pe)/de,k]}else if(ee<q){if(!R)R=[b,de*b+Pe];else if(R[0]>=P)return;O=[P,de*P+Pe]}else{if(!R)R=[P,de*P+Pe];else if(R[0]<b)return;O=[b,de*b+Pe]}return S[0]=R,S[1]=O,!0}function Q_(S,b,k,P){for(var C=ra.length,O;C--;)(!J_(O=ra[C],S,b,k,P)||!K_(O,S,b,k,P)||!(Math.abs(O[0][0]-O[1][0])>Oi||Math.abs(O[0][1]-O[1][1])>Oi))&&delete ra[C]}function ev(S){return Io[S.index]={site:S,halfedges:[]}}function tv(S,b){var k=S.site,P=b.left,C=b.right;return k===C&&(C=P,P=k),C?Math.atan2(C[1]-P[1],C[0]-P[0]):(k===P?(P=b[1],C=b[0]):(P=b[0],C=b[1]),Math.atan2(P[0]-C[0],C[1]-P[1]))}function ey(S,b){return b[+(b.left!==S.site)]}function nv(S,b){return b[+(b.left===S.site)]}function iv(){for(var S=0,b=Io.length,k,P,C,O;S<b;++S)if((k=Io[S])&&(O=(P=k.halfedges).length)){var R=new Array(O),h=new Array(O);for(C=0;C<O;++C)R[C]=C,h[C]=tv(k,ra[P[C]]);for(R.sort(function(K,ne){return h[ne]-h[K]}),C=0;C<O;++C)h[C]=P[R[C]];for(C=0;C<O;++C)P[C]=h[C]}}function rv(S,b,k,P){var C=Io.length,O,R,h,K,ne,ee,B,q,ue,ce,de,Pe,je=!0;for(O=0;O<C;++O)if(R=Io[O]){for(h=R.site,ne=R.halfedges,K=ne.length;K--;)ra[ne[K]]||ne.splice(K,1);for(K=0,ee=ne.length;K<ee;)ce=nv(R,ra[ne[K]]),de=ce[0],Pe=ce[1],B=ey(R,ra[ne[++K%ee]]),q=B[0],ue=B[1],(Math.abs(de-q)>Oi||Math.abs(Pe-ue)>Oi)&&(ne.splice(K,0,ra.push(Af(h,ce,Math.abs(de-S)<Oi&&P-Pe>Oi?[S,Math.abs(q-S)<Oi?ue:P]:Math.abs(Pe-P)<Oi&&k-de>Oi?[Math.abs(ue-P)<Oi?q:k,P]:Math.abs(de-k)<Oi&&Pe-b>Oi?[k,Math.abs(q-k)<Oi?ue:b]:Math.abs(Pe-b)<Oi&&de-S>Oi?[Math.abs(ue-b)<Oi?q:S,b]:null))-1),++ee);ee&&(je=!1)}if(je){var Te,qe,tt,nt=1/0;for(O=0,je=null;O<C;++O)(R=Io[O])&&(h=R.site,Te=h[0]-S,qe=h[1]-b,tt=Te*Te+qe*qe,tt<nt&&(nt=tt,je=R));if(je){var it=[S,b],Ge=[S,P],ht=[k,P],mt=[k,b];je.halfedges.push(ra.push(Af(h=je.site,it,Ge))-1,ra.push(Af(h,Ge,ht))-1,ra.push(Af(h,ht,mt))-1,ra.push(Af(h,mt,it))-1)}}for(O=0;O<C;++O)(R=Io[O])&&(R.halfedges.length||delete Io[O])}var ty=[],om;function sv(){ip(this),this.x=this.y=this.arc=this.site=this.cy=null}function Vh(S){var b=S.P,k=S.N;if(!(!b||!k)){var P=b.site,C=S.site,O=k.site;if(P!==O){var R=C[0],h=C[1],K=P[0]-R,ne=P[1]-h,ee=O[0]-R,B=O[1]-h,q=2*(K*B-ne*ee);if(!(q>=-1e-12)){var ue=K*K+ne*ne,ce=ee*ee+B*B,de=(B*ue-ne*ce)/q,Pe=(K*ce-ee*ue)/q,je=ty.pop()||new sv;je.arc=S,je.site=C,je.x=de+R,je.y=(je.cy=Pe+h)+Math.sqrt(de*de+Pe*Pe),S.circle=je;for(var Te=null,qe=Bf._;qe;)if(je.y<qe.y||je.y===qe.y&&je.x<=qe.x)if(qe.L)qe=qe.L;else{Te=qe.P;break}else if(qe.R)qe=qe.R;else{Te=qe;break}Bf.insert(Te,je),Te||(om=je)}}}}function qh(S){var b=S.circle;b&&(b.P||(om=b.N),Bf.remove(b),ty.push(b),ip(b),S.circle=null)}var ny=[];function av(){ip(this),this.edge=this.site=this.circle=null}function pg(S){var b=ny.pop()||new av;return b.site=S,b}function Up(S){qh(S),Gh.remove(S),ny.push(S),ip(S)}function ov(S){var b=S.circle,k=b.x,P=b.cy,C=[k,P],O=S.P,R=S.N,h=[S];Up(S);for(var K=O;K.circle&&Math.abs(k-K.circle.x)<Oi&&Math.abs(P-K.circle.cy)<Oi;)O=K.P,h.unshift(K),Up(K),K=O;h.unshift(K),qh(K);for(var ne=R;ne.circle&&Math.abs(k-ne.circle.x)<Oi&&Math.abs(P-ne.circle.cy)<Oi;)R=ne.N,h.push(ne),Up(ne),ne=R;h.push(ne),qh(ne);var ee=h.length,B;for(B=1;B<ee;++B)ne=h[B],K=h[B-1],Qd(ne.edge,K.site,ne.site,C);K=h[0],ne=h[ee-1],ne.edge=zf(K.site,ne.site,null,C),Vh(K),Vh(ne)}function lv(S){for(var b=S[0],k=S[1],P,C,O,R,h=Gh._;h;)if(O=iy(h,k)-b,O>Oi)h=h.L;else if(R=b-uv(h,k),R>Oi){if(!h.R){P=h;break}h=h.R}else{O>-Oi?(P=h.P,C=h):R>-Oi?(P=h,C=h.N):P=C=h;break}ev(S);var K=pg(S);if(Gh.insert(P,K),!(!P&&!C)){if(P===C){qh(P),C=pg(P.site),Gh.insert(K,C),K.edge=C.edge=zf(P.site,K.site),Vh(P),Vh(C);return}if(!C){K.edge=zf(P.site,K.site);return}qh(P),qh(C);var ne=P.site,ee=ne[0],B=ne[1],q=S[0]-ee,ue=S[1]-B,ce=C.site,de=ce[0]-ee,Pe=ce[1]-B,je=2*(q*Pe-ue*de),Te=q*q+ue*ue,qe=de*de+Pe*Pe,tt=[(Pe*Te-ue*qe)/je+ee,(q*qe-de*Te)/je+B];Qd(C.edge,ne,ce,tt),K.edge=zf(ne,S,null,tt),C.edge=zf(S,ce,null,tt),Vh(P),Vh(C)}}function iy(S,b){var k=S.site,P=k[0],C=k[1],O=C-b;if(!O)return P;var R=S.P;if(!R)return-1/0;k=R.site;var h=k[0],K=k[1],ne=K-b;if(!ne)return h;var ee=h-P,B=1/O-1/ne,q=ee/ne;return B?(-q+Math.sqrt(q*q-2*B*(ee*ee/(-2*ne)-K+ne/2+C-O/2)))/B+P:(P+h)/2}function uv(S,b){var k=S.N;if(k)return iy(k,b);var P=S.site;return P[1]===b?P[0]:1/0}var Oi=1e-6,Gh,Io,Bf,ra;function cv(S,b,k){return(S[0]-k[0])*(b[1]-S[1])-(S[0]-b[0])*(k[1]-S[1])}function hv(S,b){return b[1]-S[1]||b[0]-S[0]}function Jp(S,b){var k=S.sort(hv).pop(),P,C,O;for(ra=[],Io=new Array(S.length),Gh=new Jd,Bf=new Jd;;)if(O=om,k&&(!O||k[1]<O.y||k[1]===O.y&&k[0]<O.x))(k[0]!==P||k[1]!==C)&&(lv(k),P=k[0],C=k[1]),k=S.pop();else if(O)ov(O.arc);else break;if(iv(),b){var R=+b[0][0],h=+b[0][1],K=+b[1][0],ne=+b[1][1];Q_(R,h,K,ne),rv(R,h,K,ne)}this.edges=ra,this.cells=Io,Gh=Bf=ra=Io=null}Jp.prototype={constructor:Jp,polygons:function(){var S=this.edges;return this.cells.map(function(b){var k=b.halfedges.map(function(P){return ey(b,S[P])});return k.data=b.site.data,k})},triangles:function(){var S=[],b=this.edges;return this.cells.forEach(function(k,P){if(h=(O=k.halfedges).length)for(var C=k.site,O,R=-1,h,K,ne=b[O[h-1]],ee=ne.left===C?ne.right:ne.left;++R<h;)K=ee,ne=b[O[R]],ee=ne.left===C?ne.right:ne.left,K&&ee&&P<K.index&&P<ee.index&&cv(C,K,ee)<0&&S.push([C.data,K.data,ee.data])}),S},links:function(){return this.edges.filter(function(S){return S.right}).map(function(S){return{source:S.left.data,target:S.right.data}})},find:function(S,b,k){for(var P=this,C,O=P._found||0,R=P.cells.length,h;!(h=P.cells[O]);)if(++O>=R)return null;var K=S-h.site[0],ne=b-h.site[1],ee=K*K+ne*ne;do h=P.cells[C=O],O=null,h.halfedges.forEach(function(B){var q=P.edges[B],ue=q.left;if(!((ue===h.site||!ue)&&!(ue=q.right))){var ce=S-ue[0],de=b-ue[1],Pe=ce*ce+de*de;Pe<ee&&(ee=Pe,O=ue.index)}});while(O!==null);return P._found=C,k==null||ee<=k*k?h.site:null}};function fv(){var S=W_,b=Y_,k=null;function P(C){return new Jp(C.map(function(O,R){var h=[Math.round(S(O,R,C)/Oi)*Oi,Math.round(b(O,R,C)/Oi)*Oi];return h.index=R,h.data=O,h}),k)}return P.polygons=function(C){return P(C).polygons()},P.links=function(C){return P(C).links()},P.triangles=function(C){return P(C).triangles()},P.x=function(C){return arguments.length?(S=typeof C=="function"?C:fg(+C),P):S},P.y=function(C){return arguments.length?(b=typeof C=="function"?C:fg(+C),P):b},P.extent=function(C){return arguments.length?(k=C==null?null:[[+C[0][0],+C[0][1]],[+C[1][0],+C[1][1]]],P):k&&[[k[0][0],k[0][1]],[k[1][0],k[1][1]]]},P.size=function(C){return arguments.length?(k=C==null?null:[[0,0],[+C[0],+C[1]]],P):k&&[k[1][0]-k[0][0],k[1][1]-k[0][1]]},P}function dv(S){return S=S.slice(),S.push(S[0]),am([S])}function pv(S,b){if(b=b||{},!e_(b))throw new Error("options is invalid");const k=b.bbox||[-180,-85,180,85];if(!S)throw new Error("points is required");if(!Array.isArray(k))throw new Error("bbox is invalid");return t_(S,"Point","points"),Of(fv().x(P=>P.geometry.coordinates[0]).y(P=>P.geometry.coordinates[1]).extent([[k[0],k[1]],[k[2],k[3]]]).polygons(S.features).map(function(P,C){return Object.assign(dv(P),{properties:Qg(S.features[C].properties)})}))}const mv={features:[{type:"Feature",properties:{name:"United Kingdom",iso_a2:"GB"},geometry:{type:"MultiPolygon",coordinates:[[[[-7.57,49.96],[-6,50],[-5.2,50.2],[-4.4,50.3],[-3.4,50.6],[-2,50.8],[-1.1,50.9],[.4,51],[1.6,52],[1.8,53],[1.4,54.2],[.2,55.1],[-1.3,55.8],[-3.2,56.4],[-4.6,57.4],[-5.5,58.2],[-6,58.6],[-6.8,58.2],[-7.2,57],[-7,55],[-7.5,53],[-7,51.5],[-7.57,49.96]]]]}},{type:"Feature",properties:{name:"United States",iso_a2:"US"},geometry:{type:"Polygon",coordinates:[[[-124.8,24.4],[-66.9,24.4],[-66.9,49.4],[-124.8,49.4],[-124.8,24.4]]]}}]};class uc{constructor(b,k){this.next=null,this.key=b,this.data=k,this.left=null,this.right=null}}function gv(S,b){return S>b?1:S<b?-1:0}function sc(S,b,k){const P=new uc(null,null);let C=P,O=P;for(;;){const R=k(S,b.key);if(R<0){if(b.left===null)break;if(k(S,b.left.key)<0){const h=b.left;if(b.left=h.right,h.right=b,b=h,b.left===null)break}O.left=b,O=b,b=b.left}else if(R>0){if(b.right===null)break;if(k(S,b.right.key)>0){const h=b.right;if(b.right=h.left,h.left=b,b=h,b.right===null)break}C.right=b,C=b,b=b.right}else break}return C.right=b.left,O.left=b.right,b.left=P.right,b.right=P.left,b}function Vp(S,b,k,P){const C=new uc(S,b);if(k===null)return C.left=C.right=null,C;k=sc(S,k,P);const O=P(S,k.key);return O<0?(C.left=k.left,C.right=k,k.left=null):O>=0&&(C.right=k.right,C.left=k,k.right=null),C}function mg(S,b,k){let P=null,C=null;if(b){b=sc(S,b,k);const O=k(b.key,S);O===0?(P=b.left,C=b.right):O<0?(C=b.right,b.right=null,P=b):(P=b.left,b.left=null,C=b)}return{left:P,right:C}}function yv(S,b,k){return b===null?S:(S===null||(b=sc(S.key,b,k),b.left=S),b)}function Qp(S,b,k,P,C){if(S){P(`${b}${k?" ":" "}${C(S)}
`);const O=b+(k?"    ":"   ");S.left&&Qp(S.left,O,!1,P,C),S.right&&Qp(S.right,O,!0,P,C)}}class lm{constructor(b=gv){this._root=null,this._size=0,this._comparator=b}insert(b,k){return this._size++,this._root=Vp(b,k,this._root,this._comparator)}add(b,k){const P=new uc(b,k);this._root===null&&(P.left=P.right=null,this._size++,this._root=P);const C=this._comparator,O=sc(b,this._root,C),R=C(b,O.key);return R===0?this._root=O:(R<0?(P.left=O.left,P.right=O,O.left=null):R>0&&(P.right=O.right,P.left=O,O.right=null),this._size++,this._root=P),this._root}remove(b){this._root=this._remove(b,this._root,this._comparator)}_remove(b,k,P){let C;return k===null?null:(k=sc(b,k,P),P(b,k.key)===0?(k.left===null?C=k.right:(C=sc(b,k.left,P),C.right=k.right),this._size--,C):k)}pop(){let b=this._root;if(b){for(;b.left;)b=b.left;return this._root=sc(b.key,this._root,this._comparator),this._root=this._remove(b.key,this._root,this._comparator),{key:b.key,data:b.data}}return null}findStatic(b){let k=this._root;const P=this._comparator;for(;k;){const C=P(b,k.key);if(C===0)return k;C<0?k=k.left:k=k.right}return null}find(b){return this._root&&(this._root=sc(b,this._root,this._comparator),this._comparator(b,this._root.key)!==0)?null:this._root}contains(b){let k=this._root;const P=this._comparator;for(;k;){const C=P(b,k.key);if(C===0)return!0;C<0?k=k.left:k=k.right}return!1}forEach(b,k){let P=this._root;const C=[];let O=!1;for(;!O;)P!==null?(C.push(P),P=P.left):C.length!==0?(P=C.pop(),b.call(k,P),P=P.right):O=!0;return this}range(b,k,P,C){const O=[],R=this._comparator;let h=this._root,K;for(;O.length!==0||h;)if(h)O.push(h),h=h.left;else{if(h=O.pop(),K=R(h.key,k),K>0)break;if(R(h.key,b)>=0&&P.call(C,h))return this;h=h.right}return this}keys(){const b=[];return this.forEach(({key:k})=>{b.push(k)}),b}values(){const b=[];return this.forEach(({data:k})=>{b.push(k)}),b}min(){return this._root?this.minNode(this._root).key:null}max(){return this._root?this.maxNode(this._root).key:null}minNode(b=this._root){if(b)for(;b.left;)b=b.left;return b}maxNode(b=this._root){if(b)for(;b.right;)b=b.right;return b}at(b){let k=this._root,P=!1,C=0;const O=[];for(;!P;)if(k)O.push(k),k=k.left;else if(O.length>0){if(k=O.pop(),C===b)return k;C++,k=k.right}else P=!0;return null}next(b){let k=this._root,P=null;if(b.right){for(P=b.right;P.left;)P=P.left;return P}const C=this._comparator;for(;k;){const O=C(b.key,k.key);if(O===0)break;O<0?(P=k,k=k.left):k=k.right}return P}prev(b){let k=this._root,P=null;if(b.left!==null){for(P=b.left;P.right;)P=P.right;return P}const C=this._comparator;for(;k;){const O=C(b.key,k.key);if(O===0)break;O<0?k=k.left:(P=k,k=k.right)}return P}clear(){return this._root=null,this._size=0,this}toList(){return vv(this._root)}load(b,k=[],P=!1){let C=b.length;const O=this._comparator;if(P&&nm(b,k,0,C-1,O),this._root===null)this._root=em(b,k,0,C),this._size=C;else{const R=xv(this.toList(),_v(b,k),O);C=this._size+C,this._root=tm({head:R},0,C)}return this}isEmpty(){return this._root===null}get size(){return this._size}get root(){return this._root}toString(b=k=>String(k.key)){const k=[];return Qp(this._root,"",!0,P=>k.push(P),b),k.join("")}update(b,k,P){const C=this._comparator;let{left:O,right:R}=mg(b,this._root,C);C(b,k)<0?R=Vp(k,P,R,C):O=Vp(k,P,O,C),this._root=yv(O,R,C)}split(b){return mg(b,this._root,this._comparator)}*[Symbol.iterator](){let b=this._root;const k=[];let P=!1;for(;!P;)b!==null?(k.push(b),b=b.left):k.length!==0?(b=k.pop(),yield b,b=b.right):P=!0}}function em(S,b,k,P){const C=P-k;if(C>0){const O=k+Math.floor(C/2),R=S[O],h=b[O],K=new uc(R,h);return K.left=em(S,b,k,O),K.right=em(S,b,O+1,P),K}return null}function _v(S,b){const k=new uc(null,null);let P=k;for(let C=0;C<S.length;C++)P=P.next=new uc(S[C],b[C]);return P.next=null,k.next}function vv(S){let b=S;const k=[];let P=!1;const C=new uc(null,null);let O=C;for(;!P;)b?(k.push(b),b=b.left):k.length>0?(b=O=O.next=k.pop(),b=b.right):P=!0;return O.next=null,C.next}function tm(S,b,k){const P=k-b;if(P>0){const C=b+Math.floor(P/2),O=tm(S,b,C),R=S.head;return R.left=O,S.head=S.head.next,R.right=tm(S,C+1,k),R}return null}function xv(S,b,k){const P=new uc(null,null);let C=P,O=S,R=b;for(;O!==null&&R!==null;)k(O.key,R.key)<0?(C.next=O,O=O.next):(C.next=R,R=R.next),C=C.next;return O!==null?C.next=O:R!==null&&(C.next=R),P.next}function nm(S,b,k,P,C){if(k>=P)return;const O=S[k+P>>1];let R=k-1,h=P+1;for(;;){do R++;while(C(S[R],O)<0);do h--;while(C(S[h],O)>0);if(R>=h)break;let K=S[R];S[R]=S[h],S[h]=K,K=b[R],b[R]=b[h],b[h]=K}nm(S,b,k,h,C),nm(S,b,h+1,P,C)}const Au=11102230246251565e-32,ia=134217729,wv=(3+8*Au)*Au;function qp(S,b,k,P,C){let O,R,h,K,ne=b[0],ee=P[0],B=0,q=0;ee>ne==ee>-ne?(O=ne,ne=b[++B]):(O=ee,ee=P[++q]);let ue=0;if(B<S&&q<k)for(ee>ne==ee>-ne?(R=ne+O,h=O-(R-ne),ne=b[++B]):(R=ee+O,h=O-(R-ee),ee=P[++q]),O=R,h!==0&&(C[ue++]=h);B<S&&q<k;)ee>ne==ee>-ne?(R=O+ne,K=R-O,h=O-(R-K)+(ne-K),ne=b[++B]):(R=O+ee,K=R-O,h=O-(R-K)+(ee-K),ee=P[++q]),O=R,h!==0&&(C[ue++]=h);for(;B<S;)R=O+ne,K=R-O,h=O-(R-K)+(ne-K),ne=b[++B],O=R,h!==0&&(C[ue++]=h);for(;q<k;)R=O+ee,K=R-O,h=O-(R-K)+(ee-K),ee=P[++q],O=R,h!==0&&(C[ue++]=h);return(O!==0||ue===0)&&(C[ue++]=O),ue}function bv(S,b){let k=b[0];for(let P=1;P<S;P++)k+=b[P];return k}function Gf(S){return new Float64Array(S)}const kv=(3+16*Au)*Au,Sv=(2+12*Au)*Au,Ev=(9+64*Au)*Au*Au,Uh=Gf(4),gg=Gf(8),yg=Gf(12),_g=Gf(16),Ca=Gf(4);function Iv(S,b,k,P,C,O,R){let h,K,ne,ee,B,q,ue,ce,de,Pe,je,Te,qe,tt,nt,it,Ge,ht;const mt=S-C,Kt=k-C,St=b-O,Ht=P-O;tt=mt*Ht,q=ia*mt,ue=q-(q-mt),ce=mt-ue,q=ia*Ht,de=q-(q-Ht),Pe=Ht-de,nt=ce*Pe-(tt-ue*de-ce*de-ue*Pe),it=St*Kt,q=ia*St,ue=q-(q-St),ce=St-ue,q=ia*Kt,de=q-(q-Kt),Pe=Kt-de,Ge=ce*Pe-(it-ue*de-ce*de-ue*Pe),je=nt-Ge,B=nt-je,Uh[0]=nt-(je+B)+(B-Ge),Te=tt+je,B=Te-tt,qe=tt-(Te-B)+(je-B),je=qe-it,B=qe-je,Uh[1]=qe-(je+B)+(B-it),ht=Te+je,B=ht-Te,Uh[2]=Te-(ht-B)+(je-B),Uh[3]=ht;let Vt=bv(4,Uh),ct=Sv*R;if(Vt>=ct||-Vt>=ct||(B=S-mt,h=S-(mt+B)+(B-C),B=k-Kt,ne=k-(Kt+B)+(B-C),B=b-St,K=b-(St+B)+(B-O),B=P-Ht,ee=P-(Ht+B)+(B-O),h===0&&K===0&&ne===0&&ee===0)||(ct=Ev*R+wv*Math.abs(Vt),Vt+=mt*ee+Ht*h-(St*ne+Kt*K),Vt>=ct||-Vt>=ct))return Vt;tt=h*Ht,q=ia*h,ue=q-(q-h),ce=h-ue,q=ia*Ht,de=q-(q-Ht),Pe=Ht-de,nt=ce*Pe-(tt-ue*de-ce*de-ue*Pe),it=K*Kt,q=ia*K,ue=q-(q-K),ce=K-ue,q=ia*Kt,de=q-(q-Kt),Pe=Kt-de,Ge=ce*Pe-(it-ue*de-ce*de-ue*Pe),je=nt-Ge,B=nt-je,Ca[0]=nt-(je+B)+(B-Ge),Te=tt+je,B=Te-tt,qe=tt-(Te-B)+(je-B),je=qe-it,B=qe-je,Ca[1]=qe-(je+B)+(B-it),ht=Te+je,B=ht-Te,Ca[2]=Te-(ht-B)+(je-B),Ca[3]=ht;const en=qp(4,Uh,4,Ca,gg);tt=mt*ee,q=ia*mt,ue=q-(q-mt),ce=mt-ue,q=ia*ee,de=q-(q-ee),Pe=ee-de,nt=ce*Pe-(tt-ue*de-ce*de-ue*Pe),it=St*ne,q=ia*St,ue=q-(q-St),ce=St-ue,q=ia*ne,de=q-(q-ne),Pe=ne-de,Ge=ce*Pe-(it-ue*de-ce*de-ue*Pe),je=nt-Ge,B=nt-je,Ca[0]=nt-(je+B)+(B-Ge),Te=tt+je,B=Te-tt,qe=tt-(Te-B)+(je-B),je=qe-it,B=qe-je,Ca[1]=qe-(je+B)+(B-it),ht=Te+je,B=ht-Te,Ca[2]=Te-(ht-B)+(je-B),Ca[3]=ht;const fn=qp(en,gg,4,Ca,yg);tt=h*ee,q=ia*h,ue=q-(q-h),ce=h-ue,q=ia*ee,de=q-(q-ee),Pe=ee-de,nt=ce*Pe-(tt-ue*de-ce*de-ue*Pe),it=K*ne,q=ia*K,ue=q-(q-K),ce=K-ue,q=ia*ne,de=q-(q-ne),Pe=ne-de,Ge=ce*Pe-(it-ue*de-ce*de-ue*Pe),je=nt-Ge,B=nt-je,Ca[0]=nt-(je+B)+(B-Ge),Te=tt+je,B=Te-tt,qe=tt-(Te-B)+(je-B),je=qe-it,B=qe-je,Ca[1]=qe-(je+B)+(B-it),ht=Te+je,B=ht-Te,Ca[2]=Te-(ht-B)+(je-B),Ca[3]=ht;const rn=qp(fn,yg,4,Ca,_g);return _g[rn-1]}function Tv(S,b,k,P,C,O){const R=(b-O)*(k-C),h=(S-C)*(P-O),K=R-h,ne=Math.abs(R+h);return Math.abs(K)>=kv*ne?K:-Iv(S,b,k,P,C,O,ne)}var ry={};const Lf=(S,b)=>S.ll.x<=b.x&&b.x<=S.ur.x&&S.ll.y<=b.y&&b.y<=S.ur.y,im=(S,b)=>{if(b.ur.x<S.ll.x||S.ur.x<b.ll.x||b.ur.y<S.ll.y||S.ur.y<b.ll.y)return null;const k=S.ll.x<b.ll.x?b.ll.x:S.ll.x,P=S.ur.x<b.ur.x?S.ur.x:b.ur.x,C=S.ll.y<b.ll.y?b.ll.y:S.ll.y,O=S.ur.y<b.ur.y?S.ur.y:b.ur.y;return{ll:{x:k,y:C},ur:{x:P,y:O}}};let ac=Number.EPSILON;ac===void 0&&(ac=Math.pow(2,-52));const Cv=ac*ac,vg=(S,b)=>{if(-ac<S&&S<ac&&-ac<b&&b<ac)return 0;const k=S-b;return k*k<Cv*S*b?0:S<b?-1:1};class Pv{constructor(){this.reset()}reset(){this.xRounder=new xg,this.yRounder=new xg}round(b,k){return{x:this.xRounder.round(b),y:this.yRounder.round(k)}}}class xg{constructor(){this.tree=new lm,this.round(0)}round(b){const k=this.tree.add(b),P=this.tree.prev(k);if(P!==null&&vg(k.key,P.key)===0)return this.tree.remove(b),P.key;const C=this.tree.next(k);return C!==null&&vg(k.key,C.key)===0?(this.tree.remove(b),C.key):b}}const jf=new Pv,$d=(S,b)=>S.x*b.y-S.y*b.x,sy=(S,b)=>S.x*b.x+S.y*b.y,wg=(S,b,k)=>{const P=Tv(S.x,S.y,b.x,b.y,k.x,k.y);return P>0?-1:P<0?1:0},ep=S=>Math.sqrt(sy(S,S)),Mv=(S,b,k)=>{const P={x:b.x-S.x,y:b.y-S.y},C={x:k.x-S.x,y:k.y-S.y};return $d(C,P)/ep(C)/ep(P)},Av=(S,b,k)=>{const P={x:b.x-S.x,y:b.y-S.y},C={x:k.x-S.x,y:k.y-S.y};return sy(C,P)/ep(C)/ep(P)},bg=(S,b,k)=>b.y===0?null:{x:S.x+b.x/b.y*(k-S.y),y:k},kg=(S,b,k)=>b.x===0?null:{x:k,y:S.y+b.y/b.x*(k-S.x)},Lv=(S,b,k,P)=>{if(b.x===0)return kg(k,P,S.x);if(P.x===0)return kg(S,b,k.x);if(b.y===0)return bg(k,P,S.y);if(P.y===0)return bg(S,b,k.y);const C=$d(b,P);if(C==0)return null;const O={x:k.x-S.x,y:k.y-S.y},R=$d(O,b)/C,h=$d(O,P)/C,K=S.x+h*b.x,ne=k.x+R*P.x,ee=S.y+h*b.y,B=k.y+R*P.y,q=(K+ne)/2,ue=(ee+B)/2;return{x:q,y:ue}};class Ho{static compare(b,k){const P=Ho.comparePoints(b.point,k.point);return P!==0?P:(b.point!==k.point&&b.link(k),b.isLeft!==k.isLeft?b.isLeft?1:-1:lc.compare(b.segment,k.segment))}static comparePoints(b,k){return b.x<k.x?-1:b.x>k.x?1:b.y<k.y?-1:b.y>k.y?1:0}constructor(b,k){b.events===void 0?b.events=[this]:b.events.push(this),this.point=b,this.isLeft=k}link(b){if(b.point===this.point)throw new Error("Tried to link already linked events");const k=b.point.events;for(let P=0,C=k.length;P<C;P++){const O=k[P];this.point.events.push(O),O.point=this.point}this.checkForConsuming()}checkForConsuming(){const b=this.point.events.length;for(let k=0;k<b;k++){const P=this.point.events[k];if(P.segment.consumedBy===void 0)for(let C=k+1;C<b;C++){const O=this.point.events[C];O.consumedBy===void 0&&P.otherSE.point.events===O.otherSE.point.events&&P.segment.consume(O.segment)}}}getAvailableLinkedEvents(){const b=[];for(let k=0,P=this.point.events.length;k<P;k++){const C=this.point.events[k];C!==this&&!C.segment.ringOut&&C.segment.isInResult()&&b.push(C)}return b}getLeftmostComparator(b){const k=new Map,P=C=>{const O=C.otherSE;k.set(C,{sine:Mv(this.point,b.point,O.point),cosine:Av(this.point,b.point,O.point)})};return(C,O)=>{k.has(C)||P(C),k.has(O)||P(O);const{sine:R,cosine:h}=k.get(C),{sine:K,cosine:ne}=k.get(O);return R>=0&&K>=0?h<ne?1:h>ne?-1:0:R<0&&K<0?h<ne?-1:h>ne?1:0:K<R?-1:K>R?1:0}}}let Rv=0;class lc{static compare(b,k){const P=b.leftSE.point.x,C=k.leftSE.point.x,O=b.rightSE.point.x,R=k.rightSE.point.x;if(R<P)return 1;if(O<C)return-1;const h=b.leftSE.point.y,K=k.leftSE.point.y,ne=b.rightSE.point.y,ee=k.rightSE.point.y;if(P<C){if(K<h&&K<ne)return 1;if(K>h&&K>ne)return-1;const B=b.comparePoint(k.leftSE.point);if(B<0)return 1;if(B>0)return-1;const q=k.comparePoint(b.rightSE.point);return q!==0?q:-1}if(P>C){if(h<K&&h<ee)return-1;if(h>K&&h>ee)return 1;const B=k.comparePoint(b.leftSE.point);if(B!==0)return B;const q=b.comparePoint(k.rightSE.point);return q<0?1:q>0?-1:1}if(h<K)return-1;if(h>K)return 1;if(O<R){const B=k.comparePoint(b.rightSE.point);if(B!==0)return B}if(O>R){const B=b.comparePoint(k.rightSE.point);if(B<0)return 1;if(B>0)return-1}if(O!==R){const B=ne-h,q=O-P,ue=ee-K,ce=R-C;if(B>q&&ue<ce)return 1;if(B<q&&ue>ce)return-1}return O>R?1:O<R||ne<ee?-1:ne>ee?1:b.id<k.id?-1:b.id>k.id?1:0}constructor(b,k,P,C){this.id=++Rv,this.leftSE=b,b.segment=this,b.otherSE=k,this.rightSE=k,k.segment=this,k.otherSE=b,this.rings=P,this.windings=C}static fromRing(b,k,P){let C,O,R;const h=Ho.comparePoints(b,k);if(h<0)C=b,O=k,R=1;else if(h>0)C=k,O=b,R=-1;else throw new Error(`Tried to create degenerate segment at [${b.x}, ${b.y}]`);const K=new Ho(C,!0),ne=new Ho(O,!1);return new lc(K,ne,[P],[R])}replaceRightSE(b){this.rightSE=b,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const b=this.leftSE.point.y,k=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:b<k?b:k},ur:{x:this.rightSE.point.x,y:b>k?b:k}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(b){return b.x===this.leftSE.point.x&&b.y===this.leftSE.point.y||b.x===this.rightSE.point.x&&b.y===this.rightSE.point.y}comparePoint(b){if(this.isAnEndpoint(b))return 0;const k=this.leftSE.point,P=this.rightSE.point,C=this.vector();if(k.x===P.x)return b.x===k.x?0:b.x<k.x?1:-1;const O=(b.y-k.y)/C.y,R=k.x+O*C.x;if(b.x===R)return 0;const h=(b.x-k.x)/C.x,K=k.y+h*C.y;return b.y===K?0:b.y<K?-1:1}getIntersection(b){const k=this.bbox(),P=b.bbox(),C=im(k,P);if(C===null)return null;const O=this.leftSE.point,R=this.rightSE.point,h=b.leftSE.point,K=b.rightSE.point,ne=Lf(k,h)&&this.comparePoint(h)===0,ee=Lf(P,O)&&b.comparePoint(O)===0,B=Lf(k,K)&&this.comparePoint(K)===0,q=Lf(P,R)&&b.comparePoint(R)===0;if(ee&&ne)return q&&!B?R:!q&&B?K:null;if(ee)return B&&O.x===K.x&&O.y===K.y?null:O;if(ne)return q&&R.x===h.x&&R.y===h.y?null:h;if(q&&B)return null;if(q)return R;if(B)return K;const ue=Lv(O,this.vector(),h,b.vector());return ue===null||!Lf(C,ue)?null:jf.round(ue.x,ue.y)}split(b){const k=[],P=b.events!==void 0,C=new Ho(b,!0),O=new Ho(b,!1),R=this.rightSE;this.replaceRightSE(O),k.push(O),k.push(C);const h=new lc(C,R,this.rings.slice(),this.windings.slice());return Ho.comparePoints(h.leftSE.point,h.rightSE.point)>0&&h.swapEvents(),Ho.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),P&&(C.checkForConsuming(),O.checkForConsuming()),k}swapEvents(){const b=this.rightSE;this.rightSE=this.leftSE,this.leftSE=b,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let k=0,P=this.windings.length;k<P;k++)this.windings[k]*=-1}consume(b){let k=this,P=b;for(;k.consumedBy;)k=k.consumedBy;for(;P.consumedBy;)P=P.consumedBy;const C=lc.compare(k,P);if(C!==0){if(C>0){const O=k;k=P,P=O}if(k.prev===P){const O=k;k=P,P=O}for(let O=0,R=P.rings.length;O<R;O++){const h=P.rings[O],K=P.windings[O],ne=k.rings.indexOf(h);ne===-1?(k.rings.push(h),k.windings.push(K)):k.windings[ne]+=K}P.rings=null,P.windings=null,P.consumedBy=k,P.leftSE.consumedBy=k.leftSE,P.rightSE.consumedBy=k.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const b=this.prev.consumedBy||this.prev;this._beforeState=b.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const b=this.beforeState();this._afterState={rings:b.rings.slice(0),windings:b.windings.slice(0),multiPolys:[]};const k=this._afterState.rings,P=this._afterState.windings,C=this._afterState.multiPolys;for(let h=0,K=this.rings.length;h<K;h++){const ne=this.rings[h],ee=this.windings[h],B=k.indexOf(ne);B===-1?(k.push(ne),P.push(ee)):P[B]+=ee}const O=[],R=[];for(let h=0,K=k.length;h<K;h++){if(P[h]===0)continue;const ne=k[h],ee=ne.poly;if(R.indexOf(ee)===-1)if(ne.isExterior)O.push(ee);else{R.indexOf(ee)===-1&&R.push(ee);const B=O.indexOf(ne.poly);B!==-1&&O.splice(B,1)}}for(let h=0,K=O.length;h<K;h++){const ne=O[h].multiPoly;C.indexOf(ne)===-1&&C.push(ne)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const b=this.beforeState().multiPolys,k=this.afterState().multiPolys;switch(gl.type){case"union":{const P=b.length===0,C=k.length===0;this._isInResult=P!==C;break}case"intersection":{let P,C;b.length<k.length?(P=b.length,C=k.length):(P=k.length,C=b.length),this._isInResult=C===gl.numMultiPolys&&P<C;break}case"xor":{const P=Math.abs(b.length-k.length);this._isInResult=P%2===1;break}case"difference":{const P=C=>C.length===1&&C[0].isSubject;this._isInResult=P(b)!==P(k);break}default:throw new Error(`Unrecognized operation type found ${gl.type}`)}return this._isInResult}}class Sg{constructor(b,k,P){if(!Array.isArray(b)||b.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=k,this.isExterior=P,this.segments=[],typeof b[0][0]!="number"||typeof b[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const C=jf.round(b[0][0],b[0][1]);this.bbox={ll:{x:C.x,y:C.y},ur:{x:C.x,y:C.y}};let O=C;for(let R=1,h=b.length;R<h;R++){if(typeof b[R][0]!="number"||typeof b[R][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let K=jf.round(b[R][0],b[R][1]);K.x===O.x&&K.y===O.y||(this.segments.push(lc.fromRing(O,K,this)),K.x<this.bbox.ll.x&&(this.bbox.ll.x=K.x),K.y<this.bbox.ll.y&&(this.bbox.ll.y=K.y),K.x>this.bbox.ur.x&&(this.bbox.ur.x=K.x),K.y>this.bbox.ur.y&&(this.bbox.ur.y=K.y),O=K)}(C.x!==O.x||C.y!==O.y)&&this.segments.push(lc.fromRing(O,C,this))}getSweepEvents(){const b=[];for(let k=0,P=this.segments.length;k<P;k++){const C=this.segments[k];b.push(C.leftSE),b.push(C.rightSE)}return b}}class Nv{constructor(b,k){if(!Array.isArray(b))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Sg(b[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let P=1,C=b.length;P<C;P++){const O=new Sg(b[P],this,!1);O.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=O.bbox.ll.x),O.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=O.bbox.ll.y),O.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=O.bbox.ur.x),O.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=O.bbox.ur.y),this.interiorRings.push(O)}this.multiPoly=k}getSweepEvents(){const b=this.exteriorRing.getSweepEvents();for(let k=0,P=this.interiorRings.length;k<P;k++){const C=this.interiorRings[k].getSweepEvents();for(let O=0,R=C.length;O<R;O++)b.push(C[O])}return b}}class Eg{constructor(b,k){if(!Array.isArray(b))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof b[0][0][0]=="number"&&(b=[b])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let P=0,C=b.length;P<C;P++){const O=new Nv(b[P],this);O.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=O.bbox.ll.x),O.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=O.bbox.ll.y),O.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=O.bbox.ur.x),O.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=O.bbox.ur.y),this.polys.push(O)}this.isSubject=k}getSweepEvents(){const b=[];for(let k=0,P=this.polys.length;k<P;k++){const C=this.polys[k].getSweepEvents();for(let O=0,R=C.length;O<R;O++)b.push(C[O])}return b}}class tp{static factory(b){const k=[];for(let P=0,C=b.length;P<C;P++){const O=b[P];if(!O.isInResult()||O.ringOut)continue;let R=null,h=O.leftSE,K=O.rightSE;const ne=[h],ee=h.point,B=[];for(;R=h,h=K,ne.push(h),h.point!==ee;)for(;;){const q=h.getAvailableLinkedEvents();if(q.length===0){const de=ne[0].point,Pe=ne[ne.length-1].point;throw new Error(`Unable to complete output ring starting at [${de.x}, ${de.y}]. Last matching segment found ends at [${Pe.x}, ${Pe.y}].`)}if(q.length===1){K=q[0].otherSE;break}let ue=null;for(let de=0,Pe=B.length;de<Pe;de++)if(B[de].point===h.point){ue=de;break}if(ue!==null){const de=B.splice(ue)[0],Pe=ne.splice(de.index);Pe.unshift(Pe[0].otherSE),k.push(new tp(Pe.reverse()));continue}B.push({index:ne.length,point:h.point});const ce=h.getLeftmostComparator(R);K=q.sort(ce)[0].otherSE;break}k.push(new tp(ne))}return k}constructor(b){this.events=b;for(let k=0,P=b.length;k<P;k++)b[k].segment.ringOut=this;this.poly=null}getGeom(){let b=this.events[0].point;const k=[b];for(let ne=1,ee=this.events.length-1;ne<ee;ne++){const B=this.events[ne].point,q=this.events[ne+1].point;wg(B,b,q)!==0&&(k.push(B),b=B)}if(k.length===1)return null;const P=k[0],C=k[1];wg(P,b,C)===0&&k.shift(),k.push(k[0]);const O=this.isExteriorRing()?1:-1,R=this.isExteriorRing()?0:k.length-1,h=this.isExteriorRing()?k.length:-1,K=[];for(let ne=R;ne!=h;ne+=O)K.push([k[ne].x,k[ne].y]);return K}isExteriorRing(){if(this._isExteriorRing===void 0){const b=this.enclosingRing();this._isExteriorRing=b?!b.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let b=this.events[0];for(let C=1,O=this.events.length;C<O;C++){const R=this.events[C];Ho.compare(b,R)>0&&(b=R)}let k=b.segment.prevInResult(),P=k?k.prevInResult():null;for(;;){if(!k)return null;if(!P)return k.ringOut;if(P.ringOut!==k.ringOut)return P.ringOut.enclosingRing()!==k.ringOut?k.ringOut:k.ringOut.enclosingRing();k=P.prevInResult(),P=k?k.prevInResult():null}}}class Ig{constructor(b){this.exteriorRing=b,b.poly=this,this.interiorRings=[]}addInterior(b){this.interiorRings.push(b),b.poly=this}getGeom(){const b=[this.exteriorRing.getGeom()];if(b[0]===null)return null;for(let k=0,P=this.interiorRings.length;k<P;k++){const C=this.interiorRings[k].getGeom();C!==null&&b.push(C)}return b}}class Dv{constructor(b){this.rings=b,this.polys=this._composePolys(b)}getGeom(){const b=[];for(let k=0,P=this.polys.length;k<P;k++){const C=this.polys[k].getGeom();C!==null&&b.push(C)}return b}_composePolys(b){const k=[];for(let P=0,C=b.length;P<C;P++){const O=b[P];if(!O.poly)if(O.isExteriorRing())k.push(new Ig(O));else{const R=O.enclosingRing();R.poly||k.push(new Ig(R)),R.poly.addInterior(O)}}return k}}class zv{constructor(b){let k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:lc.compare;this.queue=b,this.tree=new lm(k),this.segments=[]}process(b){const k=b.segment,P=[];if(b.consumedBy)return b.isLeft?this.queue.remove(b.otherSE):this.tree.remove(k),P;const C=b.isLeft?this.tree.add(k):this.tree.find(k);if(!C)throw new Error(`Unable to find segment #${k.id} [${k.leftSE.point.x}, ${k.leftSE.point.y}] -> [${k.rightSE.point.x}, ${k.rightSE.point.y}] in SweepLine tree.`);let O=C,R=C,h,K;for(;h===void 0;)O=this.tree.prev(O),O===null?h=null:O.key.consumedBy===void 0&&(h=O.key);for(;K===void 0;)R=this.tree.next(R),R===null?K=null:R.key.consumedBy===void 0&&(K=R.key);if(b.isLeft){let ne=null;if(h){const B=h.getIntersection(k);if(B!==null&&(k.isAnEndpoint(B)||(ne=B),!h.isAnEndpoint(B))){const q=this._splitSafely(h,B);for(let ue=0,ce=q.length;ue<ce;ue++)P.push(q[ue])}}let ee=null;if(K){const B=K.getIntersection(k);if(B!==null&&(k.isAnEndpoint(B)||(ee=B),!K.isAnEndpoint(B))){const q=this._splitSafely(K,B);for(let ue=0,ce=q.length;ue<ce;ue++)P.push(q[ue])}}if(ne!==null||ee!==null){let B=null;ne===null?B=ee:ee===null?B=ne:B=Ho.comparePoints(ne,ee)<=0?ne:ee,this.queue.remove(k.rightSE),P.push(k.rightSE);const q=k.split(B);for(let ue=0,ce=q.length;ue<ce;ue++)P.push(q[ue])}P.length>0?(this.tree.remove(k),P.push(b)):(this.segments.push(k),k.prev=h)}else{if(h&&K){const ne=h.getIntersection(K);if(ne!==null){if(!h.isAnEndpoint(ne)){const ee=this._splitSafely(h,ne);for(let B=0,q=ee.length;B<q;B++)P.push(ee[B])}if(!K.isAnEndpoint(ne)){const ee=this._splitSafely(K,ne);for(let B=0,q=ee.length;B<q;B++)P.push(ee[B])}}}this.tree.remove(k)}return P}_splitSafely(b,k){this.tree.remove(b);const P=b.rightSE;this.queue.remove(P);const C=b.split(k);return C.push(P),b.consumedBy===void 0&&this.tree.add(b),C}}const Tg=typeof process<"u"&&ry.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ov=typeof process<"u"&&ry.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class Fv{run(b,k,P){gl.type=b,jf.reset();const C=[new Eg(k,!0)];for(let B=0,q=P.length;B<q;B++)C.push(new Eg(P[B],!1));if(gl.numMultiPolys=C.length,gl.type==="difference"){const B=C[0];let q=1;for(;q<C.length;)im(C[q].bbox,B.bbox)!==null?q++:C.splice(q,1)}if(gl.type==="intersection")for(let B=0,q=C.length;B<q;B++){const ue=C[B];for(let ce=B+1,de=C.length;ce<de;ce++)if(im(ue.bbox,C[ce].bbox)===null)return[]}const O=new lm(Ho.compare);for(let B=0,q=C.length;B<q;B++){const ue=C[B].getSweepEvents();for(let ce=0,de=ue.length;ce<de;ce++)if(O.insert(ue[ce]),O.size>Tg)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const R=new zv(O);let h=O.size,K=O.pop();for(;K;){const B=K.key;if(O.size===h){const ue=B.segment;throw new Error(`Unable to pop() ${B.isLeft?"left":"right"} SweepEvent [${B.point.x}, ${B.point.y}] from segment #${ue.id} [${ue.leftSE.point.x}, ${ue.leftSE.point.y}] -> [${ue.rightSE.point.x}, ${ue.rightSE.point.y}] from queue.`)}if(O.size>Tg)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(R.segments.length>Ov)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const q=R.process(B);for(let ue=0,ce=q.length;ue<ce;ue++){const de=q[ue];de.consumedBy===void 0&&O.insert(de)}h=O.size,K=O.pop()}jf.reset();const ne=tp.factory(R.segments);return new Dv(ne).getGeom()}}const gl=new Fv,Bv=function(S){for(var b=arguments.length,k=new Array(b>1?b-1:0),P=1;P<b;P++)k[P-1]=arguments[P];return gl.run("union",S,k)},jv=function(S){for(var b=arguments.length,k=new Array(b>1?b-1:0),P=1;P<b;P++)k[P-1]=arguments[P];return gl.run("intersection",S,k)},Uv=function(S){for(var b=arguments.length,k=new Array(b>1?b-1:0),P=1;P<b;P++)k[P-1]=arguments[P];return gl.run("xor",S,k)},Vv=function(S){for(var b=arguments.length,k=new Array(b>1?b-1:0),P=1;P<b;P++)k[P-1]=arguments[P];return gl.run("difference",S,k)};var um={union:Bv,intersection:jv,xor:Uv,difference:Vv};function Wh(S){return S.type==="Polygon"?[S.coordinates]:S.coordinates}function cm(S){return!S||S.length===0?null:S.length===1?{type:"Polygon",coordinates:S[0]}:{type:"MultiPolygon",coordinates:S}}function $f(S,b){const k=um.intersection(Wh(S),Wh(b));return cm(k)}function ay(S,b){const k=um.difference(Wh(S),Wh(b));return cm(k)}function Cg(S,b){const k=um.union(Wh(S),Wh(b));return cm(k)}function qv(S,b=.5){const k=oc(S),P=[k[0]-b,k[1]-b,k[2]+b,k[3]+b];return Og(P)}function Gv(S,b,k,P){const C=$h(b),R=X_(C,k,{units:"miles",steps:96}).geometry;return P?$f(S,R):ay(S,R)}function $v(S,b,k,P){const C=$h(b,{id:"A"}),O=$h(k,{id:"B"}),R=Of([C,O]),h=qv(S,1),K=oc(h),ne=pv(R,{bbox:K});if(!ne)return null;let ee=null,B=null;for(const ue of ne.features){if(!ue?.geometry)continue;const ce=ue.geometry;Zp(C,ce)&&(ee=ce),Zp(O,ce)&&(B=ce)}const q=P?B:ee;return q?$f(S,q):null}function Zv(S){for(const b of S.geometries)if(b.type==="Polygon"||b.type==="MultiPolygon")return b;return null}function Hv(S){if(S.geojson){if(S.geojson.type==="Polygon"||S.geojson.type==="MultiPolygon")return S.geojson;if(S.geojson.type==="GeometryCollection"){const h=Zv(S.geojson);if(h)return h}}const[b,k,P,C]=S.boundingbox.map(parseFloat);return Og([P,b,C,k]).geometry}async function Xv(S){const b=`/.netlify/functions/geocode?q=${encodeURIComponent(S)}`,k=await fetch(b);if(!k.ok){const C=await k.json().catch(()=>({})),O=C.provider?` (${C.provider})`:"",R=C.error||k.statusText||"Unknown error";throw new Error(`Geocoding failed${O}: ${k.status} ${R}`)}return await k.json()}const rm=new Map,Wv=900*1e3;function Yv(S){const b=rm.get(S);return b?Date.now()>b.expires?(rm.delete(S),null):b.data:null}function Kv(S,b){rm.set(S,{data:b,expires:Date.now()+Wv})}function Jv(S,b,k,P){return`${S.toFixed(2)},${b.toFixed(2)},${k.toFixed(2)},${P.toFixed(2)}`}async function Gp(S,b,k=800){const[P,C,O,R]=b,h=`${S}:${Jv(P,C,O,R)}:${k}`,K=Yv(h);if(K)return K.points;const ne=`/.netlify/functions/overpass?kind=${encodeURIComponent(S)}&south=${P}&west=${C}&north=${O}&east=${R}&limit=${k}`,ee=await fetch(ne);if(!ee.ok){const ue=(await ee.json().catch(()=>({}))).error||ee.statusText||"Unknown error";throw new Error(`POI fetch failed: ${ee.status} ${ue}`)}const B=await ee.json();return Kv(h,B),B.points}function $p(S,b){const[k,P,C,O]=S,R=(k+C)/2,h=b/110.574,K=b/(111.32*Math.cos(R*Math.PI/180));return[k-h,P-K,C+h,O+K]}function hm(S,b){if(S.length===0)throw new Error("No points provided");const k=[];for(const O of S){const R={type:"Feature",geometry:{type:"Point",coordinates:[O.lon,O.lat]},properties:{}},h=Z_(R,b,{units:"kilometers"});h&&h.geometry.type==="Polygon"&&k.push(h)}if(k.length===0)throw new Error("No valid buffers created");const P=25;let C=k[0].geometry;for(let O=1;O<k.length;O+=P){const R=k.slice(O,Math.min(O+P,k.length));let h=R[0].geometry;for(let K=1;K<R.length;K++)try{const ne=Cg(h,R[K].geometry);ne&&(h=ne)}catch(ne){console.warn("Union failed, skipping:",ne);continue}try{const K=Cg(C,h);K&&(C=K)}catch(K){console.warn("Final union failed:",K);continue}}return{type:"Feature",geometry:C,properties:{}}}function Qv(S,b,k){try{if(k){const P=$f(S.geometry,b.geometry);return P?{type:"Feature",geometry:P,properties:{}}:null}else{const P=ay(S.geometry,b.geometry);return P?{type:"Feature",geometry:P,properties:{}}:null}}catch(P){return console.error("POI within operation failed:",P),null}}function e0(S){return S/110.574}function t0(S,b){return S/(111.32*Math.cos(b*Math.PI/180))}function oy(S,b){const k=b?.maxPoints??900,P=b?.minStepKm??10,C=oc(S),[O,R,h,K]=C,ne=(R+K)/2,ee=Math.max(1,(h-O)*111.32*Math.cos(ne*Math.PI/180)),B=Math.max(1,(K-R)*110.574),q=ee*B,ue=Math.max(P,Math.sqrt(q/Math.max(1,k))),ce={type:"Feature",geometry:S,properties:{}},de=[];for(let Pe=R;Pe<=K;Pe+=e0(ue)){const je=t0(ue,Pe);for(let Te=O;Te<=h;Te+=je)if(Zp({type:"Feature",geometry:{type:"Point",coordinates:[Te,Pe]},properties:{}},ce)&&de.push([Te,Pe]),de.length>=k)return{points:de,stepKm:ue}}return{points:de,stepKm:ue}}function n0(S,b){const[k,P]=S,[C,O]=b,R=6371e3,h=ce=>ce*Math.PI/180,K=h(O-P),ne=h(C-k),ee=Math.sin(K/2),B=Math.sin(ne/2),q=ee*ee+Math.cos(h(P))*Math.cos(h(O))*B*B,ue=2*Math.atan2(Math.sqrt(q),Math.sqrt(1-q));return R*ue}function np(S,b){if(b.length===0)return null;let k=null;for(const P of b){const C=n0(S,[P.lon,P.lat]);(!k||C<k.meters)&&(k={id:P.id,lon:P.lon,lat:P.lat,meters:C,name:P.name})}return k}function ly(S,b){if(S.length<=b)return S;const k=Math.ceil(S.length/b),P=[];for(let C=0;C<S.length;C+=k)P.push(S[C]);return P}function i0({candidate:S,seekerLngLat:b,pois:k,answerYes:P}){const C=np(b,k);if(!C)return{next:null,sampleCount:0,keptCount:0,seekerNearestId:-1};const{points:O,stepKm:R}=oy(S,{maxPoints:900,minStepKm:12});if(O.length===0)return{next:null,sampleCount:0,keptCount:0,seekerNearestId:C.id};const h=[];for(const[q,ue]of O){const ce=np([q,ue],k),de=ce?ce.id===C.id:!1;(P?de:!de)&&h.push({lat:ue,lon:q})}if(h.length===0)return{next:null,sampleCount:O.length,keptCount:0,seekerNearestId:C.id};const K=ly(h,350),ne=Math.max(6,R*.9),ee=hm(K,ne);return{next:$f(S,ee.geometry),sampleCount:O.length,keptCount:h.length,seekerNearestId:C.id}}function r0({candidate:S,seekerLngLat:b,pois:k,answer:P,epsilonMeters:C}){const O=C??25,R=np(b,k);if(!R)return{next:null,sampleCount:0,keptCount:0,seekerDistanceM:-1};const h=R.meters,{points:K,stepKm:ne}=oy(S,{maxPoints:900,minStepKm:12});if(K.length===0)return{next:null,sampleCount:0,keptCount:0,seekerDistanceM:h};const ee=[];for(const[de,Pe]of K){const je=np([de,Pe],k);if(!je)continue;const Te=je.meters;(P==="CLOSER"?Te<h-O:Te>h+O)&&ee.push({lat:Pe,lon:de})}if(ee.length===0)return{next:null,sampleCount:K.length,keptCount:0,seekerDistanceM:h};const B=ly(ee,350),q=Math.max(6,ne*.9),ue=hm(B,q);return{next:$f(S,ue.geometry),sampleCount:K.length,keptCount:ee.length,seekerDistanceM:h}}function $o(){return Math.random().toString(16).slice(2)+"-"+Date.now().toString(16)}function s0(){return mv.features??[]}function a0(S,b){const k=b.trim().toUpperCase();return S.find(P=>(P.properties?.iso_a2??"").toUpperCase()===k)??null}const Qn=Jy((S,b)=>({countries:s0(),selectedIsoA2:"",candidate:null,seekerLngLat:null,seekerAccuracyM:null,seekerLastUpdatedMs:null,gpsWatchId:null,isTrackingGPS:!1,thermoStart:null,thermoEnd:null,history:[],undoStack:[],redoStack:[],searchQuery:"",searchResults:[],selectedAreaLabel:null,lastToast:null,setCountry:P=>{const C=a0(b().countries,P);if(!C)return;const O=(C.properties?.iso_a2??P).toUpperCase();S({selectedIsoA2:O,candidate:C.geometry,undoStack:[],redoStack:[],thermoStart:null,thermoEnd:null,history:[...b().history,{id:$o(),ts:Date.now(),type:"SET_COUNTRY",isoA2:O,name:C.properties?.name}]})},updateSeekerFromGPS:async()=>{if(!navigator.geolocation)throw new Error("Geolocation not supported");const P=await new Promise((h,K)=>{navigator.geolocation.getCurrentPosition(h,ne=>{const ee=ne.code===1?"PERMISSION_DENIED":ne.code===2?"POSITION_UNAVAILABLE":ne.code===3?"TIMEOUT":`ERROR_${ne.code}`;K(new Error(`GPS error (${ee}): ${ne.message||"Unknown error"}`))},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),C=P.coords.longitude,O=P.coords.latitude,R=Date.now();S({seekerLngLat:[C,O],seekerAccuracyM:P.coords.accuracy??null,seekerLastUpdatedMs:R})},startGPSTracking:()=>{const P=b();if(P.isTrackingGPS||P.gpsWatchId!==null)return;if(!navigator.geolocation)throw new Error("Geolocation not supported");const C=navigator.geolocation.watchPosition(O=>{const R=O.coords.longitude,h=O.coords.latitude,K=Date.now();S({seekerLngLat:[R,h],seekerAccuracyM:O.coords.accuracy??null,seekerLastUpdatedMs:K})},O=>{console.error("GPS tracking error:",O),b().stopGPSTracking()},{enableHighAccuracy:!0,maximumAge:0});S({gpsWatchId:C,isTrackingGPS:!0})},stopGPSTracking:()=>{const P=b();P.gpsWatchId!==null&&navigator.geolocation.clearWatch(P.gpsWatchId),S({gpsWatchId:null,isTrackingGPS:!1})},setThermoStartNow:()=>{const P=b().seekerLngLat;P&&S({thermoStart:P})},setThermoEndNow:()=>{const P=b().seekerLngLat;P&&S({thermoEnd:P})},applyRadarNow:(P,C)=>{const O=b().candidate,R=b().seekerLngLat;if(!O||!R)return;const h=Gv(O,R,P,C);h&&S({candidate:h,undoStack:[...b().undoStack,O],redoStack:[],history:[...b().history,{id:$o(),ts:Date.now(),type:"RADAR",radiusMiles:P,hit:C,seeker:R}]})},applyThermo:P=>{const C=b().candidate,O=b().thermoStart,R=b().thermoEnd;if(!C||!O||!R)return;const h=$v(C,O,R,P);h&&S({candidate:h,undoStack:[...b().undoStack,C],redoStack:[],history:[...b().history,{id:$o(),ts:Date.now(),type:"THERMOMETER",hotter:P,start:O,end:R}]})},applyMatching:async(P,C)=>{const O=b().candidate,R=b().seekerLngLat;if(!O||!R){S({lastToast:"Requires seeker GPS and a selected area."});return}try{const K=oc({type:"Feature",geometry:O,properties:{}}),ne=$p([K[1],K[0],K[3],K[2]],75),ee=await Gp(P,ne,800);if(ee.length===0){S({lastToast:`No ${P} POIs found nearby. Try a larger area.`});return}const{next:B,sampleCount:q,keptCount:ue,seekerNearestId:ce}=i0({candidate:O,seekerLngLat:R,pois:ee,answerYes:C==="YES"});if(!B){S({candidate:null,lastToast:"No possible area remains.",undoStack:[...b().undoStack,O],redoStack:[],history:[...b().history,{id:$o(),ts:Date.now(),type:"MATCHING",kind:P,answer:C,poiCount:ee.length,sampleCount:q,keptCount:ue}]});return}S({candidate:B,lastToast:`Matching ${P}: kept ${ue}/${q} samples (nearest id ${ce})`,undoStack:[...b().undoStack,O],redoStack:[],history:[...b().history,{id:$o(),ts:Date.now(),type:"MATCHING",kind:P,answer:C,poiCount:ee.length,sampleCount:q,keptCount:ue}]})}catch(h){console.error("Matching error:",h),S({lastToast:h instanceof Error?h.message:"Matching operation failed"})}},applyMeasuring:async(P,C)=>{const O=b().candidate,R=b().seekerLngLat;if(!O||!R){S({lastToast:"Requires seeker GPS and a selected area."});return}try{const K=oc({type:"Feature",geometry:O,properties:{}}),ne=$p([K[1],K[0],K[3],K[2]],75),ee=await Gp(P,ne,800);if(ee.length===0){S({lastToast:`No ${P} POIs found nearby. Try a larger area.`});return}const{next:B,sampleCount:q,keptCount:ue,seekerDistanceM:ce}=r0({candidate:O,seekerLngLat:R,pois:ee,answer:C});if(!B){S({candidate:null,lastToast:"No possible area remains.",undoStack:[...b().undoStack,O],redoStack:[],history:[...b().history,{id:$o(),ts:Date.now(),type:"MEASURING",kind:P,answer:C,poiCount:ee.length,sampleCount:q,keptCount:ue}]});return}S({candidate:B,lastToast:`Measuring ${P} ${C}: kept ${ue}/${q} (seeker ~${Math.round(ce)}m)`,undoStack:[...b().undoStack,O],redoStack:[],history:[...b().history,{id:$o(),ts:Date.now(),type:"MEASURING",kind:P,answer:C,poiCount:ee.length,sampleCount:q,keptCount:ue}]})}catch(h){console.error("Measuring error:",h),S({lastToast:h instanceof Error?h.message:"Measuring operation failed"})}},undo:()=>{const P=b().undoStack;if(P.length===0)return;const C=P[P.length-1],O=b().candidate;S({candidate:C,undoStack:P.slice(0,-1),redoStack:O?[...b().redoStack,O]:b().redoStack})},redo:()=>{const P=b().redoStack;if(P.length===0)return;const C=P[P.length-1],O=b().candidate;S({candidate:C,redoStack:P.slice(0,-1),undoStack:O?[...b().undoStack,O]:b().undoStack})},resetCandidateToCountry:()=>{b().stopGPSTracking(),S({candidate:null,undoStack:[],redoStack:[],thermoStart:null,thermoEnd:null})},setSearchQuery:P=>{S({searchQuery:P})},setLastToast:P=>{S({lastToast:P})},runSearch:async()=>{const P=b().searchQuery.trim();if(!P){S({searchResults:[]});return}try{const C=await Xv(P);S({searchResults:C})}catch(C){throw console.error("Search error:",C),S({searchResults:[]}),C}},selectSearchResult:P=>{const C=Hv(P);S({candidate:C,undoStack:[],redoStack:[],thermoStart:null,thermoEnd:null,selectedAreaLabel:P.display_name,history:[...b().history,{id:$o(),ts:Date.now(),type:"SET_AREA",label:P.display_name}]})},applyPoiWithin:async(P,C,O)=>{const R=b().candidate;if(!R){S({lastToast:"No area selected. Select an area first."});return}const h=C*1.60934;try{const K={type:"Feature",geometry:R,properties:{}},ne=oc(K),ee=$p([ne[1],ne[0],ne[3],ne[2]],h),B=await Gp(P,ee);if(B.length===0){S(O==="YES"?{candidate:null,lastToast:`No ${P}s found. YES makes area impossible.`,undoStack:[...b().undoStack,R],redoStack:[],history:[...b().history,{id:$o(),ts:Date.now(),type:"POI_WITHIN",kind:P,radiusMiles:C,answer:O,poiCount:0}]}:{lastToast:`No ${P}s found. Area unchanged.`,history:[...b().history,{id:$o(),ts:Date.now(),type:"POI_WITHIN",kind:P,radiusMiles:C,answer:O,poiCount:0}]});return}const q=hm(B,h),ue=Qv(K,q,O==="YES");S(ue?{candidate:ue.geometry,lastToast:`${P}: ${B.length} found in search area`,undoStack:[...b().undoStack,R],redoStack:[],history:[...b().history,{id:$o(),ts:Date.now(),type:"POI_WITHIN",kind:P,radiusMiles:C,answer:O,poiCount:B.length}]}:{candidate:null,lastToast:"No possible area remains.",undoStack:[...b().undoStack,R],redoStack:[],history:[...b().history,{id:$o(),ts:Date.now(),type:"POI_WITHIN",kind:P,radiusMiles:C,answer:O,poiCount:B.length}]})}catch(K){console.error("POI within error:",K),S({lastToast:K instanceof Error?K.message:"POI operation failed"})}}}));var Zd={exports:{}};var o0=Zd.exports,Pg;function l0(){return Pg||(Pg=1,(function(S,b){(function(k,P){S.exports=P()})(o0,(function(){var k={},P={};function C(R,h,K){if(P[R]=K,R==="index"){var ne="var sharedModule = {}; ("+P.shared+")(sharedModule); ("+P.worker+")(sharedModule);",ee={};return P.shared(ee),P.index(k,ee),typeof window<"u"&&k.setWorkerUrl(window.URL.createObjectURL(new Blob([ne],{type:"text/javascript"}))),k}}C("shared",["exports"],(function(R){function h(n,t,r,u){return new(r||(r=Promise))((function(m,v){function x(z){try{M(u.next(z))}catch(V){v(V)}}function I(z){try{M(u.throw(z))}catch(V){v(V)}}function M(z){var V;z.done?m(z.value):(V=z.value,V instanceof r?V:new r((function(G){G(V)}))).then(x,I)}M((u=u.apply(n,t||[])).next())}))}function K(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}typeof SuppressedError=="function"&&SuppressedError;var ne=ee;function ee(n,t){this.x=n,this.y=t}ee.prototype={clone:function(){return new ee(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,r=n.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),r=Math.sin(n),u=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=u,this},_rotateAround:function(n,t){var r=Math.cos(n),u=Math.sin(n),m=t.y+u*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-u*(this.y-t.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ee.convert=function(n){return n instanceof ee?n:Array.isArray(n)?new ee(n[0],n[1]):n};var B=K(ne),q=ue;function ue(n,t,r,u){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(u-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=r,this.p2y=u}ue.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,u=0;u<8;u++){var m=this.sampleCurveX(r)-n;if(Math.abs(m)<t)return r;var v=this.sampleCurveDerivativeX(r);if(Math.abs(v)<1e-6)break;r-=m/v}var x=0,I=1;for(r=n,u=0;u<20&&(m=this.sampleCurveX(r),!(Math.abs(m-n)<t));u++)n>m?x=r:I=r,r=.5*(I-x)+x;return r},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var ce=K(q);let de,Pe;function je(){return de==null&&(de=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),de}function Te(){if(Pe==null&&(Pe=!1,je())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let u=0;u<25;u++){const m=4*u;t.fillStyle=`rgb(${m},${m+1},${m+2})`,t.fillRect(u%5,Math.floor(u/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let u=0;u<100;u++)if(u%4!=3&&r[u]!==u){Pe=!0;break}}}return Pe||!1}function qe(n,t,r,u){const m=new ce(n,t,r,u);return v=>m.solve(v)}const tt=qe(.25,.1,.25,1);function nt(n,t,r){return Math.min(r,Math.max(t,n))}function it(n,t,r){const u=r-t,m=((n-t)%u+u)%u+t;return m===t?r:m}function Ge(n,...t){for(const r of t)for(const u in r)n[u]=r[u];return n}let ht=1;function mt(n,t,r){const u={};for(const m in n)u[m]=t.call(this,n[m],m,n);return u}function Kt(n,t,r){const u={};for(const m in n)t.call(this,n[m],m,n)&&(u[m]=n[m]);return u}function St(n){return Array.isArray(n)?n.map(St):typeof n=="object"&&n?mt(n,St):n}const Ht={};function Vt(n){Ht[n]||(typeof console<"u"&&console.warn(n),Ht[n]=!0)}function ct(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function en(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let fn=null;function rn(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const wt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ft(n,t,r,u,m){return h(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(n,{timestamp:0});try{const x=v?.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const I=x.startsWith("BGR"),M=new Uint8ClampedArray(u*m*4);if(yield v.copyTo(M,(function(z,V,G,X,J){const ie=4*Math.max(-V,0),le=(Math.max(0,G)-G)*X*4+ie,ye=4*X,be=Math.max(0,V),Ue=Math.max(0,G);return{rect:{x:be,y:Ue,width:Math.min(z.width,V+X)-be,height:Math.min(z.height,G+J)-Ue},layout:[{offset:le,stride:ye}]}})(n,t,r,u,m)),I)for(let z=0;z<M.length;z+=4){const V=M[z];M[z]=M[z+2],M[z+2]=V}return M}finally{v.close()}}))}let et,Le;const rt="AbortError";function an(){return new Error(rt)}const Pt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function yn(n){return Pt.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const zn="global-dispatcher";class Rn extends Error{constructor(t,r,u,m){super(`AJAXError: ${r} (${t}): ${u}`),this.status=t,this.statusText=r,this.url=u,this.body=m}}const Re=()=>en(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ei=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const u=yn(n.url);if(u)return u(n,t);if(en(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:zn},t)}if(!(/^file:/.test(r=n.url)||/^file:/.test(Re())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(u,m){return h(this,void 0,void 0,(function*(){const v=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,cache:u.cache,referrer:Re(),signal:m.signal});u.type!=="json"||v.headers.has("Accept")||v.headers.set("Accept","application/json");const x=yield fetch(v);if(!x.ok){const z=yield x.blob();throw new Rn(x.status,x.statusText,u.url,z)}let I;I=u.type==="arrayBuffer"||u.type==="image"?x.arrayBuffer():u.type==="json"?x.json():x.text();const M=yield I;if(m.signal.aborted)throw an();return{data:M,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}}))})(n,t);if(en(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:zn},t)}var r;return(function(u,m){return new Promise(((v,x)=>{var I;const M=new XMLHttpRequest;M.open(u.method||"GET",u.url,!0),u.type!=="arrayBuffer"&&u.type!=="image"||(M.responseType="arraybuffer");for(const z in u.headers)M.setRequestHeader(z,u.headers[z]);u.type==="json"&&(M.responseType="text",!((I=u.headers)===null||I===void 0)&&I.Accept||M.setRequestHeader("Accept","application/json")),M.withCredentials=u.credentials==="include",M.onerror=()=>{x(new Error(M.statusText))},M.onload=()=>{if(!m.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let z=M.response;if(u.type==="json")try{z=JSON.parse(M.response)}catch(V){return void x(V)}v({data:z,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const z=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});x(new Rn(M.status,M.statusText,u.url,z))}},m.signal.addEventListener("abort",(()=>{M.abort(),x(an())})),M.send(u.body)}))})(n,t)};function Cn(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function Wt(n,t,r){r[n]&&r[n].indexOf(t)!==-1||(r[n]=r[n]||[],r[n].push(t))}function we(n,t,r){if(r&&r[n]){const u=r[n].indexOf(t);u!==-1&&r[n].splice(u,1)}}class Gi{constructor(t,r={}){Ge(this,r),this.type=t}}class Ur extends Gi{constructor(t,r={}){super("error",Ge({error:t},r))}}class Rr{on(t,r){return this._listeners=this._listeners||{},Wt(t,r,this._listeners),this}off(t,r){return we(t,r,this._listeners),we(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Wt(t,r,this._oneTimeListeners),this):new Promise((u=>this.once(t,u)))}fire(t,r){typeof t=="string"&&(t=new Gi(t,r||{}));const u=t.type;if(this.listens(u)){t.target=this;const m=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const I of m)I.call(this,t);const v=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const I of v)we(u,I,this._oneTimeListeners),I.call(this,t);const x=this._eventedParent;x&&(Ge(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(t))}else t instanceof Ur&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var We={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ds=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function To(n,t){const r={};for(const u in n)u!=="ref"&&(r[u]=n[u]);return ds.forEach((u=>{u in t&&(r[u]=t[u])})),r}function ot(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!ot(n[r],t[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const r in n)if(!ot(n[r],t[r]))return!1;return!0}return n===t}function ai(n,t){n.push(t)}function ps(n,t,r){ai(r,{command:"addSource",args:[n,t[n]]})}function pr(n,t,r){ai(t,{command:"removeSource",args:[n]}),r[n]=!0}function As(n,t,r,u){pr(n,r,u),ps(n,t,r)}function vn(n,t,r){let u;for(u in n[r])if(Object.prototype.hasOwnProperty.call(n[r],u)&&u!=="data"&&!ot(n[r][u],t[r][u]))return!1;for(u in t[r])if(Object.prototype.hasOwnProperty.call(t[r],u)&&u!=="data"&&!ot(n[r][u],t[r][u]))return!1;return!0}function ir(n,t,r,u,m,v){n=n||{},t=t||{};for(const x in n)Object.prototype.hasOwnProperty.call(n,x)&&(ot(n[x],t[x])||r.push({command:v,args:[u,x,t[x],m]}));for(const x in t)Object.prototype.hasOwnProperty.call(t,x)&&!Object.prototype.hasOwnProperty.call(n,x)&&(ot(n[x],t[x])||r.push({command:v,args:[u,x,t[x],m]}))}function sa(n){return n.id}function aa(n,t){return n[t.id]=t,n}class Je{constructor(t,r,u,m){this.message=(t?`${t}: `:"")+u,m&&(this.identifier=m),r!=null&&r.__line__&&(this.line=r.__line__)}}function Vr(n,...t){for(const r of t)for(const u in r)n[u]=r[u];return n}class dn extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class tn{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[u,m]of r)this.bindings[u]=m}concat(t){return new tn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Pa={kind:"null"},_t={kind:"number"},In={kind:"string"},dt={kind:"boolean"},mr={kind:"color"},qr={kind:"object"},pn={kind:"value"},ki={kind:"collator"},Sr={kind:"formatted"},Mi={kind:"padding"},gr={kind:"resolvedImage"},_e={kind:"variableAnchorOffsetCollection"};function Y(n,t){return{kind:"array",itemType:n,N:t}}function W(n){if(n.kind==="array"){const t=W(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const ae=[Pa,_t,In,dt,mr,Sr,qr,Y(pn),Mi,gr,_e];function se(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!se(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const r of ae)if(!se(r,t))return null}}return`Expected ${W(n)} but found ${W(t)} instead.`}function Ee(n,t){return t.some((r=>r.kind===n.kind))}function Me(n,t){return t.some((r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n))}function Oe(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const ke=.96422,Ye=.82521,lt=4/29,Ze=6/29,vt=3*Ze*Ze,jt=Ze*Ze*Ze,Jt=Math.PI/180,Fn=180/Math.PI;function bn(n){return(n%=360)<0&&(n+=360),n}function kn([n,t,r,u]){let m,v;const x=pi((.2225045*(n=Sn(n))+.7168786*(t=Sn(t))+.0606169*(r=Sn(r)))/1);n===t&&t===r?m=v=x:(m=pi((.4360747*n+.3850649*t+.1430804*r)/ke),v=pi((.0139322*n+.0971045*t+.7141733*r)/Ye));const I=116*x-16;return[I<0?0:I,500*(m-x),200*(x-v),u]}function Sn(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function pi(n){return n>jt?Math.pow(n,1/3):n/vt+lt}function ti([n,t,r,u]){let m=(n+16)/116,v=isNaN(t)?m:m+t/500,x=isNaN(r)?m:m-r/200;return m=1*Zn(m),v=ke*Zn(v),x=Ye*Zn(x),[xn(3.1338561*v-1.6168667*m-.4906146*x),xn(-.9787684*v+1.9161415*m+.033454*x),xn(.0719453*v-.2289914*m+1.4052427*x),u]}function xn(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Zn(n){return n>Ze?n*n*n:vt*(n-lt)}function ri(n){return parseInt(n.padEnd(2,n),16)/255}function Si(n,t){return Bn(t?n/100:n,0,1)}function Bn(n,t,r){return Math.min(Math.max(t,n),r)}function Er(n){return!n.some(Number.isNaN)}const Co={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class hn{constructor(t,r,u,m=1,v=!0){this.r=t,this.g=r,this.b=u,this.a=m,v||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[t,r,u,m]))}static parse(t){if(t instanceof hn)return t;if(typeof t!="string")return;const r=(function(u){if((u=u.toLowerCase().trim())==="transparent")return[0,0,0,0];const m=Co[u];if(m){const[x,I,M]=m;return[x/255,I/255,M/255,1]}if(u.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(u)){const x=u.length<6?1:2;let I=1;return[ri(u.slice(I,I+=x)),ri(u.slice(I,I+=x)),ri(u.slice(I,I+=x)),ri(u.slice(I,I+x)||"ff")]}if(u.startsWith("rgb")){const x=u.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[I,M,z,V,G,X,J,ie,le,ye,be,Ue]=x,Ie=[V||" ",J||" ",ye].join("");if(Ie==="  "||Ie==="  /"||Ie===",,"||Ie===",,,"){const Be=[z,X,le].join(""),Qe=Be==="%%%"?100:Be===""?255:0;if(Qe){const ft=[Bn(+M/Qe,0,1),Bn(+G/Qe,0,1),Bn(+ie/Qe,0,1),be?Si(+be,Ue):1];if(Er(ft))return ft}}return}}const v=u.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,I,M,z,V,G,X,J,ie]=v,le=[M||" ",V||" ",X].join("");if(le==="  "||le==="  /"||le===",,"||le===",,,"){const ye=[+I,Bn(+z,0,100),Bn(+G,0,100),J?Si(+J,ie):1];if(Er(ye))return(function([be,Ue,Ie,Be]){function Qe(ft){const Dt=(ft+be/30)%12,cn=Ue*Math.min(Ie,1-Ie);return Ie-cn*Math.max(-1,Math.min(Dt-3,9-Dt,1))}return be=bn(be),Ue/=100,Ie/=100,[Qe(0),Qe(8),Qe(4),Be]})(ye)}}})(t);return r?new hn(...r,!1):void 0}get rgb(){const{r:t,g:r,b:u,a:m}=this,v=m||1/0;return this.overwriteGetter("rgb",[t/v,r/v,u/v,m])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[r,u,m,v]=kn(t),x=Math.sqrt(u*u+m*m);return[Math.round(1e4*x)?bn(Math.atan2(m,u)*Fn):NaN,x,r,v]})(this.rgb))}get lab(){return this.overwriteGetter("lab",kn(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,u,m]=this.rgb;return`rgba(${[t,r,u].map((v=>Math.round(255*v))).join(",")},${m})`}}hn.black=new hn(0,0,0,1),hn.white=new hn(1,1,1,1),hn.transparent=new hn(0,0,0,0),hn.red=new hn(1,0,0,1);class Za{constructor(t,r,u){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ha{constructor(t,r,u,m,v){this.text=t,this.image=r,this.scale=u,this.fontStack=m,this.textColor=v}}class yr{constructor(t){this.sections=t}static fromString(t){return new yr([new Ha(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof yr?t:yr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class rr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof rr)return t;if(typeof t=="number")return new rr([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new rr(t)}}toString(){return JSON.stringify(this.values)}}const hc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ei{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ei)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const u=t[r],m=t[r+1];if(typeof u!="string"||!hc.has(u)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new Ei(t)}}toString(){return JSON.stringify(this.values)}}class Fi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Fi({name:t,available:!1}):null}}function sr(n,t,r,u){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[n,t,r,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[n,t,r,u]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qr(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof hn||n instanceof Za||n instanceof yr||n instanceof rr||n instanceof Ei||n instanceof Fi)return!0;if(Array.isArray(n)){for(const t of n)if(!Qr(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!Qr(n[t]))return!1;return!0}return!1}function Xn(n){if(n===null)return Pa;if(typeof n=="string")return In;if(typeof n=="boolean")return dt;if(typeof n=="number")return _t;if(n instanceof hn)return mr;if(n instanceof Za)return ki;if(n instanceof yr)return Sr;if(n instanceof rr)return Mi;if(n instanceof Ei)return _e;if(n instanceof Fi)return gr;if(Array.isArray(n)){const t=n.length;let r;for(const u of n){const m=Xn(u);if(r){if(r===m)continue;r=pn;break}r=m}return Y(r||pn,t)}return qr}function Xo(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof hn||n instanceof yr||n instanceof rr||n instanceof Ei||n instanceof Fi?n.toString():JSON.stringify(n)}class ms{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Qr(t[1]))return r.error("invalid value");const u=t[1];let m=Xn(u);const v=r.expectedType;return m.kind!=="array"||m.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(m=v),new ms(m,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Bi{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Ma={string:In,number:_t,boolean:dt,object:qr};class Ir{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let u,m=1;const v=t[0];if(v==="array"){let I,M;if(t.length>2){const z=t[1];if(typeof z!="string"||!(z in Ma)||z==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);I=Ma[z],m++}else I=pn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);M=t[2],m++}u=Y(I,M)}else{if(!Ma[v])throw new Error(`Types doesn't contain name = ${v}`);u=Ma[v]}const x=[];for(;m<t.length;m++){const I=r.parse(t[m],m,pn);if(!I)return null;x.push(I)}return new Ir(u,x)}evaluate(t){for(let r=0;r<this.args.length;r++){const u=this.args[r].evaluate(t);if(!se(this.type,Xn(u)))return u;if(r===this.args.length-1)throw new Bi(`Expected value to be of type ${W(this.type)}, but found ${W(Xn(u))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Ls={"to-boolean":dt,"to-color":mr,"to-number":_t,"to-string":In};class Ai{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const u=t[0];if(!Ls[u])throw new Error(`Can't parse ${u} as it is not part of the known types`);if((u==="to-boolean"||u==="to-string")&&t.length!==2)return r.error("Expected one argument.");const m=Ls[u],v=[];for(let x=1;x<t.length;x++){const I=r.parse(t[x],x,pn);if(!I)return null;v.push(I)}return new Ai(m,v)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,u;for(const m of this.args){if(r=m.evaluate(t),u=null,r instanceof hn)return r;if(typeof r=="string"){const v=t.parseColor(r);if(v)return v}else if(Array.isArray(r)&&(u=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:sr(r[0],r[1],r[2],r[3]),!u))return new hn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Bi(u||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const u of this.args){r=u.evaluate(t);const m=rr.parse(r);if(m)return m}throw new Bi(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const u of this.args){r=u.evaluate(t);const m=Ei.parse(r);if(m)return m}throw new Bi(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const u of this.args){if(r=u.evaluate(t),r===null)return 0;const m=Number(r);if(!isNaN(m))return m}throw new Bi(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return yr.fromString(Xo(this.args[0].evaluate(t)));case"resolvedImage":return Fi.fromString(Xo(this.args[0].evaluate(t)));default:return Xo(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Aa=["Unknown","Point","LineString","Polygon"];class Wo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Aa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=hn.parse(t)),r}}class Nr{constructor(t,r,u=[],m,v=new tn,x=[]){this.registry=t,this.path=u,this.key=u.map((I=>`[${I}]`)).join(""),this.scope=v,this.errors=x,this.expectedType=m,this._isConstant=r}parse(t,r,u,m,v={}){return r?this.concat(r,u,m)._parse(t,v):this._parse(t,v)}_parse(t,r){function u(m,v,x){return x==="assert"?new Ir(v,[m]):x==="coerce"?new Ai(v,[m]):m}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=t[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[m];if(v){let x=v.parse(t,this);if(!x)return null;if(this.expectedType){const I=this.expectedType,M=x.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||M.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string")if(I.kind!=="padding"||M.kind!=="value"&&M.kind!=="number"&&M.kind!=="array")if(I.kind!=="variableAnchorOffsetCollection"||M.kind!=="value"&&M.kind!=="array"){if(this.checkSubtype(I,M))return null}else x=u(x,I,r.typeAnnotation||"coerce");else x=u(x,I,r.typeAnnotation||"coerce");else x=u(x,I,r.typeAnnotation||"coerce");else x=u(x,I,r.typeAnnotation||"assert")}if(!(x instanceof ms)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const I=new Wo;try{x=new ms(x.type,x.evaluate(I))}catch(M){return this.error(M.message),null}}return x}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,u){const m=typeof t=="number"?this.path.concat(t):this.path,v=u?this.scope.concat(u):this.scope;return new Nr(this.registry,this._isConstant,m,r||null,v,this.errors)}error(t,...r){const u=`${this.key}${r.map((m=>`[${m}]`)).join("")}`;this.errors.push(new dn(u,t))}checkSubtype(t,r){const u=se(t,r);return u&&this.error(u),u}}class oa{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const u=[];for(let v=1;v<t.length-1;v+=2){const x=t[v];if(typeof x!="string")return r.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return r.error("Variable names must contain only alphanumeric characters or '_'.",v);const I=r.parse(t[v+1],v+1);if(!I)return null;u.push([x,I])}const m=r.parse(t[t.length-1],t.length-1,r.expectedType,u);return m?new oa(u,m):null}outputDefined(){return this.result.outputDefined()}}class Vn{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const u=t[1];return r.scope.has(u)?new Vn(u,r.scope.get(u)):r.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Xa{constructor(t,r,u){this.type=t,this.index=r,this.input=u}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=r.parse(t[1],1,_t),m=r.parse(t[2],2,Y(r.expectedType||pn));return u&&m?new Xa(m.type.itemType,u,m):null}evaluate(t){const r=this.index.evaluate(t),u=this.input.evaluate(t);if(r<0)throw new Bi(`Array index out of bounds: ${r} < 0.`);if(r>=u.length)throw new Bi(`Array index out of bounds: ${r} > ${u.length-1}.`);if(r!==Math.floor(r))throw new Bi(`Array index must be an integer, but found ${r} instead.`);return u[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class au{constructor(t,r){this.type=dt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=r.parse(t[1],1,pn),m=r.parse(t[2],2,pn);return u&&m?Ee(u.type,[dt,In,_t,Pa,pn])?new au(u,m):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${W(u.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!Me(r,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${W(Xn(r))} instead.`);if(!Me(u,["string","array"]))throw new Bi(`Expected second argument to be of type array or string, but found ${W(Xn(u))} instead.`);return u.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class la{constructor(t,r,u){this.type=_t,this.needle=t,this.haystack=r,this.fromIndex=u}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=r.parse(t[1],1,pn),m=r.parse(t[2],2,pn);if(!u||!m)return null;if(!Ee(u.type,[dt,In,_t,Pa,pn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${W(u.type)} instead`);if(t.length===4){const v=r.parse(t[3],3,_t);return v?new la(u,m,v):null}return new la(u,m)}evaluate(t){const r=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Me(r,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${W(Xn(r))} instead.`);let m;if(this.fromIndex&&(m=this.fromIndex.evaluate(t)),Me(u,["string"])){const v=u.indexOf(r,m);return v===-1?-1:[...u.slice(0,v)].length}if(Me(u,["array"]))return u.indexOf(r,m);throw new Bi(`Expected second argument to be of type array or string, but found ${W(Xn(u))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class qn{constructor(t,r,u,m,v,x){this.inputType=t,this.type=r,this.input=u,this.cases=m,this.outputs=v,this.otherwise=x}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let u,m;r.expectedType&&r.expectedType.kind!=="value"&&(m=r.expectedType);const v={},x=[];for(let z=2;z<t.length-1;z+=2){let V=t[z];const G=t[z+1];Array.isArray(V)||(V=[V]);const X=r.concat(z);if(V.length===0)return X.error("Expected at least one branch label.");for(const ie of V){if(typeof ie!="number"&&typeof ie!="string")return X.error("Branch labels must be numbers or strings.");if(typeof ie=="number"&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return X.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ie=="number"&&Math.floor(ie)!==ie)return X.error("Numeric branch labels must be integer values.");if(u){if(X.checkSubtype(u,Xn(ie)))return null}else u=Xn(ie);if(v[String(ie)]!==void 0)return X.error("Branch labels must be unique.");v[String(ie)]=x.length}const J=r.parse(G,z,m);if(!J)return null;m=m||J.type,x.push(J)}const I=r.parse(t[1],1,pn);if(!I)return null;const M=r.parse(t[t.length-1],t.length-1,m);return M?I.type.kind!=="value"&&r.concat(1).checkSubtype(u,I.type)?null:new qn(u,m,I,v,x,M):null}evaluate(t){const r=this.input.evaluate(t);return(Xn(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class Po{constructor(t,r,u){this.type=t,this.branches=r,this.otherwise=u}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const m=[];for(let x=1;x<t.length-1;x+=2){const I=r.parse(t[x],x,dt);if(!I)return null;const M=r.parse(t[x+1],x+1,u);if(!M)return null;m.push([I,M]),u=u||M.type}const v=r.parse(t[t.length-1],t.length-1,u);if(!v)return null;if(!u)throw new Error("Can't infer output type");return new Po(u,m,v)}evaluate(t){for(const[r,u]of this.branches)if(r.evaluate(t))return u.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,u]of this.branches)t(r),t(u);t(this.otherwise)}outputDefined(){return this.branches.every((([t,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}}class Mo{constructor(t,r,u,m){this.type=t,this.input=r,this.beginIndex=u,this.endIndex=m}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=r.parse(t[1],1,pn),m=r.parse(t[2],2,_t);if(!u||!m)return null;if(!Ee(u.type,[Y(pn),In,pn]))return r.error(`Expected first argument to be of type array or string, but found ${W(u.type)} instead`);if(t.length===4){const v=r.parse(t[3],3,_t);return v?new Mo(u.type,u,m,v):null}return new Mo(u.type,u,m)}evaluate(t){const r=this.input.evaluate(t),u=this.beginIndex.evaluate(t);let m;if(this.endIndex&&(m=this.endIndex.evaluate(t)),Me(r,["string"]))return[...r].slice(u,m).join("");if(Me(r,["array"]))return r.slice(u,m);throw new Bi(`Expected first argument to be of type array or string, but found ${W(Xn(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Wa(n,t){const r=n.length-1;let u,m,v=0,x=r,I=0;for(;v<=x;)if(I=Math.floor((v+x)/2),u=n[I],m=n[I+1],u<=t){if(I===r||t<m)return I;v=I+1}else{if(!(u>t))throw new Bi("Input is not a number.");x=I-1}return 0}class Ya{constructor(t,r,u){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[m,v]of u)this.labels.push(m),this.outputs.push(v)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const u=r.parse(t[1],1,_t);if(!u)return null;const m=[];let v=null;r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType);for(let x=1;x<t.length;x+=2){const I=x===1?-1/0:t[x],M=t[x+1],z=x,V=x+1;if(typeof I!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(m.length&&m[m.length-1][0]>=I)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const G=r.parse(M,V,v);if(!G)return null;v=v||G.type,m.push([I,G])}return new Ya(v,u,m)}evaluate(t){const r=this.labels,u=this.outputs;if(r.length===1)return u[0].evaluate(t);const m=this.input.evaluate(t);if(m<=r[0])return u[0].evaluate(t);const v=r.length;return m>=r[v-1]?u[v-1].evaluate(t):u[Wa(r,m)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Yo(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var mi=Rs;function Rs(n,t,r,u){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(u-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=r,this.p2y=u}Rs.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,u=0;u<8;u++){var m=this.sampleCurveX(r)-n;if(Math.abs(m)<t)return r;var v=this.sampleCurveDerivativeX(r);if(Math.abs(v)<1e-6)break;r-=m/v}var x=0,I=1;for(r=n,u=0;u<20&&(m=this.sampleCurveX(r),!(Math.abs(m-n)<t));u++)n>m?x=r:I=r,r=.5*(I-x)+x;return r},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var yl=Yo(mi);function _r(n,t,r){return n+r*(t-n)}function Ii(n,t,r){return n.map(((u,m)=>_r(u,t[m],r)))}const Wn={number:_r,color:function(n,t,r,u="rgb"){switch(u){case"rgb":{const[m,v,x,I]=Ii(n.rgb,t.rgb,r);return new hn(m,v,x,I,!1)}case"hcl":{const[m,v,x,I]=n.hcl,[M,z,V,G]=t.hcl;let X,J;if(isNaN(m)||isNaN(M))isNaN(m)?isNaN(M)?X=NaN:(X=M,x!==1&&x!==0||(J=z)):(X=m,V!==1&&V!==0||(J=v));else{let Ue=M-m;M>m&&Ue>180?Ue-=360:M<m&&m-M>180&&(Ue+=360),X=m+r*Ue}const[ie,le,ye,be]=(function([Ue,Ie,Be,Qe]){return Ue=isNaN(Ue)?0:Ue*Jt,ti([Be,Math.cos(Ue)*Ie,Math.sin(Ue)*Ie,Qe])})([X,J??_r(v,z,r),_r(x,V,r),_r(I,G,r)]);return new hn(ie,le,ye,be,!1)}case"lab":{const[m,v,x,I]=ti(Ii(n.lab,t.lab,r));return new hn(m,v,x,I,!1)}}},array:Ii,padding:function(n,t,r){return new rr(Ii(n.values,t.values,r))},variableAnchorOffsetCollection:function(n,t,r){const u=n.values,m=t.values;if(u.length!==m.length)throw new Bi(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${t.toString()}`);const v=[];for(let x=0;x<u.length;x+=2){if(u[x]!==m[x])throw new Bi(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${u[x]}, to[${x}]: ${m[x]}`);v.push(u[x]);const[I,M]=u[x+1],[z,V]=m[x+1];v.push([_r(I,z,r),_r(M,V,r)])}return new Ei(v)}};class ji{constructor(t,r,u,m,v){this.type=t,this.operator=r,this.interpolation=u,this.input=m,this.labels=[],this.outputs=[];for(const[x,I]of v)this.labels.push(x),this.outputs.push(I)}static interpolationFactor(t,r,u,m){let v=0;if(t.name==="exponential")v=La(r,t.base,u,m);else if(t.name==="linear")v=La(r,1,u,m);else if(t.name==="cubic-bezier"){const x=t.controlPoints;v=new yl(x[0],x[1],x[2],x[3]).solve(La(r,1,u,m))}return v}static parse(t,r){let[u,m,v,...x]=t;if(!Array.isArray(m)||m.length===0)return r.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const z=m[1];if(typeof z!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:z}}else{if(m[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const z=m.slice(1);if(z.length!==4||z.some((V=>typeof V!="number"||V<0||V>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:z}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(v=r.parse(v,2,_t),!v)return null;const I=[];let M=null;u==="interpolate-hcl"||u==="interpolate-lab"?M=mr:r.expectedType&&r.expectedType.kind!=="value"&&(M=r.expectedType);for(let z=0;z<x.length;z+=2){const V=x[z],G=x[z+1],X=z+3,J=z+4;if(typeof V!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',X);if(I.length&&I[I.length-1][0]>=V)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',X);const ie=r.parse(G,J,M);if(!ie)return null;M=M||ie.type,I.push([V,ie])}return Oe(M,_t)||Oe(M,mr)||Oe(M,Mi)||Oe(M,_e)||Oe(M,Y(_t))?new ji(M,u,m,v,I):r.error(`Type ${W(M)} is not interpolatable.`)}evaluate(t){const r=this.labels,u=this.outputs;if(r.length===1)return u[0].evaluate(t);const m=this.input.evaluate(t);if(m<=r[0])return u[0].evaluate(t);const v=r.length;if(m>=r[v-1])return u[v-1].evaluate(t);const x=Wa(r,m),I=ji.interpolationFactor(this.interpolation,m,r[x],r[x+1]),M=u[x].evaluate(t),z=u[x+1].evaluate(t);switch(this.operator){case"interpolate":return Wn[this.type.kind](M,z,I);case"interpolate-hcl":return Wn.color(M,z,I,"hcl");case"interpolate-lab":return Wn.color(M,z,I,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function La(n,t,r,u){const m=u-r,v=n-r;return m===0?0:t===1?v/m:(Math.pow(t,v)-1)/(Math.pow(t,m)-1)}class gs{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let u=null;const m=r.expectedType;m&&m.kind!=="value"&&(u=m);const v=[];for(const I of t.slice(1)){const M=r.parse(I,1+v.length,u,void 0,{typeAnnotation:"omit"});if(!M)return null;u=u||M.type,v.push(M)}if(!u)throw new Error("No output type");const x=m&&v.some((I=>se(m,I.type)));return new gs(x?pn:u,v)}evaluate(t){let r,u=null,m=0;for(const v of this.args)if(m++,u=v.evaluate(t),u&&u instanceof Fi&&!u.available&&(r||(r=u.name),u=null,m===this.args.length&&(u=r)),u!==null)break;return u}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Ko(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Ao(n,t,r,u){return u.compare(t,r)===0}function Ns(n,t,r){const u=n!=="=="&&n!=="!=";return class uy{constructor(v,x,I){this.type=dt,this.lhs=v,this.rhs=x,this.collator=I,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const I=v[0];let M=x.parse(v[1],1,pn);if(!M)return null;if(!Ko(I,M.type))return x.concat(1).error(`"${I}" comparisons are not supported for type '${W(M.type)}'.`);let z=x.parse(v[2],2,pn);if(!z)return null;if(!Ko(I,z.type))return x.concat(2).error(`"${I}" comparisons are not supported for type '${W(z.type)}'.`);if(M.type.kind!==z.type.kind&&M.type.kind!=="value"&&z.type.kind!=="value")return x.error(`Cannot compare types '${W(M.type)}' and '${W(z.type)}'.`);u&&(M.type.kind==="value"&&z.type.kind!=="value"?M=new Ir(z.type,[M]):M.type.kind!=="value"&&z.type.kind==="value"&&(z=new Ir(M.type,[z])));let V=null;if(v.length===4){if(M.type.kind!=="string"&&z.type.kind!=="string"&&M.type.kind!=="value"&&z.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(V=x.parse(v[3],3,ki),!V)return null}return new uy(M,z,V)}evaluate(v){const x=this.lhs.evaluate(v),I=this.rhs.evaluate(v);if(u&&this.hasUntypedArgument){const M=Xn(x),z=Xn(I);if(M.kind!==z.kind||M.kind!=="string"&&M.kind!=="number")throw new Bi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${M.kind}, ${z.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const M=Xn(x),z=Xn(I);if(M.kind!=="string"||z.kind!=="string")return t(v,x,I)}return this.collator?r(v,x,I,this.collator.evaluate(v)):t(v,x,I)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const Lu=Ns("==",(function(n,t,r){return t===r}),Ao),Hn=Ns("!=",(function(n,t,r){return t!==r}),(function(n,t,r,u){return!Ao(0,t,r,u)})),Dr=Ns("<",(function(n,t,r){return t<r}),(function(n,t,r,u){return u.compare(t,r)<0})),_l=Ns(">",(function(n,t,r){return t>r}),(function(n,t,r,u){return u.compare(t,r)>0})),Ru=Ns("<=",(function(n,t,r){return t<=r}),(function(n,t,r,u){return u.compare(t,r)<=0})),Ds=Ns(">=",(function(n,t,r){return t>=r}),(function(n,t,r,u){return u.compare(t,r)>=0}));class zs{constructor(t,r,u){this.type=ki,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const u=t[1];if(typeof u!="object"||Array.isArray(u))return r.error("Collator options argument must be an object.");const m=r.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,dt);if(!m)return null;const v=r.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,dt);if(!v)return null;let x=null;return u.locale&&(x=r.parse(u.locale,1,In),!x)?null:new zs(m,v,x)}evaluate(t){return new Za(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Li{constructor(t,r,u,m,v){this.type=In,this.number=t,this.locale=r,this.currency=u,this.minFractionDigits=m,this.maxFractionDigits=v}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const u=r.parse(t[1],1,_t);if(!u)return null;const m=t[2];if(typeof m!="object"||Array.isArray(m))return r.error("NumberFormat options argument must be an object.");let v=null;if(m.locale&&(v=r.parse(m.locale,1,In),!v))return null;let x=null;if(m.currency&&(x=r.parse(m.currency,1,In),!x))return null;let I=null;if(m["min-fraction-digits"]&&(I=r.parse(m["min-fraction-digits"],1,_t),!I))return null;let M=null;return m["max-fraction-digits"]&&(M=r.parse(m["max-fraction-digits"],1,_t),!M)?null:new Li(u,v,x,I,M)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ra{constructor(t){this.type=Sr,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const u=t[1];if(!Array.isArray(u)&&typeof u=="object")return r.error("First argument must be an image or text section.");const m=[];let v=!1;for(let x=1;x<=t.length-1;++x){const I=t[x];if(v&&typeof I=="object"&&!Array.isArray(I)){v=!1;let M=null;if(I["font-scale"]&&(M=r.parse(I["font-scale"],1,_t),!M))return null;let z=null;if(I["text-font"]&&(z=r.parse(I["text-font"],1,Y(In)),!z))return null;let V=null;if(I["text-color"]&&(V=r.parse(I["text-color"],1,mr),!V))return null;const G=m[m.length-1];G.scale=M,G.font=z,G.textColor=V}else{const M=r.parse(t[x],1,pn);if(!M)return null;const z=M.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,m.push({content:M,scale:null,font:null,textColor:null})}}return new Ra(m)}evaluate(t){return new yr(this.sections.map((r=>{const u=r.content.evaluate(t);return Xn(u)===gr?new Ha("",u,null,null,null):new Ha(Xo(u),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)})))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class Jo{constructor(t){this.type=gr,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const u=r.parse(t[1],1,In);return u?new Jo(u):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),u=Fi.fromString(r);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(r)>-1),u}eachChild(t){t(this.input)}outputDefined(){return!1}}class vl{constructor(t){this.type=_t,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const u=r.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${W(u.type)} instead.`):new vl(u):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Bi(`Expected value to be of type string or array, but found ${W(Xn(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Gr=8192;function xl(n,t){const r=(180+n[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,m=Math.pow(2,t.z);return[Math.round(r*m*Gr),Math.round(u*m*Gr)]}function Lo(n,t){const r=Math.pow(2,t.z);return[(m=(n[0]/Gr+t.x)/r,360*m-180),(u=(n[1]/Gr+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90)];var u,m}function vr(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function Ji(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Gn(n,t,r){const u=n[0]-t[0],m=n[1]-t[1],v=n[0]-r[0],x=n[1]-r[1];return u*x-v*m==0&&u*v<=0&&m*x<=0}function Qi(n,t,r,u){return(m=[u[0]-r[0],u[1]-r[1]])[0]*(v=[t[0]-n[0],t[1]-n[1]])[1]-m[1]*v[0]!=0&&!(!Ja(n,t,r,u)||!Ja(r,u,n,t));var m,v}function Ka(n,t,r){for(const u of r)for(let m=0;m<u.length-1;++m)if(Qi(n,t,u[m],u[m+1]))return!0;return!1}function ua(n,t,r=!1){let u=!1;for(const I of t)for(let M=0;M<I.length-1;M++){if(Gn(n,I[M],I[M+1]))return r;(v=I[M])[1]>(m=n)[1]!=(x=I[M+1])[1]>m[1]&&m[0]<(x[0]-v[0])*(m[1]-v[1])/(x[1]-v[1])+v[0]&&(u=!u)}var m,v,x;return u}function ca(n,t){for(const r of t)if(ua(n,r))return!0;return!1}function wl(n,t){for(const r of n)if(!ua(r,t))return!1;for(let r=0;r<n.length-1;++r)if(Ka(n[r],n[r+1],t))return!1;return!0}function er(n,t){for(const r of t)if(wl(n,r))return!0;return!1}function Ja(n,t,r,u){const m=u[0]-r[0],v=u[1]-r[1],x=(n[0]-r[0])*v-m*(n[1]-r[1]),I=(t[0]-r[0])*v-m*(t[1]-r[1]);return x>0&&I<0||x<0&&I>0}function zr(n,t,r){const u=[];for(let m=0;m<n.length;m++){const v=[];for(let x=0;x<n[m].length;x++){const I=xl(n[m][x],r);vr(t,I),v.push(I)}u.push(v)}return u}function Qa(n,t,r){const u=[];for(let m=0;m<n.length;m++){const v=zr(n[m],t,r);u.push(v)}return u}function Nu(n,t,r,u){if(n[0]<r[0]||n[0]>r[2]){const m=.5*u;let v=n[0]-r[0]>m?-u:r[0]-n[0]>m?u:0;v===0&&(v=n[0]-r[2]>m?-u:r[2]-n[0]>m?u:0),n[0]+=v}vr(t,n)}function bl(n,t,r,u){const m=Math.pow(2,u.z)*Gr,v=[u.x*Gr,u.y*Gr],x=[];for(const I of n)for(const M of I){const z=[M.x+v[0],M.y+v[1]];Nu(z,t,r,m),x.push(z)}return x}function kl(n,t,r,u){const m=Math.pow(2,u.z)*Gr,v=[u.x*Gr,u.y*Gr],x=[];for(const M of n){const z=[];for(const V of M){const G=[V.x+v[0],V.y+v[1]];vr(t,G),z.push(G)}x.push(z)}if(t[2]-t[0]<=m/2){(I=t)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const M of x)for(const z of M)Nu(z,t,r,m)}var I;return x}class ys{constructor(t,r){this.type=dt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Qr(t[1])){const u=t[1];if(u.type==="FeatureCollection"){const m=[];for(const v of u.features){const{type:x,coordinates:I}=v.geometry;x==="Polygon"&&m.push(I),x==="MultiPolygon"&&m.push(...I)}if(m.length)return new ys(u,{type:"MultiPolygon",coordinates:m})}else if(u.type==="Feature"){const m=u.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new ys(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new ys(u,u)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,u){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=r.canonicalID();if(u.type==="Polygon"){const I=zr(u.coordinates,v,x),M=bl(r.geometry(),m,v,x);if(!Ji(m,v))return!1;for(const z of M)if(!ua(z,I))return!1}if(u.type==="MultiPolygon"){const I=Qa(u.coordinates,v,x),M=bl(r.geometry(),m,v,x);if(!Ji(m,v))return!1;for(const z of M)if(!ca(z,I))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,u){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=r.canonicalID();if(u.type==="Polygon"){const I=zr(u.coordinates,v,x),M=kl(r.geometry(),m,v,x);if(!Ji(m,v))return!1;for(const z of M)if(!wl(z,I))return!1}if(u.type==="MultiPolygon"){const I=Qa(u.coordinates,v,x),M=kl(r.geometry(),m,v,x);if(!Ji(m,v))return!1;for(const z of M)if(!er(z,I))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Qo=class{constructor(n=[],t=((r,u)=>r<u?-1:r>u?1:0)){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:r}=this,u=t[n];for(;n>0;){const m=n-1>>1,v=t[m];if(r(u,v)>=0)break;t[n]=v,n=m}t[n]=u}_down(n){const{data:t,compare:r}=this,u=this.length>>1,m=t[n];for(;n<u;){let v=1+(n<<1);const x=v+1;if(x<this.length&&r(t[x],t[v])<0&&(v=x),r(t[v],m)>=0)break;t[n]=t[v],n=v}t[n]=m}};function Du(n,t,r,u,m){zu(n,t,r,u||n.length-1,m||$r)}function zu(n,t,r,u,m){for(;u>r;){if(u-r>600){var v=u-r+1,x=t-r+1,I=Math.log(v),M=.5*Math.exp(2*I/3),z=.5*Math.sqrt(I*M*(v-M)/v)*(x-v/2<0?-1:1);zu(n,t,Math.max(r,Math.floor(t-x*M/v+z)),Math.min(u,Math.floor(t+(v-x)*M/v+z)),m)}var V=n[t],G=r,X=u;for(_s(n,r,t),m(n[u],V)>0&&_s(n,r,u);G<X;){for(_s(n,G,X),G++,X--;m(n[G],V)<0;)G++;for(;m(n[X],V)>0;)X--}m(n[r],V)===0?_s(n,r,X):_s(n,++X,u),X<=t&&(r=X+1),t<=X&&(u=X-1)}}function _s(n,t,r){var u=n[t];n[t]=n[r],n[r]=u}function $r(n,t){return n<t?-1:n>t?1:0}function Ro(n,t){if(n.length<=1)return[n];const r=[];let u,m;for(const v of n){const x=fc(v);x!==0&&(v.area=Math.abs(x),m===void 0&&(m=x<0),m===x<0?(u&&r.push(u),u=[v]):u.push(v))}if(u&&r.push(u),t>1)for(let v=0;v<r.length;v++)r[v].length<=t||(Du(r[v],t,1,r[v].length-1,Ou),r[v]=r[v].slice(0,t));return r}function Ou(n,t){return t.area-n.area}function fc(n){let t=0;for(let r,u,m=0,v=n.length,x=v-1;m<v;x=m++)r=n[m],u=n[x],t+=(u.x-r.x)*(r.y+u.y);return t}const Sl=1/298.257223563,ou=Sl*(2-Sl),El=Math.PI/180;class el{constructor(t){const r=6378.137*El*1e3,u=Math.cos(t*El),m=1/(1-ou*(1-u*u)),v=Math.sqrt(m);this.kx=r*v*u,this.ky=r*v*m*(1-ou)}distance(t,r){const u=this.wrap(t[0]-r[0])*this.kx,m=(t[1]-r[1])*this.ky;return Math.sqrt(u*u+m*m)}pointOnLine(t,r){let u,m,v,x,I=1/0;for(let M=0;M<t.length-1;M++){let z=t[M][0],V=t[M][1],G=this.wrap(t[M+1][0]-z)*this.kx,X=(t[M+1][1]-V)*this.ky,J=0;G===0&&X===0||(J=(this.wrap(r[0]-z)*this.kx*G+(r[1]-V)*this.ky*X)/(G*G+X*X),J>1?(z=t[M+1][0],V=t[M+1][1]):J>0&&(z+=G/this.kx*J,V+=X/this.ky*J)),G=this.wrap(r[0]-z)*this.kx,X=(r[1]-V)*this.ky;const ie=G*G+X*X;ie<I&&(I=ie,u=z,m=V,v=M,x=J)}return{point:[u,m],index:v,t:Math.max(0,Math.min(1,x))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function es(n,t){return t[0]-n[0]}function tl(n){return n[1]-n[0]+1}function Ui(n,t){return n[1]>=n[0]&&n[1]<t}function eo(n,t){if(n[0]>n[1])return[null,null];const r=tl(n);if(t){if(r===2)return[n,null];const m=Math.floor(r/2);return[[n[0],n[0]+m],[n[0]+m,n[1]]]}if(r===1)return[n,null];const u=Math.floor(r/2)-1;return[[n[0],n[0]+u],[n[0]+u+1,n[1]]]}function nl(n,t){if(!Ui(t,n.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let u=t[0];u<=t[1];++u)vr(r,n[u]);return r}function Il(n){const t=[1/0,1/0,-1/0,-1/0];for(const r of n)for(const u of r)vr(t,u);return t}function il(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Tl(n,t,r){if(!il(n)||!il(t))return NaN;let u=0,m=0;return n[2]<t[0]&&(u=t[0]-n[2]),n[0]>t[2]&&(u=n[0]-t[2]),n[1]>t[3]&&(m=n[1]-t[3]),n[3]<t[1]&&(m=t[1]-n[3]),r.distance([0,0],[u,m])}function Os(n,t,r){const u=r.pointOnLine(t,n);return r.distance(n,u.point)}function lu(n,t,r,u,m){const v=Math.min(Os(n,[r,u],m),Os(t,[r,u],m)),x=Math.min(Os(r,[n,t],m),Os(u,[n,t],m));return Math.min(v,x)}function dc(n,t,r,u,m){if(!Ui(t,n.length)||!Ui(u,r.length))return 1/0;let v=1/0;for(let x=t[0];x<t[1];++x){const I=n[x],M=n[x+1];for(let z=u[0];z<u[1];++z){const V=r[z],G=r[z+1];if(Qi(I,M,V,G))return 0;v=Math.min(v,lu(I,M,V,G,m))}}return v}function Ri(n,t,r,u,m){if(!Ui(t,n.length)||!Ui(u,r.length))return NaN;let v=1/0;for(let x=t[0];x<=t[1];++x)for(let I=u[0];I<=u[1];++I)if(v=Math.min(v,m.distance(n[x],r[I])),v===0)return v;return v}function pc(n,t,r){if(ua(n,t,!0))return 0;let u=1/0;for(const m of t){const v=m[0],x=m[m.length-1];if(v!==x&&(u=Math.min(u,Os(n,[x,v],r)),u===0))return u;const I=r.pointOnLine(m,n);if(u=Math.min(u,r.distance(n,I.point)),u===0)return u}return u}function Mn(n,t,r,u){if(!Ui(t,n.length))return NaN;for(let v=t[0];v<=t[1];++v)if(ua(n[v],r,!0))return 0;let m=1/0;for(let v=t[0];v<t[1];++v){const x=n[v],I=n[v+1];for(const M of r)for(let z=0,V=M.length,G=V-1;z<V;G=z++){const X=M[G],J=M[z];if(Qi(x,I,X,J))return 0;m=Math.min(m,lu(x,I,X,J,u))}}return m}function Cl(n,t){for(const r of n)for(const u of r)if(ua(u,t,!0))return!0;return!1}function oi(n,t,r,u=1/0){const m=Il(n),v=Il(t);if(u!==1/0&&Tl(m,v,r)>=u)return u;if(Ji(m,v)){if(Cl(n,t))return 0}else if(Cl(t,n))return 0;let x=1/0;for(const I of n)for(let M=0,z=I.length,V=z-1;M<z;V=M++){const G=I[V],X=I[M];for(const J of t)for(let ie=0,le=J.length,ye=le-1;ie<le;ye=ie++){const be=J[ye],Ue=J[ie];if(Qi(G,X,be,Ue))return 0;x=Math.min(x,lu(G,X,be,Ue,r))}}return x}function Jn(n,t,r,u,m,v){if(!v)return;const x=Tl(nl(u,v),m,r);x<t&&n.push([x,v,[0,0]])}function ts(n,t,r,u,m,v,x){if(!v||!x)return;const I=Tl(nl(u,v),nl(m,x),r);I<t&&n.push([I,v,x])}function rl(n,t,r,u,m=1/0){let v=Math.min(u.distance(n[0],r[0][0]),m);if(v===0)return v;const x=new Qo([[0,[0,n.length-1],[0,0]]],es),I=Il(r);for(;x.length>0;){const M=x.pop();if(M[0]>=v)continue;const z=M[1],V=t?50:100;if(tl(z)<=V){if(!Ui(z,n.length))return NaN;if(t){const G=Mn(n,z,r,u);if(isNaN(G)||G===0)return G;v=Math.min(v,G)}else for(let G=z[0];G<=z[1];++G){const X=pc(n[G],r,u);if(v=Math.min(v,X),v===0)return 0}}else{const G=eo(z,t);Jn(x,v,u,n,I,G[0]),Jn(x,v,u,n,I,G[1])}}return v}function to(n,t,r,u,m,v=1/0){let x=Math.min(v,m.distance(n[0],r[0]));if(x===0)return x;const I=new Qo([[0,[0,n.length-1],[0,r.length-1]]],es);for(;I.length>0;){const M=I.pop();if(M[0]>=x)continue;const z=M[1],V=M[2],G=t?50:100,X=u?50:100;if(tl(z)<=G&&tl(V)<=X){if(!Ui(z,n.length)&&Ui(V,r.length))return NaN;let J;if(t&&u)J=dc(n,z,r,V,m),x=Math.min(x,J);else if(t&&!u){const ie=n.slice(z[0],z[1]+1);for(let le=V[0];le<=V[1];++le)if(J=Os(r[le],ie,m),x=Math.min(x,J),x===0)return x}else if(!t&&u){const ie=r.slice(V[0],V[1]+1);for(let le=z[0];le<=z[1];++le)if(J=Os(n[le],ie,m),x=Math.min(x,J),x===0)return x}else J=Ri(n,z,r,V,m),x=Math.min(x,J)}else{const J=eo(z,t),ie=eo(V,u);ts(I,x,m,n,r,J[0],ie[0]),ts(I,x,m,n,r,J[0],ie[1]),ts(I,x,m,n,r,J[1],ie[0]),ts(I,x,m,n,r,J[1],ie[1])}}return x}function Pl(n){return n.type==="MultiPolygon"?n.coordinates.map((t=>({type:"Polygon",coordinates:t}))):n.type==="MultiLineString"?n.coordinates.map((t=>({type:"LineString",coordinates:t}))):n.type==="MultiPoint"?n.coordinates.map((t=>({type:"Point",coordinates:t}))):[n]}class Na{constructor(t,r){this.type=_t,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Qr(t[1])){const u=t[1];if(u.type==="FeatureCollection")return new Na(u,u.features.map((m=>Pl(m.geometry))).flat());if(u.type==="Feature")return new Na(u,Pl(u.geometry));if("type"in u&&"coordinates"in u)return new Na(u,Pl(u))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,u){const m=r.geometry(),v=m.flat().map((M=>Lo([M.x,M.y],r.canonical)));if(m.length===0)return NaN;const x=new el(v[0][1]);let I=1/0;for(const M of u){switch(M.type){case"Point":I=Math.min(I,to(v,!1,[M.coordinates],!1,x,I));break;case"LineString":I=Math.min(I,to(v,!1,M.coordinates,!0,x,I));break;case"Polygon":I=Math.min(I,rl(v,!1,M.coordinates,x,I))}if(I===0)return I}return I})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,u){const m=r.geometry(),v=m.flat().map((M=>Lo([M.x,M.y],r.canonical)));if(m.length===0)return NaN;const x=new el(v[0][1]);let I=1/0;for(const M of u){switch(M.type){case"Point":I=Math.min(I,to(v,!0,[M.coordinates],!1,x,I));break;case"LineString":I=Math.min(I,to(v,!0,M.coordinates,!0,x,I));break;case"Polygon":I=Math.min(I,rl(v,!0,M.coordinates,x,I))}if(I===0)return I}return I})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(r,u){const m=r.geometry();if(m.length===0||m[0].length===0)return NaN;const v=Ro(m,0).map((M=>M.map((z=>z.map((V=>Lo([V.x,V.y],r.canonical))))))),x=new el(v[0][0][0][1]);let I=1/0;for(const M of u)for(const z of v){switch(M.type){case"Point":I=Math.min(I,rl([M.coordinates],!1,z,x,I));break;case"LineString":I=Math.min(I,rl(M.coordinates,!0,z,x,I));break;case"Polygon":I=Math.min(I,oi(z,M.coordinates,x,I))}if(I===0)return I}return I})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const no={"==":Lu,"!=":Hn,">":_l,"<":Dr,">=":Ds,"<=":Ru,array:Ir,at:Xa,boolean:Ir,case:Po,coalesce:gs,collator:zs,format:Ra,image:Jo,in:au,"index-of":la,interpolate:ji,"interpolate-hcl":ji,"interpolate-lab":ji,length:vl,let:oa,literal:ms,match:qn,number:Ir,"number-format":Li,object:Ir,slice:Mo,step:Ya,string:Ir,"to-boolean":Ai,"to-color":Ai,"to-number":Ai,"to-string":Ai,var:Vn,within:ys,distance:Na};class Zr{constructor(t,r,u,m){this.name=t,this.type=r,this._evaluate=u,this.args=m}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const u=t[0],m=Zr.definitions[u];if(!m)return r.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(m)?m[0]:m.type,x=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,I=x.filter((([z])=>!Array.isArray(z)||z.length===t.length-1));let M=null;for(const[z,V]of I){M=new Nr(r.registry,io,r.path,null,r.scope);const G=[];let X=!1;for(let J=1;J<t.length;J++){const ie=t[J],le=Array.isArray(z)?z[J-1]:z.type,ye=M.parse(ie,1+G.length,le);if(!ye){X=!0;break}G.push(ye)}if(!X)if(Array.isArray(z)&&z.length!==G.length)M.error(`Expected ${z.length} arguments, but found ${G.length} instead.`);else{for(let J=0;J<G.length;J++){const ie=Array.isArray(z)?z[J]:z.type,le=G[J];M.concat(J+1).checkSubtype(ie,le.type)}if(M.errors.length===0)return new Zr(u,v,V,G)}}if(I.length===1)r.errors.push(...M.errors);else{const z=(I.length?I:x).map((([G])=>{return X=G,Array.isArray(X)?`(${X.map(W).join(", ")})`:`(${W(X.type)}...)`;var X})).join(" | "),V=[];for(let G=1;G<t.length;G++){const X=r.parse(t[G],1+V.length);if(!X)return null;V.push(W(X.type))}r.error(`Expected arguments of type ${z}, but found (${V.join(", ")}) instead.`)}return null}static register(t,r){Zr.definitions=r;for(const u in r)t[u]=Zr}}function Da(n,[t,r,u,m]){t=t.evaluate(n),r=r.evaluate(n),u=u.evaluate(n);const v=m?m.evaluate(n):1,x=sr(t,r,u,v);if(x)throw new Bi(x);return new hn(t/255,r/255,u/255,v,!1)}function uu(n,t){return n in t}function cu(n,t){const r=t[n];return r===void 0?null:r}function za(n){return{type:n}}function io(n){if(n instanceof Vn)return io(n.boundExpression);if(n instanceof Zr&&n.name==="error"||n instanceof zs||n instanceof ys||n instanceof Na)return!1;const t=n instanceof Ai||n instanceof Ir;let r=!0;return n.eachChild((u=>{r=t?r&&io(u):r&&u instanceof ms})),!!r&&ro(n)&&Bs(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ro(n){if(n instanceof Zr&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof ys||n instanceof Na)return!1;let t=!0;return n.eachChild((r=>{t&&!ro(r)&&(t=!1)})),t}function Fs(n){if(n instanceof Zr&&n.name==="feature-state")return!1;let t=!0;return n.eachChild((r=>{t&&!Fs(r)&&(t=!1)})),t}function Bs(n,t){if(n instanceof Zr&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild((u=>{r&&!Bs(u,t)&&(r=!1)})),r}function No(n){return{result:"success",value:n}}function ha(n){return{result:"error",value:n}}function so(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Ml(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function sl(n){return!!n.expression&&n.expression.interpolated}function jn(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function js(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Fu(n){return n}function Al(n,t){const r=t.type==="color",u=n.stops&&typeof n.stops[0][0]=="object",m=u||!(u||n.property!==void 0),v=n.type||(sl(t)?"exponential":"interval");if(r||t.type==="padding"){const V=r?hn.parse:rr.parse;(n=Vr({},n)).stops&&(n.stops=n.stops.map((G=>[G[0],V(G[1])]))),n.default=V(n.default?n.default:t.default)}if(n.colorSpace&&(x=n.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var x;let I,M,z;if(v==="exponential")I=i;else if(v==="interval")I=f;else if(v==="categorical"){I=vs,M=Object.create(null);for(const V of n.stops)M[V[0]]=V[1];z=typeof n.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);I=s}if(u){const V={},G=[];for(let ie=0;ie<n.stops.length;ie++){const le=n.stops[ie],ye=le[0].zoom;V[ye]===void 0&&(V[ye]={zoom:ye,type:n.type,property:n.property,default:n.default,stops:[]},G.push(ye)),V[ye].stops.push([le[0].value,le[1]])}const X=[];for(const ie of G)X.push([V[ie].zoom,Al(V[ie],t)]);const J={name:"linear"};return{kind:"composite",interpolationType:J,interpolationFactor:ji.interpolationFactor.bind(void 0,J),zoomStops:X.map((ie=>ie[0])),evaluate:({zoom:ie},le)=>i({stops:X,base:n.base},t,ie).evaluate(ie,le)}}if(m){const V=v==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:V,interpolationFactor:ji.interpolationFactor.bind(void 0,V),zoomStops:n.stops.map((G=>G[0])),evaluate:({zoom:G})=>I(n,t,G,M,z)}}return{kind:"source",evaluate(V,G){const X=G&&G.properties?G.properties[n.property]:void 0;return X===void 0?ar(n.default,t.default):I(n,t,X,M,z)}}}function ar(n,t,r){return n!==void 0?n:t!==void 0?t:r!==void 0?r:void 0}function vs(n,t,r,u,m){return ar(typeof r===m?u[r]:void 0,n.default,t.default)}function f(n,t,r){if(jn(r)!=="number")return ar(n.default,t.default);const u=n.stops.length;if(u===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[u-1][0])return n.stops[u-1][1];const m=Wa(n.stops.map((v=>v[0])),r);return n.stops[m][1]}function i(n,t,r){const u=n.base!==void 0?n.base:1;if(jn(r)!=="number")return ar(n.default,t.default);const m=n.stops.length;if(m===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[m-1][0])return n.stops[m-1][1];const v=Wa(n.stops.map((V=>V[0])),r),x=(function(V,G,X,J){const ie=J-X,le=V-X;return ie===0?0:G===1?le/ie:(Math.pow(G,le)-1)/(Math.pow(G,ie)-1)})(r,u,n.stops[v][0],n.stops[v+1][0]),I=n.stops[v][1],M=n.stops[v+1][1],z=Wn[t.type]||Fu;return typeof I.evaluate=="function"?{evaluate(...V){const G=I.evaluate.apply(void 0,V),X=M.evaluate.apply(void 0,V);if(G!==void 0&&X!==void 0)return z(G,X,x,n.colorSpace)}}:z(I,M,x,n.colorSpace)}function s(n,t,r){switch(t.type){case"color":r=hn.parse(r);break;case"formatted":r=yr.fromString(r.toString());break;case"resolvedImage":r=Fi.fromString(r.toString());break;case"padding":r=rr.parse(r);break;default:jn(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return ar(r,n.default,t.default)}Zr.register(no,{error:[{kind:"error"},[In],(n,[t])=>{throw new Bi(t.evaluate(n))}],typeof:[In,[pn],(n,[t])=>W(Xn(t.evaluate(n)))],"to-rgba":[Y(_t,4),[mr],(n,[t])=>{const[r,u,m,v]=t.evaluate(n).rgb;return[255*r,255*u,255*m,v]}],rgb:[mr,[_t,_t,_t],Da],rgba:[mr,[_t,_t,_t,_t],Da],has:{type:dt,overloads:[[[In],(n,[t])=>uu(t.evaluate(n),n.properties())],[[In,qr],(n,[t,r])=>uu(t.evaluate(n),r.evaluate(n))]]},get:{type:pn,overloads:[[[In],(n,[t])=>cu(t.evaluate(n),n.properties())],[[In,qr],(n,[t,r])=>cu(t.evaluate(n),r.evaluate(n))]]},"feature-state":[pn,[In],(n,[t])=>cu(t.evaluate(n),n.featureState||{})],properties:[qr,[],n=>n.properties()],"geometry-type":[In,[],n=>n.geometryType()],id:[pn,[],n=>n.id()],zoom:[_t,[],n=>n.globals.zoom],"heatmap-density":[_t,[],n=>n.globals.heatmapDensity||0],"line-progress":[_t,[],n=>n.globals.lineProgress||0],accumulated:[pn,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[_t,za(_t),(n,t)=>{let r=0;for(const u of t)r+=u.evaluate(n);return r}],"*":[_t,za(_t),(n,t)=>{let r=1;for(const u of t)r*=u.evaluate(n);return r}],"-":{type:_t,overloads:[[[_t,_t],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[_t],(n,[t])=>-t.evaluate(n)]]},"/":[_t,[_t,_t],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[_t,[_t,_t],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[_t,[],()=>Math.LN2],pi:[_t,[],()=>Math.PI],e:[_t,[],()=>Math.E],"^":[_t,[_t,_t],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[_t,[_t],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[_t,[_t],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[_t,[_t],(n,[t])=>Math.log(t.evaluate(n))],log2:[_t,[_t],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[_t,[_t],(n,[t])=>Math.sin(t.evaluate(n))],cos:[_t,[_t],(n,[t])=>Math.cos(t.evaluate(n))],tan:[_t,[_t],(n,[t])=>Math.tan(t.evaluate(n))],asin:[_t,[_t],(n,[t])=>Math.asin(t.evaluate(n))],acos:[_t,[_t],(n,[t])=>Math.acos(t.evaluate(n))],atan:[_t,[_t],(n,[t])=>Math.atan(t.evaluate(n))],min:[_t,za(_t),(n,t)=>Math.min(...t.map((r=>r.evaluate(n))))],max:[_t,za(_t),(n,t)=>Math.max(...t.map((r=>r.evaluate(n))))],abs:[_t,[_t],(n,[t])=>Math.abs(t.evaluate(n))],round:[_t,[_t],(n,[t])=>{const r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[_t,[_t],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[_t,[_t],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[dt,[In,pn],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[dt,[pn],(n,[t])=>n.id()===t.value],"filter-type-==":[dt,[In],(n,[t])=>n.geometryType()===t.value],"filter-<":[dt,[In,pn],(n,[t,r])=>{const u=n.properties()[t.value],m=r.value;return typeof u==typeof m&&u<m}],"filter-id-<":[dt,[pn],(n,[t])=>{const r=n.id(),u=t.value;return typeof r==typeof u&&r<u}],"filter->":[dt,[In,pn],(n,[t,r])=>{const u=n.properties()[t.value],m=r.value;return typeof u==typeof m&&u>m}],"filter-id->":[dt,[pn],(n,[t])=>{const r=n.id(),u=t.value;return typeof r==typeof u&&r>u}],"filter-<=":[dt,[In,pn],(n,[t,r])=>{const u=n.properties()[t.value],m=r.value;return typeof u==typeof m&&u<=m}],"filter-id-<=":[dt,[pn],(n,[t])=>{const r=n.id(),u=t.value;return typeof r==typeof u&&r<=u}],"filter->=":[dt,[In,pn],(n,[t,r])=>{const u=n.properties()[t.value],m=r.value;return typeof u==typeof m&&u>=m}],"filter-id->=":[dt,[pn],(n,[t])=>{const r=n.id(),u=t.value;return typeof r==typeof u&&r>=u}],"filter-has":[dt,[pn],(n,[t])=>t.value in n.properties()],"filter-has-id":[dt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[dt,[Y(In)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[dt,[Y(pn)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[dt,[In,Y(pn)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[dt,[In,Y(pn)],(n,[t,r])=>(function(u,m,v,x){for(;v<=x;){const I=v+x>>1;if(m[I]===u)return!0;m[I]>u?x=I-1:v=I+1}return!1})(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:dt,overloads:[[[dt,dt],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[za(dt),(n,t)=>{for(const r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:dt,overloads:[[[dt,dt],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[za(dt),(n,t)=>{for(const r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[dt,[dt],(n,[t])=>!t.evaluate(n)],"is-supported-script":[dt,[In],(n,[t])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[In,[In],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[In,[In],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[In,za(pn),(n,t)=>t.map((r=>Xo(r.evaluate(n)))).join("")],"resolved-locale":[In,[ki],(n,[t])=>t.evaluate(n).resolvedLocale()]});class c{constructor(t,r){var u;this.expression=t,this._warningHistory={},this._evaluator=new Wo,this._defaultValue=r?(u=r).type==="color"&&js(u.default)?new hn(0,0,0,0):u.type==="color"?hn.parse(u.default)||null:u.type==="padding"?rr.parse(u.default)||null:u.type==="variableAnchorOffsetCollection"?Ei.parse(u.default)||null:u.default===void 0?null:u.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,u,m,v,x){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=u,this._evaluator.canonical=m,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(t,r,u,m,v,x){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=u||null,this._evaluator.canonical=m,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new Bi(`Expected value to be one of ${Object.keys(this._enumValues).map((M=>JSON.stringify(M))).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function w(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in no}function L(n,t){const r=new Nr(no,io,[],t?(function(m){const v={color:mr,string:In,number:_t,enum:In,boolean:dt,formatted:Sr,padding:Mi,resolvedImage:gr,variableAnchorOffsetCollection:_e};return m.type==="array"?Y(v[m.value]||pn,m.length):v[m.type]})(t):void 0),u=r.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?No(new c(u,t)):ha(r.errors)}class F{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!Fs(r.expression)}evaluateWithoutErrorHandling(t,r,u,m,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,r,u,m,v,x)}evaluate(t,r,u,m,v,x){return this._styleExpression.evaluate(t,r,u,m,v,x)}}class H{constructor(t,r,u,m){this.kind=t,this.zoomStops=u,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Fs(r.expression),this.interpolationType=m}evaluateWithoutErrorHandling(t,r,u,m,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,r,u,m,v,x)}evaluate(t,r,u,m,v,x){return this._styleExpression.evaluate(t,r,u,m,v,x)}interpolationFactor(t,r,u){return this.interpolationType?ji.interpolationFactor(this.interpolationType,t,r,u):0}}function re(n,t){const r=L(n,t);if(r.result==="error")return r;const u=r.value.expression,m=ro(u);if(!m&&!so(t))return ha([new dn("","data expressions not supported")]);const v=Bs(u,["zoom"]);if(!v&&!Ml(t))return ha([new dn("","zoom expressions not supported")]);const x=De(u);return x||v?x instanceof dn?ha([x]):x instanceof ji&&!sl(t)?ha([new dn("",'"interpolate" expressions cannot be used with this property')]):No(x?new H(m?"camera":"composite",r.value,x.labels,x instanceof ji?x.interpolation:void 0):new F(m?"constant":"source",r.value)):ha([new dn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class fe{constructor(t,r){this._parameters=t,this._specification=r,Vr(this,Al(this._parameters,this._specification))}static deserialize(t){return new fe(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function De(n){let t=null;if(n instanceof oa)t=De(n.result);else if(n instanceof gs){for(const r of n.args)if(t=De(r),t)break}else(n instanceof Ya||n instanceof ji)&&n.input instanceof Zr&&n.input.name==="zoom"&&(t=n);return t instanceof dn||n.eachChild((r=>{const u=De(r);u instanceof dn?t=u:!t&&u?t=new dn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&u&&t!==u&&(t=new dn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function $e(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!$e(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const ut={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function At(n){if(n==null)return{filter:()=>!0,needGeometry:!1};$e(n)||(n=Nn(n));const t=L(n,ut);if(t.result==="error")throw new Error(t.value.map((r=>`${r.key}: ${r.message}`)).join(", "));return{filter:(r,u,m)=>t.value.evaluate(r,u,{},m),needGeometry:on(n)}}function Gt(n,t){return n<t?-1:n>t?1:0}function on(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(on(n[t]))return!0;return!1}function Nn(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?An(n[1],n[2],"=="):t==="!="?Yn(An(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?An(n[1],n[2],t):t==="any"?(r=n.slice(1),["any"].concat(r.map(Nn))):t==="all"?["all"].concat(n.slice(1).map(Nn)):t==="none"?["all"].concat(n.slice(1).map(Nn).map(Yn)):t==="in"?Un(n[1],n.slice(2)):t==="!in"?Yn(Un(n[1],n.slice(2))):t==="has"?Ti(n[1]):t!=="!has"||Yn(Ti(n[1]));var r}function An(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function Un(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((r=>typeof r!=typeof t[0]))?["filter-in-large",n,["literal",t.sort(Gt)]]:["filter-in-small",n,["literal",t]]}}function Ti(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Yn(n){return["!",n]}function xr(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let m="[";for(const v of n)m+=`${xr(v)},`;return`${m}]`}const r=Object.keys(n).sort();let u="{";for(let m=0;m<r.length;m++)u+=`${JSON.stringify(r[m])}:${xr(n[r[m]])},`;return`${u}}`}function ao(n){let t="";for(const r of ds)t+=`/${xr(n[r])}`;return t}function Ll(n){const t=n.value;return t?[new Je(n.key,t,"constants have been deprecated as of v8")]:[]}function vi(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Hr(n){if(Array.isArray(n))return n.map(Hr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const r in n)t[r]=Hr(n[r]);return t}return vi(n)}function Tr(n){const t=n.key,r=n.value,u=n.valueSpec||{},m=n.objectElementValidators||{},v=n.style,x=n.styleSpec,I=n.validateSpec;let M=[];const z=jn(r);if(z!=="object")return[new Je(t,r,`object expected, ${z} found`)];for(const V in r){const G=V.split(".")[0],X=u[G]||u["*"];let J;if(m[G])J=m[G];else if(u[G])J=I;else if(m["*"])J=m["*"];else{if(!u["*"]){M.push(new Je(t,r[V],`unknown property "${V}"`));continue}J=I}M=M.concat(J({key:(t&&`${t}.`)+V,value:r[V],valueSpec:X,style:v,styleSpec:x,object:r,objectKey:V,validateSpec:I},r))}for(const V in u)m[V]||u[V].required&&u[V].default===void 0&&r[V]===void 0&&M.push(new Je(t,r,`missing required property "${V}"`));return M}function oo(n){const t=n.value,r=n.valueSpec,u=n.style,m=n.styleSpec,v=n.key,x=n.arrayElementValidator||n.validateSpec;if(jn(t)!=="array")return[new Je(v,t,`array expected, ${jn(t)} found`)];if(r.length&&t.length!==r.length)return[new Je(v,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Je(v,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let I={type:r.value,values:r.values};m.$version<7&&(I.function=r.function),jn(r.value)==="object"&&(I=r.value);let M=[];for(let z=0;z<t.length;z++)M=M.concat(x({array:t,arrayIndex:z,value:t[z],valueSpec:I,validateSpec:n.validateSpec,style:u,styleSpec:m,key:`${v}[${z}]`}));return M}function xs(n){const t=n.key,r=n.value,u=n.valueSpec;let m=jn(r);return m==="number"&&r!=r&&(m="NaN"),m!=="number"?[new Je(t,r,`number expected, ${m} found`)]:"minimum"in u&&r<u.minimum?[new Je(t,r,`${r} is less than the minimum value ${u.minimum}`)]:"maximum"in u&&r>u.maximum?[new Je(t,r,`${r} is greater than the maximum value ${u.maximum}`)]:[]}function Oa(n){const t=n.valueSpec,r=vi(n.value.type);let u,m,v,x={};const I=r!=="categorical"&&n.value.property===void 0,M=!I,z=jn(n.value.stops)==="array"&&jn(n.value.stops[0])==="array"&&jn(n.value.stops[0][0])==="object",V=Tr({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(J){if(r==="identity")return[new Je(J.key,J.value,'identity function may not have a "stops" property')];let ie=[];const le=J.value;return ie=ie.concat(oo({key:J.key,value:le,valueSpec:J.valueSpec,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:G})),jn(le)==="array"&&le.length===0&&ie.push(new Je(J.key,le,"array must have at least one stop")),ie},default:function(J){return J.validateSpec({key:J.key,value:J.value,valueSpec:t,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec})}}});return r==="identity"&&I&&V.push(new Je(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||V.push(new Je(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!sl(n.valueSpec)&&V.push(new Je(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(M&&!so(n.valueSpec)?V.push(new Je(n.key,n.value,"property functions not supported")):I&&!Ml(n.valueSpec)&&V.push(new Je(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!z||n.value.property!==void 0||V.push(new Je(n.key,n.value,'"property" property is required')),V;function G(J){let ie=[];const le=J.value,ye=J.key;if(jn(le)!=="array")return[new Je(ye,le,`array expected, ${jn(le)} found`)];if(le.length!==2)return[new Je(ye,le,`array length 2 expected, length ${le.length} found`)];if(z){if(jn(le[0])!=="object")return[new Je(ye,le,`object expected, ${jn(le[0])} found`)];if(le[0].zoom===void 0)return[new Je(ye,le,"object stop key must have zoom")];if(le[0].value===void 0)return[new Je(ye,le,"object stop key must have value")];if(v&&v>vi(le[0].zoom))return[new Je(ye,le[0].zoom,"stop zoom values must appear in ascending order")];vi(le[0].zoom)!==v&&(v=vi(le[0].zoom),m=void 0,x={}),ie=ie.concat(Tr({key:`${ye}[0]`,value:le[0],valueSpec:{zoom:{}},validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:xs,value:X}}))}else ie=ie.concat(X({key:`${ye}[0]`,value:le[0],validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec},le));return w(Hr(le[1]))?ie.concat([new Je(`${ye}[1]`,le[1],"expressions are not allowed in function stops.")]):ie.concat(J.validateSpec({key:`${ye}[1]`,value:le[1],valueSpec:t,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec}))}function X(J,ie){const le=jn(J.value),ye=vi(J.value),be=J.value!==null?J.value:ie;if(u){if(le!==u)return[new Je(J.key,be,`${le} stop domain type must match previous stop domain type ${u}`)]}else u=le;if(le!=="number"&&le!=="string"&&le!=="boolean")return[new Je(J.key,be,"stop domain value must be a number, string, or boolean")];if(le!=="number"&&r!=="categorical"){let Ue=`number expected, ${le} found`;return so(t)&&r===void 0&&(Ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Je(J.key,be,Ue)]}return r!=="categorical"||le!=="number"||isFinite(ye)&&Math.floor(ye)===ye?r!=="categorical"&&le==="number"&&m!==void 0&&ye<m?[new Je(J.key,be,"stop domain values must appear in ascending order")]:(m=ye,r==="categorical"&&ye in x?[new Je(J.key,be,"stop domain values must be unique")]:(x[ye]=!0,[])):[new Je(J.key,be,`integer expected, found ${ye}`)]}}function Us(n){const t=(n.expressionContext==="property"?re:L)(Hr(n.value),n.valueSpec);if(t.result==="error")return t.value.map((u=>new Je(`${n.key}${u.key}`,n.value,u.message)));const r=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new Je(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Fs(r))return[new Je(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Fs(r))return[new Je(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Bs(r,["zoom","feature-state"]))return[new Je(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!ro(r))return[new Je(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function lo(n){const t=n.key,r=n.value,u=n.valueSpec,m=[];return Array.isArray(u.values)?u.values.indexOf(vi(r))===-1&&m.push(new Je(t,r,`expected one of [${u.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(u.values).indexOf(vi(r))===-1&&m.push(new Je(t,r,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(r)} found`)),m}function mc(n){return $e(Hr(n.value))?Us(Vr({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Do(n)}function Do(n){const t=n.value,r=n.key;if(jn(t)!=="array")return[new Je(r,t,`array expected, ${jn(t)} found`)];const u=n.styleSpec;let m,v=[];if(t.length<1)return[new Je(r,t,"filter array must have at least 1 element")];switch(v=v.concat(lo({key:`${r}[0]`,value:t[0],valueSpec:u.filter_operator,style:n.style,styleSpec:n.styleSpec})),vi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&vi(t[1])==="$type"&&v.push(new Je(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&v.push(new Je(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(m=jn(t[1]),m!=="string"&&v.push(new Je(`${r}[1]`,t[1],`string expected, ${m} found`)));for(let x=2;x<t.length;x++)m=jn(t[x]),vi(t[1])==="$type"?v=v.concat(lo({key:`${r}[${x}]`,value:t[x],valueSpec:u.geometry_type,style:n.style,styleSpec:n.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&v.push(new Je(`${r}[${x}]`,t[x],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)v=v.concat(Do({key:`${r}[${x}]`,value:t[x],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":m=jn(t[1]),t.length!==2?v.push(new Je(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):m!=="string"&&v.push(new Je(`${r}[1]`,t[1],`string expected, ${m} found`))}return v}function gc(n,t){const r=n.key,u=n.validateSpec,m=n.style,v=n.styleSpec,x=n.value,I=n.objectKey,M=v[`${t}_${n.layerType}`];if(!M)return[];const z=I.match(/^(.*)-transition$/);if(t==="paint"&&z&&M[z[1]]&&M[z[1]].transition)return u({key:r,value:x,valueSpec:v.transition,style:m,styleSpec:v});const V=n.valueSpec||M[I];if(!V)return[new Je(r,x,`unknown property "${I}"`)];let G;if(jn(x)==="string"&&so(V)&&!V.tokens&&(G=/^{([^}]+)}$/.exec(x)))return[new Je(r,x,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(G[1])} }\`.`)];const X=[];return n.layerType==="symbol"&&(I==="text-field"&&m&&!m.glyphs&&X.push(new Je(r,x,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&js(Hr(x))&&vi(x.type)==="identity"&&X.push(new Je(r,x,'"text-font" does not support identity functions'))),X.concat(u({key:n.key,value:x,valueSpec:V,style:m,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:I}))}function hu(n){return gc(n,"paint")}function Bu(n){return gc(n,"layout")}function gi(n){let t=[];const r=n.value,u=n.key,m=n.style,v=n.styleSpec;r.type||r.ref||t.push(new Je(u,r,'either "type" or "ref" is required'));let x=vi(r.type);const I=vi(r.ref);if(r.id){const M=vi(r.id);for(let z=0;z<n.arrayIndex;z++){const V=m.layers[z];vi(V.id)===M&&t.push(new Je(u,r.id,`duplicate layer id "${r.id}", previously used at line ${V.id.__line__}`))}}if("ref"in r){let M;["type","source","source-layer","filter","layout"].forEach((z=>{z in r&&t.push(new Je(u,r[z],`"${z}" is prohibited for ref layers`))})),m.layers.forEach((z=>{vi(z.id)===I&&(M=z)})),M?M.ref?t.push(new Je(u,r.ref,"ref cannot reference another ref layer")):x=vi(M.type):t.push(new Je(u,r.ref,`ref layer "${I}" not found`))}else if(x!=="background")if(r.source){const M=m.sources&&m.sources[r.source],z=M&&vi(M.type);M?z==="vector"&&x==="raster"?t.push(new Je(u,r.source,`layer "${r.id}" requires a raster source`)):z!=="raster-dem"&&x==="hillshade"?t.push(new Je(u,r.source,`layer "${r.id}" requires a raster-dem source`)):z==="raster"&&x!=="raster"?t.push(new Je(u,r.source,`layer "${r.id}" requires a vector source`)):z!=="vector"||r["source-layer"]?z==="raster-dem"&&x!=="hillshade"?t.push(new Je(u,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!r.paint||!r.paint["line-gradient"]||z==="geojson"&&M.lineMetrics||t.push(new Je(u,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Je(u,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Je(u,r.source,`source "${r.source}" not found`))}else t.push(new Je(u,r,'missing required property "source"'));return t=t.concat(Tr({key:u,value:r,valueSpec:v.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${u}.type`,value:r.type,valueSpec:v.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:mc,layout:M=>Tr({layer:r,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":z=>Bu(Vr({layerType:x},z))}}),paint:M=>Tr({layer:r,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":z=>hu(Vr({layerType:x},z))}})}})),t}function uo(n){const t=n.value,r=n.key,u=jn(t);return u!=="string"?[new Je(r,t,`string expected, ${u} found`)]:[]}const al={promoteId:function({key:n,value:t}){if(jn(t)==="string")return uo({key:n,value:t});{const r=[];for(const u in t)r.push(...uo({key:`${n}.${u}`,value:t[u]}));return r}}};function co(n){const t=n.value,r=n.key,u=n.styleSpec,m=n.style,v=n.validateSpec;if(!t.type)return[new Je(r,t,'"type" is required')];const x=vi(t.type);let I;switch(x){case"vector":case"raster":return I=Tr({key:r,value:t,valueSpec:u[`source_${x.replace("-","_")}`],style:n.style,styleSpec:u,objectElementValidators:al,validateSpec:v}),I;case"raster-dem":return I=(function(M){var z;const V=(z=M.sourceName)!==null&&z!==void 0?z:"",G=M.value,X=M.styleSpec,J=X.source_raster_dem,ie=M.style;let le=[];const ye=jn(G);if(G===void 0)return le;if(ye!=="object")return le.push(new Je("source_raster_dem",G,`object expected, ${ye} found`)),le;const be=vi(G.encoding)==="custom",Ue=["redFactor","greenFactor","blueFactor","baseShift"],Ie=M.value.encoding?`"${M.value.encoding}"`:"Default";for(const Be in G)!be&&Ue.includes(Be)?le.push(new Je(Be,G[Be],`In "${V}": "${Be}" is only valid when "encoding" is set to "custom". ${Ie} encoding found`)):J[Be]?le=le.concat(M.validateSpec({key:Be,value:G[Be],valueSpec:J[Be],validateSpec:M.validateSpec,style:ie,styleSpec:X})):le.push(new Je(Be,G[Be],`unknown property "${Be}"`));return le})({sourceName:r,value:t,style:n.style,styleSpec:u,validateSpec:v}),I;case"geojson":if(I=Tr({key:r,value:t,valueSpec:u.source_geojson,style:m,styleSpec:u,validateSpec:v,objectElementValidators:al}),t.cluster)for(const M in t.clusterProperties){const[z,V]=t.clusterProperties[M],G=typeof z=="string"?[z,["accumulated"],["get",M]]:z;I.push(...Us({key:`${r}.${M}.map`,value:V,expressionContext:"cluster-map"})),I.push(...Us({key:`${r}.${M}.reduce`,value:G,expressionContext:"cluster-reduce"}))}return I;case"video":return Tr({key:r,value:t,valueSpec:u.source_video,style:m,validateSpec:v,styleSpec:u});case"image":return Tr({key:r,value:t,valueSpec:u.source_image,style:m,validateSpec:v,styleSpec:u});case"canvas":return[new Je(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return lo({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ju(n){const t=n.value,r=n.styleSpec,u=r.light,m=n.style;let v=[];const x=jn(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new Je("light",t,`object expected, ${x} found`)]),v;for(const I in t){const M=I.match(/^(.*)-transition$/);v=v.concat(M&&u[M[1]]&&u[M[1]].transition?n.validateSpec({key:I,value:t[I],valueSpec:r.transition,validateSpec:n.validateSpec,style:m,styleSpec:r}):u[I]?n.validateSpec({key:I,value:t[I],valueSpec:u[I],validateSpec:n.validateSpec,style:m,styleSpec:r}):[new Je(I,t[I],`unknown property "${I}"`)])}return v}function fu(n){const t=n.value,r=n.styleSpec,u=r.sky,m=n.style,v=jn(t);if(t===void 0)return[];if(v!=="object")return[new Je("sky",t,`object expected, ${v} found`)];let x=[];for(const I in t)x=x.concat(u[I]?n.validateSpec({key:I,value:t[I],valueSpec:u[I],style:m,styleSpec:r}):[new Je(I,t[I],`unknown property "${I}"`)]);return x}function ol(n){const t=n.value,r=n.styleSpec,u=r.terrain,m=n.style;let v=[];const x=jn(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new Je("terrain",t,`object expected, ${x} found`)]),v;for(const I in t)v=v.concat(u[I]?n.validateSpec({key:I,value:t[I],valueSpec:u[I],validateSpec:n.validateSpec,style:m,styleSpec:r}):[new Je(I,t[I],`unknown property "${I}"`)]);return v}function Rl(n){let t=[];const r=n.value,u=n.key;if(Array.isArray(r)){const m=[],v=[];for(const x in r)r[x].id&&m.includes(r[x].id)&&t.push(new Je(u,r,`all the sprites' ids must be unique, but ${r[x].id} is duplicated`)),m.push(r[x].id),r[x].url&&v.includes(r[x].url)&&t.push(new Je(u,r,`all the sprites' URLs must be unique, but ${r[x].url} is duplicated`)),v.push(r[x].url),t=t.concat(Tr({key:`${u}[${x}]`,value:r[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return uo({key:u,value:r})}const ho={"*":()=>[],array:oo,boolean:function(n){const t=n.value,r=n.key,u=jn(t);return u!=="boolean"?[new Je(r,t,`boolean expected, ${u} found`)]:[]},number:xs,color:function(n){const t=n.key,r=n.value,u=jn(r);return u!=="string"?[new Je(t,r,`color expected, ${u} found`)]:hn.parse(String(r))?[]:[new Je(t,r,`color expected, "${r}" found`)]},constants:Ll,enum:lo,filter:mc,function:Oa,layer:gi,object:Tr,source:co,light:ju,sky:fu,terrain:ol,projection:function(n){const t=n.value,r=n.styleSpec,u=r.projection,m=n.style,v=jn(t);if(t===void 0)return[];if(v!=="object")return[new Je("projection",t,`object expected, ${v} found`)];let x=[];for(const I in t)x=x.concat(u[I]?n.validateSpec({key:I,value:t[I],valueSpec:u[I],style:m,styleSpec:r}):[new Je(I,t[I],`unknown property "${I}"`)]);return x},string:uo,formatted:function(n){return uo(n).length===0?[]:Us(n)},resolvedImage:function(n){return uo(n).length===0?[]:Us(n)},padding:function(n){const t=n.key,r=n.value;if(jn(r)==="array"){if(r.length<1||r.length>4)return[new Je(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const u={type:"number"};let m=[];for(let v=0;v<r.length;v++)m=m.concat(n.validateSpec({key:`${t}[${v}]`,value:r[v],validateSpec:n.validateSpec,valueSpec:u}));return m}return xs({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,r=n.value,u=jn(r),m=n.styleSpec;if(u!=="array"||r.length<1||r.length%2!=0)return[new Je(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<r.length;x+=2)v=v.concat(lo({key:`${t}[${x}]`,value:r[x],valueSpec:m.layout_symbol["text-anchor"]})),v=v.concat(oo({key:`${t}[${x+1}]`,value:r[x+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:m}));return v},sprite:Rl};function Nl(n){const t=n.value,r=n.valueSpec,u=n.styleSpec;return n.validateSpec=Nl,r.expression&&js(vi(t))?Oa(n):r.expression&&w(Hr(t))?Us(n):r.type&&ho[r.type]?ho[r.type](n):Tr(Vr({},n,{valueSpec:r.type?u[r.type]:r}))}function ih(n){const t=n.value,r=n.key,u=uo(n);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new Je(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new Je(r,t,'"glyphs" url must include a "{range}" token'))),u}function Vs(n,t=We){let r=[];return r=r.concat(Nl({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:Nl,objectElementValidators:{glyphs:ih,"*":()=>[]}})),n.constants&&(r=r.concat(Ll({key:"constants",value:n.constants}))),Dl(r)}function fa(n){return function(t){return n({...t,validateSpec:Nl})}}function Dl(n){return[].concat(n).sort(((t,r)=>t.line-r.line))}function ns(n){return function(...t){return Dl(n.apply(this,t))}}Vs.source=ns(fa(co)),Vs.sprite=ns(fa(Rl)),Vs.glyphs=ns(fa(ih)),Vs.light=ns(fa(ju)),Vs.sky=ns(fa(fu)),Vs.terrain=ns(fa(ol)),Vs.layer=ns(fa(gi)),Vs.filter=ns(fa(mc)),Vs.paintProperty=ns(fa(hu)),Vs.layoutProperty=ns(fa(Bu));const fo=Vs,yc=fo.light,_c=fo.sky,Uu=fo.paintProperty,rh=fo.layoutProperty;function Vu(n,t){let r=!1;if(t&&t.length)for(const u of t)n.fire(new Ur(new Error(u.message))),r=!0;return r}class zl{constructor(t,r,u){const m=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const x=new Int32Array(this.arrayBuffer);t=x[0],this.d=(r=x[1])+2*(u=x[2]);for(let M=0;M<this.d*this.d;M++){const z=x[3+M],V=x[3+M+1];m.push(z===V?null:x.subarray(z,V))}const I=x[3+m.length+1];this.keys=x.subarray(x[3+m.length],I),this.bboxes=x.subarray(I),this.insert=this._insertReadonly}else{this.d=r+2*u;for(let x=0;x<this.d*this.d;x++)m.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=u,this.scale=r/t,this.uid=0;const v=u/r*t;this.min=-v,this.max=t+v}insert(t,r,u,m,v){this._forEachCell(r,u,m,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,u,m,v,x){this.cells[v].push(x)}query(t,r,u,m,v){const x=this.min,I=this.max;if(t<=x&&r<=x&&I<=u&&I<=m&&!v)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(t,r,u,m,this._queryCell,M,{},v),M}}_queryCell(t,r,u,m,v,x,I,M){const z=this.cells[v];if(z!==null){const V=this.keys,G=this.bboxes;for(let X=0;X<z.length;X++){const J=z[X];if(I[J]===void 0){const ie=4*J;(M?M(G[ie+0],G[ie+1],G[ie+2],G[ie+3]):t<=G[ie+2]&&r<=G[ie+3]&&u>=G[ie+0]&&m>=G[ie+1])?(I[J]=!0,x.push(V[J])):I[J]=!1}}}}_forEachCell(t,r,u,m,v,x,I,M){const z=this._convertToCellCoord(t),V=this._convertToCellCoord(r),G=this._convertToCellCoord(u),X=this._convertToCellCoord(m);for(let J=z;J<=G;J++)for(let ie=V;ie<=X;ie++){const le=this.d*ie+J;if((!M||M(this._convertFromCellCoord(J),this._convertFromCellCoord(ie),this._convertFromCellCoord(J+1),this._convertFromCellCoord(ie+1)))&&v.call(this,t,r,u,m,le,x,I,M))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let u=0;for(let x=0;x<this.cells.length;x++)u+=this.cells[x].length;const m=new Int32Array(r+u+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let v=r;for(let x=0;x<t.length;x++){const I=t[x];m[3+x]=v,m.set(I,v),v+=I.length}return m[3+t.length]=v,m.set(this.keys,v),v+=this.keys.length,m[3+t.length+1]=v,m.set(this.bboxes,v),v+=this.bboxes.length,m.buffer}static serialize(t,r){const u=t.toArrayBuffer();return r&&r.push(u),{buffer:u}}static deserialize(t){return new zl(t.buffer)}}const qs={};function zt(n,t,r={}){if(qs[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),qs[n]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}zt("Object",Object),zt("TransferableGridIndex",zl),zt("Color",hn),zt("Error",Error),zt("AJAXError",Rn),zt("ResolvedImage",Fi),zt("StylePropertyFunction",fe),zt("StyleExpression",c,{omit:["_evaluator"]}),zt("ZoomDependentExpression",H),zt("ZoomConstantExpression",F),zt("CompoundExpression",Zr,{omit:["_evaluate"]});for(const n in no)no[n]._classRegistryKey||zt(`Expression_${n}`,no[n]);function da(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function qu(n){return n.$name||n.constructor._classRegistryKey}function ll(n){return!(function(t){if(t===null||typeof t!="object")return!1;const r=qu(t);return!(!r||r==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||da(n)||rn(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Xr(n,t){if(ll(n))return(da(n)||rn(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const v=[];for(const x of n)v.push(Xr(x,t));return v}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const r=qu(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!qs[r])throw new Error(`${r} is not registered.`);const{klass:u}=qs[r],m=u.serialize?u.serialize(n,t):{};if(u.serialize){if(t&&m===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in n){if(!n.hasOwnProperty(v)||qs[r].omit.indexOf(v)>=0)continue;const x=n[v];m[v]=qs[r].shallow.indexOf(v)>=0?x:Xr(x,t)}n instanceof Error&&(m.message=n.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(m.$name=r),m}function Fa(n){if(ll(n))return n;if(Array.isArray(n))return n.map(Fa);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=qu(n)||"Object";if(!qs[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=qs[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);const u=Object.create(r.prototype);for(const m of Object.keys(n)){if(m==="$name")continue;const v=n[m];u[m]=qs[t].shallow.indexOf(m)>=0?v:Fa(v)}return u}class pa{constructor(){this.first=!0}update(t,r){const u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))}}const Dn={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function vc(n){for(const t of n)if(mu(t.charCodeAt(0)))return!0;return!1}function Kh(n){for(const t of n)if(!ma(t.charCodeAt(0)))return!1;return!0}function po(n){const t=n.map((r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}})).filter((r=>r));return new RegExp(t.join("|"),"u")}const du=po(["Arab","Dupl","Mong","Ougr","Syrc"]);function ma(n){return!du.test(String.fromCodePoint(n))}const pu=po(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function mu(n){return!(n!==746&&n!==747&&(n<4352||!(Dn["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Dn["CJK Compatibility"](n)||Dn["CJK Strokes"](n)||!(!Dn["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Dn["Enclosed CJK Letters and Months"](n)||Dn["Ideographic Description Characters"](n)||Dn.Kanbun(n)||Dn.Katakana(n)&&n!==12540||!(!Dn["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Dn["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Dn["Vertical Forms"](n)||Dn["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||pu.test(String.fromCodePoint(n)))))}function ul(n){return!(mu(n)||(function(t){return!!(Dn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Dn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Dn["Letterlike Symbols"](t)||Dn["Number Forms"](t)||Dn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Dn["Control Pictures"](t)&&t!==9251||Dn["Optical Character Recognition"](t)||Dn["Enclosed Alphanumerics"](t)||Dn["Geometric Shapes"](t)||Dn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Dn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Dn["CJK Symbols and Punctuation"](t)||Dn.Katakana(t)||Dn["Private Use Area"](t)||Dn["CJK Compatibility Forms"](t)||Dn["Small Form Variants"](t)||Dn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(n))}const zo=po(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function yi(n){return zo.test(String.fromCodePoint(n))}function xi(n,t){return!(!t&&yi(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Dn.Khmer(n))}function Oo(n){for(const t of n)if(yi(t.charCodeAt(0)))return!0;return!1}const ui=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class On{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new pa,this.transition={})}isSupportedScript(t){return(function(r,u){for(const m of r)if(!xi(m.charCodeAt(0),u))return!1;return!0})(t,ui.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*r}}}class Gs{constructor(t,r){this.property=t,this.value=r,this.expression=(function(u,m){if(js(u))return new fe(u,m);if(w(u)){const v=re(u,m);if(v.result==="error")throw new Error(v.value.map((x=>`${x.key}: ${x.message}`)).join(", "));return v.value}{let v=u;return m.type==="color"&&typeof u=="string"?v=hn.parse(u):m.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(u)&&(v=Ei.parse(u)):v=rr.parse(u),{kind:"constant",evaluate:()=>v}}})(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,u){return this.property.possiblyEvaluate(this,t,r,u)}}class mo{constructor(t){this.property=t,this.value=new Gs(t,void 0)}transitioned(t,r){return new gu(this.property,this.value,r,Ge({},t.transition,this.transition),t.now)}untransitioned(){return new gu(this.property,this.value,null,{},0)}}class Cr{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return St(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new mo(this._values[t].property)),this._values[t].value=new Gs(this._values[t].property,r===null?void 0:St(r))}getTransition(t){return St(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new mo(this._values[t].property)),this._values[t].transition=St(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const u=this.getValue(r);u!==void 0&&(t[r]=u);const m=this.getTransition(r);m!==void 0&&(t[`${r}-transition`]=m)}return t}transitioned(t,r){const u=new Ol(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].transitioned(t,r._values[m]);return u}untransitioned(){const t=new Ol(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class gu{constructor(t,r,u,m,v){this.property=t,this.value=r,this.begin=v+m.delay||0,this.end=this.begin+m.duration||0,t.specification.transition&&(m.delay||m.duration)&&(this.prior=u)}possiblyEvaluate(t,r,u){const m=t.now||0,v=this.value.possiblyEvaluate(t,r,u),x=this.prior;if(x){if(m>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(m<this.begin)return x.possiblyEvaluate(t,r,u);{const I=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,r,u),v,(function(M){if(M<=0)return 0;if(M>=1)return 1;const z=M*M,V=z*M;return 4*(M<.5?V:3*(M-z)+V-.75)})(I))}}return v}}class Ol{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,u){const m=new Bl(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(t,r,u);return m}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Fl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return St(this._values[t].value)}setValue(t,r){this._values[t]=new Gs(this._values[t].property,r===null?void 0:St(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const u=this.getValue(r);u!==void 0&&(t[r]=u)}return t}possiblyEvaluate(t,r,u){const m=new Bl(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(t,r,u);return m}}class ws{constructor(t,r,u){this.property=t,this.value=r,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,u,m){return this.property.evaluate(this.value,this.parameters,t,r,u,m)}}class Bl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ot{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,u){const m=Wn[this.specification.type];return m?m(t,r,u):t}}class sn{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,u,m){return new ws(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},u,m)}:t.expression,r)}interpolate(t,r,u){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new ws(this,{kind:"constant",value:void 0},t.parameters);const m=Wn[this.specification.type];if(m){const v=m(t.value.value,r.value.value,u);return new ws(this,{kind:"constant",value:v},t.parameters)}return t}evaluate(t,r,u,m,v,x){return t.kind==="constant"?t.value:t.evaluate(r,u,m,v,x)}}class jl extends sn{possiblyEvaluate(t,r,u,m){if(t.value===void 0)return new ws(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const v=t.expression.evaluate(r,null,{},u,m),x=t.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,I=this._calculate(x,x,x,r);return new ws(this,{kind:"constant",value:I},r)}if(t.expression.kind==="camera"){const v=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new ws(this,{kind:"constant",value:v},r)}return new ws(this,t.expression,r)}evaluate(t,r,u,m,v,x){if(t.kind==="source"){const I=t.evaluate(r,u,m,v,x);return this._calculate(I,I,I,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},u,m),t.evaluate({zoom:Math.floor(r.zoom)},u,m),t.evaluate({zoom:Math.floor(r.zoom)+1},u,m),r):t.value}_calculate(t,r,u,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:u,to:r}}interpolate(t){return t}}class yu{constructor(t){this.specification=t}possiblyEvaluate(t,r,u,m){if(t.value!==void 0){if(t.expression.kind==="constant"){const v=t.expression.evaluate(r,null,{},u,m);return this._calculate(v,v,v,r)}return this._calculate(t.expression.evaluate(new On(Math.floor(r.zoom-1),r)),t.expression.evaluate(new On(Math.floor(r.zoom),r)),t.expression.evaluate(new On(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,u,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:u,to:r}}interpolate(t){return t}}class xc{constructor(t){this.specification=t}possiblyEvaluate(t,r,u,m){return!!t.expression.evaluate(r,null,{},u,m)}interpolate(){return!1}}class _{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const u=t[r];u.specification.overridable&&this.overridableProperties.push(r);const m=this.defaultPropertyValues[r]=new Gs(u,void 0),v=this.defaultTransitionablePropertyValues[r]=new mo(u);this.defaultTransitioningPropertyValues[r]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=m.possiblyEvaluate({})}}}zt("DataDrivenProperty",sn),zt("DataConstantProperty",Ot),zt("CrossFadedDataDrivenProperty",jl),zt("CrossFadedProperty",yu),zt("ColorRampProperty",xc);const e="-transition";class o extends Rr{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new Fl(r.layout)),r.paint)){this._transitionablePaint=new Cr(r.paint);for(const u in t.paint)this.setPaintProperty(u,t.paint[u],{validate:!1});for(const u in t.layout)this.setLayoutProperty(u,t.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Bl(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,u={}){r!=null&&this._validate(rh,`layers.${this.id}.layout.${t}`,t,r,u)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,u={}){if(r!=null&&this._validate(Uu,`layers.${this.id}.paint.${t}`,t,r,u))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const m=this._transitionablePaint._values[t],v=m.property.specification["property-type"]==="cross-faded-data-driven",x=m.value.isDataDriven(),I=m.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const M=this._transitionablePaint._values[t].value;return M.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(t,I,M)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,u){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Kt(t,((r,u)=>!(r===void 0||u==="layout"&&!Object.keys(r).length||u==="paint"&&!Object.keys(r).length)))}_validate(t,r,u,m,v={}){return(!v||v.validate!==!1)&&Vu(this,t.call(fo,{key:r,layerType:this.type,objectKey:u,value:m,styleSpec:We,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof ws&&so(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const d={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class p{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class y{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function T(n,t=1){let r=0,u=0;return{members:n.map((m=>{const v=d[m.type].BYTES_PER_ELEMENT,x=r=A(r,Math.max(t,v)),I=m.components||1;return u=Math.max(u,v),r+=v*I,{name:m.name,type:m.type,components:I,offset:x}})),size:A(r,Math.max(u,t)),alignment:t}}function A(n,t){return Math.ceil(n/t)*t}class D extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const u=this.length;return this.resize(u+1),this.emplace(u,t,r)}emplace(t,r,u){const m=2*t;return this.int16[m+0]=r,this.int16[m+1]=u,t}}D.prototype.bytesPerElement=4,zt("StructArrayLayout2i4",D);class U extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,u)}emplace(t,r,u,m){const v=3*t;return this.int16[v+0]=r,this.int16[v+1]=u,this.int16[v+2]=m,t}}U.prototype.bytesPerElement=6,zt("StructArrayLayout3i6",U);class $ extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,u,m)}emplace(t,r,u,m,v){const x=4*t;return this.int16[x+0]=r,this.int16[x+1]=u,this.int16[x+2]=m,this.int16[x+3]=v,t}}$.prototype.bytesPerElement=8,zt("StructArrayLayout4i8",$);class Z extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x){const I=this.length;return this.resize(I+1),this.emplace(I,t,r,u,m,v,x)}emplace(t,r,u,m,v,x,I){const M=6*t;return this.int16[M+0]=r,this.int16[M+1]=u,this.int16[M+2]=m,this.int16[M+3]=v,this.int16[M+4]=x,this.int16[M+5]=I,t}}Z.prototype.bytesPerElement=12,zt("StructArrayLayout2i4i12",Z);class Q extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x){const I=this.length;return this.resize(I+1),this.emplace(I,t,r,u,m,v,x)}emplace(t,r,u,m,v,x,I){const M=4*t,z=8*t;return this.int16[M+0]=r,this.int16[M+1]=u,this.uint8[z+4]=m,this.uint8[z+5]=v,this.uint8[z+6]=x,this.uint8[z+7]=I,t}}Q.prototype.bytesPerElement=8,zt("StructArrayLayout2i4ub8",Q);class oe extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const u=this.length;return this.resize(u+1),this.emplace(u,t,r)}emplace(t,r,u){const m=2*t;return this.float32[m+0]=r,this.float32[m+1]=u,t}}oe.prototype.bytesPerElement=8,zt("StructArrayLayout2f8",oe);class he extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x,I,M,z,V){const G=this.length;return this.resize(G+1),this.emplace(G,t,r,u,m,v,x,I,M,z,V)}emplace(t,r,u,m,v,x,I,M,z,V,G){const X=10*t;return this.uint16[X+0]=r,this.uint16[X+1]=u,this.uint16[X+2]=m,this.uint16[X+3]=v,this.uint16[X+4]=x,this.uint16[X+5]=I,this.uint16[X+6]=M,this.uint16[X+7]=z,this.uint16[X+8]=V,this.uint16[X+9]=G,t}}he.prototype.bytesPerElement=20,zt("StructArrayLayout10ui20",he);class pe extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x,I,M,z,V,G,X){const J=this.length;return this.resize(J+1),this.emplace(J,t,r,u,m,v,x,I,M,z,V,G,X)}emplace(t,r,u,m,v,x,I,M,z,V,G,X,J){const ie=12*t;return this.int16[ie+0]=r,this.int16[ie+1]=u,this.int16[ie+2]=m,this.int16[ie+3]=v,this.uint16[ie+4]=x,this.uint16[ie+5]=I,this.uint16[ie+6]=M,this.uint16[ie+7]=z,this.int16[ie+8]=V,this.int16[ie+9]=G,this.int16[ie+10]=X,this.int16[ie+11]=J,t}}pe.prototype.bytesPerElement=24,zt("StructArrayLayout4i4ui4i24",pe);class ge extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,u)}emplace(t,r,u,m){const v=3*t;return this.float32[v+0]=r,this.float32[v+1]=u,this.float32[v+2]=m,t}}ge.prototype.bytesPerElement=12,zt("StructArrayLayout3f12",ge);class ve extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}ve.prototype.bytesPerElement=4,zt("StructArrayLayout1ul4",ve);class Se extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x,I,M,z){const V=this.length;return this.resize(V+1),this.emplace(V,t,r,u,m,v,x,I,M,z)}emplace(t,r,u,m,v,x,I,M,z,V){const G=10*t,X=5*t;return this.int16[G+0]=r,this.int16[G+1]=u,this.int16[G+2]=m,this.int16[G+3]=v,this.int16[G+4]=x,this.int16[G+5]=I,this.uint32[X+3]=M,this.uint16[G+8]=z,this.uint16[G+9]=V,t}}Se.prototype.bytesPerElement=20,zt("StructArrayLayout6i1ul2ui20",Se);class me extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x){const I=this.length;return this.resize(I+1),this.emplace(I,t,r,u,m,v,x)}emplace(t,r,u,m,v,x,I){const M=6*t;return this.int16[M+0]=r,this.int16[M+1]=u,this.int16[M+2]=m,this.int16[M+3]=v,this.int16[M+4]=x,this.int16[M+5]=I,t}}me.prototype.bytesPerElement=12,zt("StructArrayLayout2i2i2i12",me);class Ae extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,r,u,m,v)}emplace(t,r,u,m,v,x){const I=4*t,M=8*t;return this.float32[I+0]=r,this.float32[I+1]=u,this.float32[I+2]=m,this.int16[M+6]=v,this.int16[M+7]=x,t}}Ae.prototype.bytesPerElement=16,zt("StructArrayLayout2f1f2i16",Ae);class ze extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x){const I=this.length;return this.resize(I+1),this.emplace(I,t,r,u,m,v,x)}emplace(t,r,u,m,v,x,I){const M=16*t,z=4*t,V=8*t;return this.uint8[M+0]=r,this.uint8[M+1]=u,this.float32[z+1]=m,this.float32[z+2]=v,this.int16[V+6]=x,this.int16[V+7]=I,t}}ze.prototype.bytesPerElement=16,zt("StructArrayLayout2ub2f2i16",ze);class Ve extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,u)}emplace(t,r,u,m){const v=3*t;return this.uint16[v+0]=r,this.uint16[v+1]=u,this.uint16[v+2]=m,t}}Ve.prototype.bytesPerElement=6,zt("StructArrayLayout3ui6",Ve);class at extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x,I,M,z,V,G,X,J,ie,le,ye,be){const Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,t,r,u,m,v,x,I,M,z,V,G,X,J,ie,le,ye,be)}emplace(t,r,u,m,v,x,I,M,z,V,G,X,J,ie,le,ye,be,Ue){const Ie=24*t,Be=12*t,Qe=48*t;return this.int16[Ie+0]=r,this.int16[Ie+1]=u,this.uint16[Ie+2]=m,this.uint16[Ie+3]=v,this.uint32[Be+2]=x,this.uint32[Be+3]=I,this.uint32[Be+4]=M,this.uint16[Ie+10]=z,this.uint16[Ie+11]=V,this.uint16[Ie+12]=G,this.float32[Be+7]=X,this.float32[Be+8]=J,this.uint8[Qe+36]=ie,this.uint8[Qe+37]=le,this.uint8[Qe+38]=ye,this.uint32[Be+10]=be,this.int16[Ie+22]=Ue,t}}at.prototype.bytesPerElement=48,zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",at);class yt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x,I,M,z,V,G,X,J,ie,le,ye,be,Ue,Ie,Be,Qe,ft,Dt,cn,Nt,Mt,Xt,qt){const Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,t,r,u,m,v,x,I,M,z,V,G,X,J,ie,le,ye,be,Ue,Ie,Be,Qe,ft,Dt,cn,Nt,Mt,Xt,qt)}emplace(t,r,u,m,v,x,I,M,z,V,G,X,J,ie,le,ye,be,Ue,Ie,Be,Qe,ft,Dt,cn,Nt,Mt,Xt,qt,Bt){const st=32*t,Qt=16*t;return this.int16[st+0]=r,this.int16[st+1]=u,this.int16[st+2]=m,this.int16[st+3]=v,this.int16[st+4]=x,this.int16[st+5]=I,this.int16[st+6]=M,this.int16[st+7]=z,this.uint16[st+8]=V,this.uint16[st+9]=G,this.uint16[st+10]=X,this.uint16[st+11]=J,this.uint16[st+12]=ie,this.uint16[st+13]=le,this.uint16[st+14]=ye,this.uint16[st+15]=be,this.uint16[st+16]=Ue,this.uint16[st+17]=Ie,this.uint16[st+18]=Be,this.uint16[st+19]=Qe,this.uint16[st+20]=ft,this.uint16[st+21]=Dt,this.uint16[st+22]=cn,this.uint32[Qt+12]=Nt,this.float32[Qt+13]=Mt,this.float32[Qt+14]=Xt,this.uint16[st+30]=qt,this.uint16[st+31]=Bt,t}}yt.prototype.bytesPerElement=64,zt("StructArrayLayout8i15ui1ul2f2ui64",yt);class kt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}kt.prototype.bytesPerElement=4,zt("StructArrayLayout1f4",kt);class Lt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,u)}emplace(t,r,u,m){const v=3*t;return this.uint16[6*t+0]=r,this.float32[v+1]=u,this.float32[v+2]=m,t}}Lt.prototype.bytesPerElement=12,zt("StructArrayLayout1ui2f12",Lt);class Et extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,u)}emplace(t,r,u,m){const v=4*t;return this.uint32[2*t+0]=r,this.uint16[v+2]=u,this.uint16[v+3]=m,t}}Et.prototype.bytesPerElement=8,zt("StructArrayLayout1ul2ui8",Et);class bt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const u=this.length;return this.resize(u+1),this.emplace(u,t,r)}emplace(t,r,u){const m=2*t;return this.uint16[m+0]=r,this.uint16[m+1]=u,t}}bt.prototype.bytesPerElement=4,zt("StructArrayLayout2ui4",bt);class Ut extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}Ut.prototype.bytesPerElement=2,zt("StructArrayLayout1ui2",Ut);class gn extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,u,m)}emplace(t,r,u,m,v){const x=4*t;return this.float32[x+0]=r,this.float32[x+1]=u,this.float32[x+2]=m,this.float32[x+3]=v,t}}gn.prototype.bytesPerElement=16,zt("StructArrayLayout4f16",gn);class It extends p{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new B(this.anchorPointX,this.anchorPointY)}}It.prototype.size=20;class Ct extends Se{get(t){return new It(this,t)}}zt("CollisionBoxArray",Ct);class mn extends p{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}mn.prototype.size=48;class li extends at{get(t){return new mn(this,t)}}zt("PlacedSymbolArray",li);class En extends p{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}En.prototype.size=64;class Pn extends yt{get(t){return new En(this,t)}}zt("SymbolInstanceArray",Pn);class ci extends kt{getoffsetX(t){return this.float32[1*t+0]}}zt("GlyphOffsetArray",ci);class wr extends U{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}zt("SymbolLineVertexArray",wr);class bs extends p{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}bs.prototype.size=12;class hi extends Lt{get(t){return new bs(this,t)}}zt("TextAnchorOffsetArray",hi);class or extends p{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}or.prototype.size=8;class wi extends Et{get(t){return new or(this,t)}}zt("FeatureIndexArray",wi);class $i extends D{}class Pr extends D{}class ga extends D{}class is extends Z{}class ya extends Q{}class Fo extends oe{}class ks extends he{}class $s extends pe{}class Ba extends ge{}class Wr extends ve{}class Ss extends me{}class _a extends ze{}class Zs extends Ve{}class Xi extends bt{}const Ci=T([{name:"a_pos",components:2,type:"Int16"}],4),{members:Mr}=Ci;class Ln{constructor(t=[]){this.segments=t}prepareSegment(t,r,u,m){let v=this.segments[this.segments.length-1];return t>Ln.MAX_VERTEX_ARRAY_LENGTH&&Vt(`Max vertices per segment is ${Ln.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!v||v.vertexLength+t>Ln.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==m)&&(v={vertexOffset:r.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},m!==void 0&&(v.sortKey=m),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,u,m){return new Ln([{vertexOffset:t,primitiveOffset:r,vertexLength:u,primitiveLength:m,vaos:{},sortKey:0}])}}function Es(n,t){return 256*(n=nt(Math.floor(n),0,255))+nt(Math.floor(t),0,255)}Ln.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,zt("SegmentVector",Ln);const Bo=T([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var va={exports:{}},wc={exports:{}};wc.exports=function(n,t){var r,u,m,v,x,I,M,z;for(u=n.length-(r=3&n.length),m=t,x=3432918353,I=461845907,z=0;z<u;)M=255&n.charCodeAt(z)|(255&n.charCodeAt(++z))<<8|(255&n.charCodeAt(++z))<<16|(255&n.charCodeAt(++z))<<24,++z,m=27492+(65535&(v=5*(65535&(m=(m^=M=(65535&(M=(M=(65535&M)*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*I+(((M>>>16)*I&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(M=0,r){case 3:M^=(255&n.charCodeAt(z+2))<<16;case 2:M^=(255&n.charCodeAt(z+1))<<8;case 1:m^=M=(65535&(M=(M=(65535&(M^=255&n.charCodeAt(z)))*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*I+(((M>>>16)*I&65535)<<16)&4294967295}return m^=n.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0};var bc=wc.exports,Ni={exports:{}};Ni.exports=function(n,t){for(var r,u=n.length,m=t^u,v=0;u>=4;)r=1540483477*(65535&(r=255&n.charCodeAt(v)|(255&n.charCodeAt(++v))<<8|(255&n.charCodeAt(++v))<<16|(255&n.charCodeAt(++v))<<24))+((1540483477*(r>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),u-=4,++v;switch(u){case 3:m^=(255&n.charCodeAt(v+2))<<16;case 2:m^=(255&n.charCodeAt(v+1))<<8;case 1:m=1540483477*(65535&(m^=255&n.charCodeAt(v)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};var xa=bc,Gu=Ni.exports;va.exports=xa,va.exports.murmur3=xa,va.exports.murmur2=Gu;var Ul=K(va.exports);class jo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,u,m){this.ids.push(Vl(t)),this.positions.push(r,u,m)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Vl(t);let u=0,m=this.ids.length-1;for(;u<m;){const x=u+m>>1;this.ids[x]>=r?m=x:u=x+1}const v=[];for(;this.ids[u]===r;)v.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return v}static serialize(t,r){const u=new Float64Array(t.ids),m=new Uint32Array(t.positions);return ja(u,m,0,u.length-1),r&&r.push(u.buffer,m.buffer),{ids:u,positions:m}}static deserialize(t){const r=new jo;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Vl(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Ul(String(n))}function ja(n,t,r,u){for(;r<u;){const m=n[r+u>>1];let v=r-1,x=u+1;for(;;){do v++;while(n[v]<m);do x--;while(n[x]>m);if(v>=x)break;fi(n,v,x),fi(t,3*v,3*x),fi(t,3*v+1,3*x+1),fi(t,3*v+2,3*x+2)}x-r<u-x?(ja(n,t,r,x),r=x+1):(ja(n,t,x+1,u),u=x)}}function fi(n,t,r){const u=n[t];n[t]=n[r],n[r]=u}zt("FeaturePositionMap",jo);class Vi{constructor(t,r){this.gl=t.gl,this.location=r}}class lr extends Vi{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class kc extends Vi{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class $u extends Vi{constructor(t,r){super(t,r),this.current=hn.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Sc=new Float32Array(16);function Jh(n){return[Es(255*n.r,255*n.g),Es(255*n.b,255*n.a)]}class br{constructor(t,r,u){this.value=t,this.uniformNames=r.map((m=>`u_${m}`)),this.type=u}setUniform(t,r,u){t.set(u.constantOr(this.value))}getBinding(t,r,u){return this.type==="color"?new $u(t,r):new lr(t,r)}}class ql{constructor(t,r){this.uniformNames=r.map((u=>`u_${u}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,u,m){const v=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&t.set(v)}getBinding(t,r,u){return u.substr(0,9)==="u_pattern"?new kc(t,r):new lr(t,r)}}class go{constructor(t,r,u,m){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=r.map((v=>({name:`a_${v}`,type:"Float32",components:u==="color"?2:1,offset:0}))),this.paintVertexArray=new m}populatePaintArray(t,r,u,m,v){const x=this.paintVertexArray.length,I=this.expression.evaluate(new On(0),r,{},m,[],v);this.paintVertexArray.resize(t),this._setPaintValue(x,t,I)}updatePaintArray(t,r,u,m){const v=this.expression.evaluate({zoom:0},u,m);this._setPaintValue(t,r,v)}_setPaintValue(t,r,u){if(this.type==="color"){const m=Jh(u);for(let v=t;v<r;v++)this.paintVertexArray.emplace(v,m[0],m[1])}else{for(let m=t;m<r;m++)this.paintVertexArray.emplace(m,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class wa{constructor(t,r,u,m,v,x){this.expression=t,this.uniformNames=r.map((I=>`u_${I}_t`)),this.type=u,this.useIntegerZoom=m,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=r.map((I=>({name:`a_${I}`,type:"Float32",components:u==="color"?4:2,offset:0}))),this.paintVertexArray=new x}populatePaintArray(t,r,u,m,v){const x=this.expression.evaluate(new On(this.zoom),r,{},m,[],v),I=this.expression.evaluate(new On(this.zoom+1),r,{},m,[],v),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,x,I)}updatePaintArray(t,r,u,m){const v=this.expression.evaluate({zoom:this.zoom},u,m),x=this.expression.evaluate({zoom:this.zoom+1},u,m);this._setPaintValue(t,r,v,x)}_setPaintValue(t,r,u,m){if(this.type==="color"){const v=Jh(u),x=Jh(m);for(let I=t;I<r;I++)this.paintVertexArray.emplace(I,v[0],v[1],x[0],x[1])}else{for(let v=t;v<r;v++)this.paintVertexArray.emplace(v,u,m);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(m))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const u=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,m=nt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(m)}getBinding(t,r,u){return new lr(t,r)}}class Yr{constructor(t,r,u,m,v,x){this.expression=t,this.type=r,this.useIntegerZoom=u,this.zoom=m,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(t,r,u){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(m,t,r.patterns&&r.patterns[this.layerId],u)}updatePaintArray(t,r,u,m,v){this._setPaintValues(t,r,u.patterns&&u.patterns[this.layerId],v)}_setPaintValues(t,r,u,m){if(!m||!u)return;const{min:v,mid:x,max:I}=u,M=m[v],z=m[x],V=m[I];if(M&&z&&V)for(let G=t;G<r;G++)this.zoomInPaintVertexArray.emplace(G,z.tl[0],z.tl[1],z.br[0],z.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],z.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(G,z.tl[0],z.tl[1],z.br[0],z.br[1],V.tl[0],V.tl[1],V.br[0],V.br[1],z.pixelRatio,V.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Bo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Bo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ba{constructor(t,r,u){this.binders={},this._buffers=[];const m=[];for(const v in t.paint._values){if(!u(v))continue;const x=t.paint.get(v);if(!(x instanceof ws&&so(x.property.specification)))continue;const I=Qh(v,t.type),M=x.value,z=x.property.specification.type,V=x.property.useIntegerZoom,G=x.property.specification["property-type"],X=G==="cross-faded"||G==="cross-faded-data-driven";if(M.kind==="constant")this.binders[v]=X?new ql(M.value,I):new br(M.value,I,z),m.push(`/u_${v}`);else if(M.kind==="source"||X){const J=sh(v,z,"source");this.binders[v]=X?new Yr(M,z,V,r,J,t.id):new go(M,I,z,J),m.push(`/a_${v}`)}else{const J=sh(v,z,"composite");this.binders[v]=new wa(M,I,z,V,r,J),m.push(`/z_${v}`)}}this.cacheKey=m.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof go||r instanceof wa?r.maxValue:0}populatePaintArrays(t,r,u,m,v){for(const x in this.binders){const I=this.binders[x];(I instanceof go||I instanceof wa||I instanceof Yr)&&I.populatePaintArray(t,r,u,m,v)}}setConstantPatternPositions(t,r){for(const u in this.binders){const m=this.binders[u];m instanceof ql&&m.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,u,m,v){let x=!1;for(const I in t){const M=r.getPositions(I);for(const z of M){const V=u.feature(z.index);for(const G in this.binders){const X=this.binders[G];if((X instanceof go||X instanceof wa||X instanceof Yr)&&X.expression.isStateDependent===!0){const J=m.paint.get(G);X.expression=J.value,X.updatePaintArray(z.start,z.end,V,t[I],v),x=!0}}}}return x}defines(){const t=[];for(const r in this.binders){const u=this.binders[r];(u instanceof br||u instanceof ql)&&t.push(...u.uniformNames.map((m=>`#define HAS_UNIFORM_${m}`)))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const u=this.binders[r];if(u instanceof go||u instanceof wa)for(let m=0;m<u.paintVertexAttributes.length;m++)t.push(u.paintVertexAttributes[m].name);else if(u instanceof Yr)for(let m=0;m<Bo.members.length;m++)t.push(Bo.members[m].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const u=this.binders[r];if(u instanceof br||u instanceof ql||u instanceof wa)for(const m of u.uniformNames)t.push(m)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const u=[];for(const m in this.binders){const v=this.binders[m];if(v instanceof br||v instanceof ql||v instanceof wa){for(const x of v.uniformNames)if(r[x]){const I=v.getBinding(t,r[x],x);u.push({name:x,property:m,binding:I})}}}return u}setUniforms(t,r,u,m){for(const{name:v,property:x,binding:I}of r)this.binders[x].setUniform(I,m,u.get(x),v)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const u=this.binders[r];if(t&&u instanceof Yr){const m=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(u instanceof go||u instanceof wa)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(t){for(const r in this.binders){const u=this.binders[r];(u instanceof go||u instanceof wa||u instanceof Yr)&&u.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof go||r instanceof wa||r instanceof Yr)&&r.destroy()}}}class yo{constructor(t,r,u=(()=>!0)){this.programConfigurations={};for(const m of t)this.programConfigurations[m.id]=new ba(m,r,u);this.needsUpload=!1,this._featureMap=new jo,this._bufferOffset=0}populatePaintArrays(t,r,u,m,v,x){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(t,r,m,v,x);r.id!==void 0&&this._featureMap.add(r.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,u,m){for(const v of u)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(t,this._featureMap,r,v,m)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Qh(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function sh(n,t,r){const u={color:{source:oe,composite:gn},number:{source:kt,composite:oe}},m=(function(v){return{"line-pattern":{source:ks,composite:ks},"fill-pattern":{source:ks,composite:ks},"fill-extrusion-pattern":{source:ks,composite:ks}}[v]})(n);return m&&m[r]||u[t][r]}zt("ConstantBinder",br),zt("CrossFadedConstantBinder",ql),zt("SourceExpressionBinder",go),zt("CrossFadedCompositeBinder",Yr),zt("CompositeExpressionBinder",wa),zt("ProgramConfiguration",ba,{omit:["_buffers"]}),zt("ProgramConfigurationSet",yo);const Wi=8192,ah=Math.pow(2,14)-1,ef=-ah-1;function Gl(n){const t=Wi/n.extent,r=n.loadGeometry();for(let u=0;u<r.length;u++){const m=r[u];for(let v=0;v<m.length;v++){const x=m[v],I=Math.round(x.x*t),M=Math.round(x.y*t);x.x=nt(I,ef,ah),x.y=nt(M,ef,ah),(I<x.x||I>x.x+1||M<x.y||M>x.y+1)&&Vt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function $l(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?Gl(n):[]}}function Ec(n,t,r,u,m){n.emplaceBack(2*t+(u+1)/2,2*r+(m+1)/2)}class oh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Pr,this.indexArray=new Zs,this.segments=new Ln,this.programConfigurations=new yo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,u){const m=this.layers[0],v=[];let x=null,I=!1;m.type==="circle"&&(x=m.layout.get("circle-sort-key"),I=!x.isConstant());for(const{feature:M,id:z,index:V,sourceLayerIndex:G}of t){const X=this.layers[0]._featureFilter.needGeometry,J=$l(M,X);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),J,u))continue;const ie=I?x.evaluate(J,{},u):void 0,le={id:z,properties:M.properties,type:M.type,sourceLayerIndex:G,index:V,geometry:X?J.geometry:Gl(M),patterns:{},sortKey:ie};v.push(le)}I&&v.sort(((M,z)=>M.sortKey-z.sortKey));for(const M of v){const{geometry:z,index:V,sourceLayerIndex:G}=M,X=t[V].feature;this.addFeature(M,z,V,u),r.featureIndex.insert(X,z,V,G,this.index)}}update(t,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Mr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,u,m){for(const v of r)for(const x of v){const I=x.x,M=x.y;if(I<0||I>=Wi||M<0||M>=Wi)continue;const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),V=z.vertexLength;Ec(this.layoutVertexArray,I,M,-1,-1),Ec(this.layoutVertexArray,I,M,1,-1),Ec(this.layoutVertexArray,I,M,1,1),Ec(this.layoutVertexArray,I,M,-1,1),this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+3,V+2),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},m)}}function tf(n,t){for(let r=0;r<n.length;r++)if(_u(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(_u(n,t[r]))return!0;return!!Zu(n,t)}function Ic(n,t,r){return!!_u(n,t)||!!Tc(t,n,r)}function nf(n,t){if(n.length===1)return sf(t,n[0]);for(let r=0;r<t.length;r++){const u=t[r];for(let m=0;m<u.length;m++)if(_u(n,u[m]))return!0}for(let r=0;r<n.length;r++)if(sf(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(Zu(n,t[r]))return!0;return!1}function lh(n,t,r){if(n.length>1){if(Zu(n,t))return!0;for(let u=0;u<t.length;u++)if(Tc(t[u],n,r))return!0}for(let u=0;u<n.length;u++)if(Tc(n[u],t,r))return!0;return!1}function Zu(n,t){if(n.length===0||t.length===0)return!1;for(let r=0;r<n.length-1;r++){const u=n[r],m=n[r+1];for(let v=0;v<t.length-1;v++)if(Zf(u,m,t[v],t[v+1]))return!0}return!1}function Zf(n,t,r,u){return ct(n,r,u)!==ct(t,r,u)&&ct(n,t,r)!==ct(n,t,u)}function Tc(n,t,r){const u=r*r;if(t.length===1)return n.distSqr(t[0])<u;for(let m=1;m<t.length;m++)if(rf(n,t[m-1],t[m])<u)return!0;return!1}function rf(n,t,r){const u=t.distSqr(r);if(u===0)return n.distSqr(t);const m=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/u;return n.distSqr(m<0?t:m>1?r:r.sub(t)._mult(m)._add(t))}function sf(n,t){let r,u,m,v=!1;for(let x=0;x<n.length;x++){r=n[x];for(let I=0,M=r.length-1;I<r.length;M=I++)u=r[I],m=r[M],u.y>t.y!=m.y>t.y&&t.x<(m.x-u.x)*(t.y-u.y)/(m.y-u.y)+u.x&&(v=!v)}return v}function _u(n,t){let r=!1;for(let u=0,m=n.length-1;u<n.length;m=u++){const v=n[u],x=n[m];v.y>t.y!=x.y>t.y&&t.x<(x.x-v.x)*(t.y-v.y)/(x.y-v.y)+v.x&&(r=!r)}return r}function Hf(n,t,r){const u=r[0],m=r[2];if(n.x<u.x&&t.x<u.x||n.x>m.x&&t.x>m.x||n.y<u.y&&t.y<u.y||n.y>m.y&&t.y>m.y)return!1;const v=ct(n,t,r[0]);return v!==ct(n,t,r[1])||v!==ct(n,t,r[2])||v!==ct(n,t,r[3])}function vu(n,t,r){const u=t.paint.get(n).value;return u.kind==="constant"?u.value:r.programConfigurations.get(t.id).getMaxValue(n)}function Cc(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Pc(n,t,r,u,m){if(!t[0]&&!t[1])return n;const v=B.convert(t)._mult(m);r==="viewport"&&v._rotate(-u);const x=[];for(let I=0;I<n.length;I++)x.push(n[I].sub(v));return x}let af,Xf;zt("CircleBucket",oh,{omit:["layers"]});var Wf={get paint(){return Xf=Xf||new _({"circle-radius":new sn(We.paint_circle["circle-radius"]),"circle-color":new sn(We.paint_circle["circle-color"]),"circle-blur":new sn(We.paint_circle["circle-blur"]),"circle-opacity":new sn(We.paint_circle["circle-opacity"]),"circle-translate":new Ot(We.paint_circle["circle-translate"]),"circle-translate-anchor":new Ot(We.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ot(We.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ot(We.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new sn(We.paint_circle["circle-stroke-width"]),"circle-stroke-color":new sn(We.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new sn(We.paint_circle["circle-stroke-opacity"])})},get layout(){return af=af||new _({"circle-sort-key":new sn(We.layout_circle["circle-sort-key"])})}},rs=1e-6,Hu=typeof Float32Array<"u"?Float32Array:Array;function uh(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function of(n,t,r){var u=t[0],m=t[1],v=t[2],x=t[3],I=t[4],M=t[5],z=t[6],V=t[7],G=t[8],X=t[9],J=t[10],ie=t[11],le=t[12],ye=t[13],be=t[14],Ue=t[15],Ie=r[0],Be=r[1],Qe=r[2],ft=r[3];return n[0]=Ie*u+Be*I+Qe*G+ft*le,n[1]=Ie*m+Be*M+Qe*X+ft*ye,n[2]=Ie*v+Be*z+Qe*J+ft*be,n[3]=Ie*x+Be*V+Qe*ie+ft*Ue,n[4]=(Ie=r[4])*u+(Be=r[5])*I+(Qe=r[6])*G+(ft=r[7])*le,n[5]=Ie*m+Be*M+Qe*X+ft*ye,n[6]=Ie*v+Be*z+Qe*J+ft*be,n[7]=Ie*x+Be*V+Qe*ie+ft*Ue,n[8]=(Ie=r[8])*u+(Be=r[9])*I+(Qe=r[10])*G+(ft=r[11])*le,n[9]=Ie*m+Be*M+Qe*X+ft*ye,n[10]=Ie*v+Be*z+Qe*J+ft*be,n[11]=Ie*x+Be*V+Qe*ie+ft*Ue,n[12]=(Ie=r[12])*u+(Be=r[13])*I+(Qe=r[14])*G+(ft=r[15])*le,n[13]=Ie*m+Be*M+Qe*X+ft*ye,n[14]=Ie*v+Be*z+Qe*J+ft*be,n[15]=Ie*x+Be*V+Qe*ie+ft*Ue,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Xu,ch=of;function hh(n,t,r){var u=t[0],m=t[1],v=t[2],x=t[3];return n[0]=r[0]*u+r[4]*m+r[8]*v+r[12]*x,n[1]=r[1]*u+r[5]*m+r[9]*v+r[13]*x,n[2]=r[2]*u+r[6]*m+r[10]*v+r[14]*x,n[3]=r[3]*u+r[7]*m+r[11]*v+r[15]*x,n}Xu=new Hu(4),Hu!=Float32Array&&(Xu[0]=0,Xu[1]=0,Xu[2]=0,Xu[3]=0);class rp extends o{constructor(t){super(t,Wf)}createBucket(t){return new oh(t)}queryRadius(t){const r=t;return vu("circle-radius",this,r)+vu("circle-stroke-width",this,r)+Cc(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,u,m,v,x,I,M){const z=Pc(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,I),V=this.paint.get("circle-radius").evaluate(r,u)+this.paint.get("circle-stroke-width").evaluate(r,u),G=this.paint.get("circle-pitch-alignment")==="map",X=G?z:(function(ie,le){return ie.map((ye=>Yf(ye,le)))})(z,M),J=G?V*I:V;for(const ie of m)for(const le of ie){const ye=G?le:Yf(le,M);let be=J;const Ue=hh([],[le.x,le.y,0,1],M);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?be*=Ue[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(be*=x.cameraToCenterDistance/Ue[3]),Ic(X,ye,be))return!0}return!1}}function Yf(n,t){const r=hh([],[n.x,n.y,0,1],t);return new B(r[0]/r[3],r[1]/r[3])}class Ua extends oh{}let fh;zt("HeatmapBucket",Ua,{omit:["layers"]});var dh={get paint(){return fh=fh||new _({"heatmap-radius":new sn(We.paint_heatmap["heatmap-radius"]),"heatmap-weight":new sn(We.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ot(We.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xc(We.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ot(We.paint_heatmap["heatmap-opacity"])})}};function ph(n,{width:t,height:r},u,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==t*r*u)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${t*r*u}`)}else m=new Uint8Array(t*r*u);return n.width=t,n.height=r,n.data=m,n}function lf(n,{width:t,height:r},u){if(t===n.width&&r===n.height)return;const m=ph({},{width:t,height:r},u);mh(n,m,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,r)},u),n.width=t,n.height=r,n.data=m.data}function mh(n,t,r,u,m,v){if(m.width===0||m.height===0)return t;if(m.width>n.width||m.height>n.height||r.x>n.width-m.width||r.y>n.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>t.width||m.height>t.height||u.x>t.width-m.width||u.y>t.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const x=n.data,I=t.data;if(x===I)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<m.height;M++){const z=((r.y+M)*n.width+r.x)*v,V=((u.y+M)*t.width+u.x)*v;for(let G=0;G<m.width*v;G++)I[V+G]=x[z+G]}return t}class xu{constructor(t,r){ph(this,t,1,r)}resize(t){lf(this,t,1)}clone(){return new xu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,u,m,v){mh(t,r,u,m,v,1)}}class Or{constructor(t,r){ph(this,t,4,r)}resize(t){lf(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Or({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,u,m,v){mh(t,r,u,m,v,4)}}function gh(n){const t={},r=n.resolution||256,u=n.clips?n.clips.length:1,m=n.image||new Or({width:r,height:u});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const v=(x,I,M)=>{t[n.evaluationKey]=M;const z=n.expression.evaluate(t);m.data[x+I+0]=Math.floor(255*z.r/z.a),m.data[x+I+1]=Math.floor(255*z.g/z.a),m.data[x+I+2]=Math.floor(255*z.b/z.a),m.data[x+I+3]=Math.floor(255*z.a)};if(n.clips)for(let x=0,I=0;x<u;++x,I+=4*r)for(let M=0,z=0;M<r;M++,z+=4){const V=M/(r-1),{start:G,end:X}=n.clips[x];v(I,z,G*(1-V)+X*V)}else for(let x=0,I=0;x<r;x++,I+=4)v(0,I,x/(r-1));return m}zt("AlphaImage",xu),zt("RGBAImage",Or);const Mc="big-fb";class sp extends o{createBucket(t){return new Ua(t)}constructor(t){super(t,dh),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Mc)&&this.heatmapFbos.delete(Mc)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let uf;var Kf={get paint(){return uf=uf||new _({"hillshade-illumination-direction":new Ot(We.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ot(We.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ot(We.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ot(We.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ot(We.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ot(We.paint_hillshade["hillshade-accent-color"])})}};class Jf extends o{constructor(t){super(t,Kf)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Qf=T([{name:"a_pos",components:2,type:"Int16"}],4),{members:ed}=Qf;function td(n,t,r=2){const u=t&&t.length,m=u?t[0]*r:n.length;let v=Is(n,0,m,r,!0);const x=[];if(!v||v.next===v.prev)return x;let I,M,z;if(u&&(v=(function(V,G,X,J){const ie=[];for(let le=0,ye=G.length;le<ye;le++){const be=Is(V,G[le]*J,le<ye-1?G[le+1]*J:V.length,J,!1);be===be.next&&(be.steiner=!0),ie.push(od(be))}ie.sort(cf);for(let le=0;le<ie.length;le++)X=ad(ie[le],X);return X})(n,t,v,r)),n.length>80*r){I=1/0,M=1/0;let V=-1/0,G=-1/0;for(let X=r;X<m;X+=r){const J=n[X],ie=n[X+1];J<I&&(I=J),ie<M&&(M=ie),J>V&&(V=J),ie>G&&(G=ie)}z=Math.max(V-I,G-M),z=z!==0?32767/z:0}return Wu(v,x,r,I,M,z,0),x}function Is(n,t,r,u,m){let v;if(m===(function(x,I,M,z){let V=0;for(let G=I,X=M-z;G<M;G+=z)V+=(x[X]-x[G])*(x[G+1]+x[X+1]),X=G;return V})(n,t,r,u)>0)for(let x=t;x<r;x+=u)v=Rc(x/u|0,n[x],n[x+1],v);else for(let x=r-u;x>=t;x-=u)v=Rc(x/u|0,n[x],n[x+1],v);return v&&Yu(v,v.next)&&(ka(v),v=v.next),v}function ur(n,t){if(!n)return n;t||(t=n);let r,u=n;do if(r=!1,u.steiner||!Yu(u,u.next)&&Zi(u.prev,u,u.next)!==0)u=u.next;else{if(ka(u),u=t=u.prev,u===u.next)break;r=!0}while(r||u!==t);return t}function Wu(n,t,r,u,m,v,x){if(!n)return;!x&&v&&(function(M,z,V,G){let X=M;do X.z===0&&(X.z=yh(X.x,X.y,z,V,G)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==M);X.prevZ.nextZ=null,X.prevZ=null,(function(J){let ie,le=1;do{let ye,be=J;J=null;let Ue=null;for(ie=0;be;){ie++;let Ie=be,Be=0;for(let ft=0;ft<le&&(Be++,Ie=Ie.nextZ,Ie);ft++);let Qe=le;for(;Be>0||Qe>0&&Ie;)Be!==0&&(Qe===0||!Ie||be.z<=Ie.z)?(ye=be,be=be.nextZ,Be--):(ye=Ie,Ie=Ie.nextZ,Qe--),Ue?Ue.nextZ=ye:J=ye,ye.prevZ=Ue,Ue=ye;be=Ie}Ue.nextZ=null,le*=2}while(ie>1)})(X)})(n,u,m,v);let I=n;for(;n.prev!==n.next;){const M=n.prev,z=n.next;if(v?id(n,u,m,v):nd(n))t.push(M.i,n.i,z.i),ka(n),n=z.next,I=z.next;else if((n=z)===I){x?x===1?Wu(n=rd(ur(n),t),t,r,u,m,v,2):x===2&&sd(n,t,r,u,m,v):Wu(ur(n),t,r,u,m,v,1);break}}}function nd(n){const t=n.prev,r=n,u=n.next;if(Zi(t,r,u)>=0)return!1;const m=t.x,v=r.x,x=u.x,I=t.y,M=r.y,z=u.y,V=m<v?m<x?m:x:v<x?v:x,G=I<M?I<z?I:z:M<z?M:z,X=m>v?m>x?m:x:v>x?v:x,J=I>M?I>z?I:z:M>z?M:z;let ie=u.next;for(;ie!==t;){if(ie.x>=V&&ie.x<=X&&ie.y>=G&&ie.y<=J&&Zl(m,I,v,M,x,z,ie.x,ie.y)&&Zi(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function id(n,t,r,u){const m=n.prev,v=n,x=n.next;if(Zi(m,v,x)>=0)return!1;const I=m.x,M=v.x,z=x.x,V=m.y,G=v.y,X=x.y,J=I<M?I<z?I:z:M<z?M:z,ie=V<G?V<X?V:X:G<X?G:X,le=I>M?I>z?I:z:M>z?M:z,ye=V>G?V>X?V:X:G>X?G:X,be=yh(J,ie,t,r,u),Ue=yh(le,ye,t,r,u);let Ie=n.prevZ,Be=n.nextZ;for(;Ie&&Ie.z>=be&&Be&&Be.z<=Ue;){if(Ie.x>=J&&Ie.x<=le&&Ie.y>=ie&&Ie.y<=ye&&Ie!==m&&Ie!==x&&Zl(I,V,M,G,z,X,Ie.x,Ie.y)&&Zi(Ie.prev,Ie,Ie.next)>=0||(Ie=Ie.prevZ,Be.x>=J&&Be.x<=le&&Be.y>=ie&&Be.y<=ye&&Be!==m&&Be!==x&&Zl(I,V,M,G,z,X,Be.x,Be.y)&&Zi(Be.prev,Be,Be.next)>=0))return!1;Be=Be.nextZ}for(;Ie&&Ie.z>=be;){if(Ie.x>=J&&Ie.x<=le&&Ie.y>=ie&&Ie.y<=ye&&Ie!==m&&Ie!==x&&Zl(I,V,M,G,z,X,Ie.x,Ie.y)&&Zi(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.prevZ}for(;Be&&Be.z<=Ue;){if(Be.x>=J&&Be.x<=le&&Be.y>=ie&&Be.y<=ye&&Be!==m&&Be!==x&&Zl(I,V,M,G,z,X,Be.x,Be.y)&&Zi(Be.prev,Be,Be.next)>=0)return!1;Be=Be.nextZ}return!0}function rd(n,t){let r=n;do{const u=r.prev,m=r.next.next;!Yu(u,m)&&Ac(u,r,r.next,m)&&wu(u,m)&&wu(m,u)&&(t.push(u.i,r.i,m.i),ka(r),ka(r.next),r=n=m),r=r.next}while(r!==n);return ur(r)}function sd(n,t,r,u,m,v){let x=n;do{let I=x.next.next;for(;I!==x.prev;){if(x.i!==I.i&&ff(x,I)){let M=df(x,I);return x=ur(x,x.next),M=ur(M,M.next),Wu(x,t,r,u,m,v,0),void Wu(M,t,r,u,m,v,0)}I=I.next}x=x.next}while(x!==n)}function cf(n,t){return n.x-t.x}function ad(n,t){const r=(function(m,v){let x=v;const I=m.x,M=m.y;let z,V=-1/0;do{if(M<=x.y&&M>=x.next.y&&x.next.y!==x.y){const le=x.x+(M-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(le<=I&&le>V&&(V=le,z=x.x<x.next.x?x:x.next,le===I))return z}x=x.next}while(x!==v);if(!z)return null;const G=z,X=z.x,J=z.y;let ie=1/0;x=z;do{if(I>=x.x&&x.x>=X&&I!==x.x&&Zl(M<J?I:V,M,X,J,M<J?V:I,M,x.x,x.y)){const le=Math.abs(M-x.y)/(I-x.x);wu(x,m)&&(le<ie||le===ie&&(x.x>z.x||x.x===z.x&&hf(z,x)))&&(z=x,ie=le)}x=x.next}while(x!==G);return z})(n,t);if(!r)return t;const u=df(r,n);return ur(u,u.next),ur(r,r.next)}function hf(n,t){return Zi(n.prev,n,t.prev)<0&&Zi(t.next,n,n.next)<0}function yh(n,t,r,u,m){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*m|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-u)*m|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function od(n){let t=n,r=n;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==n);return r}function Zl(n,t,r,u,m,v,x,I){return(m-x)*(t-I)>=(n-x)*(v-I)&&(n-x)*(u-I)>=(r-x)*(t-I)&&(r-x)*(v-I)>=(m-x)*(u-I)}function ff(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!(function(r,u){let m=r;do{if(m.i!==r.i&&m.next.i!==r.i&&m.i!==u.i&&m.next.i!==u.i&&Ac(m,m.next,r,u))return!0;m=m.next}while(m!==r);return!1})(n,t)&&(wu(n,t)&&wu(t,n)&&(function(r,u){let m=r,v=!1;const x=(r.x+u.x)/2,I=(r.y+u.y)/2;do m.y>I!=m.next.y>I&&m.next.y!==m.y&&x<(m.next.x-m.x)*(I-m.y)/(m.next.y-m.y)+m.x&&(v=!v),m=m.next;while(m!==r);return v})(n,t)&&(Zi(n.prev,n,t.prev)||Zi(n,t.prev,t))||Yu(n,t)&&Zi(n.prev,n,n.next)>0&&Zi(t.prev,t,t.next)>0)}function Zi(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function Yu(n,t){return n.x===t.x&&n.y===t.y}function Ac(n,t,r,u){const m=Lc(Zi(n,t,r)),v=Lc(Zi(n,t,u)),x=Lc(Zi(r,u,n)),I=Lc(Zi(r,u,t));return m!==v&&x!==I||!(m!==0||!_h(n,r,t))||!(v!==0||!_h(n,u,t))||!(x!==0||!_h(r,n,u))||!(I!==0||!_h(r,t,u))}function _h(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function Lc(n){return n>0?1:n<0?-1:0}function wu(n,t){return Zi(n.prev,n,n.next)<0?Zi(n,t,n.next)>=0&&Zi(n,n.prev,t)>=0:Zi(n,t,n.prev)<0||Zi(n,n.next,t)<0}function df(n,t){const r=pf(n.i,n.x,n.y),u=pf(t.i,t.x,t.y),m=n.next,v=t.prev;return n.next=t,t.prev=n,r.next=m,m.prev=r,u.next=r,r.prev=u,v.next=u,u.prev=v,u}function Rc(n,t,r,u){const m=pf(n,t,r);return u?(m.next=u.next,m.prev=u,u.next.prev=m,u.next=m):(m.prev=m,m.next=m),m}function ka(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function pf(n,t,r){return{i:n,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function vh(n,t,r){const u=r.patternDependencies;let m=!1;for(const v of t){const x=v.paint.get(`${n}-pattern`);x.isConstant()||(m=!0);const I=x.constantOr(null);I&&(m=!0,u[I.to]=!0,u[I.from]=!0)}return m}function Nc(n,t,r,u,m){const v=m.patternDependencies;for(const x of t){const I=x.paint.get(`${n}-pattern`).value;if(I.kind!=="constant"){let M=I.evaluate({zoom:u-1},r,{},m.availableImages),z=I.evaluate({zoom:u},r,{},m.availableImages),V=I.evaluate({zoom:u+1},r,{},m.availableImages);M=M&&M.name?M.name:M,z=z&&z.name?z.name:z,V=V&&V.name?V.name:V,v[M]=!0,v[z]=!0,v[V]=!0,r.patterns[x.id]={min:M,mid:z,max:V}}}return r}class xh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ga,this.indexArray=new Zs,this.indexArray2=new Xi,this.programConfigurations=new yo(t.layers,t.zoom),this.segments=new Ln,this.segments2=new Ln,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,u){this.hasPattern=vh("fill",this.layers,r);const m=this.layers[0].layout.get("fill-sort-key"),v=!m.isConstant(),x=[];for(const{feature:I,id:M,index:z,sourceLayerIndex:V}of t){const G=this.layers[0]._featureFilter.needGeometry,X=$l(I,G);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),X,u))continue;const J=v?m.evaluate(X,{},u,r.availableImages):void 0,ie={id:M,properties:I.properties,type:I.type,sourceLayerIndex:V,index:z,geometry:G?X.geometry:Gl(I),patterns:{},sortKey:J};x.push(ie)}v&&x.sort(((I,M)=>I.sortKey-M.sortKey));for(const I of x){const{geometry:M,index:z,sourceLayerIndex:V}=I;if(this.hasPattern){const G=Nc("fill",this.layers,I,this.zoom,r);this.patternFeatures.push(G)}else this.addFeature(I,M,z,u,{});r.featureIndex.insert(t[z].feature,M,z,V,this.index)}}update(t,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u)}addFeatures(t,r,u){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ed),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,u,m,v){for(const x of Ro(r,500)){let I=0;for(const J of x)I+=J.length;const M=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),z=M.vertexLength,V=[],G=[];for(const J of x){if(J.length===0)continue;J!==x[0]&&G.push(V.length/2);const ie=this.segments2.prepareSegment(J.length,this.layoutVertexArray,this.indexArray2),le=ie.vertexLength;this.layoutVertexArray.emplaceBack(J[0].x,J[0].y),this.indexArray2.emplaceBack(le+J.length-1,le),V.push(J[0].x),V.push(J[0].y);for(let ye=1;ye<J.length;ye++)this.layoutVertexArray.emplaceBack(J[ye].x,J[ye].y),this.indexArray2.emplaceBack(le+ye-1,le+ye),V.push(J[ye].x),V.push(J[ye].y);ie.vertexLength+=J.length,ie.primitiveLength+=J.length}const X=td(V,G);for(let J=0;J<X.length;J+=3)this.indexArray.emplaceBack(z+X[J],z+X[J+1],z+X[J+2]);M.vertexLength+=I,M.primitiveLength+=X.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,v,m)}}let mf,Ku;zt("FillBucket",xh,{omit:["layers","patternFeatures"]});var ss={get paint(){return Ku=Ku||new _({"fill-antialias":new Ot(We.paint_fill["fill-antialias"]),"fill-opacity":new sn(We.paint_fill["fill-opacity"]),"fill-color":new sn(We.paint_fill["fill-color"]),"fill-outline-color":new sn(We.paint_fill["fill-outline-color"]),"fill-translate":new Ot(We.paint_fill["fill-translate"]),"fill-translate-anchor":new Ot(We.paint_fill["fill-translate-anchor"]),"fill-pattern":new jl(We.paint_fill["fill-pattern"])})},get layout(){return mf=mf||new _({"fill-sort-key":new sn(We.layout_fill["fill-sort-key"])})}};class ap extends o{constructor(t){super(t,ss)}recalculate(t,r){super.recalculate(t,r);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new xh(t)}queryRadius(){return Cc(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,u,m,v,x,I){return nf(Pc(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,I),m)}isTileClipped(){return!0}}const op=T([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),wh=T([{name:"a_centroid",components:2,type:"Int16"}],4),{members:as}=op;var Hl={},Yt=ne,bu=Xl;function Xl(n,t,r,u,m){this.properties={},this.extent=r,this.type=0,this._pbf=n,this._geometry=-1,this._keys=u,this._values=m,n.readFields(ld,this,t)}function ld(n,t,r){n==1?t.id=r.readVarint():n==2?(function(u,m){for(var v=u.readVarint()+u.pos;u.pos<v;){var x=m._keys[u.readVarint()],I=m._values[u.readVarint()];m.properties[x]=I}})(r,t):n==3?t.type=r.readVarint():n==4&&(t._geometry=r.pos)}function lp(n){for(var t,r,u=0,m=0,v=n.length,x=v-1;m<v;x=m++)u+=((r=n[x]).x-(t=n[m]).x)*(t.y+r.y);return u}Xl.types=["Unknown","Point","LineString","Polygon"],Xl.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,r=n.readVarint()+n.pos,u=1,m=0,v=0,x=0,I=[];n.pos<r;){if(m<=0){var M=n.readVarint();u=7&M,m=M>>3}if(m--,u===1||u===2)v+=n.readSVarint(),x+=n.readSVarint(),u===1&&(t&&I.push(t),t=[]),t.push(new Yt(v,x));else{if(u!==7)throw new Error("unknown command "+u);t&&t.push(t[0].clone())}}return t&&I.push(t),I},Xl.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,r=1,u=0,m=0,v=0,x=1/0,I=-1/0,M=1/0,z=-1/0;n.pos<t;){if(u<=0){var V=n.readVarint();r=7&V,u=V>>3}if(u--,r===1||r===2)(m+=n.readSVarint())<x&&(x=m),m>I&&(I=m),(v+=n.readSVarint())<M&&(M=v),v>z&&(z=v);else if(r!==7)throw new Error("unknown command "+r)}return[x,M,I,z]},Xl.prototype.toGeoJSON=function(n,t,r){var u,m,v=this.extent*Math.pow(2,r),x=this.extent*n,I=this.extent*t,M=this.loadGeometry(),z=Xl.types[this.type];function V(J){for(var ie=0;ie<J.length;ie++){var le=J[ie];J[ie]=[360*(le.x+x)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(le.y+I)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(u=0;u<M.length;u++)G[u]=M[u][0];V(M=G);break;case 2:for(u=0;u<M.length;u++)V(M[u]);break;case 3:for(M=(function(J){var ie=J.length;if(ie<=1)return[J];for(var le,ye,be=[],Ue=0;Ue<ie;Ue++){var Ie=lp(J[Ue]);Ie!==0&&(ye===void 0&&(ye=Ie<0),ye===Ie<0?(le&&be.push(le),le=[J[Ue]]):le.push(J[Ue]))}return le&&be.push(le),be})(M),u=0;u<M.length;u++)for(m=0;m<M[u].length;m++)V(M[u][m])}M.length===1?M=M[0]:z="Multi"+z;var X={type:"Feature",geometry:{type:z,coordinates:M},properties:this.properties};return"id"in this&&(X.id=this.id),X};var Dc=bu,zc=bh;function bh(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(ud,this,t),this.length=this._features.length}function ud(n,t,r){n===15?t.version=r.readVarint():n===1?t.name=r.readString():n===5?t.extent=r.readVarint():n===2?t._features.push(r.pos):n===3?t._keys.push(r.readString()):n===4&&t._values.push((function(u){for(var m=null,v=u.readVarint()+u.pos;u.pos<v;){var x=u.readVarint()>>3;m=x===1?u.readString():x===2?u.readFloat():x===3?u.readDouble():x===4?u.readVarint64():x===5?u.readVarint():x===6?u.readSVarint():x===7?u.readBoolean():null}return m})(r))}bh.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new Dc(this._pbf,t,this.extent,this._keys,this._values)};var cd=zc;function hd(n,t,r){if(n===3){var u=new cd(r,r.readVarint()+r.pos);u.length&&(t[u.name]=u)}}Hl.VectorTile=function(n,t){this.layers=n.readFields(hd,{},t)},Hl.VectorTileFeature=bu,Hl.VectorTileLayer=zc;const gf=Hl.VectorTileFeature.types,Oc=Math.pow(2,13);function cr(n,t,r,u,m,v,x,I){n.emplaceBack(t,r,2*Math.floor(u*Oc)+x,m*Oc*2,v*Oc*2,Math.round(I))}class Sa{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new is,this.centroidVertexArray=new $i,this.indexArray=new Zs,this.programConfigurations=new yo(t.layers,t.zoom),this.segments=new Ln,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,u){this.features=[],this.hasPattern=vh("fill-extrusion",this.layers,r);for(const{feature:m,id:v,index:x,sourceLayerIndex:I}of t){const M=this.layers[0]._featureFilter.needGeometry,z=$l(m,M);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),z,u))continue;const V={id:v,sourceLayerIndex:I,index:x,geometry:M?z.geometry:Gl(m),properties:m.properties,type:m.type,patterns:{}};this.hasPattern?this.features.push(Nc("fill-extrusion",this.layers,V,this.zoom,r)):this.addFeature(V,V.geometry,x,u,{}),r.featureIndex.insert(m,V.geometry,x,I,this.index,!0)}}addFeatures(t,r,u){for(const m of this.features){const{geometry:v}=m;this.addFeature(m,v,m.index,r,u)}}update(t,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,as),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,wh.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,u,m,v){for(const x of Ro(r,500)){const I={x:0,y:0,vertexCount:0};let M=0;for(const ie of x)M+=ie.length;let z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ie of x){if(ie.length===0||fd(ie))continue;let le=0;for(let ye=0;ye<ie.length;ye++){const be=ie[ye];if(ye>=1){const Ue=ie[ye-1];if(!Wl(be,Ue)){z.vertexLength+4>Ln.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ie=be.sub(Ue)._perp()._unit(),Be=Ue.dist(be);le+Be>32768&&(le=0),cr(this.layoutVertexArray,be.x,be.y,Ie.x,Ie.y,0,0,le),cr(this.layoutVertexArray,be.x,be.y,Ie.x,Ie.y,0,1,le),I.x+=2*be.x,I.y+=2*be.y,I.vertexCount+=2,le+=Be,cr(this.layoutVertexArray,Ue.x,Ue.y,Ie.x,Ie.y,0,0,le),cr(this.layoutVertexArray,Ue.x,Ue.y,Ie.x,Ie.y,0,1,le),I.x+=2*Ue.x,I.y+=2*Ue.y,I.vertexCount+=2;const Qe=z.vertexLength;this.indexArray.emplaceBack(Qe,Qe+2,Qe+1),this.indexArray.emplaceBack(Qe+1,Qe+2,Qe+3),z.vertexLength+=4,z.primitiveLength+=2}}}}if(z.vertexLength+M>Ln.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),gf[t.type]!=="Polygon")continue;const V=[],G=[],X=z.vertexLength;for(const ie of x)if(ie.length!==0){ie!==x[0]&&G.push(V.length/2);for(let le=0;le<ie.length;le++){const ye=ie[le];cr(this.layoutVertexArray,ye.x,ye.y,0,0,1,1,0),I.x+=ye.x,I.y+=ye.y,I.vertexCount+=1,V.push(ye.x),V.push(ye.y)}}const J=td(V,G);for(let ie=0;ie<J.length;ie+=3)this.indexArray.emplaceBack(X+J[ie],X+J[ie+2],X+J[ie+1]);z.primitiveLength+=J.length/3,z.vertexLength+=M;for(let ie=0;ie<I.vertexCount;ie++){const le=Math.floor(I.x/I.vertexCount),ye=Math.floor(I.y/I.vertexCount);this.centroidVertexArray.emplaceBack(le,ye)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,v,m)}}function Wl(n,t){return n.x===t.x&&(n.x<0||n.x>Wi)||n.y===t.y&&(n.y<0||n.y>Wi)}function fd(n){return n.every((t=>t.x<0))||n.every((t=>t.x>Wi))||n.every((t=>t.y<0))||n.every((t=>t.y>Wi))}let yf;zt("FillExtrusionBucket",Sa,{omit:["layers","features"]});var _o={get paint(){return yf=yf||new _({"fill-extrusion-opacity":new Ot(We["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new sn(We["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ot(We["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ot(We["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new jl(We["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new sn(We["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new sn(We["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ot(We["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class dd extends o{constructor(t){super(t,_o)}createBucket(t){return new Sa(t)}queryRadius(){return Cc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,u,m,v,x,I,M){const z=Pc(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,I),V=this.paint.get("fill-extrusion-height").evaluate(r,u),G=this.paint.get("fill-extrusion-base").evaluate(r,u),X=(function(ie,le,ye,be){const Ue=[];for(const Ie of ie){const Be=[Ie.x,Ie.y,0,1];hh(Be,Be,le),Ue.push(new B(Be[0]/Be[3],Be[1]/Be[3]))}return Ue})(z,M),J=(function(ie,le,ye,be){const Ue=[],Ie=[],Be=be[8]*le,Qe=be[9]*le,ft=be[10]*le,Dt=be[11]*le,cn=be[8]*ye,Nt=be[9]*ye,Mt=be[10]*ye,Xt=be[11]*ye;for(const qt of ie){const Bt=[],st=[];for(const Qt of qt){const Zt=Qt.x,wn=Qt.y,bi=be[0]*Zt+be[4]*wn+be[12],_i=be[1]*Zt+be[5]*wn+be[13],Fr=be[2]*Zt+be[6]*wn+be[14],qo=be[3]*Zt+be[7]*wn+be[15],us=Fr+ft,Br=qo+Dt,Js=bi+cn,Qs=_i+Nt,ea=Fr+Mt,nr=qo+Xt,jr=new B((bi+Be)/Br,(_i+Qe)/Br);jr.z=us/Br,Bt.push(jr);const Ps=new B(Js/nr,Qs/nr);Ps.z=ea/nr,st.push(Ps)}Ue.push(Bt),Ie.push(st)}return[Ue,Ie]})(m,G,V,M);return(function(ie,le,ye){let be=1/0;nf(ye,le)&&(be=pd(ye,le[0]));for(let Ue=0;Ue<le.length;Ue++){const Ie=le[Ue],Be=ie[Ue];for(let Qe=0;Qe<Ie.length-1;Qe++){const ft=Ie[Qe],Dt=[ft,Ie[Qe+1],Be[Qe+1],Be[Qe],ft];tf(ye,Dt)&&(be=Math.min(be,pd(ye,Dt)))}}return be!==1/0&&be})(J[0],J[1],X)}}function Hs(n,t){return n.x*t.x+n.y*t.y}function pd(n,t){if(n.length===1){let r=0;const u=t[r++];let m;for(;!m||u.equals(m);)if(m=t[r++],!m)return 1/0;for(;r<t.length;r++){const v=t[r],x=n[0],I=m.sub(u),M=v.sub(u),z=x.sub(u),V=Hs(I,I),G=Hs(I,M),X=Hs(M,M),J=Hs(z,I),ie=Hs(z,M),le=V*X-G*G,ye=(X*J-G*ie)/le,be=(V*ie-G*J)/le,Ue=u.z*(1-ye-be)+m.z*ye+v.z*be;if(isFinite(Ue))return Ue}return 1/0}{let r=1/0;for(const u of t)r=Math.min(r,u.z);return r}}const md=T([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:gd}=md,yd=T([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:_d}=yd,up=Hl.VectorTileFeature.types,kh=Math.cos(Math.PI/180*37.5),Sh=Math.pow(2,14)/.5;class Xs{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new ya,this.layoutVertexArray2=new Fo,this.indexArray=new Zs,this.programConfigurations=new yo(t.layers,t.zoom),this.segments=new Ln,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,u){this.hasPattern=vh("line",this.layers,r);const m=this.layers[0].layout.get("line-sort-key"),v=!m.isConstant(),x=[];for(const{feature:I,id:M,index:z,sourceLayerIndex:V}of t){const G=this.layers[0]._featureFilter.needGeometry,X=$l(I,G);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),X,u))continue;const J=v?m.evaluate(X,{},u):void 0,ie={id:M,properties:I.properties,type:I.type,sourceLayerIndex:V,index:z,geometry:G?X.geometry:Gl(I),patterns:{},sortKey:J};x.push(ie)}v&&x.sort(((I,M)=>I.sortKey-M.sortKey));for(const I of x){const{geometry:M,index:z,sourceLayerIndex:V}=I;if(this.hasPattern){const G=Nc("line",this.layers,I,this.zoom,r);this.patternFeatures.push(G)}else this.addFeature(I,M,z,u,{});r.featureIndex.insert(t[z].feature,M,z,V,this.index)}}update(t,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u)}addFeatures(t,r,u){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,_d)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gd),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,u,m,v){const x=this.layers[0].layout,I=x.get("line-join").evaluate(t,{}),M=x.get("line-cap"),z=x.get("line-miter-limit"),V=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const G of r)this.addLine(G,t,I,M,z,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,v,m)}addLine(t,r,u,m,v,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<t.length-1;be++)this.totalDistance+=t[be].dist(t[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=up[r.type]==="Polygon";let M=t.length;for(;M>=2&&t[M-1].equals(t[M-2]);)M--;let z=0;for(;z<M-1&&t[z].equals(t[z+1]);)z++;if(M<(I?3:2))return;u==="bevel"&&(v=1.05);const V=this.overscaling<=16?15*Wi/(512*this.overscaling):0,G=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let X,J,ie,le,ye;this.e1=this.e2=-1,I&&(X=t[M-2],ye=t[z].sub(X)._unit()._perp());for(let be=z;be<M;be++){if(ie=be===M-1?I?t[z+1]:void 0:t[be+1],ie&&t[be].equals(ie))continue;ye&&(le=ye),X&&(J=X),X=t[be],ye=ie?ie.sub(X)._unit()._perp():le,le=le||ye;let Ue=le.add(ye);Ue.x===0&&Ue.y===0||Ue._unit();const Ie=le.x*ye.x+le.y*ye.y,Be=Ue.x*ye.x+Ue.y*ye.y,Qe=Be!==0?1/Be:1/0,ft=2*Math.sqrt(2-2*Be),Dt=Be<kh&&J&&ie,cn=le.x*ye.y-le.y*ye.x>0;if(Dt&&be>z){const Xt=X.dist(J);if(Xt>2*V){const qt=X.sub(X.sub(J)._mult(V/Xt)._round());this.updateDistance(J,qt),this.addCurrentVertex(qt,le,0,0,G),J=qt}}const Nt=J&&ie;let Mt=Nt?u:I?"butt":m;if(Nt&&Mt==="round"&&(Qe<x?Mt="miter":Qe<=2&&(Mt="fakeround")),Mt==="miter"&&Qe>v&&(Mt="bevel"),Mt==="bevel"&&(Qe>2&&(Mt="flipbevel"),Qe<v&&(Mt="miter")),J&&this.updateDistance(J,X),Mt==="miter")Ue._mult(Qe),this.addCurrentVertex(X,Ue,0,0,G);else if(Mt==="flipbevel"){if(Qe>100)Ue=ye.mult(-1);else{const Xt=Qe*le.add(ye).mag()/le.sub(ye).mag();Ue._perp()._mult(Xt*(cn?-1:1))}this.addCurrentVertex(X,Ue,0,0,G),this.addCurrentVertex(X,Ue.mult(-1),0,0,G)}else if(Mt==="bevel"||Mt==="fakeround"){const Xt=-Math.sqrt(Qe*Qe-1),qt=cn?Xt:0,Bt=cn?0:Xt;if(J&&this.addCurrentVertex(X,le,qt,Bt,G),Mt==="fakeround"){const st=Math.round(180*ft/Math.PI/20);for(let Qt=1;Qt<st;Qt++){let Zt=Qt/st;if(Zt!==.5){const bi=Zt-.5;Zt+=Zt*bi*(Zt-1)*((1.0904+Ie*(Ie*(3.55645-1.43519*Ie)-3.2452))*bi*bi+(.848013+Ie*(.215638*Ie-1.06021)))}const wn=ye.sub(le)._mult(Zt)._add(le)._unit()._mult(cn?-1:1);this.addHalfVertex(X,wn.x,wn.y,!1,cn,0,G)}}ie&&this.addCurrentVertex(X,ye,-qt,-Bt,G)}else if(Mt==="butt")this.addCurrentVertex(X,Ue,0,0,G);else if(Mt==="square"){const Xt=J?1:-1;this.addCurrentVertex(X,Ue,Xt,Xt,G)}else Mt==="round"&&(J&&(this.addCurrentVertex(X,le,0,0,G),this.addCurrentVertex(X,le,1,1,G,!0)),ie&&(this.addCurrentVertex(X,ye,-1,-1,G,!0),this.addCurrentVertex(X,ye,0,0,G)));if(Dt&&be<M-1){const Xt=X.dist(ie);if(Xt>2*V){const qt=X.add(ie.sub(X)._mult(V/Xt)._round());this.updateDistance(X,qt),this.addCurrentVertex(qt,ye,0,0,G),X=qt}}}}addCurrentVertex(t,r,u,m,v,x=!1){const I=r.y*m-r.x,M=-r.y-r.x*m;this.addHalfVertex(t,r.x+r.y*u,r.y-r.x*u,x,!1,u,v),this.addHalfVertex(t,I,M,x,!0,-m,v),this.distance>Sh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,u,m,v,x))}addHalfVertex({x:t,y:r},u,m,v,x,I,M){const z=.5*(this.lineClips?this.scaledDistance*(Sh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(v?1:0),(r<<1)+(x?1:0),Math.round(63*u)+128,Math.round(63*m)+128,1+(I===0?0:I<0?-1:1)|(63&z)<<2,z>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const V=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,V),M.primitiveLength++),x?this.e2=V:this.e1=V}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let ni,Ar;zt("LineBucket",Xs,{omit:["layers","patternFeatures"]});var hr={get paint(){return Ar=Ar||new _({"line-opacity":new sn(We.paint_line["line-opacity"]),"line-color":new sn(We.paint_line["line-color"]),"line-translate":new Ot(We.paint_line["line-translate"]),"line-translate-anchor":new Ot(We.paint_line["line-translate-anchor"]),"line-width":new sn(We.paint_line["line-width"]),"line-gap-width":new sn(We.paint_line["line-gap-width"]),"line-offset":new sn(We.paint_line["line-offset"]),"line-blur":new sn(We.paint_line["line-blur"]),"line-dasharray":new yu(We.paint_line["line-dasharray"]),"line-pattern":new jl(We.paint_line["line-pattern"]),"line-gradient":new xc(We.paint_line["line-gradient"])})},get layout(){return ni=ni||new _({"line-cap":new Ot(We.layout_line["line-cap"]),"line-join":new sn(We.layout_line["line-join"]),"line-miter-limit":new Ot(We.layout_line["line-miter-limit"]),"line-round-limit":new Ot(We.layout_line["line-round-limit"]),"line-sort-key":new sn(We.layout_line["line-sort-key"])})}};class Kr extends sn{possiblyEvaluate(t,r){return r=new On(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,u,m){return r=Ge({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,u,m)}}let os;class Ju extends o{constructor(t){super(t,hr),this.gradientVersion=0,os||(os=new Kr(hr.paint.properties["line-width"].specification),os.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!(function(u){return u._styleExpression!==void 0})(r)&&r._styleExpression.expression instanceof Ya,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=os.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Xs(t)}queryRadius(t){const r=t,u=kr(vu("line-width",this,r),vu("line-gap-width",this,r)),m=vu("line-offset",this,r);return u/2+Math.abs(m)+Cc(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,u,m,v,x,I){const M=Pc(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,I),z=I/2*kr(this.paint.get("line-width").evaluate(r,u),this.paint.get("line-gap-width").evaluate(r,u)),V=this.paint.get("line-offset").evaluate(r,u);return V&&(m=(function(G,X){const J=[];for(let ie=0;ie<G.length;ie++){const le=G[ie],ye=[];for(let be=0;be<le.length;be++){const Ue=le[be-1],Ie=le[be],Be=le[be+1],Qe=be===0?new B(0,0):Ie.sub(Ue)._unit()._perp(),ft=be===le.length-1?new B(0,0):Be.sub(Ie)._unit()._perp(),Dt=Qe._add(ft)._unit(),cn=Dt.x*ft.x+Dt.y*ft.y;cn!==0&&Dt._mult(1/cn),ye.push(Dt._mult(X)._add(Ie))}J.push(ye)}return J})(m,V*I)),(function(G,X,J){for(let ie=0;ie<X.length;ie++){const le=X[ie];if(G.length>=3){for(let ye=0;ye<le.length;ye++)if(_u(G,le[ye]))return!0}if(lh(G,le,J))return!0}return!1})(M,m,z)}isTileClipped(){return!0}}function kr(n,t){return t>0?t+2*n:n}const Fc=T([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ku=T([{name:"a_projected_pos",components:3,type:"Float32"}],4);T([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Eh=T([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);T([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ih=T([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Bc=T([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ws(n,t,r){return n.sections.forEach((u=>{u.text=(function(m,v,x){const I=v.layout.get("text-transform").evaluate(x,{});return I==="uppercase"?m=m.toLocaleUpperCase():I==="lowercase"&&(m=m.toLocaleLowerCase()),ui.applyArabicShaping&&(m=ui.applyArabicShaping(m)),m})(u.text,t,r)})),n}T([{name:"triangle",components:3,type:"Uint16"}]),T([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),T([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),T([{type:"Float32",name:"offsetX"}]),T([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),T([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Su={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Di=24,Uo=$n,jc=function(n,t,r,u,m){var v,x,I=8*m-u-1,M=(1<<I)-1,z=M>>1,V=-7,G=m-1,X=-1,J=n[t+G];for(G+=X,v=J&(1<<-V)-1,J>>=-V,V+=I;V>0;v=256*v+n[t+G],G+=X,V-=8);for(x=v&(1<<-V)-1,v>>=-V,V+=u;V>0;x=256*x+n[t+G],G+=X,V-=8);if(v===0)v=1-z;else{if(v===M)return x?NaN:1/0*(J?-1:1);x+=Math.pow(2,u),v-=z}return(J?-1:1)*x*Math.pow(2,v-u)},Th=function(n,t,r,u,m,v){var x,I,M,z=8*v-m-1,V=(1<<z)-1,G=V>>1,X=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,J=0,ie=1,le=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(I=isNaN(t)?1:0,x=V):(x=Math.floor(Math.log(t)/Math.LN2),t*(M=Math.pow(2,-x))<1&&(x--,M*=2),(t+=x+G>=1?X/M:X*Math.pow(2,1-G))*M>=2&&(x++,M/=2),x+G>=V?(I=0,x=V):x+G>=1?(I=(t*M-1)*Math.pow(2,m),x+=G):(I=t*Math.pow(2,G-1)*Math.pow(2,m),x=0));m>=8;n[r+J]=255&I,J+=ie,I/=256,m-=8);for(x=x<<m|I,z+=m;z>0;n[r+J]=255&x,J+=ie,x/=256,z-=8);n[r+J-ie]|=128*le};function $n(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}$n.Varint=0,$n.Fixed64=1,$n.Bytes=2,$n.Fixed32=5;var Qu=4294967296,cl=1/Qu,Uc=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ea(n){return n.type===$n.Bytes?n.readVarint()+n.pos:n.pos+1}function Yl(n,t,r){return r?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function Vc(n,t,r){var u=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(u);for(var m=r.pos-1;m>=n;m--)r.buf[m+u]=r.buf[m]}function Ch(n,t){for(var r=0;r<n.length;r++)t.writeVarint(n[r])}function Ts(n,t){for(var r=0;r<n.length;r++)t.writeSVarint(n[r])}function Kl(n,t){for(var r=0;r<n.length;r++)t.writeFloat(n[r])}function vo(n,t){for(var r=0;r<n.length;r++)t.writeDouble(n[r])}function Ys(n,t){for(var r=0;r<n.length;r++)t.writeBoolean(n[r])}function vd(n,t){for(var r=0;r<n.length;r++)t.writeFixed32(n[r])}function _f(n,t){for(var r=0;r<n.length;r++)t.writeSFixed32(n[r])}function vf(n,t){for(var r=0;r<n.length;r++)t.writeFixed64(n[r])}function cp(n,t){for(var r=0;r<n.length;r++)t.writeSFixed64(n[r])}function xo(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function Eu(n,t,r){n[r]=t,n[r+1]=t>>>8,n[r+2]=t>>>16,n[r+3]=t>>>24}function Ph(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}$n.prototype={destroy:function(){this.buf=null},readFields:function(n,t,r){for(r=r||this.length;this.pos<r;){var u=this.readVarint(),m=u>>3,v=this.pos;this.type=7&u,n(m,t,this),this.pos===v&&this.skip(u)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=xo(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Ph(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=xo(this.buf,this.pos)+xo(this.buf,this.pos+4)*Qu;return this.pos+=8,n},readSFixed64:function(){var n=xo(this.buf,this.pos)+Ph(this.buf,this.pos+4)*Qu;return this.pos+=8,n},readFloat:function(){var n=jc(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=jc(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,r,u=this.buf;return t=127&(r=u[this.pos++]),r<128?t:(t|=(127&(r=u[this.pos++]))<<7,r<128?t:(t|=(127&(r=u[this.pos++]))<<14,r<128?t:(t|=(127&(r=u[this.pos++]))<<21,r<128?t:(function(m,v,x){var I,M,z=x.buf;if(I=(112&(M=z[x.pos++]))>>4,M<128||(I|=(127&(M=z[x.pos++]))<<3,M<128)||(I|=(127&(M=z[x.pos++]))<<10,M<128)||(I|=(127&(M=z[x.pos++]))<<17,M<128)||(I|=(127&(M=z[x.pos++]))<<24,M<128)||(I|=(1&(M=z[x.pos++]))<<31,M<128))return Yl(m,I,v);throw new Error("Expected varint not more than 10 bytes")})(t|=(15&(r=u[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&Uc?(function(r,u,m){return Uc.decode(r.subarray(u,m))})(this.buf,t,n):(function(r,u,m){for(var v="",x=u;x<m;){var I,M,z,V=r[x],G=null,X=V>239?4:V>223?3:V>191?2:1;if(x+X>m)break;X===1?V<128&&(G=V):X===2?(192&(I=r[x+1]))==128&&(G=(31&V)<<6|63&I)<=127&&(G=null):X===3?(M=r[x+2],(192&(I=r[x+1]))==128&&(192&M)==128&&((G=(15&V)<<12|(63&I)<<6|63&M)<=2047||G>=55296&&G<=57343)&&(G=null)):X===4&&(M=r[x+2],z=r[x+3],(192&(I=r[x+1]))==128&&(192&M)==128&&(192&z)==128&&((G=(15&V)<<18|(63&I)<<12|(63&M)<<6|63&z)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,X=1):G>65535&&(G-=65536,v+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),v+=String.fromCharCode(G),x+=X}return v})(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==$n.Bytes)return n.push(this.readVarint(t));var r=Ea(this);for(n=n||[];this.pos<r;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==$n.Bytes)return n.push(this.readSVarint());var t=Ea(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==$n.Bytes)return n.push(this.readBoolean());var t=Ea(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==$n.Bytes)return n.push(this.readFloat());var t=Ea(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==$n.Bytes)return n.push(this.readDouble());var t=Ea(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==$n.Bytes)return n.push(this.readFixed32());var t=Ea(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==$n.Bytes)return n.push(this.readSFixed32());var t=Ea(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==$n.Bytes)return n.push(this.readFixed64());var t=Ea(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==$n.Bytes)return n.push(this.readSFixed64());var t=Ea(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===$n.Varint)for(;this.buf[this.pos++]>127;);else if(t===$n.Bytes)this.pos=this.readVarint()+this.pos;else if(t===$n.Fixed32)this.pos+=4;else{if(t!==$n.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Eu(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Eu(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Eu(this.buf,-1&n,this.pos),Eu(this.buf,Math.floor(n*cl),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Eu(this.buf,-1&n,this.pos),Eu(this.buf,Math.floor(n*cl),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?(function(t,r){var u,m;if(t>=0?(u=t%4294967296|0,m=t/4294967296|0):(m=~(-t/4294967296),4294967295^(u=~(-t%4294967296))?u=u+1|0:(u=0,m=m+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),(function(v,x,I){I.buf[I.pos++]=127&v|128,v>>>=7,I.buf[I.pos++]=127&v|128,v>>>=7,I.buf[I.pos++]=127&v|128,v>>>=7,I.buf[I.pos++]=127&v|128,I.buf[I.pos]=127&(v>>>=7)})(u,0,r),(function(v,x){var I=(7&v)<<4;x.buf[x.pos++]|=I|((v>>>=3)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v)))))})(m,r)})(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=(function(u,m,v){for(var x,I,M=0;M<m.length;M++){if((x=m.charCodeAt(M))>55295&&x<57344){if(!I){x>56319||M+1===m.length?(u[v++]=239,u[v++]=191,u[v++]=189):I=x;continue}if(x<56320){u[v++]=239,u[v++]=191,u[v++]=189,I=x;continue}x=I-55296<<10|x-56320|65536,I=null}else I&&(u[v++]=239,u[v++]=191,u[v++]=189,I=null);x<128?u[v++]=x:(x<2048?u[v++]=x>>6|192:(x<65536?u[v++]=x>>12|224:(u[v++]=x>>18|240,u[v++]=x>>12&63|128),u[v++]=x>>6&63|128),u[v++]=63&x|128)}return v})(this.buf,n,this.pos);var r=this.pos-t;r>=128&&Vc(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(n){this.realloc(4),Th(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Th(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=n[r]},writeRawMessage:function(n,t){this.pos++;var r=this.pos;n(t,this);var u=this.pos-r;u>=128&&Vc(r,u,this),this.pos=r-1,this.writeVarint(u),this.pos+=u},writeMessage:function(n,t,r){this.writeTag(n,$n.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,Ch,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,Ts,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,Ys,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,Kl,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,vo,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,vd,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,_f,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,vf,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,cp,t)},writeBytesField:function(n,t){this.writeTag(n,$n.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,$n.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,$n.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,$n.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,$n.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,$n.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,$n.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,$n.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,$n.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,$n.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var hl=K(Uo);const qc=3;function Iu(n,t,r){n===1&&r.readMessage(xd,t)}function xd(n,t,r){if(n===3){const{id:u,bitmap:m,width:v,height:x,left:I,top:M,advance:z}=r.readMessage(wd,{});t.push({id:u,bitmap:new xu({width:v+2*qc,height:x+2*qc},m),metrics:{width:v,height:x,left:I,top:M,advance:z}})}}function wd(n,t,r){n===1?t.id=r.readVarint():n===2?t.bitmap=r.readBytes():n===3?t.width=r.readVarint():n===4?t.height=r.readVarint():n===5?t.left=r.readSVarint():n===6?t.top=r.readSVarint():n===7&&(t.advance=r.readVarint())}const Mh=qc;function Gc(n){let t=0,r=0;for(const x of n)t+=x.w*x.h,r=Math.max(r,x.w);n.sort(((x,I)=>I.h-x.h));const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let m=0,v=0;for(const x of n)for(let I=u.length-1;I>=0;I--){const M=u[I];if(!(x.w>M.w||x.h>M.h)){if(x.x=M.x,x.y=M.y,v=Math.max(v,x.y+x.h),m=Math.max(m,x.x+x.w),x.w===M.w&&x.h===M.h){const z=u.pop();I<u.length&&(u[I]=z)}else x.h===M.h?(M.x+=x.w,M.w-=x.w):x.w===M.w?(M.y+=x.h,M.h-=x.h):(u.push({x:M.x+x.w,y:M.y,w:M.w-x.w,h:x.h}),M.y+=x.h,M.h-=x.h);break}}return{w:m,h:v,fill:t/(m*v)||0}}const Cs=1;class xf{constructor(t,{pixelRatio:r,version:u,stretchX:m,stretchY:v,content:x,textFitWidth:I,textFitHeight:M}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=m,this.stretchY=v,this.content=x,this.version=u,this.textFitWidth=I,this.textFitHeight=M}get tl(){return[this.paddedRect.x+Cs,this.paddedRect.y+Cs]}get br(){return[this.paddedRect.x+this.paddedRect.w-Cs,this.paddedRect.y+this.paddedRect.h-Cs]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Cs)/this.pixelRatio,(this.paddedRect.h-2*Cs)/this.pixelRatio]}}class wf{constructor(t,r){const u={},m={};this.haveRenderCallbacks=[];const v=[];this.addImages(t,u,v),this.addImages(r,m,v);const{w:x,h:I}=Gc(v),M=new Or({width:x||1,height:I||1});for(const z in t){const V=t[z],G=u[z].paddedRect;Or.copy(V.data,M,{x:0,y:0},{x:G.x+Cs,y:G.y+Cs},V.data)}for(const z in r){const V=r[z],G=m[z].paddedRect,X=G.x+Cs,J=G.y+Cs,ie=V.data.width,le=V.data.height;Or.copy(V.data,M,{x:0,y:0},{x:X,y:J},V.data),Or.copy(V.data,M,{x:0,y:le-1},{x:X,y:J-1},{width:ie,height:1}),Or.copy(V.data,M,{x:0,y:0},{x:X,y:J+le},{width:ie,height:1}),Or.copy(V.data,M,{x:ie-1,y:0},{x:X-1,y:J},{width:1,height:le}),Or.copy(V.data,M,{x:0,y:0},{x:X+ie,y:J},{width:1,height:le})}this.image=M,this.iconPositions=u,this.patternPositions=m}addImages(t,r,u){for(const m in t){const v=t[m],x={x:0,y:0,w:v.data.width+2*Cs,h:v.data.height+2*Cs};u.push(x),r[m]=new xf(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),r),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),r)}patchUpdatedImage(t,r,u){if(!t||!r||t.version===r.version)return;t.version=r.version;const[m,v]=t.tl;u.update(r.data,void 0,{x:m,y:v})}}var fl;zt("ImagePosition",xf),zt("ImageAtlas",wf),R.ah=void 0,(fl=R.ah||(R.ah={}))[fl.none=0]="none",fl[fl.horizontal=1]="horizontal",fl[fl.vertical=2]="vertical",fl[fl.horizontalOnly=3]="horizontalOnly";const wo=-17;class $c{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const u=new $c;return u.scale=t||1,u.fontStack=r,u}static forImage(t){const r=new $c;return r.imageName=t,r}}class bo{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const u=new bo;for(let m=0;m<t.sections.length;m++){const v=t.sections[m];v.image?u.addImageSection(v):u.addTextSection(v,r)}return u}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let r="";for(let u=0;u<t.length;u++){const m=t.charCodeAt(u+1)||null,v=t.charCodeAt(u-1)||null;r+=m&&ul(m)&&!Su[t[u+1]]||v&&ul(v)&&!Su[t[u-1]]||!Su[t[u]]?t[u]:Su[t[u]]}return r})(this.text)}trim(){let t=0;for(let u=0;u<this.text.length&&qi[this.text.charCodeAt(u)];u++)t++;let r=this.text.length;for(let u=this.text.length-1;u>=0&&u>=t&&qi[this.text.charCodeAt(u)];u--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const u=new bo;return u.text=this.text.substring(t,r),u.sectionIndex=this.sectionIndex.slice(t,r),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,r)=>Math.max(t,this.sections[r].scale)),0)}addTextSection(t,r){this.text+=t.text,this.sections.push($c.forText(t.scale,t.fontStack||r));const u=this.sections.length-1;for(let m=0;m<t.text.length;++m)this.sectionIndex.push(u)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Vt("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push($c.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Vt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zc(n,t,r,u,m,v,x,I,M,z,V,G,X,J,ie){const le=bo.fromFeature(n,m);let ye;G===R.ah.vertical&&le.verticalizePunctuation();const{processBidirectionalText:be,processStyledBidirectionalText:Ue}=ui;if(be&&le.sections.length===1){ye=[];const Qe=be(le.toString(),Ks(le,z,v,t,u,J));for(const ft of Qe){const Dt=new bo;Dt.text=ft,Dt.sections=le.sections;for(let cn=0;cn<ft.length;cn++)Dt.sectionIndex.push(0);ye.push(Dt)}}else if(Ue){ye=[];const Qe=Ue(le.text,le.sectionIndex,Ks(le,z,v,t,u,J));for(const ft of Qe){const Dt=new bo;Dt.text=ft[0],Dt.sectionIndex=ft[1],Dt.sections=le.sections,ye.push(Dt)}}else ye=(function(Qe,ft){const Dt=[],cn=Qe.text;let Nt=0;for(const Mt of ft)Dt.push(Qe.substring(Nt,Mt)),Nt=Mt;return Nt<cn.length&&Dt.push(Qe.substring(Nt,cn.length)),Dt})(le,Ks(le,z,v,t,u,J));const Ie=[],Be={positionedLines:Ie,text:le.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:G,iconsInText:!1,verticalizable:!1};return(function(Qe,ft,Dt,cn,Nt,Mt,Xt,qt,Bt,st,Qt,Zt){let wn=0,bi=wo,_i=0,Fr=0;const qo=qt==="right"?1:qt==="left"?0:.5;let us=0;for(const nr of Nt){nr.trim();const jr=nr.getMaxScale(),Ps=(jr-1)*Di,cs={positionedGlyphs:[],lineOffset:0};Qe.positionedLines[us]=cs;const ta=cs.positionedGlyphs;let hs=0;if(!nr.length()){bi+=Mt,++us;continue}for(let Ia=0;Ia<nr.length();Ia++){const ii=nr.getSection(Ia),Pi=nr.getSectionIndex(Ia),zi=nr.getCharCode(Ia);let qa=0,Yi=null,Bh=null,tu=null,nu=Di;const Go=!(Bt===R.ah.horizontal||!Qt&&!mu(zi)||Qt&&(qi[zi]||(Br=zi,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Br)))));if(ii.imageName){const So=cn[ii.imageName];if(!So)continue;tu=ii.imageName,Qe.iconsInText=Qe.iconsInText||!0,Bh=So.paddedRect;const Jr=So.displaySize;ii.scale=ii.scale*Di/Zt,Yi={width:Jr[0],height:Jr[1],left:Cs,top:-Mh,advance:Go?Jr[1]:Jr[0]},qa=Ps+(Di-Jr[1]*ii.scale),nu=Yi.advance;const Cu=Go?Jr[0]*ii.scale-Di*jr:Jr[1]*ii.scale-Di*jr;Cu>0&&Cu>hs&&(hs=Cu)}else{const So=Dt[ii.fontStack],Jr=So&&So[zi];if(Jr&&Jr.rect)Bh=Jr.rect,Yi=Jr.metrics;else{const Cu=ft[ii.fontStack],Tf=Cu&&Cu[zi];if(!Tf)continue;Yi=Tf.metrics}qa=(jr-ii.scale)*Di}Go?(Qe.verticalizable=!0,ta.push({glyph:zi,imageName:tu,x:wn,y:bi+qa,vertical:Go,scale:ii.scale,fontStack:ii.fontStack,sectionIndex:Pi,metrics:Yi,rect:Bh}),wn+=nu*ii.scale+st):(ta.push({glyph:zi,imageName:tu,x:wn,y:bi+qa,vertical:Go,scale:ii.scale,fontStack:ii.fontStack,sectionIndex:Pi,metrics:Yi,rect:Bh}),wn+=Yi.advance*ii.scale+st)}ta.length!==0&&(_i=Math.max(wn-st,_i),fp(ta,0,ta.length-1,qo,hs)),wn=0;const ko=Mt*jr+hs;cs.lineOffset=Math.max(hs,Ps),bi+=ko,Fr=Math.max(ko,Fr),++us}var Br;const Js=bi-wo,{horizontalAlign:Qs,verticalAlign:ea}=Hc(Xt);(function(nr,jr,Ps,cs,ta,hs,ko,Ia,ii){const Pi=(jr-Ps)*ta;let zi=0;zi=hs!==ko?-Ia*cs-wo:(-cs*ii+.5)*ko;for(const qa of nr)for(const Yi of qa.positionedGlyphs)Yi.x+=Pi,Yi.y+=zi})(Qe.positionedLines,qo,Qs,ea,_i,Fr,Mt,Js,Nt.length),Qe.top+=-ea*Js,Qe.bottom=Qe.top+Js,Qe.left+=-Qs*_i,Qe.right=Qe.left+_i})(Be,t,r,u,ye,x,I,M,G,z,X,ie),!(function(Qe){for(const ft of Qe)if(ft.positionedGlyphs.length!==0)return!1;return!0})(Ie)&&Be}const qi={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},hp={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},bd={40:!0};function kd(n,t,r,u,m,v){if(t.imageName){const x=u[t.imageName];return x?x.displaySize[0]*t.scale*Di/v+m:0}{const x=r[t.fontStack],I=x&&x[n];return I?I.metrics.advance*t.scale+m:0}}function Sd(n,t,r,u){const m=Math.pow(n-t,2);return u?n<t?m/2:2*m:m+Math.abs(r)*r}function Ed(n,t,r){let u=0;return n===10&&(u-=1e4),r&&(u+=150),n!==40&&n!==65288||(u+=50),t!==41&&t!==65289||(u+=50),u}function bf(n,t,r,u,m,v){let x=null,I=Sd(t,r,m,v);for(const M of u){const z=Sd(t-M.x,r,m,v)+M.badness;z<=I&&(x=M,I=z)}return{index:n,x:t,priorBreak:x,badness:I}}function Id(n){return n?Id(n.priorBreak).concat(n.index):[]}function Ks(n,t,r,u,m,v){if(!n)return[];const x=[],I=(function(G,X,J,ie,le,ye){let be=0;for(let Ue=0;Ue<G.length();Ue++){const Ie=G.getSection(Ue);be+=kd(G.getCharCode(Ue),Ie,ie,le,X,ye)}return be/Math.max(1,Math.ceil(be/J))})(n,t,r,u,m,v),M=n.text.indexOf("")>=0;let z=0;for(let G=0;G<n.length();G++){const X=n.getSection(G),J=n.getCharCode(G);if(qi[J]||(z+=kd(J,X,u,m,t,v)),G<n.length()-1){const ie=!((V=J)<11904)&&(!!Dn["CJK Compatibility Forms"](V)||!!Dn["CJK Compatibility"](V)||!!Dn["CJK Strokes"](V)||!!Dn["CJK Symbols and Punctuation"](V)||!!Dn["Enclosed CJK Letters and Months"](V)||!!Dn["Halfwidth and Fullwidth Forms"](V)||!!Dn["Ideographic Description Characters"](V)||!!Dn["Vertical Forms"](V)||pu.test(String.fromCodePoint(V)));(hp[J]||ie||X.imageName||G!==n.length()-2&&bd[n.getCharCode(G+1)])&&x.push(bf(G+1,z,I,x,Ed(J,n.getCharCode(G+1),ie&&M),!1))}}var V;return Id(bf(n.length(),z,I,x,0,!0))}function Hc(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function fp(n,t,r,u,m){if(!u&&!m)return;const v=n[r],x=(n[r].x+v.metrics.advance*v.scale)*u;for(let I=t;I<=r;I++)n[I].x-=x,n[I].y+=m}function Jl(n,t,r){const{horizontalAlign:u,verticalAlign:m}=Hc(r),v=t[0]-n.displaySize[0]*u,x=t[1]-n.displaySize[1]*m;return{image:n,top:x,bottom:x+n.displaySize[1],left:v,right:v+n.displaySize[0]}}function Xc(n){var t,r;let u=n.left,m=n.top,v=n.right-u,x=n.bottom-m;const I=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",M=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",z=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(M==="proportional"){if(I==="stretchOnly"&&v/x<z||I==="proportional"){const V=Math.ceil(x*z);u*=V/v,v=V}}else if(I==="proportional"&&M==="stretchOnly"&&z!==0&&v/x>z){const V=Math.ceil(v/z);m*=V/x,x=V}return{x1:u,y1:m,x2:u+v,y2:m+x}}function Ql(n,t,r,u,m,v){const x=n.image;let I;if(x.content){const ye=x.content,be=x.pixelRatio||1;I=[ye[0]/be,ye[1]/be,x.displaySize[0]-ye[2]/be,x.displaySize[1]-ye[3]/be]}const M=t.left*v,z=t.right*v;let V,G,X,J;r==="width"||r==="both"?(J=m[0]+M-u[3],G=m[0]+z+u[1]):(J=m[0]+(M+z-x.displaySize[0])/2,G=J+x.displaySize[0]);const ie=t.top*v,le=t.bottom*v;return r==="height"||r==="both"?(V=m[1]+ie-u[0],X=m[1]+le+u[2]):(V=m[1]+(ie+le-x.displaySize[1])/2,X=V+x.displaySize[1]),{image:x,top:V,right:G,bottom:X,left:J,collisionPadding:I}}const eu=255,Va=128,Vo=eu*Va;function Td(n,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new On(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:m}=r;let v=0;for(;v<u.length&&u[v]<=n;)v++;v=Math.max(0,v-1);let x=v;for(;x<u.length&&u[x]<n+1;)x++;x=Math.min(u.length-1,x);const I=u[v],M=u[x];return r.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:M,interpolationType:m}:{kind:"camera",minZoom:I,maxZoom:M,minSize:r.evaluate(new On(I)),maxSize:r.evaluate(new On(M)),interpolationType:m}}}function Wc(n,t,r){let u="never";const m=n.get(t);return m?u=m:n.get(r)&&(u="always"),u}const dp=Hl.VectorTileFeature.types,Cd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Yc(n,t,r,u,m,v,x,I,M,z,V,G,X){const J=I?Math.min(Vo,Math.round(I[0])):0,ie=I?Math.min(Vo,Math.round(I[1])):0;n.emplaceBack(t,r,Math.round(32*u),Math.round(32*m),v,x,(J<<1)+(M?1:0),ie,16*z,16*V,256*G,256*X)}function ec(n,t,r){n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r)}function Ah(n){for(const t of n.sections)if(Oo(t.text))return!0;return!1}class Lh{constructor(t){this.layoutVertexArray=new $s,this.indexArray=new Zs,this.programConfigurations=t,this.segments=new Ln,this.dynamicLayoutVertexArray=new Ba,this.opacityVertexArray=new Wr,this.hasVisibleVertices=!1,this.placedSymbolArray=new li}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,u,m){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ku.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Cd,!0),this.opacityVertexBuffer.itemSize=1),(u||m)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}zt("SymbolBuffers",Lh);class Kc{constructor(t,r,u){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new u,this.segments=new Ln,this.collisionVertexArray=new _a}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Eh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}zt("CollisionBuffers",Kc);class tc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((x=>x.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=uh([]),this.placementViewportMatrix=uh([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Td(this.zoom,r["text-size"]),this.iconSizeData=Td(this.zoom,r["icon-size"]);const u=this.layers[0].layout,m=u.get("symbol-sort-key"),v=u.get("symbol-z-order");this.canOverlap=Wc(u,"text-overlap","text-allow-overlap")!=="never"||Wc(u,"icon-overlap","icon-allow-overlap")!=="never"||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!m.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map((x=>R.ah[x]))),this.stateDependentLayerIds=this.layers.filter((x=>x.isStateDependent())).map((x=>x.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Lh(new yo(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Lh(new yo(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new ci,this.lineVertexArray=new wr,this.symbolInstances=new Pn,this.textAnchorOffsets=new hi}calculateGlyphDependencies(t,r,u,m,v){for(let x=0;x<t.length;x++)if(r[t.charCodeAt(x)]=!0,(u||m)&&v){const I=Su[t.charAt(x)];I&&(r[I.charCodeAt(0)]=!0)}}populate(t,r,u){const m=this.layers[0],v=m.layout,x=v.get("text-font"),I=v.get("text-field"),M=v.get("icon-image"),z=(I.value.kind!=="constant"||I.value.value instanceof yr&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),V=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,G=v.get("symbol-sort-key");if(this.features=[],!z&&!V)return;const X=r.iconDependencies,J=r.glyphDependencies,ie=r.availableImages,le=new On(this.zoom);for(const{feature:ye,id:be,index:Ue,sourceLayerIndex:Ie}of t){const Be=m._featureFilter.needGeometry,Qe=$l(ye,Be);if(!m._featureFilter.filter(le,Qe,u))continue;let ft,Dt;if(Be||(Qe.geometry=Gl(ye)),z){const Nt=m.getValueAndResolveTokens("text-field",Qe,u,ie),Mt=yr.factory(Nt),Xt=this.hasRTLText=this.hasRTLText||Ah(Mt);(!Xt||ui.getRTLTextPluginStatus()==="unavailable"||Xt&&ui.isParsed())&&(ft=Ws(Mt,m,Qe))}if(V){const Nt=m.getValueAndResolveTokens("icon-image",Qe,u,ie);Dt=Nt instanceof Fi?Nt:Fi.fromString(Nt)}if(!ft&&!Dt)continue;const cn=this.sortFeaturesByKey?G.evaluate(Qe,{},u):void 0;if(this.features.push({id:be,text:ft,icon:Dt,index:Ue,sourceLayerIndex:Ie,geometry:Qe.geometry,properties:ye.properties,type:dp[ye.type],sortKey:cn}),Dt&&(X[Dt.name]=!0),ft){const Nt=x.evaluate(Qe,{},u).join(","),Mt=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(R.ah.vertical)>=0;for(const Xt of ft.sections)if(Xt.image)X[Xt.image.name]=!0;else{const qt=vc(ft.toString()),Bt=Xt.fontStack||Nt,st=J[Bt]=J[Bt]||{};this.calculateGlyphDependencies(Xt.text,st,Mt,this.allowVerticalPlacement,qt)}}}v.get("symbol-placement")==="line"&&(this.features=(function(ye){const be={},Ue={},Ie=[];let Be=0;function Qe(Nt){Ie.push(ye[Nt]),Be++}function ft(Nt,Mt,Xt){const qt=Ue[Nt];return delete Ue[Nt],Ue[Mt]=qt,Ie[qt].geometry[0].pop(),Ie[qt].geometry[0]=Ie[qt].geometry[0].concat(Xt[0]),qt}function Dt(Nt,Mt,Xt){const qt=be[Mt];return delete be[Mt],be[Nt]=qt,Ie[qt].geometry[0].shift(),Ie[qt].geometry[0]=Xt[0].concat(Ie[qt].geometry[0]),qt}function cn(Nt,Mt,Xt){const qt=Xt?Mt[0][Mt[0].length-1]:Mt[0][0];return`${Nt}:${qt.x}:${qt.y}`}for(let Nt=0;Nt<ye.length;Nt++){const Mt=ye[Nt],Xt=Mt.geometry,qt=Mt.text?Mt.text.toString():null;if(!qt){Qe(Nt);continue}const Bt=cn(qt,Xt),st=cn(qt,Xt,!0);if(Bt in Ue&&st in be&&Ue[Bt]!==be[st]){const Qt=Dt(Bt,st,Xt),Zt=ft(Bt,st,Ie[Qt].geometry);delete be[Bt],delete Ue[st],Ue[cn(qt,Ie[Zt].geometry,!0)]=Zt,Ie[Qt].geometry=null}else Bt in Ue?ft(Bt,st,Xt):st in be?Dt(Bt,st,Xt):(Qe(Nt),be[Bt]=Be-1,Ue[st]=Be-1)}return Ie.filter((Nt=>Nt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((ye,be)=>ye.sortKey-be.sortKey))}update(t,r,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const u=this.lineVertexArray.length;if(t.segment!==void 0){let m=t.dist(r[t.segment+1]),v=t.dist(r[t.segment]);const x={};for(let I=t.segment+1;I<r.length;I++)x[I]={x:r[I].x,y:r[I].y,tileUnitDistanceFromAnchor:m},I<r.length-1&&(m+=r[I+1].dist(r[I]));for(let I=t.segment||0;I>=0;I--)x[I]={x:r[I].x,y:r[I].y,tileUnitDistanceFromAnchor:v},I>0&&(v+=r[I-1].dist(r[I]));for(let I=0;I<r.length;I++){const M=x[I];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(t,r,u,m,v,x,I,M,z,V,G,X){const J=t.indexArray,ie=t.layoutVertexArray,le=t.segments.prepareSegment(4*r.length,ie,J,this.canOverlap?x.sortKey:void 0),ye=this.glyphOffsetArray.length,be=le.vertexLength,Ue=this.allowVerticalPlacement&&I===R.ah.vertical?Math.PI/2:0,Ie=x.text&&x.text.sections;for(let Be=0;Be<r.length;Be++){const{tl:Qe,tr:ft,bl:Dt,br:cn,tex:Nt,pixelOffsetTL:Mt,pixelOffsetBR:Xt,minFontScaleX:qt,minFontScaleY:Bt,glyphOffset:st,isSDF:Qt,sectionIndex:Zt}=r[Be],wn=le.vertexLength,bi=st[1];Yc(ie,M.x,M.y,Qe.x,bi+Qe.y,Nt.x,Nt.y,u,Qt,Mt.x,Mt.y,qt,Bt),Yc(ie,M.x,M.y,ft.x,bi+ft.y,Nt.x+Nt.w,Nt.y,u,Qt,Xt.x,Mt.y,qt,Bt),Yc(ie,M.x,M.y,Dt.x,bi+Dt.y,Nt.x,Nt.y+Nt.h,u,Qt,Mt.x,Xt.y,qt,Bt),Yc(ie,M.x,M.y,cn.x,bi+cn.y,Nt.x+Nt.w,Nt.y+Nt.h,u,Qt,Xt.x,Xt.y,qt,Bt),ec(t.dynamicLayoutVertexArray,M,Ue),J.emplaceBack(wn,wn+1,wn+2),J.emplaceBack(wn+1,wn+2,wn+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(st[0]),Be!==r.length-1&&Zt===r[Be+1].sectionIndex||t.programConfigurations.populatePaintArrays(ie.length,x,x.index,{},X,Ie&&Ie[Zt])}t.placedSymbolArray.emplaceBack(M.x,M.y,ye,this.glyphOffsetArray.length-ye,be,z,V,M.segment,u?u[0]:0,u?u[1]:0,m[0],m[1],I,0,!1,0,G)}_addCollisionDebugVertex(t,r,u,m,v,x){return r.emplaceBack(0,0),t.emplaceBack(u.x,u.y,m,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(t,r,u,m,v,x,I){const M=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),z=M.vertexLength,V=v.layoutVertexArray,G=v.collisionVertexArray,X=I.anchorX,J=I.anchorY;this._addCollisionDebugVertex(V,G,x,X,J,new B(t,r)),this._addCollisionDebugVertex(V,G,x,X,J,new B(u,r)),this._addCollisionDebugVertex(V,G,x,X,J,new B(u,m)),this._addCollisionDebugVertex(V,G,x,X,J,new B(t,m)),M.vertexLength+=4;const ie=v.indexArray;ie.emplaceBack(z,z+1),ie.emplaceBack(z+1,z+2),ie.emplaceBack(z+2,z+3),ie.emplaceBack(z+3,z),M.primitiveLength+=4}addDebugCollisionBoxes(t,r,u,m){for(let v=t;v<r;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,m?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,u)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Kc(Ss,Ih.members,Xi),this.iconCollisionBox=new Kc(Ss,Ih.members,Xi);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,u,m,v,x,I,M,z){const V={};for(let G=r;G<u;G++){const X=t.get(G);V.textBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},V.textFeatureIndex=X.featureIndex;break}for(let G=m;G<v;G++){const X=t.get(G);V.verticalTextBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},V.verticalTextFeatureIndex=X.featureIndex;break}for(let G=x;G<I;G++){const X=t.get(G);V.iconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},V.iconFeatureIndex=X.featureIndex;break}for(let G=M;G<z;G++){const X=t.get(G);V.verticalIconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},V.verticalIconFeatureIndex=X.featureIndex;break}return V}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const u=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const u=t.placedSymbolArray.get(r),m=u.vertexStartIndex+4*u.numGlyphs;for(let v=u.vertexStartIndex;v<m;v+=4)t.indexArray.emplaceBack(v,v+1,v+2),t.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),u=Math.cos(t),m=[],v=[],x=[];for(let I=0;I<this.symbolInstances.length;++I){x.push(I);const M=this.symbolInstances.get(I);m.push(0|Math.round(r*M.anchorX+u*M.anchorY)),v.push(M.featureIndex)}return x.sort(((I,M)=>m[I]-m[M]||v[M]-v[I])),x}addToSortKeyRanges(t,r){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===r?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const u=this.symbolInstances.get(r);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach(((m,v,x)=>{m>=0&&x.indexOf(m)===v&&this.addIndicesForPlacedSymbol(this.text,m)})),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let kf,Rh;zt("SymbolBucket",tc,{omit:["layers","collisionBoxArray","features","compareText"]}),tc.MAX_GLYPHS=65535,tc.addDynamicAttributes=ec;var nc={get paint(){return Rh=Rh||new _({"icon-opacity":new sn(We.paint_symbol["icon-opacity"]),"icon-color":new sn(We.paint_symbol["icon-color"]),"icon-halo-color":new sn(We.paint_symbol["icon-halo-color"]),"icon-halo-width":new sn(We.paint_symbol["icon-halo-width"]),"icon-halo-blur":new sn(We.paint_symbol["icon-halo-blur"]),"icon-translate":new Ot(We.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ot(We.paint_symbol["icon-translate-anchor"]),"text-opacity":new sn(We.paint_symbol["text-opacity"]),"text-color":new sn(We.paint_symbol["text-color"],{runtimeType:mr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new sn(We.paint_symbol["text-halo-color"]),"text-halo-width":new sn(We.paint_symbol["text-halo-width"]),"text-halo-blur":new sn(We.paint_symbol["text-halo-blur"]),"text-translate":new Ot(We.paint_symbol["text-translate"]),"text-translate-anchor":new Ot(We.paint_symbol["text-translate-anchor"])})},get layout(){return kf=kf||new _({"symbol-placement":new Ot(We.layout_symbol["symbol-placement"]),"symbol-spacing":new Ot(We.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ot(We.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new sn(We.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ot(We.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ot(We.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ot(We.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ot(We.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ot(We.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ot(We.layout_symbol["icon-rotation-alignment"]),"icon-size":new sn(We.layout_symbol["icon-size"]),"icon-text-fit":new Ot(We.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ot(We.layout_symbol["icon-text-fit-padding"]),"icon-image":new sn(We.layout_symbol["icon-image"]),"icon-rotate":new sn(We.layout_symbol["icon-rotate"]),"icon-padding":new sn(We.layout_symbol["icon-padding"]),"icon-keep-upright":new Ot(We.layout_symbol["icon-keep-upright"]),"icon-offset":new sn(We.layout_symbol["icon-offset"]),"icon-anchor":new sn(We.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ot(We.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ot(We.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ot(We.layout_symbol["text-rotation-alignment"]),"text-field":new sn(We.layout_symbol["text-field"]),"text-font":new sn(We.layout_symbol["text-font"]),"text-size":new sn(We.layout_symbol["text-size"]),"text-max-width":new sn(We.layout_symbol["text-max-width"]),"text-line-height":new Ot(We.layout_symbol["text-line-height"]),"text-letter-spacing":new sn(We.layout_symbol["text-letter-spacing"]),"text-justify":new sn(We.layout_symbol["text-justify"]),"text-radial-offset":new sn(We.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ot(We.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new sn(We.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new sn(We.layout_symbol["text-anchor"]),"text-max-angle":new Ot(We.layout_symbol["text-max-angle"]),"text-writing-mode":new Ot(We.layout_symbol["text-writing-mode"]),"text-rotate":new sn(We.layout_symbol["text-rotate"]),"text-padding":new Ot(We.layout_symbol["text-padding"]),"text-keep-upright":new Ot(We.layout_symbol["text-keep-upright"]),"text-transform":new sn(We.layout_symbol["text-transform"]),"text-offset":new sn(We.layout_symbol["text-offset"]),"text-allow-overlap":new Ot(We.layout_symbol["text-allow-overlap"]),"text-overlap":new Ot(We.layout_symbol["text-overlap"]),"text-ignore-placement":new Ot(We.layout_symbol["text-ignore-placement"]),"text-optional":new Ot(We.layout_symbol["text-optional"])})}};class Nh{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Pa,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}zt("FormatSectionOverride",Nh,{omit:["defaultValue"]});class Tu extends o{constructor(t){super(t,nc)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const u=this.layout.get("text-writing-mode");if(u){const m=[];for(const v of u)m.indexOf(v)<0&&m.push(v);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,u,m){const v=this.layout.get(t).evaluate(r,{},u,m),x=this._unevaluatedLayout._values[t];return x.isDataDriven()||w(x.value)||!v?v:(function(I,M){return M.replace(/{([^{}]+)}/g,((z,V)=>I&&V in I?String(I[V]):""))})(r.properties,v)}createBucket(t){return new tc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of nc.paint.overridableProperties){if(!Tu.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),u=new Nh(r),m=new c(u,r.property.specification);let v=null;v=r.value.kind==="constant"||r.value.kind==="source"?new F("source",m):new H("composite",m,r.value.zoomStops),this.paint._values[t]=new ws(r.property,v,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,u){return!(!this.layout||r.isDataDriven()||u.isDataDriven())&&Tu.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const u=t.get("text-field"),m=nc.paint.properties[r];let v=!1;const x=I=>{for(const M of I)if(m.overrides&&m.overrides.hasOverride(M))return void(v=!0)};if(u.value.kind==="constant"&&u.value.value instanceof yr)x(u.value.value.sections);else if(u.value.kind==="source"){const I=z=>{v||(z instanceof ms&&Xn(z.value)===Sr?x(z.value.sections):z instanceof Ra?x(z.sections):z.eachChild(I))},M=u.value;M._styleExpression&&I(M._styleExpression.expression)}return v}}let Sf;var pp={get paint(){return Sf=Sf||new _({"background-color":new Ot(We.paint_background["background-color"]),"background-pattern":new yu(We.paint_background["background-pattern"]),"background-opacity":new Ot(We.paint_background["background-opacity"])})}};class Dh extends o{constructor(t){super(t,pp)}}let Pd;var Jc={get paint(){return Pd=Pd||new _({"raster-opacity":new Ot(We.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ot(We.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ot(We.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ot(We.paint_raster["raster-brightness-max"]),"raster-saturation":new Ot(We.paint_raster["raster-saturation"]),"raster-contrast":new Ot(We.paint_raster["raster-contrast"]),"raster-resampling":new Ot(We.paint_raster["raster-resampling"]),"raster-fade-duration":new Ot(We.paint_raster["raster-fade-duration"])})}};class mp extends o{constructor(t){super(t,Jc)}}class zh extends o{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class a{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const l=63710088e-1;class g{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new g(it(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,u=this.lat*r,m=t.lat*r,v=Math.sin(u)*Math.sin(m)+Math.cos(u)*Math.cos(m)*Math.cos((t.lng-this.lng)*r);return l*Math.acos(Math.min(v,1))}static convert(t){if(t instanceof g)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new g(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new g(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const E=2*Math.PI*l;function N(n){return E*Math.cos(n*Math.PI/180)}function j(n){return(180+n)/360}function te(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function xe(n,t){return n/N(t)}function Ce(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class Ke{constructor(t,r,u=0){this.x=+t,this.y=+r,this.z=+u}static fromLngLat(t,r=0){const u=g.convert(t);return new Ke(j(u.lng),te(u.lat),xe(r,u.lat))}toLngLat(){return new g(360*this.x-180,Ce(this.y))}toAltitude(){return this.z*N(Ce(this.y))}meterInMercatorCoordinateUnits(){return 1/E*(t=Ce(this.y),1/Math.cos(t*Math.PI/180));var t}}function gt(n,t,r){var u=2*Math.PI*6378137/256/Math.pow(2,r);return[n*u-2*Math.PI*6378137/2,t*u-2*Math.PI*6378137/2]}class xt{constructor(t,r,u){if(!(function(m,v,x){return!(m<0||m>25||x<0||x>=Math.pow(2,m)||v<0||v>=Math.pow(2,m))})(t,r,u))throw new Error(`x=${r}, y=${u}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=u,this.key=$t(0,t,t,r,u)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,u){const m=(x=this.y,I=this.z,M=gt(256*(v=this.x),256*(x=Math.pow(2,I)-x-1),I),z=gt(256*(v+1),256*(x+1),I),M[0]+","+M[1]+","+z[0]+","+z[1]);var v,x,I,M,z;const V=(function(G,X,J){let ie,le="";for(let ye=G;ye>0;ye--)ie=1<<ye-1,le+=(X&ie?1:0)+(J&ie?2:0);return le})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,V).replace(/{bbox-epsg-3857}/g,m)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new B((t.x*r-this.x)*Wi,(t.y*r-this.y)*Wi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class pt{constructor(t,r){this.wrap=t,this.canonical=r,this.key=$t(t,r.z,r.z,r.x,r.y)}}class Rt{constructor(t,r,u,m,v){if(t<u)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${u}`);this.overscaledZ=t,this.wrap=r,this.canonical=new xt(u,+m,+v),this.key=$t(r,t,u,m,v)}clone(){return new Rt(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new Rt(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rt(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-t;return t>this.canonical.z?$t(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):$t(this.wrap*+r,t,t,this.canonical.x>>u,this.canonical.y>>u)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Rt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,u=2*this.canonical.x,m=2*this.canonical.y;return[new Rt(r,this.wrap,r,u,m),new Rt(r,this.wrap,r,u+1,m),new Rt(r,this.wrap,r,u,m+1),new Rt(r,this.wrap,r,u+1,m+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Rt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Rt(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new pt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ke(t.x-this.wrap,t.y))}}function $t(n,t,r,u,m){(n*=2)<0&&(n=-1*n-1);const v=1<<r;return(v*v*n+v*m+u).toString(36)+r.toString(36)+t.toString(36)}zt("CanonicalTileID",xt),zt("OverscaledTileID",Rt,{omit:["posMatrix"]});class nn{constructor(t,r,u,m=1,v=1,x=1,I=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(u&&!["mapbox","terrarium","custom"].includes(u))return void Vt(`"${u}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const M=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),u){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=m,this.greenFactor=v,this.blueFactor=x,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let z=0;z<M;z++)this.data[this._idx(-1,z)]=this.data[this._idx(0,z)],this.data[this._idx(M,z)]=this.data[this._idx(M-1,z)],this.data[this._idx(z,-1)]=this.data[this._idx(z,0)],this.data[this._idx(z,M)]=this.data[this._idx(z,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let z=0;z<M;z++)for(let V=0;V<M;V++){const G=this.get(z,V);G>this.max&&(this.max=G),G<this.min&&(this.min=G)}}get(t,r){const u=new Uint8Array(this.data.buffer),m=4*this._idx(t,r);return this.unpack(u[m],u[m+1],u[m+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,u){return t*this.redFactor+r*this.greenFactor+u*this.blueFactor-this.baseShift}getPixels(){return new Or({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let m=r*this.dim,v=r*this.dim+this.dim,x=u*this.dim,I=u*this.dim+this.dim;switch(r){case-1:m=v-1;break;case 1:v=m+1}switch(u){case-1:x=I-1;break;case 1:I=x+1}const M=-r*this.dim,z=-u*this.dim;for(let V=x;V<I;V++)for(let G=m;G<v;G++)this.data[this._idx(G,V)]=t.data[this._idx(G+M,V+z)]}}zt("DEMData",nn);class tr{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const u=t[r];this._stringToNumber[u]=r,this._numberToString[r]=u}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class He{constructor(t,r,u,m,v){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=u,t._y=m,this.properties=t.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class Ne{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new zl(Wi,16,0),this.grid3D=new zl(Wi,16,0),this.featureIndexArray=new wi,this.promoteId=r}insert(t,r,u,m,v,x){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,m,v);const M=x?this.grid3D:this.grid;for(let z=0;z<r.length;z++){const V=r[z],G=[1/0,1/0,-1/0,-1/0];for(let X=0;X<V.length;X++){const J=V[X];G[0]=Math.min(G[0],J.x),G[1]=Math.min(G[1],J.y),G[2]=Math.max(G[2],J.x),G[3]=Math.max(G[3],J.y)}G[0]<Wi&&G[1]<Wi&&G[2]>=0&&G[3]>=0&&M.insert(I,G[0],G[1],G[2],G[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Hl.VectorTile(new hl(this.rawTileData)).layers,this.sourceLayerCoder=new tr(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,u,m){this.loadVTLayers();const v=t.params||{},x=Wi/t.tileSize/t.scale,I=At(v.filter),M=t.queryGeometry,z=t.queryPadding*x,V=Tt(M),G=this.grid.query(V.minX-z,V.minY-z,V.maxX+z,V.maxY+z),X=Tt(t.cameraQueryGeometry),J=this.grid3D.query(X.minX-z,X.minY-z,X.maxX+z,X.maxY+z,((ye,be,Ue,Ie)=>(function(Be,Qe,ft,Dt,cn){for(const Mt of Be)if(Qe<=Mt.x&&ft<=Mt.y&&Dt>=Mt.x&&cn>=Mt.y)return!0;const Nt=[new B(Qe,ft),new B(Qe,cn),new B(Dt,cn),new B(Dt,ft)];if(Be.length>2){for(const Mt of Nt)if(_u(Be,Mt))return!0}for(let Mt=0;Mt<Be.length-1;Mt++)if(Hf(Be[Mt],Be[Mt+1],Nt))return!0;return!1})(t.cameraQueryGeometry,ye-z,be-z,Ue+z,Ie+z)));for(const ye of J)G.push(ye);G.sort(ln);const ie={};let le;for(let ye=0;ye<G.length;ye++){const be=G[ye];if(be===le)continue;le=be;const Ue=this.featureIndexArray.get(be);let Ie=null;this.loadMatchingFeature(ie,Ue.bucketIndex,Ue.sourceLayerIndex,Ue.featureIndex,I,v.layers,v.availableImages,r,u,m,((Be,Qe,ft)=>(Ie||(Ie=Gl(Be)),Qe.queryIntersectsFeature(M,Be,ft,Ie,this.z,t.transform,x,t.pixelPosMatrix))))}return ie}loadMatchingFeature(t,r,u,m,v,x,I,M,z,V,G){const X=this.bucketLayerIDs[r];if(x&&!(function(ye,be){for(let Ue=0;Ue<ye.length;Ue++)if(be.indexOf(ye[Ue])>=0)return!0;return!1})(x,X))return;const J=this.sourceLayerCoder.decode(u),ie=this.vtLayers[J].feature(m);if(v.needGeometry){const ye=$l(ie,!0);if(!v.filter(new On(this.tileID.overscaledZ),ye,this.tileID.canonical))return}else if(!v.filter(new On(this.tileID.overscaledZ),ie))return;const le=this.getId(ie,J);for(let ye=0;ye<X.length;ye++){const be=X[ye];if(x&&x.indexOf(be)<0)continue;const Ue=M[be];if(!Ue)continue;let Ie={};le&&V&&(Ie=V.getState(Ue.sourceLayer||"_geojsonTileLayer",le));const Be=Ge({},z[be]);Be.paint=Xe(Be.paint,Ue.paint,ie,Ie,I),Be.layout=Xe(Be.layout,Ue.layout,ie,Ie,I);const Qe=!G||G(ie,Ue,Ie);if(!Qe)continue;const ft=new He(ie,this.z,this.x,this.y,le);ft.layer=Be;let Dt=t[be];Dt===void 0&&(Dt=t[be]=[]),Dt.push({featureIndex:m,feature:ft,intersectionZ:Qe})}}lookupSymbolFeatures(t,r,u,m,v,x,I,M){const z={};this.loadVTLayers();const V=At(v);for(const G of t)this.loadMatchingFeature(z,u,m,G,V,x,I,M,r);return z}hasLayer(t){for(const r of this.bucketLayerIDs)for(const u of r)if(t===u)return!0;return!1}getId(t,r){let u=t.id;return this.promoteId&&(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof u=="boolean"&&(u=Number(u))),u}}function Xe(n,t,r,u,m){return mt(n,((v,x)=>{const I=t instanceof Bl?t.get(x):null;return I&&I.evaluate?I.evaluate(r,u,m):I}))}function Tt(n){let t=1/0,r=1/0,u=-1/0,m=-1/0;for(const v of n)t=Math.min(t,v.x),r=Math.min(r,v.y),u=Math.max(u,v.x),m=Math.max(m,v.y);return{minX:t,minY:r,maxX:u,maxY:m}}function ln(n,t){return t-n}function _n(n,t,r,u,m){const v=[];for(let x=0;x<n.length;x++){const I=n[x];let M;for(let z=0;z<I.length-1;z++){let V=I[z],G=I[z+1];V.x<t&&G.x<t||(V.x<t?V=new B(t,V.y+(t-V.x)/(G.x-V.x)*(G.y-V.y))._round():G.x<t&&(G=new B(t,V.y+(t-V.x)/(G.x-V.x)*(G.y-V.y))._round()),V.y<r&&G.y<r||(V.y<r?V=new B(V.x+(r-V.y)/(G.y-V.y)*(G.x-V.x),r)._round():G.y<r&&(G=new B(V.x+(r-V.y)/(G.y-V.y)*(G.x-V.x),r)._round()),V.x>=u&&G.x>=u||(V.x>=u?V=new B(u,V.y+(u-V.x)/(G.x-V.x)*(G.y-V.y))._round():G.x>=u&&(G=new B(u,V.y+(u-V.x)/(G.x-V.x)*(G.y-V.y))._round()),V.y>=m&&G.y>=m||(V.y>=m?V=new B(V.x+(m-V.y)/(G.y-V.y)*(G.x-V.x),m)._round():G.y>=m&&(G=new B(V.x+(m-V.y)/(G.y-V.y)*(G.x-V.x),m)._round()),M&&V.equals(M[M.length-1])||(M=[V],v.push(M)),M.push(G)))))}}return v}zt("FeatureIndex",Ne,{omit:["rawTileData","sourceLayerCoder"]});class un extends B{constructor(t,r,u,m){super(t,r),this.angle=u,m!==void 0&&(this.segment=m)}clone(){return new un(this.x,this.y,this.angle,this.segment)}}function Tn(n,t,r,u,m){if(t.segment===void 0||r===0)return!0;let v=t,x=t.segment+1,I=0;for(;I>-r/2;){if(x--,x<0)return!1;I-=n[x].dist(v),v=n[x]}I+=n[x].dist(n[x+1]),x++;const M=[];let z=0;for(;I<r/2;){const V=n[x],G=n[x+1];if(!G)return!1;let X=n[x-1].angleTo(V)-V.angleTo(G);for(X=Math.abs((X+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:I,angleDelta:X}),z+=X;I-M[0].distance>u;)z-=M.shift().angleDelta;if(z>m)return!1;x++,I+=V.dist(G)}return!0}function Lr(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function si(n,t,r){return n?.6*t*r:0}function dl(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function gp(n,t,r,u,m,v){const x=si(r,m,v),I=dl(r,u)*v;let M=0;const z=Lr(n)/2;for(let V=0;V<n.length-1;V++){const G=n[V],X=n[V+1],J=G.dist(X);if(M+J>z){const ie=(z-M)/J,le=Wn.number(G.x,X.x,ie),ye=Wn.number(G.y,X.y,ie),be=new un(le,ye,X.angleTo(G),V);return be._round(),!x||Tn(n,be,I,x,t)?be:void 0}M+=J}}function fy(n,t,r,u,m,v,x,I,M){const z=si(u,v,x),V=dl(u,m),G=V*x,X=n[0].x===0||n[0].x===M||n[0].y===0||n[0].y===M;return t-G<t/4&&(t=G+t/4),fm(n,X?t/2*I%t:(V/2+2*v)*x*I%t,t,z,r,G,X,!1,M)}function fm(n,t,r,u,m,v,x,I,M){const z=v/2,V=Lr(n);let G=0,X=t-r,J=[];for(let ie=0;ie<n.length-1;ie++){const le=n[ie],ye=n[ie+1],be=le.dist(ye),Ue=ye.angleTo(le);for(;X+r<G+be;){X+=r;const Ie=(X-G)/be,Be=Wn.number(le.x,ye.x,Ie),Qe=Wn.number(le.y,ye.y,Ie);if(Be>=0&&Be<M&&Qe>=0&&Qe<M&&X-z>=0&&X+z<=V){const ft=new un(Be,Qe,Ue,ie);ft._round(),u&&!Tn(n,ft,v,u,m)||J.push(ft)}}G+=be}return I||J.length||x||(J=fm(n,G/2,r,u,m,v,x,!0,M)),J}zt("Anchor",un);const Oh=Cs;function dm(n,t,r,u){const m=[],v=n.image,x=v.pixelRatio,I=v.paddedRect.w-2*Oh,M=v.paddedRect.h-2*Oh;let z={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const V=v.stretchX||[[0,I]],G=v.stretchY||[[0,M]],X=(st,Qt)=>st+Qt[1]-Qt[0],J=V.reduce(X,0),ie=G.reduce(X,0),le=I-J,ye=M-ie;let be=0,Ue=J,Ie=0,Be=ie,Qe=0,ft=le,Dt=0,cn=ye;if(v.content&&u){const st=v.content,Qt=st[2]-st[0],Zt=st[3]-st[1];(v.textFitWidth||v.textFitHeight)&&(z=Xc(n)),be=Md(V,0,st[0]),Ie=Md(G,0,st[1]),Ue=Md(V,st[0],st[2]),Be=Md(G,st[1],st[3]),Qe=st[0]-be,Dt=st[1]-Ie,ft=Qt-Ue,cn=Zt-Be}const Nt=z.x1,Mt=z.y1,Xt=z.x2-Nt,qt=z.y2-Mt,Bt=(st,Qt,Zt,wn)=>{const bi=Ad(st.stretch-be,Ue,Xt,Nt),_i=Ld(st.fixed-Qe,ft,st.stretch,J),Fr=Ad(Qt.stretch-Ie,Be,qt,Mt),qo=Ld(Qt.fixed-Dt,cn,Qt.stretch,ie),us=Ad(Zt.stretch-be,Ue,Xt,Nt),Br=Ld(Zt.fixed-Qe,ft,Zt.stretch,J),Js=Ad(wn.stretch-Ie,Be,qt,Mt),Qs=Ld(wn.fixed-Dt,cn,wn.stretch,ie),ea=new B(bi,Fr),nr=new B(us,Fr),jr=new B(us,Js),Ps=new B(bi,Js),cs=new B(_i/x,qo/x),ta=new B(Br/x,Qs/x),hs=t*Math.PI/180;if(hs){const ii=Math.sin(hs),Pi=Math.cos(hs),zi=[Pi,-ii,ii,Pi];ea._matMult(zi),nr._matMult(zi),Ps._matMult(zi),jr._matMult(zi)}const ko=st.stretch+st.fixed,Ia=Qt.stretch+Qt.fixed;return{tl:ea,tr:nr,bl:Ps,br:jr,tex:{x:v.paddedRect.x+Oh+ko,y:v.paddedRect.y+Oh+Ia,w:Zt.stretch+Zt.fixed-ko,h:wn.stretch+wn.fixed-Ia},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cs,pixelOffsetBR:ta,minFontScaleX:ft/x/Xt,minFontScaleY:cn/x/qt,isSDF:r}};if(u&&(v.stretchX||v.stretchY)){const st=pm(V,le,J),Qt=pm(G,ye,ie);for(let Zt=0;Zt<st.length-1;Zt++){const wn=st[Zt],bi=st[Zt+1];for(let _i=0;_i<Qt.length-1;_i++)m.push(Bt(wn,Qt[_i],bi,Qt[_i+1]))}}else m.push(Bt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:M+1}));return m}function Md(n,t,r){let u=0;for(const m of n)u+=Math.max(t,Math.min(r,m[1]))-Math.max(t,Math.min(r,m[0]));return u}function pm(n,t,r){const u=[{fixed:-Oh,stretch:0}];for(const[m,v]of n){const x=u[u.length-1];u.push({fixed:m-x.stretch,stretch:x.stretch}),u.push({fixed:m-x.stretch,stretch:x.stretch+(v-m)})}return u.push({fixed:t+Oh,stretch:r}),u}function Ad(n,t,r,u){return n/t*r+u}function Ld(n,t,r,u){return n-t*r/u}class Rd{constructor(t,r,u,m,v,x,I,M,z,V){var G;if(this.boxStartIndex=t.length,z){let X=x.top,J=x.bottom;const ie=x.collisionPadding;ie&&(X-=ie[1],J+=ie[3]);let le=J-X;le>0&&(le=Math.max(10,le),this.circleDiameter=le)}else{const X=!((G=x.image)===null||G===void 0)&&G.content&&(x.image.textFitWidth||x.image.textFitHeight)?Xc(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};X.y1=X.y1*I-M[0],X.y2=X.y2*I+M[2],X.x1=X.x1*I-M[3],X.x2=X.x2*I+M[1];const J=x.collisionPadding;if(J&&(X.x1-=J[0]*I,X.y1-=J[1]*I,X.x2+=J[2]*I,X.y2+=J[3]*I),V){const ie=new B(X.x1,X.y1),le=new B(X.x2,X.y1),ye=new B(X.x1,X.y2),be=new B(X.x2,X.y2),Ue=V*Math.PI/180;ie._rotate(Ue),le._rotate(Ue),ye._rotate(Ue),be._rotate(Ue),X.x1=Math.min(ie.x,le.x,ye.x,be.x),X.x2=Math.max(ie.x,le.x,ye.x,be.x),X.y1=Math.min(ie.y,le.y,ye.y,be.y),X.y2=Math.max(ie.y,le.y,ye.y,be.y)}t.emplaceBack(r.x,r.y,X.x1,X.y1,X.x2,X.y2,u,m,v)}this.boxEndIndex=t.length}}class dy{constructor(t=[],r=((u,m)=>u<m?-1:u>m?1:0)){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:u}=this,m=r[t];for(;t>0;){const v=t-1>>1,x=r[v];if(u(m,x)>=0)break;r[t]=x,t=v}r[t]=m}_down(t){const{data:r,compare:u}=this,m=this.length>>1,v=r[t];for(;t<m;){let x=1+(t<<1);const I=x+1;if(I<this.length&&u(r[I],r[x])<0&&(x=I),u(r[x],v)>=0)break;r[t]=r[x],t=x}r[t]=v}}function py(n,t=1,r=!1){let u=1/0,m=1/0,v=-1/0,x=-1/0;const I=n[0];for(let J=0;J<I.length;J++){const ie=I[J];(!J||ie.x<u)&&(u=ie.x),(!J||ie.y<m)&&(m=ie.y),(!J||ie.x>v)&&(v=ie.x),(!J||ie.y>x)&&(x=ie.y)}const M=Math.min(v-u,x-m);let z=M/2;const V=new dy([],my);if(M===0)return new B(u,m);for(let J=u;J<v;J+=M)for(let ie=m;ie<x;ie+=M)V.push(new Fh(J+z,ie+z,z,n));let G=(function(J){let ie=0,le=0,ye=0;const be=J[0];for(let Ue=0,Ie=be.length,Be=Ie-1;Ue<Ie;Be=Ue++){const Qe=be[Ue],ft=be[Be],Dt=Qe.x*ft.y-ft.x*Qe.y;le+=(Qe.x+ft.x)*Dt,ye+=(Qe.y+ft.y)*Dt,ie+=3*Dt}return new Fh(le/ie,ye/ie,0,J)})(n),X=V.length;for(;V.length;){const J=V.pop();(J.d>G.d||!G.d)&&(G=J,r&&console.log("found best %d after %d probes",Math.round(1e4*J.d)/1e4,X)),J.max-G.d<=t||(z=J.h/2,V.push(new Fh(J.p.x-z,J.p.y-z,z,n)),V.push(new Fh(J.p.x+z,J.p.y-z,z,n)),V.push(new Fh(J.p.x-z,J.p.y+z,z,n)),V.push(new Fh(J.p.x+z,J.p.y+z,z,n)),X+=4)}return r&&(console.log(`num probes: ${X}`),console.log(`best distance: ${G.d}`)),G.p}function my(n,t){return t.max-n.max}function Fh(n,t,r,u){this.p=new B(n,t),this.h=r,this.d=(function(m,v){let x=!1,I=1/0;for(let M=0;M<v.length;M++){const z=v[M];for(let V=0,G=z.length,X=G-1;V<G;X=V++){const J=z[V],ie=z[X];J.y>m.y!=ie.y>m.y&&m.x<(ie.x-J.x)*(m.y-J.y)/(ie.y-J.y)+J.x&&(x=!x),I=Math.min(I,rf(m,J,ie))}}return(x?1:-1)*Math.sqrt(I)})(this.p,u),this.max=this.d+this.h*Math.SQRT2}var ls;R.aq=void 0,(ls=R.aq||(R.aq={}))[ls.center=1]="center",ls[ls.left=2]="left",ls[ls.right=3]="right",ls[ls.top=4]="top",ls[ls.bottom=5]="bottom",ls[ls["top-left"]=6]="top-left",ls[ls["top-right"]=7]="top-right",ls[ls["bottom-left"]=8]="bottom-left",ls[ls["bottom-right"]=9]="bottom-right";const ic=7,yp=Number.POSITIVE_INFINITY;function mm(n,t){return t[1]!==yp?(function(r,u,m){let v=0,x=0;switch(u=Math.abs(u),m=Math.abs(m),r){case"top-right":case"top-left":case"top":x=m-ic;break;case"bottom-right":case"bottom-left":case"bottom":x=-m+ic}switch(r){case"top-right":case"bottom-right":case"right":v=-u;break;case"top-left":case"bottom-left":case"left":v=u}return[v,x]})(n,t[0],t[1]):(function(r,u){let m=0,v=0;u<0&&(u=0);const x=u/Math.SQRT2;switch(r){case"top-right":case"top-left":v=x-ic;break;case"bottom-right":case"bottom-left":v=-x+ic;break;case"bottom":v=-u+ic;break;case"top":v=u-ic}switch(r){case"top-right":case"bottom-right":m=-x;break;case"top-left":case"bottom-left":m=x;break;case"left":m=u;break;case"right":m=-u}return[m,v]})(n,t[0])}function gm(n,t,r){var u;const m=n.layout,v=(u=m.get("text-variable-anchor-offset"))===null||u===void 0?void 0:u.evaluate(t,{},r);if(v){const I=v.values,M=[];for(let z=0;z<I.length;z+=2){const V=M[z]=I[z],G=I[z+1].map((X=>X*Di));V.startsWith("top")?G[1]-=ic:V.startsWith("bottom")&&(G[1]+=ic),M[z+1]=G}return new Ei(M)}const x=m.get("text-variable-anchor");if(x){let I;I=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(t,{},r)*Di,yp]:m.get("text-offset").evaluate(t,{},r).map((z=>z*Di));const M=[];for(const z of x)M.push(z,mm(z,I));return new Ei(M)}return null}function _p(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gy(n,t,r,u,m,v,x,I,M,z,V){let G=v.textMaxSize.evaluate(t,{});G===void 0&&(G=x);const X=n.layers[0].layout,J=X.get("icon-offset").evaluate(t,{},V),ie=_m(r.horizontal),le=x/24,ye=n.tilePixelRatio*le,be=n.tilePixelRatio*G/24,Ue=n.tilePixelRatio*I,Ie=n.tilePixelRatio*X.get("symbol-spacing"),Be=X.get("text-padding")*n.tilePixelRatio,Qe=(function(st,Qt,Zt,wn=1){const bi=st.get("icon-padding").evaluate(Qt,{},Zt),_i=bi&&bi.values;return[_i[0]*wn,_i[1]*wn,_i[2]*wn,_i[3]*wn]})(X,t,V,n.tilePixelRatio),ft=X.get("text-max-angle")/180*Math.PI,Dt=X.get("text-rotation-alignment")!=="viewport"&&X.get("symbol-placement")!=="point",cn=X.get("icon-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",Nt=X.get("symbol-placement"),Mt=Ie/2,Xt=X.get("icon-text-fit");let qt;u&&Xt!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(qt=Ql(u,r.vertical,Xt,X.get("icon-text-fit-padding"),J,le)),ie&&(u=Ql(u,ie,Xt,X.get("icon-text-fit-padding"),J,le)));const Bt=(st,Qt)=>{Qt.x<0||Qt.x>=Wi||Qt.y<0||Qt.y>=Wi||(function(Zt,wn,bi,_i,Fr,qo,us,Br,Js,Qs,ea,nr,jr,Ps,cs,ta,hs,ko,Ia,ii,Pi,zi,qa,Yi,Bh){const tu=Zt.addToLineVertexArray(wn,bi);let nu,Go,So,Jr,Cu=0,Tf=0,bm=0,km=0,Ip=-1,Tp=-1;const Pu={};let Sm=Ul("");if(Zt.allowVerticalPlacement&&_i.vertical){const Ms=Br.layout.get("text-rotate").evaluate(Pi,{},Yi)+90;So=new Rd(Js,wn,Qs,ea,nr,_i.vertical,jr,Ps,cs,Ms),us&&(Jr=new Rd(Js,wn,Qs,ea,nr,us,hs,ko,cs,Ms))}if(Fr){const Ms=Br.layout.get("icon-rotate").evaluate(Pi,{}),Eo=Br.layout.get("icon-text-fit")!=="none",Qc=dm(Fr,Ms,qa,Eo),ml=us?dm(us,Ms,qa,Eo):void 0;Go=new Rd(Js,wn,Qs,ea,nr,Fr,hs,ko,!1,Ms),Cu=4*Qc.length;const eh=Zt.iconSizeData;let iu=null;eh.kind==="source"?(iu=[Va*Br.layout.get("icon-size").evaluate(Pi,{})],iu[0]>Vo&&Vt(`${Zt.layerIds[0]}: Value for "icon-size" is >= ${eu}. Reduce your "icon-size".`)):eh.kind==="composite"&&(iu=[Va*zi.compositeIconSizes[0].evaluate(Pi,{},Yi),Va*zi.compositeIconSizes[1].evaluate(Pi,{},Yi)],(iu[0]>Vo||iu[1]>Vo)&&Vt(`${Zt.layerIds[0]}: Value for "icon-size" is >= ${eu}. Reduce your "icon-size".`)),Zt.addSymbols(Zt.icon,Qc,iu,ii,Ia,Pi,R.ah.none,wn,tu.lineStartIndex,tu.lineLength,-1,Yi),Ip=Zt.icon.placedSymbolArray.length-1,ml&&(Tf=4*ml.length,Zt.addSymbols(Zt.icon,ml,iu,ii,Ia,Pi,R.ah.vertical,wn,tu.lineStartIndex,tu.lineLength,-1,Yi),Tp=Zt.icon.placedSymbolArray.length-1)}const Em=Object.keys(_i.horizontal);for(const Ms of Em){const Eo=_i.horizontal[Ms];if(!nu){Sm=Ul(Eo.text);const ml=Br.layout.get("text-rotate").evaluate(Pi,{},Yi);nu=new Rd(Js,wn,Qs,ea,nr,Eo,jr,Ps,cs,ml)}const Qc=Eo.positionedLines.length===1;if(bm+=ym(Zt,wn,Eo,qo,Br,cs,Pi,ta,tu,_i.vertical?R.ah.horizontal:R.ah.horizontalOnly,Qc?Em:[Ms],Pu,Ip,zi,Yi),Qc)break}_i.vertical&&(km+=ym(Zt,wn,_i.vertical,qo,Br,cs,Pi,ta,tu,R.ah.vertical,["vertical"],Pu,Tp,zi,Yi));const vy=nu?nu.boxStartIndex:Zt.collisionBoxArray.length,xy=nu?nu.boxEndIndex:Zt.collisionBoxArray.length,wy=So?So.boxStartIndex:Zt.collisionBoxArray.length,by=So?So.boxEndIndex:Zt.collisionBoxArray.length,ky=Go?Go.boxStartIndex:Zt.collisionBoxArray.length,Sy=Go?Go.boxEndIndex:Zt.collisionBoxArray.length,Ey=Jr?Jr.boxStartIndex:Zt.collisionBoxArray.length,Iy=Jr?Jr.boxEndIndex:Zt.collisionBoxArray.length;let pl=-1;const Dd=(Ms,Eo)=>Ms&&Ms.circleDiameter?Math.max(Ms.circleDiameter,Eo):Eo;pl=Dd(nu,pl),pl=Dd(So,pl),pl=Dd(Go,pl),pl=Dd(Jr,pl);const Im=pl>-1?1:0;Im&&(pl*=Bh/Di),Zt.glyphOffsetArray.length>=tc.MAX_GLYPHS&&Vt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Pi.sortKey!==void 0&&Zt.addToSortKeyRanges(Zt.symbolInstances.length,Pi.sortKey);const Ty=gm(Br,Pi,Yi),[Cy,Py]=(function(Ms,Eo){const Qc=Ms.length,ml=Eo?.values;if(ml?.length>0)for(let eh=0;eh<ml.length;eh+=2){const iu=ml[eh+1];Ms.emplaceBack(R.aq[ml[eh]],iu[0],iu[1])}return[Qc,Ms.length]})(Zt.textAnchorOffsets,Ty);Zt.symbolInstances.emplaceBack(wn.x,wn.y,Pu.right>=0?Pu.right:-1,Pu.center>=0?Pu.center:-1,Pu.left>=0?Pu.left:-1,Pu.vertical||-1,Ip,Tp,Sm,vy,xy,wy,by,ky,Sy,Ey,Iy,Qs,bm,km,Cu,Tf,Im,0,jr,pl,Cy,Py)})(n,Qt,st,r,u,m,qt,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,ye,[Be,Be,Be,Be],Dt,M,Ue,Qe,cn,J,t,v,z,V,x)};if(Nt==="line")for(const st of _n(t.geometry,0,0,Wi,Wi)){const Qt=fy(st,Ie,ft,r.vertical||ie,u,24,be,n.overscaling,Wi);for(const Zt of Qt)ie&&yy(n,ie.text,Mt,Zt)||Bt(st,Zt)}else if(Nt==="line-center"){for(const st of t.geometry)if(st.length>1){const Qt=gp(st,ft,r.vertical||ie,u,24,be);Qt&&Bt(st,Qt)}}else if(t.type==="Polygon")for(const st of Ro(t.geometry,0)){const Qt=py(st,16);Bt(st[0],new un(Qt.x,Qt.y,0))}else if(t.type==="LineString")for(const st of t.geometry)Bt(st,new un(st[0].x,st[0].y,0));else if(t.type==="Point")for(const st of t.geometry)for(const Qt of st)Bt([Qt],new un(Qt.x,Qt.y,0))}function ym(n,t,r,u,m,v,x,I,M,z,V,G,X,J,ie){const le=(function(Ue,Ie,Be,Qe,ft,Dt,cn,Nt){const Mt=Qe.layout.get("text-rotate").evaluate(Dt,{})*Math.PI/180,Xt=[];for(const qt of Ie.positionedLines)for(const Bt of qt.positionedGlyphs){if(!Bt.rect)continue;const st=Bt.rect||{};let Qt=Mh+1,Zt=!0,wn=1,bi=0;const _i=(ft||Nt)&&Bt.vertical,Fr=Bt.metrics.advance*Bt.scale/2;if(Nt&&Ie.verticalizable&&(bi=qt.lineOffset/2-(Bt.imageName?-(Di-Bt.metrics.width*Bt.scale)/2:(Bt.scale-1)*Di)),Bt.imageName){const ii=cn[Bt.imageName];Zt=ii.sdf,wn=ii.pixelRatio,Qt=Cs/wn}const qo=ft?[Bt.x+Fr,Bt.y]:[0,0];let us=ft?[0,0]:[Bt.x+Fr+Be[0],Bt.y+Be[1]-bi],Br=[0,0];_i&&(Br=us,us=[0,0]);const Js=Bt.metrics.isDoubleResolution?2:1,Qs=(Bt.metrics.left-Qt)*Bt.scale-Fr+us[0],ea=(-Bt.metrics.top-Qt)*Bt.scale+us[1],nr=Qs+st.w/Js*Bt.scale/wn,jr=ea+st.h/Js*Bt.scale/wn,Ps=new B(Qs,ea),cs=new B(nr,ea),ta=new B(Qs,jr),hs=new B(nr,jr);if(_i){const ii=new B(-Fr,Fr-wo),Pi=-Math.PI/2,zi=Di/2-Fr,qa=new B(5-wo-zi,-(Bt.imageName?zi:0)),Yi=new B(...Br);Ps._rotateAround(Pi,ii)._add(qa)._add(Yi),cs._rotateAround(Pi,ii)._add(qa)._add(Yi),ta._rotateAround(Pi,ii)._add(qa)._add(Yi),hs._rotateAround(Pi,ii)._add(qa)._add(Yi)}if(Mt){const ii=Math.sin(Mt),Pi=Math.cos(Mt),zi=[Pi,-ii,ii,Pi];Ps._matMult(zi),cs._matMult(zi),ta._matMult(zi),hs._matMult(zi)}const ko=new B(0,0),Ia=new B(0,0);Xt.push({tl:Ps,tr:cs,bl:ta,br:hs,tex:st,writingMode:Ie.writingMode,glyphOffset:qo,sectionIndex:Bt.sectionIndex,isSDF:Zt,pixelOffsetTL:ko,pixelOffsetBR:Ia,minFontScaleX:0,minFontScaleY:0})}return Xt})(0,r,I,m,v,x,u,n.allowVerticalPlacement),ye=n.textSizeData;let be=null;ye.kind==="source"?(be=[Va*m.layout.get("text-size").evaluate(x,{})],be[0]>Vo&&Vt(`${n.layerIds[0]}: Value for "text-size" is >= ${eu}. Reduce your "text-size".`)):ye.kind==="composite"&&(be=[Va*J.compositeTextSizes[0].evaluate(x,{},ie),Va*J.compositeTextSizes[1].evaluate(x,{},ie)],(be[0]>Vo||be[1]>Vo)&&Vt(`${n.layerIds[0]}: Value for "text-size" is >= ${eu}. Reduce your "text-size".`)),n.addSymbols(n.text,le,be,I,v,x,z,t,M.lineStartIndex,M.lineLength,X,ie);for(const Ue of V)G[Ue]=n.text.placedSymbolArray.length-1;return 4*le.length}function _m(n){for(const t in n)return n[t];return null}function yy(n,t,r,u){const m=n.compareText;if(t in m){const v=m[t];for(let x=v.length-1;x>=0;x--)if(u.dist(v[x])<r)return!0}else m[t]=[];return m[t].push(u),!1}const vm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class vp{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,u]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=u>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const v=vm[15&u];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(t,2,1),[I]=new Uint32Array(t,4,1);return new vp(I,x,v,t)}constructor(t,r=64,u=Float64Array,m){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=u,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const v=vm.indexOf(this.ArrayType),x=2*t*this.ArrayType.BYTES_PER_ELEMENT,I=t*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-I%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${u}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+I+M,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+x+I+M),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+I+M,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=t,this.coords[this._pos++]=r,u}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return xp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:I}=this,M=[0,v.length-1,0],z=[];for(;M.length;){const V=M.pop()||0,G=M.pop()||0,X=M.pop()||0;if(G-X<=I){for(let ye=X;ye<=G;ye++){const be=x[2*ye],Ue=x[2*ye+1];be>=t&&be<=u&&Ue>=r&&Ue<=m&&z.push(v[ye])}continue}const J=X+G>>1,ie=x[2*J],le=x[2*J+1];ie>=t&&ie<=u&&le>=r&&le<=m&&z.push(v[J]),(V===0?t<=ie:r<=le)&&(M.push(X),M.push(J-1),M.push(1-V)),(V===0?u>=ie:m>=le)&&(M.push(J+1),M.push(G),M.push(1-V))}return z}within(t,r,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:v,nodeSize:x}=this,I=[0,m.length-1,0],M=[],z=u*u;for(;I.length;){const V=I.pop()||0,G=I.pop()||0,X=I.pop()||0;if(G-X<=x){for(let ye=X;ye<=G;ye++)wm(v[2*ye],v[2*ye+1],t,r)<=z&&M.push(m[ye]);continue}const J=X+G>>1,ie=v[2*J],le=v[2*J+1];wm(ie,le,t,r)<=z&&M.push(m[J]),(V===0?t-u<=ie:r-u<=le)&&(I.push(X),I.push(J-1),I.push(1-V)),(V===0?t+u>=ie:r+u>=le)&&(I.push(J+1),I.push(G),I.push(1-V))}return M}}function xp(n,t,r,u,m,v){if(m-u<=r)return;const x=u+m>>1;xm(n,t,x,u,m,v),xp(n,t,r,u,x-1,1-v),xp(n,t,r,x+1,m,1-v)}function xm(n,t,r,u,m,v){for(;m>u;){if(m-u>600){const z=m-u+1,V=r-u+1,G=Math.log(z),X=.5*Math.exp(2*G/3),J=.5*Math.sqrt(G*X*(z-X)/z)*(V-z/2<0?-1:1);xm(n,t,r,Math.max(u,Math.floor(r-V*X/z+J)),Math.min(m,Math.floor(r+(z-V)*X/z+J)),v)}const x=t[2*r+v];let I=u,M=m;for(Ef(n,t,u,r),t[2*m+v]>x&&Ef(n,t,u,m);I<M;){for(Ef(n,t,I,M),I++,M--;t[2*I+v]<x;)I++;for(;t[2*M+v]>x;)M--}t[2*u+v]===x?Ef(n,t,u,M):(M++,Ef(n,t,M,m)),M<=r&&(u=M+1),r<=M&&(m=M-1)}}function Ef(n,t,r,u){wp(n,r,u),wp(t,2*r,2*u),wp(t,2*r+1,2*u+1)}function wp(n,t,r){const u=n[t];n[t]=n[r],n[r]=u}function wm(n,t,r,u){const m=n-r,v=t-u;return m*m+v*v}var bp;R.bg=void 0,(bp=R.bg||(R.bg={})).create="create",bp.load="load",bp.fullLoad="fullLoad";let Nd=null,If=[];const kp=1e3/60,Sp="loadTime",Ep="fullLoadTime",_y={mark(n){performance.mark(n)},frame(n){const t=n;Nd!=null&&If.push(t-Nd),Nd=t},clearMetrics(){Nd=null,If=[],performance.clearMeasures(Sp),performance.clearMeasures(Ep);for(const n in R.bg)performance.clearMarks(R.bg[n])},getPerformanceMetrics(){performance.measure(Sp,R.bg.create,R.bg.load),performance.measure(Ep,R.bg.create,R.bg.fullLoad);const n=performance.getEntriesByName(Sp)[0].duration,t=performance.getEntriesByName(Ep)[0].duration,r=If.length,u=1/(If.reduce(((v,x)=>v+x),0)/r/1e3),m=If.filter((v=>v>kp)).reduce(((v,x)=>v+(x-kp)/kp),0);return{loadTime:n,fullLoadTime:t,fps:u,percentDroppedFrames:m/(r+m)*100,totalFrames:r}}};R.$=class extends ${},R.A=Hu,R.B=_c,R.C=function(n){if(fn==null){const t=n.navigator?n.navigator.userAgent:null;fn=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return fn},R.D=Ot,R.E=Rr,R.F=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new a((()=>this.process())),this.subscription=(function(r,u,m,v){return r.addEventListener(u,m,!1),{unsubscribe:()=>{r.removeEventListener(u,m,!1)}}})(this.target,"message",(r=>this.receive(r))),this.globalScope=en(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise(((r,u)=>{const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[m]={resolve:r,reject:u},t&&t.signal.addEventListener("abort",(()=>{delete this.resolveRejects[m];const I={id:m,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(I)}),{once:!0});const v=[],x=Object.assign(Object.assign({},n),{id:m,sourceMapId:this.mapId,origin:location.origin,data:Xr(n.data,v)});this.target.postMessage(x,{transfer:v})}))}receive(n){const t=n.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const u=this.abortControllers[r];return delete this.abortControllers[r],void(u&&u.abort())}if(en(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return h(this,void 0,void 0,(function*(){if(t.type==="<response>"){const m=this.resolveRejects[n];return delete this.resolveRejects[n],m?void(t.error?m.reject(Fa(t.error)):m.resolve(Fa(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Fa(t.data),u=new AbortController;this.abortControllers[n]=u;try{const m=yield this.messageHandlers[t.type](t.sourceMapId,r,u);this.completeTask(n,null,m)}catch(m){this.completeTask(n,m)}}))}completeTask(n,t,r){const u=[];delete this.abortControllers[n];const m={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Xr(t):null,data:Xr(r,u)};this.target.postMessage(m,{transfer:u})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},R.G=zn,R.H=function(){var n=new Hu(16);return Hu!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},R.I=xf,R.J=function(n,t,r){var u,m,v,x,I,M,z,V,G,X,J,ie,le=r[0],ye=r[1],be=r[2];return t===n?(n[12]=t[0]*le+t[4]*ye+t[8]*be+t[12],n[13]=t[1]*le+t[5]*ye+t[9]*be+t[13],n[14]=t[2]*le+t[6]*ye+t[10]*be+t[14],n[15]=t[3]*le+t[7]*ye+t[11]*be+t[15]):(m=t[1],v=t[2],x=t[3],I=t[4],M=t[5],z=t[6],V=t[7],G=t[8],X=t[9],J=t[10],ie=t[11],n[0]=u=t[0],n[1]=m,n[2]=v,n[3]=x,n[4]=I,n[5]=M,n[6]=z,n[7]=V,n[8]=G,n[9]=X,n[10]=J,n[11]=ie,n[12]=u*le+I*ye+G*be+t[12],n[13]=m*le+M*ye+X*be+t[13],n[14]=v*le+z*ye+J*be+t[14],n[15]=x*le+V*ye+ie*be+t[15]),n},R.K=function(n,t,r){var u=r[0],m=r[1],v=r[2];return n[0]=t[0]*u,n[1]=t[1]*u,n[2]=t[2]*u,n[3]=t[3]*u,n[4]=t[4]*m,n[5]=t[5]*m,n[6]=t[6]*m,n[7]=t[7]*m,n[8]=t[8]*v,n[9]=t[9]*v,n[10]=t[10]*v,n[11]=t[11]*v,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},R.L=of,R.M=function(n,t){const r={};for(let u=0;u<t.length;u++){const m=t[u];m in n&&(r[m]=n[m])}return r},R.N=g,R.O=j,R.P=B,R.Q=te,R.R=Or,R.S=Rt,R.T=Cr,R.U=je,R.V=Te,R.W=Ft,R.X=Wi,R.Y=T,R.Z=Ke,R._=h,R.a=Pt,R.a$=function(n,t){var r=n[0],u=n[1],m=n[2],v=n[3],x=n[4],I=n[5],M=n[6],z=n[7],V=n[8],G=n[9],X=n[10],J=n[11],ie=n[12],le=n[13],ye=n[14],be=n[15],Ue=t[0],Ie=t[1],Be=t[2],Qe=t[3],ft=t[4],Dt=t[5],cn=t[6],Nt=t[7],Mt=t[8],Xt=t[9],qt=t[10],Bt=t[11],st=t[12],Qt=t[13],Zt=t[14],wn=t[15];return Math.abs(r-Ue)<=rs*Math.max(1,Math.abs(r),Math.abs(Ue))&&Math.abs(u-Ie)<=rs*Math.max(1,Math.abs(u),Math.abs(Ie))&&Math.abs(m-Be)<=rs*Math.max(1,Math.abs(m),Math.abs(Be))&&Math.abs(v-Qe)<=rs*Math.max(1,Math.abs(v),Math.abs(Qe))&&Math.abs(x-ft)<=rs*Math.max(1,Math.abs(x),Math.abs(ft))&&Math.abs(I-Dt)<=rs*Math.max(1,Math.abs(I),Math.abs(Dt))&&Math.abs(M-cn)<=rs*Math.max(1,Math.abs(M),Math.abs(cn))&&Math.abs(z-Nt)<=rs*Math.max(1,Math.abs(z),Math.abs(Nt))&&Math.abs(V-Mt)<=rs*Math.max(1,Math.abs(V),Math.abs(Mt))&&Math.abs(G-Xt)<=rs*Math.max(1,Math.abs(G),Math.abs(Xt))&&Math.abs(X-qt)<=rs*Math.max(1,Math.abs(X),Math.abs(qt))&&Math.abs(J-Bt)<=rs*Math.max(1,Math.abs(J),Math.abs(Bt))&&Math.abs(ie-st)<=rs*Math.max(1,Math.abs(ie),Math.abs(st))&&Math.abs(le-Qt)<=rs*Math.max(1,Math.abs(le),Math.abs(Qt))&&Math.abs(ye-Zt)<=rs*Math.max(1,Math.abs(ye),Math.abs(Zt))&&Math.abs(be-wn)<=rs*Math.max(1,Math.abs(be),Math.abs(wn))},R.a0=Ln,R.a1=xt,R.a2=Je,R.a3=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((r=>{t.onloadstart=()=>{r(t)};for(const u of n){const m=window.document.createElement("source");Cn(u)||(t.crossOrigin="Anonymous"),m.src=u,t.appendChild(m)}}))},R.a4=function(){return ht++},R.a5=Ct,R.a6=tc,R.a7=At,R.a8=$l,R.a9=He,R.aA=function(n){if(n.type==="custom")return new zh(n);switch(n.type){case"background":return new Dh(n);case"circle":return new rp(n);case"fill":return new ap(n);case"fill-extrusion":return new dd(n);case"heatmap":return new sp(n);case"hillshade":return new Jf(n);case"line":return new Ju(n);case"raster":return new mp(n);case"symbol":return new Tu(n)}},R.aB=St,R.aC=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let r=[];try{if(!ot(n.version,t.version))return[{command:"setStyle",args:[t]}];ot(n.center,t.center)||r.push({command:"setCenter",args:[t.center]}),ot(n.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),ot(n.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),ot(n.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),ot(n.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),ot(n.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),ot(n.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),ot(n.light,t.light)||r.push({command:"setLight",args:[t.light]}),ot(n.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),ot(n.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),ot(n.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const u={},m=[];(function(x,I,M,z){let V;for(V in I=I||{},x=x||{})Object.prototype.hasOwnProperty.call(x,V)&&(Object.prototype.hasOwnProperty.call(I,V)||pr(V,M,z));for(V in I)Object.prototype.hasOwnProperty.call(I,V)&&(Object.prototype.hasOwnProperty.call(x,V)?ot(x[V],I[V])||(x[V].type==="geojson"&&I[V].type==="geojson"&&vn(x,I,V)?ai(M,{command:"setGeoJSONSourceData",args:[V,I[V].data]}):As(V,I,M,z)):ps(V,I,M))})(n.sources,t.sources,m,u);const v=[];n.layers&&n.layers.forEach((x=>{"source"in x&&u[x.source]?r.push({command:"removeLayer",args:[x.id]}):v.push(x)})),r=r.concat(m),(function(x,I,M){I=I||[];const z=(x=x||[]).map(sa),V=I.map(sa),G=x.reduce(aa,{}),X=I.reduce(aa,{}),J=z.slice(),ie=Object.create(null);let le,ye,be,Ue,Ie;for(let Be=0,Qe=0;Be<z.length;Be++)le=z[Be],Object.prototype.hasOwnProperty.call(X,le)?Qe++:(ai(M,{command:"removeLayer",args:[le]}),J.splice(J.indexOf(le,Qe),1));for(let Be=0,Qe=0;Be<V.length;Be++)le=V[V.length-1-Be],J[J.length-1-Be]!==le&&(Object.prototype.hasOwnProperty.call(G,le)?(ai(M,{command:"removeLayer",args:[le]}),J.splice(J.lastIndexOf(le,J.length-Qe),1)):Qe++,Ue=J[J.length-Be],ai(M,{command:"addLayer",args:[X[le],Ue]}),J.splice(J.length-Be,0,le),ie[le]=!0);for(let Be=0;Be<V.length;Be++)if(le=V[Be],ye=G[le],be=X[le],!ie[le]&&!ot(ye,be))if(ot(ye.source,be.source)&&ot(ye["source-layer"],be["source-layer"])&&ot(ye.type,be.type)){for(Ie in ir(ye.layout,be.layout,M,le,null,"setLayoutProperty"),ir(ye.paint,be.paint,M,le,null,"setPaintProperty"),ot(ye.filter,be.filter)||ai(M,{command:"setFilter",args:[le,be.filter]}),ot(ye.minzoom,be.minzoom)&&ot(ye.maxzoom,be.maxzoom)||ai(M,{command:"setLayerZoomRange",args:[le,be.minzoom,be.maxzoom]}),ye)Object.prototype.hasOwnProperty.call(ye,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?ir(ye[Ie],be[Ie],M,le,Ie.slice(6),"setPaintProperty"):ot(ye[Ie],be[Ie])||ai(M,{command:"setLayerProperty",args:[le,Ie,be[Ie]]}));for(Ie in be)Object.prototype.hasOwnProperty.call(be,Ie)&&!Object.prototype.hasOwnProperty.call(ye,Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&(Ie.indexOf("paint.")===0?ir(ye[Ie],be[Ie],M,le,Ie.slice(6),"setPaintProperty"):ot(ye[Ie],be[Ie])||ai(M,{command:"setLayerProperty",args:[le,Ie,be[Ie]]}))}else ai(M,{command:"removeLayer",args:[le]}),Ue=J[J.lastIndexOf(le)+1],ai(M,{command:"addLayer",args:[be,Ue]})})(v,t.layers,r)}catch(u){console.warn("Unable to compute style diff:",u),r=[{command:"setStyle",args:[t]}]}return r},R.aD=function(n){const t=[],r=n.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},R.aE=function n(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let u=0;u<t.length;u++)if(!n(t[u],r[u]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const u in t)if(!n(t[u],r[u]))return!1;return!0}return t===r},R.aF=mt,R.aG=Kt,R.aH=class extends Vi{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},R.aI=lr,R.aJ=class extends Vi{constructor(n,t){super(n,t),this.current=Sc}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},R.aK=kc,R.aL=$u,R.aM=hn,R.aN=class extends Vi{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},R.aO=class extends Vi{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},R.aP=function(n,t,r,u,m,v,x){var I=1/(t-r),M=1/(u-m),z=1/(v-x);return n[0]=-2*I,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*M,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*z,n[11]=0,n[12]=(t+r)*I,n[13]=(m+u)*M,n[14]=(x+v)*z,n[15]=1,n},R.aQ=ch,R.aR=class extends Ae{},R.aS=Bc,R.aT=class extends Ve{},R.aU=Mc,R.aV=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},R.aW=gh,R.aX=$i,R.aY=Zs,R.aZ=class extends Ut{},R.a_=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},R.aa=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,u,m,v)=>{const x=m||v;return t[u]=!x||x.toLowerCase(),""})),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},R.ab=function(n,t){const r=[];for(const u in n)u in t||r.push(u);return r},R.ac=nt,R.ad=function(n,t,r){var u=Math.sin(r),m=Math.cos(r),v=t[0],x=t[1],I=t[2],M=t[3],z=t[4],V=t[5],G=t[6],X=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=v*m+z*u,n[1]=x*m+V*u,n[2]=I*m+G*u,n[3]=M*m+X*u,n[4]=z*m-v*u,n[5]=V*m-x*u,n[6]=G*m-I*u,n[7]=X*m-M*u,n},R.ae=function(n){var t=new Hu(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},R.af=hh,R.ag=function(n,t){let r=0,u=0;if(n.kind==="constant")u=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:m,minZoom:v,maxZoom:x}=n,I=m?nt(ji.interpolationFactor(m,t,v,x),0,1):0;n.kind==="camera"?u=Wn.number(n.minSize,n.maxSize,I):r=I}return{uSizeT:r,uSize:u}},R.ai=function(n,{uSize:t,uSizeT:r},{lowerSize:u,upperSize:m}){return n.kind==="source"?u/Va:n.kind==="composite"?Wn.number(u/Va,m/Va,r):t},R.aj=ec,R.ak=function(n,t,r,u){const m=t.y-n.y,v=t.x-n.x,x=u.y-r.y,I=u.x-r.x,M=x*v-I*m;if(M===0)return null;const z=(I*(n.y-r.y)-x*(n.x-r.x))/M;return new B(n.x+z*v,n.y+z*m)},R.al=_n,R.am=tf,R.an=uh,R.ao=function(n){let t=1/0,r=1/0,u=-1/0,m=-1/0;for(const v of n)t=Math.min(t,v.x),r=Math.min(r,v.y),u=Math.max(u,v.x),m=Math.max(m,v.y);return[t,r,u,m]},R.ap=Di,R.ar=Wc,R.as=function(n,t){var r=t[0],u=t[1],m=t[2],v=t[3],x=t[4],I=t[5],M=t[6],z=t[7],V=t[8],G=t[9],X=t[10],J=t[11],ie=t[12],le=t[13],ye=t[14],be=t[15],Ue=r*I-u*x,Ie=r*M-m*x,Be=r*z-v*x,Qe=u*M-m*I,ft=u*z-v*I,Dt=m*z-v*M,cn=V*le-G*ie,Nt=V*ye-X*ie,Mt=V*be-J*ie,Xt=G*ye-X*le,qt=G*be-J*le,Bt=X*be-J*ye,st=Ue*Bt-Ie*qt+Be*Xt+Qe*Mt-ft*Nt+Dt*cn;return st?(n[0]=(I*Bt-M*qt+z*Xt)*(st=1/st),n[1]=(m*qt-u*Bt-v*Xt)*st,n[2]=(le*Dt-ye*ft+be*Qe)*st,n[3]=(X*ft-G*Dt-J*Qe)*st,n[4]=(M*Mt-x*Bt-z*Nt)*st,n[5]=(r*Bt-m*Mt+v*Nt)*st,n[6]=(ye*Be-ie*Dt-be*Ie)*st,n[7]=(V*Dt-X*Be+J*Ie)*st,n[8]=(x*qt-I*Mt+z*cn)*st,n[9]=(u*Mt-r*qt-v*cn)*st,n[10]=(ie*ft-le*Be+be*Ue)*st,n[11]=(G*Be-V*ft-J*Ue)*st,n[12]=(I*Nt-x*Xt-M*cn)*st,n[13]=(r*Xt-u*Nt+m*cn)*st,n[14]=(le*Ie-ie*Qe-ye*Ue)*st,n[15]=(V*Qe-G*Ie+X*Ue)*st,n):null},R.at=_p,R.au=Hc,R.av=vp,R.aw=function(){const n={},t=We.$version;for(const r in We.$root){const u=We.$root[r];if(u.required){let m=null;m=r==="version"?t:u.type==="array"?[]:{},m!=null&&(n[r]=m)}}return n},R.ax=pa,R.ay=Re,R.az=function(n){n=n.slice();const t=Object.create(null);for(let r=0;r<n.length;r++)t[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=To(n[r],t[n[r].ref]));return n},R.b=rn,R.b0=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},R.b1=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},R.b2=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},R.b3=it,R.b4=pt,R.b5=xe,R.b6=function(n,t,r,u,m){var v,x=1/Math.tan(t/2);return n[0]=x/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,m!=null&&m!==1/0?(n[10]=(m+u)*(v=1/(u-m)),n[14]=2*m*u*v):(n[10]=-1,n[14]=-2*u),n},R.b7=function(n,t,r){var u=Math.sin(r),m=Math.cos(r),v=t[4],x=t[5],I=t[6],M=t[7],z=t[8],V=t[9],G=t[10],X=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=v*m+z*u,n[5]=x*m+V*u,n[6]=I*m+G*u,n[7]=M*m+X*u,n[8]=z*m-v*u,n[9]=V*m-x*u,n[10]=G*m-I*u,n[11]=X*m-M*u,n},R.b8=qe,R.b9=tt,R.bA=Uo,R.bB=function(n){return n.message===rt},R.bC=L,R.bD=ui,R.ba=function(n){return n*Math.PI/180},R.bb=function(n,t){const{x:r,y:u}=Ke.fromLngLat(t);return!(n<0||n>25||u<0||u>=1||r<0||r>=1)},R.bc=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},R.bd=class extends U{},R.be=l,R.bf=_y,R.bh=Rn,R.bi=function(n,t){Pt.REGISTERED_PROTOCOLS[n]=t},R.bj=function(n){delete Pt.REGISTERED_PROTOCOLS[n]},R.bk=function(n,t){const r={};for(let m=0;m<n.length;m++){const v=t&&t[n[m].id]||ao(n[m]);t&&(t[n[m].id]=v);let x=r[v];x||(x=r[v]=[]),x.push(n[m])}const u=[];for(const m in r)u.push(r[m]);return u},R.bl=zt,R.bm=tr,R.bn=Ne,R.bo=wf,R.bp=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Wi/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],r=t.layout,u=t._unevaluatedLayout._values,m={layoutIconSize:u["icon-size"].possiblyEvaluate(new On(n.bucket.zoom+1),n.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new On(n.bucket.zoom+1),n.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new On(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:V}=n.bucket.textSizeData;m.compositeTextSizes=[u["text-size"].possiblyEvaluate(new On(z),n.canonical),u["text-size"].possiblyEvaluate(new On(V),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:V}=n.bucket.iconSizeData;m.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new On(z),n.canonical),u["icon-size"].possiblyEvaluate(new On(V),n.canonical)]}const v=r.get("text-line-height")*Di,x=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",I=r.get("text-keep-upright"),M=r.get("text-size");for(const z of n.bucket.features){const V=r.get("text-font").evaluate(z,{},n.canonical).join(","),G=M.evaluate(z,{},n.canonical),X=m.layoutTextSize.evaluate(z,{},n.canonical),J=m.layoutIconSize.evaluate(z,{},n.canonical),ie={horizontal:{},vertical:void 0},le=z.text;let ye,be=[0,0];if(le){const Be=le.toString(),Qe=r.get("text-letter-spacing").evaluate(z,{},n.canonical)*Di,ft=Kh(Be)?Qe:0,Dt=r.get("text-anchor").evaluate(z,{},n.canonical),cn=gm(t,z,n.canonical);if(!cn){const qt=r.get("text-radial-offset").evaluate(z,{},n.canonical);be=qt?mm(Dt,[qt*Di,yp]):r.get("text-offset").evaluate(z,{},n.canonical).map((Bt=>Bt*Di))}let Nt=x?"center":r.get("text-justify").evaluate(z,{},n.canonical);const Mt=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(z,{},n.canonical)*Di:1/0,Xt=()=>{n.bucket.allowVerticalPlacement&&vc(Be)&&(ie.vertical=Zc(le,n.glyphMap,n.glyphPositions,n.imagePositions,V,Mt,v,Dt,"left",ft,be,R.ah.vertical,!0,X,G))};if(!x&&cn){const qt=new Set;if(Nt==="auto")for(let st=0;st<cn.values.length;st+=2)qt.add(_p(cn.values[st]));else qt.add(Nt);let Bt=!1;for(const st of qt)if(!ie.horizontal[st])if(Bt)ie.horizontal[st]=ie.horizontal[0];else{const Qt=Zc(le,n.glyphMap,n.glyphPositions,n.imagePositions,V,Mt,v,"center",st,ft,be,R.ah.horizontal,!1,X,G);Qt&&(ie.horizontal[st]=Qt,Bt=Qt.positionedLines.length===1)}Xt()}else{Nt==="auto"&&(Nt=_p(Dt));const qt=Zc(le,n.glyphMap,n.glyphPositions,n.imagePositions,V,Mt,v,Dt,Nt,ft,be,R.ah.horizontal,!1,X,G);qt&&(ie.horizontal[Nt]=qt),Xt(),vc(Be)&&x&&I&&(ie.vertical=Zc(le,n.glyphMap,n.glyphPositions,n.imagePositions,V,Mt,v,Dt,Nt,ft,be,R.ah.vertical,!1,X,G))}}let Ue=!1;if(z.icon&&z.icon.name){const Be=n.imageMap[z.icon.name];Be&&(ye=Jl(n.imagePositions[z.icon.name],r.get("icon-offset").evaluate(z,{},n.canonical),r.get("icon-anchor").evaluate(z,{},n.canonical)),Ue=!!Be.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=Ue:n.bucket.sdfIcons!==Ue&&Vt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Be.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const Ie=_m(ie.horizontal)||ie.vertical;n.bucket.iconsInText=!!Ie&&Ie.iconsInText,(Ie||ye)&&gy(n.bucket,z,ie,ye,n.imageMap,m,X,J,be,Ue,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},R.bq=Xs,R.br=xh,R.bs=Sa,R.bt=Hl,R.bu=hl,R.bv=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},R.bw=function(n,t,r,u,m){return h(this,void 0,void 0,(function*(){if(Te())try{return yield Ft(n,t,r,u,m)}catch{}return(function(v,x,I,M,z){const V=v.width,G=v.height;et&&Le||(et=new OffscreenCanvas(V,G),Le=et.getContext("2d",{willReadFrequently:!0})),et.width=V,et.height=G,Le.drawImage(v,0,0,V,G);const X=Le.getImageData(x,I,M,z);return Le.clearRect(0,0,V,G),X.data})(n,t,r,u,m)}))},R.bx=nn,R.by=K,R.bz=ne,R.c=an,R.d=n=>h(void 0,void 0,void 0,(function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),R.e=Ge,R.f=n=>new Promise(((t,r)=>{const u=new Image;u.onload=()=>{t(u),URL.revokeObjectURL(u.src),u.onload=null,window.requestAnimationFrame((()=>{u.src=wt}))},u.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const m=new Blob([new Uint8Array(n)],{type:"image/png"});u.src=n.byteLength?URL.createObjectURL(m):wt})),R.g=yn,R.h=(n,t)=>ei(Ge(n,{type:"json"}),t),R.i=en,R.j=Ur,R.k=Gi,R.l=(n,t)=>ei(Ge(n,{type:"arrayBuffer"}),t),R.m=ei,R.n=function(n){return new hl(n).readFields(Iu,[])},R.o=xu,R.p=Gc,R.q=_,R.r=yc,R.s=Cn,R.t=Vu,R.u=fo,R.v=We,R.w=Vt,R.x=function([n,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(r),y:n*Math.sin(t)*Math.sin(r),z:n*Math.cos(r)}},R.y=Wn,R.z=On})),C("worker",["./shared"],(function(R){class h{constructor(Y){this.keyCache={},Y&&this.replace(Y)}replace(Y){this._layerConfigs={},this._layers={},this.update(Y,[])}update(Y,W){for(const se of Y){this._layerConfigs[se.id]=se;const Ee=this._layers[se.id]=R.aA(se);Ee._featureFilter=R.a7(Ee.filter),this.keyCache[se.id]&&delete this.keyCache[se.id]}for(const se of W)delete this.keyCache[se],delete this._layerConfigs[se],delete this._layers[se];this.familiesBySource={};const ae=R.bk(Object.values(this._layerConfigs),this.keyCache);for(const se of ae){const Ee=se.map((Ze=>this._layers[Ze.id])),Me=Ee[0];if(Me.visibility==="none")continue;const Oe=Me.source||"";let ke=this.familiesBySource[Oe];ke||(ke=this.familiesBySource[Oe]={});const Ye=Me.sourceLayer||"_geojsonTileLayer";let lt=ke[Ye];lt||(lt=ke[Ye]=[]),lt.push(Ee)}}}class K{constructor(Y){const W={},ae=[];for(const Oe in Y){const ke=Y[Oe],Ye=W[Oe]={};for(const lt in ke){const Ze=ke[+lt];if(!Ze||Ze.bitmap.width===0||Ze.bitmap.height===0)continue;const vt={x:0,y:0,w:Ze.bitmap.width+2,h:Ze.bitmap.height+2};ae.push(vt),Ye[lt]={rect:vt,metrics:Ze.metrics}}}const{w:se,h:Ee}=R.p(ae),Me=new R.o({width:se||1,height:Ee||1});for(const Oe in Y){const ke=Y[Oe];for(const Ye in ke){const lt=ke[+Ye];if(!lt||lt.bitmap.width===0||lt.bitmap.height===0)continue;const Ze=W[Oe][Ye].rect;R.o.copy(lt.bitmap,Me,{x:0,y:0},{x:Ze.x+1,y:Ze.y+1},lt.bitmap)}}this.image=Me,this.positions=W}}R.bl("GlyphAtlas",K);class ne{constructor(Y){this.tileID=new R.S(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.uid=Y.uid,this.zoom=Y.zoom,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.returnDependencies=!!Y.returnDependencies,this.promoteId=Y.promoteId,this.inFlightDependencies=[]}parse(Y,W,ae,se){return R._(this,void 0,void 0,(function*(){this.status="parsing",this.data=Y,this.collisionBoxArray=new R.a5;const Ee=new R.bm(Object.keys(Y.layers).sort()),Me=new R.bn(this.tileID,this.promoteId);Me.bucketLayerIDs=[];const Oe={},ke={featureIndex:Me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ae},Ye=W.familiesBySource[this.source];for(const xn in Ye){const Zn=Y.layers[xn];if(!Zn)continue;Zn.version===1&&R.w(`Vector tile source "${this.source}" layer "${xn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ri=Ee.encode(xn),Si=[];for(let Bn=0;Bn<Zn.length;Bn++){const Er=Zn.feature(Bn),Co=Me.getId(Er,xn);Si.push({feature:Er,id:Co,index:Bn,sourceLayerIndex:ri})}for(const Bn of Ye[xn]){const Er=Bn[0];Er.source!==this.source&&R.w(`layer.source = ${Er.source} does not equal this.source = ${this.source}`),Er.minzoom&&this.zoom<Math.floor(Er.minzoom)||Er.maxzoom&&this.zoom>=Er.maxzoom||Er.visibility!=="none"&&(ee(Bn,this.zoom,ae),(Oe[Er.id]=Er.createBucket({index:Me.bucketLayerIDs.length,layers:Bn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ri,sourceID:this.source})).populate(Si,ke,this.tileID.canonical),Me.bucketLayerIDs.push(Bn.map((Co=>Co.id))))}}const lt=R.aF(ke.glyphDependencies,(xn=>Object.keys(xn).map(Number)));this.inFlightDependencies.forEach((xn=>xn?.abort())),this.inFlightDependencies=[];let Ze=Promise.resolve({});if(Object.keys(lt).length){const xn=new AbortController;this.inFlightDependencies.push(xn),Ze=se.sendAsync({type:"GG",data:{stacks:lt,source:this.source,tileID:this.tileID,type:"glyphs"}},xn)}const vt=Object.keys(ke.iconDependencies);let jt=Promise.resolve({});if(vt.length){const xn=new AbortController;this.inFlightDependencies.push(xn),jt=se.sendAsync({type:"GI",data:{icons:vt,source:this.source,tileID:this.tileID,type:"icons"}},xn)}const Jt=Object.keys(ke.patternDependencies);let Fn=Promise.resolve({});if(Jt.length){const xn=new AbortController;this.inFlightDependencies.push(xn),Fn=se.sendAsync({type:"GI",data:{icons:Jt,source:this.source,tileID:this.tileID,type:"patterns"}},xn)}const[bn,kn,Sn]=yield Promise.all([Ze,jt,Fn]),pi=new K(bn),ti=new R.bo(kn,Sn);for(const xn in Oe){const Zn=Oe[xn];Zn instanceof R.a6?(ee(Zn.layers,this.zoom,ae),R.bp({bucket:Zn,glyphMap:bn,glyphPositions:pi.positions,imageMap:kn,imagePositions:ti.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Zn.hasPattern&&(Zn instanceof R.bq||Zn instanceof R.br||Zn instanceof R.bs)&&(ee(Zn.layers,this.zoom,ae),Zn.addFeatures(ke,this.tileID.canonical,ti.patternPositions))}return this.status="done",{buckets:Object.values(Oe).filter((xn=>!xn.isEmpty())),featureIndex:Me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pi.image,imageAtlas:ti,glyphMap:this.returnDependencies?bn:null,iconMap:this.returnDependencies?kn:null,glyphPositions:this.returnDependencies?pi.positions:null}}))}}function ee(_e,Y,W){const ae=new R.z(Y);for(const se of _e)se.recalculate(ae,W)}class B{constructor(Y,W,ae){this.actor=Y,this.layerIndex=W,this.availableImages=ae,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Y,W){return R._(this,void 0,void 0,(function*(){const ae=yield R.l(Y.request,W);try{return{vectorTile:new R.bt.VectorTile(new R.bu(ae.data)),rawData:ae.data,cacheControl:ae.cacheControl,expires:ae.expires}}catch(se){const Ee=new Uint8Array(ae.data);let Me=`Unable to parse the tile at ${Y.request.url}, `;throw Me+=Ee[0]===31&&Ee[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${se.message}`,new Error(Me)}}))}loadTile(Y){return R._(this,void 0,void 0,(function*(){const W=Y.uid,ae=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new R.bv(Y.request),se=new ne(Y);this.loading[W]=se;const Ee=new AbortController;se.abort=Ee;try{const Me=yield this.loadVectorTile(Y,Ee);if(delete this.loading[W],!Me)return null;const Oe=Me.rawData,ke={};Me.expires&&(ke.expires=Me.expires),Me.cacheControl&&(ke.cacheControl=Me.cacheControl);const Ye={};if(ae){const Ze=ae.finish();Ze&&(Ye.resourceTiming=JSON.parse(JSON.stringify(Ze)))}se.vectorTile=Me.vectorTile;const lt=se.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[W]=se,this.fetching[W]={rawTileData:Oe,cacheControl:ke,resourceTiming:Ye};try{const Ze=yield lt;return R.e({rawTileData:Oe.slice(0)},Ze,ke,Ye)}finally{delete this.fetching[W]}}catch(Me){throw delete this.loading[W],se.status="done",this.loaded[W]=se,Me}}))}reloadTile(Y){return R._(this,void 0,void 0,(function*(){const W=Y.uid;if(!this.loaded||!this.loaded[W])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ae=this.loaded[W];if(ae.showCollisionBoxes=Y.showCollisionBoxes,ae.status==="parsing"){const se=yield ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor);let Ee;if(this.fetching[W]){const{rawTileData:Me,cacheControl:Oe,resourceTiming:ke}=this.fetching[W];delete this.fetching[W],Ee=R.e({rawTileData:Me.slice(0)},se,Oe,ke)}else Ee=se;return Ee}if(ae.status==="done"&&ae.vectorTile)return ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor)}))}abortTile(Y){return R._(this,void 0,void 0,(function*(){const W=this.loading,ae=Y.uid;W&&W[ae]&&W[ae].abort&&(W[ae].abort.abort(),delete W[ae])}))}removeTile(Y){return R._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[Y.uid]&&delete this.loaded[Y.uid]}))}}class q{constructor(){this.loaded={}}loadTile(Y){return R._(this,void 0,void 0,(function*(){const{uid:W,encoding:ae,rawImageData:se,redFactor:Ee,greenFactor:Me,blueFactor:Oe,baseShift:ke}=Y,Ye=se.width+2,lt=se.height+2,Ze=R.b(se)?new R.R({width:Ye,height:lt},yield R.bw(se,-1,-1,Ye,lt)):se,vt=new R.bx(W,Ze,ae,Ee,Me,Oe,ke);return this.loaded=this.loaded||{},this.loaded[W]=vt,vt}))}removeTile(Y){const W=this.loaded,ae=Y.uid;W&&W[ae]&&delete W[ae]}}function ue(_e,Y){if(_e.length!==0){ce(_e[0],Y);for(var W=1;W<_e.length;W++)ce(_e[W],!Y)}}function ce(_e,Y){for(var W=0,ae=0,se=0,Ee=_e.length,Me=Ee-1;se<Ee;Me=se++){var Oe=(_e[se][0]-_e[Me][0])*(_e[Me][1]+_e[se][1]),ke=W+Oe;ae+=Math.abs(W)>=Math.abs(Oe)?W-ke+Oe:Oe-ke+W,W=ke}W+ae>=0!=!!Y&&_e.reverse()}var de=R.by((function _e(Y,W){var ae,se=Y&&Y.type;if(se==="FeatureCollection")for(ae=0;ae<Y.features.length;ae++)_e(Y.features[ae],W);else if(se==="GeometryCollection")for(ae=0;ae<Y.geometries.length;ae++)_e(Y.geometries[ae],W);else if(se==="Feature")_e(Y.geometry,W);else if(se==="Polygon")ue(Y.coordinates,W);else if(se==="MultiPolygon")for(ae=0;ae<Y.coordinates.length;ae++)ue(Y.coordinates[ae],W);return Y}));const Pe=R.bt.VectorTileFeature.prototype.toGeoJSON;var je={exports:{}},Te=R.bz,qe=R.bt.VectorTileFeature,tt=nt;function nt(_e,Y){this.options=Y||{},this.features=_e,this.length=_e.length}function it(_e,Y){this.id=typeof _e.id=="number"?_e.id:void 0,this.type=_e.type,this.rawGeometry=_e.type===1?[_e.geometry]:_e.geometry,this.properties=_e.tags,this.extent=Y||4096}nt.prototype.feature=function(_e){return new it(this.features[_e],this.options.extent)},it.prototype.loadGeometry=function(){var _e=this.rawGeometry;this.geometry=[];for(var Y=0;Y<_e.length;Y++){for(var W=_e[Y],ae=[],se=0;se<W.length;se++)ae.push(new Te(W[se][0],W[se][1]));this.geometry.push(ae)}return this.geometry},it.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var _e=this.geometry,Y=1/0,W=-1/0,ae=1/0,se=-1/0,Ee=0;Ee<_e.length;Ee++)for(var Me=_e[Ee],Oe=0;Oe<Me.length;Oe++){var ke=Me[Oe];Y=Math.min(Y,ke.x),W=Math.max(W,ke.x),ae=Math.min(ae,ke.y),se=Math.max(se,ke.y)}return[Y,ae,W,se]},it.prototype.toGeoJSON=qe.prototype.toGeoJSON;var Ge=R.bA,ht=tt;function mt(_e){var Y=new Ge;return(function(W,ae){for(var se in W.layers)ae.writeMessage(3,Kt,W.layers[se])})(_e,Y),Y.finish()}function Kt(_e,Y){var W;Y.writeVarintField(15,_e.version||1),Y.writeStringField(1,_e.name||""),Y.writeVarintField(5,_e.extent||4096);var ae={keys:[],values:[],keycache:{},valuecache:{}};for(W=0;W<_e.length;W++)ae.feature=_e.feature(W),Y.writeMessage(2,St,ae);var se=ae.keys;for(W=0;W<se.length;W++)Y.writeStringField(3,se[W]);var Ee=ae.values;for(W=0;W<Ee.length;W++)Y.writeMessage(4,fn,Ee[W])}function St(_e,Y){var W=_e.feature;W.id!==void 0&&Y.writeVarintField(1,W.id),Y.writeMessage(2,Ht,_e),Y.writeVarintField(3,W.type),Y.writeMessage(4,en,W)}function Ht(_e,Y){var W=_e.feature,ae=_e.keys,se=_e.values,Ee=_e.keycache,Me=_e.valuecache;for(var Oe in W.properties){var ke=W.properties[Oe],Ye=Ee[Oe];if(ke!==null){Ye===void 0&&(ae.push(Oe),Ee[Oe]=Ye=ae.length-1),Y.writeVarint(Ye);var lt=typeof ke;lt!=="string"&&lt!=="boolean"&&lt!=="number"&&(ke=JSON.stringify(ke));var Ze=lt+":"+ke,vt=Me[Ze];vt===void 0&&(se.push(ke),Me[Ze]=vt=se.length-1),Y.writeVarint(vt)}}}function Vt(_e,Y){return(Y<<3)+(7&_e)}function ct(_e){return _e<<1^_e>>31}function en(_e,Y){for(var W=_e.loadGeometry(),ae=_e.type,se=0,Ee=0,Me=W.length,Oe=0;Oe<Me;Oe++){var ke=W[Oe],Ye=1;ae===1&&(Ye=ke.length),Y.writeVarint(Vt(1,Ye));for(var lt=ae===3?ke.length-1:ke.length,Ze=0;Ze<lt;Ze++){Ze===1&&ae!==1&&Y.writeVarint(Vt(2,lt-1));var vt=ke[Ze].x-se,jt=ke[Ze].y-Ee;Y.writeVarint(ct(vt)),Y.writeVarint(ct(jt)),se+=vt,Ee+=jt}ae===3&&Y.writeVarint(Vt(7,1))}}function fn(_e,Y){var W=typeof _e;W==="string"?Y.writeStringField(1,_e):W==="boolean"?Y.writeBooleanField(7,_e):W==="number"&&(_e%1!=0?Y.writeDoubleField(3,_e):_e<0?Y.writeSVarintField(6,_e):Y.writeVarintField(5,_e))}je.exports=mt,je.exports.fromVectorTileJs=mt,je.exports.fromGeojsonVt=function(_e,Y){Y=Y||{};var W={};for(var ae in _e)W[ae]=new ht(_e[ae].features,Y),W[ae].name=ae,W[ae].version=Y.version,W[ae].extent=Y.extent;return mt({layers:W})},je.exports.GeoJSONWrapper=ht;var rn=R.by(je.exports);const wt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:_e=>_e},Ft=Math.fround||(et=new Float32Array(1),_e=>(et[0]=+_e,et[0]));var et;const Le=3,rt=5,an=6;class Pt{constructor(Y){this.options=Object.assign(Object.create(wt),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:W,minZoom:ae,maxZoom:se}=this.options;W&&console.time("total time");const Ee=`prepare ${Y.length} points`;W&&console.time(Ee),this.points=Y;const Me=[];for(let ke=0;ke<Y.length;ke++){const Ye=Y[ke];if(!Ye.geometry)continue;const[lt,Ze]=Ye.geometry.coordinates,vt=Ft(Rn(lt)),jt=Ft(Re(Ze));Me.push(vt,jt,1/0,ke,-1,1),this.options.reduce&&Me.push(0)}let Oe=this.trees[se+1]=this._createTree(Me);W&&console.timeEnd(Ee);for(let ke=se;ke>=ae;ke--){const Ye=+Date.now();Oe=this.trees[ke]=this._createTree(this._cluster(Oe,ke)),W&&console.log("z%d: %d clusters in %dms",ke,Oe.numItems,+Date.now()-Ye)}return W&&console.timeEnd("total time"),this}getClusters(Y,W){let ae=((Y[0]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,Y[1]));let Ee=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ae=-180,Ee=180;else if(ae>Ee){const Ze=this.getClusters([ae,se,180,Me],W),vt=this.getClusters([-180,se,Ee,Me],W);return Ze.concat(vt)}const Oe=this.trees[this._limitZoom(W)],ke=Oe.range(Rn(ae),Re(Me),Rn(Ee),Re(se)),Ye=Oe.data,lt=[];for(const Ze of ke){const vt=this.stride*Ze;lt.push(Ye[vt+rt]>1?yn(Ye,vt,this.clusterProps):this.points[Ye[vt+Le]])}return lt}getChildren(Y){const W=this._getOriginId(Y),ae=this._getOriginZoom(Y),se="No cluster with the specified id.",Ee=this.trees[ae];if(!Ee)throw new Error(se);const Me=Ee.data;if(W*this.stride>=Me.length)throw new Error(se);const Oe=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),ke=Ee.within(Me[W*this.stride],Me[W*this.stride+1],Oe),Ye=[];for(const lt of ke){const Ze=lt*this.stride;Me[Ze+4]===Y&&Ye.push(Me[Ze+rt]>1?yn(Me,Ze,this.clusterProps):this.points[Me[Ze+Le]])}if(Ye.length===0)throw new Error(se);return Ye}getLeaves(Y,W,ae){const se=[];return this._appendLeaves(se,Y,W=W||10,ae=ae||0,0),se}getTile(Y,W,ae){const se=this.trees[this._limitZoom(Y)],Ee=Math.pow(2,Y),{extent:Me,radius:Oe}=this.options,ke=Oe/Me,Ye=(ae-ke)/Ee,lt=(ae+1+ke)/Ee,Ze={features:[]};return this._addTileFeatures(se.range((W-ke)/Ee,Ye,(W+1+ke)/Ee,lt),se.data,W,ae,Ee,Ze),W===0&&this._addTileFeatures(se.range(1-ke/Ee,Ye,1,lt),se.data,Ee,ae,Ee,Ze),W===Ee-1&&this._addTileFeatures(se.range(0,Ye,ke/Ee,lt),se.data,-1,ae,Ee,Ze),Ze.features.length?Ze:null}getClusterExpansionZoom(Y){let W=this._getOriginZoom(Y)-1;for(;W<=this.options.maxZoom;){const ae=this.getChildren(Y);if(W++,ae.length!==1)break;Y=ae[0].properties.cluster_id}return W}_appendLeaves(Y,W,ae,se,Ee){const Me=this.getChildren(W);for(const Oe of Me){const ke=Oe.properties;if(ke&&ke.cluster?Ee+ke.point_count<=se?Ee+=ke.point_count:Ee=this._appendLeaves(Y,ke.cluster_id,ae,se,Ee):Ee<se?Ee++:Y.push(Oe),Y.length===ae)break}return Ee}_createTree(Y){const W=new R.av(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ae=0;ae<Y.length;ae+=this.stride)W.add(Y[ae],Y[ae+1]);return W.finish(),W.data=Y,W}_addTileFeatures(Y,W,ae,se,Ee,Me){for(const Oe of Y){const ke=Oe*this.stride,Ye=W[ke+rt]>1;let lt,Ze,vt;if(Ye)lt=zn(W,ke,this.clusterProps),Ze=W[ke],vt=W[ke+1];else{const Fn=this.points[W[ke+Le]];lt=Fn.properties;const[bn,kn]=Fn.geometry.coordinates;Ze=Rn(bn),vt=Re(kn)}const jt={type:1,geometry:[[Math.round(this.options.extent*(Ze*Ee-ae)),Math.round(this.options.extent*(vt*Ee-se))]],tags:lt};let Jt;Jt=Ye||this.options.generateId?W[ke+Le]:this.points[W[ke+Le]].id,Jt!==void 0&&(jt.id=Jt),Me.features.push(jt)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,W){const{radius:ae,extent:se,reduce:Ee,minPoints:Me}=this.options,Oe=ae/(se*Math.pow(2,W)),ke=Y.data,Ye=[],lt=this.stride;for(let Ze=0;Ze<ke.length;Ze+=lt){if(ke[Ze+2]<=W)continue;ke[Ze+2]=W;const vt=ke[Ze],jt=ke[Ze+1],Jt=Y.within(ke[Ze],ke[Ze+1],Oe),Fn=ke[Ze+rt];let bn=Fn;for(const kn of Jt){const Sn=kn*lt;ke[Sn+2]>W&&(bn+=ke[Sn+rt])}if(bn>Fn&&bn>=Me){let kn,Sn=vt*Fn,pi=jt*Fn,ti=-1;const xn=((Ze/lt|0)<<5)+(W+1)+this.points.length;for(const Zn of Jt){const ri=Zn*lt;if(ke[ri+2]<=W)continue;ke[ri+2]=W;const Si=ke[ri+rt];Sn+=ke[ri]*Si,pi+=ke[ri+1]*Si,ke[ri+4]=xn,Ee&&(kn||(kn=this._map(ke,Ze,!0),ti=this.clusterProps.length,this.clusterProps.push(kn)),Ee(kn,this._map(ke,ri)))}ke[Ze+4]=xn,Ye.push(Sn/bn,pi/bn,1/0,xn,-1,bn),Ee&&Ye.push(ti)}else{for(let kn=0;kn<lt;kn++)Ye.push(ke[Ze+kn]);if(bn>1)for(const kn of Jt){const Sn=kn*lt;if(!(ke[Sn+2]<=W)){ke[Sn+2]=W;for(let pi=0;pi<lt;pi++)Ye.push(ke[Sn+pi])}}}}return Ye}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,W,ae){if(Y[W+rt]>1){const Me=this.clusterProps[Y[W+an]];return ae?Object.assign({},Me):Me}const se=this.points[Y[W+Le]].properties,Ee=this.options.map(se);return ae&&Ee===se?Object.assign({},Ee):Ee}}function yn(_e,Y,W){return{type:"Feature",id:_e[Y+Le],properties:zn(_e,Y,W),geometry:{type:"Point",coordinates:[(ae=_e[Y],360*(ae-.5)),ei(_e[Y+1])]}};var ae}function zn(_e,Y,W){const ae=_e[Y+rt],se=ae>=1e4?`${Math.round(ae/1e3)}k`:ae>=1e3?Math.round(ae/100)/10+"k":ae,Ee=_e[Y+an],Me=Ee===-1?{}:Object.assign({},W[Ee]);return Object.assign(Me,{cluster:!0,cluster_id:_e[Y+Le],point_count:ae,point_count_abbreviated:se})}function Rn(_e){return _e/360+.5}function Re(_e){const Y=Math.sin(_e*Math.PI/180),W=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return W<0?0:W>1?1:W}function ei(_e){const Y=(180-360*_e)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function Cn(_e,Y,W,ae){let se=ae;const Ee=Y+(W-Y>>1);let Me,Oe=W-Y;const ke=_e[Y],Ye=_e[Y+1],lt=_e[W],Ze=_e[W+1];for(let vt=Y+3;vt<W;vt+=3){const jt=Wt(_e[vt],_e[vt+1],ke,Ye,lt,Ze);if(jt>se)Me=vt,se=jt;else if(jt===se){const Jt=Math.abs(vt-Ee);Jt<Oe&&(Me=vt,Oe=Jt)}}se>ae&&(Me-Y>3&&Cn(_e,Y,Me,ae),_e[Me+2]=se,W-Me>3&&Cn(_e,Me,W,ae))}function Wt(_e,Y,W,ae,se,Ee){let Me=se-W,Oe=Ee-ae;if(Me!==0||Oe!==0){const ke=((_e-W)*Me+(Y-ae)*Oe)/(Me*Me+Oe*Oe);ke>1?(W=se,ae=Ee):ke>0&&(W+=Me*ke,ae+=Oe*ke)}return Me=_e-W,Oe=Y-ae,Me*Me+Oe*Oe}function we(_e,Y,W,ae){const se={id:_e??null,type:Y,geometry:W,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")Gi(se,W);else if(Y==="Polygon")Gi(se,W[0]);else if(Y==="MultiLineString")for(const Ee of W)Gi(se,Ee);else if(Y==="MultiPolygon")for(const Ee of W)Gi(se,Ee[0]);return se}function Gi(_e,Y){for(let W=0;W<Y.length;W+=3)_e.minX=Math.min(_e.minX,Y[W]),_e.minY=Math.min(_e.minY,Y[W+1]),_e.maxX=Math.max(_e.maxX,Y[W]),_e.maxY=Math.max(_e.maxY,Y[W+1])}function Ur(_e,Y,W,ae){if(!Y.geometry)return;const se=Y.geometry.coordinates;if(se&&se.length===0)return;const Ee=Y.geometry.type,Me=Math.pow(W.tolerance/((1<<W.maxZoom)*W.extent),2);let Oe=[],ke=Y.id;if(W.promoteId?ke=Y.properties[W.promoteId]:W.generateId&&(ke=ae||0),Ee==="Point")Rr(se,Oe);else if(Ee==="MultiPoint")for(const Ye of se)Rr(Ye,Oe);else if(Ee==="LineString")We(se,Oe,Me,!1);else if(Ee==="MultiLineString"){if(W.lineMetrics){for(const Ye of se)Oe=[],We(Ye,Oe,Me,!1),_e.push(we(ke,"LineString",Oe,Y.properties));return}ds(se,Oe,Me,!1)}else if(Ee==="Polygon")ds(se,Oe,Me,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(const Ye of Y.geometry.geometries)Ur(_e,{id:ke,geometry:Ye,properties:Y.properties},W,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ye of se){const lt=[];ds(Ye,lt,Me,!0),Oe.push(lt)}}_e.push(we(ke,Ee,Oe,Y.properties))}function Rr(_e,Y){Y.push(To(_e[0]),ot(_e[1]),0)}function We(_e,Y,W,ae){let se,Ee,Me=0;for(let ke=0;ke<_e.length;ke++){const Ye=To(_e[ke][0]),lt=ot(_e[ke][1]);Y.push(Ye,lt,0),ke>0&&(Me+=ae?(se*lt-Ye*Ee)/2:Math.sqrt(Math.pow(Ye-se,2)+Math.pow(lt-Ee,2))),se=Ye,Ee=lt}const Oe=Y.length-3;Y[2]=1,Cn(Y,0,Oe,W),Y[Oe+2]=1,Y.size=Math.abs(Me),Y.start=0,Y.end=Y.size}function ds(_e,Y,W,ae){for(let se=0;se<_e.length;se++){const Ee=[];We(_e[se],Ee,W,ae),Y.push(Ee)}}function To(_e){return _e/360+.5}function ot(_e){const Y=Math.sin(_e*Math.PI/180),W=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return W<0?0:W>1?1:W}function ai(_e,Y,W,ae,se,Ee,Me,Oe){if(ae/=Y,Ee>=(W/=Y)&&Me<ae)return _e;if(Me<W||Ee>=ae)return null;const ke=[];for(const Ye of _e){const lt=Ye.geometry;let Ze=Ye.type;const vt=se===0?Ye.minX:Ye.minY,jt=se===0?Ye.maxX:Ye.maxY;if(vt>=W&&jt<ae){ke.push(Ye);continue}if(jt<W||vt>=ae)continue;let Jt=[];if(Ze==="Point"||Ze==="MultiPoint")ps(lt,Jt,W,ae,se);else if(Ze==="LineString")pr(lt,Jt,W,ae,se,!1,Oe.lineMetrics);else if(Ze==="MultiLineString")vn(lt,Jt,W,ae,se,!1);else if(Ze==="Polygon")vn(lt,Jt,W,ae,se,!0);else if(Ze==="MultiPolygon")for(const Fn of lt){const bn=[];vn(Fn,bn,W,ae,se,!0),bn.length&&Jt.push(bn)}if(Jt.length){if(Oe.lineMetrics&&Ze==="LineString"){for(const Fn of Jt)ke.push(we(Ye.id,Ze,Fn,Ye.tags));continue}Ze!=="LineString"&&Ze!=="MultiLineString"||(Jt.length===1?(Ze="LineString",Jt=Jt[0]):Ze="MultiLineString"),Ze!=="Point"&&Ze!=="MultiPoint"||(Ze=Jt.length===3?"Point":"MultiPoint"),ke.push(we(Ye.id,Ze,Jt,Ye.tags))}}return ke.length?ke:null}function ps(_e,Y,W,ae,se){for(let Ee=0;Ee<_e.length;Ee+=3){const Me=_e[Ee+se];Me>=W&&Me<=ae&&ir(Y,_e[Ee],_e[Ee+1],_e[Ee+2])}}function pr(_e,Y,W,ae,se,Ee,Me){let Oe=As(_e);const ke=se===0?sa:aa;let Ye,lt,Ze=_e.start;for(let bn=0;bn<_e.length-3;bn+=3){const kn=_e[bn],Sn=_e[bn+1],pi=_e[bn+2],ti=_e[bn+3],xn=_e[bn+4],Zn=se===0?kn:Sn,ri=se===0?ti:xn;let Si=!1;Me&&(Ye=Math.sqrt(Math.pow(kn-ti,2)+Math.pow(Sn-xn,2))),Zn<W?ri>W&&(lt=ke(Oe,kn,Sn,ti,xn,W),Me&&(Oe.start=Ze+Ye*lt)):Zn>ae?ri<ae&&(lt=ke(Oe,kn,Sn,ti,xn,ae),Me&&(Oe.start=Ze+Ye*lt)):ir(Oe,kn,Sn,pi),ri<W&&Zn>=W&&(lt=ke(Oe,kn,Sn,ti,xn,W),Si=!0),ri>ae&&Zn<=ae&&(lt=ke(Oe,kn,Sn,ti,xn,ae),Si=!0),!Ee&&Si&&(Me&&(Oe.end=Ze+Ye*lt),Y.push(Oe),Oe=As(_e)),Me&&(Ze+=Ye)}let vt=_e.length-3;const jt=_e[vt],Jt=_e[vt+1],Fn=se===0?jt:Jt;Fn>=W&&Fn<=ae&&ir(Oe,jt,Jt,_e[vt+2]),vt=Oe.length-3,Ee&&vt>=3&&(Oe[vt]!==Oe[0]||Oe[vt+1]!==Oe[1])&&ir(Oe,Oe[0],Oe[1],Oe[2]),Oe.length&&Y.push(Oe)}function As(_e){const Y=[];return Y.size=_e.size,Y.start=_e.start,Y.end=_e.end,Y}function vn(_e,Y,W,ae,se,Ee){for(const Me of _e)pr(Me,Y,W,ae,se,Ee,!1)}function ir(_e,Y,W,ae){_e.push(Y,W,ae)}function sa(_e,Y,W,ae,se,Ee){const Me=(Ee-Y)/(ae-Y);return ir(_e,Ee,W+(se-W)*Me,1),Me}function aa(_e,Y,W,ae,se,Ee){const Me=(Ee-W)/(se-W);return ir(_e,Y+(ae-Y)*Me,Ee,1),Me}function Je(_e,Y){const W=[];for(let ae=0;ae<_e.length;ae++){const se=_e[ae],Ee=se.type;let Me;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")Me=Vr(se.geometry,Y);else if(Ee==="MultiLineString"||Ee==="Polygon"){Me=[];for(const Oe of se.geometry)Me.push(Vr(Oe,Y))}else if(Ee==="MultiPolygon"){Me=[];for(const Oe of se.geometry){const ke=[];for(const Ye of Oe)ke.push(Vr(Ye,Y));Me.push(ke)}}W.push(we(se.id,Ee,Me,se.tags))}return W}function Vr(_e,Y){const W=[];W.size=_e.size,_e.start!==void 0&&(W.start=_e.start,W.end=_e.end);for(let ae=0;ae<_e.length;ae+=3)W.push(_e[ae]+Y,_e[ae+1],_e[ae+2]);return W}function dn(_e,Y){if(_e.transformed)return _e;const W=1<<_e.z,ae=_e.x,se=_e.y;for(const Ee of _e.features){const Me=Ee.geometry,Oe=Ee.type;if(Ee.geometry=[],Oe===1)for(let ke=0;ke<Me.length;ke+=2)Ee.geometry.push(tn(Me[ke],Me[ke+1],Y,W,ae,se));else for(let ke=0;ke<Me.length;ke++){const Ye=[];for(let lt=0;lt<Me[ke].length;lt+=2)Ye.push(tn(Me[ke][lt],Me[ke][lt+1],Y,W,ae,se));Ee.geometry.push(Ye)}}return _e.transformed=!0,_e}function tn(_e,Y,W,ae,se,Ee){return[Math.round(W*(_e*ae-se)),Math.round(W*(Y*ae-Ee))]}function Pa(_e,Y,W,ae,se){const Ee=Y===se.maxZoom?0:se.tolerance/((1<<Y)*se.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:_e.length,source:null,x:W,y:ae,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Oe of _e)_t(Me,Oe,Ee,se);return Me}function _t(_e,Y,W,ae){const se=Y.geometry,Ee=Y.type,Me=[];if(_e.minX=Math.min(_e.minX,Y.minX),_e.minY=Math.min(_e.minY,Y.minY),_e.maxX=Math.max(_e.maxX,Y.maxX),_e.maxY=Math.max(_e.maxY,Y.maxY),Ee==="Point"||Ee==="MultiPoint")for(let Oe=0;Oe<se.length;Oe+=3)Me.push(se[Oe],se[Oe+1]),_e.numPoints++,_e.numSimplified++;else if(Ee==="LineString")In(Me,se,_e,W,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(let Oe=0;Oe<se.length;Oe++)In(Me,se[Oe],_e,W,Ee==="Polygon",Oe===0);else if(Ee==="MultiPolygon")for(let Oe=0;Oe<se.length;Oe++){const ke=se[Oe];for(let Ye=0;Ye<ke.length;Ye++)In(Me,ke[Ye],_e,W,!0,Ye===0)}if(Me.length){let Oe=Y.tags||null;if(Ee==="LineString"&&ae.lineMetrics){Oe={};for(const Ye in Y.tags)Oe[Ye]=Y.tags[Ye];Oe.mapbox_clip_start=se.start/se.size,Oe.mapbox_clip_end=se.end/se.size}const ke={geometry:Me,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:Oe};Y.id!==null&&(ke.id=Y.id),_e.features.push(ke)}}function In(_e,Y,W,ae,se,Ee){const Me=ae*ae;if(ae>0&&Y.size<(se?Me:ae))return void(W.numPoints+=Y.length/3);const Oe=[];for(let ke=0;ke<Y.length;ke+=3)(ae===0||Y[ke+2]>Me)&&(W.numSimplified++,Oe.push(Y[ke],Y[ke+1])),W.numPoints++;se&&(function(ke,Ye){let lt=0;for(let Ze=0,vt=ke.length,jt=vt-2;Ze<vt;jt=Ze,Ze+=2)lt+=(ke[Ze]-ke[jt])*(ke[Ze+1]+ke[jt+1]);if(lt>0===Ye)for(let Ze=0,vt=ke.length;Ze<vt/2;Ze+=2){const jt=ke[Ze],Jt=ke[Ze+1];ke[Ze]=ke[vt-2-Ze],ke[Ze+1]=ke[vt-1-Ze],ke[vt-2-Ze]=jt,ke[vt-1-Ze]=Jt}})(Oe,Ee),_e.push(Oe)}const dt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class mr{constructor(Y,W){const ae=(W=this.options=(function(Ee,Me){for(const Oe in Me)Ee[Oe]=Me[Oe];return Ee})(Object.create(dt),W)).debug;if(ae&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");let se=(function(Ee,Me){const Oe=[];if(Ee.type==="FeatureCollection")for(let ke=0;ke<Ee.features.length;ke++)Ur(Oe,Ee.features[ke],Me,ke);else Ur(Oe,Ee.type==="Feature"?Ee:{geometry:Ee},Me);return Oe})(Y,W);this.tiles={},this.tileCoords=[],ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),se=(function(Ee,Me){const Oe=Me.buffer/Me.extent;let ke=Ee;const Ye=ai(Ee,1,-1-Oe,Oe,0,-1,2,Me),lt=ai(Ee,1,1-Oe,2+Oe,0,-1,2,Me);return(Ye||lt)&&(ke=ai(Ee,1,-Oe,1+Oe,0,-1,2,Me)||[],Ye&&(ke=Je(Ye,1).concat(ke)),lt&&(ke=ke.concat(Je(lt,-1)))),ke})(se,W),se.length&&this.splitTile(se,0,0,0),ae&&(se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,W,ae,se,Ee,Me,Oe){const ke=[Y,W,ae,se],Ye=this.options,lt=Ye.debug;for(;ke.length;){se=ke.pop(),ae=ke.pop(),W=ke.pop(),Y=ke.pop();const Ze=1<<W,vt=qr(W,ae,se);let jt=this.tiles[vt];if(!jt&&(lt>1&&console.time("creation"),jt=this.tiles[vt]=Pa(Y,W,ae,se,Ye),this.tileCoords.push({z:W,x:ae,y:se}),lt)){lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,ae,se,jt.numFeatures,jt.numPoints,jt.numSimplified),console.timeEnd("creation"));const Si=`z${W}`;this.stats[Si]=(this.stats[Si]||0)+1,this.total++}if(jt.source=Y,Ee==null){if(W===Ye.indexMaxZoom||jt.numPoints<=Ye.indexMaxPoints)continue}else{if(W===Ye.maxZoom||W===Ee)continue;if(Ee!=null){const Si=Ee-W;if(ae!==Me>>Si||se!==Oe>>Si)continue}}if(jt.source=null,Y.length===0)continue;lt>1&&console.time("clipping");const Jt=.5*Ye.buffer/Ye.extent,Fn=.5-Jt,bn=.5+Jt,kn=1+Jt;let Sn=null,pi=null,ti=null,xn=null,Zn=ai(Y,Ze,ae-Jt,ae+bn,0,jt.minX,jt.maxX,Ye),ri=ai(Y,Ze,ae+Fn,ae+kn,0,jt.minX,jt.maxX,Ye);Y=null,Zn&&(Sn=ai(Zn,Ze,se-Jt,se+bn,1,jt.minY,jt.maxY,Ye),pi=ai(Zn,Ze,se+Fn,se+kn,1,jt.minY,jt.maxY,Ye),Zn=null),ri&&(ti=ai(ri,Ze,se-Jt,se+bn,1,jt.minY,jt.maxY,Ye),xn=ai(ri,Ze,se+Fn,se+kn,1,jt.minY,jt.maxY,Ye),ri=null),lt>1&&console.timeEnd("clipping"),ke.push(Sn||[],W+1,2*ae,2*se),ke.push(pi||[],W+1,2*ae,2*se+1),ke.push(ti||[],W+1,2*ae+1,2*se),ke.push(xn||[],W+1,2*ae+1,2*se+1)}}getTile(Y,W,ae){Y=+Y,W=+W,ae=+ae;const se=this.options,{extent:Ee,debug:Me}=se;if(Y<0||Y>24)return null;const Oe=1<<Y,ke=qr(Y,W=W+Oe&Oe-1,ae);if(this.tiles[ke])return dn(this.tiles[ke],Ee);Me>1&&console.log("drilling down to z%d-%d-%d",Y,W,ae);let Ye,lt=Y,Ze=W,vt=ae;for(;!Ye&&lt>0;)lt--,Ze>>=1,vt>>=1,Ye=this.tiles[qr(lt,Ze,vt)];return Ye&&Ye.source?(Me>1&&(console.log("found parent tile z%d-%d-%d",lt,Ze,vt),console.time("drilling down")),this.splitTile(Ye.source,lt,Ze,vt,Y,W,ae),Me>1&&console.timeEnd("drilling down"),this.tiles[ke]?dn(this.tiles[ke],Ee):null):null}}function qr(_e,Y,W){return 32*((1<<_e)*W+Y)+_e}function pn(_e,Y){return Y?_e.properties[Y]:_e.id}function ki(_e,Y){if(_e==null)return!0;if(_e.type==="Feature")return pn(_e,Y)!=null;if(_e.type==="FeatureCollection"){const W=new Set;for(const ae of _e.features){const se=pn(ae,Y);if(se==null||W.has(se))return!1;W.add(se)}return!0}return!1}function Sr(_e,Y){const W=new Map;if(_e!=null)if(_e.type==="Feature")W.set(pn(_e,Y),_e);else for(const ae of _e.features)W.set(pn(ae,Y),ae);return W}class Mi extends B{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Y,W){return R._(this,void 0,void 0,(function*(){const ae=Y.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const se=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!se)return null;const Ee=new class{constructor(Oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=R.X,this.length=Oe.length,this._features=Oe}feature(Oe){return new class{constructor(ke){this._feature=ke,this.extent=R.X,this.type=ke.type,this.properties=ke.tags,"id"in ke&&!isNaN(ke.id)&&(this.id=parseInt(ke.id,10))}loadGeometry(){if(this._feature.type===1){const ke=[];for(const Ye of this._feature.geometry)ke.push([new R.P(Ye[0],Ye[1])]);return ke}{const ke=[];for(const Ye of this._feature.geometry){const lt=[];for(const Ze of Ye)lt.push(new R.P(Ze[0],Ze[1]));ke.push(lt)}return ke}}toGeoJSON(ke,Ye,lt){return Pe.call(this,ke,Ye,lt)}}(this._features[Oe])}}(se.features);let Me=rn(Ee);return Me.byteOffset===0&&Me.byteLength===Me.buffer.byteLength||(Me=new Uint8Array(Me)),{vectorTile:Ee,rawData:Me.buffer}}))}loadData(Y){return R._(this,void 0,void 0,(function*(){var W;(W=this._pendingRequest)===null||W===void 0||W.abort();const ae=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new R.bv(Y.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Y,this._pendingRequest),this._geoJSONIndex=Y.cluster?new Pt((function({superclusterOptions:Me,clusterProperties:Oe}){if(!Oe||!Me)return Me;const ke={},Ye={},lt={accumulated:null,zoom:0},Ze={properties:null},vt=Object.keys(Oe);for(const jt of vt){const[Jt,Fn]=Oe[jt],bn=R.bC(Fn),kn=R.bC(typeof Jt=="string"?[Jt,["accumulated"],["get",jt]]:Jt);ke[jt]=bn.value,Ye[jt]=kn.value}return Me.map=jt=>{Ze.properties=jt;const Jt={};for(const Fn of vt)Jt[Fn]=ke[Fn].evaluate(lt,Ze);return Jt},Me.reduce=(jt,Jt)=>{Ze.properties=Jt;for(const Fn of vt)lt.accumulated=jt[Fn],jt[Fn]=Ye[Fn].evaluate(lt,Ze)},Me})(Y)).load((yield this._pendingData).features):(se=yield this._pendingData,new mr(se,Y.geojsonVtOptions)),this.loaded={};const Ee={};if(ae){const Me=ae.finish();Me&&(Ee.resourceTiming={},Ee.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Me)))}return Ee}catch(Ee){if(delete this._pendingRequest,R.bB(Ee))return{abandoned:!0};throw Ee}var se}))}getData(){return R._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(Y){const W=this.loaded;return W&&W[Y.uid]?super.reloadTile(Y):this.loadTile(Y)}loadAndProcessGeoJSON(Y,W){return R._(this,void 0,void 0,(function*(){let ae=yield this.loadGeoJSON(Y,W);if(delete this._pendingRequest,typeof ae!="object")throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`);if(de(ae,!0),Y.filter){const se=R.bC(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(se.result==="error")throw new Error(se.value.map((Me=>`${Me.key}: ${Me.message}`)).join(", "));ae={type:"FeatureCollection",features:ae.features.filter((Me=>se.value.evaluate({zoom:0},Me)))}}return ae}))}loadGeoJSON(Y,W){return R._(this,void 0,void 0,(function*(){const{promoteId:ae}=Y;if(Y.request){const se=yield R.h(Y.request,W);return this._dataUpdateable=ki(se.data,ae)?Sr(se.data,ae):void 0,se.data}if(typeof Y.data=="string")try{const se=JSON.parse(Y.data);return this._dataUpdateable=ki(se,ae)?Sr(se,ae):void 0,se}catch{throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`)}if(!Y.dataDiff)throw new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Y.source}`);return(function(se,Ee,Me){var Oe,ke,Ye,lt;if(Ee.removeAll&&se.clear(),Ee.remove)for(const Ze of Ee.remove)se.delete(Ze);if(Ee.add)for(const Ze of Ee.add){const vt=pn(Ze,Me);vt!=null&&se.set(vt,Ze)}if(Ee.update)for(const Ze of Ee.update){let vt=se.get(Ze.id);if(vt==null)continue;const jt=!Ze.removeAllProperties&&(((Oe=Ze.removeProperties)===null||Oe===void 0?void 0:Oe.length)>0||((ke=Ze.addOrUpdateProperties)===null||ke===void 0?void 0:ke.length)>0);if((Ze.newGeometry||Ze.removeAllProperties||jt)&&(vt=Object.assign({},vt),se.set(Ze.id,vt),jt&&(vt.properties=Object.assign({},vt.properties))),Ze.newGeometry&&(vt.geometry=Ze.newGeometry),Ze.removeAllProperties)vt.properties={};else if(((Ye=Ze.removeProperties)===null||Ye===void 0?void 0:Ye.length)>0)for(const Jt of Ze.removeProperties)Object.prototype.hasOwnProperty.call(vt.properties,Jt)&&delete vt.properties[Jt];if(((lt=Ze.addOrUpdateProperties)===null||lt===void 0?void 0:lt.length)>0)for(const{key:Jt,value:Fn}of Ze.addOrUpdateProperties)vt.properties[Jt]=Fn}})(this._dataUpdateable,Y.dataDiff,ae),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(Y){return R._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(Y){return this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId)}getClusterChildren(Y){return this._geoJSONIndex.getChildren(Y.clusterId)}getClusterLeaves(Y){return this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset)}}class gr{constructor(Y){this.self=Y,this.actor=new R.F(Y),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(W,ae)=>{if(this.externalWorkerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.externalWorkerSourceTypes[W]=ae},this.self.addProtocol=R.bi,this.self.removeProtocol=R.bj,this.self.registerRTLTextPlugin=W=>{if(R.bD.isParsed())throw new Error("RTL text plugin already registered.");R.bD.setMethods(W)},this.actor.registerMessageHandler("LDT",((W,ae)=>this._getDEMWorkerSource(W,ae.source).loadTile(ae))),this.actor.registerMessageHandler("RDT",((W,ae)=>R._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(W,ae.source).removeTile(ae)})))),this.actor.registerMessageHandler("GCEZ",((W,ae)=>R._(this,void 0,void 0,(function*(){return this._getWorkerSource(W,ae.type,ae.source).getClusterExpansionZoom(ae)})))),this.actor.registerMessageHandler("GCC",((W,ae)=>R._(this,void 0,void 0,(function*(){return this._getWorkerSource(W,ae.type,ae.source).getClusterChildren(ae)})))),this.actor.registerMessageHandler("GCL",((W,ae)=>R._(this,void 0,void 0,(function*(){return this._getWorkerSource(W,ae.type,ae.source).getClusterLeaves(ae)})))),this.actor.registerMessageHandler("LD",((W,ae)=>this._getWorkerSource(W,ae.type,ae.source).loadData(ae))),this.actor.registerMessageHandler("GD",((W,ae)=>this._getWorkerSource(W,ae.type,ae.source).getData())),this.actor.registerMessageHandler("LT",((W,ae)=>this._getWorkerSource(W,ae.type,ae.source).loadTile(ae))),this.actor.registerMessageHandler("RT",((W,ae)=>this._getWorkerSource(W,ae.type,ae.source).reloadTile(ae))),this.actor.registerMessageHandler("AT",((W,ae)=>this._getWorkerSource(W,ae.type,ae.source).abortTile(ae))),this.actor.registerMessageHandler("RMT",((W,ae)=>this._getWorkerSource(W,ae.type,ae.source).removeTile(ae))),this.actor.registerMessageHandler("RS",((W,ae)=>R._(this,void 0,void 0,(function*(){if(!this.workerSources[W]||!this.workerSources[W][ae.type]||!this.workerSources[W][ae.type][ae.source])return;const se=this.workerSources[W][ae.type][ae.source];delete this.workerSources[W][ae.type][ae.source],se.removeSource!==void 0&&se.removeSource(ae)})))),this.actor.registerMessageHandler("RM",(W=>R._(this,void 0,void 0,(function*(){delete this.layerIndexes[W],delete this.availableImages[W],delete this.workerSources[W],delete this.demWorkerSources[W]})))),this.actor.registerMessageHandler("SR",((W,ae)=>R._(this,void 0,void 0,(function*(){this.referrer=ae})))),this.actor.registerMessageHandler("SRPS",((W,ae)=>this._syncRTLPluginState(W,ae))),this.actor.registerMessageHandler("IS",((W,ae)=>R._(this,void 0,void 0,(function*(){this.self.importScripts(ae)})))),this.actor.registerMessageHandler("SI",((W,ae)=>this._setImages(W,ae))),this.actor.registerMessageHandler("UL",((W,ae)=>R._(this,void 0,void 0,(function*(){this._getLayerIndex(W).update(ae.layers,ae.removedIds)})))),this.actor.registerMessageHandler("SL",((W,ae)=>R._(this,void 0,void 0,(function*(){this._getLayerIndex(W).replace(ae)}))))}_setImages(Y,W){return R._(this,void 0,void 0,(function*(){this.availableImages[Y]=W;for(const ae in this.workerSources[Y]){const se=this.workerSources[Y][ae];for(const Ee in se)se[Ee].availableImages=W}}))}_syncRTLPluginState(Y,W){return R._(this,void 0,void 0,(function*(){if(R.bD.isParsed())return R.bD.getState();if(W.pluginStatus!=="loading")return R.bD.setState(W),W;const ae=W.pluginURL;if(this.self.importScripts(ae),R.bD.isParsed()){const se={pluginStatus:"loaded",pluginURL:ae};return R.bD.setState(se),se}throw R.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ae}`)}))}_getAvailableImages(Y){let W=this.availableImages[Y];return W||(W=[]),W}_getLayerIndex(Y){let W=this.layerIndexes[Y];return W||(W=this.layerIndexes[Y]=new h),W}_getWorkerSource(Y,W,ae){if(this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][W]||(this.workerSources[Y][W]={}),!this.workerSources[Y][W][ae]){const se={sendAsync:(Ee,Me)=>(Ee.targetMapId=Y,this.actor.sendAsync(Ee,Me))};switch(W){case"vector":this.workerSources[Y][W][ae]=new B(se,this._getLayerIndex(Y),this._getAvailableImages(Y));break;case"geojson":this.workerSources[Y][W][ae]=new Mi(se,this._getLayerIndex(Y),this._getAvailableImages(Y));break;default:this.workerSources[Y][W][ae]=new this.externalWorkerSourceTypes[W](se,this._getLayerIndex(Y),this._getAvailableImages(Y))}}return this.workerSources[Y][W][ae]}_getDEMWorkerSource(Y,W){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][W]||(this.demWorkerSources[Y][W]=new q),this.demWorkerSources[Y][W]}}return R.i(self)&&(self.worker=new gr(self)),gr})),C("index",["exports","./shared"],(function(R,h){var K="4.7.1";let ne,ee;const B={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:_=>new Promise(((e,o)=>{const d=requestAnimationFrame(e);_.signal.addEventListener("abort",(()=>{cancelAnimationFrame(d),o(h.c())}))})),getImageData(_,e=0){return this.getImageCanvasContext(_).getImageData(-e,-e,_.width+2*e,_.height+2*e)},getImageCanvasContext(_){const e=window.document.createElement("canvas"),o=e.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return e.width=_.width,e.height=_.height,o.drawImage(_,0,0,_.width,_.height),o},resolveURL:_=>(ne||(ne=document.createElement("a")),ne.href=_,ne.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ee==null&&(ee=matchMedia("(prefers-reduced-motion: reduce)")),ee.matches)}};class q{static testProp(e){if(!q.docStyle)return e[0];for(let o=0;o<e.length;o++)if(e[o]in q.docStyle)return e[o];return e[0]}static create(e,o,d){const p=window.document.createElement(e);return o!==void 0&&(p.className=o),d&&d.appendChild(p),p}static createNS(e,o){return window.document.createElementNS(e,o)}static disableDrag(){q.docStyle&&q.selectProp&&(q.userSelect=q.docStyle[q.selectProp],q.docStyle[q.selectProp]="none")}static enableDrag(){q.docStyle&&q.selectProp&&(q.docStyle[q.selectProp]=q.userSelect)}static setTransform(e,o){e.style[q.transformProp]=o}static addEventListener(e,o,d,p={}){e.addEventListener(o,d,"passive"in p?p:p.capture)}static removeEventListener(e,o,d,p={}){e.removeEventListener(o,d,"passive"in p?p:p.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",q.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",q.suppressClickInternal,!0)}),0)}static getScale(e){const o=e.getBoundingClientRect();return{x:o.width/e.offsetWidth||1,y:o.height/e.offsetHeight||1,boundingClientRect:o}}static getPoint(e,o,d){const p=o.boundingClientRect;return new h.P((d.clientX-p.left)/o.x-e.clientLeft,(d.clientY-p.top)/o.y-e.clientTop)}static mousePos(e,o){const d=q.getScale(e);return q.getPoint(e,d,o)}static touchPos(e,o){const d=[],p=q.getScale(e);for(let y=0;y<o.length;y++)d.push(q.getPoint(e,p,o[y]));return d}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,q.selectProp=q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),q.transformProp=q.testProp(["transform","WebkitTransform"]);const ue={supported:!1,testSupport:function(_){!Pe&&de&&(je?Te(_):ce=_)}};let ce,de,Pe=!1,je=!1;function Te(_){const e=_.createTexture();_.bindTexture(_.TEXTURE_2D,e);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,de),_.isContextLost())return;ue.supported=!0}catch{}_.deleteTexture(e),Pe=!0}var qe;typeof document<"u"&&(de=document.createElement("img"),de.onload=()=>{ce&&Te(ce),ce=null,je=!0},de.onerror=()=>{Pe=!0,ce=null},de.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(_){let e,o,d,p;_.resetRequestQueue=()=>{e=[],o=0,d=0,p={}},_.addThrottleControl=D=>{const U=d++;return p[U]=D,U},_.removeThrottleControl=D=>{delete p[D],T()},_.getImage=(D,U,$=!0)=>new Promise(((Z,Q)=>{ue.supported&&(D.headers||(D.headers={}),D.headers.accept="image/webp,*/*"),h.e(D,{type:"image"}),e.push({abortController:U,requestParameters:D,supportImageRefresh:$,state:"queued",onError:oe=>{Q(oe)},onSuccess:oe=>{Z(oe)}}),T()}));const y=D=>h._(this,void 0,void 0,(function*(){D.state="running";const{requestParameters:U,supportImageRefresh:$,onError:Z,onSuccess:Q,abortController:oe}=D,he=$===!1&&!h.i(self)&&!h.g(U.url)&&(!U.headers||Object.keys(U.headers).reduce(((ve,Se)=>ve&&Se==="accept"),!0));o++;const pe=he?A(U,oe):h.m(U,oe);try{const ve=yield pe;delete D.abortController,D.state="completed",ve.data instanceof HTMLImageElement||h.b(ve.data)?Q(ve):ve.data&&Q({data:yield(ge=ve.data,typeof createImageBitmap=="function"?h.d(ge):h.f(ge)),cacheControl:ve.cacheControl,expires:ve.expires})}catch(ve){delete D.abortController,Z(ve)}finally{o--,T()}var ge})),T=()=>{const D=(()=>{for(const U of Object.keys(p))if(p[U]())return!0;return!1})()?h.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let U=o;U<D&&e.length>0;U++){const $=e.shift();$.abortController.signal.aborted?U--:y($)}},A=(D,U)=>new Promise((($,Z)=>{const Q=new Image,oe=D.url,he=D.credentials;he&&he==="include"?Q.crossOrigin="use-credentials":(he&&he==="same-origin"||!h.s(oe))&&(Q.crossOrigin="anonymous"),U.signal.addEventListener("abort",(()=>{Q.src="",Z(h.c())})),Q.fetchPriority="high",Q.onload=()=>{Q.onerror=Q.onload=null,$({data:Q})},Q.onerror=()=>{Q.onerror=Q.onload=null,U.signal.aborted||Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Q.src=oe}))})(qe||(qe={})),qe.resetRequestQueue();class tt{constructor(e){this._transformRequestFn=e}transformRequest(e,o){return this._transformRequestFn&&this._transformRequestFn(e,o)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function nt(_){var e=new h.A(3);return e[0]=_[0],e[1]=_[1],e[2]=_[2],e}var it,Ge=function(_,e,o){return _[0]=e[0]-o[0],_[1]=e[1]-o[1],_[2]=e[2]-o[2],_};it=new h.A(3),h.A!=Float32Array&&(it[0]=0,it[1]=0,it[2]=0);var ht=function(_){var e=_[0],o=_[1];return e*e+o*o};function mt(_){const e=[];if(typeof _=="string")e.push({id:"default",url:_});else if(_&&_.length>0){const o=[];for(const{id:d,url:p}of _){const y=`${d}${p}`;o.indexOf(y)===-1&&(o.push(y),e.push({id:d,url:p}))}}return e}function Kt(_,e,o){const d=_.split("?");return d[0]+=`${e}${o}`,d.join("?")}(function(){var _=new h.A(2);h.A!=Float32Array&&(_[0]=0,_[1]=0)})();class St{constructor(e,o,d,p){this.context=e,this.format=d,this.texture=e.gl.createTexture(),this.update(o,p)}update(e,o,d){const{width:p,height:y}=e,T=!(this.size&&this.size[0]===p&&this.size[1]===y||d),{context:A}=this,{gl:D}=A;if(this.useMipmap=!!(o&&o.useMipmap),D.bindTexture(D.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!o||o.premultiply!==!1)),T)this.size=[p,y],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||h.b(e)?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,e):D.texImage2D(D.TEXTURE_2D,0,this.format,p,y,0,this.format,D.UNSIGNED_BYTE,e.data);else{const{x:U,y:$}=d||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||h.b(e)?D.texSubImage2D(D.TEXTURE_2D,0,U,$,D.RGBA,D.UNSIGNED_BYTE,e):D.texSubImage2D(D.TEXTURE_2D,0,U,$,p,y,D.RGBA,D.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&D.generateMipmap(D.TEXTURE_2D)}bind(e,o,d){const{context:p}=this,{gl:y}=p;y.bindTexture(y.TEXTURE_2D,this.texture),d!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=y.LINEAR),e!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,e),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,d||e),this.filter=e),o!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,o),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Ht(_){const{userImage:e}=_;return!!(e&&e.render&&e.render())&&(_.data.replace(new Uint8Array(e.data.buffer)),!0)}class Vt extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:o,promiseResolve:d}of this.requestors)d(this._getImagesForIds(o));this.requestors=[]}}getImage(e){const o=this.images[e];if(o&&!o.data&&o.spriteData){const d=o.spriteData;o.data=new h.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),o.spriteData=null}return o}addImage(e,o){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,o)&&(this.images[e]=o)}_validate(e,o){let d=!0;const p=o.data||o.spriteData;return this._validateStretch(o.stretchX,p&&p.width)||(this.fire(new h.j(new Error(`Image "${e}" has invalid "stretchX" value`))),d=!1),this._validateStretch(o.stretchY,p&&p.height)||(this.fire(new h.j(new Error(`Image "${e}" has invalid "stretchY" value`))),d=!1),this._validateContent(o.content,o)||(this.fire(new h.j(new Error(`Image "${e}" has invalid "content" value`))),d=!1),d}_validateStretch(e,o){if(!e)return!0;let d=0;for(const p of e){if(p[0]<d||p[1]<p[0]||o<p[1])return!1;d=p[1]}return!0}_validateContent(e,o){if(!e)return!0;if(e.length!==4)return!1;const d=o.spriteData,p=d&&d.width||o.data.width,y=d&&d.height||o.data.height;return!(e[0]<0||p<e[0]||e[1]<0||y<e[1]||e[2]<0||p<e[2]||e[3]<0||y<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,o,d=!0){const p=this.getImage(e);if(d&&(p.data.width!==o.data.width||p.data.height!==o.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=p.version+1,this.images[e]=o,this.updatedImages[e]=!0}removeImage(e){const o=this.images[e];delete this.images[e],delete this.patterns[e],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((o,d)=>{let p=!0;if(!this.isLoaded())for(const y of e)this.images[y]||(p=!1);this.isLoaded()||p?o(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:o})}))}_getImagesForIds(e){const o={};for(const d of e){let p=this.getImage(d);p||(this.fire(new h.k("styleimagemissing",{id:d})),p=this.getImage(d)),p?o[d]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,textFitWidth:p.textFitWidth,textFitHeight:p.textFitHeight,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:h.w(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:e,height:o}=this.atlasImage;return{width:e,height:o}}getPattern(e){const o=this.patterns[e],d=this.getImage(e);if(!d)return null;if(o&&o.position.version===d.version)return o.position;if(o)o.position.version=d.version;else{const p={w:d.data.width+2,h:d.data.height+2,x:0,y:0},y=new h.I(p,d);this.patterns[e]={bin:p,position:y}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const o=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new St(e,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const y in this.patterns)e.push(this.patterns[y].bin);const{w:o,h:d}=h.p(e),p=this.atlasImage;p.resize({width:o||1,height:d||1});for(const y in this.patterns){const{bin:T}=this.patterns[y],A=T.x+1,D=T.y+1,U=this.getImage(y).data,$=U.width,Z=U.height;h.R.copy(U,p,{x:0,y:0},{x:A,y:D},{width:$,height:Z}),h.R.copy(U,p,{x:0,y:Z-1},{x:A,y:D-1},{width:$,height:1}),h.R.copy(U,p,{x:0,y:0},{x:A,y:D+Z},{width:$,height:1}),h.R.copy(U,p,{x:$-1,y:0},{x:A-1,y:D},{width:1,height:Z}),h.R.copy(U,p,{x:0,y:0},{x:A+$,y:D},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const o of e){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const d=this.getImage(o);d||h.w(`Image with ID: "${o}" was not found`),Ht(d)&&this.updateImage(o,d)}}}const ct=1e20;function en(_,e,o,d,p,y,T,A,D){for(let U=e;U<e+d;U++)fn(_,o*y+U,y,p,T,A,D);for(let U=o;U<o+p;U++)fn(_,U*y+e,1,d,T,A,D)}function fn(_,e,o,d,p,y,T){y[0]=0,T[0]=-ct,T[1]=ct,p[0]=_[e];for(let A=1,D=0,U=0;A<d;A++){p[A]=_[e+A*o];const $=A*A;do{const Z=y[D];U=(p[A]-p[Z]+$-Z*Z)/(A-Z)/2}while(U<=T[D]&&--D>-1);D++,y[D]=A,T[D]=U,T[D+1]=ct}for(let A=0,D=0;A<d;A++){for(;T[D+1]<A;)D++;const U=y[D],$=A-U;_[e+A*o]=p[U]+$*$}}class rn{constructor(e,o){this.requestManager=e,this.localIdeographFontFamily=o,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return h._(this,void 0,void 0,(function*(){const o=[];for(const y in e)for(const T of e[y])o.push(this._getAndCacheGlyphsPromise(y,T));const d=yield Promise.all(o),p={};for(const{stack:y,id:T,glyph:A}of d)p[y]||(p[y]={}),p[y][T]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};return p}))}_getAndCacheGlyphsPromise(e,o){return h._(this,void 0,void 0,(function*(){let d=this.entries[e];d||(d=this.entries[e]={glyphs:{},requests:{},ranges:{}});let p=d.glyphs[o];if(p!==void 0)return{stack:e,id:o,glyph:p};if(p=this._tinySDF(d,e,o),p)return d.glyphs[o]=p,{stack:e,id:o,glyph:p};const y=Math.floor(o/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(d.ranges[y])return{stack:e,id:o,glyph:p};if(!this.url)throw new Error("glyphsUrl is not set");if(!d.requests[y]){const A=rn.loadGlyphRange(e,y,this.url,this.requestManager);d.requests[y]=A}const T=yield d.requests[y];for(const A in T)this._doesCharSupportLocalGlyph(+A)||(d.glyphs[+A]=T[+A]);return d.ranges[y]=!0,{stack:e,id:o,glyph:T[o]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,o,d){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(d))return;let y=e.tinySDF;if(!y){let A="400";/bold/i.test(o)?A="900":/medium/i.test(o)?A="500":/light/i.test(o)&&(A="200"),y=e.tinySDF=new rn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:A})}const T=y.draw(String.fromCharCode(d));return{id:d,bitmap:new h.o({width:T.width||60,height:T.height||60},T.data),metrics:{width:T.glyphWidth/2||24,height:T.glyphHeight/2||24,left:T.glyphLeft/2+.5||0,top:T.glyphTop/2-27.5||-8,advance:T.glyphAdvance/2||24,isDoubleResolution:!0}}}}rn.loadGlyphRange=function(_,e,o,d){return h._(this,void 0,void 0,(function*(){const p=256*e,y=p+255,T=d.transformRequest(o.replace("{fontstack}",_).replace("{range}",`${p}-${y}`),"Glyphs"),A=yield h.l(T,new AbortController);if(!A||!A.data)throw new Error(`Could not load glyph range. range: ${e}, ${p}-${y}`);const D={};for(const U of h.n(A.data))D[U.id]=U;return D}))},rn.TinySDF=class{constructor({fontSize:_=24,buffer:e=3,radius:o=8,cutoff:d=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:T="normal"}={}){this.buffer=e,this.cutoff=d,this.radius=o;const A=this.size=_+4*e,D=this._createCanvas(A),U=this.ctx=D.getContext("2d",{willReadFrequently:!0});U.font=`${T} ${y} ${_}px ${p}`,U.textBaseline="alphabetic",U.textAlign="left",U.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(_){const e=document.createElement("canvas");return e.width=e.height=_,e}draw(_){const{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:d,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(_),T=Math.ceil(o),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),D=Math.min(this.size-this.buffer,T+Math.ceil(d)),U=A+2*this.buffer,$=D+2*this.buffer,Z=Math.max(U*$,0),Q=new Uint8ClampedArray(Z),oe={data:Q,width:U,height:$,glyphWidth:A,glyphHeight:D,glyphTop:T,glyphLeft:0,glyphAdvance:e};if(A===0||D===0)return oe;const{ctx:he,buffer:pe,gridInner:ge,gridOuter:ve}=this;he.clearRect(pe,pe,A,D),he.fillText(_,pe,pe+T);const Se=he.getImageData(pe,pe,A,D);ve.fill(ct,0,Z),ge.fill(0,0,Z);for(let me=0;me<D;me++)for(let Ae=0;Ae<A;Ae++){const ze=Se.data[4*(me*A+Ae)+3]/255;if(ze===0)continue;const Ve=(me+pe)*U+Ae+pe;if(ze===1)ve[Ve]=0,ge[Ve]=ct;else{const at=.5-ze;ve[Ve]=at>0?at*at:0,ge[Ve]=at<0?at*at:0}}en(ve,0,0,U,$,U,this.f,this.v,this.z),en(ge,pe,pe,A,D,U,this.f,this.v,this.z);for(let me=0;me<Z;me++){const Ae=Math.sqrt(ve[me])-Math.sqrt(ge[me]);Q[me]=Math.round(255-255*(Ae/this.radius+this.cutoff))}return oe}};class wt{constructor(){this.specification=h.v.light.position}possiblyEvaluate(e,o){return h.x(e.expression.evaluate(o))}interpolate(e,o,d){return{x:h.y.number(e.x,o.x,d),y:h.y.number(e.y,o.y,d),z:h.y.number(e.z,o.z,d)}}}let Ft;class et extends h.E{constructor(e){super(),Ft=Ft||new h.q({anchor:new h.D(h.v.light.anchor),position:new wt,color:new h.D(h.v.light.color),intensity:new h.D(h.v.light.intensity)}),this._transitionable=new h.T(Ft),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,o={}){if(!this._validate(h.r,e,o))for(const d in e){const p=e[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),p):this._transitionable.setValue(d,p)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,d){return(!d||d.validate!==!1)&&h.t(this,e.call(h.u,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:h.v}))}}const Le=new h.q({"sky-color":new h.D(h.v.sky["sky-color"]),"horizon-color":new h.D(h.v.sky["horizon-color"]),"fog-color":new h.D(h.v.sky["fog-color"]),"fog-ground-blend":new h.D(h.v.sky["fog-ground-blend"]),"horizon-fog-blend":new h.D(h.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new h.D(h.v.sky["sky-horizon-blend"]),"atmosphere-blend":new h.D(h.v.sky["atmosphere-blend"])});class rt extends h.E{constructor(e){super(),this._transitionable=new h.T(Le),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.z(0))}setSky(e,o={}){if(!this._validate(h.B,e,o)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const d in e){const p=e[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),p):this._transitionable.setValue(d,p)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,d={}){return d?.validate!==!1&&h.t(this,e.call(h.u,h.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:h.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class an{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,o){const d=e.join(",")+String(o);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(e,o)),this.dashEntry[d]}getDashRanges(e,o,d){const p=[];let y=e.length%2==1?-e[e.length-1]*d:0,T=e[0]*d,A=!0;p.push({left:y,right:T,isDash:A,zeroLength:e[0]===0});let D=e[0];for(let U=1;U<e.length;U++){A=!A;const $=e[U];y=D*d,D+=$,T=D*d,p.push({left:y,right:T,isDash:A,zeroLength:$===0})}return p}addRoundDash(e,o,d){const p=o/2;for(let y=-d;y<=d;y++){const T=this.width*(this.nextRow+d+y);let A=0,D=e[A];for(let U=0;U<this.width;U++){U/D.right>1&&(D=e[++A]);const $=Math.abs(U-D.left),Z=Math.abs(U-D.right),Q=Math.min($,Z);let oe;const he=y/d*(p+1);if(D.isDash){const pe=p-Math.abs(he);oe=Math.sqrt(Q*Q+pe*pe)}else oe=p-Math.sqrt(Q*Q+he*he);this.data[T+U]=Math.max(0,Math.min(255,oe+128))}}}addRegularDash(e){for(let A=e.length-1;A>=0;--A){const D=e[A],U=e[A+1];D.zeroLength?e.splice(A,1):U&&U.isDash===D.isDash&&(U.left=D.left,e.splice(A,1))}const o=e[0],d=e[e.length-1];o.isDash===d.isDash&&(o.left=d.left-this.width,d.right=o.right+this.width);const p=this.width*this.nextRow;let y=0,T=e[y];for(let A=0;A<this.width;A++){A/T.right>1&&(T=e[++y]);const D=Math.abs(A-T.left),U=Math.abs(A-T.right),$=Math.min(D,U);this.data[p+A]=Math.max(0,Math.min(255,(T.isDash?$:-$)+128))}}addDash(e,o){const d=o?7:0,p=2*d+1;if(this.nextRow+p>this.height)return h.w("LineAtlas out of space"),null;let y=0;for(let A=0;A<e.length;A++)y+=e[A];if(y!==0){const A=this.width/y,D=this.getDashRanges(e,this.width,A);o?this.addRoundDash(D,A,d):this.addRegularDash(D)}const T={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:y};return this.nextRow+=p,this.dirty=!0,T}bind(e){const o=e.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const Pt="maplibre_preloaded_worker_pool";class yn{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<yn.workerCount;)this.workers.push(new Worker(h.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((o=>{o.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Pt]}numActive(){return Object.keys(this.active).length}}const zn=Math.floor(B.hardwareConcurrency/2);let Rn,Re;function ei(){return Rn||(Rn=new yn),Rn}yn.workerCount=h.C(globalThis)?Math.max(Math.min(zn,3),1):1;class Cn{constructor(e,o){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=o;const d=this.workerPool.acquire(o);for(let p=0;p<d.length;p++){const y=new h.F(d[p],o);y.name=`Worker ${p}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,o){const d=[];for(const p of this.actors)d.push(p.sendAsync({type:e,data:o}));return Promise.all(d)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((o=>{o.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,o){for(const d of this.actors)d.registerMessageHandler(e,o)}}function Wt(){return Re||(Re=new Cn(ei(),h.G),Re.registerMessageHandler("GR",((_,e,o)=>h.m(e,o)))),Re}function we(_,e){const o=h.H();return h.J(o,o,[1,1,0]),h.K(o,o,[.5*_.width,.5*_.height,1]),h.L(o,o,_.calculatePosMatrix(e.toUnwrapped()))}function Gi(_,e,o,d,p,y){const T=(function(Z,Q,oe){if(Z)for(const he of Z){const pe=Q[he];if(pe&&pe.source===oe&&pe.type==="fill-extrusion")return!0}else for(const he in Q){const pe=Q[he];if(pe.source===oe&&pe.type==="fill-extrusion")return!0}return!1})(p&&p.layers,e,_.id),A=y.maxPitchScaleFactor(),D=_.tilesIn(d,A,T);D.sort(Ur);const U=[];for(const Z of D)U.push({wrappedTileID:Z.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(e,o,_._state,Z.queryGeometry,Z.cameraQueryGeometry,Z.scale,p,y,A,we(_.transform,Z.tileID))});const $=(function(Z){const Q={},oe={};for(const he of Z){const pe=he.queryResults,ge=he.wrappedTileID,ve=oe[ge]=oe[ge]||{};for(const Se in pe){const me=pe[Se],Ae=ve[Se]=ve[Se]||{},ze=Q[Se]=Q[Se]||[];for(const Ve of me)Ae[Ve.featureIndex]||(Ae[Ve.featureIndex]=!0,ze.push(Ve))}}return Q})(U);for(const Z in $)$[Z].forEach((Q=>{const oe=Q.feature,he=_.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=he}));return $}function Ur(_,e){const o=_.tileID,d=e.tileID;return o.overscaledZ-d.overscaledZ||o.canonical.y-d.canonical.y||o.wrap-d.wrap||o.canonical.x-d.canonical.x}function Rr(_,e,o){return h._(this,void 0,void 0,(function*(){let d=_;if(_.url?d=(yield h.h(e.transformRequest(_.url,"Source"),o)).data:yield B.frameAsync(o),!d)return null;const p=h.M(h.e(d,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in d&&d.vector_layers&&(p.vectorLayerIds=d.vector_layers.map((y=>y.id))),p}))}class We{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof h.N?new h.N(e.lng,e.lat):h.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof h.N?new h.N(e.lng,e.lat):h.N.convert(e),this}extend(e){const o=this._sw,d=this._ne;let p,y;if(e instanceof h.N)p=e,y=e;else{if(!(e instanceof We))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(We.convert(e)):this.extend(h.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(h.N.convert(e)):this;if(p=e._sw,y=e._ne,!p||!y)return this}return o||d?(o.lng=Math.min(p.lng,o.lng),o.lat=Math.min(p.lat,o.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new h.N(p.lng,p.lat),this._ne=new h.N(y.lng,y.lat)),this}getCenter(){return new h.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.N(this.getWest(),this.getNorth())}getSouthEast(){return new h.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:d}=h.N.convert(e);let p=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&p}static convert(e){return e instanceof We?e:e&&new We(e)}static fromLngLat(e,o=0){const d=360*o/40075017,p=d/Math.cos(Math.PI/180*e.lat);return new We(new h.N(e.lng-p,e.lat-d),new h.N(e.lng+p,e.lat+d))}adjustAntiMeridian(){const e=new h.N(this._sw.lng,this._sw.lat),o=new h.N(this._ne.lng,this._ne.lat);return new We(e,e.lng>o.lng?new h.N(o.lng+360,o.lat):o)}}class ds{constructor(e,o,d){this.bounds=We.convert(this.validateBounds(e)),this.minzoom=o||0,this.maxzoom=d||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const o=Math.pow(2,e.z),d=Math.floor(h.O(this.bounds.getWest())*o),p=Math.floor(h.Q(this.bounds.getNorth())*o),y=Math.ceil(h.O(this.bounds.getEast())*o),T=Math.ceil(h.Q(this.bounds.getSouth())*o);return e.x>=d&&e.x<y&&e.y>=p&&e.y<T}}class To extends h.E{constructor(e,o,d,p){if(super(),this.id=e,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.M(o,["url","scheme","tileSize","promoteId"])),this._options=h.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Rr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(h.e(this,e),e.bounds&&(this.tileBounds=new ds(e.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new h.j(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(e){return h._(this,void 0,void 0,(function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(o,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};d.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((y,T)=>{e.reloadPromise={resolve:y,reject:T}}))}else e.actor=this.dispatcher.getActor(),p="LT";e.abortController=new AbortController;try{const y=yield e.actor.sendAsync({type:p,data:d},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,y)}catch(y){if(delete e.abortController,e.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,o){if(o&&o.resourceTiming&&(e.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&e.setExpiryData(o),e.loadVectorData(o,this.map.painter),e.reloadPromise){const d=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(d.resolve).catch(d.reject)}}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class ot extends h.E{constructor(e,o,d,p){super(),this.id=e,this.dispatcher=d,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},o),h.e(this,h.M(o,["url","scheme","tileSize"]))}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Rr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(h.e(this,e),e.bounds&&(this.tileBounds=new ds(e.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new h.j(e))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return h.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return h._(this,void 0,void 0,(function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const d=yield qe.getImage(this.map._requestManager.transformRequest(o,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const p=this.map.painter.context,y=p.gl,T=d.data;e.texture=this.map.painter.getTileTexture(T.width),e.texture?e.texture.update(T,{useMipmap:!0}):(e.texture=new St(p,T,y.RGBA,{useMipmap:!0}),e.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}}))}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class ai extends ot{constructor(e,o,d,p){super(e,o,d,p),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(e){return h._(this,void 0,void 0,(function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d=this.map._requestManager.transformRequest(o,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const p=yield qe.getImage(d,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(p&&p.data){const y=p.data;this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&e.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const T=h.b(y)&&h.U()?y:yield this.readImageNow(y),A={type:this.type,uid:e.uid,source:this.id,rawImageData:T,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const D=yield e.actor.sendAsync({type:"LDT",data:A});e.dem=D,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(p){if(delete e.abortController,e.aborted)e.state="unloaded";else if(p)throw e.state="errored",p}}))}readImageNow(e){return h._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&h.V()){const o=e.width+2,d=e.height+2;try{return new h.R({width:o,height:d},yield h.W(e,-1,-1,o,d))}catch{}}return B.getImageData(e,1)}))}_getNeighboringTiles(e){const o=e.canonical,d=Math.pow(2,o.z),p=(o.x-1+d)%d,y=o.x===0?e.wrap-1:e.wrap,T=(o.x+1+d)%d,A=o.x+1===d?e.wrap+1:e.wrap,D={};return D[new h.S(e.overscaledZ,y,o.z,p,o.y).key]={backfilled:!1},D[new h.S(e.overscaledZ,A,o.z,T,o.y).key]={backfilled:!1},o.y>0&&(D[new h.S(e.overscaledZ,y,o.z,p,o.y-1).key]={backfilled:!1},D[new h.S(e.overscaledZ,e.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},D[new h.S(e.overscaledZ,A,o.z,T,o.y-1).key]={backfilled:!1}),o.y+1<d&&(D[new h.S(e.overscaledZ,y,o.z,p,o.y+1).key]={backfilled:!1},D[new h.S(e.overscaledZ,e.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},D[new h.S(e.overscaledZ,A,o.z,T,o.y+1).key]={backfilled:!1}),D}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class ps extends h.E{constructor(e,o,d,p){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(p),this._data=o.data,this._options=h.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const y=h.X/this.tileSize;o.clusterMaxZoom!==void 0&&this.maxzoom<=o.clusterMaxZoom&&h.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${o.clusterMaxZoom}".`),this.workerOptions=h.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*y,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*y,extent:h.X,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:h.X,radius:(o.clusterRadius||50)*y,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return h._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return h._(this,void 0,void 0,(function*(){const e=h.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,o,d){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:o,offset:d}})}_updateWorkerData(e){return h._(this,void 0,void 0,(function*(){const o=h.e({type:this.type},this.workerOptions);e?o.dataDiff=e:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(B.resolveURL(this._data),"Source"),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new h.k("dataloading",{dataType:"source"}));try{const d=yield this.actor.sendAsync({type:"LD",data:o});if(this._pendingLoads--,this._removed||d.abandoned)return void this.fire(new h.k("dataabort",{dataType:"source"}));let p=null;d.resourceTiming&&d.resourceTiming[this.id]&&(p=d.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&p&&p.length>0&&h.e(y,{resourceTiming:p}),this.fire(new h.k("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new h.k("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(d){if(this._pendingLoads--,this._removed)return void this.fire(new h.k("dataabort",{dataType:"source"}));this.fire(new h.j(d))}}))}loaded(){return this._pendingLoads===0}loadTile(e){return h._(this,void 0,void 0,(function*(){const o=e.actor?"RT":"LT";e.actor=this.actor;const d={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const p=yield this.actor.sendAsync({type:o,data:d},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(p,this.map.painter,o==="RT")}))}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var pr=h.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class As extends h.E{constructor(e,o,d,p){super(),this.id=e,this.dispatcher=d,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=o}load(e){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield qe.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,e&&(this.coordinates=e),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new h.j(o))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const o=e.map(h.Z.fromLngLat);this.tileID=(function(p){let y=1/0,T=1/0,A=-1/0,D=-1/0;for(const Q of p)y=Math.min(y,Q.x),T=Math.min(T,Q.y),A=Math.max(A,Q.x),D=Math.max(D,Q.y);const U=Math.max(A-y,D-T),$=Math.max(0,Math.floor(-Math.log(U)/Math.LN2)),Z=Math.pow(2,$);return new h.a1($,Math.floor((y+A)/2*Z),Math.floor((T+D)/2*Z))})(o),this.minzoom=this.maxzoom=this.tileID.z;const d=o.map((p=>this.tileID.getTilePoint(p)._round()));return this._boundsArray=new h.$,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,h.X,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,h.X),this._boundsArray.emplaceBack(d[2].x,d[2].y,h.X,h.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,o=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,pr.members)),this.boundsSegments||(this.boundsSegments=h.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new St(e,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let d=!1;for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,d=!0)}d&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return h._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class vn extends As{constructor(e,o,d,p){super(e,o,d,p),this.roundZoom=!0,this.type="video",this.options=o}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const o of e.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield h.a3(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new h.j(o))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const o=this.video.seekable;e<o.start(0)||e>o.end(0)?this.fire(new h.j(new h.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,o=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,pr.members)),this.boundsSegments||(this.boundsSegments=h.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new St(e,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let d=!1;for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,d=!0)}d&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ir extends As{constructor(e,o,d,p){super(e,o,d,p),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some((y=>!Array.isArray(y)||y.length!==2||y.some((T=>typeof T!="number"))))||this.fire(new h.j(new h.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.j(new h.a2(`sources.${e}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new h.j(new h.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new h.j(new h.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.j(new h.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,d=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,pr.members)),this.boundsSegments||(this.boundsSegments=h.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new St(o,this.canvas,d.RGBA,{premultiply:!0});let p=!1;for(const y in this.tiles){const T=this.tiles[y];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,p=!0)}p&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const sa={},aa=_=>{switch(_){case"geojson":return ps;case"image":return As;case"raster":return ot;case"raster-dem":return ai;case"vector":return To;case"video":return vn;case"canvas":return ir}return sa[_]},Je="RTLPluginLoaded";class Vr extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Wt()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((o=>{throw this.status="error",o}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return h._(this,arguments,void 0,(function*(o,d=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=B.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!d)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return h._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.k(Je))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let dn=null;function tn(){return dn||(dn=new Vr),dn}class Pa{constructor(e,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=h.a4(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const o=e+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,o,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(p,y){const T={};if(!y)return T;for(const A of p){const D=A.layerIds.map((U=>y.getLayer(U))).filter(Boolean);if(D.length!==0){A.layers=D,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map((U=>D.filter(($=>$.id===U))[0])));for(const U of D)T[U.id]=A}}return T})(e.buckets,o.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const y=this.buckets[p];if(y instanceof h.a6){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const y=this.buckets[p];if(y instanceof h.a6&&y.hasRTLText){this.hasRTLText=!0,tn().lazyLoad();break}}this.queryPadding=0;for(const p in this.buckets){const y=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(p).queryRadius(y))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new h.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const d in this.buckets){const p=this.buckets[d];p.uploadPending()&&p.upload(e)}const o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new St(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new St(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,d,p,y,T,A,D,U,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:T,tileSize:this.tileSize,pixelPosMatrix:$,transform:D,params:A,queryPadding:this.queryPadding*U},e,o,d):{}}querySourceFeatures(e,o){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const p=d.loadVTLayers(),y=o&&o.sourceLayer?o.sourceLayer:"",T=p._geojsonTileLayer||p[y];if(!T)return;const A=h.a7(o&&o.filter),{z:D,x:U,y:$}=this.tileID.canonical,Z={z:D,x:U,y:$};for(let Q=0;Q<T.length;Q++){const oe=T.feature(Q);if(A.needGeometry){const ge=h.a8(oe,!0);if(!A.filter(new h.z(this.tileID.overscaledZ),ge,this.tileID.canonical))continue}else if(!A.filter(new h.z(this.tileID.overscaledZ),oe))continue;const he=d.getId(oe,y),pe=new h.a9(oe,D,U,$,he);pe.tile=Z,e.push(pe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const o=this.expirationTime;if(e.cacheControl){const d=h.aa(e.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const d=Date.now();let p=!1;if(this.expirationTime>d)p=!1;else if(o)if(this.expirationTime<o)p=!0;else{const y=this.expirationTime-o;y?this.expirationTime=d+Math.max(y,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!o.style.hasLayer(p))continue;const y=this.buckets[p],T=y.layers[0].sourceLayer||"_geojsonTileLayer",A=d[T],D=e[T];if(!A||!D||Object.keys(D).length===0)continue;y.update(D,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});const U=o&&o.style&&o.style.getLayer(p);U&&(this.queryPadding=Math.max(this.queryPadding,U.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<B.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=B.now()+e}setDependencies(e,o){const d={};for(const p of o)d[p]=!0;this.dependencies[e]=d}hasDependency(e,o){for(const d of e){const p=this.dependencies[d];if(p){for(const y of o)if(p[y])return!0}}return!1}}class _t{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(const e in this.data)for(const o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,d){const p=e.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const y={value:o,timeout:void 0};if(d!==void 0&&(y.timeout=setTimeout((()=>{this.remove(e,y)}),d)),this.data[p].push(y),this.order.push(p),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){const o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;const d=e.wrapped().key,p=o===void 0?0:this.data[d].indexOf(o),y=this.data[d][p];return this.data[d].splice(p,1),y.timeout&&clearTimeout(y.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){const o=[];for(const d in this.data)for(const p of this.data[d])e(p.value)||o.push(p);for(const d of o)this.remove(d.value.tileID,d)}}class In{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,d){const p=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][p]=this.stateChanges[e][p]||{},h.e(this.stateChanges[e][p],d),this.deletedStates[e]===null){this.deletedStates[e]={};for(const y in this.state[e])y!==p&&(this.deletedStates[e][y]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][p]===null){this.deletedStates[e][p]={};for(const y in this.state[e][p])d[y]||(this.deletedStates[e][p][y]=null)}else for(const y in d)this.deletedStates[e]&&this.deletedStates[e][p]&&this.deletedStates[e][p][y]===null&&delete this.deletedStates[e][p][y]}removeFeatureState(e,o,d){if(this.deletedStates[e]===null)return;const p=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},d&&o!==void 0)this.deletedStates[e][p]!==null&&(this.deletedStates[e][p]=this.deletedStates[e][p]||{},this.deletedStates[e][p][d]=null);else if(o!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][p])for(d in this.deletedStates[e][p]={},this.stateChanges[e][p])this.deletedStates[e][p][d]=null;else this.deletedStates[e][p]=null;else this.deletedStates[e]=null}getState(e,o){const d=String(o),p=h.e({},(this.state[e]||{})[d],(this.stateChanges[e]||{})[d]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const y=this.deletedStates[e][o];if(y===null)return{};for(const T in y)delete p[T]}return p}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){const d={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const y={};for(const T in this.stateChanges[p])this.state[p][T]||(this.state[p][T]={}),h.e(this.state[p][T],this.stateChanges[p][T]),y[T]=this.state[p][T];d[p]=y}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const y={};if(this.deletedStates[p]===null)for(const T in this.state[p])y[T]={},this.state[p][T]={};else for(const T in this.deletedStates[p]){if(this.deletedStates[p][T]===null)this.state[p][T]={};else for(const A of Object.keys(this.deletedStates[p][T]))delete this.state[p][T][A];y[T]=this.state[p][T]}d[p]=d[p]||{},h.e(d[p],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const p in e)e[p].setFeatureState(d,o)}}class dt extends h.E{constructor(e,o,d){super(),this.id=e,this.dispatcher=d,this.on("data",(p=>this._dataHandler(p))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((p,y,T,A)=>{const D=new(aa(y.type))(p,y,T,A);if(D.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${D.id}`);return D})(e,o,d,this),this._tiles={},this._cache=new _t(0,(p=>this._unloadTile(p))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new In,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const o=this._tiles[e];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,o,d){return h._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,o,d)}catch(p){e.state="errored",p.status!==404?this._source.fire(new h.j(p,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new h.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const d=this._tiles[o];d.upload(e),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(mr).map((e=>e.key))}getRenderableIds(e){const o=[];for(const d in this._tiles)this._isIdRenderable(d,e)&&o.push(this._tiles[d]);return e?o.sort(((d,p)=>{const y=d.tileID,T=p.tileID,A=new h.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),D=new h.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-T.overscaledZ||D.y-A.y||D.x-A.x})).map((d=>d.tileID.key)):o.map((d=>d.tileID)).sort(mr).map((d=>d.key))}hasRenderableParent(e){const o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,o){return h._(this,void 0,void 0,(function*(){const d=this._tiles[e];d&&(d.state!=="loading"&&(d.state=o),yield this._loadTile(d,e,o))}))}_tileLoaded(e,o,d){e.timeAdded=B.now(),d==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new h.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const o=this.getRenderableIds();for(let p=0;p<o.length;p++){const y=o[p];if(e.neighboringTiles&&e.neighboringTiles[y]){const T=this.getTileByID(y);d(e,T),d(T,e)}}function d(p,y){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let T=y.tileID.canonical.x-p.tileID.canonical.x;const A=y.tileID.canonical.y-p.tileID.canonical.y,D=Math.pow(2,p.tileID.canonical.z),U=y.tileID.key;T===0&&A===0||Math.abs(A)>1||(Math.abs(T)>1&&(Math.abs(T+D)===1?T+=D:Math.abs(T-D)===1&&(T-=D)),y.dem&&p.dem&&(p.dem.backfillBorder(y.dem,T,A),p.neighboringTiles&&p.neighboringTiles[U]&&(p.neighboringTiles[U].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,d,p){for(const y in this._tiles){let T=this._tiles[y];if(p[y]||!T.hasData()||T.tileID.overscaledZ<=o||T.tileID.overscaledZ>d)continue;let A=T.tileID;for(;T&&T.tileID.overscaledZ>o+1;){const U=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[U.key],T&&T.hasData()&&(A=U)}let D=A;for(;D.overscaledZ>o;)if(D=D.scaledTo(D.overscaledZ-1),e[D.key]){p[A.key]=A;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){const d=this._loadedParentTiles[e.key];return d&&d.tileID.overscaledZ>=o?d:null}for(let d=e.overscaledZ-1;d>=o;d--){const p=e.scaledTo(d),y=this._getLoadedTile(p);if(y)return y}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const o=Math.ceil(e.width/this._source.tileSize)+1,d=Math.ceil(e.height/this._source.tileSize)+1,p=Math.floor(o*d*(this._maxTileCacheZoomLevels===null?h.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(y)}handleWrapJump(e){const o=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,o){const d={};for(const p in this._tiles){const y=this._tiles[p];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+o),d[y.tileID.key]=y}this._tiles=d;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}_updateCoveredAndRetainedTiles(e,o,d,p,y,T){const A={},D={},U=Object.keys(e),$=B.now();for(const Z of U){const Q=e[Z],oe=this._tiles[Z];if(!oe||oe.fadeEndTime!==0&&oe.fadeEndTime<=$)continue;const he=this.findLoadedParent(Q,o),pe=this.findLoadedSibling(Q),ge=he||pe||null;ge&&(this._addTile(ge.tileID),A[ge.tileID.key]=ge.tileID),D[Z]=Q}this._retainLoadedChildren(D,p,d,e);for(const Z in A)e[Z]||(this._coveredTiles[Z]=!0,e[Z]=A[Z]);if(T){const Z={},Q={};for(const oe of y)this._tiles[oe.key].hasData()?Z[oe.key]=oe:Q[oe.key]=oe;for(const oe in Q){const he=Q[oe].children(this._source.maxzoom);this._tiles[he[0].key]&&this._tiles[he[1].key]&&this._tiles[he[2].key]&&this._tiles[he[3].key]&&(Z[he[0].key]=e[he[0].key]=he[0],Z[he[1].key]=e[he[1].key]=he[1],Z[he[2].key]=e[he[2].key]=he[2],Z[he[3].key]=e[he[3].key]=he[3],delete Q[oe])}for(const oe in Q){const he=Q[oe],pe=this.findLoadedParent(he,this._source.minzoom),ge=this.findLoadedSibling(he),ve=pe||ge||null;if(ve){Z[ve.tileID.key]=e[ve.tileID.key]=ve.tileID;for(const Se in Z)Z[Se].isChildOf(ve.tileID)&&delete Z[Se]}}for(const oe in this._tiles)Z[oe]||(this._coveredTiles[oe]=!0)}}update(e,o){if(!this._sourceLoaded||this._paused)return;let d;this.transform=e,this.terrain=o,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(($=>new h.S($.canonical.z,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y))):(d=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(d=d.filter(($=>this._source.hasTile($))))):d=[];const p=e.coveringZoomLevel(this._source),y=Math.max(p-dt.maxOverzooming,this._source.minzoom),T=Math.max(p+dt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const $={};for(const Z of d)if(Z.canonical.z>this._source.minzoom){const Q=Z.scaledTo(Z.canonical.z-1);$[Q.key]=Q;const oe=Z.scaledTo(Math.max(this._source.minzoom,Math.min(Z.canonical.z,5)));$[oe.key]=oe}d=d.concat(Object.values($))}const A=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,A&&this.fire(new h.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const D=this._updateRetainedTiles(d,p);qr(this._source.type)&&this._updateCoveredAndRetainedTiles(D,y,T,p,d,o);for(const $ in D)this._tiles[$].clearFadeHold();const U=h.ab(this._tiles,D);for(const $ of U){const Z=this._tiles[$];Z.hasSymbolBuckets&&!Z.holdingForFade()?Z.setHoldDuration(this.map._fadeDuration):Z.hasSymbolBuckets&&!Z.symbolFadeFinished()||this._removeTile($)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,o){var d;const p={},y={},T=Math.max(o-dt.maxOverzooming,this._source.minzoom),A=Math.max(o+dt.maxUnderzooming,this._source.minzoom),D={};for(const U of e){const $=this._addTile(U);p[U.key]=U,$.hasData()||o<this._source.maxzoom&&(D[U.key]=U)}this._retainLoadedChildren(D,o,A,p);for(const U of e){let $=this._tiles[U.key];if($.hasData())continue;if(o+1>this._source.maxzoom){const Q=U.children(this._source.maxzoom)[0],oe=this.getTile(Q);if(oe&&oe.hasData()){p[Q.key]=Q;continue}}else{const Q=U.children(this._source.maxzoom);if(p[Q[0].key]&&p[Q[1].key]&&p[Q[2].key]&&p[Q[3].key])continue}let Z=$.wasRequested();for(let Q=U.overscaledZ-1;Q>=T;--Q){const oe=U.scaledTo(Q);if(y[oe.key])break;if(y[oe.key]=!0,$=this.getTile(oe),!$&&Z&&($=this._addTile(oe)),$){const he=$.hasData();if((he||!(!((d=this.map)===null||d===void 0)&&d.cancelPendingTileRequestsWhileZooming)||Z)&&(p[oe.key]=oe),Z=$.wasRequested(),he)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const o=[];let d,p=this._tiles[e].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){d=this._loadedParentTiles[p.key];break}o.push(p.key);const y=p.scaledTo(p.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;p=y}for(const y of o)this._loadedParentTiles[y]=d}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const o=this._tiles[e].tileID,d=this._getLoadedTile(o);this._loadedSiblingTiles[o.key]=d}}_addTile(e){let o=this._tiles[e.key];if(o)return o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));const d=o;return o||(o=new Pa(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(o,e.key,o.state)),o.uses++,this._tiles[e.key]=o,d||this._source.fire(new h.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const d=o.getExpiryTimeout();d&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),d))}_removeTile(e){const o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(e){const o=e.sourceDataType;e.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&o==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,o,d){const p=[],y=this.transform;if(!y)return p;const T=d?y.getCameraQueryGeometry(e):e,A=e.map((he=>y.pointCoordinate(he,this.terrain))),D=T.map((he=>y.pointCoordinate(he,this.terrain))),U=this.getIds();let $=1/0,Z=1/0,Q=-1/0,oe=-1/0;for(const he of D)$=Math.min($,he.x),Z=Math.min(Z,he.y),Q=Math.max(Q,he.x),oe=Math.max(oe,he.y);for(let he=0;he<U.length;he++){const pe=this._tiles[U[he]];if(pe.holdingForFade())continue;const ge=pe.tileID,ve=Math.pow(2,y.zoom-pe.tileID.overscaledZ),Se=o*pe.queryPadding*h.X/pe.tileSize/ve,me=[ge.getTilePoint(new h.Z($,Z)),ge.getTilePoint(new h.Z(Q,oe))];if(me[0].x-Se<h.X&&me[0].y-Se<h.X&&me[1].x+Se>=0&&me[1].y+Se>=0){const Ae=A.map((Ve=>ge.getTilePoint(Ve))),ze=D.map((Ve=>ge.getTilePoint(Ve)));p.push({tile:pe,tileID:ge,queryGeometry:Ae,cameraQueryGeometry:ze,scale:ve})}}return p}getVisibleCoordinates(e){const o=this.getRenderableIds(e).map((d=>this._tiles[d].tileID));for(const d of o)d.posMatrix=this.transform.calculatePosMatrix(d.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(qr(this._source.type)){const e=B.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=e)return!0}return!1}setFeatureState(e,o,d){this._state.updateState(e=e||"_geojsonTileLayer",o,d)}removeFeatureState(e,o,d){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,d)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,d){const p=this._tiles[e];p&&p.setDependencies(o,d)}reloadTilesForDependencies(e,o){for(const d in this._tiles)this._tiles[d].hasDependency(e,o)&&this._reloadTile(d,"reloading");this._cache.filter((d=>!d.hasDependency(e,o)))}}function mr(_,e){const o=Math.abs(2*_.wrap)-+(_.wrap<0),d=Math.abs(2*e.wrap)-+(e.wrap<0);return _.overscaledZ-e.overscaledZ||d-o||e.canonical.y-_.canonical.y||e.canonical.x-_.canonical.x}function qr(_){return _==="raster"||_==="image"||_==="video"}dt.maxOverzooming=10,dt.maxUnderzooming=3;class pn{constructor(e,o){this.reset(e,o)}reset(e,o){this.points=e||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=h.ac(e,0,1);let o=1,d=this._distances[o];const p=e*this.paddedLength+this.padding;for(;d<p&&o<this._distances.length;)d=this._distances[++o];const y=o-1,T=this._distances[y],A=d-T,D=A>0?(p-T)/A:0;return this.points[y].mult(1-D).add(this.points[o].mult(D))}}function ki(_,e){let o=!0;return _==="always"||_!=="never"&&e!=="never"||(o=!1),o}class Sr{constructor(e,o,d){const p=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(e/d),this.yCellCount=Math.ceil(o/d);for(let T=0;T<this.xCellCount*this.yCellCount;T++)p.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=o,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,o,d,p,y){this._forEachCell(o,d,p,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(o),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(y)}insertCircle(e,o,d,p){this._forEachCell(o-p,d-p,o+p,d+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(o),this.circles.push(d),this.circles.push(p)}_insertBoxCell(e,o,d,p,y,T){this.boxCells[y].push(T)}_insertCircleCell(e,o,d,p,y,T){this.circleCells[y].push(T)}_query(e,o,d,p,y,T,A){if(d<0||e>this.width||p<0||o>this.height)return[];const D=[];if(e<=0&&o<=0&&this.width<=d&&this.height<=p){if(y)return[{key:null,x1:e,y1:o,x2:d,y2:p}];for(let U=0;U<this.boxKeys.length;U++)D.push({key:this.boxKeys[U],x1:this.bboxes[4*U],y1:this.bboxes[4*U+1],x2:this.bboxes[4*U+2],y2:this.bboxes[4*U+3]});for(let U=0;U<this.circleKeys.length;U++){const $=this.circles[3*U],Z=this.circles[3*U+1],Q=this.circles[3*U+2];D.push({key:this.circleKeys[U],x1:$-Q,y1:Z-Q,x2:$+Q,y2:Z+Q})}}else this._forEachCell(e,o,d,p,this._queryCell,D,{hitTest:y,overlapMode:T,seenUids:{box:{},circle:{}}},A);return D}query(e,o,d,p){return this._query(e,o,d,p,!1,null)}hitTest(e,o,d,p,y,T){return this._query(e,o,d,p,!0,y,T).length>0}hitTestCircle(e,o,d,p,y){const T=e-d,A=e+d,D=o-d,U=o+d;if(A<0||T>this.width||U<0||D>this.height)return!1;const $=[];return this._forEachCell(T,D,A,U,this._queryCellCircle,$,{hitTest:!0,overlapMode:p,circle:{x:e,y:o,radius:d},seenUids:{box:{},circle:{}}},y),$.length>0}_queryCell(e,o,d,p,y,T,A,D){const{seenUids:U,hitTest:$,overlapMode:Z}=A,Q=this.boxCells[y];if(Q!==null){const he=this.bboxes;for(const pe of Q)if(!U.box[pe]){U.box[pe]=!0;const ge=4*pe,ve=this.boxKeys[pe];if(e<=he[ge+2]&&o<=he[ge+3]&&d>=he[ge+0]&&p>=he[ge+1]&&(!D||D(ve))&&(!$||!ki(Z,ve.overlapMode))&&(T.push({key:ve,x1:he[ge],y1:he[ge+1],x2:he[ge+2],y2:he[ge+3]}),$))return!0}}const oe=this.circleCells[y];if(oe!==null){const he=this.circles;for(const pe of oe)if(!U.circle[pe]){U.circle[pe]=!0;const ge=3*pe,ve=this.circleKeys[pe];if(this._circleAndRectCollide(he[ge],he[ge+1],he[ge+2],e,o,d,p)&&(!D||D(ve))&&(!$||!ki(Z,ve.overlapMode))){const Se=he[ge],me=he[ge+1],Ae=he[ge+2];if(T.push({key:ve,x1:Se-Ae,y1:me-Ae,x2:Se+Ae,y2:me+Ae}),$)return!0}}}return!1}_queryCellCircle(e,o,d,p,y,T,A,D){const{circle:U,seenUids:$,overlapMode:Z}=A,Q=this.boxCells[y];if(Q!==null){const he=this.bboxes;for(const pe of Q)if(!$.box[pe]){$.box[pe]=!0;const ge=4*pe,ve=this.boxKeys[pe];if(this._circleAndRectCollide(U.x,U.y,U.radius,he[ge+0],he[ge+1],he[ge+2],he[ge+3])&&(!D||D(ve))&&!ki(Z,ve.overlapMode))return T.push(!0),!0}}const oe=this.circleCells[y];if(oe!==null){const he=this.circles;for(const pe of oe)if(!$.circle[pe]){$.circle[pe]=!0;const ge=3*pe,ve=this.circleKeys[pe];if(this._circlesCollide(he[ge],he[ge+1],he[ge+2],U.x,U.y,U.radius)&&(!D||D(ve))&&!ki(Z,ve.overlapMode))return T.push(!0),!0}}}_forEachCell(e,o,d,p,y,T,A,D){const U=this._convertToXCellCoord(e),$=this._convertToYCellCoord(o),Z=this._convertToXCellCoord(d),Q=this._convertToYCellCoord(p);for(let oe=U;oe<=Z;oe++)for(let he=$;he<=Q;he++)if(y.call(this,e,o,d,p,this.xCellCount*he+oe,T,A,D))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,o,d,p,y,T){const A=p-e,D=y-o,U=d+T;return U*U>A*A+D*D}_circleAndRectCollide(e,o,d,p,y,T,A){const D=(T-p)/2,U=Math.abs(e-(p+D));if(U>D+d)return!1;const $=(A-y)/2,Z=Math.abs(o-(y+$));if(Z>$+d)return!1;if(U<=D||Z<=$)return!0;const Q=U-D,oe=Z-$;return Q*Q+oe*oe<=d*d}}function Mi(_,e,o,d,p){const y=h.H();return e?(h.K(y,y,[1/p,1/p,1]),o||h.ad(y,y,d.angle)):h.L(y,d.labelPlaneMatrix,_),y}function gr(_,e,o,d,p){if(e){const y=h.ae(_);return h.K(y,y,[p,p,1]),o||h.ad(y,y,-d.angle),y}return d.glCoordMatrix}function _e(_,e,o,d){let p;d?(p=[_,e,d(_,e),1],h.af(p,p,o)):(p=[_,e,0,1],Fn(p,p,o));const y=p[3];return{point:new h.P(p[0]/y,p[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function Y(_,e){return .5+_/e*.5}function W(_,e){return _.x>=-e[0]&&_.x<=e[0]&&_.y>=-e[1]&&_.y<=e[1]}function ae(_,e,o,d,p,y,T,A,D,U,$,Z,Q,oe,he){const pe=d?_.textSizeData:_.iconSizeData,ge=h.ag(pe,o.transform.zoom),ve=[256/o.width*2+1,256/o.height*2+1],Se=d?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;Se.clear();const me=_.lineVertexArray,Ae=d?_.text.placedSymbolArray:_.icon.placedSymbolArray,ze=o.transform.width/o.transform.height;let Ve=!1;for(let at=0;at<Ae.length;at++){const yt=Ae.get(at);if(yt.hidden||yt.writingMode===h.ah.vertical&&!Ve){Jt(yt.numGlyphs,Se);continue}Ve=!1;const kt=_e(yt.anchorX,yt.anchorY,e,he);if(!W(kt.point,ve)){Jt(yt.numGlyphs,Se);continue}const Lt=Y(o.transform.cameraToCenterDistance,kt.signedDistanceFromCamera),Et=h.ai(pe,ge,yt),bt=T?Et/Lt:Et*Lt,Ut={getElevation:he,labelPlaneMatrix:p,lineVertexArray:me,pitchWithMap:T,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:U,tileAnchorPoint:new h.P(yt.anchorX,yt.anchorY),unwrappedTileID:$,width:Z,height:Q,translation:oe},gn=Me(Ut,yt,bt,!1,A,e,y,_.glyphOffsetArray,Se,ze,D);Ve=gn.useVertical,(gn.notEnoughRoom||Ve||gn.needsFlipping&&Me(Ut,yt,bt,!0,A,e,y,_.glyphOffsetArray,Se,ze,D).notEnoughRoom)&&Jt(yt.numGlyphs,Se)}d?_.text.dynamicLayoutVertexBuffer.updateData(Se):_.icon.dynamicLayoutVertexBuffer.updateData(Se)}function se(_,e,o,d,p,y,T,A){const D=y.glyphStartIndex+y.numGlyphs,U=y.lineStartIndex,$=y.lineStartIndex+y.lineLength,Z=e.getoffsetX(y.glyphStartIndex),Q=e.getoffsetX(D-1),oe=vt(_*Z,o,d,p,y.segment,U,$,A,T);if(!oe)return null;const he=vt(_*Q,o,d,p,y.segment,U,$,A,T);return he?A.projectionCache.anyProjectionOccluded?null:{first:oe,last:he}:null}function Ee(_,e,o,d){return _===h.ah.horizontal&&Math.abs(o.y-e.y)>Math.abs(o.x-e.x)*d?{useVertical:!0}:(_===h.ah.vertical?e.y<o.y:e.x>o.x)?{needsFlipping:!0}:null}function Me(_,e,o,d,p,y,T,A,D,U,$){const Z=o/24,Q=e.lineOffsetX*Z,oe=e.lineOffsetY*Z;let he;if(e.numGlyphs>1){const pe=e.glyphStartIndex+e.numGlyphs,ge=e.lineStartIndex,ve=e.lineStartIndex+e.lineLength,Se=se(Z,A,Q,oe,d,e,$,_);if(!Se)return{notEnoughRoom:!0};const me=_e(Se.first.point.x,Se.first.point.y,T,_.getElevation).point,Ae=_e(Se.last.point.x,Se.last.point.y,T,_.getElevation).point;if(p&&!d){const ze=Ee(e.writingMode,me,Ae,U);if(ze)return ze}he=[Se.first];for(let ze=e.glyphStartIndex+1;ze<pe-1;ze++)he.push(vt(Z*A.getoffsetX(ze),Q,oe,d,e.segment,ge,ve,_,$));he.push(Se.last)}else{if(p&&!d){const ge=_e(_.tileAnchorPoint.x,_.tileAnchorPoint.y,y,_.getElevation).point,ve=e.lineStartIndex+e.segment+1,Se=new h.P(_.lineVertexArray.getx(ve),_.lineVertexArray.gety(ve)),me=_e(Se.x,Se.y,y,_.getElevation),Ae=me.signedDistanceFromCamera>0?me.point:(function(Ve,at,yt,kt,Lt,Et){return Oe(Ve,at,yt,1,Lt,Et)})(_.tileAnchorPoint,Se,ge,0,y,_),ze=Ee(e.writingMode,ge,Ae,U);if(ze)return ze}const pe=vt(Z*A.getoffsetX(e.glyphStartIndex),Q,oe,d,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,_,$);if(!pe||_.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};he=[pe]}for(const pe of he)h.aj(D,pe.point,pe.angle);return{}}function Oe(_,e,o,d,p,y){const T=_.add(_.sub(e)._unit()),A=p!==void 0?_e(T.x,T.y,p,y.getElevation).point:Ye(T.x,T.y,y).point,D=o.sub(A);return o.add(D._mult(d/D.mag()))}function ke(_,e,o){const d=e.projectionCache;if(d.projections[_])return d.projections[_];const p=new h.P(e.lineVertexArray.getx(_),e.lineVertexArray.gety(_)),y=Ye(p.x,p.y,e);if(y.signedDistanceFromCamera>0)return d.projections[_]=y.point,d.anyProjectionOccluded=d.anyProjectionOccluded||y.isOccluded,y.point;const T=_-o.direction;return(function(A,D,U,$,Z){return Oe(A,D,U,$,void 0,Z)})(o.distanceFromAnchor===0?e.tileAnchorPoint:new h.P(e.lineVertexArray.getx(T),e.lineVertexArray.gety(T)),p,o.previousVertex,o.absOffsetX-o.distanceFromAnchor+1,e)}function Ye(_,e,o){const d=_+o.translation[0],p=e+o.translation[1];let y;return!o.pitchWithMap&&o.projection.useSpecialProjectionForSymbols?(y=o.projection.projectTileCoordinates(d,p,o.unwrappedTileID,o.getElevation),y.point.x=(.5*y.point.x+.5)*o.width,y.point.y=(.5*-y.point.y+.5)*o.height):(y=_e(d,p,o.labelPlaneMatrix,o.getElevation),y.isOccluded=!1),y}function lt(_,e,o){return _._unit()._perp()._mult(e*o)}function Ze(_,e,o,d,p,y,T,A,D){if(A.projectionCache.offsets[_])return A.projectionCache.offsets[_];const U=o.add(e);if(_+D.direction<d||_+D.direction>=p)return A.projectionCache.offsets[_]=U,U;const $=ke(_+D.direction,A,D),Z=lt($.sub(o),T,D.direction),Q=o.add(Z),oe=$.add(Z);return A.projectionCache.offsets[_]=h.ak(y,U,Q,oe)||U,A.projectionCache.offsets[_]}function vt(_,e,o,d,p,y,T,A,D){const U=d?_-e:_+e;let $=U>0?1:-1,Z=0;d&&($*=-1,Z=Math.PI),$<0&&(Z+=Math.PI);let Q,oe=$>0?y+p:y+p+1;A.projectionCache.cachedAnchorPoint?Q=A.projectionCache.cachedAnchorPoint:(Q=Ye(A.tileAnchorPoint.x,A.tileAnchorPoint.y,A).point,A.projectionCache.cachedAnchorPoint=Q);let he,pe,ge=Q,ve=Q,Se=0,me=0;const Ae=Math.abs(U),ze=[];let Ve;for(;Se+me<=Ae;){if(oe+=$,oe<y||oe>=T)return null;Se+=me,ve=ge,pe=he;const kt={absOffsetX:Ae,direction:$,distanceFromAnchor:Se,previousVertex:ve};if(ge=ke(oe,A,kt),o===0)ze.push(ve),Ve=ge.sub(ve);else{let Lt;const Et=ge.sub(ve);Lt=Et.mag()===0?lt(ke(oe+$,A,kt).sub(ge),o,$):lt(Et,o,$),pe||(pe=ve.add(Lt)),he=Ze(oe,Lt,ge,y,T,pe,o,A,kt),ze.push(pe),Ve=he.sub(pe)}me=Ve.mag()}const at=Ve._mult((Ae-Se)/me)._add(pe||ve),yt=Z+Math.atan2(ge.y-ve.y,ge.x-ve.x);return ze.push(at),{point:at,angle:D?yt:0,path:ze}}const jt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Jt(_,e){for(let o=0;o<_;o++){const d=e.length;e.resize(d+4),e.float32.set(jt,3*d)}}function Fn(_,e,o){const d=e[0],p=e[1];return _[0]=o[0]*d+o[4]*p+o[12],_[1]=o[1]*d+o[5]*p+o[13],_[3]=o[3]*d+o[7]*p+o[15],_}const bn=100;class kn{constructor(e,o,d=new Sr(e.width+200,e.height+200,25),p=new Sr(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=o,this.grid=d,this.ignoredGrid=p,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+bn,this.screenBottomBoundary=e.height+bn,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,o,d,p,y,T,A,D,U,$,Z){const Q=e.anchorPointX+D[0],oe=e.anchorPointY+D[1],he=this.projectAndGetPerspectiveRatio(p,Q,oe,y,$),pe=d*he.perspectiveRatio;let ge;if(T||A)ge=this._projectCollisionBox(e,pe,p,y,T,A,D,he,$,Z);else{const ze=he.point.x+(Z?Z.x*pe:0),Ve=he.point.y+(Z?Z.y*pe:0);ge={allPointsOccluded:!1,box:[ze+e.x1*pe,Ve+e.y1*pe,ze+e.x2*pe,Ve+e.y2*pe]}}const[ve,Se,me,Ae]=ge.box;return this.mapProjection.useSpecialProjectionForSymbols&&(T?ge.allPointsOccluded:this.mapProjection.isOccluded(Q,oe,y))||he.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ve,Se,me,Ae)||o!=="always"&&this.grid.hitTest(ve,Se,me,Ae,o,U)?{box:[ve,Se,me,Ae],placeable:!1,offscreen:!1}:{box:[ve,Se,me,Ae],placeable:!0,offscreen:this.isOffscreen(ve,Se,me,Ae)}}placeCollisionCircles(e,o,d,p,y,T,A,D,U,$,Z,Q,oe,he,pe,ge){const ve=[],Se=new h.P(o.anchorX,o.anchorY),me=this.getPerspectiveRatio(T,Se.x,Se.y,A,ge),Ae=(Z?y/me:y*me)/h.ap,ze={getElevation:ge,labelPlaneMatrix:D,lineVertexArray:d,pitchWithMap:Z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Se,unwrappedTileID:A,width:this.transform.width,height:this.transform.height,translation:pe},Ve=se(Ae,p,o.lineOffsetX*Ae,o.lineOffsetY*Ae,!1,o,!1,ze);let at=!1,yt=!1,kt=!0;if(Ve){const Lt=.5*oe*me+he,Et=new h.P(-100,-100),bt=new h.P(this.screenRightBoundary,this.screenBottomBoundary),Ut=new pn,gn=Ve.first,It=Ve.last;let Ct=[];for(let En=gn.path.length-1;En>=1;En--)Ct.push(gn.path[En]);for(let En=1;En<It.path.length;En++)Ct.push(It.path[En]);const mn=2.5*Lt;if(U){const En=this.projectPathToScreenSpace(Ct,ze,U);Ct=En.some((Pn=>Pn.signedDistanceFromCamera<=0))?[]:En.map((Pn=>Pn.point))}let li=[];if(Ct.length>0){const En=Ct[0].clone(),Pn=Ct[0].clone();for(let ci=1;ci<Ct.length;ci++)En.x=Math.min(En.x,Ct[ci].x),En.y=Math.min(En.y,Ct[ci].y),Pn.x=Math.max(Pn.x,Ct[ci].x),Pn.y=Math.max(Pn.y,Ct[ci].y);li=En.x>=Et.x&&Pn.x<=bt.x&&En.y>=Et.y&&Pn.y<=bt.y?[Ct]:Pn.x<Et.x||En.x>bt.x||Pn.y<Et.y||En.y>bt.y?[]:h.al([Ct],Et.x,Et.y,bt.x,bt.y)}for(const En of li){Ut.reset(En,.25*Lt);let Pn=0;Pn=Ut.length<=.5*Lt?1:Math.ceil(Ut.paddedLength/mn)+1;for(let ci=0;ci<Pn;ci++){const wr=ci/Math.max(Pn-1,1),bs=Ut.lerp(wr),hi=bs.x+bn,or=bs.y+bn;ve.push(hi,or,Lt,0);const wi=hi-Lt,$i=or-Lt,Pr=hi+Lt,ga=or+Lt;if(kt=kt&&this.isOffscreen(wi,$i,Pr,ga),yt=yt||this.isInsideGrid(wi,$i,Pr,ga),e!=="always"&&this.grid.hitTestCircle(hi,or,Lt,e,Q)&&(at=!0,!$))return{circles:[],offscreen:!1,collisionDetected:at}}}}return{circles:!$&&at||!yt||me<this.perspectiveRatioCutoff?[]:ve,offscreen:kt,collisionDetected:at}}projectPathToScreenSpace(e,o,d){return e.map((p=>_e(p.x,p.y,d,o.getElevation)))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let d=1/0,p=1/0,y=-1/0,T=-1/0;for(const $ of e){const Z=new h.P($.x+bn,$.y+bn);d=Math.min(d,Z.x),p=Math.min(p,Z.y),y=Math.max(y,Z.x),T=Math.max(T,Z.y),o.push(Z)}const A=this.grid.query(d,p,y,T).concat(this.ignoredGrid.query(d,p,y,T)),D={},U={};for(const $ of A){const Z=$.key;if(D[Z.bucketInstanceId]===void 0&&(D[Z.bucketInstanceId]={}),D[Z.bucketInstanceId][Z.featureIndex])continue;const Q=[new h.P($.x1,$.y1),new h.P($.x2,$.y1),new h.P($.x2,$.y2),new h.P($.x1,$.y2)];h.am(o,Q)&&(D[Z.bucketInstanceId][Z.featureIndex]=!0,U[Z.bucketInstanceId]===void 0&&(U[Z.bucketInstanceId]=[]),U[Z.bucketInstanceId].push(Z.featureIndex))}return U}insertCollisionBox(e,o,d,p,y,T){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:T,overlapMode:o},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,o,d,p,y,T){const A=d?this.ignoredGrid:this.grid,D={bucketInstanceId:p,featureIndex:y,collisionGroupID:T,overlapMode:o};for(let U=0;U<e.length;U+=4)A.insertCircle(D,e[U],e[U+1],e[U+2])}projectAndGetPerspectiveRatio(e,o,d,p,y){let T;y?(T=[o,d,y(o,d),1],h.af(T,T,e)):(T=[o,d,0,1],Fn(T,T,e));const A=T[3];return{point:new h.P((T[0]/A+1)/2*this.transform.width+bn,(-T[1]/A+1)/2*this.transform.height+bn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/A*.5,isOccluded:!1,signedDistanceFromCamera:A}}getPerspectiveRatio(e,o,d,p,y){const T=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(o,d,p,y):_e(o,d,e,y);return .5+this.transform.cameraToCenterDistance/T.signedDistanceFromCamera*.5}isOffscreen(e,o,d,p){return d<bn||e>=this.screenRightBoundary||p<bn||o>this.screenBottomBoundary}isInsideGrid(e,o,d,p){return d>=0&&e<this.gridRightBoundary&&p>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const e=h.an([]);return h.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,o,d,p,y,T,A,D,U,$){let Z=new h.P(1,0),Q=new h.P(0,1);const oe=new h.P(e.anchorPointX+A[0],e.anchorPointY+A[1]);if(T&&!y){const kt=this.projectAndGetPerspectiveRatio(d,oe.x+1,oe.y,p,U).point.sub(D.point).unit(),Lt=Math.atan(kt.y/kt.x)+(kt.x<0?Math.PI:0),Et=Math.sin(Lt),bt=Math.cos(Lt);Z=new h.P(bt,Et),Q=new h.P(-Et,bt)}else if(!T&&y){const kt=-this.transform.angle,Lt=Math.sin(kt),Et=Math.cos(kt);Z=new h.P(Et,Lt),Q=new h.P(-Lt,Et)}let he=D.point,pe=o;if(y){he=oe;const kt=this.transform.zoom-Math.floor(this.transform.zoom);pe=Math.pow(2,-kt),pe*=this.mapProjection.getPitchedTextCorrection(this.transform,oe,p),$||(pe*=h.ac(.5+D.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}$&&(he=he.add(Z.mult($.x*pe)).add(Q.mult($.y*pe)));const ge=e.x1*pe,ve=e.x2*pe,Se=(ge+ve)/2,me=e.y1*pe,Ae=e.y2*pe,ze=(me+Ae)/2,Ve=[{offsetX:ge,offsetY:me},{offsetX:Se,offsetY:me},{offsetX:ve,offsetY:me},{offsetX:ve,offsetY:ze},{offsetX:ve,offsetY:Ae},{offsetX:Se,offsetY:Ae},{offsetX:ge,offsetY:Ae},{offsetX:ge,offsetY:ze}];let at=[];for(const{offsetX:kt,offsetY:Lt}of Ve)at.push(new h.P(he.x+Z.x*kt+Q.x*Lt,he.y+Z.y*kt+Q.y*Lt));let yt=!1;if(y){const kt=at.map((Lt=>this.projectAndGetPerspectiveRatio(d,Lt.x,Lt.y,p,U)));yt=kt.some((Lt=>!Lt.isOccluded)),at=kt.map((Lt=>Lt.point))}else yt=!0;return{box:h.ao(at),allPointsOccluded:!yt}}}function Sn(_,e,o){return e*(h.X/(_.tileSize*Math.pow(2,o-_.tileID.overscaledZ)))}class pi{constructor(e,o,d,p){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?o:-o))):p&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class ti{constructor(e,o,d,p,y){this.text=new pi(e?e.text:null,o,d,y),this.icon=new pi(e?e.icon:null,o,p,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xn{constructor(e,o,d){this.text=e,this.icon=o,this.skipFade=d}}class Zn{constructor(){this.invProjMatrix=h.H(),this.viewportMatrix=h.H(),this.circles=[]}}class ri{constructor(e,o,d,p,y){this.bucketInstanceId=e,this.featureIndex=o,this.sourceLayerIndex=d,this.bucketIndex=p,this.tileID=y}}class Si{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const o=++this.maxGroupID;this.collisionGroups[e]={ID:o,predicate:d=>d.collisionGroupID===o}}return this.collisionGroups[e]}}function Bn(_,e,o,d,p){const{horizontalAlign:y,verticalAlign:T}=h.au(_);return new h.P(-(y-.5)*e+d[0]*p,-(T-.5)*o+d[1]*p)}class Er{constructor(e,o,d,p,y,T){this.transform=e.clone(),this.terrain=d,this.collisionIndex=new kn(this.transform,o),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Si(y),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=T,T&&(T.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const o=this.terrain;return o?(d,p)=>o.getElevation(e,d,p):null}getBucketParts(e,o,d,p){const y=d.getBucket(o),T=d.latestFeatureIndex;if(!y||!T||o.id!==y.layerIds[0])return;const A=d.collisionBoxArray,D=y.layers[0].layout,U=y.layers[0].paint,$=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),Z=d.tileSize/h.X,Q=d.tileID.toUnwrapped(),oe=this.transform.calculatePosMatrix(Q),he=D.get("text-pitch-alignment")==="map",pe=D.get("text-rotation-alignment")==="map",ge=Sn(d,1,this.transform.zoom),ve=this.collisionIndex.mapProjection.translatePosition(this.transform,d,U.get("text-translate"),U.get("text-translate-anchor")),Se=this.collisionIndex.mapProjection.translatePosition(this.transform,d,U.get("icon-translate"),U.get("icon-translate-anchor")),me=Mi(oe,he,pe,this.transform,ge);let Ae=null;if(he){const Ve=gr(oe,he,pe,this.transform,ge);Ae=h.L([],this.transform.labelPlaneMatrix,Ve)}this.retainedQueryData[y.bucketInstanceId]=new ri(y.bucketInstanceId,T,y.sourceLayerIndex,y.index,d.tileID);const ze={bucket:y,layout:D,translationText:ve,translationIcon:Se,posMatrix:oe,unwrappedTileID:Q,textLabelPlaneMatrix:me,labelToScreenMatrix:Ae,scale:$,textPixelRatio:Z,holdingForFade:d.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:h.ag(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(p)for(const Ve of y.sortKeyRanges){const{sortKey:at,symbolInstanceStart:yt,symbolInstanceEnd:kt}=Ve;e.push({sortKey:at,symbolInstanceStart:yt,symbolInstanceEnd:kt,parameters:ze})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:ze})}attemptAnchorPlacement(e,o,d,p,y,T,A,D,U,$,Z,Q,oe,he,pe,ge,ve,Se,me){const Ae=h.aq[e.textAnchor],ze=[e.textOffset0,e.textOffset1],Ve=Bn(Ae,d,p,ze,y),at=this.collisionIndex.placeCollisionBox(o,Q,D,U,$,A,T,ge,Z.predicate,me,Ve);if((!Se||this.collisionIndex.placeCollisionBox(Se,Q,D,U,$,A,T,ve,Z.predicate,me,Ve).placeable)&&at.placeable){let yt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[oe.crossTileID]&&this.prevPlacement.placements[oe.crossTileID]&&this.prevPlacement.placements[oe.crossTileID].text&&(yt=this.prevPlacement.variableOffsets[oe.crossTileID].anchor),oe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[oe.crossTileID]={textOffset:ze,width:d,height:p,anchor:Ae,textBoxScale:y,prevAnchor:yt},this.markUsedJustification(he,Ae,oe,pe),he.allowVerticalPlacement&&(this.markUsedOrientation(he,pe,oe),this.placedOrientations[oe.crossTileID]=pe),{shift:Ve,placedGlyphBoxes:at}}}placeLayerBucketPart(e,o,d){const{bucket:p,layout:y,translationText:T,translationIcon:A,posMatrix:D,unwrappedTileID:U,textLabelPlaneMatrix:$,labelToScreenMatrix:Z,textPixelRatio:Q,holdingForFade:oe,collisionBoxArray:he,partiallyEvaluatedTextSize:pe,collisionGroup:ge}=e.parameters,ve=y.get("text-optional"),Se=y.get("icon-optional"),me=h.ar(y,"text-overlap","text-allow-overlap"),Ae=me==="always",ze=h.ar(y,"icon-overlap","icon-allow-overlap"),Ve=ze==="always",at=y.get("text-rotation-alignment")==="map",yt=y.get("text-pitch-alignment")==="map",kt=y.get("icon-text-fit")!=="none",Lt=y.get("symbol-z-order")==="viewport-y",Et=Ae&&(Ve||!p.hasIconData()||Se),bt=Ve&&(Ae||!p.hasTextData()||ve);!p.collisionArrays&&he&&p.deserializeCollisionBoxes(he);const Ut=this._getTerrainElevationFunc(this.retainedQueryData[p.bucketInstanceId].tileID),gn=(It,Ct,mn)=>{var li,En;if(o[It.crossTileID])return;if(oe)return void(this.placements[It.crossTileID]=new xn(!1,!1,!1));let Pn=!1,ci=!1,wr=!0,bs=null,hi={box:null,placeable:!1,offscreen:null},or={placeable:!1},wi=null,$i=null,Pr=null,ga=0,is=0,ya=0;Ct.textFeatureIndex?ga=Ct.textFeatureIndex:It.useRuntimeCollisionCircles&&(ga=It.featureIndex),Ct.verticalTextFeatureIndex&&(is=Ct.verticalTextFeatureIndex);const Fo=Ct.textBox;if(Fo){const Wr=Xi=>{let Ci=h.ah.horizontal;if(p.allowVerticalPlacement&&!Xi&&this.prevPlacement){const Mr=this.prevPlacement.placedOrientations[It.crossTileID];Mr&&(this.placedOrientations[It.crossTileID]=Mr,Ci=Mr,this.markUsedOrientation(p,Ci,It))}return Ci},Ss=(Xi,Ci)=>{if(p.allowVerticalPlacement&&It.numVerticalGlyphVertices>0&&Ct.verticalTextBox){for(const Mr of p.writingModes)if(Mr===h.ah.vertical?(hi=Ci(),or=hi):hi=Xi(),hi&&hi.placeable)break}else hi=Xi()},_a=It.textAnchorOffsetStartIndex,Zs=It.textAnchorOffsetEndIndex;if(Zs===_a){const Xi=(Ci,Mr)=>{const Ln=this.collisionIndex.placeCollisionBox(Ci,me,Q,D,U,yt,at,T,ge.predicate,Ut);return Ln&&Ln.placeable&&(this.markUsedOrientation(p,Mr,It),this.placedOrientations[It.crossTileID]=Mr),Ln};Ss((()=>Xi(Fo,h.ah.horizontal)),(()=>{const Ci=Ct.verticalTextBox;return p.allowVerticalPlacement&&It.numVerticalGlyphVertices>0&&Ci?Xi(Ci,h.ah.vertical):{box:null,offscreen:null}})),Wr(hi&&hi.placeable)}else{let Xi=h.aq[(En=(li=this.prevPlacement)===null||li===void 0?void 0:li.variableOffsets[It.crossTileID])===null||En===void 0?void 0:En.anchor];const Ci=(Ln,Es,Bo)=>{const va=Ln.x2-Ln.x1,wc=Ln.y2-Ln.y1,bc=It.textBoxScale,Ni=kt&&ze==="never"?Es:null;let xa=null,Gu=me==="never"?1:2,Ul="never";Xi&&Gu++;for(let jo=0;jo<Gu;jo++){for(let Vl=_a;Vl<Zs;Vl++){const ja=p.textAnchorOffsets.get(Vl);if(Xi&&ja.textAnchor!==Xi)continue;const fi=this.attemptAnchorPlacement(ja,Ln,va,wc,bc,at,yt,Q,D,U,ge,Ul,It,p,Bo,T,A,Ni,Ut);if(fi&&(xa=fi.placedGlyphBoxes,xa&&xa.placeable))return Pn=!0,bs=fi.shift,xa}Xi?Xi=null:Ul=me}return d&&!xa&&(xa={box:this.collisionIndex.placeCollisionBox(Fo,"always",Q,D,U,yt,at,T,ge.predicate,Ut,new h.P(0,0)).box,offscreen:!1,placeable:!1}),xa};Ss((()=>Ci(Fo,Ct.iconBox,h.ah.horizontal)),(()=>{const Ln=Ct.verticalTextBox;return p.allowVerticalPlacement&&(!hi||!hi.placeable)&&It.numVerticalGlyphVertices>0&&Ln?Ci(Ln,Ct.verticalIconBox,h.ah.vertical):{box:null,occluded:!0,offscreen:null}})),hi&&(Pn=hi.placeable,wr=hi.offscreen);const Mr=Wr(hi&&hi.placeable);if(!Pn&&this.prevPlacement){const Ln=this.prevPlacement.variableOffsets[It.crossTileID];Ln&&(this.variableOffsets[It.crossTileID]=Ln,this.markUsedJustification(p,Ln.anchor,It,Mr))}}}if(wi=hi,Pn=wi&&wi.placeable,wr=wi&&wi.offscreen,It.useRuntimeCollisionCircles){const Wr=p.text.placedSymbolArray.get(It.centerJustifiedTextSymbolIndex),Ss=h.ai(p.textSizeData,pe,Wr),_a=y.get("text-padding");$i=this.collisionIndex.placeCollisionCircles(me,Wr,p.lineVertexArray,p.glyphOffsetArray,Ss,D,U,$,Z,d,yt,ge.predicate,It.collisionCircleDiameter,_a,T,Ut),$i.circles.length&&$i.collisionDetected&&!d&&h.w("Collisions detected, but collision boxes are not shown"),Pn=Ae||$i.circles.length>0&&!$i.collisionDetected,wr=wr&&$i.offscreen}if(Ct.iconFeatureIndex&&(ya=Ct.iconFeatureIndex),Ct.iconBox){const Wr=Ss=>this.collisionIndex.placeCollisionBox(Ss,ze,Q,D,U,yt,at,A,ge.predicate,Ut,kt&&bs?bs:void 0);or&&or.placeable&&Ct.verticalIconBox?(Pr=Wr(Ct.verticalIconBox),ci=Pr.placeable):(Pr=Wr(Ct.iconBox),ci=Pr.placeable),wr=wr&&Pr.offscreen}const ks=ve||It.numHorizontalGlyphVertices===0&&It.numVerticalGlyphVertices===0,$s=Se||It.numIconVertices===0;ks||$s?$s?ks||(ci=ci&&Pn):Pn=ci&&Pn:ci=Pn=ci&&Pn;const Ba=ci&&Pr.placeable;if(Pn&&wi.placeable&&this.collisionIndex.insertCollisionBox(wi.box,me,y.get("text-ignore-placement"),p.bucketInstanceId,or&&or.placeable&&is?is:ga,ge.ID),Ba&&this.collisionIndex.insertCollisionBox(Pr.box,ze,y.get("icon-ignore-placement"),p.bucketInstanceId,ya,ge.ID),$i&&Pn&&this.collisionIndex.insertCollisionCircles($i.circles,me,y.get("text-ignore-placement"),p.bucketInstanceId,ga,ge.ID),d&&this.storeCollisionData(p.bucketInstanceId,mn,Ct,wi,Pr,$i),It.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[It.crossTileID]=new xn(Pn||Et,ci||bt,wr||p.justReloaded),o[It.crossTileID]=!0};if(Lt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const It=p.getSortedSymbolIndexes(this.transform.angle);for(let Ct=It.length-1;Ct>=0;--Ct){const mn=It[Ct];gn(p.symbolInstances.get(mn),p.collisionArrays[mn],mn)}}else for(let It=e.symbolInstanceStart;It<e.symbolInstanceEnd;It++)gn(p.symbolInstances.get(It),p.collisionArrays[It],It);if(d&&p.bucketInstanceId in this.collisionCircleArrays){const It=this.collisionCircleArrays[p.bucketInstanceId];h.as(It.invProjMatrix,D),It.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}storeCollisionData(e,o,d,p,y,T){if(d.textBox||d.iconBox){let A,D;this.collisionBoxArrays.has(e)?A=this.collisionBoxArrays.get(e):(A=new Map,this.collisionBoxArrays.set(e,A)),A.has(o)?D=A.get(o):(D={text:null,icon:null},A.set(o,D)),d.textBox&&(D.text=p.box),d.iconBox&&(D.icon=y.box)}if(T){let A=this.collisionCircleArrays[e];A===void 0&&(A=this.collisionCircleArrays[e]=new Zn);for(let D=0;D<T.circles.length;D+=4)A.circles.push(T.circles[D+0]),A.circles.push(T.circles[D+1]),A.circles.push(T.circles[D+2]),A.circles.push(T.collisionDetected?1:0)}}markUsedJustification(e,o,d,p){let y;y=p===h.ah.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[h.at(o)];const T=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const A of T)A>=0&&(e.text.placedSymbolArray.get(A).crossTileID=y>=0&&A!==y?0:d.crossTileID)}markUsedOrientation(e,o,d){const p=o===h.ah.horizontal||o===h.ah.horizontalOnly?o:0,y=o===h.ah.vertical?o:0,T=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const A of T)e.text.placedSymbolArray.get(A).placedOrientation=p;d.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let d=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const p=o?o.symbolFadeChange(e):1,y=o?o.opacities:{},T=o?o.variableOffsets:{},A=o?o.placedOrientations:{};for(const D in this.placements){const U=this.placements[D],$=y[D];$?(this.opacities[D]=new ti($,p,U.text,U.icon),d=d||U.text!==$.text.placed||U.icon!==$.icon.placed):(this.opacities[D]=new ti(null,p,U.text,U.icon,U.skipFade),d=d||U.text||U.icon)}for(const D in y){const U=y[D];if(!this.opacities[D]){const $=new ti(U,p,!1,!1);$.isHidden()||(this.opacities[D]=$,d=d||U.text.placed||U.icon.placed)}}for(const D in T)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=T[D]);for(const D in A)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=A[D]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:e)}updateLayerOpacities(e,o){const d={};for(const p of o){const y=p.getBucket(e);y&&p.latestFeatureIndex&&e.id===y.layerIds[0]&&this.updateBucketOpacities(y,p.tileID,d,p.collisionBoxArray)}}updateBucketOpacities(e,o,d,p){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const y=e.layers[0],T=y.layout,A=new ti(null,0,!1,!1,!0),D=T.get("text-allow-overlap"),U=T.get("icon-allow-overlap"),$=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Z=T.get("text-rotation-alignment")==="map",Q=T.get("text-pitch-alignment")==="map",oe=T.get("icon-text-fit")!=="none",he=new ti(null,0,D&&(U||!e.hasIconData()||T.get("icon-optional")),U&&(D||!e.hasTextData()||T.get("text-optional")),!0);!e.collisionArrays&&p&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(p);const pe=(ve,Se,me)=>{for(let Ae=0;Ae<Se/4;Ae++)ve.opacityVertexArray.emplaceBack(me);ve.hasVisibleVertices=ve.hasVisibleVertices||me!==sr},ge=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ve=0;ve<e.symbolInstances.length;ve++){const Se=e.symbolInstances.get(ve),{numHorizontalGlyphVertices:me,numVerticalGlyphVertices:Ae,crossTileID:ze}=Se;let Ve=this.opacities[ze];d[ze]?Ve=A:Ve||(Ve=he,this.opacities[ze]=Ve),d[ze]=!0;const at=Se.numIconVertices>0,yt=this.placedOrientations[Se.crossTileID],kt=yt===h.ah.vertical,Lt=yt===h.ah.horizontal||yt===h.ah.horizontalOnly;if(me>0||Ae>0){const bt=Fi(Ve.text);pe(e.text,me,kt?sr:bt),pe(e.text,Ae,Lt?sr:bt);const Ut=Ve.text.isHidden();[Se.rightJustifiedTextSymbolIndex,Se.centerJustifiedTextSymbolIndex,Se.leftJustifiedTextSymbolIndex].forEach((Ct=>{Ct>=0&&(e.text.placedSymbolArray.get(Ct).hidden=Ut||kt?1:0)})),Se.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Se.verticalPlacedTextSymbolIndex).hidden=Ut||Lt?1:0);const gn=this.variableOffsets[Se.crossTileID];gn&&this.markUsedJustification(e,gn.anchor,Se,yt);const It=this.placedOrientations[Se.crossTileID];It&&(this.markUsedJustification(e,"left",Se,It),this.markUsedOrientation(e,It,Se))}if(at){const bt=Fi(Ve.icon),Ut=!(oe&&Se.verticalPlacedIconSymbolIndex&&kt);Se.placedIconSymbolIndex>=0&&(pe(e.icon,Se.numIconVertices,Ut?bt:sr),e.icon.placedSymbolArray.get(Se.placedIconSymbolIndex).hidden=Ve.icon.isHidden()),Se.verticalPlacedIconSymbolIndex>=0&&(pe(e.icon,Se.numVerticalIconVertices,Ut?sr:bt),e.icon.placedSymbolArray.get(Se.verticalPlacedIconSymbolIndex).hidden=Ve.icon.isHidden())}const Et=ge&&ge.has(ve)?ge.get(ve):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const bt=e.collisionArrays[ve];if(bt){let Ut=new h.P(0,0);if(bt.textBox||bt.verticalTextBox){let gn=!0;if($){const It=this.variableOffsets[ze];It?(Ut=Bn(It.anchor,It.width,It.height,It.textOffset,It.textBoxScale),Z&&Ut._rotate(Q?this.transform.angle:-this.transform.angle)):gn=!1}if(bt.textBox||bt.verticalTextBox){let It;bt.textBox&&(It=kt),bt.verticalTextBox&&(It=Lt),Co(e.textCollisionBox.collisionVertexArray,Ve.text.placed,!gn||It,Et.text,Ut.x,Ut.y)}}if(bt.iconBox||bt.verticalIconBox){const gn=!!(!Lt&&bt.verticalIconBox);let It;bt.iconBox&&(It=gn),bt.verticalIconBox&&(It=!gn),Co(e.iconCollisionBox.collisionVertexArray,Ve.icon.placed,It,Et.icon,oe?Ut.x:0,oe?Ut.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const ve=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=ve.invProjMatrix,e.placementViewportMatrix=ve.viewportMatrix,e.collisionCircleArray=ve.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,o){const d=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*d>e}setStale(){this.stale=!0}}function Co(_,e,o,d,p,y){d&&d.length!==0||(d=[0,0,0,0]);const T=d[0]-bn,A=d[1]-bn,D=d[2]-bn,U=d[3]-bn;_.emplaceBack(e?1:0,o?1:0,p||0,y||0,T,A),_.emplaceBack(e?1:0,o?1:0,p||0,y||0,D,A),_.emplaceBack(e?1:0,o?1:0,p||0,y||0,D,U),_.emplaceBack(e?1:0,o?1:0,p||0,y||0,T,U)}const hn=Math.pow(2,25),Za=Math.pow(2,24),Ha=Math.pow(2,17),yr=Math.pow(2,16),rr=Math.pow(2,9),hc=Math.pow(2,8),Ei=Math.pow(2,1);function Fi(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const e=_.placed?1:0,o=Math.floor(127*_.opacity);return o*hn+e*Za+o*Ha+e*yr+o*rr+e*hc+o*Ei+e}const sr=0;function Qr(){return{isOccluded:(_,e,o)=>!1,getPitchedTextCorrection:(_,e,o)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(_,e,o,d){throw new Error("Not implemented.")},translatePosition:(_,e,o,d)=>(function(p,y,T,A,D=!1){if(!T[0]&&!T[1])return[0,0];const U=D?A==="map"?p.angle:0:A==="viewport"?-p.angle:0;if(U){const $=Math.sin(U),Z=Math.cos(U);T=[T[0]*Z-T[1]*$,T[0]*$+T[1]*Z]}return[D?T[0]:Sn(y,T[0],p.zoom),D?T[1]:Sn(y,T[1],p.zoom)]})(_,e,o,d),getCircleRadiusCorrection:_=>1}}class Xn{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,o,d,p,y){const T=this._bucketParts;for(;this._currentTileIndex<e.length;)if(o.getBucketParts(T,p,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort(((A,D)=>A.sortKey-D.sortKey)));this._currentPartIndex<T.length;)if(o.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,y())return!0;return!1}}class Xo{constructor(e,o,d,p,y,T,A,D){this.placement=new Er(e,Qr(),o,T,A,D),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(e,o,d){const p=B.now(),y=()=>!this._forceFullPlacement&&B.now()-p>2;for(;this._currentPlacementIndex>=0;){const T=o[e[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=A)&&(!T.maxzoom||T.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Xn(T)),this._inProgressLayer.continuePlacement(d[T.source],this.placement,this._showCollisionBoxes,T,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ms=512/h.X/2;class Bi{constructor(e,o,d){this.tileID=e,this.bucketInstanceId=d,this._symbolsByKey={};const p=new Map;for(let y=0;y<o.length;y++){const T=o.get(y),A=T.key,D=p.get(A);D?D.push(T):p.set(A,[T])}for(const[y,T]of p){const A={positions:T.map((D=>({x:Math.floor(D.anchorX*ms),y:Math.floor(D.anchorY*ms)}))),crossTileIDs:T.map((D=>D.crossTileID))};if(A.positions.length>128){const D=new h.av(A.positions.length,16,Uint16Array);for(const{x:U,y:$}of A.positions)D.add(U,$);D.finish(),delete A.positions,A.index=D}this._symbolsByKey[y]=A}}getScaledCoordinates(e,o){const{x:d,y:p,z:y}=this.tileID.canonical,{x:T,y:A,z:D}=o.canonical,U=ms/Math.pow(2,D-y),$=(A*h.X+e.anchorY)*U,Z=p*h.X*ms;return{x:Math.floor((T*h.X+e.anchorX)*U-d*h.X*ms),y:Math.floor($-Z)}}findMatches(e,o,d){const p=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let y=0;y<e.length;y++){const T=e.get(y);if(T.crossTileID)continue;const A=this._symbolsByKey[T.key];if(!A)continue;const D=this.getScaledCoordinates(T,o);if(A.index){const U=A.index.range(D.x-p,D.y-p,D.x+p,D.y+p).sort();for(const $ of U){const Z=A.crossTileIDs[$];if(!d[Z]){d[Z]=!0,T.crossTileID=Z;break}}}else if(A.positions)for(let U=0;U<A.positions.length;U++){const $=A.positions[U],Z=A.crossTileIDs[U];if(Math.abs($.x-D.x)<=p&&Math.abs($.y-D.y)<=p&&!d[Z]){d[Z]=!0,T.crossTileID=Z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class Ma{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ir{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const o=Math.round((e-this.lng)/360);if(o!==0)for(const d in this.indexes){const p=this.indexes[d],y={};for(const T in p){const A=p[T];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+o),y[A.tileID.key]=A}this.indexes[d]=y}this.lng=e}addBucket(e,o,d){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let y=0;y<o.symbolInstances.length;y++)o.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const p=this.usedCrossTileIDs[e.overscaledZ];for(const y in this.indexes){const T=this.indexes[y];if(Number(y)>e.overscaledZ)for(const A in T){const D=T[A];D.tileID.isChildOf(e)&&D.findMatches(o.symbolInstances,e,p)}else{const A=T[e.scaledTo(Number(y)).key];A&&A.findMatches(o.symbolInstances,e,p)}}for(let y=0;y<o.symbolInstances.length;y++){const T=o.symbolInstances.get(y);T.crossTileID||(T.crossTileID=d.generate(),p[T.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Bi(e,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(e,o){for(const d of o.getCrossTileIDsLists())for(const p of d)delete this.usedCrossTileIDs[e][p]}removeStaleBuckets(e){let o=!1;for(const d in this.indexes){const p=this.indexes[d];for(const y in p)e[p[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,p[y]),delete p[y],o=!0)}return o}}class Ls{constructor(){this.layerIndexes={},this.crossTileIDs=new Ma,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,o,d){let p=this.layerIndexes[e.id];p===void 0&&(p=this.layerIndexes[e.id]=new Ir);let y=!1;const T={};p.handleWrapJump(d);for(const A of o){const D=A.getBucket(e);D&&e.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(A.tileID,D,this.crossTileIDs)&&(y=!0),T[D.bucketInstanceId]=!0)}return p.removeStaleBuckets(T)&&(y=!0),y}pruneUnusedLayers(e){const o={};e.forEach((d=>{o[d]=!0}));for(const d in this.layerIndexes)o[d]||delete this.layerIndexes[d]}}const Ai=(_,e)=>h.t(_,e&&e.filter((o=>o.identifier!=="source.canvas"))),Aa=h.aw();class Wo extends h.E{constructor(e,o={}){super(),this._rtlPluginLoaded=()=>{for(const d in this.sourceCaches){const p=this.sourceCaches[d].getSource().type;p!=="vector"&&p!=="geojson"||this.sourceCaches[d].reload()}},this.map=e,this.dispatcher=new Cn(ei(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((d,p)=>this.getGlyphs(d,p))),this.dispatcher.registerMessageHandler("GI",((d,p)=>this.getImages(d,p))),this.imageManager=new Vt,this.imageManager.setEventedParent(this),this.glyphManager=new rn(e._requestManager,o.localIdeographFontFamily),this.lineAtlas=new an(256,512),this.crossTileSymbolIndex=new Ls,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",h.ay()),tn().on(Je,this._rtlPluginLoaded),this.on("data",(d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const p=this.sourceCaches[d.sourceId];if(!p)return;const y=p.getSource();if(y&&y.vectorLayerIds)for(const T in this._layers){const A=this._layers[T];A.source===y.id&&this._validateLayer(A)}}))}loadURL(e,o={},d){this.fire(new h.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const p=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;h.h(p,this._loadStyleRequest).then((T=>{this._loadStyleRequest=null,this._load(T.data,o,d)})).catch((T=>{this._loadStyleRequest=null,T&&!y.signal.aborted&&this.fire(new h.j(T))}))}loadJSON(e,o={},d){this.fire(new h.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,B.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(e,o,d)})).catch((()=>{}))}loadEmpty(){this.fire(new h.k("dataloading",{dataType:"style"})),this._load(Aa,{validate:!1})}_load(e,o,d){var p;const y=o.transformStyle?o.transformStyle(d,e):e;if(!o.validate||!Ai(this,h.u(y))){this._loaded=!0,this.stylesheet=y;for(const T in y.sources)this.addSource(T,y.sources[T],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new et(this.stylesheet.light),this.sky=new rt(this.stylesheet.sky),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.fire(new h.k("data",{dataType:"style"})),this.fire(new h.k("style.load"))}}_createLayers(){const e=h.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((o=>o.id)),this._layers={},this._serializedLayers=null;for(const o of e){const d=h.aA(o);d.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=d}}_loadSprite(e,o=!1,d=void 0){let p;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(y,T,A,D){return h._(this,void 0,void 0,(function*(){const U=mt(y),$=A>1?"@2x":"",Z={},Q={};for(const{id:oe,url:he}of U){const pe=T.transformRequest(Kt(he,$,".json"),"SpriteJSON");Z[oe]=h.h(pe,D);const ge=T.transformRequest(Kt(he,$,".png"),"SpriteImage");Q[oe]=qe.getImage(ge,D)}return yield Promise.all([...Object.values(Z),...Object.values(Q)]),(function(oe,he){return h._(this,void 0,void 0,(function*(){const pe={};for(const ge in oe){pe[ge]={};const ve=B.getImageCanvasContext((yield he[ge]).data),Se=(yield oe[ge]).data;for(const me in Se){const{width:Ae,height:ze,x:Ve,y:at,sdf:yt,pixelRatio:kt,stretchX:Lt,stretchY:Et,content:bt,textFitWidth:Ut,textFitHeight:gn}=Se[me];pe[ge][me]={data:null,pixelRatio:kt,sdf:yt,stretchX:Lt,stretchY:Et,content:bt,textFitWidth:Ut,textFitHeight:gn,spriteData:{width:Ae,height:ze,x:Ve,y:at,context:ve}}}}return pe}))})(Z,Q)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((y=>{if(this._spriteRequest=null,y)for(const T in y){this._spritesImagesIds[T]=[];const A=this._spritesImagesIds[T]?this._spritesImagesIds[T].filter((D=>!(D in y))):[];for(const D of A)this.imageManager.removeImage(D),this._changedImages[D]=!0;for(const D in y[T]){const U=T==="default"?D:`${T}:${D}`;this._spritesImagesIds[T].push(U),U in this.imageManager.images?this.imageManager.updateImage(U,y[T][D],!1):this.imageManager.addImage(U,y[T][D]),o&&(this._changedImages[U]=!0)}}})).catch((y=>{this._spriteRequest=null,p=y,this.fire(new h.j(p))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"})),d&&d(p)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}_validateLayer(e){const o=this.sourceCaches[e.source];if(!o)return;const d=e.sourceLayer;if(!d)return;const p=o.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(d)===-1)&&this.fire(new h.j(new Error(`Source layer "${d}" does not exist on source "${p.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,o=!1){const d=this._serializedAllLayers();if(!e||e.length===0)return Object.values(o?h.aB(d):d);const p=[];for(const y of e)if(d[y]){const T=o?h.aB(d[y]):d[y];p.push(T)}return p}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const o=Object.keys(this._layers);for(const d of o){const p=this._layers[d];p.type!=="custom"&&(e[d]=p.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const o=this._changed;if(o){const p=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(p.length||y.length)&&this._updateWorkerLayers(p,y);for(const T in this._updatedSources){const A=this._updatedSources[T];if(A==="reload")this._reloadSource(T);else{if(A!=="clear")throw new Error(`Invalid action ${A}`);this._clearSource(T)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const d={};for(const p in this.sourceCaches){const y=this.sourceCaches[p];d[p]=y.used,y.used=!1}for(const p of this._order){const y=this._layers[p];y.recalculate(e,this._availableImages),!y.isHidden(e.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const p in d){const y=this.sourceCaches[p];!!d[p]!=!!y.used&&y.fire(new h.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,o&&this.fire(new h.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,o={}){var d;this._checkLoaded();const p=this.serialize();if(e=o.transformStyle?o.transformStyle(p,e):e,((d=o.validate)===null||d===void 0||d)&&Ai(this,h.u(e)))return!1;(e=h.aB(e)).layers=h.az(e.layers);const y=h.aC(p,e),T=this._getOperationsToPerform(y);if(T.unimplemented.length>0)throw new Error(`Unimplemented: ${T.unimplemented.join(", ")}.`);if(T.operations.length===0)return!1;for(const A of T.operations)A();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const o=[],d=[];for(const p of e)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":o.push((()=>this.addLayer.apply(this,p.args)));break;case"removeLayer":o.push((()=>this.removeLayer.apply(this,p.args)));break;case"setPaintProperty":o.push((()=>this.setPaintProperty.apply(this,p.args)));break;case"setLayoutProperty":o.push((()=>this.setLayoutProperty.apply(this,p.args)));break;case"setFilter":o.push((()=>this.setFilter.apply(this,p.args)));break;case"addSource":o.push((()=>this.addSource.apply(this,p.args)));break;case"removeSource":o.push((()=>this.removeSource.apply(this,p.args)));break;case"setLayerZoomRange":o.push((()=>this.setLayerZoomRange.apply(this,p.args)));break;case"setLight":o.push((()=>this.setLight.apply(this,p.args)));break;case"setGeoJSONSourceData":o.push((()=>this.setGeoJSONSourceData.apply(this,p.args)));break;case"setGlyphs":o.push((()=>this.setGlyphs.apply(this,p.args)));break;case"setSprite":o.push((()=>this.setSprite.apply(this,p.args)));break;case"setSky":o.push((()=>this.setSky.apply(this,p.args)));break;case"setTerrain":o.push((()=>this.map.setTerrain.apply(this,p.args)));break;case"setTransition":o.push((()=>{}));break;default:d.push(p.command)}return{operations:o,unimplemented:d}}addImage(e,o){if(this.getImage(e))return this.fire(new h.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,o),this._afterImageUpdated(e)}updateImage(e,o){this.imageManager.updateImage(e,o)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new h.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,o,d={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(h.u.source,`sources.${e}`,o,null,d))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const p=this.sourceCaches[e]=new dt(e,o,this.dispatcher);p.style=this,p.setEventedParent(this,(()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:e}))),p.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===e)return this.fire(new h.j(new Error(`Source "${e}" cannot be removed while layer "${d}" is using it.`)));const o=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],o.fire(new h.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,o){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const d=this.sourceCaches[e].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(o),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,o,d={}){this._checkLoaded();const p=e.id;if(this.getLayer(p))return void this.fire(new h.j(new Error(`Layer "${p}" already exists on this map.`)));let y;if(e.type==="custom"){if(Ai(this,h.aD(e)))return;y=h.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(p,e.source),e=h.aB(e),e=h.e(e,{source:p})),this._validate(h.u.layer,`layers.${p}`,e,{arrayIndex:-1},d))return;y=h.aA(e),this._validateLayer(y),y.setEventedParent(this,{layer:{id:p}})}const T=o?this._order.indexOf(o):this._order.length;if(o&&T===-1)this.fire(new h.j(new Error(`Cannot add layer "${p}" before non-existing layer "${o}".`)));else{if(this._order.splice(T,0,p),this._layerOrderChanged=!0,this._layers[p]=y,this._removedLayers[p]&&y.source&&y.type!=="custom"){const A=this._removedLayers[p];delete this._removedLayers[p],A.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(e,o){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new h.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===o)return;const d=this._order.indexOf(e);this._order.splice(d,1);const p=o?this._order.indexOf(o):this._order.length;o&&p===-1?this.fire(new h.j(new Error(`Cannot move layer "${e}" before non-existing layer "${o}".`))):(this._order.splice(p,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const o=this._layers[e];if(!o)return void this.fire(new h.j(new Error(`Cannot remove non-existing layer "${e}".`)));o.setEventedParent(null);const d=this._order.indexOf(e);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=o,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],o.onRemove&&o.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,o,d){this._checkLoaded();const p=this.getLayer(e);p?p.minzoom===o&&p.maxzoom===d||(o!=null&&(p.minzoom=o),d!=null&&(p.maxzoom=d),this._updateLayer(p)):this.fire(new h.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,o,d={}){this._checkLoaded();const p=this.getLayer(e);if(p){if(!h.aE(p.filter,o))return o==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(h.u.filter,`layers.${p.id}.filter`,o,null,d)||(p.filter=h.aB(o),this._updateLayer(p)))}else this.fire(new h.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return h.aB(this.getLayer(e).filter)}setLayoutProperty(e,o,d,p={}){this._checkLoaded();const y=this.getLayer(e);y?h.aE(y.getLayoutProperty(o),d)||(y.setLayoutProperty(o,d,p),this._updateLayer(y)):this.fire(new h.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,o){const d=this.getLayer(e);if(d)return d.getLayoutProperty(o);this.fire(new h.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,o,d,p={}){this._checkLoaded();const y=this.getLayer(e);y?h.aE(y.getPaintProperty(o),d)||(y.setPaintProperty(o,d,p)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new h.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,o){return this.getLayer(e).getPaintProperty(o)}setFeatureState(e,o){this._checkLoaded();const d=e.source,p=e.sourceLayer,y=this.sourceCaches[d];if(y===void 0)return void this.fire(new h.j(new Error(`The source '${d}' does not exist in the map's style.`)));const T=y.getSource().type;T==="geojson"&&p?this.fire(new h.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||p?(e.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(p,e.id,o)):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,o){this._checkLoaded();const d=e.source,p=this.sourceCaches[d];if(p===void 0)return void this.fire(new h.j(new Error(`The source '${d}' does not exist in the map's style.`)));const y=p.getSource().type,T=y==="vector"?e.sourceLayer:void 0;y!=="vector"||T?o&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new h.j(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(T,e.id,o):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const o=e.source,d=e.sourceLayer,p=this.sourceCaches[o];if(p!==void 0)return p.getSource().type!=="vector"||d?(e.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),p.getFeatureState(d,e.id)):void this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=h.aF(this.sourceCaches,(y=>y.serialize())),o=this._serializeByIds(this._order,!0),d=this.map.getTerrain()||void 0,p=this.stylesheet;return h.aG({version:p.version,name:p.name,metadata:p.metadata,light:p.light,sky:p.sky,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,sources:e,layers:o,terrain:d},(y=>y!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const o=T=>this._layers[T].type==="fill-extrusion",d={},p=[];for(let T=this._order.length-1;T>=0;T--){const A=this._order[T];if(o(A)){d[A]=T;for(const D of e){const U=D[A];if(U)for(const $ of U)p.push($)}}}p.sort(((T,A)=>A.intersectionZ-T.intersectionZ));const y=[];for(let T=this._order.length-1;T>=0;T--){const A=this._order[T];if(o(A))for(let D=p.length-1;D>=0;D--){const U=p[D].feature;if(d[U.layer.id]<T)break;y.push(U),p.pop()}else for(const D of e){const U=D[A];if(U)for(const $ of U)y.push($.feature)}}return y}queryRenderedFeatures(e,o,d){o&&o.filter&&this._validate(h.u.filter,"queryRenderedFeatures.filter",o.filter,null,o);const p={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new h.j(new Error("parameters.layers must be an Array."))),[];for(const A of o.layers){const D=this._layers[A];if(!D)return this.fire(new h.j(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];p[D.source]=!0}}const y=[];o.availableImages=this._availableImages;const T=this._serializedAllLayers();for(const A in this.sourceCaches)o.layers&&!p[A]||y.push(Gi(this.sourceCaches[A],this._layers,T,e,o,d));return this.placement&&y.push((function(A,D,U,$,Z,Q,oe){const he={},pe=Q.queryRenderedSymbols($),ge=[];for(const ve of Object.keys(pe).map(Number))ge.push(oe[ve]);ge.sort(Ur);for(const ve of ge){const Se=ve.featureIndex.lookupSymbolFeatures(pe[ve.bucketInstanceId],D,ve.bucketIndex,ve.sourceLayerIndex,Z.filter,Z.layers,Z.availableImages,A);for(const me in Se){const Ae=he[me]=he[me]||[],ze=Se[me];ze.sort(((Ve,at)=>{const yt=ve.featureSortOrder;if(yt){const kt=yt.indexOf(Ve.featureIndex);return yt.indexOf(at.featureIndex)-kt}return at.featureIndex-Ve.featureIndex}));for(const Ve of ze)Ae.push(Ve)}}for(const ve in he)he[ve].forEach((Se=>{const me=Se.feature,Ae=U[A[ve].source].getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=Ae}));return he})(this._layers,T,this.sourceCaches,e,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(e,o){o&&o.filter&&this._validate(h.u.filter,"querySourceFeatures.filter",o.filter,null,o);const d=this.sourceCaches[e];return d?(function(p,y){const T=p.getRenderableIds().map((U=>p.getTileByID(U))),A=[],D={};for(let U=0;U<T.length;U++){const $=T[U],Z=$.tileID.canonical.key;D[Z]||(D[Z]=!0,$.querySourceFeatures(A,y))}return A})(d,o):[]}getLight(){return this.light.getLight()}setLight(e,o={}){this._checkLoaded();const d=this.light.getLight();let p=!1;for(const T in e)if(!h.aE(e[T],d[T])){p=!0;break}if(!p)return;const y={now:B.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,o),this.light.updateTransitions(y)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,o={}){const d=this.getSky();let p=!1;if(!e&&!d)return;if(e&&!d)p=!0;else if(!e&&d)p=!0;else for(const T in e)if(!h.aE(e[T],d[T])){p=!0;break}if(!p)return;const y={now:B.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,o),this.sky.updateTransitions(y)}_validate(e,o,d,p,y={}){return(!y||y.validate!==!1)&&Ai(this,e.call(h.u,h.e({key:o,style:this.serialize(),value:d,styleSpec:h.v},p)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),tn().off(Je,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const d=this.sourceCaches[o];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const o in this.sourceCaches)this.sourceCaches[o].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,o,d,p,y=!1){let T=!1,A=!1;const D={};for(const U of this._order){const $=this._layers[U];if($.type!=="symbol")continue;if(!D[$.source]){const Q=this.sourceCaches[$.source];D[$.source]=Q.getRenderableIds(!0).map((oe=>Q.getTileByID(oe))).sort(((oe,he)=>he.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(he.tileID)?-1:1)))}const Z=this.crossTileSymbolIndex.addLayer($,D[$.source],e.center.lng);T=T||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(B.now(),e.zoom))&&(this.pauseablePlacement=new Xo(e,this.map.terrain,this._order,y,o,d,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(B.now()),A=!0),T&&this.pauseablePlacement.placement.setStale()),A||T)for(const U of this._order){const $=this._layers[U];$.type==="symbol"&&this.placement.updateLayerOpacities($,D[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(B.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,o){return h._(this,void 0,void 0,(function*(){const d=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const p=this.sourceCaches[o.source];return p&&p.setDependencies(o.tileID.key,o.type,o.icons),d}))}getGlyphs(e,o){return h._(this,void 0,void 0,(function*(){const d=yield this.glyphManager.getGlyphs(o.stacks),p=this.sourceCaches[o.source];return p&&p.setDependencies(o.tileID.key,o.type,[""]),d}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,o={}){this._checkLoaded(),e&&this._validate(h.u.glyphs,"glyphs",e,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,o,d={},p){this._checkLoaded();const y=[{id:e,url:o}],T=[...mt(this.stylesheet.sprite),...y];this._validate(h.u.sprite,"sprite",T,null,d)||(this.stylesheet.sprite=T,this._loadSprite(y,!0,p))}removeSprite(e){this._checkLoaded();const o=mt(this.stylesheet.sprite);if(o.find((d=>d.id===e))){if(this._spritesImagesIds[e])for(const d of this._spritesImagesIds[e])this.imageManager.removeImage(d),this._changedImages[d]=!0;o.splice(o.findIndex((d=>d.id===e)),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}else this.fire(new h.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return mt(this.stylesheet.sprite)}setSprite(e,o={},d){this._checkLoaded(),e&&this._validate(h.u.sprite,"sprite",e,null,o)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,d):(this._unloadSprite(),d&&d(null)))}}var Nr=h.Y([{name:"a_pos",type:"Int16",components:2}]);const oa={prelude:Vn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Vn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Vn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Vn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Vn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Vn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Vn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Vn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Vn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Vn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Vn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Vn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Vn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Vn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Vn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Vn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Vn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Vn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Vn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Vn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Vn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Vn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Vn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Vn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Vn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Vn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Vn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Vn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Vn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Vn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Vn(_,e){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=e.match(/attribute ([\w]+) ([\w]+)/g),p=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=y?y.concat(p):p,A={};return{fragmentSource:_=_.replace(o,((D,U,$,Z,Q)=>(A[Q]=!0,U==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
varying ${$} ${Z} ${Q};
#else
uniform ${$} ${Z} u_${Q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Q}
    ${$} ${Z} ${Q} = u_${Q};
#endif
`))),vertexSource:e=e.replace(o,((D,U,$,Z,Q)=>{const oe=Z==="float"?"vec2":"vec4",he=Q.match(/color/)?"color":oe;return A[Q]?U==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
attribute ${$} ${oe} a_${Q};
varying ${$} ${Z} ${Q};
#else
uniform ${$} ${Z} u_${Q};
#endif
`:he==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = a_${Q};
#else
    ${$} ${Z} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = unpack_mix_${he}(a_${Q}, u_${Q}_t);
#else
    ${$} ${Z} ${Q} = u_${Q};
#endif
`:U==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
attribute ${$} ${oe} a_${Q};
#else
uniform ${$} ${Z} u_${Q};
#endif
`:he==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${$} ${Z} ${Q} = a_${Q};
#else
    ${$} ${Z} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${$} ${Z} ${Q} = unpack_mix_${he}(a_${Q}, u_${Q}_t);
#else
    ${$} ${Z} ${Q} = u_${Q};
#endif
`})),staticAttributes:d,staticUniforms:T}}class Xa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,o,d,p,y,T,A,D,U){this.context=e;let $=this.boundPaintVertexBuffers.length!==p.length;for(let Z=0;!$&&Z<p.length;Z++)this.boundPaintVertexBuffers[Z]!==p[Z]&&($=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==d||$||this.boundIndexBuffer!==y||this.boundVertexOffset!==T||this.boundDynamicVertexBuffer!==A||this.boundDynamicVertexBuffer2!==D||this.boundDynamicVertexBuffer3!==U?this.freshBind(o,d,p,y,T,A,D,U):(e.bindVertexArray.set(this.vao),A&&A.bind(),y&&y.dynamicDraw&&y.bind(),D&&D.bind(),U&&U.bind())}freshBind(e,o,d,p,y,T,A,D){const U=e.numAttributes,$=this.context,Z=$.gl;this.vao&&this.destroy(),this.vao=$.createVertexArray(),$.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=p,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=A,this.boundDynamicVertexBuffer3=D,o.enableAttributes(Z,e);for(const Q of d)Q.enableAttributes(Z,e);T&&T.enableAttributes(Z,e),A&&A.enableAttributes(Z,e),D&&D.enableAttributes(Z,e),o.bind(),o.setVertexAttribPointers(Z,e,y);for(const Q of d)Q.bind(),Q.setVertexAttribPointers(Z,e,y);T&&(T.bind(),T.setVertexAttribPointers(Z,e,y)),p&&p.bind(),A&&(A.bind(),A.setVertexAttribPointers(Z,e,y)),D&&(D.bind(),D.setVertexAttribPointers(Z,e,y)),$.currentNumAttributes=U}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const au=(_,e,o,d,p)=>({u_matrix:_,u_texture:0,u_ele_delta:e,u_fog_matrix:o,u_fog_color:d?d.properties.get("fog-color"):h.aM.white,u_fog_ground_blend:d?d.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:d?d.calculateFogBlendOpacity(p):0,u_horizon_color:d?d.properties.get("horizon-color"):h.aM.white,u_horizon_fog_blend:d?d.properties.get("horizon-fog-blend"):1});function la(_){const e=[];for(let o=0;o<_.length;o++){if(_[o]===null)continue;const d=_[o].split(" ");e.push(d.pop())}return e}class qn{constructor(e,o,d,p,y,T){const A=e.gl;this.program=A.createProgram();const D=la(o.staticAttributes),U=d?d.getBinderAttributes():[],$=D.concat(U),Z=oa.prelude.staticUniforms?la(oa.prelude.staticUniforms):[],Q=o.staticUniforms?la(o.staticUniforms):[],oe=d?d.getBinderUniforms():[],he=Z.concat(Q).concat(oe),pe=[];for(const Ve of he)pe.indexOf(Ve)<0&&pe.push(Ve);const ge=d?d.defines():[];y&&ge.push("#define OVERDRAW_INSPECTOR;"),T&&ge.push("#define TERRAIN3D;");const ve=ge.concat(oa.prelude.fragmentSource,o.fragmentSource).join(`
`),Se=ge.concat(oa.prelude.vertexSource,o.vertexSource).join(`
`),me=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(me,ve),A.compileShader(me),!A.getShaderParameter(me,A.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${A.getShaderInfoLog(me)}`);A.attachShader(this.program,me);const Ae=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(Ae,Se),A.compileShader(Ae),!A.getShaderParameter(Ae,A.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${A.getShaderInfoLog(Ae)}`);A.attachShader(this.program,Ae),this.attributes={};const ze={};this.numAttributes=$.length;for(let Ve=0;Ve<this.numAttributes;Ve++)$[Ve]&&(A.bindAttribLocation(this.program,Ve,$[Ve]),this.attributes[$[Ve]]=Ve);if(A.linkProgram(this.program),!A.getProgramParameter(this.program,A.LINK_STATUS))throw new Error(`Program failed to link: ${A.getProgramInfoLog(this.program)}`);A.deleteShader(Ae),A.deleteShader(me);for(let Ve=0;Ve<pe.length;Ve++){const at=pe[Ve];if(at&&!ze[at]){const yt=A.getUniformLocation(this.program,at);yt&&(ze[at]=yt)}}this.fixedUniforms=p(e,ze),this.terrainUniforms=((Ve,at)=>({u_depth:new h.aH(Ve,at.u_depth),u_terrain:new h.aH(Ve,at.u_terrain),u_terrain_dim:new h.aI(Ve,at.u_terrain_dim),u_terrain_matrix:new h.aJ(Ve,at.u_terrain_matrix),u_terrain_unpack:new h.aK(Ve,at.u_terrain_unpack),u_terrain_exaggeration:new h.aI(Ve,at.u_terrain_exaggeration)}))(e,ze),this.binderUniforms=d?d.getUniforms(e,ze):[]}draw(e,o,d,p,y,T,A,D,U,$,Z,Q,oe,he,pe,ge,ve,Se){const me=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(d),e.setStencilMode(p),e.setColorMode(y),e.setCullFace(T),D){e.activeTexture.set(me.TEXTURE2),me.bindTexture(me.TEXTURE_2D,D.depthTexture),e.activeTexture.set(me.TEXTURE3),me.bindTexture(me.TEXTURE_2D,D.texture);for(const ze in this.terrainUniforms)this.terrainUniforms[ze].set(D[ze])}for(const ze in this.fixedUniforms)this.fixedUniforms[ze].set(A[ze]);pe&&pe.setUniforms(e,this.binderUniforms,oe,{zoom:he});let Ae=0;switch(o){case me.LINES:Ae=2;break;case me.TRIANGLES:Ae=3;break;case me.LINE_STRIP:Ae=1}for(const ze of Q.get()){const Ve=ze.vaos||(ze.vaos={});(Ve[U]||(Ve[U]=new Xa)).bind(e,this,$,pe?pe.getPaintVertexBuffers():[],Z,ze.vertexOffset,ge,ve,Se),me.drawElements(o,ze.primitiveLength*Ae,me.UNSIGNED_SHORT,ze.primitiveOffset*Ae*2)}}}function Po(_,e,o){const d=1/Sn(o,1,e.transform.tileZoom),p=Math.pow(2,o.tileID.overscaledZ),y=o.tileSize*Math.pow(2,e.transform.tileZoom)/p,T=y*(o.tileID.canonical.x+o.tileID.wrap*p),A=y*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[d,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[T>>16,A>>16],u_pixel_coord_lower:[65535&T,65535&A]}}const Mo=(_,e,o,d)=>{const p=e.style.light,y=p.properties.get("position"),T=[y.x,y.y,y.z],A=(function(){var U=new h.A(9);return h.A!=Float32Array&&(U[1]=0,U[2]=0,U[3]=0,U[5]=0,U[6]=0,U[7]=0),U[0]=1,U[4]=1,U[8]=1,U})();p.properties.get("anchor")==="viewport"&&(function(U,$){var Z=Math.sin($),Q=Math.cos($);U[0]=Q,U[1]=Z,U[2]=0,U[3]=-Z,U[4]=Q,U[5]=0,U[6]=0,U[7]=0,U[8]=1})(A,-e.transform.angle),(function(U,$,Z){var Q=$[0],oe=$[1],he=$[2];U[0]=Q*Z[0]+oe*Z[3]+he*Z[6],U[1]=Q*Z[1]+oe*Z[4]+he*Z[7],U[2]=Q*Z[2]+oe*Z[5]+he*Z[8]})(T,T,A);const D=p.properties.get("color");return{u_matrix:_,u_lightpos:T,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+o,u_opacity:d}},Wa=(_,e,o,d,p,y,T)=>h.e(Mo(_,e,o,d),Po(y,e,T),{u_height_factor:-Math.pow(2,p.overscaledZ)/T.tileSize/8}),Ya=_=>({u_matrix:_}),Yo=(_,e,o,d)=>h.e(Ya(_),Po(o,e,d)),mi=(_,e)=>({u_matrix:_,u_world:e}),Rs=(_,e,o,d,p)=>h.e(Yo(_,e,o,d),{u_world:p}),yl=(_,e,o,d)=>{const p=_.transform;let y,T;if(d.paint.get("circle-pitch-alignment")==="map"){const A=Sn(o,1,p.zoom);y=!0,T=[A,A]}else y=!1,T=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:_.translatePosMatrix(e.posMatrix,o,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:T}},_r=(_,e,o)=>({u_matrix:_,u_inv_matrix:e,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}),Ii=(_,e,o=1)=>({u_matrix:_,u_color:e,u_overlay:0,u_overlay_scale:o}),Wn=_=>({u_matrix:_}),ji=(_,e,o,d)=>({u_matrix:_,u_extrude_scale:Sn(e,1,o),u_intensity:d}),La=(_,e,o,d)=>{const p=h.H();h.aP(p,0,_.width,_.height,0,0,1);const y=_.context.gl;return{u_matrix:p,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:o,u_color_ramp:d,u_opacity:e.paint.get("heatmap-opacity")}};function gs(_,e){const o=Math.pow(2,e.canonical.z),d=e.canonical.y;return[new h.Z(0,d/o).toLngLat().lat,new h.Z(0,(d+1)/o).toLngLat().lat]}const Ko=(_,e,o,d)=>{const p=_.transform;return{u_matrix:Dr(_,e,o,d),u_ratio:1/Sn(e,1,p.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Ao=(_,e,o,d,p)=>h.e(Ko(_,e,o,p),{u_image:0,u_image_height:d}),Ns=(_,e,o,d,p)=>{const y=_.transform,T=Hn(e,y);return{u_matrix:Dr(_,e,o,p),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Sn(e,1,y.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[T,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Lu=(_,e,o,d,p,y)=>{const T=_.lineAtlas,A=Hn(e,_.transform),D=o.layout.get("line-cap")==="round",U=T.getDash(d.from,D),$=T.getDash(d.to,D),Z=U.width*p.fromScale,Q=$.width*p.toScale;return h.e(Ko(_,e,o,y),{u_patternscale_a:[A/Z,-U.height/2],u_patternscale_b:[A/Q,-$.height/2],u_sdfgamma:T.width/(256*Math.min(Z,Q)*_.pixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:$.y,u_mix:p.t})};function Hn(_,e){return 1/Sn(_,1,e.tileZoom)}function Dr(_,e,o,d){return _.translatePosMatrix(d?d.posMatrix:e.tileID.posMatrix,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const _l=(_,e,o,d,p)=>{return{u_matrix:_,u_tl_parent:e,u_scale_parent:o,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(T=p.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(y=p.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Ru(p.paint.get("raster-hue-rotate"))};var y,T};function Ru(_){_*=Math.PI/180;const e=Math.sin(_),o=Math.cos(_);return[(2*o+1)/3,(-Math.sqrt(3)*e-o+1)/3,(Math.sqrt(3)*e-o+1)/3]}const Ds=(_,e,o,d,p,y,T,A,D,U,$,Z,Q,oe)=>{const he=T.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:he.cameraToCenterDistance,u_pitch:he.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:he.width/he.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:D,u_coord_matrix:U,u_is_text:+Z,u_pitch_with_map:+d,u_is_along_line:p,u_is_variable_anchor:y,u_texsize:Q,u_texture:0,u_translation:$,u_pitched_scale:oe}},zs=(_,e,o,d,p,y,T,A,D,U,$,Z,Q,oe,he)=>{const pe=T.transform;return h.e(Ds(_,e,o,d,p,y,T,A,D,U,$,Z,Q,he),{u_gamma_scale:d?Math.cos(pe._pitch)*pe.cameraToCenterDistance:1,u_device_pixel_ratio:T.pixelRatio,u_is_halo:1})},Li=(_,e,o,d,p,y,T,A,D,U,$,Z,Q,oe)=>h.e(zs(_,e,o,d,p,y,T,A,D,U,$,!0,Z,!0,oe),{u_texsize_icon:Q,u_texture_icon:1}),Ra=(_,e,o)=>({u_matrix:_,u_opacity:e,u_color:o}),Jo=(_,e,o,d,p,y)=>h.e((function(T,A,D,U){const $=D.imageManager.getPattern(T.from.toString()),Z=D.imageManager.getPattern(T.to.toString()),{width:Q,height:oe}=D.imageManager.getPixelSize(),he=Math.pow(2,U.tileID.overscaledZ),pe=U.tileSize*Math.pow(2,D.transform.tileZoom)/he,ge=pe*(U.tileID.canonical.x+U.tileID.wrap*he),ve=pe*U.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:$.tl,u_pattern_br_a:$.br,u_pattern_tl_b:Z.tl,u_pattern_br_b:Z.br,u_texsize:[Q,oe],u_mix:A.t,u_pattern_size_a:$.displaySize,u_pattern_size_b:Z.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/Sn(U,1,D.transform.tileZoom),u_pixel_coord_upper:[ge>>16,ve>>16],u_pixel_coord_lower:[65535&ge,65535&ve]}})(d,y,o,p),{u_matrix:_,u_opacity:e}),vl={fillExtrusion:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_lightpos:new h.aN(_,e.u_lightpos),u_lightintensity:new h.aI(_,e.u_lightintensity),u_lightcolor:new h.aN(_,e.u_lightcolor),u_vertical_gradient:new h.aI(_,e.u_vertical_gradient),u_opacity:new h.aI(_,e.u_opacity)}),fillExtrusionPattern:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_lightpos:new h.aN(_,e.u_lightpos),u_lightintensity:new h.aI(_,e.u_lightintensity),u_lightcolor:new h.aN(_,e.u_lightcolor),u_vertical_gradient:new h.aI(_,e.u_vertical_gradient),u_height_factor:new h.aI(_,e.u_height_factor),u_image:new h.aH(_,e.u_image),u_texsize:new h.aO(_,e.u_texsize),u_pixel_coord_upper:new h.aO(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(_,e.u_pixel_coord_lower),u_scale:new h.aN(_,e.u_scale),u_fade:new h.aI(_,e.u_fade),u_opacity:new h.aI(_,e.u_opacity)}),fill:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix)}),fillPattern:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_image:new h.aH(_,e.u_image),u_texsize:new h.aO(_,e.u_texsize),u_pixel_coord_upper:new h.aO(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(_,e.u_pixel_coord_lower),u_scale:new h.aN(_,e.u_scale),u_fade:new h.aI(_,e.u_fade)}),fillOutline:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_world:new h.aO(_,e.u_world)}),fillOutlinePattern:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_world:new h.aO(_,e.u_world),u_image:new h.aH(_,e.u_image),u_texsize:new h.aO(_,e.u_texsize),u_pixel_coord_upper:new h.aO(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(_,e.u_pixel_coord_lower),u_scale:new h.aN(_,e.u_scale),u_fade:new h.aI(_,e.u_fade)}),circle:(_,e)=>({u_camera_to_center_distance:new h.aI(_,e.u_camera_to_center_distance),u_scale_with_map:new h.aH(_,e.u_scale_with_map),u_pitch_with_map:new h.aH(_,e.u_pitch_with_map),u_extrude_scale:new h.aO(_,e.u_extrude_scale),u_device_pixel_ratio:new h.aI(_,e.u_device_pixel_ratio),u_matrix:new h.aJ(_,e.u_matrix)}),collisionBox:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_pixel_extrude_scale:new h.aO(_,e.u_pixel_extrude_scale)}),collisionCircle:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_inv_matrix:new h.aJ(_,e.u_inv_matrix),u_camera_to_center_distance:new h.aI(_,e.u_camera_to_center_distance),u_viewport_size:new h.aO(_,e.u_viewport_size)}),debug:(_,e)=>({u_color:new h.aL(_,e.u_color),u_matrix:new h.aJ(_,e.u_matrix),u_overlay:new h.aH(_,e.u_overlay),u_overlay_scale:new h.aI(_,e.u_overlay_scale)}),clippingMask:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix)}),heatmap:(_,e)=>({u_extrude_scale:new h.aI(_,e.u_extrude_scale),u_intensity:new h.aI(_,e.u_intensity),u_matrix:new h.aJ(_,e.u_matrix)}),heatmapTexture:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_world:new h.aO(_,e.u_world),u_image:new h.aH(_,e.u_image),u_color_ramp:new h.aH(_,e.u_color_ramp),u_opacity:new h.aI(_,e.u_opacity)}),hillshade:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_image:new h.aH(_,e.u_image),u_latrange:new h.aO(_,e.u_latrange),u_light:new h.aO(_,e.u_light),u_shadow:new h.aL(_,e.u_shadow),u_highlight:new h.aL(_,e.u_highlight),u_accent:new h.aL(_,e.u_accent)}),hillshadePrepare:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_image:new h.aH(_,e.u_image),u_dimension:new h.aO(_,e.u_dimension),u_zoom:new h.aI(_,e.u_zoom),u_unpack:new h.aK(_,e.u_unpack)}),line:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_ratio:new h.aI(_,e.u_ratio),u_device_pixel_ratio:new h.aI(_,e.u_device_pixel_ratio),u_units_to_pixels:new h.aO(_,e.u_units_to_pixels)}),lineGradient:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_ratio:new h.aI(_,e.u_ratio),u_device_pixel_ratio:new h.aI(_,e.u_device_pixel_ratio),u_units_to_pixels:new h.aO(_,e.u_units_to_pixels),u_image:new h.aH(_,e.u_image),u_image_height:new h.aI(_,e.u_image_height)}),linePattern:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_texsize:new h.aO(_,e.u_texsize),u_ratio:new h.aI(_,e.u_ratio),u_device_pixel_ratio:new h.aI(_,e.u_device_pixel_ratio),u_image:new h.aH(_,e.u_image),u_units_to_pixels:new h.aO(_,e.u_units_to_pixels),u_scale:new h.aN(_,e.u_scale),u_fade:new h.aI(_,e.u_fade)}),lineSDF:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_ratio:new h.aI(_,e.u_ratio),u_device_pixel_ratio:new h.aI(_,e.u_device_pixel_ratio),u_units_to_pixels:new h.aO(_,e.u_units_to_pixels),u_patternscale_a:new h.aO(_,e.u_patternscale_a),u_patternscale_b:new h.aO(_,e.u_patternscale_b),u_sdfgamma:new h.aI(_,e.u_sdfgamma),u_image:new h.aH(_,e.u_image),u_tex_y_a:new h.aI(_,e.u_tex_y_a),u_tex_y_b:new h.aI(_,e.u_tex_y_b),u_mix:new h.aI(_,e.u_mix)}),raster:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_tl_parent:new h.aO(_,e.u_tl_parent),u_scale_parent:new h.aI(_,e.u_scale_parent),u_buffer_scale:new h.aI(_,e.u_buffer_scale),u_fade_t:new h.aI(_,e.u_fade_t),u_opacity:new h.aI(_,e.u_opacity),u_image0:new h.aH(_,e.u_image0),u_image1:new h.aH(_,e.u_image1),u_brightness_low:new h.aI(_,e.u_brightness_low),u_brightness_high:new h.aI(_,e.u_brightness_high),u_saturation_factor:new h.aI(_,e.u_saturation_factor),u_contrast_factor:new h.aI(_,e.u_contrast_factor),u_spin_weights:new h.aN(_,e.u_spin_weights)}),symbolIcon:(_,e)=>({u_is_size_zoom_constant:new h.aH(_,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aH(_,e.u_is_size_feature_constant),u_size_t:new h.aI(_,e.u_size_t),u_size:new h.aI(_,e.u_size),u_camera_to_center_distance:new h.aI(_,e.u_camera_to_center_distance),u_pitch:new h.aI(_,e.u_pitch),u_rotate_symbol:new h.aH(_,e.u_rotate_symbol),u_aspect_ratio:new h.aI(_,e.u_aspect_ratio),u_fade_change:new h.aI(_,e.u_fade_change),u_matrix:new h.aJ(_,e.u_matrix),u_label_plane_matrix:new h.aJ(_,e.u_label_plane_matrix),u_coord_matrix:new h.aJ(_,e.u_coord_matrix),u_is_text:new h.aH(_,e.u_is_text),u_pitch_with_map:new h.aH(_,e.u_pitch_with_map),u_is_along_line:new h.aH(_,e.u_is_along_line),u_is_variable_anchor:new h.aH(_,e.u_is_variable_anchor),u_texsize:new h.aO(_,e.u_texsize),u_texture:new h.aH(_,e.u_texture),u_translation:new h.aO(_,e.u_translation),u_pitched_scale:new h.aI(_,e.u_pitched_scale)}),symbolSDF:(_,e)=>({u_is_size_zoom_constant:new h.aH(_,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aH(_,e.u_is_size_feature_constant),u_size_t:new h.aI(_,e.u_size_t),u_size:new h.aI(_,e.u_size),u_camera_to_center_distance:new h.aI(_,e.u_camera_to_center_distance),u_pitch:new h.aI(_,e.u_pitch),u_rotate_symbol:new h.aH(_,e.u_rotate_symbol),u_aspect_ratio:new h.aI(_,e.u_aspect_ratio),u_fade_change:new h.aI(_,e.u_fade_change),u_matrix:new h.aJ(_,e.u_matrix),u_label_plane_matrix:new h.aJ(_,e.u_label_plane_matrix),u_coord_matrix:new h.aJ(_,e.u_coord_matrix),u_is_text:new h.aH(_,e.u_is_text),u_pitch_with_map:new h.aH(_,e.u_pitch_with_map),u_is_along_line:new h.aH(_,e.u_is_along_line),u_is_variable_anchor:new h.aH(_,e.u_is_variable_anchor),u_texsize:new h.aO(_,e.u_texsize),u_texture:new h.aH(_,e.u_texture),u_gamma_scale:new h.aI(_,e.u_gamma_scale),u_device_pixel_ratio:new h.aI(_,e.u_device_pixel_ratio),u_is_halo:new h.aH(_,e.u_is_halo),u_translation:new h.aO(_,e.u_translation),u_pitched_scale:new h.aI(_,e.u_pitched_scale)}),symbolTextAndIcon:(_,e)=>({u_is_size_zoom_constant:new h.aH(_,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aH(_,e.u_is_size_feature_constant),u_size_t:new h.aI(_,e.u_size_t),u_size:new h.aI(_,e.u_size),u_camera_to_center_distance:new h.aI(_,e.u_camera_to_center_distance),u_pitch:new h.aI(_,e.u_pitch),u_rotate_symbol:new h.aH(_,e.u_rotate_symbol),u_aspect_ratio:new h.aI(_,e.u_aspect_ratio),u_fade_change:new h.aI(_,e.u_fade_change),u_matrix:new h.aJ(_,e.u_matrix),u_label_plane_matrix:new h.aJ(_,e.u_label_plane_matrix),u_coord_matrix:new h.aJ(_,e.u_coord_matrix),u_is_text:new h.aH(_,e.u_is_text),u_pitch_with_map:new h.aH(_,e.u_pitch_with_map),u_is_along_line:new h.aH(_,e.u_is_along_line),u_is_variable_anchor:new h.aH(_,e.u_is_variable_anchor),u_texsize:new h.aO(_,e.u_texsize),u_texsize_icon:new h.aO(_,e.u_texsize_icon),u_texture:new h.aH(_,e.u_texture),u_texture_icon:new h.aH(_,e.u_texture_icon),u_gamma_scale:new h.aI(_,e.u_gamma_scale),u_device_pixel_ratio:new h.aI(_,e.u_device_pixel_ratio),u_is_halo:new h.aH(_,e.u_is_halo),u_translation:new h.aO(_,e.u_translation),u_pitched_scale:new h.aI(_,e.u_pitched_scale)}),background:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_opacity:new h.aI(_,e.u_opacity),u_color:new h.aL(_,e.u_color)}),backgroundPattern:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_opacity:new h.aI(_,e.u_opacity),u_image:new h.aH(_,e.u_image),u_pattern_tl_a:new h.aO(_,e.u_pattern_tl_a),u_pattern_br_a:new h.aO(_,e.u_pattern_br_a),u_pattern_tl_b:new h.aO(_,e.u_pattern_tl_b),u_pattern_br_b:new h.aO(_,e.u_pattern_br_b),u_texsize:new h.aO(_,e.u_texsize),u_mix:new h.aI(_,e.u_mix),u_pattern_size_a:new h.aO(_,e.u_pattern_size_a),u_pattern_size_b:new h.aO(_,e.u_pattern_size_b),u_scale_a:new h.aI(_,e.u_scale_a),u_scale_b:new h.aI(_,e.u_scale_b),u_pixel_coord_upper:new h.aO(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(_,e.u_pixel_coord_lower),u_tile_units_to_pixels:new h.aI(_,e.u_tile_units_to_pixels)}),terrain:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_texture:new h.aH(_,e.u_texture),u_ele_delta:new h.aI(_,e.u_ele_delta),u_fog_matrix:new h.aJ(_,e.u_fog_matrix),u_fog_color:new h.aL(_,e.u_fog_color),u_fog_ground_blend:new h.aI(_,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new h.aI(_,e.u_fog_ground_blend_opacity),u_horizon_color:new h.aL(_,e.u_horizon_color),u_horizon_fog_blend:new h.aI(_,e.u_horizon_fog_blend)}),terrainDepth:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_ele_delta:new h.aI(_,e.u_ele_delta)}),terrainCoords:(_,e)=>({u_matrix:new h.aJ(_,e.u_matrix),u_texture:new h.aH(_,e.u_texture),u_terrain_coords_id:new h.aI(_,e.u_terrain_coords_id),u_ele_delta:new h.aI(_,e.u_ele_delta)}),sky:(_,e)=>({u_sky_color:new h.aL(_,e.u_sky_color),u_horizon_color:new h.aL(_,e.u_horizon_color),u_horizon:new h.aI(_,e.u_horizon),u_sky_horizon_blend:new h.aI(_,e.u_sky_horizon_blend)})};class Gr{constructor(e,o,d){this.context=e;const p=e.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Lo{constructor(e,o,d,p){this.length=o.length,this.attributes=d,this.itemSize=o.bytesPerElement,this.dynamicDraw=p,this.context=e;const y=e.gl;this.buffer=y.createBuffer(),e.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,o){for(let d=0;d<this.attributes.length;d++){const p=o.attributes[this.attributes[d].name];p!==void 0&&e.enableVertexAttribArray(p)}}setVertexAttribPointers(e,o,d){for(let p=0;p<this.attributes.length;p++){const y=this.attributes[p],T=o.attributes[y.name];T!==void 0&&e.vertexAttribPointer(T,y.components,e[xl[y.type]],!1,this.itemSize,y.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const vr=new WeakMap;function Ji(_){var e;if(vr.has(_))return vr.get(_);{const o=(e=_.getParameter(_.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return vr.set(_,o),o}}class Gn{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Qi extends Gn{getDefault(){return h.aM.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ka extends Gn{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ua extends Gn{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class ca extends Gn{getDefault(){return[!0,!0,!0,!0]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class wl extends Gn{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class er extends Gn{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Ja extends Gn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const o=this.current;(e.func!==o.func||e.ref!==o.ref||e.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class zr extends Gn{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Qa extends Gn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=e,this.dirty=!1}}class Nu extends Gn{getDefault(){return[0,1]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class bl extends Gn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=e,this.dirty=!1}}class kl extends Gn{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ys extends Gn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.BLEND):o.disable(o.BLEND),this.current=e,this.dirty=!1}}class Qo extends Gn{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Du extends Gn{getDefault(){return h.aM.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class zu extends Gn{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class _s extends Gn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=e,this.dirty=!1}}class $r extends Gn{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ro extends Gn{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Ou extends Gn{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class fc extends Gn{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Sl extends Gn{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ou extends Gn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class El extends Gn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class el extends Gn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class es extends Gn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class tl extends Gn{getDefault(){return null}set(e){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ui extends Gn{getDefault(){return null}set(e){var o;if(e===this.current&&!this.dirty)return;const d=this.gl;Ji(d)?d.bindVertexArray(e):(o=d.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class eo extends Gn{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class nl extends Gn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Il extends Gn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class il extends Gn{constructor(e,o){super(e),this.context=e,this.parent=o}getDefault(){return null}}class Tl extends il{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Os extends il{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class lu extends il{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class dc{constructor(e,o,d,p,y){this.context=e,this.width=o,this.height=d;const T=e.gl,A=this.framebuffer=T.createFramebuffer();if(this.colorAttachment=new Tl(e,A),p)this.depthAttachment=y?new lu(e,A):new Os(e,A);else if(y)throw new Error("Stencil cannot be set without depth");if(T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,o=this.colorAttachment.get();if(o&&e.deleteTexture(o),this.depthAttachment){const d=this.depthAttachment.get();d&&e.deleteRenderbuffer(d)}e.deleteFramebuffer(this.framebuffer)}}class Ri{constructor(e,o,d){this.blendFunction=e,this.blendColor=o,this.mask=d}}Ri.Replace=[1,0],Ri.disabled=new Ri(Ri.Replace,h.aM.transparent,[!1,!1,!1,!1]),Ri.unblended=new Ri(Ri.Replace,h.aM.transparent,[!0,!0,!0,!0]),Ri.alphaBlended=new Ri([1,771],h.aM.transparent,[!0,!0,!0,!0]);class pc{constructor(e){var o,d;if(this.gl=e,this.clearColor=new Qi(this),this.clearDepth=new Ka(this),this.clearStencil=new ua(this),this.colorMask=new ca(this),this.depthMask=new wl(this),this.stencilMask=new er(this),this.stencilFunc=new Ja(this),this.stencilOp=new zr(this),this.stencilTest=new Qa(this),this.depthRange=new Nu(this),this.depthTest=new bl(this),this.depthFunc=new kl(this),this.blend=new ys(this),this.blendFunc=new Qo(this),this.blendColor=new Du(this),this.blendEquation=new zu(this),this.cullFace=new _s(this),this.cullFaceSide=new $r(this),this.frontFace=new Ro(this),this.program=new Ou(this),this.activeTexture=new fc(this),this.viewport=new Sl(this),this.bindFramebuffer=new ou(this),this.bindRenderbuffer=new El(this),this.bindTexture=new el(this),this.bindVertexBuffer=new es(this),this.bindElementBuffer=new tl(this),this.bindVertexArray=new Ui(this),this.pixelStoreUnpack=new eo(this),this.pixelStoreUnpackPremultiplyAlpha=new nl(this),this.pixelStoreUnpackFlipY=new Il(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Ji(e)){this.HALF_FLOAT=e.HALF_FLOAT;const p=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=e.RGBA16F)!==null&&o!==void 0?o:p?.RGBA16F_EXT,this.RGB16F=(d=e.RGB16F)!==null&&d!==void 0?d:p?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const p=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=p?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,o){return new Gr(this,e,o)}createVertexBuffer(e,o,d){return new Lo(this,e,o,d)}createRenderbuffer(e,o,d){const p=this.gl,y=p.createRenderbuffer();return this.bindRenderbuffer.set(y),p.renderbufferStorage(p.RENDERBUFFER,e,o,d),this.bindRenderbuffer.set(null),y}createFramebuffer(e,o,d,p){return new dc(this,e,o,d,p)}clear({color:e,depth:o,stencil:d}){const p=this.gl;let y=0;e&&(y|=p.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(y|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),d!==void 0&&(y|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),p.clear(y)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){h.aE(e.blendFunction,Ri.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Ji(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var o;return Ji(this.gl)?this.gl.deleteVertexArray(e):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Mn{constructor(e,o,d){this.func=e,this.mask=o,this.range=d}}Mn.ReadOnly=!1,Mn.ReadWrite=!0,Mn.disabled=new Mn(519,Mn.ReadOnly,[0,1]);const Cl=7680;class oi{constructor(e,o,d,p,y,T){this.test=e,this.ref=o,this.mask=d,this.fail=p,this.depthFail=y,this.pass=T}}oi.disabled=new oi({func:519,mask:0},0,0,Cl,Cl,Cl);class Jn{constructor(e,o,d){this.enable=e,this.mode=o,this.frontFace=d}}let ts;function rl(_,e,o,d,p){const y=_.context,T=y.gl,A=_.useProgram("collisionBox"),D=[];let U=0,$=0;for(let ve=0;ve<d.length;ve++){const Se=d[ve],me=e.getTile(Se).getBucket(o);if(!me)continue;const Ae=p?me.textCollisionBox:me.iconCollisionBox,ze=me.collisionCircleArray;if(ze.length>0){const Ve=h.H();h.aQ(Ve,me.placementInvProjMatrix,_.transform.glCoordMatrix),h.aQ(Ve,Ve,me.placementViewportMatrix),D.push({circleArray:ze,circleOffset:$,transform:Se.posMatrix,invTransform:Ve,coord:Se}),U+=ze.length/4,$=U}Ae&&A.draw(y,T.LINES,Mn.disabled,oi.disabled,_.colorModeForRenderPass(),Jn.disabled,{u_matrix:Se.posMatrix,u_pixel_extrude_scale:[1/(Z=_.transform).width,1/Z.height]},_.style.map.terrain&&_.style.map.terrain.getTerrainData(Se),o.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,null,_.transform.zoom,null,null,Ae.collisionVertexBuffer)}var Z;if(!p||!D.length)return;const Q=_.useProgram("collisionCircle"),oe=new h.aR;oe.resize(4*U),oe._trim();let he=0;for(const ve of D)for(let Se=0;Se<ve.circleArray.length/4;Se++){const me=4*Se,Ae=ve.circleArray[me+0],ze=ve.circleArray[me+1],Ve=ve.circleArray[me+2],at=ve.circleArray[me+3];oe.emplace(he++,Ae,ze,Ve,at,0),oe.emplace(he++,Ae,ze,Ve,at,1),oe.emplace(he++,Ae,ze,Ve,at,2),oe.emplace(he++,Ae,ze,Ve,at,3)}(!ts||ts.length<2*U)&&(ts=(function(ve){const Se=2*ve,me=new h.aT;me.resize(Se),me._trim();for(let Ae=0;Ae<Se;Ae++){const ze=6*Ae;me.uint16[ze+0]=4*Ae+0,me.uint16[ze+1]=4*Ae+1,me.uint16[ze+2]=4*Ae+2,me.uint16[ze+3]=4*Ae+2,me.uint16[ze+4]=4*Ae+3,me.uint16[ze+5]=4*Ae+0}return me})(U));const pe=y.createIndexBuffer(ts,!0),ge=y.createVertexBuffer(oe,h.aS.members,!0);for(const ve of D){const Se=_r(ve.transform,ve.invTransform,_.transform);Q.draw(y,T.TRIANGLES,Mn.disabled,oi.disabled,_.colorModeForRenderPass(),Jn.disabled,Se,_.style.map.terrain&&_.style.map.terrain.getTerrainData(ve.coord),o.id,ge,pe,h.a0.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,_.transform.zoom,null,null,null)}ge.destroy(),pe.destroy()}Jn.disabled=new Jn(!1,1029,2305),Jn.backCCW=new Jn(!0,1029,2305);const to=h.an(new Float32Array(16));function Pl(_,e,o,d,p,y){const{horizontalAlign:T,verticalAlign:A}=h.au(_);return new h.P((-(T-.5)*e/p+d[0])*y,(-(A-.5)*o/p+d[1])*y)}function Na(_,e,o,d,p,y){const T=e.tileAnchorPoint.add(new h.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let A=d.mult(y);o||(A=A.rotate(-p));const D=T.add(A);return _e(D.x,D.y,e.labelPlaneMatrix,e.getElevation).point}if(o){const A=Ye(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(_),D=Math.atan(A.y/A.x)+(A.x<0?Math.PI:0);return _.add(d.rotate(D))}return _.add(d)}function no(_,e,o,d,p,y,T,A,D,U,$,Z,Q,oe){const he=_.text.placedSymbolArray,pe=_.text.dynamicLayoutVertexArray,ge=_.icon.dynamicLayoutVertexArray,ve={};pe.clear();for(let Se=0;Se<he.length;Se++){const me=he.get(Se),Ae=me.hidden||!me.crossTileID||_.allowVerticalPlacement&&!me.placedOrientation?null:d[me.crossTileID];if(Ae){const ze=new h.P(me.anchorX,me.anchorY),Ve={getElevation:oe,width:p.width,height:p.height,labelPlaneMatrix:y,pitchWithMap:o,projection:$,tileAnchorPoint:ze,translation:Z,unwrappedTileID:Q},at=o?_e(ze.x,ze.y,T,oe):Ye(ze.x,ze.y,Ve),yt=Y(p.cameraToCenterDistance,at.signedDistanceFromCamera);let kt=h.ai(_.textSizeData,D,me)*yt/h.ap;o&&(kt*=_.tilePixelRatio/A);const{width:Lt,height:Et,anchor:bt,textOffset:Ut,textBoxScale:gn}=Ae,It=Pl(bt,Lt,Et,Ut,gn,kt),Ct=$.getPitchedTextCorrection(p,ze.add(new h.P(Z[0],Z[1])),Q),mn=Na(at.point,Ve,e,It,p.angle,Ct),li=_.allowVerticalPlacement&&me.placedOrientation===h.ah.vertical?Math.PI/2:0;for(let En=0;En<me.numGlyphs;En++)h.aj(pe,mn,li);U&&me.associatedIconIndex>=0&&(ve[me.associatedIconIndex]={shiftedAnchor:mn,angle:li})}else Jt(me.numGlyphs,pe)}if(U){ge.clear();const Se=_.icon.placedSymbolArray;for(let me=0;me<Se.length;me++){const Ae=Se.get(me);if(Ae.hidden)Jt(Ae.numGlyphs,ge);else{const ze=ve[me];if(ze)for(let Ve=0;Ve<Ae.numGlyphs;Ve++)h.aj(ge,ze.shiftedAnchor,ze.angle);else Jt(Ae.numGlyphs,ge)}}_.icon.dynamicLayoutVertexBuffer.updateData(ge)}_.text.dynamicLayoutVertexBuffer.updateData(pe)}function Zr(_,e,o){return o.iconsInText&&e?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function Da(_,e,o,d,p,y,T,A,D,U,$,Z){const Q=_.context,oe=Q.gl,he=_.transform,pe=Qr(),ge=A==="map",ve=D==="map",Se=A!=="viewport"&&o.layout.get("symbol-placement")!=="point",me=ge&&!ve&&!Se,Ae=!ve&&Se,ze=!o.layout.get("symbol-sort-key").isConstant();let Ve=!1;const at=_.depthModeForSublayer(0,Mn.ReadOnly),yt=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),kt=[],Lt=pe.getCircleRadiusCorrection(he);for(const Et of d){const bt=e.getTile(Et),Ut=bt.getBucket(o);if(!Ut)continue;const gn=p?Ut.text:Ut.icon;if(!gn||!gn.segments.get().length||!gn.hasVisibleVertices)continue;const It=gn.programConfigurations.get(o.id),Ct=p||Ut.sdfIcons,mn=p?Ut.textSizeData:Ut.iconSizeData,li=ve||he.pitch!==0,En=_.useProgram(Zr(Ct,p,Ut),It),Pn=h.ag(mn,he.zoom),ci=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Et);let wr,bs,hi,or,wi=[0,0],$i=null;if(p)bs=bt.glyphAtlasTexture,hi=oe.LINEAR,wr=bt.glyphAtlasTexture.size,Ut.iconsInText&&(wi=bt.imageAtlasTexture.size,$i=bt.imageAtlasTexture,or=li||_.options.rotating||_.options.zooming||mn.kind==="composite"||mn.kind==="camera"?oe.LINEAR:oe.NEAREST);else{const Ln=o.layout.get("icon-size").constantOr(0)!==1||Ut.iconsNeedLinear;bs=bt.imageAtlasTexture,hi=Ct||_.options.rotating||_.options.zooming||Ln||li?oe.LINEAR:oe.NEAREST,wr=bt.imageAtlasTexture.size}const Pr=Sn(bt,1,_.transform.zoom),ga=Ae?Et.posMatrix:to,is=Mi(ga,ve,ge,_.transform,Pr),ya=gr(ga,ve,ge,_.transform,Pr),Fo=gr(Et.posMatrix,ve,ge,_.transform,Pr),ks=pe.translatePosition(_.transform,bt,y,T),$s=yt&&Ut.hasTextData(),Ba=o.layout.get("icon-text-fit")!=="none"&&$s&&Ut.hasIconData();if(Se){const Ln=_.style.map.terrain?(Bo,va)=>_.style.map.terrain.getElevation(Et,Bo,va):null,Es=o.layout.get("text-rotation-alignment")==="map";ae(Ut,Et.posMatrix,_,p,is,Fo,ve,U,Es,pe,Et.toUnwrapped(),he.width,he.height,ks,Ln)}const Wr=Et.posMatrix,Ss=p&&yt||Ba,_a=Se||Ss?to:is,Zs=ya,Xi=Ct&&o.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ci;Ci=Ct?Ut.iconsInText?Li(mn.kind,Pn,me,ve,Se,Ss,_,Wr,_a,Zs,ks,wr,wi,Lt):zs(mn.kind,Pn,me,ve,Se,Ss,_,Wr,_a,Zs,ks,p,wr,!0,Lt):Ds(mn.kind,Pn,me,ve,Se,Ss,_,Wr,_a,Zs,ks,p,wr,Lt);const Mr={program:En,buffers:gn,uniformValues:Ci,atlasTexture:bs,atlasTextureIcon:$i,atlasInterpolation:hi,atlasInterpolationIcon:or,isSDF:Ct,hasHalo:Xi};if(ze&&Ut.canOverlap){Ve=!0;const Ln=gn.segments.get();for(const Es of Ln)kt.push({segments:new h.a0([Es]),sortKey:Es.sortKey,state:Mr,terrainData:ci})}else kt.push({segments:gn.segments,sortKey:0,state:Mr,terrainData:ci})}Ve&&kt.sort(((Et,bt)=>Et.sortKey-bt.sortKey));for(const Et of kt){const bt=Et.state;if(Q.activeTexture.set(oe.TEXTURE0),bt.atlasTexture.bind(bt.atlasInterpolation,oe.CLAMP_TO_EDGE),bt.atlasTextureIcon&&(Q.activeTexture.set(oe.TEXTURE1),bt.atlasTextureIcon&&bt.atlasTextureIcon.bind(bt.atlasInterpolationIcon,oe.CLAMP_TO_EDGE)),bt.isSDF){const Ut=bt.uniformValues;bt.hasHalo&&(Ut.u_is_halo=1,uu(bt.buffers,Et.segments,o,_,bt.program,at,$,Z,Ut,Et.terrainData)),Ut.u_is_halo=0}uu(bt.buffers,Et.segments,o,_,bt.program,at,$,Z,bt.uniformValues,Et.terrainData)}}function uu(_,e,o,d,p,y,T,A,D,U){const $=d.context;p.draw($,$.gl.TRIANGLES,y,T,A,Jn.disabled,D,U,o.id,_.layoutVertexBuffer,_.indexBuffer,e,o.paint,d.transform.zoom,_.programConfigurations.get(o.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function cu(_,e,o,d){const p=_.context,y=p.gl,T=oi.disabled,A=new Ri([y.ONE,y.ONE],h.aM.transparent,[!0,!0,!0,!0]),D=e.getBucket(o);if(!D)return;const U=d.key;let $=o.heatmapFbos.get(U);$||($=io(p,e.tileSize,e.tileSize),o.heatmapFbos.set(U,$)),p.bindFramebuffer.set($.framebuffer),p.viewport.set([0,0,e.tileSize,e.tileSize]),p.clear({color:h.aM.transparent});const Z=D.programConfigurations.get(o.id),Q=_.useProgram("heatmap",Z),oe=_.style.map.terrain.getTerrainData(d);Q.draw(p,y.TRIANGLES,Mn.disabled,T,A,Jn.disabled,ji(d.posMatrix,e,_.transform.zoom,o.paint.get("heatmap-intensity")),oe,o.id,D.layoutVertexBuffer,D.indexBuffer,D.segments,o.paint,_.transform.zoom,Z)}function za(_,e,o){const d=_.context,p=d.gl;d.setColorMode(_.colorModeForRenderPass());const y=ro(d,e),T=o.key,A=e.heatmapFbos.get(T);A&&(d.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,A.colorAttachment.get()),d.activeTexture.set(p.TEXTURE1),y.bind(p.LINEAR,p.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(d,p.TRIANGLES,Mn.disabled,oi.disabled,_.colorModeForRenderPass(),Jn.disabled,La(_,e,0,1),null,e.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments,e.paint,_.transform.zoom),A.destroy(),e.heatmapFbos.delete(T))}function io(_,e,o){var d,p;const y=_.gl,T=y.createTexture();y.bindTexture(y.TEXTURE_2D,T),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const A=(d=_.HALF_FLOAT)!==null&&d!==void 0?d:y.UNSIGNED_BYTE,D=(p=_.RGBA16F)!==null&&p!==void 0?p:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,D,e,o,0,y.RGBA,A,null);const U=_.createFramebuffer(e,o,!1,!1);return U.colorAttachment.set(T),U}function ro(_,e){return e.colorRampTexture||(e.colorRampTexture=new St(_,e.colorRamp,_.gl.RGBA)),e.colorRampTexture}function Fs(_,e,o,d,p){if(!o||!d||!d.imageAtlas)return;const y=d.imageAtlas.patternPositions;let T=y[o.to.toString()],A=y[o.from.toString()];if(!T&&A&&(T=A),!A&&T&&(A=T),!T||!A){const D=p.getPaintProperty(e);T=y[D],A=y[D]}T&&A&&_.setConstantPatternPositions(T,A)}function Bs(_,e,o,d,p,y,T){const A=_.context.gl,D="fill-pattern",U=o.paint.get(D),$=U&&U.constantOr(1),Z=o.getCrossfadeParameters();let Q,oe,he,pe,ge;T?(oe=$&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Q=A.LINES):(oe=$?"fillPattern":"fill",Q=A.TRIANGLES);const ve=U.constantOr(null);for(const Se of d){const me=e.getTile(Se);if($&&!me.patternsLoaded())continue;const Ae=me.getBucket(o);if(!Ae)continue;const ze=Ae.programConfigurations.get(o.id),Ve=_.useProgram(oe,ze),at=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Se);$&&(_.context.activeTexture.set(A.TEXTURE0),me.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ze.updatePaintBuffers(Z)),Fs(ze,D,ve,me,o);const yt=at?Se:null,kt=_.translatePosMatrix(yt?yt.posMatrix:Se.posMatrix,me,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(T){pe=Ae.indexBuffer2,ge=Ae.segments2;const Lt=[A.drawingBufferWidth,A.drawingBufferHeight];he=oe==="fillOutlinePattern"&&$?Rs(kt,_,Z,me,Lt):mi(kt,Lt)}else pe=Ae.indexBuffer,ge=Ae.segments,he=$?Yo(kt,_,Z,me):Ya(kt);Ve.draw(_.context,Q,p,_.stencilModeForClipping(Se),y,Jn.disabled,he,at,o.id,Ae.layoutVertexBuffer,pe,ge,o.paint,_.transform.zoom,ze)}}function No(_,e,o,d,p,y,T){const A=_.context,D=A.gl,U="fill-extrusion-pattern",$=o.paint.get(U),Z=$.constantOr(1),Q=o.getCrossfadeParameters(),oe=o.paint.get("fill-extrusion-opacity"),he=$.constantOr(null);for(const pe of d){const ge=e.getTile(pe),ve=ge.getBucket(o);if(!ve)continue;const Se=_.style.map.terrain&&_.style.map.terrain.getTerrainData(pe),me=ve.programConfigurations.get(o.id),Ae=_.useProgram(Z?"fillExtrusionPattern":"fillExtrusion",me);Z&&(_.context.activeTexture.set(D.TEXTURE0),ge.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),me.updatePaintBuffers(Q)),Fs(me,U,he,ge,o);const ze=_.translatePosMatrix(pe.posMatrix,ge,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Ve=o.paint.get("fill-extrusion-vertical-gradient"),at=Z?Wa(ze,_,Ve,oe,pe,Q,ge):Mo(ze,_,Ve,oe);Ae.draw(A,A.gl.TRIANGLES,p,y,T,Jn.backCCW,at,Se,o.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,o.paint,_.transform.zoom,me,_.style.map.terrain&&ve.centroidVertexBuffer)}}function ha(_,e,o,d,p,y,T){const A=_.context,D=A.gl,U=o.fbo;if(!U)return;const $=_.useProgram("hillshade"),Z=_.style.map.terrain&&_.style.map.terrain.getTerrainData(e);A.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,U.colorAttachment.get()),$.draw(A,D.TRIANGLES,p,y,T,Jn.disabled,((Q,oe,he,pe)=>{const ge=he.paint.get("hillshade-shadow-color"),ve=he.paint.get("hillshade-highlight-color"),Se=he.paint.get("hillshade-accent-color");let me=he.paint.get("hillshade-illumination-direction")*(Math.PI/180);he.paint.get("hillshade-illumination-anchor")==="viewport"&&(me-=Q.transform.angle);const Ae=!Q.options.moving;return{u_matrix:pe?pe.posMatrix:Q.transform.calculatePosMatrix(oe.tileID.toUnwrapped(),Ae),u_image:0,u_latrange:gs(0,oe.tileID),u_light:[he.paint.get("hillshade-exaggeration"),me],u_shadow:ge,u_highlight:ve,u_accent:Se}})(_,o,d,Z?e:null),Z,d.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}function so(_,e,o,d,p,y){const T=_.context,A=T.gl,D=e.dem;if(D&&D.data){const U=D.dim,$=D.stride,Z=D.getPixels();if(T.activeTexture.set(A.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||_.getTileTexture($),e.demTexture){const oe=e.demTexture;oe.update(Z,{premultiply:!1}),oe.bind(A.NEAREST,A.CLAMP_TO_EDGE)}else e.demTexture=new St(T,Z,A.RGBA,{premultiply:!1}),e.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);T.activeTexture.set(A.TEXTURE0);let Q=e.fbo;if(!Q){const oe=new St(T,{width:U,height:U,data:null},A.RGBA);oe.bind(A.LINEAR,A.CLAMP_TO_EDGE),Q=e.fbo=T.createFramebuffer(U,U,!0,!1),Q.colorAttachment.set(oe.texture)}T.bindFramebuffer.set(Q.framebuffer),T.viewport.set([0,0,U,U]),_.useProgram("hillshadePrepare").draw(T,A.TRIANGLES,d,p,y,Jn.disabled,((oe,he)=>{const pe=he.stride,ge=h.H();return h.aP(ge,0,h.X,-h.X,0,0,1),h.J(ge,ge,[0,-h.X,0]),{u_matrix:ge,u_image:1,u_dimension:[pe,pe],u_zoom:oe.overscaledZ,u_unpack:he.getUnpackVector()}})(e.tileID,D),null,o.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Ml(_,e,o,d,p,y){const T=d.paint.get("raster-fade-duration");if(!y&&T>0){const A=B.now(),D=(A-_.timeAdded)/T,U=e?(A-e.timeAdded)/T:-1,$=o.getSource(),Z=p.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),Q=!e||Math.abs(e.tileID.overscaledZ-Z)>Math.abs(_.tileID.overscaledZ-Z),oe=Q&&_.refreshedUponExpiration?1:h.ac(Q?D:1-U,0,1);return _.refreshedUponExpiration&&D>=1&&(_.refreshedUponExpiration=!1),e?{opacity:1,mix:1-oe}:{opacity:oe,mix:0}}return{opacity:1,mix:0}}const sl=new h.aM(1,0,0,1),jn=new h.aM(0,1,0,1),js=new h.aM(0,0,1,1),Fu=new h.aM(1,0,1,1),Al=new h.aM(0,1,1,1);function ar(_,e,o,d){f(_,0,e+o/2,_.transform.width,o,d)}function vs(_,e,o,d){f(_,e-o/2,0,o,_.transform.height,d)}function f(_,e,o,d,p,y){const T=_.context,A=T.gl;A.enable(A.SCISSOR_TEST),A.scissor(e*_.pixelRatio,o*_.pixelRatio,d*_.pixelRatio,p*_.pixelRatio),T.clear({color:y}),A.disable(A.SCISSOR_TEST)}function i(_,e,o){const d=_.context,p=d.gl,y=o.posMatrix,T=_.useProgram("debug"),A=Mn.disabled,D=oi.disabled,U=_.colorModeForRenderPass(),$="$debug",Z=_.style.map.terrain&&_.style.map.terrain.getTerrainData(o);d.activeTexture.set(p.TEXTURE0);const Q=e.getTileByID(o.key).latestRawTileData,oe=Math.floor((Q&&Q.byteLength||0)/1024),he=e.getTile(o).tileSize,pe=512/Math.min(he,512)*(o.overscaledZ/_.transform.zoom)*.5;let ge=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(ge+=` => ${o.overscaledZ}`),(function(ve,Se){ve.initDebugOverlayCanvas();const me=ve.debugOverlayCanvas,Ae=ve.context.gl,ze=ve.debugOverlayCanvas.getContext("2d");ze.clearRect(0,0,me.width,me.height),ze.shadowColor="white",ze.shadowBlur=2,ze.lineWidth=1.5,ze.strokeStyle="white",ze.textBaseline="top",ze.font="bold 36px Open Sans, sans-serif",ze.fillText(Se,5,5),ze.strokeText(Se,5,5),ve.debugOverlayTexture.update(me),ve.debugOverlayTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE)})(_,`${ge} ${oe}kB`),T.draw(d,p.TRIANGLES,A,D,Ri.alphaBlended,Jn.disabled,Ii(y,h.aM.transparent,pe),null,$,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),T.draw(d,p.LINE_STRIP,A,D,U,Jn.disabled,Ii(y,h.aM.red),Z,$,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function s(_,e,o){const d=_.context,p=d.gl,y=_.colorModeForRenderPass(),T=new Mn(p.LEQUAL,Mn.ReadWrite,_.depthRangeFor3D),A=_.useProgram("terrain"),D=e.getTerrainMesh();d.bindFramebuffer.set(null),d.viewport.set([0,0,_.width,_.height]);for(const U of o){const $=_.renderToTexture.getTexture(U),Z=e.getTerrainData(U.tileID);d.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,$.texture);const Q=_.transform.calculatePosMatrix(U.tileID.toUnwrapped()),oe=e.getMeshFrameDelta(_.transform.zoom),he=_.transform.calculateFogMatrix(U.tileID.toUnwrapped()),pe=au(Q,oe,he,_.style.sky,_.transform.pitch);A.draw(d,p.TRIANGLES,T,oi.disabled,y,Jn.backCCW,pe,Z,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}}class c{constructor(e,o,d){this.vertexBuffer=e,this.indexBuffer=o,this.segments=d}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class w{constructor(e,o){this.context=new pc(e),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=dt.maxUnderzooming+dt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ls}resize(e,o,d){if(this.width=Math.floor(e*d),this.height=Math.floor(o*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const e=this.context,o=new h.aX;o.emplaceBack(0,0),o.emplaceBack(h.X,0),o.emplaceBack(0,h.X),o.emplaceBack(h.X,h.X),this.tileExtentBuffer=e.createVertexBuffer(o,Nr.members),this.tileExtentSegments=h.a0.simpleSegment(0,0,4,2);const d=new h.aX;d.emplaceBack(0,0),d.emplaceBack(h.X,0),d.emplaceBack(0,h.X),d.emplaceBack(h.X,h.X),this.debugBuffer=e.createVertexBuffer(d,Nr.members),this.debugSegments=h.a0.simpleSegment(0,0,4,5);const p=new h.$;p.emplaceBack(0,0,0,0),p.emplaceBack(h.X,0,h.X,0),p.emplaceBack(0,h.X,0,h.X),p.emplaceBack(h.X,h.X,h.X,h.X),this.rasterBoundsBuffer=e.createVertexBuffer(p,pr.members),this.rasterBoundsSegments=h.a0.simpleSegment(0,0,4,2);const y=new h.aX;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,Nr.members),this.viewportSegments=h.a0.simpleSegment(0,0,4,2);const T=new h.aZ;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(T);const A=new h.aY;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(A);const D=this.context.gl;this.stencilClearMode=new oi({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO)}clearStencil(){const e=this.context,o=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=h.H();h.aP(d,0,this.width,this.height,0,0,1),h.K(d,d,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,o.TRIANGLES,Mn.disabled,this.stencilClearMode,Ri.disabled,Jn.disabled,Wn(d),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,o){if(this.currentStencilSource===e.source||!e.isTileClipped()||!o||!o.length)return;this.currentStencilSource=e.source;const d=this.context,p=d.gl;this.nextStencilID+o.length>256&&this.clearStencil(),d.setColorMode(Ri.disabled),d.setDepthMode(Mn.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of o){const A=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T);y.draw(d,p.TRIANGLES,Mn.disabled,new oi({func:p.ALWAYS,mask:0},A,255,p.KEEP,p.KEEP,p.REPLACE),Ri.disabled,Jn.disabled,Wn(T.posMatrix),D,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,o=this.context.gl;return new oi({func:o.NOTEQUAL,mask:255},e,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(e){const o=this.context.gl;return new oi({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(e){const o=this.context.gl,d=e.sort(((T,A)=>A.overscaledZ-T.overscaledZ)),p=d[d.length-1].overscaledZ,y=d[0].overscaledZ-p+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const T={};for(let A=0;A<y;A++)T[A+p]=new oi({func:o.GEQUAL,mask:255},A+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=y,[T,d]}return[{[p]:oi.disabled},d]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Ri([e.CONSTANT_COLOR,e.ONE],new h.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ri.unblended:Ri.alphaBlended}depthModeForSublayer(e,o,d){if(!this.opaquePassEnabledForLayer())return Mn.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Mn(d||this.context.gl.LEQUAL,o,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,o){this.style=e,this.options=o,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(B.now()),this.imageManager.beginFrame();const d=this.style._order,p=this.style.sourceCaches,y={},T={},A={};for(const D in p){const U=p[D];U.used&&U.prepare(this.context),y[D]=U.getVisibleCoordinates(),T[D]=y[D].slice().reverse(),A[D]=U.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<d.length;D++)if(this.style._layers[d[D]].is3D()){this.opaquePassCutoff=D;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const D of d){const U=this.style._layers[D];if(!U.hasOffscreenPass()||U.isHidden(this.transform.zoom))continue;const $=T[U.source];(U.type==="custom"||$.length)&&this.renderLayer(this,p[U.source],U,$)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?h.aM.black:h.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(D,U){const $=D.context,Z=$.gl,Q=((ve,Se,me)=>({u_sky_color:ve.properties.get("sky-color"),u_horizon_color:ve.properties.get("horizon-color"),u_horizon:(Se.height/2+Se.getHorizon())*me,u_sky_horizon_blend:ve.properties.get("sky-horizon-blend")*Se.height/2*me}))(U,D.style.map.transform,D.pixelRatio),oe=new Mn(Z.LEQUAL,Mn.ReadWrite,[0,1]),he=oi.disabled,pe=D.colorModeForRenderPass(),ge=D.useProgram("sky");if(!U.mesh){const ve=new h.aX;ve.emplaceBack(-1,-1),ve.emplaceBack(1,-1),ve.emplaceBack(1,1),ve.emplaceBack(-1,1);const Se=new h.aY;Se.emplaceBack(0,1,2),Se.emplaceBack(0,2,3),U.mesh=new c($.createVertexBuffer(ve,Nr.members),$.createIndexBuffer(Se),h.a0.simpleSegment(0,0,ve.length,Se.length))}ge.draw($,Z.TRIANGLES,oe,he,pe,Jn.disabled,Q,void 0,"sky",U.mesh.vertexBuffer,U.mesh.indexBuffer,U.mesh.segments)})(this,this.style.sky),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[d[this.currentLayer]],U=p[D.source],$=y[D.source];this._renderTileClippingMasks(D,$),this.renderLayer(this,U,D,$)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const D=this.style._layers[d[this.currentLayer]],U=p[D.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(D))continue;const $=(D.type==="symbol"?A:T)[D.source];this._renderTileClippingMasks(D,y[D.source]),this.renderLayer(this,U,D,$)}if(this.options.showTileBoundaries){const D=(function(U,$){let Z=null;const Q=Object.values(U._layers).flatMap((ge=>ge.source&&!ge.isHidden($)?[U.sourceCaches[ge.source]]:[])),oe=Q.filter((ge=>ge.getSource().type==="vector")),he=Q.filter((ge=>ge.getSource().type!=="vector")),pe=ge=>{(!Z||Z.getSource().maxzoom<ge.getSource().maxzoom)&&(Z=ge)};return oe.forEach((ge=>pe(ge))),Z||he.forEach((ge=>pe(ge))),Z})(this.style,this.transform.zoom);D&&(function(U,$,Z){for(let Q=0;Q<Z.length;Q++)i(U,$,Z[Q])})(this,D,D.getVisibleCoordinates())}this.options.showPadding&&(function(D){const U=D.transform.padding;ar(D,D.transform.height-(U.top||0),3,sl),ar(D,U.bottom||0,3,jn),vs(D,U.left||0,3,js),vs(D,D.transform.width-(U.right||0),3,Fu);const $=D.transform.centerPoint;(function(Z,Q,oe,he){f(Z,Q-1,oe-10,2,20,he),f(Z,Q-10,oe-1,20,2,he)})(D,$.x,D.transform.height-$.y,Al)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,d=this.transform.modelViewProjectionMatrix;let p=this.terrainFacilitator.dirty;p||(p=e?!h.a_(o,d):!h.a$(o,d)),p||(p=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),p&&(h.b0(o,d),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(y,T){const A=y.context,D=A.gl,U=Ri.unblended,$=new Mn(D.LEQUAL,Mn.ReadWrite,[0,1]),Z=T.getTerrainMesh(),Q=T.sourceCache.getRenderableTiles(),oe=y.useProgram("terrainDepth");A.bindFramebuffer.set(T.getFramebuffer("depth").framebuffer),A.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),A.clear({color:h.aM.transparent,depth:1});for(const he of Q){const pe=T.getTerrainData(he.tileID),ge={u_matrix:y.transform.calculatePosMatrix(he.tileID.toUnwrapped()),u_ele_delta:T.getMeshFrameDelta(y.transform.zoom)};oe.draw(A,D.TRIANGLES,$,oi.disabled,U,Jn.backCCW,ge,pe,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}A.bindFramebuffer.set(null),A.viewport.set([0,0,y.width,y.height])})(this,this.style.map.terrain),(function(y,T){const A=y.context,D=A.gl,U=Ri.unblended,$=new Mn(D.LEQUAL,Mn.ReadWrite,[0,1]),Z=T.getTerrainMesh(),Q=T.getCoordsTexture(),oe=T.sourceCache.getRenderableTiles(),he=y.useProgram("terrainCoords");A.bindFramebuffer.set(T.getFramebuffer("coords").framebuffer),A.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),A.clear({color:h.aM.transparent,depth:1}),T.coordsIndex=[];for(const pe of oe){const ge=T.getTerrainData(pe.tileID);A.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,Q.texture);const ve={u_matrix:y.transform.calculatePosMatrix(pe.tileID.toUnwrapped()),u_terrain_coords_id:(255-T.coordsIndex.length)/255,u_texture:0,u_ele_delta:T.getMeshFrameDelta(y.transform.zoom)};he.draw(A,D.TRIANGLES,$,oi.disabled,U,Jn.backCCW,ve,ge,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments),T.coordsIndex.push(pe.tileID.key)}A.bindFramebuffer.set(null),A.viewport.set([0,0,y.width,y.height])})(this,this.style.map.terrain))}renderLayer(e,o,d,p){if(!d.isHidden(this.transform.zoom)&&(d.type==="background"||d.type==="custom"||(p||[]).length))switch(this.id=d.id,d.type){case"symbol":(function(y,T,A,D,U){if(y.renderPass!=="translucent")return;const $=oi.disabled,Z=y.colorModeForRenderPass();(A._unevaluatedLayout.hasValue("text-variable-anchor")||A._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(Q,oe,he,pe,ge,ve,Se,me,Ae){const ze=oe.transform,Ve=Qr(),at=ge==="map",yt=ve==="map";for(const kt of Q){const Lt=pe.getTile(kt),Et=Lt.getBucket(he);if(!Et||!Et.text||!Et.text.segments.get().length)continue;const bt=h.ag(Et.textSizeData,ze.zoom),Ut=Sn(Lt,1,oe.transform.zoom),gn=Mi(kt.posMatrix,yt,at,oe.transform,Ut),It=he.layout.get("icon-text-fit")!=="none"&&Et.hasIconData();if(bt){const Ct=Math.pow(2,ze.zoom-Lt.tileID.overscaledZ),mn=oe.style.map.terrain?(En,Pn)=>oe.style.map.terrain.getElevation(kt,En,Pn):null,li=Ve.translatePosition(ze,Lt,Se,me);no(Et,at,yt,Ae,ze,gn,kt.posMatrix,Ct,bt,It,Ve,li,kt.toUnwrapped(),mn)}}})(D,y,A,T,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),U),A.paint.get("icon-opacity").constantOr(1)!==0&&Da(y,T,A,D,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),$,Z),A.paint.get("text-opacity").constantOr(1)!==0&&Da(y,T,A,D,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),$,Z),T.map.showCollisionBoxes&&(rl(y,T,A,D,!0),rl(y,T,A,D,!1))})(e,o,d,p,this.style.placement.variableOffsets);break;case"circle":(function(y,T,A,D){if(y.renderPass!=="translucent")return;const U=A.paint.get("circle-opacity"),$=A.paint.get("circle-stroke-width"),Z=A.paint.get("circle-stroke-opacity"),Q=!A.layout.get("circle-sort-key").isConstant();if(U.constantOr(1)===0&&($.constantOr(1)===0||Z.constantOr(1)===0))return;const oe=y.context,he=oe.gl,pe=y.depthModeForSublayer(0,Mn.ReadOnly),ge=oi.disabled,ve=y.colorModeForRenderPass(),Se=[];for(let me=0;me<D.length;me++){const Ae=D[me],ze=T.getTile(Ae),Ve=ze.getBucket(A);if(!Ve)continue;const at=Ve.programConfigurations.get(A.id),yt=y.useProgram("circle",at),kt=Ve.layoutVertexBuffer,Lt=Ve.indexBuffer,Et=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ae),bt={programConfiguration:at,program:yt,layoutVertexBuffer:kt,indexBuffer:Lt,uniformValues:yl(y,Ae,ze,A),terrainData:Et};if(Q){const Ut=Ve.segments.get();for(const gn of Ut)Se.push({segments:new h.a0([gn]),sortKey:gn.sortKey,state:bt})}else Se.push({segments:Ve.segments,sortKey:0,state:bt})}Q&&Se.sort(((me,Ae)=>me.sortKey-Ae.sortKey));for(const me of Se){const{programConfiguration:Ae,program:ze,layoutVertexBuffer:Ve,indexBuffer:at,uniformValues:yt,terrainData:kt}=me.state;ze.draw(oe,he.TRIANGLES,pe,ge,ve,Jn.disabled,yt,kt,A.id,Ve,at,me.segments,A.paint,y.transform.zoom,Ae)}})(e,o,d,p);break;case"heatmap":(function(y,T,A,D){if(A.paint.get("heatmap-opacity")===0)return;const U=y.context;if(y.style.map.terrain){for(const $ of D){const Z=T.getTile($);T.hasRenderableParent($)||(y.renderPass==="offscreen"?cu(y,Z,A,$):y.renderPass==="translucent"&&za(y,A,$))}U.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?(function($,Z,Q,oe){const he=$.context,pe=he.gl,ge=oi.disabled,ve=new Ri([pe.ONE,pe.ONE],h.aM.transparent,[!0,!0,!0,!0]);(function(Se,me,Ae){const ze=Se.gl;Se.activeTexture.set(ze.TEXTURE1),Se.viewport.set([0,0,me.width/4,me.height/4]);let Ve=Ae.heatmapFbos.get(h.aU);Ve?(ze.bindTexture(ze.TEXTURE_2D,Ve.colorAttachment.get()),Se.bindFramebuffer.set(Ve.framebuffer)):(Ve=io(Se,me.width/4,me.height/4),Ae.heatmapFbos.set(h.aU,Ve))})(he,$,Q),he.clear({color:h.aM.transparent});for(let Se=0;Se<oe.length;Se++){const me=oe[Se];if(Z.hasRenderableParent(me))continue;const Ae=Z.getTile(me),ze=Ae.getBucket(Q);if(!ze)continue;const Ve=ze.programConfigurations.get(Q.id),at=$.useProgram("heatmap",Ve),{zoom:yt}=$.transform;at.draw(he,pe.TRIANGLES,Mn.disabled,ge,ve,Jn.disabled,ji(me.posMatrix,Ae,yt,Q.paint.get("heatmap-intensity")),null,Q.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,Q.paint,$.transform.zoom,Ve)}he.viewport.set([0,0,$.width,$.height])})(y,T,A,D):y.renderPass==="translucent"&&(function($,Z){const Q=$.context,oe=Q.gl;Q.setColorMode($.colorModeForRenderPass());const he=Z.heatmapFbos.get(h.aU);he&&(Q.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_2D,he.colorAttachment.get()),Q.activeTexture.set(oe.TEXTURE1),ro(Q,Z).bind(oe.LINEAR,oe.CLAMP_TO_EDGE),$.useProgram("heatmapTexture").draw(Q,oe.TRIANGLES,Mn.disabled,oi.disabled,$.colorModeForRenderPass(),Jn.disabled,La($,Z,0,1),null,Z.id,$.viewportBuffer,$.quadTriangleIndexBuffer,$.viewportSegments,Z.paint,$.transform.zoom))})(y,A)})(e,o,d,p);break;case"line":(function(y,T,A,D){if(y.renderPass!=="translucent")return;const U=A.paint.get("line-opacity"),$=A.paint.get("line-width");if(U.constantOr(1)===0||$.constantOr(1)===0)return;const Z=y.depthModeForSublayer(0,Mn.ReadOnly),Q=y.colorModeForRenderPass(),oe=A.paint.get("line-dasharray"),he=A.paint.get("line-pattern"),pe=he.constantOr(1),ge=A.paint.get("line-gradient"),ve=A.getCrossfadeParameters(),Se=pe?"linePattern":oe?"lineSDF":ge?"lineGradient":"line",me=y.context,Ae=me.gl;let ze=!0;for(const Ve of D){const at=T.getTile(Ve);if(pe&&!at.patternsLoaded())continue;const yt=at.getBucket(A);if(!yt)continue;const kt=yt.programConfigurations.get(A.id),Lt=y.context.program.get(),Et=y.useProgram(Se,kt),bt=ze||Et.program!==Lt,Ut=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ve),gn=he.constantOr(null);if(gn&&at.imageAtlas){const mn=at.imageAtlas,li=mn.patternPositions[gn.to.toString()],En=mn.patternPositions[gn.from.toString()];li&&En&&kt.setConstantPatternPositions(li,En)}const It=Ut?Ve:null,Ct=pe?Ns(y,at,A,ve,It):oe?Lu(y,at,A,oe,ve,It):ge?Ao(y,at,A,yt.lineClipsArray.length,It):Ko(y,at,A,It);if(pe)me.activeTexture.set(Ae.TEXTURE0),at.imageAtlasTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),kt.updatePaintBuffers(ve);else if(oe&&(bt||y.lineAtlas.dirty))me.activeTexture.set(Ae.TEXTURE0),y.lineAtlas.bind(me);else if(ge){const mn=yt.gradients[A.id];let li=mn.texture;if(A.gradientVersion!==mn.version){let En=256;if(A.stepInterpolant){const Pn=T.getSource().maxzoom,ci=Ve.canonical.z===Pn?Math.ceil(1<<y.transform.maxZoom-Ve.canonical.z):1;En=h.ac(h.aV(yt.maxLineLength/h.X*1024*ci),256,me.maxTextureSize)}mn.gradient=h.aW({expression:A.gradientExpression(),evaluationKey:"lineProgress",resolution:En,image:mn.gradient||void 0,clips:yt.lineClipsArray}),mn.texture?mn.texture.update(mn.gradient):mn.texture=new St(me,mn.gradient,Ae.RGBA),mn.version=A.gradientVersion,li=mn.texture}me.activeTexture.set(Ae.TEXTURE0),li.bind(A.stepInterpolant?Ae.NEAREST:Ae.LINEAR,Ae.CLAMP_TO_EDGE)}Et.draw(me,Ae.TRIANGLES,Z,y.stencilModeForClipping(Ve),Q,Jn.disabled,Ct,Ut,A.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,A.paint,y.transform.zoom,kt,yt.layoutVertexBuffer2),ze=!1}})(e,o,d,p);break;case"fill":(function(y,T,A,D){const U=A.paint.get("fill-color"),$=A.paint.get("fill-opacity");if($.constantOr(1)===0)return;const Z=y.colorModeForRenderPass(),Q=A.paint.get("fill-pattern"),oe=y.opaquePassEnabledForLayer()&&!Q.constantOr(1)&&U.constantOr(h.aM.transparent).a===1&&$.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===oe){const he=y.depthModeForSublayer(1,y.renderPass==="opaque"?Mn.ReadWrite:Mn.ReadOnly);Bs(y,T,A,D,he,Z,!1)}if(y.renderPass==="translucent"&&A.paint.get("fill-antialias")){const he=y.depthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,Mn.ReadOnly);Bs(y,T,A,D,he,Z,!0)}})(e,o,d,p);break;case"fill-extrusion":(function(y,T,A,D){const U=A.paint.get("fill-extrusion-opacity");if(U!==0&&y.renderPass==="translucent"){const $=new Mn(y.context.gl.LEQUAL,Mn.ReadWrite,y.depthRangeFor3D);if(U!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))No(y,T,A,D,$,oi.disabled,Ri.disabled),No(y,T,A,D,$,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const Z=y.colorModeForRenderPass();No(y,T,A,D,$,oi.disabled,Z)}}})(e,o,d,p);break;case"hillshade":(function(y,T,A,D){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const U=y.context,$=y.depthModeForSublayer(0,Mn.ReadOnly),Z=y.colorModeForRenderPass(),[Q,oe]=y.renderPass==="translucent"?y.stencilConfigForOverlap(D):[{},D];for(const he of oe){const pe=T.getTile(he);pe.needsHillshadePrepare!==void 0&&pe.needsHillshadePrepare&&y.renderPass==="offscreen"?so(y,pe,A,$,oi.disabled,Z):y.renderPass==="translucent"&&ha(y,he,pe,A,$,Q[he.overscaledZ],Z)}U.viewport.set([0,0,y.width,y.height])})(e,o,d,p);break;case"raster":(function(y,T,A,D){if(y.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!D.length)return;const U=y.context,$=U.gl,Z=T.getSource(),Q=y.useProgram("raster"),oe=y.colorModeForRenderPass(),[he,pe]=Z instanceof As?[{},D]:y.stencilConfigForOverlap(D),ge=pe[pe.length-1].overscaledZ,ve=!y.options.moving;for(const Se of pe){const me=y.depthModeForSublayer(Se.overscaledZ-ge,A.paint.get("raster-opacity")===1?Mn.ReadWrite:Mn.ReadOnly,$.LESS),Ae=T.getTile(Se);Ae.registerFadeDuration(A.paint.get("raster-fade-duration"));const ze=T.findLoadedParent(Se,0),Ve=T.findLoadedSibling(Se),at=Ml(Ae,ze||Ve||null,T,A,y.transform,y.style.map.terrain);let yt,kt;const Lt=A.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR;U.activeTexture.set($.TEXTURE0),Ae.texture.bind(Lt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),U.activeTexture.set($.TEXTURE1),ze?(ze.texture.bind(Lt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),yt=Math.pow(2,ze.tileID.overscaledZ-Ae.tileID.overscaledZ),kt=[Ae.tileID.canonical.x*yt%1,Ae.tileID.canonical.y*yt%1]):Ae.texture.bind(Lt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),Ae.texture.useMipmap&&U.extTextureFilterAnisotropic&&y.transform.pitch>20&&$.texParameterf($.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);const Et=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Se),bt=Et?Se:null,Ut=bt?bt.posMatrix:y.transform.calculatePosMatrix(Se.toUnwrapped(),ve),gn=_l(Ut,kt||[0,0],yt||1,at,A);Z instanceof As?Q.draw(U,$.TRIANGLES,me,oi.disabled,oe,Jn.disabled,gn,Et,A.id,Z.boundsBuffer,y.quadTriangleIndexBuffer,Z.boundsSegments):Q.draw(U,$.TRIANGLES,me,he[Se.overscaledZ],oe,Jn.disabled,gn,Et,A.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(e,o,d,p);break;case"background":(function(y,T,A,D){const U=A.paint.get("background-color"),$=A.paint.get("background-opacity");if($===0)return;const Z=y.context,Q=Z.gl,oe=y.transform,he=oe.tileSize,pe=A.paint.get("background-pattern");if(y.isPatternMissing(pe))return;const ge=!pe&&U.a===1&&$===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ge)return;const ve=oi.disabled,Se=y.depthModeForSublayer(0,ge==="opaque"?Mn.ReadWrite:Mn.ReadOnly),me=y.colorModeForRenderPass(),Ae=y.useProgram(pe?"backgroundPattern":"background"),ze=D||oe.coveringTiles({tileSize:he,terrain:y.style.map.terrain});pe&&(Z.activeTexture.set(Q.TEXTURE0),y.imageManager.bind(y.context));const Ve=A.getCrossfadeParameters();for(const at of ze){const yt=D?at.posMatrix:y.transform.calculatePosMatrix(at.toUnwrapped()),kt=pe?Jo(yt,$,y,pe,{tileID:at,tileSize:he},Ve):Ra(yt,$,U),Lt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(at);Ae.draw(Z,Q.TRIANGLES,Se,ve,me,Jn.disabled,kt,Lt,A.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(e,0,d,p);break;case"custom":(function(y,T,A){const D=y.context,U=A.implementation;if(y.renderPass==="offscreen"){const $=U.prerender;$&&(y.setCustomLayerDefaults(),D.setColorMode(y.colorModeForRenderPass()),$.call(U,D.gl,y.transform.customLayerMatrix()),D.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),D.setColorMode(y.colorModeForRenderPass()),D.setStencilMode(oi.disabled);const $=U.renderingMode==="3d"?new Mn(y.context.gl.LEQUAL,Mn.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,Mn.ReadOnly);D.setDepthMode($),U.render(D.gl,y.transform.customLayerMatrix(),{farZ:y.transform.farZ,nearZ:y.transform.nearZ,fov:y.transform._fov,modelViewProjectionMatrix:y.transform.modelViewProjectionMatrix,projectionMatrix:y.transform.projectionMatrix}),D.setDirty(),y.setBaseState(),D.bindFramebuffer.set(null)}})(e,0,d)}}translatePosMatrix(e,o,d,p,y){if(!d[0]&&!d[1])return e;const T=y?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(T){const U=Math.sin(T),$=Math.cos(T);d=[d[0]*$-d[1]*U,d[0]*U+d[1]*$]}const A=[y?d[0]:Sn(o,d[0],this.transform.zoom),y?d[1]:Sn(o,d[1],this.transform.zoom),0],D=new Float32Array(16);return h.J(D,e,A),D}saveTileTexture(e){const o=this._tileTextures[e.size[0]];o?o.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const o=this._tileTextures[e];return o&&o.length>0?o.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const o=this.imageManager.getPattern(e.from.toString()),d=this.imageManager.getPattern(e.to.toString());return!o||!d}useProgram(e,o){this.cache=this.cache||{};const d=e+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[d]||(this.cache[d]=new qn(this.context,oa[e],o,vl[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new St(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:o}=this.context.gl;return this.width!==e||this.height!==o}}class L{constructor(e,o){this.points=e,this.planes=o}static fromInvProjectionMatrix(e,o,d){const p=Math.pow(2,d),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((A=>{const D=1/(A=h.af([],A,e))[3]/o*p;return h.b1(A,A,[D,D,1/A[3],D])})),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((A=>{const D=(function(Q,oe){var he=oe[0],pe=oe[1],ge=oe[2],ve=he*he+pe*pe+ge*ge;return ve>0&&(ve=1/Math.sqrt(ve)),Q[0]=oe[0]*ve,Q[1]=oe[1]*ve,Q[2]=oe[2]*ve,Q})([],(function(Q,oe,he){var pe=oe[0],ge=oe[1],ve=oe[2],Se=he[0],me=he[1],Ae=he[2];return Q[0]=ge*Ae-ve*me,Q[1]=ve*Se-pe*Ae,Q[2]=pe*me-ge*Se,Q})([],Ge([],y[A[0]],y[A[1]]),Ge([],y[A[2]],y[A[1]]))),U=-(($=D)[0]*(Z=y[A[1]])[0]+$[1]*Z[1]+$[2]*Z[2]);var $,Z;return D.concat(U)}));return new L(y,T)}}class F{constructor(e,o){this.min=e,this.max=o,this.center=(function(d,p,y){return d[0]=.5*p[0],d[1]=.5*p[1],d[2]=.5*p[2],d})([],(function(d,p,y){return d[0]=p[0]+y[0],d[1]=p[1]+y[1],d[2]=p[2]+y[2],d})([],this.min,this.max))}quadrant(e){const o=[e%2==0,e<2],d=nt(this.min),p=nt(this.max);for(let y=0;y<o.length;y++)d[y]=o[y]?this.min[y]:this.center[y],p[y]=o[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new F(d,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let d=!0;for(let p=0;p<e.planes.length;p++){const y=e.planes[p];let T=0;for(let A=0;A<o.length;A++)h.b2(y,o[A])>=0&&T++;if(T===0)return 0;T!==o.length&&(d=!1)}if(d)return 2;for(let p=0;p<3;p++){let y=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let A=0;A<e.points.length;A++){const D=e.points[A][p]-this.min[p];y=Math.min(y,D),T=Math.max(T,D)}if(T<0||y>this.max[p]-this.min[p])return 0}return 1}}class H{constructor(e=0,o=0,d=0,p=0){if(isNaN(e)||e<0||isNaN(o)||o<0||isNaN(d)||d<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=o,this.left=d,this.right=p}interpolate(e,o,d){return o.top!=null&&e.top!=null&&(this.top=h.y.number(e.top,o.top,d)),o.bottom!=null&&e.bottom!=null&&(this.bottom=h.y.number(e.bottom,o.bottom,d)),o.left!=null&&e.left!=null&&(this.left=h.y.number(e.left,o.left,d)),o.right!=null&&e.right!=null&&(this.right=h.y.number(e.right,o.right,d)),this}getCenter(e,o){const d=h.ac((this.left+e-this.right)/2,0,e),p=h.ac((this.top+o-this.bottom)/2,0,o);return new h.P(d,p)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new H(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const re=85.051129;class fe{constructor(e,o,d,p,y){this.tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=e||0,this._maxZoom=o||22,this._minPitch=d??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new H,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new fe(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const o=-h.b3(e,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=(function(){var d=new h.A(4);return h.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d})(),(function(d,p,y){var T=p[0],A=p[1],D=p[2],U=p[3],$=Math.sin(y),Z=Math.cos(y);d[0]=T*Z+D*$,d[1]=A*Z+U*$,d[2]=T*-$+D*Z,d[3]=A*-$+U*Z})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const o=h.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const o=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,o,d){this._unmodified=!1,this._edgeInsets.interpolate(e,o,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const o=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(e){const o=[new h.b4(0,e)];if(this._renderWorldCopies){const d=this.pointCoordinate(new h.P(0,0)),p=this.pointCoordinate(new h.P(this.width,0)),y=this.pointCoordinate(new h.P(this.width,this.height)),T=this.pointCoordinate(new h.P(0,this.height)),A=Math.floor(Math.min(d.x,p.x,y.x,T.x)),D=Math.floor(Math.max(d.x,p.x,y.x,T.x)),U=1;for(let $=A-U;$<=D+U;$++)$!==0&&o.push(new h.b4($,e))}return o}coveringTiles(e){var o,d;let p=this.coveringZoomLevel(e);const y=p;if(e.minzoom!==void 0&&p<e.minzoom)return[];e.maxzoom!==void 0&&p>e.maxzoom&&(p=e.maxzoom);const T=this.pointCoordinate(this.getCameraPoint()),A=h.Z.fromLngLat(this.center),D=Math.pow(2,p),U=[D*T.x,D*T.y,0],$=[D*A.x,D*A.y,0],Z=L.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,p);let Q=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Q=p);const oe=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,he=me=>({aabb:new F([me*D,0,0],[(me+1)*D,D,0]),zoom:0,x:0,y:0,wrap:me,fullyVisible:!1}),pe=[],ge=[],ve=p,Se=e.reparseOverscaled?y:p;if(this._renderWorldCopies)for(let me=1;me<=3;me++)pe.push(he(-me)),pe.push(he(me));for(pe.push(he(0));pe.length>0;){const me=pe.pop(),Ae=me.x,ze=me.y;let Ve=me.fullyVisible;if(!Ve){const Et=me.aabb.intersects(Z);if(Et===0)continue;Ve=Et===2}const at=e.terrain?U:$,yt=me.aabb.distanceX(at),kt=me.aabb.distanceY(at),Lt=Math.max(Math.abs(yt),Math.abs(kt));if(me.zoom===ve||Lt>oe+(1<<ve-me.zoom)-2&&me.zoom>=Q){const Et=ve-me.zoom,bt=U[0]-.5-(Ae<<Et),Ut=U[1]-.5-(ze<<Et);ge.push({tileID:new h.S(me.zoom===ve?Se:me.zoom,me.wrap,me.zoom,Ae,ze),distanceSq:ht([$[0]-.5-Ae,$[1]-.5-ze]),tileDistanceToCamera:Math.sqrt(bt*bt+Ut*Ut)})}else for(let Et=0;Et<4;Et++){const bt=(Ae<<1)+Et%2,Ut=(ze<<1)+(Et>>1),gn=me.zoom+1;let It=me.aabb.quadrant(Et);if(e.terrain){const Ct=new h.S(gn,me.wrap,gn,bt,Ut),mn=e.terrain.getMinMaxElevation(Ct),li=(o=mn.minElevation)!==null&&o!==void 0?o:this.elevation,En=(d=mn.maxElevation)!==null&&d!==void 0?d:this.elevation;It=new F([It.min[0],It.min[1],li],[It.max[0],It.max[1],En])}pe.push({aabb:It,zoom:gn,x:bt,y:Ut,wrap:me.wrap,fullyVisible:Ve})}}return ge.sort(((me,Ae)=>me.distanceSq-Ae.distanceSq)).map((me=>me.tileID))}resize(e,o){this.width=e,this.height=o,this.pixelsToGLUnits=[2/e,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const o=h.ac(e.lat,-85.051129,re);return new h.P(h.O(e.lng)*this.worldSize,h.Q(o)*this.worldSize)}unproject(e){return new h.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const o=this.elevation,d=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,p=this.pointLocation(this.centerPoint,e),y=e.getElevationForLngLatZoom(p,this.tileZoom);if(!(this.elevation-y))return;const T=d+o-y,A=Math.cos(this._pitch)*this.cameraToCenterDistance/T/h.b5(1,p.lat),D=this.scaleZoom(A/this.tileSize);this._elevation=y,this._center=p,this.zoom=D}setLocationAtPoint(e,o){const d=this.pointCoordinate(o),p=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(e),T=new h.Z(y.x-(d.x-p.x),y.y-(d.y-p.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,o){return o?this.coordinatePoint(this.locationCoordinate(e),o.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,o){return this.coordinateLocation(this.pointCoordinate(e,o))}locationCoordinate(e){return h.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,o){if(o){const Q=o.pointCoordinate(e);if(Q!=null)return Q}const d=[e.x,e.y,0,1],p=[e.x,e.y,1,1];h.af(d,d,this.pixelMatrixInverse),h.af(p,p,this.pixelMatrixInverse);const y=d[3],T=p[3],A=d[1]/y,D=p[1]/T,U=d[2]/y,$=p[2]/T,Z=U===$?0:(0-U)/($-U);return new h.Z(h.y.number(d[0]/y,p[0]/T,Z)/this.worldSize,h.y.number(A,D,Z)/this.worldSize)}coordinatePoint(e,o=0,d=this.pixelMatrix){const p=[e.x*this.worldSize,e.y*this.worldSize,o,1];return h.af(p,p,d),new h.P(p[0]/p[3],p[1]/p[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new We().extend(this.pointLocation(new h.P(0,e))).extend(this.pointLocation(new h.P(this.width,e))).extend(this.pointLocation(new h.P(this.width,this.height))).extend(this.pointLocation(new h.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new We([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,re])}calculateTileMatrix(e){const o=e.canonical,d=this.worldSize/this.zoomScale(o.z),p=o.x+Math.pow(2,o.z)*e.wrap,y=h.an(new Float64Array(16));return h.J(y,y,[p*d,o.y*d,0]),h.K(y,y,[d/h.X,d/h.X,1]),y}calculatePosMatrix(e,o=!1){const d=e.key,p=o?this._alignedPosMatrixCache:this._posMatrixCache;if(p[d])return p[d];const y=this.calculateTileMatrix(e);return h.L(y,o?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,y),p[d]=new Float32Array(y),p[d]}calculateFogMatrix(e){const o=e.key,d=this._fogMatrixCache;if(d[o])return d[o];const p=this.calculateTileMatrix(e);return h.L(p,this.fogMatrix,p),d[o]=new Float32Array(p),d[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,o){o=h.ac(+o,this.minZoom,this.maxZoom);const d={center:new h.N(e.lng,e.lat),zoom:o};let p=this.lngRange;if(!this._renderWorldCopies&&p===null){const me=179.9999999999;p=[-me,me]}const y=this.tileSize*this.zoomScale(d.zoom);let T=0,A=y,D=0,U=y,$=0,Z=0;const{x:Q,y:oe}=this.size;if(this.latRange){const me=this.latRange;T=h.Q(me[1])*y,A=h.Q(me[0])*y,A-T<oe&&($=oe/(A-T))}p&&(D=h.b3(h.O(p[0])*y,0,y),U=h.b3(h.O(p[1])*y,0,y),U<D&&(U+=y),U-D<Q&&(Z=Q/(U-D)));const{x:he,y:pe}=this.project.call({worldSize:y},e);let ge,ve;const Se=Math.max(Z||0,$||0);if(Se){const me=new h.P(Z?(U+D)/2:he,$?(A+T)/2:pe);return d.center=this.unproject.call({worldSize:y},me).wrap(),d.zoom+=this.scaleZoom(Se),d}if(this.latRange){const me=oe/2;pe-me<T&&(ve=T+me),pe+me>A&&(ve=A-me)}if(p){const me=(D+U)/2;let Ae=he;this._renderWorldCopies&&(Ae=h.b3(he,me-y/2,me+y/2));const ze=Q/2;Ae-ze<D&&(ge=D+ze),Ae+ze>U&&(ge=U-ze)}if(ge!==void 0||ve!==void 0){const me=new h.P(ge??he,ve??pe);d.center=this.unproject.call({worldSize:y},me).wrap()}return d}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:o,zoom:d}=this.getConstrained(this.center,this.zoom);this.center=o,this.zoom=d,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,o=this.point.x,d=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=h.b5(1,this.center.lat)*this.worldSize;let p=h.an(new Float64Array(16));h.K(p,p,[this.width/2,-this.height/2,1]),h.J(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=h.an(new Float64Array(16)),h.K(p,p,[1,-1,1]),h.J(p,p,[-1,-1,0]),h.K(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),T=Math.min(this.elevation,this.minElevationForCurrentTile),A=y-T*this._pixelPerMeter/Math.cos(this._pitch),D=T<0?A:y,U=Math.PI/2+this._pitch,$=this._fov*(.5+e.y/this.height),Z=Math.sin($)*D/Math.sin(h.ac(Math.PI-U-$,.01,Math.PI-.01)),Q=this.getHorizon(),oe=2*Math.atan(Q/this.cameraToCenterDistance)*(.5+e.y/(2*Q)),he=Math.sin(oe)*D/Math.sin(h.ac(Math.PI-U-oe,.01,Math.PI-.01)),pe=Math.min(Z,he);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*pe+D),this.nearZ=this.height/50,p=new Float64Array(16),h.b6(p,this._fov,this.width/this.height,this.nearZ,this.farZ),p[8]=2*-e.x/this.width,p[9]=2*e.y/this.height,this.projectionMatrix=h.ae(p),h.K(p,p,[1,-1,1]),h.J(p,p,[0,0,-this.cameraToCenterDistance]),h.b7(p,p,this._pitch),h.ad(p,p,this.angle),h.J(p,p,[-o,-d,0]),this.mercatorMatrix=h.K([],p,[this.worldSize,this.worldSize,this.worldSize]),h.K(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=h.L(new Float64Array(16),this.labelPlaneMatrix,p),h.J(p,p,[0,0,-this.elevation]),this.modelViewProjectionMatrix=p,this.invModelViewProjectionMatrix=h.as([],p),this.fogMatrix=new Float64Array(16),h.b6(this.fogMatrix,this._fov,this.width/this.height,y,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,h.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),h.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),h.b7(this.fogMatrix,this.fogMatrix,this._pitch),h.ad(this.fogMatrix,this.fogMatrix,this.angle),h.J(this.fogMatrix,this.fogMatrix,[-o,-d,0]),h.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),h.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=h.L(new Float64Array(16),this.labelPlaneMatrix,p);const ge=this.width%2/2,ve=this.height%2/2,Se=Math.cos(this.angle),me=Math.sin(this.angle),Ae=o-Math.round(o)+Se*ge+me*ve,ze=d-Math.round(d)+Se*ve+me*ge,Ve=new Float64Array(p);if(h.J(Ve,Ve,[Ae>.5?Ae-1:Ae,ze>.5?ze-1:ze,0]),this.alignedModelViewProjectionMatrix=Ve,p=h.as(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new h.P(0,0)),o=[e.x*this.worldSize,e.y*this.worldSize,0,1];return h.af(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(0,e))}getCameraQueryGeometry(e){const o=this.getCameraPoint();if(e.length===1)return[e[0],o];{let d=o.x,p=o.y,y=o.x,T=o.y;for(const A of e)d=Math.min(d,A.x),p=Math.min(p,A.y),y=Math.max(y,A.x),T=Math.max(T,A.y);return[new h.P(d,p),new h.P(y,p),new h.P(y,T),new h.P(d,T),new h.P(d,p)]}}lngLatToCameraDepth(e,o){const d=this.locationCoordinate(e),p=[d.x*this.worldSize,d.y*this.worldSize,o,1];return h.af(p,p,this.modelViewProjectionMatrix),p[2]/p[3]}}function De(_,e){let o,d=!1,p=null,y=null;const T=()=>{p=null,d&&(_.apply(y,o),p=setTimeout(T,e),d=!1)};return(...A)=>(d=!0,y=this,o=A,p||T(),p)}class $e{constructor(e){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let d;return o.split("&").map((p=>p.split("="))).forEach((p=>{p[0]===this._hashName&&(d=p)})),(d&&d[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some((d=>isNaN(d)))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:d,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,o)},this._removeHash=()=>{const o=this._getCurrentHash();if(o.length===0)return;const d=o.join("/");let p=d;p.split("&").length>0&&(p=p.split("&")[0]),this._hashName&&(p=`${this._hashName}=${d}`);let y=window.location.hash.replace(p,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let T=window.location.href.replace(/(#.+)?$/,y);T=T.replace("&&","&"),window.history.replaceState(window.history.state,null,T)},this._updateHash=De(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const o=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,p=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,p),T=Math.round(o.lng*y)/y,A=Math.round(o.lat*y)/y,D=this._map.getBearing(),U=this._map.getPitch();let $="";if($+=e?`/${T}/${A}/${d}`:`${d}/${A}/${T}`,(D||U)&&($+="/"+Math.round(10*D)/10),U&&($+=`/${Math.round(U)}`),this._hashName){const Z=this._hashName;let Q=!1;const oe=window.location.hash.slice(1).split("&").map((he=>{const pe=he.split("=")[0];return pe===Z?(Q=!0,`${pe}=${$}`):he})).filter((he=>he));return Q||oe.push(`${Z}=${$}`),`#${oe.join("&")}`}return`#${$}`}}const ut={linearity:.3,easing:h.b8(0,0,.3,1)},At=h.e({deceleration:2500,maxSpeed:1400},ut),Gt=h.e({deceleration:20,maxSpeed:1400},ut),on=h.e({deceleration:1e3,maxSpeed:360},ut),Nn=h.e({deceleration:1e3,maxSpeed:90},ut);class An{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:B.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,o=B.now();for(;e.length>0&&o-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)o.zoom+=y.zoomDelta||0,o.bearing+=y.bearingDelta||0,o.pitch+=y.pitchDelta||0,y.panDelta&&o.pan._add(y.panDelta),y.around&&(o.around=y.around),y.pinchAround&&(o.pinchAround=y.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(o.pan.mag()){const y=Ti(o.pan.mag(),d,h.e({},At,e||{}));p.offset=o.pan.mult(y.amount/o.pan.mag()),p.center=this._map.transform.center,Un(p,y)}if(o.zoom){const y=Ti(o.zoom,d,Gt);p.zoom=this._map.transform.zoom+y.amount,Un(p,y)}if(o.bearing){const y=Ti(o.bearing,d,on);p.bearing=this._map.transform.bearing+h.ac(y.amount,-179,179),Un(p,y)}if(o.pitch){const y=Ti(o.pitch,d,Nn);p.pitch=this._map.transform.pitch+y.amount,Un(p,y)}if(p.zoom||p.bearing){const y=o.pinchAround===void 0?o.around:o.pinchAround;p.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),h.e(p,{noMoveStart:!0})}}function Un(_,e){(!_.duration||_.duration<e.duration)&&(_.duration=e.duration,_.easing=e.easing)}function Ti(_,e,o){const{maxSpeed:d,linearity:p,deceleration:y}=o,T=h.ac(_*p/(e/1e3),-d,d),A=Math.abs(T)/(y*p);return{easing:o.easing,duration:1e3*A,amount:T*(A/2)}}class Yn extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,d,p={}){const y=q.mousePos(o.getCanvas(),d),T=o.unproject(y);super(e,h.e({point:y,lngLat:T,originalEvent:d},p)),this._defaultPrevented=!1,this.target=o}}class xr extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,d){const p=e==="touchend"?d.changedTouches:d.touches,y=q.touchPos(o.getCanvasContainer(),p),T=y.map((D=>o.unproject(D))),A=y.reduce(((D,U,$,Z)=>D.add(U.div(Z.length))),new h.P(0,0));super(e,{points:y,point:A,lngLats:T,lngLat:o.unproject(A),originalEvent:d}),this._defaultPrevented=!1}}class ao extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,d){super(e,{originalEvent:d}),this._defaultPrevented=!1}}class Ll{constructor(e,o){this._map=e,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new ao(e.type,this._map,e))}mousedown(e,o){return this._mousedownPos=o,this._firePreventable(new Yn(e.type,this._map,e))}mouseup(e){this._map.fire(new Yn(e.type,this._map,e))}click(e,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Yn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Yn(e.type,this._map,e))}mouseover(e){this._map.fire(new Yn(e.type,this._map,e))}mouseout(e){this._map.fire(new Yn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new xr(e.type,this._map,e))}touchmove(e){this._map.fire(new xr(e.type,this._map,e))}touchend(e){this._map.fire(new xr(e.type,this._map,e))}touchcancel(e){this._map.fire(new xr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vi{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Yn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Yn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Yn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hr{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(h.P.convert(e),this._map.terrain)}}class Tr{constructor(e,o){this._map=e,this._tr=new Hr(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,o){this.isEnabled()&&e.shiftKey&&e.button===0&&(q.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(e,o){if(!this._active)return;const d=o;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=d,this._box||(this._box=q.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const y=Math.min(p.x,d.x),T=Math.max(p.x,d.x),A=Math.min(p.y,d.y),D=Math.max(p.y,d.y);q.setTransform(this._box,`translate(${y}px,${A}px)`),this._box.style.width=T-y+"px",this._box.style.height=D-A+"px"}mouseupWindow(e,o){if(!this._active||e.button!==0)return;const d=this._startPos,p=o;if(this.reset(),q.suppressClick(),d.x!==p.x||d.y!==p.y)return this._map.fire(new h.k("boxzoomend",{originalEvent:e})),{cameraAnimation:y=>y.fitScreenCoordinates(d,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(q.remove(this._box),this._box=null),q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,o){return this._map.fire(new h.k(e,{originalEvent:o}))}}function oo(_,e){if(_.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${e.length}`);const o={};for(let d=0;d<_.length;d++)o[_[d].identifier]=e[d];return o}class xs{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,o,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),d.length===this.numTouches&&(this.centroid=(function(p){const y=new h.P(0,0);for(const T of p)y._add(T);return y.div(p.length)})(o),this.touches=oo(d,o)))}touchmove(e,o,d){if(this.aborted||!this.centroid)return;const p=oo(d,o);for(const y in this.touches){const T=p[y];(!T||T.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(e,o,d){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Oa{constructor(e){this.singleTap=new xs(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,o,d){this.singleTap.touchstart(e,o,d)}touchmove(e,o,d){this.singleTap.touchmove(e,o,d)}touchend(e,o,d){const p=this.singleTap.touchend(e,o,d);if(p){const y=e.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(p)<30;if(y&&T||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Us{constructor(e){this._tr=new Hr(e),this._zoomIn=new Oa({numTouches:1,numTaps:2}),this._zoomOut=new Oa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,o,d){this._zoomIn.touchstart(e,o,d),this._zoomOut.touchstart(e,o,d)}touchmove(e,o,d){this._zoomIn.touchmove(e,o,d),this._zoomOut.touchmove(e,o,d)}touchend(e,o,d){const p=this._zoomIn.touchend(e,o,d),y=this._zoomOut.touchend(e,o,d),T=this._tr;return p?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:T.zoom+1,around:T.unproject(p)},{originalEvent:e})}):y?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:T.zoom-1,around:T.unproject(y)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lo{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const o=this._moveFunction(...e);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(e,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,o){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const p=o.length?o[0]:o;return!this._moved&&p.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(d,p))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&q.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const mc={0:1,2:2};class Do{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const o=q.mouseButton(e);this._eventButton=o}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(o,d){const p=mc[d];return o.buttons===void 0||(o.buttons&p)!==p})(e,this._eventButton)}isValidEndEvent(e){return q.mouseButton(e)===this._eventButton}}class gc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const hu=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=e=>{e.preventDefault()}},Bu=({enable:_,clickTolerance:e,bearingDegreesPerPixelMoved:o=.8})=>{const d=new Do({checkCorrectEvent:p=>q.mouseButton(p)===0&&p.ctrlKey||q.mouseButton(p)===2});return new lo({clickTolerance:e,move:(p,y)=>({bearingDelta:(y.x-p.x)*o}),moveStateManager:d,enable:_,assignEvents:hu})},gi=({enable:_,clickTolerance:e,pitchDegreesPerPixelMoved:o=-.5})=>{const d=new Do({checkCorrectEvent:p=>q.mouseButton(p)===0&&p.ctrlKey||q.mouseButton(p)===2});return new lo({clickTolerance:e,move:(p,y)=>({pitchDelta:(y.y-p.y)*o}),moveStateManager:d,enable:_,assignEvents:hu})};class uo{constructor(e,o){this._clickTolerance=e.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,o,d){return this._calculateTransform(e,o,d)}touchmove(e,o,d){if(this._active){if(!this._shouldBePrevented(d.length))return e.preventDefault(),this._calculateTransform(e,o,d);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,o,d){this._calculateTransform(e,o,d),this._active&&this._shouldBePrevented(d.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,o,d){d.length>0&&(this._active=!0);const p=oo(d,o),y=new h.P(0,0),T=new h.P(0,0);let A=0;for(const U in p){const $=p[U],Z=this._touches[U];Z&&(y._add($),T._add($.sub(Z)),A++,p[U]=$)}if(this._touches=p,this._shouldBePrevented(A)||!T.mag())return;const D=T.div(A);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(A),panDelta:D}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class al{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,o,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([o[0],o[1]]))}touchmove(e,o,d){if(!this._firstTwoTouches)return;e.preventDefault();const[p,y]=this._firstTwoTouches,T=co(d,o,p),A=co(d,o,y);if(!T||!A)return;const D=this._aroundCenter?null:T.add(A).div(2);return this._move([T,A],D,e)}touchend(e,o,d){if(!this._firstTwoTouches)return;const[p,y]=this._firstTwoTouches,T=co(d,o,p),A=co(d,o,y);T&&A||(this._active&&q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function co(_,e,o){for(let d=0;d<_.length;d++)if(_[d].identifier===o)return e[d]}function ju(_,e){return Math.log(_/e)/Math.LN2}class fu extends al{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,o){const d=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ju(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ju(this._distance,d),pinchAround:o}}}function ol(_,e){return 180*_.angleWith(e)/Math.PI}class Rl extends al{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,o,d){const p=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ol(this._vector,p),pinchAround:o}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const o=25/(Math.PI*this._minDiameter)*360,d=ol(e,this._startVector);return Math.abs(d)<o}}function ho(_){return Math.abs(_.y)>Math.abs(_.x)}class Nl extends al{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,o,d){super.touchstart(e,o,d),this._currentTouchCount=d.length}_start(e){this._lastPoints=e,ho(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,o,d){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const p=e[0].sub(this._lastPoints[0]),y=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,y,d.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(p.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(e,o,d){if(this._valid!==void 0)return this._valid;const p=e.mag()>=2,y=o.mag()>=2;if(!p&&!y)return;if(!p||!y)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const T=e.y>0==o.y>0;return ho(e)&&ho(o)&&T}}const ih={panStep:100,bearingStep:15,pitchStep:10};class Vs{constructor(e){this._tr=new Hr(e);const o=ih;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let o=0,d=0,p=0,y=0,T=0;switch(e.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:e.shiftKey?d=-1:(e.preventDefault(),y=-1);break;case 39:e.shiftKey?d=1:(e.preventDefault(),y=1);break;case 38:e.shiftKey?p=1:(e.preventDefault(),T=-1);break;case 40:e.shiftKey?p=-1:(e.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(d=0,p=0),{cameraAnimation:A=>{const D=this._tr;A.easeTo({duration:300,easeId:"keyboardHandler",easing:fa,zoom:o?Math.round(D.zoom)+o*(e.shiftKey?2:1):D.zoom,bearing:D.bearing+d*this._bearingStep,pitch:D.pitch+p*this._pitchStep,offset:[-y*this._panStep,-T*this._panStep],center:D.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function fa(_){return _*(2-_)}const Dl=4.000244140625;class ns{constructor(e,o){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=e,this._tr=new Hr(e),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let o=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const d=B.now(),p=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,o!==0&&o%Dl==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(p*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),e.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=e,this._delta-=o,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=q.mousePos(this._map.getCanvas(),e),d=this._tr;this._around=o.y>d.transform.height/2-d.transform.getHorizon()?h.N.convert(this._aroundCenter?d.center:d.unproject(o)):h.N.convert(d.center),this._aroundPoint=d.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>Dl?this._wheelZoomRate:this._defaultZoomRate;let U=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&U!==0&&(U=1/U);const $=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom($*U))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,d=this._startZoom,p=this._easing;let y,T=!1;const A=B.now()-this._lastWheelEventTime;if(this._type==="wheel"&&d&&p&&A){const D=Math.min(A/200,1),U=p(D);y=h.y.number(d,o,U),D<1?this._frameId||(this._frameId=!0):T=!0}else y=o,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:y-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let o=h.b9;if(this._prevEase){const d=this._prevEase,p=(B.now()-d.start)/d.duration,y=d.easing(p+.01)-d.easing(p),T=.27/Math.sqrt(y*y+1e-4)*.01,A=Math.sqrt(.0729-T*T);o=h.b8(T,A,.25,1)}return this._prevEase={start:B.now(),duration:e,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class fo{constructor(e,o){this._clickZoom=e,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yc{constructor(e){this._tr=new Hr(e),this.reset()}reset(){this._active=!1}dblclick(e,o){return e.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _c{constructor(){this._tap=new Oa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,o,d){if(!this._swipePoint)if(this._tapTime){const p=o[0],y=e.timeStamp-this._tapTime<500,T=this._tapPoint.dist(p)<30;y&&T?d.length>0&&(this._swipePoint=p,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(e,o,d)}touchmove(e,o,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const p=o[0],y=p.y-this._swipePoint.y;return this._swipePoint=p,e.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(e,o,d)}touchend(e,o,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{const p=this._tap.touchend(e,o,d);p&&(this._tapTime=e.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uu{constructor(e,o,d){this._el=e,this._mousePan=o,this._touchPan=d}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class rh{constructor(e,o,d){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=o,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Vu{constructor(e,o,d,p){this._el=e,this._touchZoom=o,this._touchRotate=d,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class zl{constructor(e,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=q.create("div","maplibregl-cooperative-gesture-screen",e);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const d=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=o,this._container.appendChild(p);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=d,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(q.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,o){this._enabled&&(this._map.fire(new h.k("cooperativegestureprevented",{gestureType:e,originalEvent:o})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const qs=_=>_.zoom||_.drag||_.pitch||_.rotate;class zt extends h.k{}function da(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class qu{constructor(e,o){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,y)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=p.type==="renderFrame"?void 0:p,A={needsRenderFrame:!1},D={},U={},$=p.touches,Z=$?this._getMapTouches($):void 0,Q=Z?q.touchPos(this._map.getCanvas(),Z):q.mousePos(this._map.getCanvas(),p);for(const{handlerName:pe,handler:ge,allowed:ve}of this._handlers){if(!ge.isEnabled())continue;let Se;this._blockedByActive(U,ve,pe)?ge.reset():ge[y||p.type]&&(Se=ge[y||p.type](p,Q,Z),this.mergeHandlerResult(A,D,Se,pe,T),Se&&Se.needsRenderFrame&&this._triggerRenderFrame()),(Se||ge.isActive())&&(U[pe]=ge)}const oe={};for(const pe in this._previousActiveHandlers)U[pe]||(oe[pe]=T);this._previousActiveHandlers=U,(Object.keys(oe).length||da(A))&&(this._changes.push([A,D,oe]),this._triggerRenderFrame()),(Object.keys(U).length||da(A))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:he}=A;he&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],he(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new An(e),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,y,T]of this._listeners)q.addEventListener(p,y,p===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[e,o,d]of this._listeners)q.removeEventListener(e,o,e===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(e){const o=this._map,d=o.getCanvasContainer();this._add("mapEvent",new Ll(o,e));const p=o.boxZoom=new Tr(o,e);this._add("boxZoom",p),e.interactive&&e.boxZoom&&p.enable();const y=o.cooperativeGestures=new zl(o,e.cooperativeGestures);this._add("cooperativeGestures",y),e.cooperativeGestures&&y.enable();const T=new Us(o),A=new yc(o);o.doubleClickZoom=new fo(A,T),this._add("tapZoom",T),this._add("clickZoom",A),e.interactive&&e.doubleClickZoom&&o.doubleClickZoom.enable();const D=new _c;this._add("tapDragZoom",D);const U=o.touchPitch=new Nl(o);this._add("touchPitch",U),e.interactive&&e.touchPitch&&o.touchPitch.enable(e.touchPitch);const $=Bu(e),Z=gi(e);o.dragRotate=new rh(e,$,Z),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate"]),e.interactive&&e.dragRotate&&o.dragRotate.enable();const Q=(({enable:Se,clickTolerance:me})=>{const Ae=new Do({checkCorrectEvent:ze=>q.mouseButton(ze)===0&&!ze.ctrlKey});return new lo({clickTolerance:me,move:(ze,Ve)=>({around:Ve,panDelta:Ve.sub(ze)}),activateOnStart:!0,moveStateManager:Ae,enable:Se,assignEvents:hu})})(e),oe=new uo(e,o);o.dragPan=new Uu(d,Q,oe),this._add("mousePan",Q),this._add("touchPan",oe,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&o.dragPan.enable(e.dragPan);const he=new Rl,pe=new fu;o.touchZoomRotate=new Vu(d,pe,he,D),this._add("touchRotate",he,["touchPan","touchZoom"]),this._add("touchZoom",pe,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&o.touchZoomRotate.enable(e.touchZoomRotate);const ge=o.scrollZoom=new ns(o,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ge,["mousePan"]),e.interactive&&e.scrollZoom&&o.scrollZoom.enable(e.scrollZoom);const ve=o.keyboard=new Vs(o);this._add("keyboard",ve),e.interactive&&e.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new vi(o))}_add(e,o,d){this._handlers.push({handlerName:e,handler:o,allowed:d}),this._handlersById[e]=o}stop(e){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!qs(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,o,d){for(const p in e)if(p!==d&&(!o||o.indexOf(p)<0))return!0;return!1}_getMapTouches(e){const o=[];for(const d of e)this._el.contains(d.target)&&o.push(d);return o}mergeHandlerResult(e,o,d,p,y){if(!d)return;h.e(e,d);const T={handlerName:p,originalEvent:d.originalEvent||y};d.zoomDelta!==void 0&&(o.zoom=T),d.panDelta!==void 0&&(o.drag=T),d.pitchDelta!==void 0&&(o.pitch=T),d.bearingDelta!==void 0&&(o.rotate=T)}_applyChanges(){const e={},o={},d={};for(const[p,y,T]of this._changes)p.panDelta&&(e.panDelta=(e.panDelta||new h.P(0,0))._add(p.panDelta)),p.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(e.around=p.around),p.pinchAround!==void 0&&(e.pinchAround=p.pinchAround),p.noInertia&&(e.noInertia=p.noInertia),h.e(o,y),h.e(d,T);this._updateMapTransform(e,o,d),this._changes=[]}_updateMapTransform(e,o,d){const p=this._map,y=p._getTransformForUpdate(),T=p.terrain;if(!(da(e)||T&&this._terrainMovement))return this._fireEvents(o,d,!0);let{panDelta:A,zoomDelta:D,bearingDelta:U,pitchDelta:$,around:Z,pinchAround:Q}=e;Q!==void 0&&(Z=Q),p._stop(!0),Z=Z||p.transform.centerPoint;const oe=y.pointLocation(A?Z.sub(A):Z);U&&(y.bearing+=U),$&&(y.pitch+=$),D&&(y.zoom+=D),T?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(A)):y.setLocationAtPoint(oe,Z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(oe,Z)):y.setLocationAtPoint(oe,Z),p._applyUpdatedTransform(y),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(o,d,!0)}_fireEvents(e,o,d){const p=qs(this._eventsInProgress),y=qs(e),T={};for(const Z in e){const{originalEvent:Q}=e[Z];this._eventsInProgress[Z]||(T[`${Z}start`]=Q),this._eventsInProgress[Z]=e[Z]}!p&&y&&this._fireEvent("movestart",y.originalEvent);for(const Z in T)this._fireEvent(Z,T[Z]);y&&this._fireEvent("move",y.originalEvent);for(const Z in e){const{originalEvent:Q}=e[Z];this._fireEvent(Z,Q)}const A={};let D;for(const Z in this._eventsInProgress){const{handlerName:Q,originalEvent:oe}=this._eventsInProgress[Z];this._handlersById[Q].isActive()||(delete this._eventsInProgress[Z],D=o[Q]||oe,A[`${Z}end`]=D)}for(const Z in A)this._fireEvent(Z,A[Z]);const U=qs(this._eventsInProgress),$=(p||y)&&!U;if($&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const Z=this._map._getTransformForUpdate();Z.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(Z)}if(d&&$){this._updatingCamera=!0;const Z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=oe=>oe!==0&&-this._bearingSnap<oe&&oe<this._bearingSnap;!Z||!Z.essential&&B.prefersReducedMotion?(this._map.fire(new h.k("moveend",{originalEvent:D})),Q(this._map.getBearing())&&this._map.resetNorth()):(Q(Z.bearing||this._map.getBearing())&&(Z.bearing=0),Z.freezeElevation=!0,this._map.easeTo(Z,{originalEvent:D})),this._updatingCamera=!1}}_fireEvent(e,o){this._map.fire(new h.k(e,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new zt("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ll extends h.E{constructor(e,o){super(),this._renderFrameCallback=()=>{const d=Math.min((B.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=o.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new h.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,o){return this.jumpTo({center:e},o)}panBy(e,o,d){return e=h.P.convert(e).mult(-1),this.panTo(this.transform.center,h.e({offset:e},o),d)}panTo(e,o,d){return this.easeTo(h.e({center:e},o),d)}getZoom(){return this.transform.zoom}setZoom(e,o){return this.jumpTo({zoom:e},o),this}zoomTo(e,o,d){return this.easeTo(h.e({zoom:e},o),d)}zoomIn(e,o){return this.zoomTo(this.getZoom()+1,e,o),this}zoomOut(e,o){return this.zoomTo(this.getZoom()-1,e,o),this}getBearing(){return this.transform.bearing}setBearing(e,o){return this.jumpTo({bearing:e},o),this}getPadding(){return this.transform.padding}setPadding(e,o){return this.jumpTo({padding:e},o),this}rotateTo(e,o,d){return this.easeTo(h.e({bearing:e},o),d)}resetNorth(e,o){return this.rotateTo(0,h.e({duration:1e3},e),o),this}resetNorthPitch(e,o){return this.easeTo(h.e({bearing:0,pitch:0,duration:1e3},e),o),this}snapToNorth(e,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,o):this}getPitch(){return this.transform.pitch}setPitch(e,o){return this.jumpTo({pitch:e},o),this}cameraForBounds(e,o){e=We.convert(e).adjustAntiMeridian();const d=o&&o.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),d,o)}_cameraForBoxAndBearing(e,o,d,p){const y={top:0,bottom:0,right:0,left:0};if(typeof(p=h.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const Et=p.padding;p.padding={top:Et,bottom:Et,right:Et,left:Et}}p.padding=h.e(y,p.padding);const T=this.transform,A=T.padding,D=new We(e,o),U=T.project(D.getNorthWest()),$=T.project(D.getNorthEast()),Z=T.project(D.getSouthEast()),Q=T.project(D.getSouthWest()),oe=h.ba(-d),he=U.rotate(oe),pe=$.rotate(oe),ge=Z.rotate(oe),ve=Q.rotate(oe),Se=new h.P(Math.max(he.x,pe.x,ve.x,ge.x),Math.max(he.y,pe.y,ve.y,ge.y)),me=new h.P(Math.min(he.x,pe.x,ve.x,ge.x),Math.min(he.y,pe.y,ve.y,ge.y)),Ae=Se.sub(me),ze=(T.width-(A.left+A.right+p.padding.left+p.padding.right))/Ae.x,Ve=(T.height-(A.top+A.bottom+p.padding.top+p.padding.bottom))/Ae.y;if(Ve<0||ze<0)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const at=Math.min(T.scaleZoom(T.scale*Math.min(ze,Ve)),p.maxZoom),yt=h.P.convert(p.offset),kt=new h.P((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(h.ba(d)),Lt=yt.add(kt).mult(T.scale/T.zoomScale(at));return{center:T.unproject(U.add(Z).div(2).sub(Lt)),zoom:at,bearing:d}}fitBounds(e,o,d){return this._fitInternal(this.cameraForBounds(e,o),o,d)}fitScreenCoordinates(e,o,d,p,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(h.P.convert(e)),this.transform.pointLocation(h.P.convert(o)),d,p),p,y)}_fitInternal(e,o,d){return e?(delete(o=h.e(e,o)).padding,o.linear?this.easeTo(o,d):this.flyTo(o,d)):this}jumpTo(e,o){this.stop();const d=this._getTransformForUpdate();let p=!1,y=!1,T=!1;return"zoom"in e&&d.zoom!==+e.zoom&&(p=!0,d.zoom=+e.zoom),e.center!==void 0&&(d.center=h.N.convert(e.center)),"bearing"in e&&d.bearing!==+e.bearing&&(y=!0,d.bearing=+e.bearing),"pitch"in e&&d.pitch!==+e.pitch&&(T=!0,d.pitch=+e.pitch),e.padding==null||d.isPaddingEqual(e.padding)||(d.padding=e.padding),this._applyUpdatedTransform(d),this.fire(new h.k("movestart",o)).fire(new h.k("move",o)),p&&this.fire(new h.k("zoomstart",o)).fire(new h.k("zoom",o)).fire(new h.k("zoomend",o)),y&&this.fire(new h.k("rotatestart",o)).fire(new h.k("rotate",o)).fire(new h.k("rotateend",o)),T&&this.fire(new h.k("pitchstart",o)).fire(new h.k("pitch",o)).fire(new h.k("pitchend",o)),this.fire(new h.k("moveend",o))}calculateCameraOptionsFromTo(e,o,d,p=0){const y=h.Z.fromLngLat(e,o),T=h.Z.fromLngLat(d,p),A=T.x-y.x,D=T.y-y.y,U=T.z-y.z,$=Math.hypot(A,D,U);if($===0)throw new Error("Can't calculate camera options with same From and To");const Z=Math.hypot(A,D),Q=this.transform.scaleZoom(this.transform.cameraToCenterDistance/$/this.transform.tileSize),oe=180*Math.atan2(A,-D)/Math.PI;let he=180*Math.acos(Z/$)/Math.PI;return he=U<0?90-he:90+he,{center:T.toLngLat(),zoom:Q,pitch:he,bearing:oe}}easeTo(e,o){var d;this._stop(!1,e.easeId),((e=h.e({offset:[0,0],duration:500,easing:h.b9},e)).animate===!1||!e.essential&&B.prefersReducedMotion)&&(e.duration=0);const p=this._getTransformForUpdate(),y=p.zoom,T=p.bearing,A=p.pitch,D=p.padding,U="bearing"in e?this._normalizeBearing(e.bearing,T):T,$="pitch"in e?+e.pitch:A,Z="padding"in e?e.padding:p.padding,Q=h.P.convert(e.offset);let oe=p.centerPoint.add(Q);const he=p.pointLocation(oe),{center:pe,zoom:ge}=p.getConstrained(h.N.convert(e.center||he),(d=e.zoom)!==null&&d!==void 0?d:y);this._normalizeCenter(pe,p);const ve=p.project(he),Se=p.project(pe).sub(ve),me=p.zoomScale(ge-y);let Ae,ze;e.around&&(Ae=h.N.convert(e.around),ze=p.locationPoint(Ae));const Ve={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ge!==y,this._rotating=this._rotating||T!==U,this._pitching=this._pitching||$!==A,this._padding=!p.isPaddingEqual(Z),this._easeId=e.easeId,this._prepareEase(o,e.noMoveStart,Ve),this.terrain&&this._prepareElevation(pe),this._ease((at=>{if(this._zooming&&(p.zoom=h.y.number(y,ge,at)),this._rotating&&(p.bearing=h.y.number(T,U,at)),this._pitching&&(p.pitch=h.y.number(A,$,at)),this._padding&&(p.interpolatePadding(D,Z,at),oe=p.centerPoint.add(Q)),this.terrain&&!e.freezeElevation&&this._updateElevation(at),Ae)p.setLocationAtPoint(Ae,ze);else{const yt=p.zoomScale(p.zoom-y),kt=ge>y?Math.min(2,me):Math.max(.5,me),Lt=Math.pow(kt,1-at),Et=p.unproject(ve.add(Se.mult(at*Lt)).mult(yt));p.setLocationAtPoint(p.renderWorldCopies?Et.wrap():Et,oe)}this._applyUpdatedTransform(p),this._fireMoveEvents(o)}),(at=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o,at)}),e),this}_prepareEase(e,o,d={}){this._moving=!0,o||d.moving||this.fire(new h.k("movestart",e)),this._zooming&&!d.zooming&&this.fire(new h.k("zoomstart",e)),this._rotating&&!d.rotating&&this.fire(new h.k("rotatestart",e)),this._pitching&&!d.pitching&&this.fire(new h.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&o!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(d-(o-(d*e+this._elevationStart))/(1-e)),this._elevationTarget=o}this.transform.elevation=h.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const o=e.getCameraPosition(),d=this.terrain.getElevationForLngLatZoom(o.lngLat,e.zoom);if(o.altitude<d){const p=this.calculateCameraOptionsFromTo(o.lngLat,d,e.center,e.elevation);return{pitch:p.pitch,zoom:p.zoom}}return{}}_applyUpdatedTransform(e){const o=[];if(this.terrain&&o.push((p=>this._elevateCameraIfInsideTerrain(p))),this.transformCameraUpdate&&o.push((p=>this.transformCameraUpdate(p))),!o.length)return;const d=e.clone();for(const p of o){const y=d.clone(),{center:T,zoom:A,pitch:D,bearing:U,elevation:$}=p(y);T&&(y.center=T),A!==void 0&&(y.zoom=A),D!==void 0&&(y.pitch=D),U!==void 0&&(y.bearing=U),$!==void 0&&(y.elevation=$),d.apply(y)}this.transform.apply(d)}_fireMoveEvents(e){this.fire(new h.k("move",e)),this._zooming&&this.fire(new h.k("zoom",e)),this._rotating&&this.fire(new h.k("rotate",e)),this._pitching&&this.fire(new h.k("pitch",e))}_afterEase(e,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const d=this._zooming,p=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new h.k("zoomend",e)),p&&this.fire(new h.k("rotateend",e)),y&&this.fire(new h.k("pitchend",e)),this.fire(new h.k("moveend",e))}flyTo(e,o){var d;if(!e.essential&&B.prefersReducedMotion){const Ct=h.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ct,o)}this.stop(),e=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.b9},e);const p=this._getTransformForUpdate(),y=p.zoom,T=p.bearing,A=p.pitch,D=p.padding,U="bearing"in e?this._normalizeBearing(e.bearing,T):T,$="pitch"in e?+e.pitch:A,Z="padding"in e?e.padding:p.padding,Q=h.P.convert(e.offset);let oe=p.centerPoint.add(Q);const he=p.pointLocation(oe),{center:pe,zoom:ge}=p.getConstrained(h.N.convert(e.center||he),(d=e.zoom)!==null&&d!==void 0?d:y);this._normalizeCenter(pe,p);const ve=p.zoomScale(ge-y),Se=p.project(he),me=p.project(pe).sub(Se);let Ae=e.curve;const ze=Math.max(p.width,p.height),Ve=ze/ve,at=me.mag();if("minZoom"in e){const Ct=h.ac(Math.min(e.minZoom,y,ge),p.minZoom,p.maxZoom),mn=ze/p.zoomScale(Ct-y);Ae=Math.sqrt(mn/at*2)}const yt=Ae*Ae;function kt(Ct){const mn=(Ve*Ve-ze*ze+(Ct?-1:1)*yt*yt*at*at)/(2*(Ct?Ve:ze)*yt*at);return Math.log(Math.sqrt(mn*mn+1)-mn)}function Lt(Ct){return(Math.exp(Ct)-Math.exp(-Ct))/2}function Et(Ct){return(Math.exp(Ct)+Math.exp(-Ct))/2}const bt=kt(!1);let Ut=function(Ct){return Et(bt)/Et(bt+Ae*Ct)},gn=function(Ct){return ze*((Et(bt)*(Lt(mn=bt+Ae*Ct)/Et(mn))-Lt(bt))/yt)/at;var mn},It=(kt(!0)-bt)/Ae;if(Math.abs(at)<1e-6||!isFinite(It)){if(Math.abs(ze-Ve)<1e-6)return this.easeTo(e,o);const Ct=Ve<ze?-1:1;It=Math.abs(Math.log(Ve/ze))/Ae,gn=()=>0,Ut=mn=>Math.exp(Ct*Ae*mn)}return e.duration="duration"in e?+e.duration:1e3*It/("screenSpeed"in e?+e.screenSpeed/Ae:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=T!==U,this._pitching=$!==A,this._padding=!p.isPaddingEqual(Z),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(pe),this._ease((Ct=>{const mn=Ct*It,li=1/Ut(mn);p.zoom=Ct===1?ge:y+p.scaleZoom(li),this._rotating&&(p.bearing=h.y.number(T,U,Ct)),this._pitching&&(p.pitch=h.y.number(A,$,Ct)),this._padding&&(p.interpolatePadding(D,Z,Ct),oe=p.centerPoint.add(Q)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ct);const En=Ct===1?pe:p.unproject(Se.add(me.mult(gn(mn))).mult(li));p.setLocationAtPoint(p.renderWorldCopies?En.wrap():En,oe),this._applyUpdatedTransform(p),this._fireMoveEvents(o)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,o){var d;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,o)}return e||(d=this.handlers)===null||d===void 0||d.stop(!1),this}_ease(e,o,d){d.animate===!1||d.duration===0?(e(1),o()):(this._easeStart=B.now(),this._easeOptions=d,this._onEaseFrame=e,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,o){e=h.b3(e,-180,180);const d=Math.abs(e-o);return Math.abs(e-360-o)<d&&(e-=360),Math.abs(e+360-o)<d&&(e+=360),e}_normalizeCenter(e,o){if(!o.renderWorldCopies||o.lngRange)return;const d=e.lng-o.center.lng;e.lng+=d>180?-360:d<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(h.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const Xr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Fa{constructor(e=Xr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=q.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,o){const d=this._map._getUIString(`AttributionControl.${o}`);e.title=d,e.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((p=>typeof p!="string"?"":p))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const o=this._map.style.sourceCaches;for(const p in o){const y=o[p];if(y.used||y.usedForTerrain){const T=y.getSource();T.attribution&&e.indexOf(T.attribution)<0&&e.push(T.attribution)}}e=e.filter((p=>String(p).trim())),e.sort(((p,y)=>p.length-y.length)),e=e.filter(((p,y)=>{for(let T=y+1;T<e.length;T++)if(e[T].indexOf(p)>=0)return!1;return!0}));const d=e.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,e.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class pa{constructor(e={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const d=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=q.create("div","maplibregl-ctrl");const o=q.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Dn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const o=++this._id;return this._queue.push({callback:e,id:o,cancelled:!1}),o}remove(e){const o=this._currentlyRunning,d=o?this._queue.concat(o):this._queue;for(const p of d)if(p.id===e)return void(p.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const d of o)if(!d.cancelled&&(d.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var vc=h.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Kh extends h.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,o){this.sourceCache.update(e,o),this._renderableTilesKeys=[];const d={};for(const p of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))d[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),h.aP(p.posMatrix,0,h.X,0,h.X,0,1),this._tiles[p.key]=new Pa(p,this.tileSize));for(const p in this._tiles)d[p]||delete this._tiles[p]}freeRtt(e){for(const o in this._tiles){const d=this._tiles[o];(!e||d.tileID.equals(e)||d.tileID.isChildOf(e)||e.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const o={};for(const d of this._renderableTilesKeys){const p=this._tiles[d].tileID;if(p.canonical.equals(e.canonical)){const y=e.clone();y.posMatrix=new Float64Array(16),h.aP(y.posMatrix,0,h.X,0,h.X,0,1),o[d]=y}else if(p.canonical.isChildOf(e.canonical)){const y=e.clone();y.posMatrix=new Float64Array(16);const T=p.canonical.z-e.canonical.z,A=p.canonical.x-(p.canonical.x>>T<<T),D=p.canonical.y-(p.canonical.y>>T<<T),U=h.X>>T;h.aP(y.posMatrix,0,U,0,U,0,1),h.J(y.posMatrix,y.posMatrix,[-A*U,-D*U,0]),o[d]=y}else if(e.canonical.isChildOf(p.canonical)){const y=e.clone();y.posMatrix=new Float64Array(16);const T=e.canonical.z-p.canonical.z,A=e.canonical.x-(e.canonical.x>>T<<T),D=e.canonical.y-(e.canonical.y>>T<<T),U=h.X>>T;h.aP(y.posMatrix,0,h.X,0,h.X,0,1),h.J(y.posMatrix,y.posMatrix,[A*U,D*U,0]),h.K(y.posMatrix,y.posMatrix,[1/2**T,1/2**T,0]),o[d]=y}}return o}getSourceTile(e,o){const d=this.sourceCache._source;let p=e.overscaledZ-this.deltaZoom;if(p>d.maxzoom&&(p=d.maxzoom),p<d.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(p).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!y||!y.dem)&&o)for(;p>=d.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(e.scaledTo(p--).key);return y}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter((o=>o.timeAdded>=e))}}class po{constructor(e,o,d){this.painter=e,this.sourceCache=new Kh(o),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,o,d,p=h.X){var y;if(!(o>=0&&o<p&&d>=0&&d<p))return 0;const T=this.getTerrainData(e),A=(y=T.tile)===null||y===void 0?void 0:y.dem;if(!A)return 0;const D=(function(he,pe,ge){var ve=pe[0],Se=pe[1];return he[0]=ge[0]*ve+ge[4]*Se+ge[12],he[1]=ge[1]*ve+ge[5]*Se+ge[13],he})([],[o/p*h.X,d/p*h.X],T.u_terrain_matrix),U=[D[0]*A.dim,D[1]*A.dim],$=Math.floor(U[0]),Z=Math.floor(U[1]),Q=U[0]-$,oe=U[1]-Z;return A.get($,Z)*(1-Q)*(1-oe)+A.get($+1,Z)*Q*(1-oe)+A.get($,Z+1)*(1-Q)*oe+A.get($+1,Z+1)*Q*oe}getElevationForLngLatZoom(e,o){if(!h.bb(o,e.wrap()))return 0;const{tileID:d,mercatorX:p,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(e,o);return this.getElevation(d,p%h.X,y%h.X,h.X)}getElevation(e,o,d,p=h.X){return this.getDEMElevation(e,o,d,p)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const p=this.painter.context,y=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new St(p,y,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new St(p,new h.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.an([])}const o=this.sourceCache.getSourceTile(e,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const p=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new St(p,o.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),o.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const d=o&&o+o.tileID.key+e.key;if(d&&!this._demMatrixCache[d]){const p=this.sourceCache.sourceCache._source.maxzoom;let y=e.canonical.z-o.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=p?y=e.canonical.z-p:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=e.canonical.x-(e.canonical.x>>y<<y),A=e.canonical.y-(e.canonical.y>>y<<y),D=h.bc(new Float64Array(16),[1/(h.X<<y),1/(h.X<<y),0]);h.J(D,D,[T*h.X,A*h.X,0]),this._demMatrixCache[e.key]={matrix:D,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(e){const o=this.painter,d=o.width/devicePixelRatio,p=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new St(o.context,{width:d,height:p,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new St(o.context,{width:d,height:p,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(d,p,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,d,p))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,T=0;y<this._coordsTextureSize;y++)for(let A=0;A<this._coordsTextureSize;A++,T+=4)o[T+0]=255&A,o[T+1]=255&y,o[T+2]=A>>8<<4|y>>8,o[T+3]=0;const d=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),p=new St(e,d,e.gl.RGBA,{premultiply:!1});return p.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),d=this.painter.context,p=d.gl,y=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),T=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),A=Math.round(this.painter.height/devicePixelRatio);d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(y,A-T-1,1,1,p.RGBA,p.UNSIGNED_BYTE,o),d.bindFramebuffer.set(null);const D=o[0]+(o[2]>>4<<8),U=o[1]+((15&o[2])<<8),$=this.coordsIndex[255-o[3]],Z=$&&this.sourceCache.getTileByID($);if(!Z)return null;const Q=this._coordsTextureSize,oe=(1<<Z.tileID.canonical.z)*Q;return new h.Z((Z.tileID.canonical.x*Q+D)/oe+Z.tileID.wrap,(Z.tileID.canonical.y*Q+U)/oe,this.getElevation(Z.tileID,D,U,Q))}depthAtPoint(e){const o=new Uint8Array(4),d=this.painter.context,p=d.gl;return d.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,o),d.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,o=new h.bd,d=new h.aY,p=this.meshSize,y=h.X/p,T=p*p;for(let Z=0;Z<=p;Z++)for(let Q=0;Q<=p;Q++)o.emplaceBack(Q*y,Z*y,0);for(let Z=0;Z<T;Z+=p+1)for(let Q=0;Q<p;Q++)d.emplaceBack(Q+Z,p+Q+Z+1,p+Q+Z+2),d.emplaceBack(Q+Z,p+Q+Z+2,Q+Z+1);const A=o.length,D=A+2*(p+1);for(const Z of[0,1])for(let Q=0;Q<=p;Q++)for(const oe of[0,1])o.emplaceBack(Q*y,Z*h.X,oe);for(let Z=0;Z<2*p;Z+=2)d.emplaceBack(D+Z,D+Z+1,D+Z+3),d.emplaceBack(D+Z,D+Z+3,D+Z+2),d.emplaceBack(A+Z,A+Z+3,A+Z+1),d.emplaceBack(A+Z,A+Z+2,A+Z+3);const U=o.length,$=U+2*(p+1);for(const Z of[0,1])for(let Q=0;Q<=p;Q++)for(const oe of[0,1])o.emplaceBack(Z*h.X,Q*y,oe);for(let Z=0;Z<2*p;Z+=2)d.emplaceBack(U+Z,U+Z+1,U+Z+3),d.emplaceBack(U+Z,U+Z+3,U+Z+2),d.emplaceBack($+Z,$+Z+3,$+Z+1),d.emplaceBack($+Z,$+Z+2,$+Z+3);return this._mesh=new c(e.createVertexBuffer(o,vc.members),e.createIndexBuffer(d),h.a0.simpleSegment(0,0,o.length,d.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*h.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,o){var d;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(e,o);return(d=this.getMinMaxElevation(p).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(e){const o=this.getTerrainData(e).tile,d={minElevation:null,maxElevation:null};return o&&o.dem&&(d.minElevation=o.dem.min*this.exaggeration,d.maxElevation=o.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(e,o){const d=h.Z.fromLngLat(e.wrap()),p=(1<<o)*h.X,y=d.x*p,T=d.y*p,A=Math.floor(y/h.X),D=Math.floor(T/h.X);return{tileID:new h.S(o,0,o,A,D),mercatorX:y,mercatorY:T}}}class du{constructor(e,o,d){this._context=e,this._size=o,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new St(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(d.texture),{id:e,fbo:o,texture:d,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((o=>e.id!==o)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const ma={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class pu{constructor(e,o){this.painter=e,this.terrain=o,this.pool=new du(e.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((d=>!e._layers[d].isHidden(o))),this._coordsDescendingInv={};for(const d in e.sourceCaches){this._coordsDescendingInv[d]={};const p=e.sourceCaches[d].getVisibleCoordinates();for(const y of p){const T=this.terrain.sourceCache.getTerrainCoords(y);for(const A in T)this._coordsDescendingInv[d][A]||(this._coordsDescendingInv[d][A]=[]),this._coordsDescendingInv[d][A].push(T[A])}}this._coordsDescendingInvStr={};for(const d of e._order){const p=e._layers[d],y=p.source;if(ma[p.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const T in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][T]=this._coordsDescendingInv[y][T].map((A=>A.key)).sort().join()}}for(const d of this._renderableTiles)for(const p in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[p][d.tileID.key];y&&y!==d.rttCoords[p]&&(d.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const o=e.type,d=this.painter,p=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(ma[o]&&(this._prevType&&ma[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(e.id),!p))return!0;if(ma[this._prevType]||ma[o]&&p){this._prevType=o;const y=this._stacks.length-1,T=this._stacks[y]||[];for(const A of this._renderableTiles){if(this.pool.isFull()&&(s(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(A),A.rtt[y]){const U=this.pool.getObjectForId(A.rtt[y].id);if(U.stamp===A.rtt[y].stamp){this.pool.useObject(U);continue}}const D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),A.rtt[y]={id:D.id,stamp:D.stamp},d.context.bindFramebuffer.set(D.fbo.framebuffer),d.context.clear({color:h.aM.transparent,stencil:0}),d.currentStencilSource=void 0;for(let U=0;U<T.length;U++){const $=d.style._layers[T[U]],Z=$.source?this._coordsDescendingInv[$.source][A.tileID.key]:[A.tileID];d.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),d._renderTileClippingMasks($,Z),d.renderLayer(d,d.style.sourceCaches[$.source],$,Z),$.source&&(A.rttCoords[$.source]=this._coordsDescendingInvStr[$.source][A.tileID.key])}}return s(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ma[o]}return!1}}const mu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ul=K,zo={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Xr,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},yi=_=>{_.touchstart=_.dragStart,_.touchmoveWindow=_.dragMove,_.touchend=_.dragEnd},xi={showCompass:!0,showZoom:!0,visualizePitch:!1};class Oo{constructor(e,o,d=!1){this.mousedown=T=>{this.startMouse(h.e({},T,{ctrlKey:!0,preventDefault:()=>T.preventDefault()}),q.mousePos(this.element,T)),q.addEventListener(window,"mousemove",this.mousemove),q.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=T=>{this.moveMouse(T,q.mousePos(this.element,T))},this.mouseup=T=>{this.mouseRotate.dragEnd(T),this.mousePitch&&this.mousePitch.dragEnd(T),this.offTemp()},this.touchstart=T=>{T.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=q.touchPos(this.element,T.targetTouches)[0],this.startTouch(T,this._startPos),q.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.addEventListener(window,"touchend",this.touchend))},this.touchmove=T=>{T.targetTouches.length!==1?this.reset():(this._lastPos=q.touchPos(this.element,T.targetTouches)[0],this.moveTouch(T,this._lastPos))},this.touchend=T=>{T.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const p=e.dragRotate._mouseRotate.getClickTolerance(),y=e.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=Bu({clickTolerance:p,enable:!0}),this.touchRotate=(({enable:T,clickTolerance:A,bearingDegreesPerPixelMoved:D=.8})=>{const U=new gc;return new lo({clickTolerance:A,move:($,Z)=>({bearingDelta:(Z.x-$.x)*D}),moveStateManager:U,enable:T,assignEvents:yi})})({clickTolerance:p,enable:!0}),this.map=e,d&&(this.mousePitch=gi({clickTolerance:y,enable:!0}),this.touchPitch=(({enable:T,clickTolerance:A,pitchDegreesPerPixelMoved:D=-.5})=>{const U=new gc;return new lo({clickTolerance:A,move:($,Z)=>({pitchDelta:(Z.y-$.y)*D}),moveStateManager:U,enable:T,assignEvents:yi})})({clickTolerance:y,enable:!0})),q.addEventListener(o,"mousedown",this.mousedown),q.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),q.addEventListener(o,"touchcancel",this.reset)}startMouse(e,o){this.mouseRotate.dragStart(e,o),this.mousePitch&&this.mousePitch.dragStart(e,o),q.disableDrag()}startTouch(e,o){this.touchRotate.dragStart(e,o),this.touchPitch&&this.touchPitch.dragStart(e,o),q.disableDrag()}moveMouse(e,o){const d=this.map,{bearingDelta:p}=this.mouseRotate.dragMove(e,o)||{};if(p&&d.setBearing(d.getBearing()+p),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(e,o)||{};y&&d.setPitch(d.getPitch()+y)}}moveTouch(e,o){const d=this.map,{bearingDelta:p}=this.touchRotate.dragMove(e,o)||{};if(p&&d.setBearing(d.getBearing()+p),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(e,o)||{};y&&d.setPitch(d.getPitch()+y)}}off(){const e=this.element;q.removeEventListener(e,"mousedown",this.mousedown),q.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend),q.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){q.enableDrag(),q.removeEventListener(window,"mousemove",this.mousemove),q.removeEventListener(window,"mouseup",this.mouseup),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend)}}let ui;function On(_,e,o){const d=new h.N(_.lng,_.lat);if(_=new h.N(_.lng,_.lat),e){const p=new h.N(_.lng-360,_.lat),y=new h.N(_.lng+360,_.lat),T=o.locationPoint(_).distSqr(e);o.locationPoint(p).distSqr(e)<T?_=p:o.locationPoint(y).distSqr(e)<T&&(_=y)}for(;Math.abs(_.lng-o.center.lng)>180;){const p=o.locationPoint(_);if(p.x>=0&&p.y>=0&&p.x<=o.width&&p.y<=o.height)break;_.lng>o.center.lng?_.lng-=360:_.lng+=360}return _.lng!==d.lng&&o.locationPoint(_).y>o.height/2-o.getHorizon()?_:d}const Gs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function mo(_,e,o){const d=_.classList;for(const p in Gs)d.remove(`maplibregl-${o}-anchor-${p}`);d.add(`maplibregl-${o}-anchor-${e}`)}class Cr extends h.E{constructor(e){if(super(),this._onKeyPress=o=>{const d=o.code,p=o.charCode||o.keyCode;d!=="Space"&&d!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=o=>{const d=o.originalEvent.target,p=this._element;this._popup&&(d===p||p.contains(d))&&this.togglePopup()},this._update=o=>{var d;if(!this._map)return;const p=this._map.loaded()&&!this._map.isMoving();(o?.type==="terrain"||o?.type==="render"&&!p)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?On(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let T="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?T="rotateX(0deg)":this._pitchAlignment==="map"&&(T=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||o&&o.type!=="moveend"||(this._pos=this._pos.round()),q.setTransform(this._element,`${Gs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${T} ${y}`),B.frameAsync(new AbortController).then((()=>{this._updateOpacity(o&&o.type==="moveend")})).catch((()=>{}))},this._onMove=o=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.k("dragstart"))),this.fire(new h.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=h.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=q.create("div");const o=q.createNS("http://www.w3.org/2000/svg","svg"),d=41,p=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${d}px`),o.setAttributeNS(null,"width",`${p}px`),o.setAttributeNS(null,"viewBox",`0 0 ${p} ${d}`);const y=q.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const T=q.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const A=q.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(3.0, 29.0)"),A.setAttributeNS(null,"fill","#000000");const D=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ve of D){const Se=q.createNS("http://www.w3.org/2000/svg","ellipse");Se.setAttributeNS(null,"opacity","0.04"),Se.setAttributeNS(null,"cx","10.5"),Se.setAttributeNS(null,"cy","5.80029008"),Se.setAttributeNS(null,"rx",ve.rx),Se.setAttributeNS(null,"ry",ve.ry),A.appendChild(Se)}const U=q.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"fill",this._color);const $=q.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),U.appendChild($);const Z=q.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"fill","#000000");const Q=q.createNS("http://www.w3.org/2000/svg","path");Q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Z.appendChild(Q);const oe=q.createNS("http://www.w3.org/2000/svg","g");oe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),oe.setAttributeNS(null,"fill","#FFFFFF");const he=q.createNS("http://www.w3.org/2000/svg","g");he.setAttributeNS(null,"transform","translate(8.0, 8.0)");const pe=q.createNS("http://www.w3.org/2000/svg","circle");pe.setAttributeNS(null,"fill","#000000"),pe.setAttributeNS(null,"opacity","0.25"),pe.setAttributeNS(null,"cx","5.5"),pe.setAttributeNS(null,"cy","5.5"),pe.setAttributeNS(null,"r","5.4999962");const ge=q.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#FFFFFF"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962"),he.appendChild(pe),he.appendChild(ge),T.appendChild(A),T.appendChild(U),T.appendChild(Z),T.appendChild(oe),T.appendChild(he),o.appendChild(T),o.setAttributeNS(null,"height",d*this._scale+"px"),o.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(o),this._offset=h.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(o=>{o.preventDefault()})),this._element.addEventListener("mousedown",(o=>{o.preventDefault()})),mo(this._element,this._anchor,"marker"),e&&e.className)for(const o of e.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=h.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const p=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var o,d;if(!(!((o=this._map)===null||o===void 0)&&o.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const p=this._map,y=p.terrain.depthAtPoint(this._pos),T=p.terrain.getElevationForLngLatZoom(this._lngLat,p.transform.tileZoom);if(p.transform.lngLatToCameraDepth(this._lngLat,T)-y<.006)return void(this._element.style.opacity=this._opacity);const A=-this._offset.y/p.transform._pixelPerMeter,D=Math.sin(p.getPitch()*Math.PI/180)*A,U=p.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),$=p.transform.lngLatToCameraDepth(this._lngLat,T+D)-U>.006;!((d=this._popup)===null||d===void 0)&&d.isOpen()&&$&&this._popup.remove(),this._element.style.opacity=$?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=h.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,o){return e===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const gu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ol=0,Fl=!1;const ws={maxWidth:100,unit:"metric"};function Bl(_,e,o){const d=o&&o.maxWidth||100,p=_._container.clientHeight/2,y=_.unproject([0,p]),T=_.unproject([d,p]),A=y.distanceTo(T);if(o&&o.unit==="imperial"){const D=3.2808*A;D>5280?Ot(e,d,D/5280,_._getUIString("ScaleControl.Miles")):Ot(e,d,D,_._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Ot(e,d,A/1852,_._getUIString("ScaleControl.NauticalMiles")):A>=1e3?Ot(e,d,A/1e3,_._getUIString("ScaleControl.Kilometers")):Ot(e,d,A,_._getUIString("ScaleControl.Meters"))}function Ot(_,e,o,d){const p=(function(y){const T=Math.pow(10,`${Math.floor(y)}`.length-1);let A=y/T;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:(function(D){const U=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*U)/U})(A),T*A})(o);_.style.width=e*(p/o)+"px",_.innerHTML=`${p}&nbsp;${d}`}const sn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},jl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function yu(_){if(_){if(typeof _=="number"){const e=Math.round(Math.abs(_)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,_),"top-left":new h.P(e,e),"top-right":new h.P(-e,e),bottom:new h.P(0,-_),"bottom-left":new h.P(e,-e),"bottom-right":new h.P(-e,-e),left:new h.P(_,0),right:new h.P(-_,0)}}if(_ instanceof h.P||Array.isArray(_)){const e=h.P.convert(_);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:h.P.convert(_.center||[0,0]),top:h.P.convert(_.top||[0,0]),"top-left":h.P.convert(_["top-left"]||[0,0]),"top-right":h.P.convert(_["top-right"]||[0,0]),bottom:h.P.convert(_.bottom||[0,0]),"bottom-left":h.P.convert(_["bottom-left"]||[0,0]),"bottom-right":h.P.convert(_["bottom-right"]||[0,0]),left:h.P.convert(_.left||[0,0]),right:h.P.convert(_.right||[0,0])}}return yu(new h.P(0,0))}const xc=K;R.AJAXError=h.bh,R.Evented=h.E,R.LngLat=h.N,R.MercatorCoordinate=h.Z,R.Point=h.P,R.addProtocol=h.bi,R.config=h.a,R.removeProtocol=h.bj,R.AttributionControl=Fa,R.BoxZoomHandler=Tr,R.CanvasSource=ir,R.CooperativeGesturesHandler=zl,R.DoubleClickZoomHandler=fo,R.DragPanHandler=Uu,R.DragRotateHandler=rh,R.EdgeInsets=H,R.FullscreenControl=class extends h.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var e;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=o?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=q.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);q.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},R.GeoJSONSource=ps,R.GeolocateControl=class extends h.E{constructor(_){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new h.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const o=new h.N(e.coords.longitude,e.coords.latitude),d=e.coords.accuracy,p=this._map.getBearing(),y=h.e({bearing:p},this.options.fitBoundsOptions),T=We.fromLngLat(o,d);this._map.fitBounds(T,y,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const o=new h.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Fl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=q.create("button","maplibregl-ctrl-geolocate",this._container),q.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Cr({element:this._dotElement}),this._circleElement=q.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.k("trackuserlocationend")),this.fire(new h.k("userlocationlostfocus")))}))}},this.options=h.e({},gu,_)}onAdd(_){return this._map=_,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return h._(this,arguments,void 0,(function*(e=!1){if(ui!==void 0&&!e)return ui;if(window.navigator.permissions===void 0)return ui=!!window.navigator.geolocation,ui;try{ui=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ui=!!window.navigator.geolocation}return ui}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ol=0,Fl=!1}_isOutOfMapMaxBounds(_){const e=this._map.getMaxBounds(),o=_.coords;return e&&(o.longitude<e.getWest()||o.longitude>e.getEast()||o.latitude<e.getSouth()||o.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const _=this._map.getBounds(),e=_.getSouthEast(),o=_.getNorthEast(),d=e.distanceTo(o),p=Math.ceil(this._accuracy/(d/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ol--,Fl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.k("trackuserlocationstart")),this.fire(new h.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ol++,Ol>1?(_={maximumAge:6e5,timeout:0},Fl=!0):(_=this.options.positionOptions,Fl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},R.Hash=$e,R.ImageSource=As,R.KeyboardHandler=Vs,R.LngLatBounds=We,R.LogoControl=pa,R.Map=class extends ll{constructor(_){h.bf.mark(h.bg.create);const e=Object.assign(Object.assign({},zo),_);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new fe(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Dn,this._controls=[],this._mapId=h.a4(),this._contextLost=o=>{o.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new h.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new h.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},mu),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=qe.addThrottleControl((()=>this.isMoving())),this._requestManager=new tt(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))).on("moveend",(()=>this._update(!1))).on("zoom",(()=>this._update(!0))).on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})).once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const d=De((p=>{this._trackResize&&!this._removed&&(this.resize(p),this.redraw())}),50);this._resizeObserver=new ResizeObserver((p=>{o?d(p):o=!0})),this._resizeObserver.observe(this._container)}this.handlers=new qu(this,e),this._hash=e.hash&&new $e(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,h.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Fa(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new pa,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(o=>{this._update(o.dataType==="style"),this.fire(new h.k(`${o.dataType}data`,o))})),this.on("dataloading",(o=>{this.fire(new h.k(`${o.dataType}dataloading`,o))})),this.on("dataabort",(o=>{this.fire(new h.k("sourcedataabort",o))}))}_getMapId(){return this._mapId}addControl(_,e){if(e===void 0&&(e=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new h.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=_.onAdd(this);this._controls.push(_);const d=this._controlPositions[e];return e.indexOf("bottom")!==-1?d.insertBefore(o,d.firstChild):d.appendChild(o),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new h.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(_);return e>-1&&this._controls.splice(e,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}calculateCameraOptionsFromTo(_,e,o,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,e,o,d)}resize(_){var e;const o=this._containerDimensions(),d=o[0],p=o[1],y=this._getClampedPixelRatio(d,p);if(this._resizeCanvas(d,p,y),this.painter.resize(d,p,y),this.painter.overLimit()){const A=this.painter.context.gl;this._maxCanvasSize=[A.drawingBufferWidth,A.drawingBufferHeight];const D=this._getClampedPixelRatio(d,p);this._resizeCanvas(d,p,D),this.painter.resize(d,p,D)}this.transform.resize(d,p),(e=this._requestedCameraState)===null||e===void 0||e.resize(d,p);const T=!this._moving;return T&&(this.stop(),this.fire(new h.k("movestart",_)).fire(new h.k("move",_))),this.fire(new h.k("resize",_)),T&&this.fire(new h.k("moveend",_)),this}_getClampedPixelRatio(_,e){const{0:o,1:d}=this._maxCanvasSize,p=this.getPixelRatio(),y=_*p,T=e*p;return Math.min(y>o?o/y:1,T>d?d/T:1)*p}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(We.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this._update()}project(_){return this.transform.locationPoint(h.N.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.pointLocation(h.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,e,o){if(_==="mouseenter"||_==="mouseover"){let d=!1;return{layers:e,listener:o,delegates:{mousemove:y=>{const T=e.filter((D=>this.getLayer(D))),A=T.length!==0?this.queryRenderedFeatures(y.point,{layers:T}):[];A.length?d||(d=!0,o.call(this,new Yn(_,this,y.originalEvent,{features:A}))):d=!1},mouseout:()=>{d=!1}}}}if(_==="mouseleave"||_==="mouseout"){let d=!1;return{layers:e,listener:o,delegates:{mousemove:T=>{const A=e.filter((D=>this.getLayer(D)));(A.length!==0?this.queryRenderedFeatures(T.point,{layers:A}):[]).length?d=!0:d&&(d=!1,o.call(this,new Yn(_,this,T.originalEvent)))},mouseout:T=>{d&&(d=!1,o.call(this,new Yn(_,this,T.originalEvent)))}}}}{const d=p=>{const y=e.filter((A=>this.getLayer(A))),T=y.length!==0?this.queryRenderedFeatures(p.point,{layers:y}):[];T.length&&(p.features=T,o.call(this,p),delete p.features)};return{layers:e,listener:o,delegates:{[_]:d}}}}_saveDelegatedListener(_,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(e)}_removeDelegatedListener(_,e,o){if(!this._delegatedListeners||!this._delegatedListeners[_])return;const d=this._delegatedListeners[_];for(let p=0;p<d.length;p++){const y=d[p];if(y.listener===o&&y.layers.length===e.length&&y.layers.every((T=>e.includes(T)))){for(const T in y.delegates)this.off(T,y.delegates[T]);return void d.splice(p,1)}}}on(_,e,o){if(o===void 0)return super.on(_,e);const d=this._createDelegatedListener(_,typeof e=="string"?[e]:e,o);this._saveDelegatedListener(_,d);for(const p in d.delegates)this.on(p,d.delegates[p]);return this}once(_,e,o){if(o===void 0)return super.once(_,e);const d=typeof e=="string"?[e]:e,p=this._createDelegatedListener(_,d,o);for(const y in p.delegates){const T=p.delegates[y];p.delegates[y]=(...A)=>{this._removeDelegatedListener(_,d,o),T(...A)}}this._saveDelegatedListener(_,p);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(_,e,o){return o===void 0?super.off(_,e):(this._removeDelegatedListener(_,typeof e=="string"?[e]:e,o),this)}queryRenderedFeatures(_,e){if(!this.style)return[];let o;const d=_ instanceof h.P||Array.isArray(_),p=d?_:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(d?{}:_)||{},p instanceof h.P||typeof p[0]=="number")o=[h.P.convert(p)];else{const y=h.P.convert(p[0]),T=h.P.convert(p[1]);o=[y,new h.P(T.x,y.y),T,new h.P(y.x,T.y),y]}return this.style.queryRenderedFeatures(o,e,this.transform)}querySourceFeatures(_,e){return this.style.querySourceFeatures(_,e)}setStyle(_,e){return(e=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(_,e))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const e=this._locale[_];if(e==null)throw new Error(`Missing UI string '${_}'`);return e}_updateStyle(_,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(_,e)));const o=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new Wo(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,e,o):this.style.loadJSON(_,e,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Wo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,e){if(typeof _=="string"){const o=this._requestManager.transformRequest(_,"Style");h.h(o,new AbortController).then((d=>{this._updateDiff(d.data,e)})).catch((d=>{d&&this.fire(new h.j(d))}))}else typeof _=="object"&&this._updateDiff(_,e)}_updateDiff(_,e){try{this.style.setState(_,e)&&this._update(!0)}catch(o){h.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(_,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(_,e){return this._lazyInitEmptyStyle(),this.style.addSource(_,e),this._update(!0)}isSourceLoaded(_){const e=this.style&&this.style.sourceCaches[_];if(e!==void 0)return e.loaded();this.fire(new h.j(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const e=this.style.sourceCaches[_.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&e.reload();for(const o in this.style._layers){const d=this.style._layers[o];d.type==="hillshade"&&d.source===_.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new po(this.painter,e,_),this.painter.renderToTexture=new pu(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==_.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new h.k("terrain",{terrain:_})),this}getTerrain(){var _,e;return(e=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const e in _){const o=_[e]._tiles;for(const d in o){const p=o[d];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,e,o={}){const{pixelRatio:d=1,sdf:p=!1,stretchX:y,stretchY:T,content:A,textFitWidth:D,textFitHeight:U}=o;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||h.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:$,height:Z,data:Q}=e,oe=e;return this.style.addImage(_,{data:new h.R({width:$,height:Z},new Uint8Array(Q)),pixelRatio:d,stretchX:y,stretchY:T,content:A,textFitWidth:D,textFitHeight:U,sdf:p,version:0,userImage:oe}),oe.onAdd&&oe.onAdd(this,_),this}}{const{width:$,height:Z,data:Q}=B.getImageData(e);this.style.addImage(_,{data:new h.R({width:$,height:Z},Q),pixelRatio:d,stretchX:y,stretchY:T,content:A,textFitWidth:D,textFitHeight:U,sdf:p,version:0})}}updateImage(_,e){const o=this.style.getImage(_);if(!o)return this.fire(new h.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=e instanceof HTMLImageElement||h.b(e)?B.getImageData(e):e,{width:p,height:y,data:T}=d;if(p===void 0||y===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==o.data.width||y!==o.data.height)return this.fire(new h.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const A=!(e instanceof HTMLImageElement||h.b(e));return o.data.replace(T,A),this.style.updateImage(_,o),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new h.j(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return qe.getImage(this._requestManager.transformRequest(_,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,e){return this._lazyInitEmptyStyle(),this.style.addLayer(_,e),this._update(!0)}moveLayer(_,e){return this.style.moveLayer(_,e),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,e,o){return this.style.setLayerZoomRange(_,e,o),this._update(!0)}setFilter(_,e,o={}){return this.style.setFilter(_,e,o),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,e,o,d={}){return this.style.setPaintProperty(_,e,o,d),this._update(!0)}getPaintProperty(_,e){return this.style.getPaintProperty(_,e)}setLayoutProperty(_,e,o,d={}){return this.style.setLayoutProperty(_,e,o,d),this._update(!0)}getLayoutProperty(_,e){return this.style.getLayoutProperty(_,e)}setGlyphs(_,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,e,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,e,o,(d=>{d||this._update(!0)})),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,e,(o=>{o||this._update(!0)})),this}setLight(_,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(_){return this._lazyInitEmptyStyle(),this.style.setSky(_),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(_,e){return this.style.setFeatureState(_,e),this._update()}removeFeatureState(_,e){return this.style.removeFeatureState(_,e),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,e=0;return this._container&&(_=this._container.clientWidth||400,e=this._container.clientHeight||300),[_,e]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const e=this._canvasContainer=q.create("div","maplibregl-canvas-container",_);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=q.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),d=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],d);const p=this._controlContainer=q.create("div","maplibregl-control-container",_),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((T=>{y[T]=q.create("div",`maplibregl-ctrl-${T} `,p)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,e,o){this._canvas.width=Math.floor(o*_),this._canvas.height=Math.floor(o*e),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const _={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",(d=>{e={requestedAttributes:_},d&&(e.statusMessage=d.statusMessage,e.type=d.type)}),{once:!0});const o=this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_);if(!o){const d="Failed to initialize WebGL";throw e?(e.message=d,new Error(JSON.stringify(e))):new Error(d)}this.painter=new w(o,this.transform),ue.testSupport(o)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const p=this.transform.zoom,y=B.now();this.style.zoomHistory.update(p,y);const T=new h.z(p,{now:y,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),A=T.crossFadingFactor();A===1&&A===this._crossFadingFactor||(o=!0,this._crossFadingFactor=A),this.style.update(T)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new h.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.bf.mark(h.bg.load),this.fire(new h.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.k("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,h.bf.mark(h.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),qe.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),q.remove(this._canvasContainer),q.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),h.bf.clearMetrics(),this._removed=!0,this.fire(new h.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,B.frameAsync(this._frameRequest).then((_=>{h.bf.frame(_),this._frameRequest=null,this._render(_)})).catch((()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return ul}getCameraTargetElevation(){return this.transform.elevation}},R.MapMouseEvent=Yn,R.MapTouchEvent=xr,R.MapWheelEvent=ao,R.Marker=Cr,R.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const e=this._map.getZoom(),o=e===this._map.getMaxZoom(),d=e===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,o)=>{const d=this._map._getUIString(`NavigationControl.${o}`);e.title=d,e.setAttribute("aria-label",d)},this.options=h.e({},xi,_),this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),q.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),q.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=q.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Oo(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,e){const o=q.create("button",_,this._container);return o.type="button",o.addEventListener("click",e),o}},R.Popup=class extends h.E{constructor(_){super(),this.remove=()=>(this._content&&q.remove(this._content),this._container&&(q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var o;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=q.create("div","maplibregl-popup",this._map.getContainer()),this._tip=q.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const A of this.options.className.split(" "))this._container.classList.add(A);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?On(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._trackPointer&&!e)return;const d=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let p=this.options.anchor;const y=yu(this.options.offset);if(!p){const A=this._container.offsetWidth,D=this._container.offsetHeight;let U;U=d.y+y.bottom.y<D?["top"]:d.y>this._map.transform.height-D?["bottom"]:[],d.x<A/2?U.push("left"):d.x>this._map.transform.width-A/2&&U.push("right"),p=U.length===0?"bottom":U.join("-")}let T=d.add(y[p]);this.options.subpixelPositioning||(T=T.round()),q.setTransform(this._container,`${Gs[p]} translate(${T.x}px,${T.y}px)`),mo(this._container,p,"popup")},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(sn),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=h.N.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const e=document.createDocumentFragment(),o=document.createElement("body");let d;for(o.innerHTML=_;d=o.firstChild,d;)e.appendChild(d);return this.setDOMContent(e)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=q.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){return this._container&&this._container.classList.add(_),this}removeClassName(_){return this._container&&this._container.classList.remove(_),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=q.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(jl);_&&_.focus()}},R.RasterDEMTileSource=ai,R.RasterTileSource=ot,R.ScaleControl=class{constructor(_){this._onMove=()=>{Bl(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Bl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ws),_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},R.ScrollZoomHandler=ns,R.Style=Wo,R.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=q.create("button","maplibregl-ctrl-terrain",this._container),q.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},R.TwoFingersTouchPitchHandler=Nl,R.TwoFingersTouchRotateHandler=Rl,R.TwoFingersTouchZoomHandler=fu,R.TwoFingersTouchZoomRotateHandler=Vu,R.VectorTileSource=To,R.VideoSource=vn,R.addSourceType=(_,e)=>h._(void 0,void 0,void 0,(function*(){if(aa(_))throw new Error(`A source type called "${_}" already exists.`);((o,d)=>{sa[o]=d})(_,e)})),R.clearPrewarmedResources=function(){const _=Rn;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(Pt),Rn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},R.getMaxParallelImageRequests=function(){return h.a.MAX_PARALLEL_IMAGE_REQUESTS},R.getRTLTextPluginStatus=function(){return tn().getRTLTextPluginStatus()},R.getVersion=function(){return xc},R.getWorkerCount=function(){return yn.workerCount},R.getWorkerUrl=function(){return h.a.WORKER_URL},R.importScriptInWorkers=function(_){return Wt().broadcast("IS",_)},R.prewarm=function(){ei().acquire(Pt)},R.setMaxParallelImageRequests=function(_){h.a.MAX_PARALLEL_IMAGE_REQUESTS=_},R.setRTLTextPlugin=function(_,e){return tn().setRTLTextPlugin(_,e)},R.setWorkerCount=function(_){yn.workerCount=_},R.setWorkerUrl=function(_){h.a.WORKER_URL=_}}));var O=k;return O}))})(Zd)),Zd.exports}var u0=l0();const c0=Uf(u0);function h0(S){return{type:"FeatureCollection",features:S?[{type:"Feature",properties:{},geometry:S}]:[]}}const f0="candidate";function d0(){const S=Ki.useRef(null),b=Ki.useRef(null),k=Ki.useRef(null),P=Qn(R=>R.candidate),C=Qn(R=>R.seekerLngLat),O=Ki.useMemo(()=>h0(P),[P]);return Ki.useEffect(()=>{if(S.current){console.error("VITE_MAPTILER_KEY is not set");return}},[]),Ki.useEffect(()=>{const R=b.current;if(!R||!R.isStyleLoaded())return;const h=R.getSource(f0);if(h&&(h.setData(O),P)){const K=oc(P);R.fitBounds([[K[0],K[1]],[K[2],K[3]]],{padding:40,duration:450})}},[O,P]),Ki.useEffect(()=>{const R=b.current;if(!R||(k.current?.remove(),k.current=null,!C))return;const h=new c0.Marker().setLngLat(C).addTo(R);k.current=h},[C]),Fe.jsx("div",{className:"mapRoot",ref:S})}function p0(){const S=Qn(Te=>Te.candidate),b=Qn(Te=>Te.seekerLngLat),k=Qn(Te=>Te.seekerAccuracyM),P=Qn(Te=>Te.seekerLastUpdatedMs),C=Qn(Te=>Te.isTrackingGPS),O=Qn(Te=>Te.updateSeekerFromGPS),R=Qn(Te=>Te.startGPSTracking),h=Qn(Te=>Te.stopGPSTracking),K=Qn(Te=>Te.undo),ne=Qn(Te=>Te.redo),ee=Qn(Te=>Te.resetCandidateToCountry),B=Qn(Te=>Te.searchQuery),q=Qn(Te=>Te.searchResults),ue=Qn(Te=>Te.setSearchQuery),ce=Qn(Te=>Te.runSearch),de=Qn(Te=>Te.selectSearchResult),Pe=async()=>{try{await ce()}catch(Te){alert(String(Te instanceof Error?Te.message:Te))}},je=(Te,qe=50)=>Te.length<=qe?Te:Te.slice(0,qe-3)+"...";return Fe.jsxs(Fe.Fragment,{children:[Fe.jsxs("section",{className:"panel",children:[Fe.jsx("div",{className:"panelHeader search",children:"SEARCH AREA"}),Fe.jsxs("div",{className:"panelBody",children:[!S&&Fe.jsx("div",{style:{fontSize:"12px",color:"#666",fontStyle:"italic"},children:"Select an area to begin"}),Fe.jsxs("div",{className:"row",children:[Fe.jsx("input",{type:"text",value:B,onChange:Te=>ue(Te.target.value),onKeyDown:Te=>{Te.key==="Enter"&&Pe()},placeholder:"e.g., Los Angeles, California, Europe"}),Fe.jsx("button",{className:"btn",onClick:Pe,children:"Search"})]}),q.length>0&&Fe.jsx("div",{className:"search-results",children:q.map((Te,qe)=>Fe.jsxs("div",{className:"search-result-item",onClick:()=>de(Te),children:[Fe.jsx("div",{className:"search-result-title",children:je(Te.display_name)}),Fe.jsxs("div",{className:"search-result-meta",children:[Te.class&&Te.type&&`${Te.class}/${Te.type}`,Te.address?.country&&Fe.jsxs("span",{children:[Te.class&&Te.type?"  ":"",Te.address.country]})]})]},qe))})]})]}),Fe.jsxs("section",{className:"panel",children:[Fe.jsx("div",{className:"panelHeader seeker",children:"SEEKER GPS"}),Fe.jsxs("div",{className:"panelBody",children:[Fe.jsxs("div",{className:"row",children:[Fe.jsx("button",{className:"btn primary",onClick:()=>O().catch(Te=>alert(Te?.message??String(Te))),children:"Use GPS"}),Fe.jsx("button",{className:"btn",onClick:()=>{if(C)h();else try{R()}catch(Te){alert(Te instanceof Error?Te.message:String(Te))}},children:C?"Stop Tracking":"Track GPS"}),Fe.jsx("button",{className:"btn",onClick:ee,children:"Reset Area"}),Fe.jsx("button",{className:"btn",onClick:K,children:"Undo"}),Fe.jsx("button",{className:"btn",onClick:ne,children:"Redo"})]}),b?Fe.jsxs("div",{className:"coords-display",children:[b[0].toFixed(5),", ",b[1].toFixed(5),k&&`  ${Math.round(k)}m`,P&&Fe.jsxs(Fe.Fragment,{children:[Fe.jsx("br",{}),"Last updated: ",new Date(P).toLocaleTimeString()]})]}):Fe.jsx("div",{className:"coords-display",style:{color:"#999",fontStyle:"italic"},children:"No seeker position yet."})]})]})]})}function th(S){return new Date(S).toLocaleString()}function m0(){const S=Qn(b=>b.history);return Fe.jsxs("div",{className:"history-panel",children:[Fe.jsx("strong",{children:"History"}),Fe.jsxs("div",{className:"history-list",children:[S.length===0&&Fe.jsx("small",{className:"muted",children:"No actions yet."}),S.slice().reverse().map(b=>{switch(b.type){case"SET_COUNTRY":return Fe.jsxs("div",{className:"history-item",children:[Fe.jsx("div",{className:"history-timestamp",children:th(b.ts)}),Fe.jsxs("div",{className:"history-action",children:[Fe.jsx("span",{className:"history-action-label",children:"Area:"})," ",b.name??b.isoA2," (",b.isoA2,")"]})]},b.id);case"SET_AREA":return Fe.jsxs("div",{className:"history-item",children:[Fe.jsx("div",{className:"history-timestamp",children:th(b.ts)}),Fe.jsxs("div",{className:"history-action",children:[Fe.jsx("span",{className:"history-action-label",children:"Area:"})," ",b.label]})]},b.id);case"POI_WITHIN":return Fe.jsxs("div",{className:"history-item",children:[Fe.jsx("div",{className:"history-timestamp",children:th(b.ts)}),Fe.jsxs("div",{className:"history-action",children:[Fe.jsx("span",{className:"history-action-label",children:"POI:"})," ",b.kind," ",b.radiusMiles," mi ",b.answer," (",b.poiCount," found)"]})]},b.id);case"RADAR":return Fe.jsxs("div",{className:"history-item",children:[Fe.jsx("div",{className:"history-timestamp",children:th(b.ts)}),Fe.jsxs("div",{className:"history-action",children:[Fe.jsx("span",{className:"history-action-label",children:"Radar:"})," ",b.hit?"Hit":"Miss"," ",b.radiusMiles," mi"]})]},b.id);case"THERMOMETER":return Fe.jsxs("div",{className:"history-item",children:[Fe.jsx("div",{className:"history-timestamp",children:th(b.ts)}),Fe.jsxs("div",{className:"history-action",children:[Fe.jsx("span",{className:"history-action-label",children:"Thermometer:"})," ",b.hotter?"Hotter":"Colder"]})]},b.id);case"MATCHING":return Fe.jsxs("div",{className:"history-item",children:[Fe.jsx("div",{className:"history-timestamp",children:th(b.ts)}),Fe.jsxs("div",{className:"history-action",children:[Fe.jsx("span",{className:"history-action-label",children:"Matching:"})," ",b.kind," ",b.answer," (",b.keptCount,"/",b.sampleCount," samples, ",b.poiCount," POIs)"]})]},b.id);case"MEASURING":return Fe.jsxs("div",{className:"history-item",children:[Fe.jsx("div",{className:"history-timestamp",children:th(b.ts)}),Fe.jsxs("div",{className:"history-action",children:[Fe.jsx("span",{className:"history-action-label",children:"Measuring:"})," ",b.kind," ",b.answer," (",b.keptCount,"/",b.sampleCount," samples, ",b.poiCount," POIs)"]})]},b.id);default:return null}})]})]})}function g0({isOpen:S,onClose:b,initialQuery:k=""}){const P=Qn(ce=>ce.searchQuery),C=Qn(ce=>ce.searchResults),O=Qn(ce=>ce.setSearchQuery),R=Qn(ce=>ce.runSearch),h=Qn(ce=>ce.selectSearchResult),K=Ki.useRef(null),ne=Ki.useRef(null),[ee,B]=Ki.useState(-1);if(Ki.useEffect(()=>{S&&K.current&&(setTimeout(()=>{K.current?.focus()},0),k?(O(k),setTimeout(()=>{R().catch(()=>{})},50)):P||O(""),B(-1))},[S,k,O,P,R]),Ki.useEffect(()=>{if(!S)return;const ce=de=>{de.key==="Escape"&&(b(),de.preventDefault(),de.stopPropagation())};return window.addEventListener("keydown",ce,!0),()=>{window.removeEventListener("keydown",ce,!0)}},[S,b]),Ki.useEffect(()=>()=>{ne.current&&clearTimeout(ne.current)},[]),Ki.useEffect(()=>{C.length>0&&ee>=C.length&&B(-1)},[C.length,ee]),!S)return null;const q=(ce,de=60)=>ce.length<=de?ce:ce.slice(0,de-3)+"...",ue=ce=>{h(ce),b()};return Fe.jsx("div",{className:"quick-search-overlay",onClick:b,children:Fe.jsxs("div",{className:"quick-search-panel",onClick:ce=>ce.stopPropagation(),children:[Fe.jsx("input",{ref:K,type:"text",className:"quick-search-input",value:P,onChange:ce=>{O(ce.target.value),B(-1),ne.current&&clearTimeout(ne.current),ne.current=setTimeout(()=>{R().catch(()=>{})},300)},onKeyDown:ce=>{ce.key==="ArrowDown"?(ce.preventDefault(),B(de=>de<C.length-1?de+1:de)):ce.key==="ArrowUp"?(ce.preventDefault(),B(de=>de>0?de-1:-1)):ce.key==="Enter"?(ce.preventDefault(),C.length>0&&ee>=0?(h(C[ee]),b()):C.length>0&&(h(C[0]),b())):ce.key==="Escape"&&ce.stopPropagation()},placeholder:"Search for a place..."}),C.length>0&&Fe.jsx("div",{className:"quick-search-results",children:C.map((ce,de)=>Fe.jsxs("div",{className:`quick-search-result-item ${de===ee?"highlighted":""}`,onClick:()=>ue(ce),onMouseEnter:()=>B(de),children:[Fe.jsx("div",{className:"quick-search-result-title",children:q(ce.display_name)}),Fe.jsxs("div",{className:"quick-search-result-meta",children:[ce.class&&ce.type&&`${ce.class}/${ce.type}`,ce.address?.country&&Fe.jsxs("span",{children:[ce.class&&ce.type?"  ":"",ce.address.country]})]})]},de))})]})})}const Rf={Matching:Fe.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20",children:Fe.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})}),Measuring:Fe.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20",children:Fe.jsx("path",{d:"M21.71 11.29l-9-9c-.39-.39-1.02-.39-1.41 0l-9 9c-.39.39-.39 1.02 0 1.41l9 9c.39.39 1.02.39 1.41 0l9-9c.39-.38.39-1.01 0-1.41zM14 14.5V12h-4v3H8v-4c0-.55.45-1 1-1h5V7.5l3.5 3.5-3.5 3.5z"})}),Radar:Fe.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20",children:[Fe.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5.5-2.5l7.51-3.27-7.5-3.22zm6.31-4.06l-2.06.9 2.06.91z"}),Fe.jsx("circle",{cx:"12",cy:"12",r:"2"})]}),Thermometer:Fe.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20",children:Fe.jsx("path",{d:"M15 13V5c0-1.66-1.34-3-3-3S9 3.34 9 5v8c-1.21.91-2 2.37-2 4 0 2.76 2.24 5 5 5s5-2.24 5-5c0-1.63-.79-3.09-2-4zm-4-2V5c0-.55.45-1 1-1s1 .45 1 1v1h-1v1h1v2h-2z"})}),Tentacles:Fe.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20",children:[Fe.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),Fe.jsx("path",{d:"M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z"})]})};function y0({kind:S,label:b,onClose:k,onAnswer:P}){const[C,O]=Ki.useState(5),R=[1,3,5,10,25],h=K=>{P(C,K),k()};return Fe.jsx("div",{className:"poi-modal-overlay",onClick:k,children:Fe.jsxs("div",{className:"poi-modal-panel",onClick:K=>K.stopPropagation(),children:[Fe.jsxs("div",{className:"poi-modal-header",children:[Fe.jsxs("h3",{children:["POI  ",b]}),Fe.jsx("button",{className:"poi-modal-close",onClick:k,children:""})]}),Fe.jsxs("div",{className:"poi-modal-content",children:[Fe.jsxs("div",{className:"poi-modal-prompt",children:["Within ",Fe.jsxs("strong",{children:[C," mi"]})," of a ",Fe.jsx("strong",{children:b.toLowerCase()}),"?"]}),Fe.jsxs("div",{className:"poi-modal-radii",children:[Fe.jsx("div",{className:"section-label",children:"Radius"}),Fe.jsx("div",{className:"tile-grid",children:R.map(K=>Fe.jsxs("button",{className:`tile-button ${C===K?"selected":""}`,onClick:()=>O(K),children:[K," mi"]},K))})]}),Fe.jsxs("div",{className:"poi-modal-answers",children:[Fe.jsx("button",{className:"tile-button yellow large",onClick:()=>h("YES"),children:"YES"}),Fe.jsx("button",{className:"tile-button yellow large",onClick:()=>h("NO"),children:"NO"})]})]})]})})}const cy=[.5,1,3,5,10,25,50,100],_0=cy.slice(0,4),v0=cy.slice(4),hy=[{label:"Airport",kind:"airport"},{label:"Train Station",kind:"trainstation"},{label:"Metro/Subway",kind:"metro_station"},{label:"Highway Access",kind:"highway_access"},{label:"Park",kind:"park"},{label:"Hospital",kind:"hospital"},{label:"Library",kind:"library"},{label:"Museum",kind:"museum"},{label:"Government",kind:"government"},{label:"Stadium",kind:"stadium"},{label:"University",kind:"university"},{label:"School",kind:"school"},{label:"Police",kind:"police"},{label:"Fire Station",kind:"fire_station"},{label:"Castle",kind:"castle"},{label:"Ferry Terminal",kind:"ferry_terminal"}],x0=[...hy],w0=[{label:"Airport",dist:"15 mi"},{label:"Park",dist:"15 mi"},{label:"Mountain",dist:"15 mi"},{label:"Transit",dist:"15 mi"},{label:"Airport",dist:"1 mi"},{label:"Park",dist:"1 mi"},{label:"Mountain",dist:"1 mi"},{label:"Transit",dist:"1 mi"}],b0=[{kind:"zoo",label:"Zoo"},{kind:"hospital",label:"Hospital"},{kind:"museum",label:"Museum"},{kind:"library",label:"Library"},{kind:"university",label:"University"},{kind:"school",label:"School"},{kind:"police",label:"Police"},{kind:"firestation",label:"Fire Station"},{kind:"courthouse",label:"Courthouse"},{kind:"townhall",label:"Town Hall"},{kind:"embassy",label:"Embassy"},{kind:"park",label:"Park"},{kind:"stadium",label:"Stadium"},{kind:"themepark",label:"Theme Park"},{kind:"castle",label:"Castle"},{kind:"peak",label:"Peak"},{kind:"airport",label:"Airport"},{kind:"trainstation",label:"Train Station"},{kind:"ferry",label:"Ferry Terminal"}];function k0(){const S=Qn(Ge=>Ge.candidate),b=Qn(Ge=>Ge.seekerLngLat),k=Qn(Ge=>Ge.thermoStart),P=Qn(Ge=>Ge.thermoEnd),C=Qn(Ge=>Ge.setThermoStartNow),O=Qn(Ge=>Ge.setThermoEndNow),R=Qn(Ge=>Ge.applyRadarNow),h=Qn(Ge=>Ge.applyThermo),K=Qn(Ge=>Ge.applyPoiWithin),ne=Qn(Ge=>Ge.applyMatching),ee=Qn(Ge=>Ge.applyMeasuring),[B,q]=Ki.useState(null),[ue,ce]=Ki.useState(""),[de,Pe]=Ki.useState(null),[je,Te]=Ki.useState(null),[qe,tt]=Ki.useState("CLOSER"),nt=(Ge,ht)=>{q(Ge),ce(ht)},it=async(Ge,ht)=>{B&&await K(B,Ge,ht)};return Fe.jsxs("div",{className:"jlMenu",children:[Fe.jsx("div",{className:"jlBanner",children:"QUESTION MENU"}),Fe.jsxs("div",{className:"jlColumns",children:[Fe.jsx("section",{className:"jlCol",children:Fe.jsxs("div",{className:"jlCategory",children:[Fe.jsxs("div",{className:"jlCatHeader",children:[Fe.jsx("div",{className:"jlCatIcon matching",children:Rf.Matching}),Fe.jsxs("div",{className:"jlCatTitles",children:[Fe.jsx("div",{className:"jlCatTitle",children:"MATCHING"}),Fe.jsx("div",{className:"jlCatSub",children:"DRAW 3, PICK 1"})]})]}),!b&&Fe.jsx("div",{style:{fontSize:"11px",color:"#d32f2f",fontWeight:600,marginTop:"4px"},children:"Requires seeker GPS"}),Fe.jsx("div",{className:"jlGrid matching",children:hy.map(Ge=>Fe.jsx("button",{className:"jlTile matching",disabled:!S||!b,onClick:()=>Pe(Ge.kind),type:"button",children:Ge.label},Ge.kind))}),de&&Fe.jsxs("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap"},children:[Fe.jsx("button",{type:"button",className:"tileBtn",onClick:()=>ne(de,"YES"),disabled:!S||!b,children:"YES"}),Fe.jsx("button",{type:"button",className:"tileBtn",onClick:()=>ne(de,"NO"),disabled:!S||!b,children:"NO"}),Fe.jsx("button",{type:"button",className:"tileBtn",onClick:()=>Pe(null),children:"Clear"})]})]})}),Fe.jsx("section",{className:"jlCol",children:Fe.jsxs("div",{className:"jlCategory",children:[Fe.jsxs("div",{className:"jlCatHeader",children:[Fe.jsx("div",{className:"jlCatIcon measuring",children:Rf.Measuring}),Fe.jsxs("div",{className:"jlCatTitles",children:[Fe.jsx("div",{className:"jlCatTitle",children:"MEASURING"}),Fe.jsx("div",{className:"jlCatSub",children:"DRAW 3, PICK 1"})]})]}),!b&&Fe.jsx("div",{style:{fontSize:"11px",color:"#d32f2f",fontWeight:600,marginTop:"4px"},children:"Requires seeker GPS"}),Fe.jsx("div",{className:"jlGrid measuring",children:x0.map(Ge=>Fe.jsx("button",{className:"jlTile measuring",disabled:!S||!b,onClick:()=>{Te(Ge.kind),ee(Ge.kind,qe)},type:"button",children:Ge.label},Ge.kind))}),je&&Fe.jsxs("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap"},children:[Fe.jsx("button",{type:"button",className:"tileBtn",onClick:()=>{tt("CLOSER"),ee(je,"CLOSER")},disabled:!S||!b,children:"CLOSER"}),Fe.jsx("button",{type:"button",className:"tileBtn",onClick:()=>{tt("FARTHER"),ee(je,"FARTHER")},disabled:!S||!b,children:"FARTHER"}),Fe.jsx("button",{type:"button",className:"tileBtn",onClick:()=>Te(null),children:"Clear"})]})]})}),Fe.jsx("section",{className:"jlCol",children:Fe.jsxs("div",{className:"jlCategory",children:[Fe.jsxs("div",{className:"jlCatHeader",children:[Fe.jsx("div",{className:"jlCatIcon radar",children:Rf.Radar}),Fe.jsxs("div",{className:"jlCatTitles",children:[Fe.jsx("div",{className:"jlCatTitle",children:"RADAR"}),Fe.jsx("div",{className:"jlCatSub",children:"DRAW 2, PICK 1"})]})]}),!b&&Fe.jsx("div",{style:{fontSize:"11px",color:"#d32f2f",fontWeight:600,marginTop:"4px"},children:"Requires seeker GPS"}),Fe.jsx("div",{className:"section-label",style:{marginTop:"8px",fontSize:"10px",opacity:.7},children:"HIT"}),Fe.jsx("div",{className:"jlGrid radar",children:_0.map(Ge=>Fe.jsxs("button",{className:"jlTile radar",onClick:()=>R(Ge,!0),disabled:!b||!S,style:{flexDirection:"column",gap:2,lineHeight:1},children:[Fe.jsx("span",{style:{fontSize:10,opacity:.8},children:"HIT"}),Fe.jsxs("span",{children:[Ge," mi"]})]},`hit-${Ge}`))}),Fe.jsx("div",{className:"section-label",style:{marginTop:"14px",fontSize:"10px",opacity:.7},children:"MISS"}),Fe.jsxs("div",{className:"jlGrid radar",children:[v0.map(Ge=>Fe.jsxs("button",{className:"jlTile radar",onClick:()=>R(Ge,!1),disabled:!b||!S,style:{flexDirection:"column",gap:2,lineHeight:1},children:[Fe.jsx("span",{style:{fontSize:10,opacity:.8},children:"MISS"}),Fe.jsxs("span",{children:[Ge," mi"]})]},`miss-${Ge}`)),Fe.jsxs("button",{className:"jlTile radar disabled",disabled:!0,style:{flexDirection:"column",gap:2,lineHeight:1},children:[Fe.jsx("span",{style:{fontSize:10,opacity:.8},children:"???"}),Fe.jsx("span",{children:"CUSTOM"})]})]})]})}),Fe.jsxs("section",{className:"jlCol",children:[Fe.jsxs("div",{className:"jlCategory",children:[Fe.jsxs("div",{className:"jlCatHeader",children:[Fe.jsx("div",{className:"jlCatIcon thermo",children:Rf.Thermometer}),Fe.jsxs("div",{className:"jlCatTitles",children:[Fe.jsx("div",{className:"jlCatTitle",children:"THERMOMETER"}),Fe.jsx("div",{className:"jlCatSub",children:"DRAW 2, PICK 1"})]})]}),Fe.jsxs("div",{className:"jlGrid thermo",children:[Fe.jsxs("button",{className:"jlTile thermo",onClick:C,disabled:!b||!S,style:{flexDirection:"column",gap:2,lineHeight:1},children:[Fe.jsx("span",{children:"SET"}),Fe.jsx("span",{children:"START"})]}),Fe.jsxs("button",{className:"jlTile thermo",onClick:O,disabled:!b||!S,style:{flexDirection:"column",gap:2,lineHeight:1},children:[Fe.jsx("span",{children:"SET"}),Fe.jsx("span",{children:"END"})]}),Fe.jsx("button",{className:"jlTile thermo",onClick:()=>h(!0),disabled:!S||!k||!P,children:"HOTTER"}),Fe.jsx("button",{className:"jlTile thermo",onClick:()=>h(!1),disabled:!S||!k||!P,children:"COLDER"})]})]}),Fe.jsxs("div",{className:"jlCategory",style:{marginTop:"24px"},children:[Fe.jsxs("div",{className:"jlCatHeader",children:[Fe.jsx("div",{className:"jlCatIcon tentacles",children:Rf.Tentacles}),Fe.jsxs("div",{className:"jlCatTitles",children:[Fe.jsx("div",{className:"jlCatTitle",children:"TENTACLES"}),Fe.jsx("div",{className:"jlCatSub",children:"DRAW 4, PICK 2"})]})]}),Fe.jsx("div",{className:"jlGrid tentacles",children:w0.map((Ge,ht)=>Fe.jsxs("button",{className:"jlTile tentacles disabled",disabled:!0,style:{flexDirection:"column",gap:2,lineHeight:1},children:[Fe.jsx("span",{children:Ge.label}),Fe.jsx("span",{style:{fontSize:"10px",opacity:.8},children:Ge.dist})]},ht))}),Fe.jsx("div",{className:"section-label",style:{marginTop:"16px",fontSize:"10px",opacity:.7},children:"PLACES (OSM)"}),Fe.jsx("div",{className:"jlGrid poi",children:b0.map(({kind:Ge,label:ht})=>Fe.jsx("button",{className:"jlTile poi",onClick:()=>nt(Ge,ht),disabled:!S,children:ht},Ge))})]})]})]}),B&&Fe.jsx(y0,{kind:B,label:ue,onClose:()=>{q(null),ce("")},onAnswer:it})]})}function S0(){const[S,b]=Ki.useState(!1),[k,P]=Ki.useState(""),C=Qn(R=>R.lastToast),O=Qn(R=>R.setLastToast);return Ki.useEffect(()=>{const R=h=>{const K=h.target,ne=K.tagName==="INPUT"||K.tagName==="TEXTAREA"||K.tagName==="SELECT",ee=K.isContentEditable;if((h.metaKey||h.ctrlKey)&&h.key==="k"){h.preventDefault(),P(""),b(!0);return}ne||ee||h.key.length===1&&!h.ctrlKey&&!h.metaKey&&!h.altKey&&(P(h.key),b(!0),h.preventDefault())};return window.addEventListener("keydown",R),()=>{window.removeEventListener("keydown",R)}},[]),Ki.useEffect(()=>{if(C){const R=setTimeout(()=>{O(null)},3e3);return()=>clearTimeout(R)}},[C,O]),Fe.jsxs("div",{className:"app",children:[Fe.jsxs("aside",{className:"sidebar",children:[C&&Fe.jsx("div",{className:"toast-message",children:C}),Fe.jsxs("div",{className:"sidebarInner",children:[Fe.jsx(p0,{}),Fe.jsx(k0,{}),Fe.jsx(m0,{})]})]}),Fe.jsx("main",{className:"mapWrap",children:Fe.jsx(d0,{})}),Fe.jsx(g0,{isOpen:S,onClose:()=>b(!1),initialQuery:k})]})}By.createRoot(document.getElementById("root")).render(Fe.jsx(Mg.StrictMode,{children:Fe.jsx(S0,{})}));
