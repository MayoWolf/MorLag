(function(){const b=document.createElement("link").relList;if(b&&b.supports&&b.supports("modulepreload"))return;for(const F of document.querySelectorAll('link[rel="modulepreload"]'))z(F);new MutationObserver(F=>{for(const O of F)if(O.type==="childList")for(const I of O.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&z(I)}).observe(document,{childList:!0,subtree:!0});function S(F){const O={};return F.integrity&&(O.integrity=F.integrity),F.referrerPolicy&&(O.referrerPolicy=F.referrerPolicy),F.crossOrigin==="use-credentials"?O.credentials="include":F.crossOrigin==="anonymous"?O.credentials="omit":O.credentials="same-origin",O}function z(F){if(F.ep)return;F.ep=!0;const O=S(F);fetch(F.href,O)}})();function xp(P){return P&&P.__esModule&&Object.prototype.hasOwnProperty.call(P,"default")?P.default:P}var Gp={exports:{}},ad={},Hp={exports:{}},gr={};var Lf;function rg(){if(Lf)return gr;Lf=1;var P=Symbol.for("react.element"),b=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),z=Symbol.for("react.strict_mode"),F=Symbol.for("react.profiler"),O=Symbol.for("react.provider"),I=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),Y=Symbol.for("react.suspense"),J=Symbol.for("react.memo"),he=Symbol.for("react.lazy"),N=Symbol.iterator;function $(be){return be===null||typeof be!="object"?null:(be=N&&be[N]||be["@@iterator"],typeof be=="function"?be:null)}var fe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ae=Object.assign,se={};function De(be,Oe,Gt){this.props=be,this.context=Oe,this.refs=se,this.updater=Gt||fe}De.prototype.isReactComponent={},De.prototype.setState=function(be,Oe){if(typeof be!="object"&&typeof be!="function"&&be!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,be,Oe,"setState")},De.prototype.forceUpdate=function(be){this.updater.enqueueForceUpdate(this,be,"forceUpdate")};function Le(){}Le.prototype=De.prototype;function tt(be,Oe,Gt){this.props=be,this.context=Oe,this.refs=se,this.updater=Gt||fe}var Ge=tt.prototype=new Le;Ge.constructor=tt,Ae(Ge,De.prototype),Ge.isPureReactComponent=!0;var rt=Array.isArray,mt=Object.prototype.hasOwnProperty,pt={current:null},St={key:!0,ref:!0,__self:!0,__source:!0};function At(be,Oe,Gt){var Ht,Jt={},ar=null,ir=null;if(Oe!=null)for(Ht in Oe.ref!==void 0&&(ir=Oe.ref),Oe.key!==void 0&&(ar=""+Oe.key),Oe)mt.call(Oe,Ht)&&!St.hasOwnProperty(Ht)&&(Jt[Ht]=Oe[Ht]);var tr=arguments.length-2;if(tr===1)Jt.children=Gt;else if(1<tr){for(var Sr=Array(tr),li=0;li<tr;li++)Sr[li]=arguments[li+2];Jt.children=Sr}if(be&&be.defaultProps)for(Ht in tr=be.defaultProps,tr)Jt[Ht]===void 0&&(Jt[Ht]=tr[Ht]);return{$$typeof:P,type:be,key:ar,ref:ir,props:Jt,_owner:pt.current}}function Zt(be,Oe){return{$$typeof:P,type:be.type,key:Oe,ref:be.ref,props:be.props,_owner:be._owner}}function nr(be){return typeof be=="object"&&be!==null&&be.$$typeof===P}function It(be){var Oe={"=":"=0",":":"=2"};return"$"+be.replace(/[=:]/g,function(Gt){return Oe[Gt]})}var sr=/\/+/g;function Vt(be,Oe){return typeof be=="object"&&be!==null&&be.key!=null?It(""+be.key):Oe.toString(36)}function or(be,Oe,Gt,Ht,Jt){var ar=typeof be;(ar==="undefined"||ar==="boolean")&&(be=null);var ir=!1;if(be===null)ir=!0;else switch(ar){case"string":case"number":ir=!0;break;case"object":switch(be.$$typeof){case P:case b:ir=!0}}if(ir)return ir=be,Jt=Jt(ir),be=Ht===""?"."+Vt(ir,0):Ht,rt(Jt)?(Gt="",be!=null&&(Gt=be.replace(sr,"$&/")+"/"),or(Jt,Oe,Gt,"",function(li){return li})):Jt!=null&&(nr(Jt)&&(Jt=Zt(Jt,Gt+(!Jt.key||ir&&ir.key===Jt.key?"":(""+Jt.key).replace(sr,"$&/")+"/")+be)),Oe.push(Jt)),1;if(ir=0,Ht=Ht===""?".":Ht+":",rt(be))for(var tr=0;tr<be.length;tr++){ar=be[tr];var Sr=Ht+Vt(ar,tr);ir+=or(ar,Oe,Gt,Sr,Jt)}else if(Sr=$(be),typeof Sr=="function")for(be=Sr.call(be),tr=0;!(ar=be.next()).done;)ar=ar.value,Sr=Ht+Vt(ar,tr++),ir+=or(ar,Oe,Gt,Sr,Jt);else if(ar==="object")throw Oe=String(be),Error("Objects are not valid as a React child (found: "+(Oe==="[object Object]"?"object with keys {"+Object.keys(be).join(", ")+"}":Oe)+"). If you meant to render a collection of children, use an array instead.");return ir}function Kr(be,Oe,Gt){if(be==null)return be;var Ht=[],Jt=0;return or(be,Ht,"","",function(ar){return Oe.call(Gt,ar,Jt++)}),Ht}function Gr(be){if(be._status===-1){var Oe=be._result;Oe=Oe(),Oe.then(function(Gt){(be._status===0||be._status===-1)&&(be._status=1,be._result=Gt)},function(Gt){(be._status===0||be._status===-1)&&(be._status=2,be._result=Gt)}),be._status===-1&&(be._status=0,be._result=Oe)}if(be._status===1)return be._result.default;throw be._result}var cr={current:null},ut={transition:null},zt={ReactCurrentDispatcher:cr,ReactCurrentBatchConfig:ut,ReactCurrentOwner:pt};function ht(){throw Error("act(...) is not supported in production builds of React.")}return gr.Children={map:Kr,forEach:function(be,Oe,Gt){Kr(be,function(){Oe.apply(this,arguments)},Gt)},count:function(be){var Oe=0;return Kr(be,function(){Oe++}),Oe},toArray:function(be){return Kr(be,function(Oe){return Oe})||[]},only:function(be){if(!nr(be))throw Error("React.Children.only expected to receive a single React element child.");return be}},gr.Component=De,gr.Fragment=S,gr.Profiler=F,gr.PureComponent=tt,gr.StrictMode=z,gr.Suspense=Y,gr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zt,gr.act=ht,gr.cloneElement=function(be,Oe,Gt){if(be==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+be+".");var Ht=Ae({},be.props),Jt=be.key,ar=be.ref,ir=be._owner;if(Oe!=null){if(Oe.ref!==void 0&&(ar=Oe.ref,ir=pt.current),Oe.key!==void 0&&(Jt=""+Oe.key),be.type&&be.type.defaultProps)var tr=be.type.defaultProps;for(Sr in Oe)mt.call(Oe,Sr)&&!St.hasOwnProperty(Sr)&&(Ht[Sr]=Oe[Sr]===void 0&&tr!==void 0?tr[Sr]:Oe[Sr])}var Sr=arguments.length-2;if(Sr===1)Ht.children=Gt;else if(1<Sr){tr=Array(Sr);for(var li=0;li<Sr;li++)tr[li]=arguments[li+2];Ht.children=tr}return{$$typeof:P,type:be.type,key:Jt,ref:ar,props:Ht,_owner:ir}},gr.createContext=function(be){return be={$$typeof:I,_currentValue:be,_currentValue2:be,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},be.Provider={$$typeof:O,_context:be},be.Consumer=be},gr.createElement=At,gr.createFactory=function(be){var Oe=At.bind(null,be);return Oe.type=be,Oe},gr.createRef=function(){return{current:null}},gr.forwardRef=function(be){return{$$typeof:h,render:be}},gr.isValidElement=nr,gr.lazy=function(be){return{$$typeof:he,_payload:{_status:-1,_result:be},_init:Gr}},gr.memo=function(be,Oe){return{$$typeof:J,type:be,compare:Oe===void 0?null:Oe}},gr.startTransition=function(be){var Oe=ut.transition;ut.transition={};try{be()}finally{ut.transition=Oe}},gr.unstable_act=ht,gr.useCallback=function(be,Oe){return cr.current.useCallback(be,Oe)},gr.useContext=function(be){return cr.current.useContext(be)},gr.useDebugValue=function(){},gr.useDeferredValue=function(be){return cr.current.useDeferredValue(be)},gr.useEffect=function(be,Oe){return cr.current.useEffect(be,Oe)},gr.useId=function(){return cr.current.useId()},gr.useImperativeHandle=function(be,Oe,Gt){return cr.current.useImperativeHandle(be,Oe,Gt)},gr.useInsertionEffect=function(be,Oe){return cr.current.useInsertionEffect(be,Oe)},gr.useLayoutEffect=function(be,Oe){return cr.current.useLayoutEffect(be,Oe)},gr.useMemo=function(be,Oe){return cr.current.useMemo(be,Oe)},gr.useReducer=function(be,Oe,Gt){return cr.current.useReducer(be,Oe,Gt)},gr.useRef=function(be){return cr.current.useRef(be)},gr.useState=function(be){return cr.current.useState(be)},gr.useSyncExternalStore=function(be,Oe,Gt){return cr.current.useSyncExternalStore(be,Oe,Gt)},gr.useTransition=function(){return cr.current.useTransition()},gr.version="18.3.1",gr}var Rf;function gd(){return Rf||(Rf=1,Hp.exports=rg()),Hp.exports}var Ff;function ig(){if(Ff)return ad;Ff=1;var P=gd(),b=Symbol.for("react.element"),S=Symbol.for("react.fragment"),z=Object.prototype.hasOwnProperty,F=P.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,O={key:!0,ref:!0,__self:!0,__source:!0};function I(h,Y,J){var he,N={},$=null,fe=null;J!==void 0&&($=""+J),Y.key!==void 0&&($=""+Y.key),Y.ref!==void 0&&(fe=Y.ref);for(he in Y)z.call(Y,he)&&!O.hasOwnProperty(he)&&(N[he]=Y[he]);if(h&&h.defaultProps)for(he in Y=h.defaultProps,Y)N[he]===void 0&&(N[he]=Y[he]);return{$$typeof:b,type:h,key:$,ref:fe,props:N,_owner:F.current}}return ad.Fragment=S,ad.jsx=I,ad.jsxs=I,ad}var Bf;function ng(){return Bf||(Bf=1,Gp.exports=ig()),Gp.exports}var xt=ng(),hu=gd();const wm=xp(hu);var up={},Wp={exports:{}},As={},Xp={exports:{}},Kp={};var Of;function sg(){return Of||(Of=1,(function(P){function b(ut,zt){var ht=ut.length;ut.push(zt);e:for(;0<ht;){var be=ht-1>>>1,Oe=ut[be];if(0<F(Oe,zt))ut[be]=zt,ut[ht]=Oe,ht=be;else break e}}function S(ut){return ut.length===0?null:ut[0]}function z(ut){if(ut.length===0)return null;var zt=ut[0],ht=ut.pop();if(ht!==zt){ut[0]=ht;e:for(var be=0,Oe=ut.length,Gt=Oe>>>1;be<Gt;){var Ht=2*(be+1)-1,Jt=ut[Ht],ar=Ht+1,ir=ut[ar];if(0>F(Jt,ht))ar<Oe&&0>F(ir,Jt)?(ut[be]=ir,ut[ar]=ht,be=ar):(ut[be]=Jt,ut[Ht]=ht,be=Ht);else if(ar<Oe&&0>F(ir,ht))ut[be]=ir,ut[ar]=ht,be=ar;else break e}}return zt}function F(ut,zt){var ht=ut.sortIndex-zt.sortIndex;return ht!==0?ht:ut.id-zt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var O=performance;P.unstable_now=function(){return O.now()}}else{var I=Date,h=I.now();P.unstable_now=function(){return I.now()-h}}var Y=[],J=[],he=1,N=null,$=3,fe=!1,Ae=!1,se=!1,De=typeof setTimeout=="function"?setTimeout:null,Le=typeof clearTimeout=="function"?clearTimeout:null,tt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Ge(ut){for(var zt=S(J);zt!==null;){if(zt.callback===null)z(J);else if(zt.startTime<=ut)z(J),zt.sortIndex=zt.expirationTime,b(Y,zt);else break;zt=S(J)}}function rt(ut){if(se=!1,Ge(ut),!Ae)if(S(Y)!==null)Ae=!0,Gr(mt);else{var zt=S(J);zt!==null&&cr(rt,zt.startTime-ut)}}function mt(ut,zt){Ae=!1,se&&(se=!1,Le(At),At=-1),fe=!0;var ht=$;try{for(Ge(zt),N=S(Y);N!==null&&(!(N.expirationTime>zt)||ut&&!It());){var be=N.callback;if(typeof be=="function"){N.callback=null,$=N.priorityLevel;var Oe=be(N.expirationTime<=zt);zt=P.unstable_now(),typeof Oe=="function"?N.callback=Oe:N===S(Y)&&z(Y),Ge(zt)}else z(Y);N=S(Y)}if(N!==null)var Gt=!0;else{var Ht=S(J);Ht!==null&&cr(rt,Ht.startTime-zt),Gt=!1}return Gt}finally{N=null,$=ht,fe=!1}}var pt=!1,St=null,At=-1,Zt=5,nr=-1;function It(){return!(P.unstable_now()-nr<Zt)}function sr(){if(St!==null){var ut=P.unstable_now();nr=ut;var zt=!0;try{zt=St(!0,ut)}finally{zt?Vt():(pt=!1,St=null)}}else pt=!1}var Vt;if(typeof tt=="function")Vt=function(){tt(sr)};else if(typeof MessageChannel<"u"){var or=new MessageChannel,Kr=or.port2;or.port1.onmessage=sr,Vt=function(){Kr.postMessage(null)}}else Vt=function(){De(sr,0)};function Gr(ut){St=ut,pt||(pt=!0,Vt())}function cr(ut,zt){At=De(function(){ut(P.unstable_now())},zt)}P.unstable_IdlePriority=5,P.unstable_ImmediatePriority=1,P.unstable_LowPriority=4,P.unstable_NormalPriority=3,P.unstable_Profiling=null,P.unstable_UserBlockingPriority=2,P.unstable_cancelCallback=function(ut){ut.callback=null},P.unstable_continueExecution=function(){Ae||fe||(Ae=!0,Gr(mt))},P.unstable_forceFrameRate=function(ut){0>ut||125<ut?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Zt=0<ut?Math.floor(1e3/ut):5},P.unstable_getCurrentPriorityLevel=function(){return $},P.unstable_getFirstCallbackNode=function(){return S(Y)},P.unstable_next=function(ut){switch($){case 1:case 2:case 3:var zt=3;break;default:zt=$}var ht=$;$=zt;try{return ut()}finally{$=ht}},P.unstable_pauseExecution=function(){},P.unstable_requestPaint=function(){},P.unstable_runWithPriority=function(ut,zt){switch(ut){case 1:case 2:case 3:case 4:case 5:break;default:ut=3}var ht=$;$=ut;try{return zt()}finally{$=ht}},P.unstable_scheduleCallback=function(ut,zt,ht){var be=P.unstable_now();switch(typeof ht=="object"&&ht!==null?(ht=ht.delay,ht=typeof ht=="number"&&0<ht?be+ht:be):ht=be,ut){case 1:var Oe=-1;break;case 2:Oe=250;break;case 5:Oe=1073741823;break;case 4:Oe=1e4;break;default:Oe=5e3}return Oe=ht+Oe,ut={id:he++,callback:zt,priorityLevel:ut,startTime:ht,expirationTime:Oe,sortIndex:-1},ht>be?(ut.sortIndex=ht,b(J,ut),S(Y)===null&&ut===S(J)&&(se?(Le(At),At=-1):se=!0,cr(rt,ht-be))):(ut.sortIndex=Oe,b(Y,ut),Ae||fe||(Ae=!0,Gr(mt))),ut},P.unstable_shouldYield=It,P.unstable_wrapCallback=function(ut){var zt=$;return function(){var ht=$;$=zt;try{return ut.apply(this,arguments)}finally{$=ht}}}})(Kp)),Kp}var Nf;function og(){return Nf||(Nf=1,Xp.exports=sg()),Xp.exports}var Vf;function ag(){if(Vf)return As;Vf=1;var P=gd(),b=og();function S(n){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+n,d=1;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+n+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var z=new Set,F={};function O(n,o){I(n,o),I(n+"Capture",o)}function I(n,o){for(F[n]=o,n=0;n<o.length;n++)z.add(o[n])}var h=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Y=Object.prototype.hasOwnProperty,J=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,he={},N={};function $(n){return Y.call(N,n)?!0:Y.call(he,n)?!1:J.test(n)?N[n]=!0:(he[n]=!0,!1)}function fe(n,o,d,y){if(d!==null&&d.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return y?!1:d!==null?!d.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Ae(n,o,d,y){if(o===null||typeof o>"u"||fe(n,o,d,y))return!0;if(y)return!1;if(d!==null)switch(d.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function se(n,o,d,y,k,C,Z){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=y,this.attributeNamespace=k,this.mustUseProperty=d,this.propertyName=n,this.type=o,this.sanitizeURL=C,this.removeEmptyString=Z}var De={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){De[n]=new se(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var o=n[0];De[o]=new se(o,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){De[n]=new se(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){De[n]=new se(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){De[n]=new se(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){De[n]=new se(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){De[n]=new se(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){De[n]=new se(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){De[n]=new se(n,5,!1,n.toLowerCase(),null,!1,!1)});var Le=/[\-:]([a-z])/g;function tt(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var o=n.replace(Le,tt);De[o]=new se(o,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var o=n.replace(Le,tt);De[o]=new se(o,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var o=n.replace(Le,tt);De[o]=new se(o,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){De[n]=new se(n,1,!1,n.toLowerCase(),null,!1,!1)}),De.xlinkHref=new se("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){De[n]=new se(n,1,!1,n.toLowerCase(),null,!0,!0)});function Ge(n,o,d,y){var k=De.hasOwnProperty(o)?De[o]:null;(k!==null?k.type!==0:y||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(Ae(o,d,k,y)&&(d=null),y||k===null?$(o)&&(d===null?n.removeAttribute(o):n.setAttribute(o,""+d)):k.mustUseProperty?n[k.propertyName]=d===null?k.type===3?!1:"":d:(o=k.attributeName,y=k.attributeNamespace,d===null?n.removeAttribute(o):(k=k.type,d=k===3||k===4&&d===!0?"":""+d,y?n.setAttributeNS(y,o,d):n.setAttribute(o,d))))}var rt=P.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,mt=Symbol.for("react.element"),pt=Symbol.for("react.portal"),St=Symbol.for("react.fragment"),At=Symbol.for("react.strict_mode"),Zt=Symbol.for("react.profiler"),nr=Symbol.for("react.provider"),It=Symbol.for("react.context"),sr=Symbol.for("react.forward_ref"),Vt=Symbol.for("react.suspense"),or=Symbol.for("react.suspense_list"),Kr=Symbol.for("react.memo"),Gr=Symbol.for("react.lazy"),cr=Symbol.for("react.offscreen"),ut=Symbol.iterator;function zt(n){return n===null||typeof n!="object"?null:(n=ut&&n[ut]||n["@@iterator"],typeof n=="function"?n:null)}var ht=Object.assign,be;function Oe(n){if(be===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);be=o&&o[1]||""}return`
`+be+n}var Gt=!1;function Ht(n,o){if(!n||Gt)return"";Gt=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(Ce){var y=Ce}Reflect.construct(n,[],o)}else{try{o.call()}catch(Ce){y=Ce}n.call(o.prototype)}else{try{throw Error()}catch(Ce){y=Ce}n()}}catch(Ce){if(Ce&&y&&typeof Ce.stack=="string"){for(var k=Ce.stack.split(`
`),C=y.stack.split(`
`),Z=k.length-1,ae=C.length-1;1<=Z&&0<=ae&&k[Z]!==C[ae];)ae--;for(;1<=Z&&0<=ae;Z--,ae--)if(k[Z]!==C[ae]){if(Z!==1||ae!==1)do if(Z--,ae--,0>ae||k[Z]!==C[ae]){var me=`
`+k[Z].replace(" at new "," at ");return n.displayName&&me.includes("<anonymous>")&&(me=me.replace("<anonymous>",n.displayName)),me}while(1<=Z&&0<=ae);break}}}finally{Gt=!1,Error.prepareStackTrace=d}return(n=n?n.displayName||n.name:"")?Oe(n):""}function Jt(n){switch(n.tag){case 5:return Oe(n.type);case 16:return Oe("Lazy");case 13:return Oe("Suspense");case 19:return Oe("SuspenseList");case 0:case 2:case 15:return n=Ht(n.type,!1),n;case 11:return n=Ht(n.type.render,!1),n;case 1:return n=Ht(n.type,!0),n;default:return""}}function ar(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case St:return"Fragment";case pt:return"Portal";case Zt:return"Profiler";case At:return"StrictMode";case Vt:return"Suspense";case or:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case It:return(n.displayName||"Context")+".Consumer";case nr:return(n._context.displayName||"Context")+".Provider";case sr:var o=n.render;return n=n.displayName,n||(n=o.displayName||o.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Kr:return o=n.displayName||null,o!==null?o:ar(n.type)||"Memo";case Gr:o=n._payload,n=n._init;try{return ar(n(o))}catch{}}return null}function ir(n){var o=n.type;switch(n.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=o.render,n=n.displayName||n.name||"",o.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ar(o);case 8:return o===At?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function tr(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Sr(n){var o=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function li(n){var o=Sr(n)?"checked":"value",d=Object.getOwnPropertyDescriptor(n.constructor.prototype,o),y=""+n[o];if(!n.hasOwnProperty(o)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var k=d.get,C=d.set;return Object.defineProperty(n,o,{configurable:!0,get:function(){return k.call(this)},set:function(Z){y=""+Z,C.call(this,Z)}}),Object.defineProperty(n,o,{enumerable:d.enumerable}),{getValue:function(){return y},setValue:function(Z){y=""+Z},stopTracking:function(){n._valueTracker=null,delete n[o]}}}}function oo(n){n._valueTracker||(n._valueTracker=li(n))}function ms(n){if(!n)return!1;var o=n._valueTracker;if(!o)return!0;var d=o.getValue(),y="";return n&&(y=Sr(n)?n.checked?"true":"false":n.value),n=y,n!==d?(o.setValue(n),!0):!1}function Zn(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function gs(n,o){var d=o.checked;return ht({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??n._wrapperState.initialChecked})}function Mo(n,o){var d=o.defaultValue==null?"":o.defaultValue,y=o.checked!=null?o.checked:o.defaultChecked;d=tr(o.value!=null?o.value:d),n._wrapperState={initialChecked:y,initialValue:d,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function Pe(n,o){o=o.checked,o!=null&&Ge(n,"checked",o,!1)}function zs(n,o){Pe(n,o);var d=tr(o.value),y=o.type;if(d!=null)y==="number"?(d===0&&n.value===""||n.value!=d)&&(n.value=""+d):n.value!==""+d&&(n.value=""+d);else if(y==="submit"||y==="reset"){n.removeAttribute("value");return}o.hasOwnProperty("value")?hr(n,o.type,d):o.hasOwnProperty("defaultValue")&&hr(n,o.type,tr(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(n.defaultChecked=!!o.defaultChecked)}function na(n,o,d){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var y=o.type;if(!(y!=="submit"&&y!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+n._wrapperState.initialValue,d||o===n.value||(n.value=o),n.defaultValue=o}d=n.name,d!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,d!==""&&(n.name=d)}function hr(n,o,d){(o!=="number"||Zn(n.ownerDocument)!==n)&&(d==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+d&&(n.defaultValue=""+d))}var Mr=Array.isArray;function ys(n,o,d,y){if(n=n.options,o){o={};for(var k=0;k<d.length;k++)o["$"+d[k]]=!0;for(d=0;d<n.length;d++)k=o.hasOwnProperty("$"+n[d].value),n[d].selected!==k&&(n[d].selected=k),k&&y&&(n[d].defaultSelected=!0)}else{for(d=""+tr(d),o=null,k=0;k<n.length;k++){if(n[k].value===d){n[k].selected=!0,y&&(n[k].defaultSelected=!0);return}o!==null||n[k].disabled||(o=n[k])}o!==null&&(o.selected=!0)}}function _s(n,o){if(o.dangerouslySetInnerHTML!=null)throw Error(S(91));return ht({},o,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function vs(n,o){var d=o.value;if(d==null){if(d=o.children,o=o.defaultValue,d!=null){if(o!=null)throw Error(S(92));if(Mr(d)){if(1<d.length)throw Error(S(93));d=d[0]}o=d}o==null&&(o=""),d=o}n._wrapperState={initialValue:tr(d)}}function Ao(n,o){var d=tr(o.value),y=tr(o.defaultValue);d!=null&&(d=""+d,d!==n.value&&(n.value=d),o.defaultValue==null&&n.defaultValue!==d&&(n.defaultValue=d)),y!=null&&(n.defaultValue=""+y)}function ln(n){var o=n.textContent;o===n._wrapperState.initialValue&&o!==""&&o!==null&&(n.value=o)}function sa(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function zo(n,o){return n==null||n==="http://www.w3.org/1999/xhtml"?sa(o):n==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var $e,Gn=(function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,d,y,k){MSApp.execUnsafeLocalFunction(function(){return n(o,d,y,k)})}:n})(function(n,o){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=o;else{for($e=$e||document.createElement("div"),$e.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=$e.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;o.firstChild;)n.appendChild(o.firstChild)}});function ui(n,o){if(o){var d=n.firstChild;if(d&&d===n.lastChild&&d.nodeType===3){d.nodeValue=o;return}}n.textContent=o}var $i={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ao=["Webkit","ms","Moz","O"];Object.keys($i).forEach(function(n){ao.forEach(function(o){o=o+n.charAt(0).toUpperCase()+n.substring(1),$i[o]=$i[n]})});function Ke(n,o,d){return o==null||typeof o=="boolean"||o===""?"":d||typeof o!="number"||o===0||$i.hasOwnProperty(n)&&$i[n]?(""+o).trim():o+"px"}function Wt(n,o){n=n.style;for(var d in o)if(o.hasOwnProperty(d)){var y=d.indexOf("--")===0,k=Ke(d,o[d],y);d==="float"&&(d="cssFloat"),y?n.setProperty(d,k):n[d]=k}}var Dt=ht({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ii(n,o){if(o){if(Dt[n]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(S(137,n));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(S(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(S(61))}if(o.style!=null&&typeof o.style!="object")throw Error(S(62))}}function un(n,o){if(n.indexOf("-")===-1)return typeof o.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Bt=null;function kn(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Hn=null,cn=null,Li=null;function ne(n){if(n=ul(n)){if(typeof Hn!="function")throw Error(S(280));var o=n.stateNode;o&&(o=cl(o),Hn(n.stateNode,n.type,o))}}function j(n){cn?Li?Li.push(n):Li=[n]:cn=n}function V(){if(cn){var n=cn,o=Li;if(Li=cn=null,ne(n),o)for(n=0;n<o.length;n++)ne(o[n])}}function W(n,o){return n(o)}function te(){}var de=!1;function ye(n,o,d){if(de)return n(o,d);de=!0;try{return W(n,o,d)}finally{de=!1,(cn!==null||Li!==null)&&(te(),V())}}function we(n,o){var d=n.stateNode;if(d===null)return null;var y=cl(d);if(y===null)return null;d=y[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(n=n.type,y=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!y;break e;default:n=!1}if(n)return null;if(d&&typeof d!="function")throw Error(S(231,o,typeof d));return d}var ue=!1;if(h)try{var Me={};Object.defineProperty(Me,"passive",{get:function(){ue=!0}}),window.addEventListener("test",Me,Me),window.removeEventListener("test",Me,Me)}catch{ue=!1}function Be(n,o,d,y,k,C,Z,ae,me){var Ce=Array.prototype.slice.call(arguments,3);try{o.apply(d,Ce)}catch(je){this.onError(je)}}var Ee=!1,He=null,gt=!1,kt=null,dr={onError:function(n){Ee=!0,He=n}};function jt(n,o,d,y,k,C,Z,ae,me){Ee=!1,He=null,Be.apply(dr,arguments)}function pr(n,o,d,y,k,C,Z,ae,me){if(jt.apply(this,arguments),Ee){if(Ee){var Ce=He;Ee=!1,He=null}else throw Error(S(198));gt||(gt=!0,kt=Ce)}}function qt(n){var o=n,d=n;if(n.alternate)for(;o.return;)o=o.return;else{n=o;do o=n,(o.flags&4098)!==0&&(d=o.return),n=o.return;while(n)}return o.tag===3?d:null}function ei(n){if(n.tag===13){var o=n.memoizedState;if(o===null&&(n=n.alternate,n!==null&&(o=n.memoizedState)),o!==null)return o.dehydrated}return null}function jr(n){if(qt(n)!==n)throw Error(S(188))}function Kt(n){var o=n.alternate;if(!o){if(o=qt(n),o===null)throw Error(S(188));return o!==n?null:n}for(var d=n,y=o;;){var k=d.return;if(k===null)break;var C=k.alternate;if(C===null){if(y=k.return,y!==null){d=y;continue}break}if(k.child===C.child){for(C=k.child;C;){if(C===d)return jr(k),n;if(C===y)return jr(k),o;C=C.sibling}throw Error(S(188))}if(d.return!==y.return)d=k,y=C;else{for(var Z=!1,ae=k.child;ae;){if(ae===d){Z=!0,d=k,y=C;break}if(ae===y){Z=!0,y=k,d=C;break}ae=ae.sibling}if(!Z){for(ae=C.child;ae;){if(ae===d){Z=!0,d=C,y=k;break}if(ae===y){Z=!0,y=C,d=k;break}ae=ae.sibling}if(!Z)throw Error(S(189))}}if(d.alternate!==y)throw Error(S(190))}if(d.tag!==3)throw Error(S(188));return d.stateNode.current===d?n:o}function vr(n){return n=Kt(n),n!==null?Rr(n):null}function Rr(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var o=Rr(n);if(o!==null)return o;n=n.sibling}return null}var ci=b.unstable_scheduleCallback,gi=b.unstable_cancelCallback,Ri=b.unstable_shouldYield,oa=b.unstable_requestPaint,Ot=b.unstable_now,gu=b.unstable_getCurrentPriorityLevel,Za=b.unstable_ImmediatePriority,qi=b.unstable_UserBlockingPriority,Pi=b.unstable_NormalPriority,bh=b.unstable_LowPriority,hn=b.unstable_IdlePriority,Ci=null,Fi=null;function Do(n){if(Fi&&typeof Fi.onCommitFiberRoot=="function")try{Fi.onCommitFiberRoot(Ci,n,void 0,(n.current.flags&128)===128)}catch{}}var kr=Math.clz32?Math.clz32:ti,Ga=Math.log,Wn=Math.LN2;function ti(n){return n>>>=0,n===0?32:31-(Ga(n)/Wn|0)|0}var Lo=64,Zi=4194304;function Ro(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Gi(n,o){var d=n.pendingLanes;if(d===0)return 0;var y=0,k=n.suspendedLanes,C=n.pingedLanes,Z=d&268435455;if(Z!==0){var ae=Z&~k;ae!==0?y=Ro(ae):(C&=Z,C!==0&&(y=Ro(C)))}else Z=d&~k,Z!==0?y=Ro(Z):C!==0&&(y=Ro(C));if(y===0)return 0;if(o!==0&&o!==y&&(o&k)===0&&(k=y&-y,C=o&-o,k>=C||k===16&&(C&4194240)!==0))return o;if((y&4)!==0&&(y|=d&16),o=n.entangledLanes,o!==0)for(n=n.entanglements,o&=y;0<o;)d=31-kr(o),k=1<<d,y|=n[d],o&=~k;return y}function Sh(n,o){switch(n){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Pl(n,o){for(var d=n.suspendedLanes,y=n.pingedLanes,k=n.expirationTimes,C=n.pendingLanes;0<C;){var Z=31-kr(C),ae=1<<Z,me=k[Z];me===-1?((ae&d)===0||(ae&y)!==0)&&(k[Z]=Sh(ae,o)):me<=o&&(n.expiredLanes|=ae),C&=~ae}}function Ds(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Ls(){var n=Lo;return Lo<<=1,(Lo&4194240)===0&&(Lo=64),n}function fr(n){for(var o=[],d=0;31>d;d++)o.push(n);return o}function Fo(n,o,d){n.pendingLanes|=o,o!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,o=31-kr(o),n[o]=d}function yu(n,o){var d=n.pendingLanes&~o;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=o,n.mutableReadLanes&=o,n.entangledLanes&=o,o=n.entanglements;var y=n.eventTimes;for(n=n.expirationTimes;0<d;){var k=31-kr(d),C=1<<k;o[k]=0,y[k]=-1,n[k]=-1,d&=~C}}function lo(n,o){var d=n.entangledLanes|=o;for(n=n.entanglements;d;){var y=31-kr(d),k=1<<y;k&o|n[y]&o&&(n[y]|=o),d&=~k}}var xr=0;function Ha(n){return n&=-n,1<n?4<n?(n&268435455)!==0?16:536870912:4:1}var aa,la,Bo,_u,xc,Cl=!1,Ml=[],Hi=null,Tn=null,ri=null,yi=new Map,uo=new Map,Xn=[],Al="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function vu(n,o){switch(n){case"focusin":case"focusout":Hi=null;break;case"dragenter":case"dragleave":Tn=null;break;case"mouseover":case"mouseout":ri=null;break;case"pointerover":case"pointerout":yi.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":uo.delete(o.pointerId)}}function xs(n,o,d,y,k,C){return n===null||n.nativeEvent!==C?(n={blockedOn:o,domEventName:d,eventSystemFlags:y,nativeEvent:C,targetContainers:[k]},o!==null&&(o=ul(o),o!==null&&la(o)),n):(n.eventSystemFlags|=y,o=n.targetContainers,k!==null&&o.indexOf(k)===-1&&o.push(k),n)}function kh(n,o,d,y,k){switch(o){case"focusin":return Hi=xs(Hi,n,o,d,y,k),!0;case"dragenter":return Tn=xs(Tn,n,o,d,y,k),!0;case"mouseover":return ri=xs(ri,n,o,d,y,k),!0;case"pointerover":var C=k.pointerId;return yi.set(C,xs(yi.get(C)||null,n,o,d,y,k)),!0;case"gotpointercapture":return C=k.pointerId,uo.set(C,xs(uo.get(C)||null,n,o,d,y,k)),!0}return!1}function xu(n){var o=Gs(n.target);if(o!==null){var d=qt(o);if(d!==null){if(o=d.tag,o===13){if(o=ei(d),o!==null){n.blockedOn=o,xc(n.priority,function(){Bo(d)});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){n.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Wa(n){if(n.blockedOn!==null)return!1;for(var o=n.targetContainers;0<o.length;){var d=Xa(n.domEventName,n.eventSystemFlags,o[0],n.nativeEvent);if(d===null){d=n.nativeEvent;var y=new d.constructor(d.type,d);Bt=y,d.target.dispatchEvent(y),Bt=null}else return o=ul(d),o!==null&&la(o),n.blockedOn=d,!1;o.shift()}return!0}function wc(n,o,d){Wa(n)&&d.delete(o)}function Th(){Cl=!1,Hi!==null&&Wa(Hi)&&(Hi=null),Tn!==null&&Wa(Tn)&&(Tn=null),ri!==null&&Wa(ri)&&(ri=null),yi.forEach(wc),uo.forEach(wc)}function ua(n,o){n.blockedOn===o&&(n.blockedOn=null,Cl||(Cl=!0,b.unstable_scheduleCallback(b.unstable_NormalPriority,Th)))}function Rs(n){function o(k){return ua(k,n)}if(0<Ml.length){ua(Ml[0],n);for(var d=1;d<Ml.length;d++){var y=Ml[d];y.blockedOn===n&&(y.blockedOn=null)}}for(Hi!==null&&ua(Hi,n),Tn!==null&&ua(Tn,n),ri!==null&&ua(ri,n),yi.forEach(o),uo.forEach(o),d=0;d<Xn.length;d++)y=Xn[d],y.blockedOn===n&&(y.blockedOn=null);for(;0<Xn.length&&(d=Xn[0],d.blockedOn===null);)xu(d),d.blockedOn===null&&Xn.shift()}var co=rt.ReactCurrentBatchConfig,Oo=!0;function wu(n,o,d,y){var k=xr,C=co.transition;co.transition=null;try{xr=1,En(n,o,d,y)}finally{xr=k,co.transition=C}}function bu(n,o,d,y){var k=xr,C=co.transition;co.transition=null;try{xr=4,En(n,o,d,y)}finally{xr=k,co.transition=C}}function En(n,o,d,y){if(Oo){var k=Xa(n,o,d,y);if(k===null)ll(n,o,y,zl,d),vu(n,y);else if(kh(k,n,o,d,y))y.stopPropagation();else if(vu(n,y),o&4&&-1<Al.indexOf(n)){for(;k!==null;){var C=ul(k);if(C!==null&&aa(C),C=Xa(n,o,d,y),C===null&&ll(n,o,y,zl,d),C===k)break;k=C}k!==null&&y.stopPropagation()}else ll(n,o,y,null,d)}}var zl=null;function Xa(n,o,d,y){if(zl=null,n=kn(y),n=Gs(n),n!==null)if(o=qt(n),o===null)n=null;else if(d=o.tag,d===13){if(n=ei(o),n!==null)return n;n=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null);return zl=n,null}function ho(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(gu()){case Za:return 1;case qi:return 4;case Pi:case bh:return 16;case hn:return 536870912;default:return 16}default:return 16}}var Bi=null,mr=null,No=null;function bc(){if(No)return No;var n,o=mr,d=o.length,y,k="value"in Bi?Bi.value:Bi.textContent,C=k.length;for(n=0;n<d&&o[n]===k[n];n++);var Z=d-n;for(y=1;y<=Z&&o[d-y]===k[C-y];y++);return No=k.slice(n,1<y?1-y:void 0)}function Fs(n){var o=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&o===13&&(n=13)):n=o,n===10&&(n=13),32<=n||n===13?n:0}function Dl(){return!0}function Su(){return!1}function dn(n){function o(d,y,k,C,Z){this._reactName=d,this._targetInst=k,this.type=y,this.nativeEvent=C,this.target=Z,this.currentTarget=null;for(var ae in n)n.hasOwnProperty(ae)&&(d=n[ae],this[ae]=d?d(C):C[ae]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?Dl:Su,this.isPropagationStopped=Su,this}return ht(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Dl)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Dl)},persist:function(){},isPersistent:Dl}),o}var Vo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ka=dn(Vo),ca=ht({},Vo,{view:0,detail:0}),Sc=dn(ca),Ll,Rl,Kn,Ya=ht({},ca,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Qa,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Kn&&(Kn&&n.type==="mousemove"?(Ll=n.screenX-Kn.screenX,Rl=n.screenY-Kn.screenY):Rl=Ll=0,Kn=n),Ll)},movementY:function(n){return"movementY"in n?n.movementY:Rl}}),kc=dn(Ya),Tc=ht({},Ya,{dataTransfer:0}),Ja=dn(Tc),Eh=ht({},ca,{relatedTarget:0}),ha=dn(Eh),Ih=ht({},Vo,{animationName:0,elapsedTime:0,pseudoElement:0}),Ph=dn(Ih),Ec=ht({},Vo,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Ic=dn(Ec),Pc=ht({},Vo,{data:0}),Fl=dn(Pc),Cc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Bs={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ku(n){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(n):(n=Bs[n])?!!o[n]:!1}function Qa(){return ku}var Tu=ht({},ca,{key:function(n){if(n.key){var o=Cc[n.key]||n.key;if(o!=="Unidentified")return o}return n.type==="keypress"?(n=Fs(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Bl[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Qa,charCode:function(n){return n.type==="keypress"?Fs(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Fs(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Ol=dn(Tu),Eu=ht({},Ya,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),po=dn(Eu),Iu=ht({},ca,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Qa}),Ch=dn(Iu),Yr=ht({},Vo,{propertyName:0,elapsedTime:0,pseudoElement:0}),Mh=dn(Yr),Qt=ht({},Ya,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Nl=dn(Qt),Ar=[9,13,27,32],wr=h&&"CompositionEvent"in window,Yn=null;h&&"documentMode"in document&&(Yn=document.documentMode);var el=h&&"TextEvent"in window&&!Yn,da=h&&(!wr||Yn&&8<Yn&&11>=Yn),Vl=" ",fo=!1;function jo(n,o){switch(n){case"keyup":return Ar.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pn(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var mo=!1;function Pu(n,o){switch(n){case"compositionend":return pn(o);case"keypress":return o.which!==32?null:(fo=!0,Vl);case"textInput":return n=o.data,n===Vl&&fo?null:n;default:return null}}function Cu(n,o){if(mo)return n==="compositionend"||!wr&&jo(n,o)?(n=bc(),No=mr=Bi=null,mo=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return da&&o.locale!=="ko"?null:o.data;default:return null}}var Uo={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pa(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o==="input"?!!Uo[n.type]:o==="textarea"}function fa(n,o,d,y){j(y),o=xa(o,"onChange"),0<o.length&&(d=new Ka("onChange","change",null,d,y),n.push({event:d,listeners:o}))}var ws=null,Os=null;function jl(n){Gl(n,0)}function Ns(n){var o=ts(n);if(ms(o))return n}function ma(n,o){if(n==="change")return o}var Mu=!1;if(h){var tl;if(h){var lr="oninput"in document;if(!lr){var rl=document.createElement("div");rl.setAttribute("oninput","return;"),lr=typeof rl.oninput=="function"}tl=lr}else tl=!1;Mu=tl&&(!document.documentMode||9<document.documentMode)}function Mc(){ws&&(ws.detachEvent("onpropertychange",Au),Os=ws=null)}function Au(n){if(n.propertyName==="value"&&Ns(Os)){var o=[];fa(o,Os,n,kn(n)),ye(jl,o)}}function ga(n,o,d){n==="focusin"?(Mc(),ws=o,Os=d,ws.attachEvent("onpropertychange",Au)):n==="focusout"&&Mc()}function Ac(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Ns(Os)}function Ul(n,o){if(n==="click")return Ns(o)}function zc(n,o){if(n==="input"||n==="change")return Ns(o)}function Dc(n,o){return n===o&&(n!==0||1/n===1/o)||n!==n&&o!==o}var Wi=typeof Object.is=="function"?Object.is:Dc;function go(n,o){if(Wi(n,o))return!0;if(typeof n!="object"||n===null||typeof o!="object"||o===null)return!1;var d=Object.keys(n),y=Object.keys(o);if(d.length!==y.length)return!1;for(y=0;y<d.length;y++){var k=d[y];if(!Y.call(o,k)||!Wi(n[k],o[k]))return!1}return!0}function $o(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function qo(n,o){var d=$o(n);n=0;for(var y;d;){if(d.nodeType===3){if(y=n+d.textContent.length,n<=o&&y>=o)return{node:d,offset:o-n};n=y}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=$o(d)}}function Zo(n,o){return n&&o?n===o?!0:n&&n.nodeType===3?!1:o&&o.nodeType===3?Zo(n,o.parentNode):"contains"in n?n.contains(o):n.compareDocumentPosition?!!(n.compareDocumentPosition(o)&16):!1:!1}function $l(){for(var n=window,o=Zn();o instanceof n.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)n=o.contentWindow;else break;o=Zn(n.document)}return o}function yo(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o&&(o==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||o==="textarea"||n.contentEditable==="true")}function il(n){var o=$l(),d=n.focusedElem,y=n.selectionRange;if(o!==d&&d&&d.ownerDocument&&Zo(d.ownerDocument.documentElement,d)){if(y!==null&&yo(d)){if(o=y.start,n=y.end,n===void 0&&(n=o),"selectionStart"in d)d.selectionStart=o,d.selectionEnd=Math.min(n,d.value.length);else if(n=(o=d.ownerDocument||document)&&o.defaultView||window,n.getSelection){n=n.getSelection();var k=d.textContent.length,C=Math.min(y.start,k);y=y.end===void 0?C:Math.min(y.end,k),!n.extend&&C>y&&(k=y,y=C,C=k),k=qo(d,C);var Z=qo(d,y);k&&Z&&(n.rangeCount!==1||n.anchorNode!==k.node||n.anchorOffset!==k.offset||n.focusNode!==Z.node||n.focusOffset!==Z.offset)&&(o=o.createRange(),o.setStart(k.node,k.offset),n.removeAllRanges(),C>y?(n.addRange(o),n.extend(Z.node,Z.offset)):(o.setEnd(Z.node,Z.offset),n.addRange(o)))}}for(o=[],n=d;n=n.parentNode;)n.nodeType===1&&o.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<o.length;d++)n=o[d],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var ql=h&&"documentMode"in document&&11>=document.documentMode,Vs=null,nl=null,sl=null,Zl=!1;function ol(n,o,d){var y=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Zl||Vs==null||Vs!==Zn(y)||(y=Vs,"selectionStart"in y&&yo(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),sl&&go(sl,y)||(sl=y,y=xa(nl,"onSelect"),0<y.length&&(o=new Ka("onSelect","select",null,o,d),n.push({event:o,listeners:y}),o.target=Vs)))}function ya(n,o){var d={};return d[n.toLowerCase()]=o.toLowerCase(),d["Webkit"+n]="webkit"+o,d["Moz"+n]="moz"+o,d}var bs={animationend:ya("Animation","AnimationEnd"),animationiteration:ya("Animation","AnimationIteration"),animationstart:ya("Animation","AnimationStart"),transitionend:ya("Transition","TransitionEnd")},Go={},wi={};h&&(wi=document.createElement("div").style,"AnimationEvent"in window||(delete bs.animationend.animation,delete bs.animationiteration.animation,delete bs.animationstart.animation),"TransitionEvent"in window||delete bs.transitionend.transition);function Ss(n){if(Go[n])return Go[n];if(!bs[n])return n;var o=bs[n],d;for(d in o)if(o.hasOwnProperty(d)&&d in wi)return Go[n]=o[d];return n}var zu=Ss("animationend"),Du=Ss("animationiteration"),Hr=Ss("animationstart"),In=Ss("transitionend"),Xi=new Map,_a="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ks(n,o){Xi.set(n,o),O(o,[n])}for(var va=0;va<_a.length;va++){var _o=_a[va],js=_o.toLowerCase(),Lu=_o[0].toUpperCase()+_o.slice(1);ks(js,"on"+Lu)}ks(zu,"onAnimationEnd"),ks(Du,"onAnimationIteration"),ks(Hr,"onAnimationStart"),ks("dblclick","onDoubleClick"),ks("focusin","onFocus"),ks("focusout","onBlur"),ks(In,"onTransitionEnd"),I("onMouseEnter",["mouseout","mouseover"]),I("onMouseLeave",["mouseout","mouseover"]),I("onPointerEnter",["pointerout","pointerover"]),I("onPointerLeave",["pointerout","pointerover"]),O("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),O("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),O("onBeforeInput",["compositionend","keypress","textInput","paste"]),O("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),O("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),O("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var vo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ru=new Set("cancel close invalid load scroll toggle".split(" ").concat(vo));function al(n,o,d){var y=n.type||"unknown-event";n.currentTarget=d,pr(y,o,void 0,n),n.currentTarget=null}function Gl(n,o){o=(o&4)!==0;for(var d=0;d<n.length;d++){var y=n[d],k=y.event;y=y.listeners;e:{var C=void 0;if(o)for(var Z=y.length-1;0<=Z;Z--){var ae=y[Z],me=ae.instance,Ce=ae.currentTarget;if(ae=ae.listener,me!==C&&k.isPropagationStopped())break e;al(k,ae,Ce),C=me}else for(Z=0;Z<y.length;Z++){if(ae=y[Z],me=ae.instance,Ce=ae.currentTarget,ae=ae.listener,me!==C&&k.isPropagationStopped())break e;al(k,ae,Ce),C=me}}}if(gt)throw n=kt,gt=!1,kt=null,n}function zr(n,o){var d=o[er];d===void 0&&(d=o[er]=new Set);var y=n+"__bubble";d.has(y)||(Hl(o,n,2,!1),d.add(y))}function Us(n,o,d){var y=0;o&&(y|=4),Hl(d,n,y,o)}var Ho="_reactListening"+Math.random().toString(36).slice(2);function $s(n){if(!n[Ho]){n[Ho]=!0,z.forEach(function(d){d!=="selectionchange"&&(Ru.has(d)||Us(d,!1,n),Us(d,!0,n))});var o=n.nodeType===9?n:n.ownerDocument;o===null||o[Ho]||(o[Ho]=!0,Us("selectionchange",!1,o))}}function Hl(n,o,d,y){switch(ho(o)){case 1:var k=wu;break;case 4:k=bu;break;default:k=En}d=k.bind(null,o,d,n),k=void 0,!ue||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(k=!0),y?k!==void 0?n.addEventListener(o,d,{capture:!0,passive:k}):n.addEventListener(o,d,!0):k!==void 0?n.addEventListener(o,d,{passive:k}):n.addEventListener(o,d,!1)}function ll(n,o,d,y,k){var C=y;if((o&1)===0&&(o&2)===0&&y!==null)e:for(;;){if(y===null)return;var Z=y.tag;if(Z===3||Z===4){var ae=y.stateNode.containerInfo;if(ae===k||ae.nodeType===8&&ae.parentNode===k)break;if(Z===4)for(Z=y.return;Z!==null;){var me=Z.tag;if((me===3||me===4)&&(me=Z.stateNode.containerInfo,me===k||me.nodeType===8&&me.parentNode===k))return;Z=Z.return}for(;ae!==null;){if(Z=Gs(ae),Z===null)return;if(me=Z.tag,me===5||me===6){y=C=Z;continue e}ae=ae.parentNode}}y=y.return}ye(function(){var Ce=C,je=kn(d),qe=[];e:{var Ve=Xi.get(n);if(Ve!==void 0){var nt=Ka,yt=n;switch(n){case"keypress":if(Fs(d)===0)break e;case"keydown":case"keyup":nt=Ol;break;case"focusin":yt="focus",nt=ha;break;case"focusout":yt="blur",nt=ha;break;case"beforeblur":case"afterblur":nt=ha;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":nt=kc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":nt=Ja;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":nt=Ch;break;case zu:case Du:case Hr:nt=Ph;break;case In:nt=Mh;break;case"scroll":nt=Sc;break;case"wheel":nt=Nl;break;case"copy":case"cut":case"paste":nt=Ic;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":nt=po}var Tt=(o&4)!==0,oi=!Tt&&n==="scroll",Te=Tt?Ve!==null?Ve+"Capture":null:Ve;Tt=[];for(var _e=Ce,Ie;_e!==null;){Ie=_e;var Je=Ie.stateNode;if(Ie.tag===5&&Je!==null&&(Ie=Je,Te!==null&&(Je=we(_e,Te),Je!=null&&Tt.push(Wo(_e,Je,Ie)))),oi)break;_e=_e.return}0<Tt.length&&(Ve=new nt(Ve,yt,null,d,je),qe.push({event:Ve,listeners:Tt}))}}if((o&7)===0){e:{if(Ve=n==="mouseover"||n==="pointerover",nt=n==="mouseout"||n==="pointerout",Ve&&d!==Bt&&(yt=d.relatedTarget||d.fromElement)&&(Gs(yt)||yt[es]))break e;if((nt||Ve)&&(Ve=je.window===je?je:(Ve=je.ownerDocument)?Ve.defaultView||Ve.parentWindow:window,nt?(yt=d.relatedTarget||d.toElement,nt=Ce,yt=yt?Gs(yt):null,yt!==null&&(oi=qt(yt),yt!==oi||yt.tag!==5&&yt.tag!==6)&&(yt=null)):(nt=null,yt=Ce),nt!==yt)){if(Tt=kc,Je="onMouseLeave",Te="onMouseEnter",_e="mouse",(n==="pointerout"||n==="pointerover")&&(Tt=po,Je="onPointerLeave",Te="onPointerEnter",_e="pointer"),oi=nt==null?Ve:ts(nt),Ie=yt==null?Ve:ts(yt),Ve=new Tt(Je,_e+"leave",nt,d,je),Ve.target=oi,Ve.relatedTarget=Ie,Je=null,Gs(je)===Ce&&(Tt=new Tt(Te,_e+"enter",yt,d,je),Tt.target=Ie,Tt.relatedTarget=oi,Je=Tt),oi=Je,nt&&yt)t:{for(Tt=nt,Te=yt,_e=0,Ie=Tt;Ie;Ie=qs(Ie))_e++;for(Ie=0,Je=Te;Je;Je=qs(Je))Ie++;for(;0<_e-Ie;)Tt=qs(Tt),_e--;for(;0<Ie-_e;)Te=qs(Te),Ie--;for(;_e--;){if(Tt===Te||Te!==null&&Tt===Te.alternate)break t;Tt=qs(Tt),Te=qs(Te)}Tt=null}else Tt=null;nt!==null&&wa(qe,Ve,nt,Tt,!1),yt!==null&&oi!==null&&wa(qe,oi,yt,Tt,!0)}}e:{if(Ve=Ce?ts(Ce):window,nt=Ve.nodeName&&Ve.nodeName.toLowerCase(),nt==="select"||nt==="input"&&Ve.type==="file")var Pt=ma;else if(pa(Ve))if(Mu)Pt=zc;else{Pt=Ac;var Ft=ga}else(nt=Ve.nodeName)&&nt.toLowerCase()==="input"&&(Ve.type==="checkbox"||Ve.type==="radio")&&(Pt=Ul);if(Pt&&(Pt=Pt(n,Ce))){fa(qe,Pt,d,je);break e}Ft&&Ft(n,Ve,Ce),n==="focusout"&&(Ft=Ve._wrapperState)&&Ft.controlled&&Ve.type==="number"&&hr(Ve,"number",Ve.value)}switch(Ft=Ce?ts(Ce):window,n){case"focusin":(pa(Ft)||Ft.contentEditable==="true")&&(Vs=Ft,nl=Ce,sl=null);break;case"focusout":sl=nl=Vs=null;break;case"mousedown":Zl=!0;break;case"contextmenu":case"mouseup":case"dragend":Zl=!1,ol(qe,d,je);break;case"selectionchange":if(ql)break;case"keydown":case"keyup":ol(qe,d,je)}var Ct;if(wr)e:{switch(n){case"compositionstart":var $t="onCompositionStart";break e;case"compositionend":$t="onCompositionEnd";break e;case"compositionupdate":$t="onCompositionUpdate";break e}$t=void 0}else mo?jo(n,d)&&($t="onCompositionEnd"):n==="keydown"&&d.keyCode===229&&($t="onCompositionStart");$t&&(da&&d.locale!=="ko"&&(mo||$t!=="onCompositionStart"?$t==="onCompositionEnd"&&mo&&(Ct=bc()):(Bi=je,mr="value"in Bi?Bi.value:Bi.textContent,mo=!0)),Ft=xa(Ce,$t),0<Ft.length&&($t=new Fl($t,n,null,d,je),qe.push({event:$t,listeners:Ft}),Ct?$t.data=Ct:(Ct=pn(d),Ct!==null&&($t.data=Ct)))),(Ct=el?Pu(n,d):Cu(n,d))&&(Ce=xa(Ce,"onBeforeInput"),0<Ce.length&&(je=new Fl("onBeforeInput","beforeinput",null,d,je),qe.push({event:je,listeners:Ce}),je.data=Ct))}Gl(qe,o)})}function Wo(n,o,d){return{instance:n,listener:o,currentTarget:d}}function xa(n,o){for(var d=o+"Capture",y=[];n!==null;){var k=n,C=k.stateNode;k.tag===5&&C!==null&&(k=C,C=we(n,d),C!=null&&y.unshift(Wo(n,C,k)),C=we(n,o),C!=null&&y.push(Wo(n,C,k))),n=n.return}return y}function qs(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function wa(n,o,d,y,k){for(var C=o._reactName,Z=[];d!==null&&d!==y;){var ae=d,me=ae.alternate,Ce=ae.stateNode;if(me!==null&&me===y)break;ae.tag===5&&Ce!==null&&(ae=Ce,k?(me=we(d,C),me!=null&&Z.unshift(Wo(d,me,ae))):k||(me=we(d,C),me!=null&&Z.push(Wo(d,me,ae)))),d=d.return}Z.length!==0&&n.push({event:o,listeners:Z})}var Lc=/\r\n?/g,Pn=/\u0000|\uFFFD/g;function Jn(n){return(typeof n=="string"?n:""+n).replace(Lc,`
`).replace(Pn,"")}function ba(n,o,d){if(o=Jn(o),Jn(n)!==o&&d)throw Error(S(425))}function Ki(){}var Zs=null,Fu=null;function Bu(n,o){return n==="textarea"||n==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Wl=typeof setTimeout=="function"?setTimeout:void 0,Rc=typeof clearTimeout=="function"?clearTimeout:void 0,Xl=typeof Promise=="function"?Promise:void 0,Sa=typeof queueMicrotask=="function"?queueMicrotask:typeof Xl<"u"?function(n){return Xl.resolve(null).then(n).catch(Cn)}:Wl;function Cn(n){setTimeout(function(){throw n})}function at(n,o){var d=o,y=0;do{var k=d.nextSibling;if(n.removeChild(d),k&&k.nodeType===8)if(d=k.data,d==="/$"){if(y===0){n.removeChild(k),Rs(o);return}y--}else d!=="$"&&d!=="$?"&&d!=="$!"||y++;d=k}while(d);Rs(o)}function Qn(n){for(;n!=null;n=n.nextSibling){var o=n.nodeType;if(o===1||o===3)break;if(o===8){if(o=n.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return n}function Kl(n){n=n.previousSibling;for(var o=0;n;){if(n.nodeType===8){var d=n.data;if(d==="$"||d==="$!"||d==="$?"){if(o===0)return n;o--}else d==="/$"&&o++}n=n.previousSibling}return null}var Xo=Math.random().toString(36).slice(2),Oi="__reactFiber$"+Xo,Ts="__reactProps$"+Xo,es="__reactContainer$"+Xo,er="__reactEvents$"+Xo,Ou="__reactListeners$"+Xo,Ah="__reactHandles$"+Xo;function Gs(n){var o=n[Oi];if(o)return o;for(var d=n.parentNode;d;){if(o=d[es]||d[Oi]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(n=Kl(n);n!==null;){if(d=n[Oi])return d;n=Kl(n)}return o}n=d,d=n.parentNode}return null}function ul(n){return n=n[Oi]||n[es],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function ts(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(S(33))}function cl(n){return n[Ts]||null}var hl=[],Ko=-1;function xo(n){return{current:n}}function Dr(n){0>Ko||(n.current=hl[Ko],hl[Ko]=null,Ko--)}function Fr(n,o){Ko++,hl[Ko]=n.current,n.current=o}var wo={},Er=xo(wo),rr=xo(!1),Mn=wo;function Hs(n,o){var d=n.type.contextTypes;if(!d)return wo;var y=n.stateNode;if(y&&y.__reactInternalMemoizedUnmaskedChildContext===o)return y.__reactInternalMemoizedMaskedChildContext;var k={},C;for(C in d)k[C]=o[C];return y&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=o,n.__reactInternalMemoizedMaskedChildContext=k),k}function bi(n){return n=n.childContextTypes,n!=null}function dl(){Dr(rr),Dr(Er)}function ka(n,o,d){if(Er.current!==wo)throw Error(S(168));Fr(Er,o),Fr(rr,d)}function Ta(n,o,d){var y=n.stateNode;if(o=o.childContextTypes,typeof y.getChildContext!="function")return d;y=y.getChildContext();for(var k in y)if(!(k in o))throw Error(S(108,ir(n)||"Unknown",k));return ht({},d,y)}function fn(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||wo,Mn=Er.current,Fr(Er,n),Fr(rr,rr.current),!0}function Ea(n,o,d){var y=n.stateNode;if(!y)throw Error(S(169));d?(n=Ta(n,o,Mn),y.__reactInternalMemoizedMergedChildContext=n,Dr(rr),Dr(Er),Fr(Er,n)):Dr(rr),Fr(rr,d)}var lt=null,Et=!1,Ia=!1;function pl(n){lt===null?lt=[n]:lt.push(n)}function Nu(n){Et=!0,pl(n)}function f(){if(!Ia&&lt!==null){Ia=!0;var n=0,o=xr;try{var d=lt;for(xr=1;n<d.length;n++){var y=d[n];do y=y(!0);while(y!==null)}lt=null,Et=!1}catch(k){throw lt!==null&&(lt=lt.slice(n+1)),ci(Za,f),k}finally{xr=o,Ia=!1}}return null}var e=[],s=0,l=null,u=0,p=[],v=0,w=null,T=1,M="";function L(n,o){e[s++]=u,e[s++]=l,l=n,u=o}function R(n,o,d){p[v++]=T,p[v++]=M,p[v++]=w,w=n;var y=T;n=M;var k=32-kr(y)-1;y&=~(1<<k),d+=1;var C=32-kr(o)+k;if(30<C){var Z=k-k%5;C=(y&(1<<Z)-1).toString(32),y>>=Z,k-=Z,T=1<<32-kr(o)+k|d<<k|y,M=C+n}else T=1<<C|d<<k|y,M=n}function q(n){n.return!==null&&(L(n,1),R(n,1,0))}function H(n){for(;n===l;)l=e[--s],e[s]=null,u=e[--s],e[s]=null;for(;n===w;)w=p[--v],p[v]=null,M=p[--v],p[v]=null,T=p[--v],p[v]=null}var K=null,Q=null,re=!1,oe=null;function ce(n,o){var d=Bn(5,null,null,0);d.elementType="DELETED",d.stateNode=o,d.return=n,o=n.deletions,o===null?(n.deletions=[d],n.flags|=16):o.push(d)}function ee(n,o){switch(n.tag){case 5:var d=n.type;return o=o.nodeType!==1||d.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(n.stateNode=o,K=n,Q=Qn(o.firstChild),!0):!1;case 6:return o=n.pendingProps===""||o.nodeType!==3?null:o,o!==null?(n.stateNode=o,K=n,Q=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(d=w!==null?{id:T,overflow:M}:null,n.memoizedState={dehydrated:o,treeContext:d,retryLane:1073741824},d=Bn(18,null,null,0),d.stateNode=o,d.return=n,n.child=d,K=n,Q=null,!0):!1;default:return!1}}function ge(n){return(n.mode&1)!==0&&(n.flags&128)===0}function ve(n){if(re){var o=Q;if(o){var d=o;if(!ee(n,o)){if(ge(n))throw Error(S(418));o=Qn(d.nextSibling);var y=K;o&&ee(n,o)?ce(y,d):(n.flags=n.flags&-4097|2,re=!1,K=n)}}else{if(ge(n))throw Error(S(418));n.flags=n.flags&-4097|2,re=!1,K=n}}}function ke(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;K=n}function Fe(n){if(n!==K)return!1;if(!re)return ke(n),re=!0,!1;var o;if((o=n.tag!==3)&&!(o=n.tag!==5)&&(o=n.type,o=o!=="head"&&o!=="body"&&!Bu(n.type,n.memoizedProps)),o&&(o=Q)){if(ge(n))throw Ue(),Error(S(418));for(;o;)ce(n,o),o=Qn(o.nextSibling)}if(ke(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(S(317));e:{for(n=n.nextSibling,o=0;n;){if(n.nodeType===8){var d=n.data;if(d==="/$"){if(o===0){Q=Qn(n.nextSibling);break e}o--}else d!=="$"&&d!=="$!"&&d!=="$?"||o++}n=n.nextSibling}Q=null}}else Q=K?Qn(n.stateNode.nextSibling):null;return!0}function Ue(){for(var n=Q;n;)n=Qn(n.nextSibling)}function We(){Q=K=null,re=!1}function it(n){oe===null?oe=[n]:oe.push(n)}var Xe=rt.ReactCurrentBatchConfig;function Ze(n,o,d){if(n=d.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(S(309));var y=d.stateNode}if(!y)throw Error(S(147,n));var k=y,C=""+n;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===C?o.ref:(o=function(Z){var ae=k.refs;Z===null?delete ae[C]:ae[C]=Z},o._stringRef=C,o)}if(typeof n!="string")throw Error(S(284));if(!d._owner)throw Error(S(290,n))}return n}function dt(n,o){throw n=Object.prototype.toString.call(o),Error(S(31,n==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":n))}function Rt(n){var o=n._init;return o(n._payload)}function Ye(n){function o(Te,_e){if(n){var Ie=Te.deletions;Ie===null?(Te.deletions=[_e],Te.flags|=16):Ie.push(_e)}}function d(Te,_e){if(!n)return null;for(;_e!==null;)o(Te,_e),_e=_e.sibling;return null}function y(Te,_e){for(Te=new Map;_e!==null;)_e.key!==null?Te.set(_e.key,_e):Te.set(_e.index,_e),_e=_e.sibling;return Te}function k(Te,_e){return Te=Na(Te,_e),Te.index=0,Te.sibling=null,Te}function C(Te,_e,Ie){return Te.index=Ie,n?(Ie=Te.alternate,Ie!==null?(Ie=Ie.index,Ie<_e?(Te.flags|=2,_e):Ie):(Te.flags|=2,_e)):(Te.flags|=1048576,_e)}function Z(Te){return n&&Te.alternate===null&&(Te.flags|=2),Te}function ae(Te,_e,Ie,Je){return _e===null||_e.tag!==6?(_e=Cs(Ie,Te.mode,Je),_e.return=Te,_e):(_e=k(_e,Ie),_e.return=Te,_e)}function me(Te,_e,Ie,Je){var Pt=Ie.type;return Pt===St?je(Te,_e,Ie.props.children,Je,Ie.key):_e!==null&&(_e.elementType===Pt||typeof Pt=="object"&&Pt!==null&&Pt.$$typeof===Gr&&Rt(Pt)===_e.type)?(Je=k(_e,Ie.props),Je.ref=Ze(Te,_e,Ie),Je.return=Te,Je):(Je=pc(Ie.type,Ie.key,Ie.props,null,Te.mode,Je),Je.ref=Ze(Te,_e,Ie),Je.return=Te,Je)}function Ce(Te,_e,Ie,Je){return _e===null||_e.tag!==4||_e.stateNode.containerInfo!==Ie.containerInfo||_e.stateNode.implementation!==Ie.implementation?(_e=Eo(Ie,Te.mode,Je),_e.return=Te,_e):(_e=k(_e,Ie.children||[]),_e.return=Te,_e)}function je(Te,_e,Ie,Je,Pt){return _e===null||_e.tag!==7?(_e=Va(Ie,Te.mode,Je,Pt),_e.return=Te,_e):(_e=k(_e,Ie),_e.return=Te,_e)}function qe(Te,_e,Ie){if(typeof _e=="string"&&_e!==""||typeof _e=="number")return _e=Cs(""+_e,Te.mode,Ie),_e.return=Te,_e;if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case mt:return Ie=pc(_e.type,_e.key,_e.props,null,Te.mode,Ie),Ie.ref=Ze(Te,null,_e),Ie.return=Te,Ie;case pt:return _e=Eo(_e,Te.mode,Ie),_e.return=Te,_e;case Gr:var Je=_e._init;return qe(Te,Je(_e._payload),Ie)}if(Mr(_e)||zt(_e))return _e=Va(_e,Te.mode,Ie,null),_e.return=Te,_e;dt(Te,_e)}return null}function Ve(Te,_e,Ie,Je){var Pt=_e!==null?_e.key:null;if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number")return Pt!==null?null:ae(Te,_e,""+Ie,Je);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case mt:return Ie.key===Pt?me(Te,_e,Ie,Je):null;case pt:return Ie.key===Pt?Ce(Te,_e,Ie,Je):null;case Gr:return Pt=Ie._init,Ve(Te,_e,Pt(Ie._payload),Je)}if(Mr(Ie)||zt(Ie))return Pt!==null?null:je(Te,_e,Ie,Je,null);dt(Te,Ie)}return null}function nt(Te,_e,Ie,Je,Pt){if(typeof Je=="string"&&Je!==""||typeof Je=="number")return Te=Te.get(Ie)||null,ae(_e,Te,""+Je,Pt);if(typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case mt:return Te=Te.get(Je.key===null?Ie:Je.key)||null,me(_e,Te,Je,Pt);case pt:return Te=Te.get(Je.key===null?Ie:Je.key)||null,Ce(_e,Te,Je,Pt);case Gr:var Ft=Je._init;return nt(Te,_e,Ie,Ft(Je._payload),Pt)}if(Mr(Je)||zt(Je))return Te=Te.get(Ie)||null,je(_e,Te,Je,Pt,null);dt(_e,Je)}return null}function yt(Te,_e,Ie,Je){for(var Pt=null,Ft=null,Ct=_e,$t=_e=0,Ei=null;Ct!==null&&$t<Ie.length;$t++){Ct.index>$t?(Ei=Ct,Ct=null):Ei=Ct.sibling;var br=Ve(Te,Ct,Ie[$t],Je);if(br===null){Ct===null&&(Ct=Ei);break}n&&Ct&&br.alternate===null&&o(Te,Ct),_e=C(br,_e,$t),Ft===null?Pt=br:Ft.sibling=br,Ft=br,Ct=Ei}if($t===Ie.length)return d(Te,Ct),re&&L(Te,$t),Pt;if(Ct===null){for(;$t<Ie.length;$t++)Ct=qe(Te,Ie[$t],Je),Ct!==null&&(_e=C(Ct,_e,$t),Ft===null?Pt=Ct:Ft.sibling=Ct,Ft=Ct);return re&&L(Te,$t),Pt}for(Ct=y(Te,Ct);$t<Ie.length;$t++)Ei=nt(Ct,Te,$t,Ie[$t],Je),Ei!==null&&(n&&Ei.alternate!==null&&Ct.delete(Ei.key===null?$t:Ei.key),_e=C(Ei,_e,$t),Ft===null?Pt=Ei:Ft.sibling=Ei,Ft=Ei);return n&&Ct.forEach(function(ea){return o(Te,ea)}),re&&L(Te,$t),Pt}function Tt(Te,_e,Ie,Je){var Pt=zt(Ie);if(typeof Pt!="function")throw Error(S(150));if(Ie=Pt.call(Ie),Ie==null)throw Error(S(151));for(var Ft=Pt=null,Ct=_e,$t=_e=0,Ei=null,br=Ie.next();Ct!==null&&!br.done;$t++,br=Ie.next()){Ct.index>$t?(Ei=Ct,Ct=null):Ei=Ct.sibling;var ea=Ve(Te,Ct,br.value,Je);if(ea===null){Ct===null&&(Ct=Ei);break}n&&Ct&&ea.alternate===null&&o(Te,Ct),_e=C(ea,_e,$t),Ft===null?Pt=ea:Ft.sibling=ea,Ft=ea,Ct=Ei}if(br.done)return d(Te,Ct),re&&L(Te,$t),Pt;if(Ct===null){for(;!br.done;$t++,br=Ie.next())br=qe(Te,br.value,Je),br!==null&&(_e=C(br,_e,$t),Ft===null?Pt=br:Ft.sibling=br,Ft=br);return re&&L(Te,$t),Pt}for(Ct=y(Te,Ct);!br.done;$t++,br=Ie.next())br=nt(Ct,Te,$t,br.value,Je),br!==null&&(n&&br.alternate!==null&&Ct.delete(br.key===null?$t:br.key),_e=C(br,_e,$t),Ft===null?Pt=br:Ft.sibling=br,Ft=br);return n&&Ct.forEach(function(Lp){return o(Te,Lp)}),re&&L(Te,$t),Pt}function oi(Te,_e,Ie,Je){if(typeof Ie=="object"&&Ie!==null&&Ie.type===St&&Ie.key===null&&(Ie=Ie.props.children),typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case mt:e:{for(var Pt=Ie.key,Ft=_e;Ft!==null;){if(Ft.key===Pt){if(Pt=Ie.type,Pt===St){if(Ft.tag===7){d(Te,Ft.sibling),_e=k(Ft,Ie.props.children),_e.return=Te,Te=_e;break e}}else if(Ft.elementType===Pt||typeof Pt=="object"&&Pt!==null&&Pt.$$typeof===Gr&&Rt(Pt)===Ft.type){d(Te,Ft.sibling),_e=k(Ft,Ie.props),_e.ref=Ze(Te,Ft,Ie),_e.return=Te,Te=_e;break e}d(Te,Ft);break}else o(Te,Ft);Ft=Ft.sibling}Ie.type===St?(_e=Va(Ie.props.children,Te.mode,Je,Ie.key),_e.return=Te,Te=_e):(Je=pc(Ie.type,Ie.key,Ie.props,null,Te.mode,Je),Je.ref=Ze(Te,_e,Ie),Je.return=Te,Te=Je)}return Z(Te);case pt:e:{for(Ft=Ie.key;_e!==null;){if(_e.key===Ft)if(_e.tag===4&&_e.stateNode.containerInfo===Ie.containerInfo&&_e.stateNode.implementation===Ie.implementation){d(Te,_e.sibling),_e=k(_e,Ie.children||[]),_e.return=Te,Te=_e;break e}else{d(Te,_e);break}else o(Te,_e);_e=_e.sibling}_e=Eo(Ie,Te.mode,Je),_e.return=Te,Te=_e}return Z(Te);case Gr:return Ft=Ie._init,oi(Te,_e,Ft(Ie._payload),Je)}if(Mr(Ie))return yt(Te,_e,Ie,Je);if(zt(Ie))return Tt(Te,_e,Ie,Je);dt(Te,Ie)}return typeof Ie=="string"&&Ie!==""||typeof Ie=="number"?(Ie=""+Ie,_e!==null&&_e.tag===6?(d(Te,_e.sibling),_e=k(_e,Ie),_e.return=Te,Te=_e):(d(Te,_e),_e=Cs(Ie,Te.mode,Je),_e.return=Te,Te=_e),Z(Te)):d(Te,_e)}return oi}var Qe=Ye(!0),Lt=Ye(!1),Tr=xo(null),Ut=null,Xt=null,Ir=null;function _i(){Ir=Xt=Ut=null}function mn(n){var o=Tr.current;Dr(Tr),n._currentValue=o}function Pr(n,o,d){for(;n!==null;){var y=n.alternate;if((n.childLanes&o)!==o?(n.childLanes|=o,y!==null&&(y.childLanes|=o)):y!==null&&(y.childLanes&o)!==o&&(y.childLanes|=o),n===d)break;n=n.return}}function hi(n,o){Ut=n,Ir=Xt=null,n=n.dependencies,n!==null&&n.firstContext!==null&&((n.lanes&o)!==0&&(vn=!0),n.firstContext=null)}function Br(n){var o=n._currentValue;if(Ir!==n)if(n={context:n,memoizedValue:o,next:null},Xt===null){if(Ut===null)throw Error(S(308));Xt=n,Ut.dependencies={lanes:0,firstContext:n}}else Xt=Xt.next=n;return o}var Jr=null;function Si(n){Jr===null?Jr=[n]:Jr.push(n)}function rs(n,o,d,y){var k=o.interleaved;return k===null?(d.next=d,Si(o)):(d.next=k.next,k.next=d),o.interleaved=d,Yi(n,y)}function Yi(n,o){n.lanes|=o;var d=n.alternate;for(d!==null&&(d.lanes|=o),d=n,n=n.return;n!==null;)n.childLanes|=o,d=n.alternate,d!==null&&(d.childLanes|=o),d=n,n=n.return;return d.tag===3?d.stateNode:null}var is=!1;function bo(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function gn(n,o){n=n.updateQueue,o.updateQueue===n&&(o.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function An(n,o){return{eventTime:n,lane:o,tag:0,payload:null,callback:null,next:null}}function Es(n,o,d){var y=n.updateQueue;if(y===null)return null;if(y=y.shared,(yr&2)!==0){var k=y.pending;return k===null?o.next=o:(o.next=k.next,k.next=o),y.pending=o,Yi(n,d)}return k=y.interleaved,k===null?(o.next=o,Si(y)):(o.next=k.next,k.next=o),y.interleaved=o,Yi(n,d)}function Ni(n,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194240)!==0)){var y=o.lanes;y&=n.pendingLanes,d|=y,o.lanes=d,lo(n,d)}}function yn(n,o){var d=n.updateQueue,y=n.alternate;if(y!==null&&(y=y.updateQueue,d===y)){var k=null,C=null;if(d=d.firstBaseUpdate,d!==null){do{var Z={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};C===null?k=C=Z:C=C.next=Z,d=d.next}while(d!==null);C===null?k=C=o:C=C.next=o}else k=C=o;d={baseState:y.baseState,firstBaseUpdate:k,lastBaseUpdate:C,shared:y.shared,effects:y.effects},n.updateQueue=d;return}n=d.lastBaseUpdate,n===null?d.firstBaseUpdate=o:n.next=o,d.lastBaseUpdate=o}function ns(n,o,d,y){var k=n.updateQueue;is=!1;var C=k.firstBaseUpdate,Z=k.lastBaseUpdate,ae=k.shared.pending;if(ae!==null){k.shared.pending=null;var me=ae,Ce=me.next;me.next=null,Z===null?C=Ce:Z.next=Ce,Z=me;var je=n.alternate;je!==null&&(je=je.updateQueue,ae=je.lastBaseUpdate,ae!==Z&&(ae===null?je.firstBaseUpdate=Ce:ae.next=Ce,je.lastBaseUpdate=me))}if(C!==null){var qe=k.baseState;Z=0,je=Ce=me=null,ae=C;do{var Ve=ae.lane,nt=ae.eventTime;if((y&Ve)===Ve){je!==null&&(je=je.next={eventTime:nt,lane:0,tag:ae.tag,payload:ae.payload,callback:ae.callback,next:null});e:{var yt=n,Tt=ae;switch(Ve=o,nt=d,Tt.tag){case 1:if(yt=Tt.payload,typeof yt=="function"){qe=yt.call(nt,qe,Ve);break e}qe=yt;break e;case 3:yt.flags=yt.flags&-65537|128;case 0:if(yt=Tt.payload,Ve=typeof yt=="function"?yt.call(nt,qe,Ve):yt,Ve==null)break e;qe=ht({},qe,Ve);break e;case 2:is=!0}}ae.callback!==null&&ae.lane!==0&&(n.flags|=64,Ve=k.effects,Ve===null?k.effects=[ae]:Ve.push(ae))}else nt={eventTime:nt,lane:Ve,tag:ae.tag,payload:ae.payload,callback:ae.callback,next:null},je===null?(Ce=je=nt,me=qe):je=je.next=nt,Z|=Ve;if(ae=ae.next,ae===null){if(ae=k.shared.pending,ae===null)break;Ve=ae,ae=Ve.next,Ve.next=null,k.lastBaseUpdate=Ve,k.shared.pending=null}}while(!0);if(je===null&&(me=qe),k.baseState=me,k.firstBaseUpdate=Ce,k.lastBaseUpdate=je,o=k.shared.interleaved,o!==null){k=o;do Z|=k.lane,k=k.next;while(k!==o)}else C===null&&(k.shared.lanes=0);vl|=Z,n.lanes=Z,n.memoizedState=qe}}function zn(n,o,d){if(n=o.effects,o.effects=null,n!==null)for(o=0;o<n.length;o++){var y=n[o],k=y.callback;if(k!==null){if(y.callback=null,y=d,typeof k!="function")throw Error(S(191,k));k.call(y)}}}var ii={},Nr=xo(ii),ki=xo(ii),Yt=xo(ii);function _n(n){if(n===ii)throw Error(S(174));return n}function So(n,o){switch(Fr(Yt,o),Fr(ki,n),Fr(Nr,ii),n=o.nodeType,n){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:zo(null,"");break;default:n=n===8?o.parentNode:o,o=n.namespaceURI||null,n=n.tagName,o=zo(o,n)}Dr(Nr),Fr(Nr,o)}function ss(){Dr(Nr),Dr(ki),Dr(Yt)}function Vu(n){_n(Yt.current);var o=_n(Nr.current),d=zo(o,n.type);o!==d&&(Fr(ki,n),Fr(Nr,d))}function ju(n){ki.current===n&&(Dr(Nr),Dr(ki))}var Ur=xo(0);function os(n){for(var o=n;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Yl=[];function Pa(){for(var n=0;n<Yl.length;n++)Yl[n]._workInProgressVersionPrimary=null;Yl.length=0}var ko=rt.ReactCurrentDispatcher,Ca=rt.ReactCurrentBatchConfig,Is=0,Cr=null,Wr=null,di=null,Uu=!1,Jl=!1,$u=0,zh=0;function vi(){throw Error(S(321))}function Ma(n,o){if(o===null)return!1;for(var d=0;d<o.length&&d<n.length;d++)if(!Wi(n[d],o[d]))return!1;return!0}function Ws(n,o,d,y,k,C){if(Is=C,Cr=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,ko.current=n===null||n.memoizedState===null?Uc:bp,n=d(y,k),Jl){C=0;do{if(Jl=!1,$u=0,25<=C)throw Error(S(301));C+=1,di=Wr=null,o.updateQueue=null,ko.current=Sd,n=d(y,k)}while(Jl)}if(ko.current=jc,o=Wr!==null&&Wr.next!==null,Is=0,di=Wr=Cr=null,Uu=!1,o)throw Error(S(300));return n}function as(){var n=$u!==0;return $u=0,n}function Vi(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return di===null?Cr.memoizedState=di=n:di=di.next=n,di}function ls(){if(Wr===null){var n=Cr.alternate;n=n!==null?n.memoizedState:null}else n=Wr.next;var o=di===null?Cr.memoizedState:di.next;if(o!==null)di=o,Wr=n;else{if(n===null)throw Error(S(310));Wr=n,n={memoizedState:Wr.memoizedState,baseState:Wr.baseState,baseQueue:Wr.baseQueue,queue:Wr.queue,next:null},di===null?Cr.memoizedState=di=n:di=di.next=n}return di}function Xs(n,o){return typeof o=="function"?o(n):o}function Dh(n){var o=ls(),d=o.queue;if(d===null)throw Error(S(311));d.lastRenderedReducer=n;var y=Wr,k=y.baseQueue,C=d.pending;if(C!==null){if(k!==null){var Z=k.next;k.next=C.next,C.next=Z}y.baseQueue=k=C,d.pending=null}if(k!==null){C=k.next,y=y.baseState;var ae=Z=null,me=null,Ce=C;do{var je=Ce.lane;if((Is&je)===je)me!==null&&(me=me.next={lane:0,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null}),y=Ce.hasEagerState?Ce.eagerState:n(y,Ce.action);else{var qe={lane:je,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null};me===null?(ae=me=qe,Z=y):me=me.next=qe,Cr.lanes|=je,vl|=je}Ce=Ce.next}while(Ce!==null&&Ce!==C);me===null?Z=y:me.next=ae,Wi(y,o.memoizedState)||(vn=!0),o.memoizedState=y,o.baseState=Z,o.baseQueue=me,d.lastRenderedState=y}if(n=d.interleaved,n!==null){k=n;do C=k.lane,Cr.lanes|=C,vl|=C,k=k.next;while(k!==n)}else k===null&&(d.lanes=0);return[o.memoizedState,d.dispatch]}function Fc(n){var o=ls(),d=o.queue;if(d===null)throw Error(S(311));d.lastRenderedReducer=n;var y=d.dispatch,k=d.pending,C=o.memoizedState;if(k!==null){d.pending=null;var Z=k=k.next;do C=n(C,Z.action),Z=Z.next;while(Z!==k);Wi(C,o.memoizedState)||(vn=!0),o.memoizedState=C,o.baseQueue===null&&(o.baseState=C),d.lastRenderedState=C}return[C,y]}function ni(){}function Bc(n,o){var d=Cr,y=ls(),k=o(),C=!Wi(y.memoizedState,k);if(C&&(y.memoizedState=k,vn=!0),y=y.queue,Gu(za.bind(null,d,y,n),[n]),y.getSnapshot!==o||C||di!==null&&di.memoizedState.tag&1){if(d.flags|=2048,Zu(9,Aa.bind(null,d,y,k,o),void 0,null),Ti===null)throw Error(S(349));(Is&30)!==0||Lh(d,o,k)}return k}function Lh(n,o,d){n.flags|=16384,n={getSnapshot:o,value:d},o=Cr.updateQueue,o===null?(o={lastEffect:null,stores:null},Cr.updateQueue=o,o.stores=[n]):(d=o.stores,d===null?o.stores=[n]:d.push(n))}function Aa(n,o,d,y){o.value=d,o.getSnapshot=y,qu(o)&&Oc(n)}function za(n,o,d){return d(function(){qu(o)&&Oc(n)})}function qu(n){var o=n.getSnapshot;n=n.value;try{var d=o();return!Wi(n,d)}catch{return!0}}function Oc(n){var o=Yi(n,1);o!==null&&Ys(o,n,1,-1)}function Rh(n){var o=Vi();return typeof n=="function"&&(n=n()),o.memoizedState=o.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xs,lastRenderedState:n},o.queue=n,n=n.dispatch=eu.bind(null,Cr,n),[o.memoizedState,n]}function Zu(n,o,d,y){return n={tag:n,create:o,destroy:d,deps:y,next:null},o=Cr.updateQueue,o===null?(o={lastEffect:null,stores:null},Cr.updateQueue=o,o.lastEffect=n.next=n):(d=o.lastEffect,d===null?o.lastEffect=n.next=n:(y=d.next,d.next=n,n.next=y,o.lastEffect=n)),n}function Fh(){return ls().memoizedState}function Nc(n,o,d,y){var k=Vi();Cr.flags|=n,k.memoizedState=Zu(1|o,d,void 0,y===void 0?null:y)}function Ql(n,o,d,y){var k=ls();y=y===void 0?null:y;var C=void 0;if(Wr!==null){var Z=Wr.memoizedState;if(C=Z.destroy,y!==null&&Ma(y,Z.deps)){k.memoizedState=Zu(o,d,C,y);return}}Cr.flags|=n,k.memoizedState=Zu(1|o,d,C,y)}function vd(n,o){return Nc(8390656,8,n,o)}function Gu(n,o){return Ql(2048,8,n,o)}function Bh(n,o){return Ql(4,2,n,o)}function Oh(n,o){return Ql(4,4,n,o)}function fl(n,o){if(typeof o=="function")return n=n(),o(n),function(){o(null)};if(o!=null)return n=n(),o.current=n,function(){o.current=null}}function xd(n,o,d){return d=d!=null?d.concat([n]):null,Ql(4,4,fl.bind(null,o,n),d)}function ml(){}function Hu(n,o){var d=ls();o=o===void 0?null:o;var y=d.memoizedState;return y!==null&&o!==null&&Ma(o,y[1])?y[0]:(d.memoizedState=[n,o],n)}function Wu(n,o){var d=ls();o=o===void 0?null:o;var y=d.memoizedState;return y!==null&&o!==null&&Ma(o,y[1])?y[0]:(n=n(),d.memoizedState=[n,o],n)}function Nh(n,o,d){return(Is&21)===0?(n.baseState&&(n.baseState=!1,vn=!0),n.memoizedState=d):(Wi(d,o)||(d=Ls(),Cr.lanes|=d,vl|=d,n.baseState=!0),o)}function wd(n,o){var d=xr;xr=d!==0&&4>d?d:4,n(!0);var y=Ca.transition;Ca.transition={};try{n(!1),o()}finally{xr=d,Ca.transition=y}}function bd(){return ls().memoizedState}function Ji(n,o,d){var y=Oa(n);if(d={lane:y,action:d,hasEagerState:!1,eagerState:null,next:null},Vc(n))Vh(o,d);else if(d=rs(n,o,d,y),d!==null){var k=xn();Ys(d,n,y,k),tu(d,o,y)}}function eu(n,o,d){var y=Oa(n),k={lane:y,action:d,hasEagerState:!1,eagerState:null,next:null};if(Vc(n))Vh(o,k);else{var C=n.alternate;if(n.lanes===0&&(C===null||C.lanes===0)&&(C=o.lastRenderedReducer,C!==null))try{var Z=o.lastRenderedState,ae=C(Z,d);if(k.hasEagerState=!0,k.eagerState=ae,Wi(ae,Z)){var me=o.interleaved;me===null?(k.next=k,Si(o)):(k.next=me.next,me.next=k),o.interleaved=k;return}}catch{}d=rs(n,o,k,y),d!==null&&(k=xn(),Ys(d,n,y,k),tu(d,o,y))}}function Vc(n){var o=n.alternate;return n===Cr||o!==null&&o===Cr}function Vh(n,o){Jl=Uu=!0;var d=n.pending;d===null?o.next=o:(o.next=d.next,d.next=o),n.pending=o}function tu(n,o,d){if((d&4194240)!==0){var y=o.lanes;y&=n.pendingLanes,d|=y,o.lanes=d,lo(n,d)}}var jc={readContext:Br,useCallback:vi,useContext:vi,useEffect:vi,useImperativeHandle:vi,useInsertionEffect:vi,useLayoutEffect:vi,useMemo:vi,useReducer:vi,useRef:vi,useState:vi,useDebugValue:vi,useDeferredValue:vi,useTransition:vi,useMutableSource:vi,useSyncExternalStore:vi,useId:vi,unstable_isNewReconciler:!1},Uc={readContext:Br,useCallback:function(n,o){return Vi().memoizedState=[n,o===void 0?null:o],n},useContext:Br,useEffect:vd,useImperativeHandle:function(n,o,d){return d=d!=null?d.concat([n]):null,Nc(4194308,4,fl.bind(null,o,n),d)},useLayoutEffect:function(n,o){return Nc(4194308,4,n,o)},useInsertionEffect:function(n,o){return Nc(4,2,n,o)},useMemo:function(n,o){var d=Vi();return o=o===void 0?null:o,n=n(),d.memoizedState=[n,o],n},useReducer:function(n,o,d){var y=Vi();return o=d!==void 0?d(o):o,y.memoizedState=y.baseState=o,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:o},y.queue=n,n=n.dispatch=Ji.bind(null,Cr,n),[y.memoizedState,n]},useRef:function(n){var o=Vi();return n={current:n},o.memoizedState=n},useState:Rh,useDebugValue:ml,useDeferredValue:function(n){return Vi().memoizedState=n},useTransition:function(){var n=Rh(!1),o=n[0];return n=wd.bind(null,n[1]),Vi().memoizedState=n,[o,n]},useMutableSource:function(){},useSyncExternalStore:function(n,o,d){var y=Cr,k=Vi();if(re){if(d===void 0)throw Error(S(407));d=d()}else{if(d=o(),Ti===null)throw Error(S(349));(Is&30)!==0||Lh(y,o,d)}k.memoizedState=d;var C={value:d,getSnapshot:o};return k.queue=C,vd(za.bind(null,y,C,n),[n]),y.flags|=2048,Zu(9,Aa.bind(null,y,C,d,o),void 0,null),d},useId:function(){var n=Vi(),o=Ti.identifierPrefix;if(re){var d=M,y=T;d=(y&~(1<<32-kr(y)-1)).toString(32)+d,o=":"+o+"R"+d,d=$u++,0<d&&(o+="H"+d.toString(32)),o+=":"}else d=zh++,o=":"+o+"r"+d.toString(32)+":";return n.memoizedState=o},unstable_isNewReconciler:!1},bp={readContext:Br,useCallback:Hu,useContext:Br,useEffect:Gu,useImperativeHandle:xd,useInsertionEffect:Bh,useLayoutEffect:Oh,useMemo:Wu,useReducer:Dh,useRef:Fh,useState:function(){return Dh(Xs)},useDebugValue:ml,useDeferredValue:function(n){var o=ls();return Nh(o,Wr.memoizedState,n)},useTransition:function(){var n=Dh(Xs)[0],o=ls().memoizedState;return[n,o]},useMutableSource:ni,useSyncExternalStore:Bc,useId:bd,unstable_isNewReconciler:!1},Sd={readContext:Br,useCallback:Hu,useContext:Br,useEffect:Gu,useImperativeHandle:xd,useInsertionEffect:Bh,useLayoutEffect:Oh,useMemo:Wu,useReducer:Fc,useRef:Fh,useState:function(){return Fc(Xs)},useDebugValue:ml,useDeferredValue:function(n){var o=ls();return Wr===null?o.memoizedState=n:Nh(o,Wr.memoizedState,n)},useTransition:function(){var n=Fc(Xs)[0],o=ls().memoizedState;return[n,o]},useMutableSource:ni,useSyncExternalStore:Bc,useId:bd,unstable_isNewReconciler:!1};function Ps(n,o){if(n&&n.defaultProps){o=ht({},o),n=n.defaultProps;for(var d in n)o[d]===void 0&&(o[d]=n[d]);return o}return o}function $c(n,o,d,y){o=n.memoizedState,d=d(y,o),d=d==null?o:ht({},o,d),n.memoizedState=d,n.lanes===0&&(n.updateQueue.baseState=d)}var qc={isMounted:function(n){return(n=n._reactInternals)?qt(n)===n:!1},enqueueSetState:function(n,o,d){n=n._reactInternals;var y=xn(),k=Oa(n),C=An(y,k);C.payload=o,d!=null&&(C.callback=d),o=Es(n,C,k),o!==null&&(Ys(o,n,k,y),Ni(o,n,k))},enqueueReplaceState:function(n,o,d){n=n._reactInternals;var y=xn(),k=Oa(n),C=An(y,k);C.tag=1,C.payload=o,d!=null&&(C.callback=d),o=Es(n,C,k),o!==null&&(Ys(o,n,k,y),Ni(o,n,k))},enqueueForceUpdate:function(n,o){n=n._reactInternals;var d=xn(),y=Oa(n),k=An(d,y);k.tag=2,o!=null&&(k.callback=o),o=Es(n,k,y),o!==null&&(Ys(o,n,y,d),Ni(o,n,y))}};function Zc(n,o,d,y,k,C,Z){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(y,C,Z):o.prototype&&o.prototype.isPureReactComponent?!go(d,y)||!go(k,C):!0}function jh(n,o,d){var y=!1,k=wo,C=o.contextType;return typeof C=="object"&&C!==null?C=Br(C):(k=bi(o)?Mn:Er.current,y=o.contextTypes,C=(y=y!=null)?Hs(n,k):wo),o=new o(d,C),n.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=qc,n.stateNode=o,o._reactInternals=n,y&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=k,n.__reactInternalMemoizedMaskedChildContext=C),o}function Gc(n,o,d,y){n=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,y),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,y),o.state!==n&&qc.enqueueReplaceState(o,o.state,null)}function gl(n,o,d,y){var k=n.stateNode;k.props=d,k.state=n.memoizedState,k.refs={},bo(n);var C=o.contextType;typeof C=="object"&&C!==null?k.context=Br(C):(C=bi(o)?Mn:Er.current,k.context=Hs(n,C)),k.state=n.memoizedState,C=o.getDerivedStateFromProps,typeof C=="function"&&($c(n,o,C,d),k.state=n.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof k.getSnapshotBeforeUpdate=="function"||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(o=k.state,typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount(),o!==k.state&&qc.enqueueReplaceState(k,k.state,null),ns(n,d,k,y),k.state=n.memoizedState),typeof k.componentDidMount=="function"&&(n.flags|=4194308)}function Mi(n,o){try{var d="",y=o;do d+=Jt(y),y=y.return;while(y);var k=d}catch(C){k=`
Error generating stack: `+C.message+`
`+C.stack}return{value:n,source:o,stack:k,digest:null}}function Hc(n,o,d){return{value:n,source:null,stack:d??null,digest:o??null}}function Xu(n,o){try{console.error(o.value)}catch(d){setTimeout(function(){throw d})}}var Sp=typeof WeakMap=="function"?WeakMap:Map;function Uh(n,o,d){d=An(-1,d),d.tag=3,d.payload={element:null};var y=o.value;return d.callback=function(){sc||(sc=!0,nh=y),Xu(n,o)},d}function kd(n,o,d){d=An(-1,d),d.tag=3;var y=n.type.getDerivedStateFromError;if(typeof y=="function"){var k=o.value;d.payload=function(){return y(k)},d.callback=function(){Xu(n,o)}}var C=n.stateNode;return C!==null&&typeof C.componentDidCatch=="function"&&(d.callback=function(){Xu(n,o),typeof y!="function"&&(ur===null?ur=new Set([this]):ur.add(this));var Z=o.stack;this.componentDidCatch(o.value,{componentStack:Z!==null?Z:""})}),d}function Td(n,o,d){var y=n.pingCache;if(y===null){y=n.pingCache=new Sp;var k=new Set;y.set(o,k)}else k=y.get(o),k===void 0&&(k=new Set,y.set(o,k));k.has(d)||(k.add(d),n=Cp.bind(null,n,o,d),o.then(n,n))}function Ed(n){do{var o;if((o=n.tag===13)&&(o=n.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return n;n=n.return}while(n!==null);return null}function Id(n,o,d,y,k){return(n.mode&1)===0?(n===o?n.flags|=65536:(n.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(o=An(-1,1),o.tag=2,Es(d,o,1))),d.lanes|=1),n):(n.flags|=65536,n.lanes=k,n)}var Pd=rt.ReactCurrentOwner,vn=!1;function pi(n,o,d,y){o.child=n===null?Lt(o,null,d,y):Qe(o,n.child,d,y)}function ru(n,o,d,y,k){d=d.render;var C=o.ref;return hi(o,k),y=Ws(n,o,d,y,C,k),d=as(),n!==null&&!vn?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~k,us(n,o,k)):(re&&d&&q(o),o.flags|=1,pi(n,o,y,k),o.child)}function Cd(n,o,d,y,k){if(n===null){var C=d.type;return typeof C=="function"&&!dc(C)&&C.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(o.tag=15,o.type=C,Md(n,o,C,y,k)):(n=pc(d.type,null,y,o,o.mode,k),n.ref=o.ref,n.return=o,o.child=n)}if(C=n.child,(n.lanes&k)===0){var Z=C.memoizedProps;if(d=d.compare,d=d!==null?d:go,d(Z,y)&&n.ref===o.ref)return us(n,o,k)}return o.flags|=1,n=Na(C,y),n.ref=o.ref,n.return=o,o.child=n}function Md(n,o,d,y,k){if(n!==null){var C=n.memoizedProps;if(go(C,y)&&n.ref===o.ref)if(vn=!1,o.pendingProps=y=C,(n.lanes&k)!==0)(n.flags&131072)!==0&&(vn=!0);else return o.lanes=n.lanes,us(n,o,k)}return $h(n,o,d,y,k)}function Ad(n,o,d){var y=o.pendingProps,k=y.children,C=n!==null?n.memoizedState:null;if(y.mode==="hidden")if((o.mode&1)===0)o.memoizedState={baseLanes:0,cachePool:null,transitions:null},Fr(su,tn),tn|=d;else{if((d&1073741824)===0)return n=C!==null?C.baseLanes|d:d,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:n,cachePool:null,transitions:null},o.updateQueue=null,Fr(su,tn),tn|=n,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},y=C!==null?C.baseLanes:d,Fr(su,tn),tn|=y}else C!==null?(y=C.baseLanes|d,o.memoizedState=null):y=d,Fr(su,tn),tn|=y;return pi(n,o,k,d),o.child}function zd(n,o){var d=o.ref;(n===null&&d!==null||n!==null&&n.ref!==d)&&(o.flags|=512,o.flags|=2097152)}function $h(n,o,d,y,k){var C=bi(d)?Mn:Er.current;return C=Hs(o,C),hi(o,k),d=Ws(n,o,d,y,C,k),y=as(),n!==null&&!vn?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~k,us(n,o,k)):(re&&y&&q(o),o.flags|=1,pi(n,o,d,k),o.child)}function Dd(n,o,d,y,k){if(bi(d)){var C=!0;fn(o)}else C=!1;if(hi(o,k),o.stateNode===null)Ju(n,o),jh(o,d,y),gl(o,d,y,k),y=!0;else if(n===null){var Z=o.stateNode,ae=o.memoizedProps;Z.props=ae;var me=Z.context,Ce=d.contextType;typeof Ce=="object"&&Ce!==null?Ce=Br(Ce):(Ce=bi(d)?Mn:Er.current,Ce=Hs(o,Ce));var je=d.getDerivedStateFromProps,qe=typeof je=="function"||typeof Z.getSnapshotBeforeUpdate=="function";qe||typeof Z.UNSAFE_componentWillReceiveProps!="function"&&typeof Z.componentWillReceiveProps!="function"||(ae!==y||me!==Ce)&&Gc(o,Z,y,Ce),is=!1;var Ve=o.memoizedState;Z.state=Ve,ns(o,y,Z,k),me=o.memoizedState,ae!==y||Ve!==me||rr.current||is?(typeof je=="function"&&($c(o,d,je,y),me=o.memoizedState),(ae=is||Zc(o,d,ae,y,Ve,me,Ce))?(qe||typeof Z.UNSAFE_componentWillMount!="function"&&typeof Z.componentWillMount!="function"||(typeof Z.componentWillMount=="function"&&Z.componentWillMount(),typeof Z.UNSAFE_componentWillMount=="function"&&Z.UNSAFE_componentWillMount()),typeof Z.componentDidMount=="function"&&(o.flags|=4194308)):(typeof Z.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=y,o.memoizedState=me),Z.props=y,Z.state=me,Z.context=Ce,y=ae):(typeof Z.componentDidMount=="function"&&(o.flags|=4194308),y=!1)}else{Z=o.stateNode,gn(n,o),ae=o.memoizedProps,Ce=o.type===o.elementType?ae:Ps(o.type,ae),Z.props=Ce,qe=o.pendingProps,Ve=Z.context,me=d.contextType,typeof me=="object"&&me!==null?me=Br(me):(me=bi(d)?Mn:Er.current,me=Hs(o,me));var nt=d.getDerivedStateFromProps;(je=typeof nt=="function"||typeof Z.getSnapshotBeforeUpdate=="function")||typeof Z.UNSAFE_componentWillReceiveProps!="function"&&typeof Z.componentWillReceiveProps!="function"||(ae!==qe||Ve!==me)&&Gc(o,Z,y,me),is=!1,Ve=o.memoizedState,Z.state=Ve,ns(o,y,Z,k);var yt=o.memoizedState;ae!==qe||Ve!==yt||rr.current||is?(typeof nt=="function"&&($c(o,d,nt,y),yt=o.memoizedState),(Ce=is||Zc(o,d,Ce,y,Ve,yt,me)||!1)?(je||typeof Z.UNSAFE_componentWillUpdate!="function"&&typeof Z.componentWillUpdate!="function"||(typeof Z.componentWillUpdate=="function"&&Z.componentWillUpdate(y,yt,me),typeof Z.UNSAFE_componentWillUpdate=="function"&&Z.UNSAFE_componentWillUpdate(y,yt,me)),typeof Z.componentDidUpdate=="function"&&(o.flags|=4),typeof Z.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof Z.componentDidUpdate!="function"||ae===n.memoizedProps&&Ve===n.memoizedState||(o.flags|=4),typeof Z.getSnapshotBeforeUpdate!="function"||ae===n.memoizedProps&&Ve===n.memoizedState||(o.flags|=1024),o.memoizedProps=y,o.memoizedState=yt),Z.props=y,Z.state=yt,Z.context=me,y=Ce):(typeof Z.componentDidUpdate!="function"||ae===n.memoizedProps&&Ve===n.memoizedState||(o.flags|=4),typeof Z.getSnapshotBeforeUpdate!="function"||ae===n.memoizedProps&&Ve===n.memoizedState||(o.flags|=1024),y=!1)}return qh(n,o,d,y,C,k)}function qh(n,o,d,y,k,C){zd(n,o);var Z=(o.flags&128)!==0;if(!y&&!Z)return k&&Ea(o,d,!1),us(n,o,C);y=o.stateNode,Pd.current=o;var ae=Z&&typeof d.getDerivedStateFromError!="function"?null:y.render();return o.flags|=1,n!==null&&Z?(o.child=Qe(o,n.child,null,C),o.child=Qe(o,null,ae,C)):pi(n,o,ae,C),o.memoizedState=y.state,k&&Ea(o,d,!0),o.child}function Wc(n){var o=n.stateNode;o.pendingContext?ka(n,o.pendingContext,o.pendingContext!==o.context):o.context&&ka(n,o.context,!1),So(n,o.containerInfo)}function Ld(n,o,d,y,k){return We(),it(k),o.flags|=256,pi(n,o,d,y),o.child}var Da={dehydrated:null,treeContext:null,retryLane:0};function Zh(n){return{baseLanes:n,cachePool:null,transitions:null}}function Qr(n,o,d){var y=o.pendingProps,k=Ur.current,C=!1,Z=(o.flags&128)!==0,ae;if((ae=Z)||(ae=n!==null&&n.memoizedState===null?!1:(k&2)!==0),ae?(C=!0,o.flags&=-129):(n===null||n.memoizedState!==null)&&(k|=1),Fr(Ur,k&1),n===null)return ve(o),n=o.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?((o.mode&1)===0?o.lanes=1:n.data==="$!"?o.lanes=8:o.lanes=1073741824,null):(Z=y.children,n=y.fallback,C?(y=o.mode,C=o.child,Z={mode:"hidden",children:Z},(y&1)===0&&C!==null?(C.childLanes=0,C.pendingProps=Z):C=ja(Z,y,0,null),n=Va(n,y,d,null),C.return=o,n.return=o,C.sibling=n,o.child=C,o.child.memoizedState=Zh(d),o.memoizedState=Da,n):iu(o,Z));if(k=n.memoizedState,k!==null&&(ae=k.dehydrated,ae!==null))return Xc(n,o,Z,y,ae,k,d);if(C){C=y.fallback,Z=o.mode,k=n.child,ae=k.sibling;var me={mode:"hidden",children:y.children};return(Z&1)===0&&o.child!==k?(y=o.child,y.childLanes=0,y.pendingProps=me,o.deletions=null):(y=Na(k,me),y.subtreeFlags=k.subtreeFlags&14680064),ae!==null?C=Na(ae,C):(C=Va(C,Z,d,null),C.flags|=2),C.return=o,y.return=o,y.sibling=C,o.child=y,y=C,C=o.child,Z=n.child.memoizedState,Z=Z===null?Zh(d):{baseLanes:Z.baseLanes|d,cachePool:null,transitions:Z.transitions},C.memoizedState=Z,C.childLanes=n.childLanes&~d,o.memoizedState=Da,y}return C=n.child,n=C.sibling,y=Na(C,{mode:"visible",children:y.children}),(o.mode&1)===0&&(y.lanes=d),y.return=o,y.sibling=null,n!==null&&(d=o.deletions,d===null?(o.deletions=[n],o.flags|=16):d.push(n)),o.child=y,o.memoizedState=null,y}function iu(n,o){return o=ja({mode:"visible",children:o},n.mode,0,null),o.return=n,n.child=o}function Ku(n,o,d,y){return y!==null&&it(y),Qe(o,n.child,null,d),n=iu(o,o.pendingProps.children),n.flags|=2,o.memoizedState=null,n}function Xc(n,o,d,y,k,C,Z){if(d)return o.flags&256?(o.flags&=-257,y=Hc(Error(S(422))),Ku(n,o,Z,y)):o.memoizedState!==null?(o.child=n.child,o.flags|=128,null):(C=y.fallback,k=o.mode,y=ja({mode:"visible",children:y.children},k,0,null),C=Va(C,k,Z,null),C.flags|=2,y.return=o,C.return=o,y.sibling=C,o.child=y,(o.mode&1)!==0&&Qe(o,n.child,null,Z),o.child.memoizedState=Zh(Z),o.memoizedState=Da,C);if((o.mode&1)===0)return Ku(n,o,Z,null);if(k.data==="$!"){if(y=k.nextSibling&&k.nextSibling.dataset,y)var ae=y.dgst;return y=ae,C=Error(S(419)),y=Hc(C,y,void 0),Ku(n,o,Z,y)}if(ae=(Z&n.childLanes)!==0,vn||ae){if(y=Ti,y!==null){switch(Z&-Z){case 4:k=2;break;case 16:k=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:k=32;break;case 536870912:k=268435456;break;default:k=0}k=(k&(y.suspendedLanes|Z))!==0?0:k,k!==0&&k!==C.retryLane&&(C.retryLane=k,Yi(n,k),Ys(y,n,k,-1))}return ah(),y=Hc(Error(S(421))),Ku(n,o,Z,y)}return k.data==="$?"?(o.flags|=128,o.child=n.child,o=Kd.bind(null,n),k._reactRetry=o,null):(n=C.treeContext,Q=Qn(k.nextSibling),K=o,re=!0,oe=null,n!==null&&(p[v++]=T,p[v++]=M,p[v++]=w,T=n.id,M=n.overflow,w=o),o=iu(o,y.children),o.flags|=4096,o)}function Yu(n,o,d){n.lanes|=o;var y=n.alternate;y!==null&&(y.lanes|=o),Pr(n.return,o,d)}function yl(n,o,d,y,k){var C=n.memoizedState;C===null?n.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:y,tail:d,tailMode:k}:(C.isBackwards=o,C.rendering=null,C.renderingStartTime=0,C.last=y,C.tail=d,C.tailMode=k)}function Gh(n,o,d){var y=o.pendingProps,k=y.revealOrder,C=y.tail;if(pi(n,o,y.children,d),y=Ur.current,(y&2)!==0)y=y&1|2,o.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=o.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Yu(n,d,o);else if(n.tag===19)Yu(n,d,o);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===o)break e;for(;n.sibling===null;){if(n.return===null||n.return===o)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}y&=1}if(Fr(Ur,y),(o.mode&1)===0)o.memoizedState=null;else switch(k){case"forwards":for(d=o.child,k=null;d!==null;)n=d.alternate,n!==null&&os(n)===null&&(k=d),d=d.sibling;d=k,d===null?(k=o.child,o.child=null):(k=d.sibling,d.sibling=null),yl(o,!1,k,d,C);break;case"backwards":for(d=null,k=o.child,o.child=null;k!==null;){if(n=k.alternate,n!==null&&os(n)===null){o.child=k;break}n=k.sibling,k.sibling=d,d=k,k=n}yl(o,!0,d,null,C);break;case"together":yl(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Ju(n,o){(o.mode&1)===0&&n!==null&&(n.alternate=null,o.alternate=null,o.flags|=2)}function us(n,o,d){if(n!==null&&(o.dependencies=n.dependencies),vl|=o.lanes,(d&o.childLanes)===0)return null;if(n!==null&&o.child!==n.child)throw Error(S(153));if(o.child!==null){for(n=o.child,d=Na(n,n.pendingProps),o.child=d,d.return=o;n.sibling!==null;)n=n.sibling,d=d.sibling=Na(n,n.pendingProps),d.return=o;d.sibling=null}return o.child}function Hh(n,o,d){switch(o.tag){case 3:Wc(o),We();break;case 5:Vu(o);break;case 1:bi(o.type)&&fn(o);break;case 4:So(o,o.stateNode.containerInfo);break;case 10:var y=o.type._context,k=o.memoizedProps.value;Fr(Tr,y._currentValue),y._currentValue=k;break;case 13:if(y=o.memoizedState,y!==null)return y.dehydrated!==null?(Fr(Ur,Ur.current&1),o.flags|=128,null):(d&o.child.childLanes)!==0?Qr(n,o,d):(Fr(Ur,Ur.current&1),n=us(n,o,d),n!==null?n.sibling:null);Fr(Ur,Ur.current&1);break;case 19:if(y=(d&o.childLanes)!==0,(n.flags&128)!==0){if(y)return Gh(n,o,d);o.flags|=128}if(k=o.memoizedState,k!==null&&(k.rendering=null,k.tail=null,k.lastEffect=null),Fr(Ur,Ur.current),y)break;return null;case 22:case 23:return o.lanes=0,Ad(n,o,d)}return us(n,o,d)}var Kc,Qu,Yc,Wh;Kc=function(n,o){for(var d=o.child;d!==null;){if(d.tag===5||d.tag===6)n.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===o)break;for(;d.sibling===null;){if(d.return===null||d.return===o)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},Qu=function(){},Yc=function(n,o,d,y){var k=n.memoizedProps;if(k!==y){n=o.stateNode,_n(Nr.current);var C=null;switch(d){case"input":k=gs(n,k),y=gs(n,y),C=[];break;case"select":k=ht({},k,{value:void 0}),y=ht({},y,{value:void 0}),C=[];break;case"textarea":k=_s(n,k),y=_s(n,y),C=[];break;default:typeof k.onClick!="function"&&typeof y.onClick=="function"&&(n.onclick=Ki)}Ii(d,y);var Z;d=null;for(Ce in k)if(!y.hasOwnProperty(Ce)&&k.hasOwnProperty(Ce)&&k[Ce]!=null)if(Ce==="style"){var ae=k[Ce];for(Z in ae)ae.hasOwnProperty(Z)&&(d||(d={}),d[Z]="")}else Ce!=="dangerouslySetInnerHTML"&&Ce!=="children"&&Ce!=="suppressContentEditableWarning"&&Ce!=="suppressHydrationWarning"&&Ce!=="autoFocus"&&(F.hasOwnProperty(Ce)?C||(C=[]):(C=C||[]).push(Ce,null));for(Ce in y){var me=y[Ce];if(ae=k?.[Ce],y.hasOwnProperty(Ce)&&me!==ae&&(me!=null||ae!=null))if(Ce==="style")if(ae){for(Z in ae)!ae.hasOwnProperty(Z)||me&&me.hasOwnProperty(Z)||(d||(d={}),d[Z]="");for(Z in me)me.hasOwnProperty(Z)&&ae[Z]!==me[Z]&&(d||(d={}),d[Z]=me[Z])}else d||(C||(C=[]),C.push(Ce,d)),d=me;else Ce==="dangerouslySetInnerHTML"?(me=me?me.__html:void 0,ae=ae?ae.__html:void 0,me!=null&&ae!==me&&(C=C||[]).push(Ce,me)):Ce==="children"?typeof me!="string"&&typeof me!="number"||(C=C||[]).push(Ce,""+me):Ce!=="suppressContentEditableWarning"&&Ce!=="suppressHydrationWarning"&&(F.hasOwnProperty(Ce)?(me!=null&&Ce==="onScroll"&&zr("scroll",n),C||ae===me||(C=[])):(C=C||[]).push(Ce,me))}d&&(C=C||[]).push("style",d);var Ce=C;(o.updateQueue=Ce)&&(o.flags|=4)}},Wh=function(n,o,d,y){d!==y&&(o.flags|=4)};function nu(n,o){if(!re)switch(n.tailMode){case"hidden":o=n.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?n.tail=null:d.sibling=null;break;case"collapsed":d=n.tail;for(var y=null;d!==null;)d.alternate!==null&&(y=d),d=d.sibling;y===null?o||n.tail===null?n.tail=null:n.tail.sibling=null:y.sibling=null}}function Qi(n){var o=n.alternate!==null&&n.alternate.child===n.child,d=0,y=0;if(o)for(var k=n.child;k!==null;)d|=k.lanes|k.childLanes,y|=k.subtreeFlags&14680064,y|=k.flags&14680064,k.return=n,k=k.sibling;else for(k=n.child;k!==null;)d|=k.lanes|k.childLanes,y|=k.subtreeFlags,y|=k.flags,k.return=n,k=k.sibling;return n.subtreeFlags|=y,n.childLanes=d,o}function kp(n,o,d){var y=o.pendingProps;switch(H(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qi(o),null;case 1:return bi(o.type)&&dl(),Qi(o),null;case 3:return y=o.stateNode,ss(),Dr(rr),Dr(Er),Pa(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(n===null||n.child===null)&&(Fe(o)?o.flags|=4:n===null||n.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,oe!==null&&(Jh(oe),oe=null))),Qu(n,o),Qi(o),null;case 5:ju(o);var k=_n(Yt.current);if(d=o.type,n!==null&&o.stateNode!=null)Yc(n,o,d,y,k),n.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!y){if(o.stateNode===null)throw Error(S(166));return Qi(o),null}if(n=_n(Nr.current),Fe(o)){y=o.stateNode,d=o.type;var C=o.memoizedProps;switch(y[Oi]=o,y[Ts]=C,n=(o.mode&1)!==0,d){case"dialog":zr("cancel",y),zr("close",y);break;case"iframe":case"object":case"embed":zr("load",y);break;case"video":case"audio":for(k=0;k<vo.length;k++)zr(vo[k],y);break;case"source":zr("error",y);break;case"img":case"image":case"link":zr("error",y),zr("load",y);break;case"details":zr("toggle",y);break;case"input":Mo(y,C),zr("invalid",y);break;case"select":y._wrapperState={wasMultiple:!!C.multiple},zr("invalid",y);break;case"textarea":vs(y,C),zr("invalid",y)}Ii(d,C),k=null;for(var Z in C)if(C.hasOwnProperty(Z)){var ae=C[Z];Z==="children"?typeof ae=="string"?y.textContent!==ae&&(C.suppressHydrationWarning!==!0&&ba(y.textContent,ae,n),k=["children",ae]):typeof ae=="number"&&y.textContent!==""+ae&&(C.suppressHydrationWarning!==!0&&ba(y.textContent,ae,n),k=["children",""+ae]):F.hasOwnProperty(Z)&&ae!=null&&Z==="onScroll"&&zr("scroll",y)}switch(d){case"input":oo(y),na(y,C,!0);break;case"textarea":oo(y),ln(y);break;case"select":case"option":break;default:typeof C.onClick=="function"&&(y.onclick=Ki)}y=k,o.updateQueue=y,y!==null&&(o.flags|=4)}else{Z=k.nodeType===9?k:k.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=sa(d)),n==="http://www.w3.org/1999/xhtml"?d==="script"?(n=Z.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof y.is=="string"?n=Z.createElement(d,{is:y.is}):(n=Z.createElement(d),d==="select"&&(Z=n,y.multiple?Z.multiple=!0:y.size&&(Z.size=y.size))):n=Z.createElementNS(n,d),n[Oi]=o,n[Ts]=y,Kc(n,o,!1,!1),o.stateNode=n;e:{switch(Z=un(d,y),d){case"dialog":zr("cancel",n),zr("close",n),k=y;break;case"iframe":case"object":case"embed":zr("load",n),k=y;break;case"video":case"audio":for(k=0;k<vo.length;k++)zr(vo[k],n);k=y;break;case"source":zr("error",n),k=y;break;case"img":case"image":case"link":zr("error",n),zr("load",n),k=y;break;case"details":zr("toggle",n),k=y;break;case"input":Mo(n,y),k=gs(n,y),zr("invalid",n);break;case"option":k=y;break;case"select":n._wrapperState={wasMultiple:!!y.multiple},k=ht({},y,{value:void 0}),zr("invalid",n);break;case"textarea":vs(n,y),k=_s(n,y),zr("invalid",n);break;default:k=y}Ii(d,k),ae=k;for(C in ae)if(ae.hasOwnProperty(C)){var me=ae[C];C==="style"?Wt(n,me):C==="dangerouslySetInnerHTML"?(me=me?me.__html:void 0,me!=null&&Gn(n,me)):C==="children"?typeof me=="string"?(d!=="textarea"||me!=="")&&ui(n,me):typeof me=="number"&&ui(n,""+me):C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&C!=="autoFocus"&&(F.hasOwnProperty(C)?me!=null&&C==="onScroll"&&zr("scroll",n):me!=null&&Ge(n,C,me,Z))}switch(d){case"input":oo(n),na(n,y,!1);break;case"textarea":oo(n),ln(n);break;case"option":y.value!=null&&n.setAttribute("value",""+tr(y.value));break;case"select":n.multiple=!!y.multiple,C=y.value,C!=null?ys(n,!!y.multiple,C,!1):y.defaultValue!=null&&ys(n,!!y.multiple,y.defaultValue,!0);break;default:typeof k.onClick=="function"&&(n.onclick=Ki)}switch(d){case"button":case"input":case"select":case"textarea":y=!!y.autoFocus;break e;case"img":y=!0;break e;default:y=!1}}y&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return Qi(o),null;case 6:if(n&&o.stateNode!=null)Wh(n,o,n.memoizedProps,y);else{if(typeof y!="string"&&o.stateNode===null)throw Error(S(166));if(d=_n(Yt.current),_n(Nr.current),Fe(o)){if(y=o.stateNode,d=o.memoizedProps,y[Oi]=o,(C=y.nodeValue!==d)&&(n=K,n!==null))switch(n.tag){case 3:ba(y.nodeValue,d,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&ba(y.nodeValue,d,(n.mode&1)!==0)}C&&(o.flags|=4)}else y=(d.nodeType===9?d:d.ownerDocument).createTextNode(y),y[Oi]=o,o.stateNode=y}return Qi(o),null;case 13:if(Dr(Ur),y=o.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(re&&Q!==null&&(o.mode&1)!==0&&(o.flags&128)===0)Ue(),We(),o.flags|=98560,C=!1;else if(C=Fe(o),y!==null&&y.dehydrated!==null){if(n===null){if(!C)throw Error(S(318));if(C=o.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(S(317));C[Oi]=o}else We(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Qi(o),C=!1}else oe!==null&&(Jh(oe),oe=null),C=!0;if(!C)return o.flags&65536?o:null}return(o.flags&128)!==0?(o.lanes=d,o):(y=y!==null,y!==(n!==null&&n.memoizedState!==null)&&y&&(o.child.flags|=8192,(o.mode&1)!==0&&(n===null||(Ur.current&1)!==0?xi===0&&(xi=3):ah())),o.updateQueue!==null&&(o.flags|=4),Qi(o),null);case 4:return ss(),Qu(n,o),n===null&&$s(o.stateNode.containerInfo),Qi(o),null;case 10:return mn(o.type._context),Qi(o),null;case 17:return bi(o.type)&&dl(),Qi(o),null;case 19:if(Dr(Ur),C=o.memoizedState,C===null)return Qi(o),null;if(y=(o.flags&128)!==0,Z=C.rendering,Z===null)if(y)nu(C,!1);else{if(xi!==0||n!==null&&(n.flags&128)!==0)for(n=o.child;n!==null;){if(Z=os(n),Z!==null){for(o.flags|=128,nu(C,!1),y=Z.updateQueue,y!==null&&(o.updateQueue=y,o.flags|=4),o.subtreeFlags=0,y=d,d=o.child;d!==null;)C=d,n=y,C.flags&=14680066,Z=C.alternate,Z===null?(C.childLanes=0,C.lanes=n,C.child=null,C.subtreeFlags=0,C.memoizedProps=null,C.memoizedState=null,C.updateQueue=null,C.dependencies=null,C.stateNode=null):(C.childLanes=Z.childLanes,C.lanes=Z.lanes,C.child=Z.child,C.subtreeFlags=0,C.deletions=null,C.memoizedProps=Z.memoizedProps,C.memoizedState=Z.memoizedState,C.updateQueue=Z.updateQueue,C.type=Z.type,n=Z.dependencies,C.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),d=d.sibling;return Fr(Ur,Ur.current&1|2),o.child}n=n.sibling}C.tail!==null&&Ot()>$r&&(o.flags|=128,y=!0,nu(C,!1),o.lanes=4194304)}else{if(!y)if(n=os(Z),n!==null){if(o.flags|=128,y=!0,d=n.updateQueue,d!==null&&(o.updateQueue=d,o.flags|=4),nu(C,!0),C.tail===null&&C.tailMode==="hidden"&&!Z.alternate&&!re)return Qi(o),null}else 2*Ot()-C.renderingStartTime>$r&&d!==1073741824&&(o.flags|=128,y=!0,nu(C,!1),o.lanes=4194304);C.isBackwards?(Z.sibling=o.child,o.child=Z):(d=C.last,d!==null?d.sibling=Z:o.child=Z,C.last=Z)}return C.tail!==null?(o=C.tail,C.rendering=o,C.tail=o.sibling,C.renderingStartTime=Ot(),o.sibling=null,d=Ur.current,Fr(Ur,y?d&1|2:d&1),o):(Qi(o),null);case 22:case 23:return lc(),y=o.memoizedState!==null,n!==null&&n.memoizedState!==null!==y&&(o.flags|=8192),y&&(o.mode&1)!==0?(tn&1073741824)!==0&&(Qi(o),o.subtreeFlags&6&&(o.flags|=8192)):Qi(o),null;case 24:return null;case 25:return null}throw Error(S(156,o.tag))}function Tp(n,o){switch(H(o),o.tag){case 1:return bi(o.type)&&dl(),n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 3:return ss(),Dr(rr),Dr(Er),Pa(),n=o.flags,(n&65536)!==0&&(n&128)===0?(o.flags=n&-65537|128,o):null;case 5:return ju(o),null;case 13:if(Dr(Ur),n=o.memoizedState,n!==null&&n.dehydrated!==null){if(o.alternate===null)throw Error(S(340));We()}return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 19:return Dr(Ur),null;case 4:return ss(),null;case 10:return mn(o.type._context),null;case 22:case 23:return lc(),null;case 24:return null;default:return null}}var Jc=!1,en=!1,La=typeof WeakSet=="function"?WeakSet:Set,wt=null;function _l(n,o){var d=n.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(y){Xr(n,o,y)}else d.current=null}function Ra(n,o,d){try{d()}catch(y){Xr(n,o,y)}}var Rd=!1;function Ep(n,o){if(Zs=Oo,n=$l(),yo(n)){if("selectionStart"in n)var d={start:n.selectionStart,end:n.selectionEnd};else e:{d=(d=n.ownerDocument)&&d.defaultView||window;var y=d.getSelection&&d.getSelection();if(y&&y.rangeCount!==0){d=y.anchorNode;var k=y.anchorOffset,C=y.focusNode;y=y.focusOffset;try{d.nodeType,C.nodeType}catch{d=null;break e}var Z=0,ae=-1,me=-1,Ce=0,je=0,qe=n,Ve=null;t:for(;;){for(var nt;qe!==d||k!==0&&qe.nodeType!==3||(ae=Z+k),qe!==C||y!==0&&qe.nodeType!==3||(me=Z+y),qe.nodeType===3&&(Z+=qe.nodeValue.length),(nt=qe.firstChild)!==null;)Ve=qe,qe=nt;for(;;){if(qe===n)break t;if(Ve===d&&++Ce===k&&(ae=Z),Ve===C&&++je===y&&(me=Z),(nt=qe.nextSibling)!==null)break;qe=Ve,Ve=qe.parentNode}qe=nt}d=ae===-1||me===-1?null:{start:ae,end:me}}else d=null}d=d||{start:0,end:0}}else d=null;for(Fu={focusedElem:n,selectionRange:d},Oo=!1,wt=o;wt!==null;)if(o=wt,n=o.child,(o.subtreeFlags&1028)!==0&&n!==null)n.return=o,wt=n;else for(;wt!==null;){o=wt;try{var yt=o.alternate;if((o.flags&1024)!==0)switch(o.tag){case 0:case 11:case 15:break;case 1:if(yt!==null){var Tt=yt.memoizedProps,oi=yt.memoizedState,Te=o.stateNode,_e=Te.getSnapshotBeforeUpdate(o.elementType===o.type?Tt:Ps(o.type,Tt),oi);Te.__reactInternalSnapshotBeforeUpdate=_e}break;case 3:var Ie=o.stateNode.containerInfo;Ie.nodeType===1?Ie.textContent="":Ie.nodeType===9&&Ie.documentElement&&Ie.removeChild(Ie.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(S(163))}}catch(Je){Xr(o,o.return,Je)}if(n=o.sibling,n!==null){n.return=o.return,wt=n;break}wt=o.return}return yt=Rd,Rd=!1,yt}function ec(n,o,d){var y=o.updateQueue;if(y=y!==null?y.lastEffect:null,y!==null){var k=y=y.next;do{if((k.tag&n)===n){var C=k.destroy;k.destroy=void 0,C!==void 0&&Ra(o,d,C)}k=k.next}while(k!==y)}}function tc(n,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var d=o=o.next;do{if((d.tag&n)===n){var y=d.create;d.destroy=y()}d=d.next}while(d!==o)}}function Qc(n){var o=n.ref;if(o!==null){var d=n.stateNode;n.tag,n=d,typeof o=="function"?o(n):o.current=n}}function Fd(n){var o=n.alternate;o!==null&&(n.alternate=null,Fd(o)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(o=n.stateNode,o!==null&&(delete o[Oi],delete o[Ts],delete o[er],delete o[Ou],delete o[Ah])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Bd(n){return n.tag===5||n.tag===3||n.tag===4}function Od(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Bd(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Xh(n,o,d){var y=n.tag;if(y===5||y===6)n=n.stateNode,o?d.nodeType===8?d.parentNode.insertBefore(n,o):d.insertBefore(n,o):(d.nodeType===8?(o=d.parentNode,o.insertBefore(n,d)):(o=d,o.appendChild(n)),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=Ki));else if(y!==4&&(n=n.child,n!==null))for(Xh(n,o,d),n=n.sibling;n!==null;)Xh(n,o,d),n=n.sibling}function rc(n,o,d){var y=n.tag;if(y===5||y===6)n=n.stateNode,o?d.insertBefore(n,o):d.appendChild(n);else if(y!==4&&(n=n.child,n!==null))for(rc(n,o,d),n=n.sibling;n!==null;)rc(n,o,d),n=n.sibling}var fi=null,cs=!1;function Fa(n,o,d){for(d=d.child;d!==null;)Nd(n,o,d),d=d.sibling}function Nd(n,o,d){if(Fi&&typeof Fi.onCommitFiberUnmount=="function")try{Fi.onCommitFiberUnmount(Ci,d)}catch{}switch(d.tag){case 5:en||_l(d,o);case 6:var y=fi,k=cs;fi=null,Fa(n,o,d),fi=y,cs=k,fi!==null&&(cs?(n=fi,d=d.stateNode,n.nodeType===8?n.parentNode.removeChild(d):n.removeChild(d)):fi.removeChild(d.stateNode));break;case 18:fi!==null&&(cs?(n=fi,d=d.stateNode,n.nodeType===8?at(n.parentNode,d):n.nodeType===1&&at(n,d),Rs(n)):at(fi,d.stateNode));break;case 4:y=fi,k=cs,fi=d.stateNode.containerInfo,cs=!0,Fa(n,o,d),fi=y,cs=k;break;case 0:case 11:case 14:case 15:if(!en&&(y=d.updateQueue,y!==null&&(y=y.lastEffect,y!==null))){k=y=y.next;do{var C=k,Z=C.destroy;C=C.tag,Z!==void 0&&((C&2)!==0||(C&4)!==0)&&Ra(d,o,Z),k=k.next}while(k!==y)}Fa(n,o,d);break;case 1:if(!en&&(_l(d,o),y=d.stateNode,typeof y.componentWillUnmount=="function"))try{y.props=d.memoizedProps,y.state=d.memoizedState,y.componentWillUnmount()}catch(ae){Xr(d,o,ae)}Fa(n,o,d);break;case 21:Fa(n,o,d);break;case 22:d.mode&1?(en=(y=en)||d.memoizedState!==null,Fa(n,o,d),en=y):Fa(n,o,d);break;default:Fa(n,o,d)}}function Kh(n){var o=n.updateQueue;if(o!==null){n.updateQueue=null;var d=n.stateNode;d===null&&(d=n.stateNode=new La),o.forEach(function(y){var k=Yd.bind(null,n,y);d.has(y)||(d.add(y),y.then(k,k))})}}function Ks(n,o){var d=o.deletions;if(d!==null)for(var y=0;y<d.length;y++){var k=d[y];try{var C=n,Z=o,ae=Z;e:for(;ae!==null;){switch(ae.tag){case 5:fi=ae.stateNode,cs=!1;break e;case 3:fi=ae.stateNode.containerInfo,cs=!0;break e;case 4:fi=ae.stateNode.containerInfo,cs=!0;break e}ae=ae.return}if(fi===null)throw Error(S(160));Nd(C,Z,k),fi=null,cs=!1;var me=k.alternate;me!==null&&(me.return=null),k.return=null}catch(Ce){Xr(k,o,Ce)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)Vd(o,n),o=o.sibling}function Vd(n,o){var d=n.alternate,y=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Ks(o,n),Dn(n),y&4){try{ec(3,n,n.return),tc(3,n)}catch(Tt){Xr(n,n.return,Tt)}try{ec(5,n,n.return)}catch(Tt){Xr(n,n.return,Tt)}}break;case 1:Ks(o,n),Dn(n),y&512&&d!==null&&_l(d,d.return);break;case 5:if(Ks(o,n),Dn(n),y&512&&d!==null&&_l(d,d.return),n.flags&32){var k=n.stateNode;try{ui(k,"")}catch(Tt){Xr(n,n.return,Tt)}}if(y&4&&(k=n.stateNode,k!=null)){var C=n.memoizedProps,Z=d!==null?d.memoizedProps:C,ae=n.type,me=n.updateQueue;if(n.updateQueue=null,me!==null)try{ae==="input"&&C.type==="radio"&&C.name!=null&&Pe(k,C),un(ae,Z);var Ce=un(ae,C);for(Z=0;Z<me.length;Z+=2){var je=me[Z],qe=me[Z+1];je==="style"?Wt(k,qe):je==="dangerouslySetInnerHTML"?Gn(k,qe):je==="children"?ui(k,qe):Ge(k,je,qe,Ce)}switch(ae){case"input":zs(k,C);break;case"textarea":Ao(k,C);break;case"select":var Ve=k._wrapperState.wasMultiple;k._wrapperState.wasMultiple=!!C.multiple;var nt=C.value;nt!=null?ys(k,!!C.multiple,nt,!1):Ve!==!!C.multiple&&(C.defaultValue!=null?ys(k,!!C.multiple,C.defaultValue,!0):ys(k,!!C.multiple,C.multiple?[]:"",!1))}k[Ts]=C}catch(Tt){Xr(n,n.return,Tt)}}break;case 6:if(Ks(o,n),Dn(n),y&4){if(n.stateNode===null)throw Error(S(162));k=n.stateNode,C=n.memoizedProps;try{k.nodeValue=C}catch(Tt){Xr(n,n.return,Tt)}}break;case 3:if(Ks(o,n),Dn(n),y&4&&d!==null&&d.memoizedState.isDehydrated)try{Rs(o.containerInfo)}catch(Tt){Xr(n,n.return,Tt)}break;case 4:Ks(o,n),Dn(n);break;case 13:Ks(o,n),Dn(n),k=n.child,k.flags&8192&&(C=k.memoizedState!==null,k.stateNode.isHidden=C,!C||k.alternate!==null&&k.alternate.memoizedState!==null||(xl=Ot())),y&4&&Kh(n);break;case 22:if(je=d!==null&&d.memoizedState!==null,n.mode&1?(en=(Ce=en)||je,Ks(o,n),en=Ce):Ks(o,n),Dn(n),y&8192){if(Ce=n.memoizedState!==null,(n.stateNode.isHidden=Ce)&&!je&&(n.mode&1)!==0)for(wt=n,je=n.child;je!==null;){for(qe=wt=je;wt!==null;){switch(Ve=wt,nt=Ve.child,Ve.tag){case 0:case 11:case 14:case 15:ec(4,Ve,Ve.return);break;case 1:_l(Ve,Ve.return);var yt=Ve.stateNode;if(typeof yt.componentWillUnmount=="function"){y=Ve,d=Ve.return;try{o=y,yt.props=o.memoizedProps,yt.state=o.memoizedState,yt.componentWillUnmount()}catch(Tt){Xr(y,d,Tt)}}break;case 5:_l(Ve,Ve.return);break;case 22:if(Ve.memoizedState!==null){qd(qe);continue}}nt!==null?(nt.return=Ve,wt=nt):qd(qe)}je=je.sibling}e:for(je=null,qe=n;;){if(qe.tag===5){if(je===null){je=qe;try{k=qe.stateNode,Ce?(C=k.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none"):(ae=qe.stateNode,me=qe.memoizedProps.style,Z=me!=null&&me.hasOwnProperty("display")?me.display:null,ae.style.display=Ke("display",Z))}catch(Tt){Xr(n,n.return,Tt)}}}else if(qe.tag===6){if(je===null)try{qe.stateNode.nodeValue=Ce?"":qe.memoizedProps}catch(Tt){Xr(n,n.return,Tt)}}else if((qe.tag!==22&&qe.tag!==23||qe.memoizedState===null||qe===n)&&qe.child!==null){qe.child.return=qe,qe=qe.child;continue}if(qe===n)break e;for(;qe.sibling===null;){if(qe.return===null||qe.return===n)break e;je===qe&&(je=null),qe=qe.return}je===qe&&(je=null),qe.sibling.return=qe.return,qe=qe.sibling}}break;case 19:Ks(o,n),Dn(n),y&4&&Kh(n);break;case 21:break;default:Ks(o,n),Dn(n)}}function Dn(n){var o=n.flags;if(o&2){try{e:{for(var d=n.return;d!==null;){if(Bd(d)){var y=d;break e}d=d.return}throw Error(S(160))}switch(y.tag){case 5:var k=y.stateNode;y.flags&32&&(ui(k,""),y.flags&=-33);var C=Od(n);rc(n,C,k);break;case 3:case 4:var Z=y.stateNode.containerInfo,ae=Od(n);Xh(n,ae,Z);break;default:throw Error(S(161))}}catch(me){Xr(n,n.return,me)}n.flags&=-3}o&4096&&(n.flags&=-4097)}function jd(n,o,d){wt=n,Ud(n)}function Ud(n,o,d){for(var y=(n.mode&1)!==0;wt!==null;){var k=wt,C=k.child;if(k.tag===22&&y){var Z=k.memoizedState!==null||Jc;if(!Z){var ae=k.alternate,me=ae!==null&&ae.memoizedState!==null||en;ae=Jc;var Ce=en;if(Jc=Z,(en=me)&&!Ce)for(wt=k;wt!==null;)Z=wt,me=Z.child,Z.tag===22&&Z.memoizedState!==null?Zd(k):me!==null?(me.return=Z,wt=me):Zd(k);for(;C!==null;)wt=C,Ud(C),C=C.sibling;wt=k,Jc=ae,en=Ce}$d(n)}else(k.subtreeFlags&8772)!==0&&C!==null?(C.return=k,wt=C):$d(n)}}function $d(n){for(;wt!==null;){var o=wt;if((o.flags&8772)!==0){var d=o.alternate;try{if((o.flags&8772)!==0)switch(o.tag){case 0:case 11:case 15:en||tc(5,o);break;case 1:var y=o.stateNode;if(o.flags&4&&!en)if(d===null)y.componentDidMount();else{var k=o.elementType===o.type?d.memoizedProps:Ps(o.type,d.memoizedProps);y.componentDidUpdate(k,d.memoizedState,y.__reactInternalSnapshotBeforeUpdate)}var C=o.updateQueue;C!==null&&zn(o,C,y);break;case 3:var Z=o.updateQueue;if(Z!==null){if(d=null,o.child!==null)switch(o.child.tag){case 5:d=o.child.stateNode;break;case 1:d=o.child.stateNode}zn(o,Z,d)}break;case 5:var ae=o.stateNode;if(d===null&&o.flags&4){d=ae;var me=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":me.autoFocus&&d.focus();break;case"img":me.src&&(d.src=me.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var Ce=o.alternate;if(Ce!==null){var je=Ce.memoizedState;if(je!==null){var qe=je.dehydrated;qe!==null&&Rs(qe)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(S(163))}en||o.flags&512&&Qc(o)}catch(Ve){Xr(o,o.return,Ve)}}if(o===n){wt=null;break}if(d=o.sibling,d!==null){d.return=o.return,wt=d;break}wt=o.return}}function qd(n){for(;wt!==null;){var o=wt;if(o===n){wt=null;break}var d=o.sibling;if(d!==null){d.return=o.return,wt=d;break}wt=o.return}}function Zd(n){for(;wt!==null;){var o=wt;try{switch(o.tag){case 0:case 11:case 15:var d=o.return;try{tc(4,o)}catch(me){Xr(o,d,me)}break;case 1:var y=o.stateNode;if(typeof y.componentDidMount=="function"){var k=o.return;try{y.componentDidMount()}catch(me){Xr(o,k,me)}}var C=o.return;try{Qc(o)}catch(me){Xr(o,C,me)}break;case 5:var Z=o.return;try{Qc(o)}catch(me){Xr(o,Z,me)}}}catch(me){Xr(o,o.return,me)}if(o===n){wt=null;break}var ae=o.sibling;if(ae!==null){ae.return=o.return,wt=ae;break}wt=o.return}}var Ip=Math.ceil,eh=rt.ReactCurrentDispatcher,th=rt.ReactCurrentOwner,Ln=rt.ReactCurrentBatchConfig,yr=0,Ti=null,mi=null,ji=0,tn=0,su=xo(0),xi=0,ic=null,vl=0,rh=0,ih=0,nc=null,Rn=null,xl=0,$r=1/0,To=null,sc=!1,nh=null,ur=null,ou=!1,Yo=null,oc=0,hs=0,Ba=null,ac=-1,sh=0;function xn(){return(yr&6)!==0?Ot():ac!==-1?ac:ac=Ot()}function Oa(n){return(n.mode&1)===0?1:(yr&2)!==0&&ji!==0?ji&-ji:Xe.transition!==null?(sh===0&&(sh=Ls()),sh):(n=xr,n!==0||(n=window.event,n=n===void 0?16:ho(n.type)),n)}function Ys(n,o,d,y){if(50<hs)throw hs=0,Ba=null,Error(S(185));Fo(n,d,y),((yr&2)===0||n!==Ti)&&(n===Ti&&((yr&2)===0&&(rh|=d),xi===4&&Js(n,ji)),Fn(n,y),d===1&&yr===0&&(o.mode&1)===0&&($r=Ot()+500,Et&&f()))}function Fn(n,o){var d=n.callbackNode;Pl(n,o);var y=Gi(n,n===Ti?ji:0);if(y===0)d!==null&&gi(d),n.callbackNode=null,n.callbackPriority=0;else if(o=y&-y,n.callbackPriority!==o){if(d!=null&&gi(d),o===1)n.tag===0?Nu(wl.bind(null,n)):pl(wl.bind(null,n)),Sa(function(){(yr&6)===0&&f()}),d=null;else{switch(Ha(y)){case 1:d=Za;break;case 4:d=qi;break;case 16:d=Pi;break;case 536870912:d=hn;break;default:d=Pi}d=td(d,Gd.bind(null,n))}n.callbackPriority=o,n.callbackNode=d}}function Gd(n,o){if(ac=-1,sh=0,(yr&6)!==0)throw Error(S(327));var d=n.callbackNode;if(eo()&&n.callbackNode!==d)return null;var y=Gi(n,n===Ti?ji:0);if(y===0)return null;if((y&30)!==0||(y&n.expiredLanes)!==0||o)o=uc(n,y);else{o=y;var k=yr;yr|=2;var C=Wd();(Ti!==n||ji!==o)&&(To=null,$r=Ot()+500,bl(n,o));do try{Qh();break}catch(ae){Hd(n,ae)}while(!0);_i(),eh.current=C,yr=k,mi!==null?o=0:(Ti=null,ji=0,o=xi)}if(o!==0){if(o===2&&(k=Ds(n),k!==0&&(y=k,o=Yh(n,k))),o===1)throw d=ic,bl(n,0),Js(n,y),Fn(n,Ot()),d;if(o===6)Js(n,y);else{if(k=n.current.alternate,(y&30)===0&&!Pp(k)&&(o=uc(n,y),o===2&&(C=Ds(n),C!==0&&(y=C,o=Yh(n,C))),o===1))throw d=ic,bl(n,0),Js(n,y),Fn(n,Ot()),d;switch(n.finishedWork=k,n.finishedLanes=y,o){case 0:case 1:throw Error(S(345));case 2:Qs(n,Rn,To);break;case 3:if(Js(n,y),(y&130023424)===y&&(o=xl+500-Ot(),10<o)){if(Gi(n,0)!==0)break;if(k=n.suspendedLanes,(k&y)!==y){xn(),n.pingedLanes|=n.suspendedLanes&k;break}n.timeoutHandle=Wl(Qs.bind(null,n,Rn,To),o);break}Qs(n,Rn,To);break;case 4:if(Js(n,y),(y&4194240)===y)break;for(o=n.eventTimes,k=-1;0<y;){var Z=31-kr(y);C=1<<Z,Z=o[Z],Z>k&&(k=Z),y&=~C}if(y=k,y=Ot()-y,y=(120>y?120:480>y?480:1080>y?1080:1920>y?1920:3e3>y?3e3:4320>y?4320:1960*Ip(y/1960))-y,10<y){n.timeoutHandle=Wl(Qs.bind(null,n,Rn,To),y);break}Qs(n,Rn,To);break;case 5:Qs(n,Rn,To);break;default:throw Error(S(329))}}}return Fn(n,Ot()),n.callbackNode===d?Gd.bind(null,n):null}function Yh(n,o){var d=nc;return n.current.memoizedState.isDehydrated&&(bl(n,o).flags|=256),n=uc(n,o),n!==2&&(o=Rn,Rn=d,o!==null&&Jh(o)),n}function Jh(n){Rn===null?Rn=n:Rn.push.apply(Rn,n)}function Pp(n){for(var o=n;;){if(o.flags&16384){var d=o.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var y=0;y<d.length;y++){var k=d[y],C=k.getSnapshot;k=k.value;try{if(!Wi(C(),k))return!1}catch{return!1}}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Js(n,o){for(o&=~ih,o&=~rh,n.suspendedLanes|=o,n.pingedLanes&=~o,n=n.expirationTimes;0<o;){var d=31-kr(o),y=1<<d;n[d]=-1,o&=~y}}function wl(n){if((yr&6)!==0)throw Error(S(327));eo();var o=Gi(n,0);if((o&1)===0)return Fn(n,Ot()),null;var d=uc(n,o);if(n.tag!==0&&d===2){var y=Ds(n);y!==0&&(o=y,d=Yh(n,y))}if(d===1)throw d=ic,bl(n,0),Js(n,o),Fn(n,Ot()),d;if(d===6)throw Error(S(345));return n.finishedWork=n.current.alternate,n.finishedLanes=o,Qs(n,Rn,To),Fn(n,Ot()),null}function oh(n,o){var d=yr;yr|=1;try{return n(o)}finally{yr=d,yr===0&&($r=Ot()+500,Et&&f())}}function Jo(n){Yo!==null&&Yo.tag===0&&(yr&6)===0&&eo();var o=yr;yr|=1;var d=Ln.transition,y=xr;try{if(Ln.transition=null,xr=1,n)return n()}finally{xr=y,Ln.transition=d,yr=o,(yr&6)===0&&f()}}function lc(){tn=su.current,Dr(su)}function bl(n,o){n.finishedWork=null,n.finishedLanes=0;var d=n.timeoutHandle;if(d!==-1&&(n.timeoutHandle=-1,Rc(d)),mi!==null)for(d=mi.return;d!==null;){var y=d;switch(H(y),y.tag){case 1:y=y.type.childContextTypes,y!=null&&dl();break;case 3:ss(),Dr(rr),Dr(Er),Pa();break;case 5:ju(y);break;case 4:ss();break;case 13:Dr(Ur);break;case 19:Dr(Ur);break;case 10:mn(y.type._context);break;case 22:case 23:lc()}d=d.return}if(Ti=n,mi=n=Na(n.current,null),ji=tn=o,xi=0,ic=null,ih=rh=vl=0,Rn=nc=null,Jr!==null){for(o=0;o<Jr.length;o++)if(d=Jr[o],y=d.interleaved,y!==null){d.interleaved=null;var k=y.next,C=d.pending;if(C!==null){var Z=C.next;C.next=k,y.next=Z}d.pending=y}Jr=null}return n}function Hd(n,o){do{var d=mi;try{if(_i(),ko.current=jc,Uu){for(var y=Cr.memoizedState;y!==null;){var k=y.queue;k!==null&&(k.pending=null),y=y.next}Uu=!1}if(Is=0,di=Wr=Cr=null,Jl=!1,$u=0,th.current=null,d===null||d.return===null){xi=1,ic=o,mi=null;break}e:{var C=n,Z=d.return,ae=d,me=o;if(o=ji,ae.flags|=32768,me!==null&&typeof me=="object"&&typeof me.then=="function"){var Ce=me,je=ae,qe=je.tag;if((je.mode&1)===0&&(qe===0||qe===11||qe===15)){var Ve=je.alternate;Ve?(je.updateQueue=Ve.updateQueue,je.memoizedState=Ve.memoizedState,je.lanes=Ve.lanes):(je.updateQueue=null,je.memoizedState=null)}var nt=Ed(Z);if(nt!==null){nt.flags&=-257,Id(nt,Z,ae,C,o),nt.mode&1&&Td(C,Ce,o),o=nt,me=Ce;var yt=o.updateQueue;if(yt===null){var Tt=new Set;Tt.add(me),o.updateQueue=Tt}else yt.add(me);break e}else{if((o&1)===0){Td(C,Ce,o),ah();break e}me=Error(S(426))}}else if(re&&ae.mode&1){var oi=Ed(Z);if(oi!==null){(oi.flags&65536)===0&&(oi.flags|=256),Id(oi,Z,ae,C,o),it(Mi(me,ae));break e}}C=me=Mi(me,ae),xi!==4&&(xi=2),nc===null?nc=[C]:nc.push(C),C=Z;do{switch(C.tag){case 3:C.flags|=65536,o&=-o,C.lanes|=o;var Te=Uh(C,me,o);yn(C,Te);break e;case 1:ae=me;var _e=C.type,Ie=C.stateNode;if((C.flags&128)===0&&(typeof _e.getDerivedStateFromError=="function"||Ie!==null&&typeof Ie.componentDidCatch=="function"&&(ur===null||!ur.has(Ie)))){C.flags|=65536,o&=-o,C.lanes|=o;var Je=kd(C,ae,o);yn(C,Je);break e}}C=C.return}while(C!==null)}Qo(d)}catch(Pt){o=Pt,mi===d&&d!==null&&(mi=d=d.return);continue}break}while(!0)}function Wd(){var n=eh.current;return eh.current=jc,n===null?jc:n}function ah(){(xi===0||xi===3||xi===2)&&(xi=4),Ti===null||(vl&268435455)===0&&(rh&268435455)===0||Js(Ti,ji)}function uc(n,o){var d=yr;yr|=2;var y=Wd();(Ti!==n||ji!==o)&&(To=null,bl(n,o));do try{wn();break}catch(k){Hd(n,k)}while(!0);if(_i(),yr=d,eh.current=y,mi!==null)throw Error(S(261));return Ti=null,ji=0,xi}function wn(){for(;mi!==null;)ed(mi)}function Qh(){for(;mi!==null&&!Ri();)ed(mi)}function ed(n){var o=Jd(n.alternate,n,tn);n.memoizedProps=n.pendingProps,o===null?Qo(n):mi=o,th.current=null}function Qo(n){var o=n;do{var d=o.alternate;if(n=o.return,(o.flags&32768)===0){if(d=kp(d,o,tn),d!==null){mi=d;return}}else{if(d=Tp(d,o),d!==null){d.flags&=32767,mi=d;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{xi=6,mi=null;return}}if(o=o.sibling,o!==null){mi=o;return}mi=o=n}while(o!==null);xi===0&&(xi=5)}function Qs(n,o,d){var y=xr,k=Ln.transition;try{Ln.transition=null,xr=1,cc(n,o,d,y)}finally{Ln.transition=k,xr=y}return null}function cc(n,o,d,y){do eo();while(Yo!==null);if((yr&6)!==0)throw Error(S(327));d=n.finishedWork;var k=n.finishedLanes;if(d===null)return null;if(n.finishedWork=null,n.finishedLanes=0,d===n.current)throw Error(S(177));n.callbackNode=null,n.callbackPriority=0;var C=d.lanes|d.childLanes;if(yu(n,C),n===Ti&&(mi=Ti=null,ji=0),(d.subtreeFlags&2064)===0&&(d.flags&2064)===0||ou||(ou=!0,td(Pi,function(){return eo(),null})),C=(d.flags&15990)!==0,(d.subtreeFlags&15990)!==0||C){C=Ln.transition,Ln.transition=null;var Z=xr;xr=1;var ae=yr;yr|=4,th.current=null,Ep(n,d),Vd(d,n),il(Fu),Oo=!!Zs,Fu=Zs=null,n.current=d,jd(d),oa(),yr=ae,xr=Z,Ln.transition=C}else n.current=d;if(ou&&(ou=!1,Yo=n,oc=k),C=n.pendingLanes,C===0&&(ur=null),Do(d.stateNode),Fn(n,Ot()),o!==null)for(y=n.onRecoverableError,d=0;d<o.length;d++)k=o[d],y(k.value,{componentStack:k.stack,digest:k.digest});if(sc)throw sc=!1,n=nh,nh=null,n;return(oc&1)!==0&&n.tag!==0&&eo(),C=n.pendingLanes,(C&1)!==0?n===Ba?hs++:(hs=0,Ba=n):hs=0,f(),null}function eo(){if(Yo!==null){var n=Ha(oc),o=Ln.transition,d=xr;try{if(Ln.transition=null,xr=16>n?16:n,Yo===null)var y=!1;else{if(n=Yo,Yo=null,oc=0,(yr&6)!==0)throw Error(S(331));var k=yr;for(yr|=4,wt=n.current;wt!==null;){var C=wt,Z=C.child;if((wt.flags&16)!==0){var ae=C.deletions;if(ae!==null){for(var me=0;me<ae.length;me++){var Ce=ae[me];for(wt=Ce;wt!==null;){var je=wt;switch(je.tag){case 0:case 11:case 15:ec(8,je,C)}var qe=je.child;if(qe!==null)qe.return=je,wt=qe;else for(;wt!==null;){je=wt;var Ve=je.sibling,nt=je.return;if(Fd(je),je===Ce){wt=null;break}if(Ve!==null){Ve.return=nt,wt=Ve;break}wt=nt}}}var yt=C.alternate;if(yt!==null){var Tt=yt.child;if(Tt!==null){yt.child=null;do{var oi=Tt.sibling;Tt.sibling=null,Tt=oi}while(Tt!==null)}}wt=C}}if((C.subtreeFlags&2064)!==0&&Z!==null)Z.return=C,wt=Z;else e:for(;wt!==null;){if(C=wt,(C.flags&2048)!==0)switch(C.tag){case 0:case 11:case 15:ec(9,C,C.return)}var Te=C.sibling;if(Te!==null){Te.return=C.return,wt=Te;break e}wt=C.return}}var _e=n.current;for(wt=_e;wt!==null;){Z=wt;var Ie=Z.child;if((Z.subtreeFlags&2064)!==0&&Ie!==null)Ie.return=Z,wt=Ie;else e:for(Z=_e;wt!==null;){if(ae=wt,(ae.flags&2048)!==0)try{switch(ae.tag){case 0:case 11:case 15:tc(9,ae)}}catch(Pt){Xr(ae,ae.return,Pt)}if(ae===Z){wt=null;break e}var Je=ae.sibling;if(Je!==null){Je.return=ae.return,wt=Je;break e}wt=ae.return}}if(yr=k,f(),Fi&&typeof Fi.onPostCommitFiberRoot=="function")try{Fi.onPostCommitFiberRoot(Ci,n)}catch{}y=!0}return y}finally{xr=d,Ln.transition=o}}return!1}function hc(n,o,d){o=Mi(d,o),o=Uh(n,o,1),n=Es(n,o,1),o=xn(),n!==null&&(Fo(n,1,o),Fn(n,o))}function Xr(n,o,d){if(n.tag===3)hc(n,n,d);else for(;o!==null;){if(o.tag===3){hc(o,n,d);break}else if(o.tag===1){var y=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(ur===null||!ur.has(y))){n=Mi(d,n),n=kd(o,n,1),o=Es(o,n,1),n=xn(),o!==null&&(Fo(o,1,n),Fn(o,n));break}}o=o.return}}function Cp(n,o,d){var y=n.pingCache;y!==null&&y.delete(o),o=xn(),n.pingedLanes|=n.suspendedLanes&d,Ti===n&&(ji&d)===d&&(xi===4||xi===3&&(ji&130023424)===ji&&500>Ot()-xl?bl(n,0):ih|=d),Fn(n,o)}function Xd(n,o){o===0&&((n.mode&1)===0?o=1:(o=Zi,Zi<<=1,(Zi&130023424)===0&&(Zi=4194304)));var d=xn();n=Yi(n,o),n!==null&&(Fo(n,o,d),Fn(n,d))}function Kd(n){var o=n.memoizedState,d=0;o!==null&&(d=o.retryLane),Xd(n,d)}function Yd(n,o){var d=0;switch(n.tag){case 13:var y=n.stateNode,k=n.memoizedState;k!==null&&(d=k.retryLane);break;case 19:y=n.stateNode;break;default:throw Error(S(314))}y!==null&&y.delete(o),Xd(n,d)}var Jd;Jd=function(n,o,d){if(n!==null)if(n.memoizedProps!==o.pendingProps||rr.current)vn=!0;else{if((n.lanes&d)===0&&(o.flags&128)===0)return vn=!1,Hh(n,o,d);vn=(n.flags&131072)!==0}else vn=!1,re&&(o.flags&1048576)!==0&&R(o,u,o.index);switch(o.lanes=0,o.tag){case 2:var y=o.type;Ju(n,o),n=o.pendingProps;var k=Hs(o,Er.current);hi(o,d),k=Ws(null,o,y,n,k,d);var C=as();return o.flags|=1,typeof k=="object"&&k!==null&&typeof k.render=="function"&&k.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,bi(y)?(C=!0,fn(o)):C=!1,o.memoizedState=k.state!==null&&k.state!==void 0?k.state:null,bo(o),k.updater=qc,o.stateNode=k,k._reactInternals=o,gl(o,y,n,d),o=qh(null,o,y,!0,C,d)):(o.tag=0,re&&C&&q(o),pi(null,o,k,d),o=o.child),o;case 16:y=o.elementType;e:{switch(Ju(n,o),n=o.pendingProps,k=y._init,y=k(y._payload),o.type=y,k=o.tag=Mp(y),n=Ps(y,n),k){case 0:o=$h(null,o,y,n,d);break e;case 1:o=Dd(null,o,y,n,d);break e;case 11:o=ru(null,o,y,n,d);break e;case 14:o=Cd(null,o,y,Ps(y.type,n),d);break e}throw Error(S(306,y,""))}return o;case 0:return y=o.type,k=o.pendingProps,k=o.elementType===y?k:Ps(y,k),$h(n,o,y,k,d);case 1:return y=o.type,k=o.pendingProps,k=o.elementType===y?k:Ps(y,k),Dd(n,o,y,k,d);case 3:e:{if(Wc(o),n===null)throw Error(S(387));y=o.pendingProps,C=o.memoizedState,k=C.element,gn(n,o),ns(o,y,null,d);var Z=o.memoizedState;if(y=Z.element,C.isDehydrated)if(C={element:y,isDehydrated:!1,cache:Z.cache,pendingSuspenseBoundaries:Z.pendingSuspenseBoundaries,transitions:Z.transitions},o.updateQueue.baseState=C,o.memoizedState=C,o.flags&256){k=Mi(Error(S(423)),o),o=Ld(n,o,y,d,k);break e}else if(y!==k){k=Mi(Error(S(424)),o),o=Ld(n,o,y,d,k);break e}else for(Q=Qn(o.stateNode.containerInfo.firstChild),K=o,re=!0,oe=null,d=Lt(o,null,y,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(We(),y===k){o=us(n,o,d);break e}pi(n,o,y,d)}o=o.child}return o;case 5:return Vu(o),n===null&&ve(o),y=o.type,k=o.pendingProps,C=n!==null?n.memoizedProps:null,Z=k.children,Bu(y,k)?Z=null:C!==null&&Bu(y,C)&&(o.flags|=32),zd(n,o),pi(n,o,Z,d),o.child;case 6:return n===null&&ve(o),null;case 13:return Qr(n,o,d);case 4:return So(o,o.stateNode.containerInfo),y=o.pendingProps,n===null?o.child=Qe(o,null,y,d):pi(n,o,y,d),o.child;case 11:return y=o.type,k=o.pendingProps,k=o.elementType===y?k:Ps(y,k),ru(n,o,y,k,d);case 7:return pi(n,o,o.pendingProps,d),o.child;case 8:return pi(n,o,o.pendingProps.children,d),o.child;case 12:return pi(n,o,o.pendingProps.children,d),o.child;case 10:e:{if(y=o.type._context,k=o.pendingProps,C=o.memoizedProps,Z=k.value,Fr(Tr,y._currentValue),y._currentValue=Z,C!==null)if(Wi(C.value,Z)){if(C.children===k.children&&!rr.current){o=us(n,o,d);break e}}else for(C=o.child,C!==null&&(C.return=o);C!==null;){var ae=C.dependencies;if(ae!==null){Z=C.child;for(var me=ae.firstContext;me!==null;){if(me.context===y){if(C.tag===1){me=An(-1,d&-d),me.tag=2;var Ce=C.updateQueue;if(Ce!==null){Ce=Ce.shared;var je=Ce.pending;je===null?me.next=me:(me.next=je.next,je.next=me),Ce.pending=me}}C.lanes|=d,me=C.alternate,me!==null&&(me.lanes|=d),Pr(C.return,d,o),ae.lanes|=d;break}me=me.next}}else if(C.tag===10)Z=C.type===o.type?null:C.child;else if(C.tag===18){if(Z=C.return,Z===null)throw Error(S(341));Z.lanes|=d,ae=Z.alternate,ae!==null&&(ae.lanes|=d),Pr(Z,d,o),Z=C.sibling}else Z=C.child;if(Z!==null)Z.return=C;else for(Z=C;Z!==null;){if(Z===o){Z=null;break}if(C=Z.sibling,C!==null){C.return=Z.return,Z=C;break}Z=Z.return}C=Z}pi(n,o,k.children,d),o=o.child}return o;case 9:return k=o.type,y=o.pendingProps.children,hi(o,d),k=Br(k),y=y(k),o.flags|=1,pi(n,o,y,d),o.child;case 14:return y=o.type,k=Ps(y,o.pendingProps),k=Ps(y.type,k),Cd(n,o,y,k,d);case 15:return Md(n,o,o.type,o.pendingProps,d);case 17:return y=o.type,k=o.pendingProps,k=o.elementType===y?k:Ps(y,k),Ju(n,o),o.tag=1,bi(y)?(n=!0,fn(o)):n=!1,hi(o,d),jh(o,y,k),gl(o,y,k,d),qh(null,o,y,!0,n,d);case 19:return Gh(n,o,d);case 22:return Ad(n,o,d)}throw Error(S(156,o.tag))};function td(n,o){return ci(n,o)}function Qd(n,o,d,y){this.tag=n,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bn(n,o,d,y){return new Qd(n,o,d,y)}function dc(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Mp(n){if(typeof n=="function")return dc(n)?1:0;if(n!=null){if(n=n.$$typeof,n===sr)return 11;if(n===Kr)return 14}return 2}function Na(n,o){var d=n.alternate;return d===null?(d=Bn(n.tag,o,n.key,n.mode),d.elementType=n.elementType,d.type=n.type,d.stateNode=n.stateNode,d.alternate=n,n.alternate=d):(d.pendingProps=o,d.type=n.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=n.flags&14680064,d.childLanes=n.childLanes,d.lanes=n.lanes,d.child=n.child,d.memoizedProps=n.memoizedProps,d.memoizedState=n.memoizedState,d.updateQueue=n.updateQueue,o=n.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=n.sibling,d.index=n.index,d.ref=n.ref,d}function pc(n,o,d,y,k,C){var Z=2;if(y=n,typeof n=="function")dc(n)&&(Z=1);else if(typeof n=="string")Z=5;else e:switch(n){case St:return Va(d.children,k,C,o);case At:Z=8,k|=8;break;case Zt:return n=Bn(12,d,o,k|2),n.elementType=Zt,n.lanes=C,n;case Vt:return n=Bn(13,d,o,k),n.elementType=Vt,n.lanes=C,n;case or:return n=Bn(19,d,o,k),n.elementType=or,n.lanes=C,n;case cr:return ja(d,k,C,o);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case nr:Z=10;break e;case It:Z=9;break e;case sr:Z=11;break e;case Kr:Z=14;break e;case Gr:Z=16,y=null;break e}throw Error(S(130,n==null?n:typeof n,""))}return o=Bn(Z,d,o,k),o.elementType=n,o.type=y,o.lanes=C,o}function Va(n,o,d,y){return n=Bn(7,n,y,o),n.lanes=d,n}function ja(n,o,d,y){return n=Bn(22,n,y,o),n.elementType=cr,n.lanes=d,n.stateNode={isHidden:!1},n}function Cs(n,o,d){return n=Bn(6,n,null,o),n.lanes=d,n}function Eo(n,o,d){return o=Bn(4,n.children!==null?n.children:[],n.key,o),o.lanes=d,o.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},o}function ep(n,o,d,y,k){this.tag=o,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=fr(0),this.expirationTimes=fr(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fr(0),this.identifierPrefix=y,this.onRecoverableError=k,this.mutableSourceEagerHydrationData=null}function fc(n,o,d,y,k,C,Z,ae,me){return n=new ep(n,o,d,ae,me),o===1?(o=1,C===!0&&(o|=8)):o=0,C=Bn(3,null,null,o),n.current=C,C.stateNode=n,C.memoizedState={element:y,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},bo(C),n}function Ap(n,o,d){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pt,key:y==null?null:""+y,children:n,containerInfo:o,implementation:d}}function tp(n){if(!n)return wo;n=n._reactInternals;e:{if(qt(n)!==n||n.tag!==1)throw Error(S(170));var o=n;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(bi(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(S(171))}if(n.tag===1){var d=n.type;if(bi(d))return Ta(n,d,o)}return o}function mc(n,o,d,y,k,C,Z,ae,me){return n=fc(d,y,!0,n,k,C,Z,ae,me),n.context=tp(null),d=n.current,y=xn(),k=Oa(d),C=An(y,k),C.callback=o??null,Es(d,C,k),n.current.lanes=k,Fo(n,k,y),Fn(n,y),n}function au(n,o,d,y){var k=o.current,C=xn(),Z=Oa(k);return d=tp(d),o.context===null?o.context=d:o.pendingContext=d,o=An(C,Z),o.payload={element:n},y=y===void 0?null:y,y!==null&&(o.callback=y),n=Es(k,o,Z),n!==null&&(Ys(n,k,Z,C),Ni(n,k,Z)),Z}function lh(n){return n=n.current,n.child?(n.child.tag===5,n.child.stateNode):null}function uh(n,o){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var d=n.retryLane;n.retryLane=d!==0&&d<o?d:o}}function gc(n,o){uh(n,o),(n=n.alternate)&&uh(n,o)}function lu(){return null}var rd=typeof reportError=="function"?reportError:function(n){console.error(n)};function ch(n){this._internalRoot=n}uu.prototype.render=ch.prototype.render=function(n){var o=this._internalRoot;if(o===null)throw Error(S(409));au(n,o,null,null)},uu.prototype.unmount=ch.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var o=n.containerInfo;Jo(function(){au(null,n,null,null)}),o[es]=null}};function uu(n){this._internalRoot=n}uu.prototype.unstable_scheduleHydration=function(n){if(n){var o=_u();n={blockedOn:null,target:n,priority:o};for(var d=0;d<Xn.length&&o!==0&&o<Xn[d].priority;d++);Xn.splice(d,0,n),d===0&&xu(n)}};function hh(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Sl(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function id(){}function zp(n,o,d,y,k){if(k){if(typeof y=="function"){var C=y;y=function(){var Ce=lh(Z);C.call(Ce)}}var Z=mc(o,y,n,0,null,!1,!1,"",id);return n._reactRootContainer=Z,n[es]=Z.current,$s(n.nodeType===8?n.parentNode:n),Jo(),Z}for(;k=n.lastChild;)n.removeChild(k);if(typeof y=="function"){var ae=y;y=function(){var Ce=lh(me);ae.call(Ce)}}var me=fc(n,0,!1,null,null,!1,!1,"",id);return n._reactRootContainer=me,n[es]=me.current,$s(n.nodeType===8?n.parentNode:n),Jo(function(){au(o,me,d,y)}),me}function dh(n,o,d,y,k){var C=d._reactRootContainer;if(C){var Z=C;if(typeof k=="function"){var ae=k;k=function(){var me=lh(Z);ae.call(me)}}au(o,Z,n,k)}else Z=zp(d,o,n,k,y);return lh(Z)}aa=function(n){switch(n.tag){case 3:var o=n.stateNode;if(o.current.memoizedState.isDehydrated){var d=Ro(o.pendingLanes);d!==0&&(lo(o,d|1),Fn(o,Ot()),(yr&6)===0&&($r=Ot()+500,f()))}break;case 13:Jo(function(){var y=Yi(n,1);if(y!==null){var k=xn();Ys(y,n,1,k)}}),gc(n,1)}},la=function(n){if(n.tag===13){var o=Yi(n,134217728);if(o!==null){var d=xn();Ys(o,n,134217728,d)}gc(n,134217728)}},Bo=function(n){if(n.tag===13){var o=Oa(n),d=Yi(n,o);if(d!==null){var y=xn();Ys(d,n,o,y)}gc(n,o)}},_u=function(){return xr},xc=function(n,o){var d=xr;try{return xr=n,o()}finally{xr=d}},Hn=function(n,o,d){switch(o){case"input":if(zs(n,d),o=d.name,d.type==="radio"&&o!=null){for(d=n;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<d.length;o++){var y=d[o];if(y!==n&&y.form===n.form){var k=cl(y);if(!k)throw Error(S(90));ms(y),zs(y,k)}}}break;case"textarea":Ao(n,d);break;case"select":o=d.value,o!=null&&ys(n,!!d.multiple,o,!1)}},W=oh,te=Jo;var rp={usingClientEntryPoint:!1,Events:[ul,ts,cl,j,V,oh]},yc={findFiberByHostInstance:Gs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Dp={bundleType:yc.bundleType,version:yc.version,rendererPackageName:yc.rendererPackageName,rendererConfig:yc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:rt.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=vr(n),n===null?null:n.stateNode},findFiberByHostInstance:yc.findFiberByHostInstance||lu,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ph=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ph.isDisabled&&ph.supportsFiber)try{Ci=ph.inject(Dp),Fi=ph}catch{}}return As.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rp,As.createPortal=function(n,o){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!hh(o))throw Error(S(200));return Ap(n,o,null,d)},As.createRoot=function(n,o){if(!hh(n))throw Error(S(299));var d=!1,y="",k=rd;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(y=o.identifierPrefix),o.onRecoverableError!==void 0&&(k=o.onRecoverableError)),o=fc(n,1,!1,null,null,d,!1,y,k),n[es]=o.current,$s(n.nodeType===8?n.parentNode:n),new ch(o)},As.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var o=n._reactInternals;if(o===void 0)throw typeof n.render=="function"?Error(S(188)):(n=Object.keys(n).join(","),Error(S(268,n)));return n=vr(o),n=n===null?null:n.stateNode,n},As.flushSync=function(n){return Jo(n)},As.hydrate=function(n,o,d){if(!Sl(o))throw Error(S(200));return dh(null,n,o,!0,d)},As.hydrateRoot=function(n,o,d){if(!hh(n))throw Error(S(405));var y=d!=null&&d.hydratedSources||null,k=!1,C="",Z=rd;if(d!=null&&(d.unstable_strictMode===!0&&(k=!0),d.identifierPrefix!==void 0&&(C=d.identifierPrefix),d.onRecoverableError!==void 0&&(Z=d.onRecoverableError)),o=mc(o,null,n,1,d??null,k,!1,C,Z),n[es]=o.current,$s(n),y)for(n=0;n<y.length;n++)d=y[n],k=d._getVersion,k=k(d._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[d,k]:o.mutableSourceEagerHydrationData.push(d,k);return new uu(o)},As.render=function(n,o,d){if(!Sl(o))throw Error(S(200));return dh(null,n,o,!1,d)},As.unmountComponentAtNode=function(n){if(!Sl(n))throw Error(S(40));return n._reactRootContainer?(Jo(function(){dh(null,null,n,!1,function(){n._reactRootContainer=null,n[es]=null})}),!0):!1},As.unstable_batchedUpdates=oh,As.unstable_renderSubtreeIntoContainer=function(n,o,d,y){if(!Sl(d))throw Error(S(200));if(n==null||n._reactInternals===void 0)throw Error(S(38));return dh(n,o,d,!1,y)},As.version="18.3.1-next-f1338f8080-20240426",As}var jf;function lg(){if(jf)return Wp.exports;jf=1;function P(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(P)}catch(b){console.error(b)}}return P(),Wp.exports=ag(),Wp.exports}var Uf;function ug(){if(Uf)return up;Uf=1;var P=lg();return up.createRoot=P.createRoot,up.hydrateRoot=P.hydrateRoot,up}var cg=ug();const hg=xp(cg);var dp={exports:{}};var dg=dp.exports,$f;function pg(){return $f||($f=1,(function(P,b){(function(S,z){P.exports=z()})(dg,(function(){var S={},z={};function F(I,h,Y){if(z[I]=Y,I==="index"){var J="var sharedModule = {}; ("+z.shared+")(sharedModule); ("+z.worker+")(sharedModule);",he={};return z.shared(he),z.index(S,he),typeof window<"u"&&S.setWorkerUrl(window.URL.createObjectURL(new Blob([J],{type:"text/javascript"}))),S}}F("shared",["exports"],(function(I){function h(r,t,i,a){return new(i||(i=Promise))((function(c,m){function g(E){try{x(a.next(E))}catch(A){m(A)}}function _(E){try{x(a.throw(E))}catch(A){m(A)}}function x(E){var A;E.done?c(E.value):(A=E.value,A instanceof i?A:new i((function(D){D(A)}))).then(g,_)}x((a=a.apply(r,t||[])).next())}))}function Y(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var J=he;function he(r,t){this.x=r,this.y=t}he.prototype={clone:function(){return new he(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,i=r.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),i=Math.sin(r),a=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=a,this},_rotateAround:function(r,t){var i=Math.cos(r),a=Math.sin(r),c=t.y+a*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-a*(this.y-t.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},he.convert=function(r){return r instanceof he?r:Array.isArray(r)?new he(r[0],r[1]):r};var N=Y(J),$=fe;function fe(r,t,i,a){this.cx=3*r,this.bx=3*(i-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=i,this.p2y=a}fe.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var i=r,a=0;a<8;a++){var c=this.sampleCurveX(i)-r;if(Math.abs(c)<t)return i;var m=this.sampleCurveDerivativeX(i);if(Math.abs(m)<1e-6)break;i-=c/m}var g=0,_=1;for(i=r,a=0;a<20&&(c=this.sampleCurveX(i),!(Math.abs(c-r)<t));a++)r>c?g=i:_=i,i=.5*(_-g)+g;return i},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Ae=Y($);let se,De;function Le(){return se==null&&(se=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),se}function tt(){if(De==null&&(De=!1,Le())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<25;a++){const c=4*a;t.fillStyle=`rgb(${c},${c+1},${c+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}const i=t.getImageData(0,0,5,5).data;for(let a=0;a<100;a++)if(a%4!=3&&i[a]!==a){De=!0;break}}}return De||!1}function Ge(r,t,i,a){const c=new Ae(r,t,i,a);return m=>c.solve(m)}const rt=Ge(.25,.1,.25,1);function mt(r,t,i){return Math.min(i,Math.max(t,r))}function pt(r,t,i){const a=i-t,c=((r-t)%a+a)%a+t;return c===t?i:c}function St(r,...t){for(const i of t)for(const a in i)r[a]=i[a];return r}let At=1;function Zt(r,t,i){const a={};for(const c in r)a[c]=t.call(this,r[c],c,r);return a}function nr(r,t,i){const a={};for(const c in r)t.call(this,r[c],c,r)&&(a[c]=r[c]);return a}function It(r){return Array.isArray(r)?r.map(It):typeof r=="object"&&r?Zt(r,It):r}const sr={};function Vt(r){sr[r]||(typeof console<"u"&&console.warn(r),sr[r]=!0)}function or(r,t,i){return(i.y-r.y)*(t.x-r.x)>(t.y-r.y)*(i.x-r.x)}function Kr(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let Gr=null;function cr(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function zt(r,t,i,a,c){return h(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(r,{timestamp:0});try{const g=m?.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const _=g.startsWith("BGR"),x=new Uint8ClampedArray(a*c*4);if(yield m.copyTo(x,(function(E,A,D,B,U){const G=4*Math.max(-A,0),X=(Math.max(0,D)-D)*B*4+G,ie=4*B,le=Math.max(0,A),Se=Math.max(0,D);return{rect:{x:le,y:Se,width:Math.min(E.width,A+B)-le,height:Math.min(E.height,D+U)-Se},layout:[{offset:X,stride:ie}]}})(r,t,i,a,c)),_)for(let E=0;E<x.length;E+=4){const A=x[E];x[E]=x[E+2],x[E+2]=A}return x}finally{m.close()}}))}let ht,be;const Oe="AbortError";function Gt(){return new Error(Oe)}const Ht={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Jt(r){return Ht.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const ar="global-dispatcher";class ir extends Error{constructor(t,i,a,c){super(`AJAXError: ${i} (${t}): ${a}`),this.status=t,this.statusText=i,this.url=a,this.body=c}}const tr=()=>Kr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Sr=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const a=Jt(r.url);if(a)return a(r,t);if(Kr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:ar},t)}if(!(/^file:/.test(i=r.url)||/^file:/.test(tr())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(a,c){return h(this,void 0,void 0,(function*(){const m=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:tr(),signal:c.signal});a.type!=="json"||m.headers.has("Accept")||m.headers.set("Accept","application/json");const g=yield fetch(m);if(!g.ok){const E=yield g.blob();throw new ir(g.status,g.statusText,a.url,E)}let _;_=a.type==="arrayBuffer"||a.type==="image"?g.arrayBuffer():a.type==="json"?g.json():g.text();const x=yield _;if(c.signal.aborted)throw Gt();return{data:x,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}}))})(r,t);if(Kr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:ar},t)}var i;return(function(a,c){return new Promise(((m,g)=>{var _;const x=new XMLHttpRequest;x.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(x.responseType="arraybuffer");for(const E in a.headers)x.setRequestHeader(E,a.headers[E]);a.type==="json"&&(x.responseType="text",!((_=a.headers)===null||_===void 0)&&_.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=a.credentials==="include",x.onerror=()=>{g(new Error(x.statusText))},x.onload=()=>{if(!c.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let E=x.response;if(a.type==="json")try{E=JSON.parse(x.response)}catch(A){return void g(A)}m({data:E,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const E=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});g(new ir(x.status,x.statusText,a.url,E))}},c.signal.addEventListener("abort",(()=>{x.abort(),g(Gt())})),x.send(a.body)}))})(r,t)};function li(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),i=window.location;return t.protocol===i.protocol&&t.host===i.host}function oo(r,t,i){i[r]&&i[r].indexOf(t)!==-1||(i[r]=i[r]||[],i[r].push(t))}function ms(r,t,i){if(i&&i[r]){const a=i[r].indexOf(t);a!==-1&&i[r].splice(a,1)}}class Zn{constructor(t,i={}){St(this,i),this.type=t}}class gs extends Zn{constructor(t,i={}){super("error",St({error:t},i))}}class Mo{on(t,i){return this._listeners=this._listeners||{},oo(t,i,this._listeners),this}off(t,i){return ms(t,i,this._listeners),ms(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},oo(t,i,this._oneTimeListeners),this):new Promise((a=>this.once(t,a)))}fire(t,i){typeof t=="string"&&(t=new Zn(t,i||{}));const a=t.type;if(this.listens(a)){t.target=this;const c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const _ of c)_.call(this,t);const m=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const _ of m)ms(a,_,this._oneTimeListeners),_.call(this,t);const g=this._eventedParent;g&&(St(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof gs&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var Pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const zs=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function na(r,t){const i={};for(const a in r)a!=="ref"&&(i[a]=r[a]);return zs.forEach((a=>{a in t&&(i[a]=t[a])})),i}function hr(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let i=0;i<r.length;i++)if(!hr(r[i],t[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const i in r)if(!hr(r[i],t[i]))return!1;return!0}return r===t}function Mr(r,t){r.push(t)}function ys(r,t,i){Mr(i,{command:"addSource",args:[r,t[r]]})}function _s(r,t,i){Mr(t,{command:"removeSource",args:[r]}),i[r]=!0}function vs(r,t,i,a){_s(r,i,a),ys(r,t,i)}function Ao(r,t,i){let a;for(a in r[i])if(Object.prototype.hasOwnProperty.call(r[i],a)&&a!=="data"&&!hr(r[i][a],t[i][a]))return!1;for(a in t[i])if(Object.prototype.hasOwnProperty.call(t[i],a)&&a!=="data"&&!hr(r[i][a],t[i][a]))return!1;return!0}function ln(r,t,i,a,c,m){r=r||{},t=t||{};for(const g in r)Object.prototype.hasOwnProperty.call(r,g)&&(hr(r[g],t[g])||i.push({command:m,args:[a,g,t[g],c]}));for(const g in t)Object.prototype.hasOwnProperty.call(t,g)&&!Object.prototype.hasOwnProperty.call(r,g)&&(hr(r[g],t[g])||i.push({command:m,args:[a,g,t[g],c]}))}function sa(r){return r.id}function zo(r,t){return r[t.id]=t,r}class $e{constructor(t,i,a,c){this.message=(t?`${t}: `:"")+a,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function Gn(r,...t){for(const i of t)for(const a in i)r[a]=i[a];return r}class ui extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}class $i{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[a,c]of i)this.bindings[a]=c}concat(t){return new $i(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ao={kind:"null"},Ke={kind:"number"},Wt={kind:"string"},Dt={kind:"boolean"},Ii={kind:"color"},un={kind:"object"},Bt={kind:"value"},kn={kind:"collator"},Hn={kind:"formatted"},cn={kind:"padding"},Li={kind:"resolvedImage"},ne={kind:"variableAnchorOffsetCollection"};function j(r,t){return{kind:"array",itemType:r,N:t}}function V(r){if(r.kind==="array"){const t=V(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const W=[ao,Ke,Wt,Dt,Ii,Hn,un,j(Bt),cn,Li,ne];function te(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!te(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const i of W)if(!te(i,t))return null}}return`Expected ${V(r)} but found ${V(t)} instead.`}function de(r,t){return t.some((i=>i.kind===r.kind))}function ye(r,t){return t.some((i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r))}function we(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const ue=.96422,Me=.82521,Be=4/29,Ee=6/29,He=3*Ee*Ee,gt=Ee*Ee*Ee,kt=Math.PI/180,dr=180/Math.PI;function jt(r){return(r%=360)<0&&(r+=360),r}function pr([r,t,i,a]){let c,m;const g=ei((.2225045*(r=qt(r))+.7168786*(t=qt(t))+.0606169*(i=qt(i)))/1);r===t&&t===i?c=m=g:(c=ei((.4360747*r+.3850649*t+.1430804*i)/ue),m=ei((.0139322*r+.0971045*t+.7141733*i)/Me));const _=116*g-16;return[_<0?0:_,500*(c-g),200*(g-m),a]}function qt(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function ei(r){return r>gt?Math.pow(r,1/3):r/He+Be}function jr([r,t,i,a]){let c=(r+16)/116,m=isNaN(t)?c:c+t/500,g=isNaN(i)?c:c-i/200;return c=1*vr(c),m=ue*vr(m),g=Me*vr(g),[Kt(3.1338561*m-1.6168667*c-.4906146*g),Kt(-.9787684*m+1.9161415*c+.033454*g),Kt(.0719453*m-.2289914*c+1.4052427*g),a]}function Kt(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function vr(r){return r>Ee?r*r*r:He*(r-Be)}function Rr(r){return parseInt(r.padEnd(2,r),16)/255}function ci(r,t){return gi(t?r/100:r,0,1)}function gi(r,t,i){return Math.min(Math.max(t,r),i)}function Ri(r){return!r.some(Number.isNaN)}const oa={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ot{constructor(t,i,a,c=1,m=!0){this.r=t,this.g=i,this.b=a,this.a=c,m||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[t,i,a,c]))}static parse(t){if(t instanceof Ot)return t;if(typeof t!="string")return;const i=(function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=oa[a];if(c){const[g,_,x]=c;return[g/255,_/255,x/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const g=a.length<6?1:2;let _=1;return[Rr(a.slice(_,_+=g)),Rr(a.slice(_,_+=g)),Rr(a.slice(_,_+=g)),Rr(a.slice(_,_+g)||"ff")]}if(a.startsWith("rgb")){const g=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,x,E,A,D,B,U,G,X,ie,le,Se]=g,pe=[A||" ",U||" ",ie].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){const xe=[E,B,X].join(""),ze=xe==="%%%"?100:xe===""?255:0;if(ze){const Ne=[gi(+x/ze,0,1),gi(+D/ze,0,1),gi(+G/ze,0,1),le?ci(+le,Se):1];if(Ri(Ne))return Ne}}return}}const m=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,_,x,E,A,D,B,U,G]=m,X=[x||" ",A||" ",B].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){const ie=[+_,gi(+E,0,100),gi(+D,0,100),U?ci(+U,G):1];if(Ri(ie))return(function([le,Se,pe,xe]){function ze(Ne){const ot=(Ne+le/30)%12,Mt=Se*Math.min(pe,1-pe);return pe-Mt*Math.max(-1,Math.min(ot-3,9-ot,1))}return le=jt(le),Se/=100,pe/=100,[ze(0),ze(8),ze(4),xe]})(ie)}}})(t);return i?new Ot(...i,!1):void 0}get rgb(){const{r:t,g:i,b:a,a:c}=this,m=c||1/0;return this.overwriteGetter("rgb",[t/m,i/m,a/m,c])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[i,a,c,m]=pr(t),g=Math.sqrt(a*a+c*c);return[Math.round(1e4*g)?jt(Math.atan2(c,a)*dr):NaN,g,i,m]})(this.rgb))}get lab(){return this.overwriteGetter("lab",pr(this.rgb))}overwriteGetter(t,i){return Object.defineProperty(this,t,{value:i}),i}toString(){const[t,i,a,c]=this.rgb;return`rgba(${[t,i,a].map((m=>Math.round(255*m))).join(",")},${c})`}}Ot.black=new Ot(0,0,0,1),Ot.white=new Ot(1,1,1,1),Ot.transparent=new Ot(0,0,0,0),Ot.red=new Ot(1,0,0,1);class gu{constructor(t,i,a){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Za{constructor(t,i,a,c,m){this.text=t,this.image=i,this.scale=a,this.fontStack=c,this.textColor=m}}class qi{constructor(t){this.sections=t}static fromString(t){return new qi([new Za(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof qi?t:qi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class Pi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Pi)return t;if(typeof t=="number")return new Pi([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const i of t)if(typeof i!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Pi(t)}}toString(){return JSON.stringify(this.values)}}const bh=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class hn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof hn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let i=0;i<t.length;i+=2){const a=t[i],c=t[i+1];if(typeof a!="string"||!bh.has(a)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new hn(t)}}toString(){return JSON.stringify(this.values)}}class Ci{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Ci({name:t,available:!1}):null}}function Fi(r,t,i,a){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,t,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,t,i,a]:[r,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Do(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Ot||r instanceof gu||r instanceof qi||r instanceof Pi||r instanceof hn||r instanceof Ci)return!0;if(Array.isArray(r)){for(const t of r)if(!Do(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!Do(r[t]))return!1;return!0}return!1}function kr(r){if(r===null)return ao;if(typeof r=="string")return Wt;if(typeof r=="boolean")return Dt;if(typeof r=="number")return Ke;if(r instanceof Ot)return Ii;if(r instanceof gu)return kn;if(r instanceof qi)return Hn;if(r instanceof Pi)return cn;if(r instanceof hn)return ne;if(r instanceof Ci)return Li;if(Array.isArray(r)){const t=r.length;let i;for(const a of r){const c=kr(a);if(i){if(i===c)continue;i=Bt;break}i=c}return j(i||Bt,t)}return un}function Ga(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof Ot||r instanceof qi||r instanceof Pi||r instanceof hn||r instanceof Ci?r.toString():JSON.stringify(r)}class Wn{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Do(t[1]))return i.error("invalid value");const a=t[1];let c=kr(a);const m=i.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new Wn(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ti{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Lo={string:Wt,number:Ke,boolean:Dt,object:un};class Zi{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a,c=1;const m=t[0];if(m==="array"){let _,x;if(t.length>2){const E=t[1];if(typeof E!="string"||!(E in Lo)||E==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);_=Lo[E],c++}else _=Bt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=t[2],c++}a=j(_,x)}else{if(!Lo[m])throw new Error(`Types doesn't contain name = ${m}`);a=Lo[m]}const g=[];for(;c<t.length;c++){const _=i.parse(t[c],c,Bt);if(!_)return null;g.push(_)}return new Zi(a,g)}evaluate(t){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(t);if(!te(this.type,kr(a)))return a;if(i===this.args.length-1)throw new ti(`Expected value to be of type ${V(this.type)}, but found ${V(kr(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Ro={"to-boolean":Dt,"to-color":Ii,"to-number":Ke,"to-string":Wt};class Gi{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const a=t[0];if(!Ro[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return i.error("Expected one argument.");const c=Ro[a],m=[];for(let g=1;g<t.length;g++){const _=i.parse(t[g],g,Bt);if(!_)return null;m.push(_)}return new Gi(c,m)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let i,a;for(const c of this.args){if(i=c.evaluate(t),a=null,i instanceof Ot)return i;if(typeof i=="string"){const m=t.parseColor(i);if(m)return m}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Fi(i[0],i[1],i[2],i[3]),!a))return new Ot(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new ti(a||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const a of this.args){i=a.evaluate(t);const c=Pi.parse(i);if(c)return c}throw new ti(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const a of this.args){i=a.evaluate(t);const c=hn.parse(i);if(c)return c}throw new ti(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const a of this.args){if(i=a.evaluate(t),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new ti(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return qi.fromString(Ga(this.args[0].evaluate(t)));case"resolvedImage":return Ci.fromString(Ga(this.args[0].evaluate(t)));default:return Ga(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Sh=["Unknown","Point","LineString","Polygon"];class Pl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Sh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let i=this._parseColorCache[t];return i||(i=this._parseColorCache[t]=Ot.parse(t)),i}}class Ds{constructor(t,i,a=[],c,m=new $i,g=[]){this.registry=t,this.path=a,this.key=a.map((_=>`[${_}]`)).join(""),this.scope=m,this.errors=g,this.expectedType=c,this._isConstant=i}parse(t,i,a,c,m={}){return i?this.concat(i,a,c)._parse(t,m):this._parse(t,m)}_parse(t,i){function a(c,m,g){return g==="assert"?new Zi(m,[c]):g==="coerce"?new Gi(m,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=t[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[c];if(m){let g=m.parse(t,this);if(!g)return null;if(this.expectedType){const _=this.expectedType,x=g.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||x.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(_.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(_,x))return null}else g=a(g,_,i.typeAnnotation||"coerce");else g=a(g,_,i.typeAnnotation||"coerce");else g=a(g,_,i.typeAnnotation||"coerce");else g=a(g,_,i.typeAnnotation||"assert")}if(!(g instanceof Wn)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const _=new Pl;try{g=new Wn(g.type,g.evaluate(_))}catch(x){return this.error(x.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,a){const c=typeof t=="number"?this.path.concat(t):this.path,m=a?this.scope.concat(a):this.scope;return new Ds(this.registry,this._isConstant,c,i||null,m,this.errors)}error(t,...i){const a=`${this.key}${i.map((c=>`[${c}]`)).join("")}`;this.errors.push(new ui(a,t))}checkSubtype(t,i){const a=te(t,i);return a&&this.error(a),a}}class Ls{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let m=1;m<t.length-1;m+=2){const g=t[m];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",m);const _=i.parse(t[m+1],m+1);if(!_)return null;a.push([g,_])}const c=i.parse(t[t.length-1],t.length-1,i.expectedType,a);return c?new Ls(a,c):null}outputDefined(){return this.result.outputDefined()}}class fr{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=t[1];return i.scope.has(a)?new fr(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Fo{constructor(t,i,a){this.type=t,this.index=i,this.input=a}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Ke),c=i.parse(t[2],2,j(i.expectedType||Bt));return a&&c?new Fo(c.type.itemType,a,c):null}evaluate(t){const i=this.index.evaluate(t),a=this.input.evaluate(t);if(i<0)throw new ti(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new ti(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new ti(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class yu{constructor(t,i){this.type=Dt,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Bt),c=i.parse(t[2],2,Bt);return a&&c?de(a.type,[Dt,Wt,Ke,ao,Bt])?new yu(a,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${V(a.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!ye(i,["boolean","string","number","null"]))throw new ti(`Expected first argument to be of type boolean, string, number or null, but found ${V(kr(i))} instead.`);if(!ye(a,["string","array"]))throw new ti(`Expected second argument to be of type array or string, but found ${V(kr(a))} instead.`);return a.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class lo{constructor(t,i,a){this.type=Ke,this.needle=t,this.haystack=i,this.fromIndex=a}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Bt),c=i.parse(t[2],2,Bt);if(!a||!c)return null;if(!de(a.type,[Dt,Wt,Ke,ao,Bt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${V(a.type)} instead`);if(t.length===4){const m=i.parse(t[3],3,Ke);return m?new lo(a,c,m):null}return new lo(a,c)}evaluate(t){const i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!ye(i,["boolean","string","number","null"]))throw new ti(`Expected first argument to be of type boolean, string, number or null, but found ${V(kr(i))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(t)),ye(a,["string"])){const m=a.indexOf(i,c);return m===-1?-1:[...a.slice(0,m)].length}if(ye(a,["array"]))return a.indexOf(i,c);throw new ti(`Expected second argument to be of type array or string, but found ${V(kr(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class xr{constructor(t,i,a,c,m,g){this.inputType=t,this.type=i,this.input=a,this.cases=c,this.outputs=m,this.otherwise=g}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let a,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const m={},g=[];for(let E=2;E<t.length-1;E+=2){let A=t[E];const D=t[E+1];Array.isArray(A)||(A=[A]);const B=i.concat(E);if(A.length===0)return B.error("Expected at least one branch label.");for(const G of A){if(typeof G!="number"&&typeof G!="string")return B.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return B.error("Numeric branch labels must be integer values.");if(a){if(B.checkSubtype(a,kr(G)))return null}else a=kr(G);if(m[String(G)]!==void 0)return B.error("Branch labels must be unique.");m[String(G)]=g.length}const U=i.parse(D,E,c);if(!U)return null;c=c||U.type,g.push(U)}const _=i.parse(t[1],1,Bt);if(!_)return null;const x=i.parse(t[t.length-1],t.length-1,c);return x?_.type.kind!=="value"&&i.concat(1).checkSubtype(a,_.type)?null:new xr(a,c,_,m,g,x):null}evaluate(t){const i=this.input.evaluate(t);return(kr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class Ha{constructor(t,i,a){this.type=t,this.branches=i,this.otherwise=a}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const c=[];for(let g=1;g<t.length-1;g+=2){const _=i.parse(t[g],g,Dt);if(!_)return null;const x=i.parse(t[g+1],g+1,a);if(!x)return null;c.push([_,x]),a=a||x.type}const m=i.parse(t[t.length-1],t.length-1,a);if(!m)return null;if(!a)throw new Error("Can't infer output type");return new Ha(a,c,m)}evaluate(t){for(const[i,a]of this.branches)if(i.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,a]of this.branches)t(i),t(a);t(this.otherwise)}outputDefined(){return this.branches.every((([t,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}}class aa{constructor(t,i,a,c){this.type=t,this.input=i,this.beginIndex=a,this.endIndex=c}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=i.parse(t[1],1,Bt),c=i.parse(t[2],2,Ke);if(!a||!c)return null;if(!de(a.type,[j(Bt),Wt,Bt]))return i.error(`Expected first argument to be of type array or string, but found ${V(a.type)} instead`);if(t.length===4){const m=i.parse(t[3],3,Ke);return m?new aa(a.type,a,c,m):null}return new aa(a.type,a,c)}evaluate(t){const i=this.input.evaluate(t),a=this.beginIndex.evaluate(t);let c;if(this.endIndex&&(c=this.endIndex.evaluate(t)),ye(i,["string"]))return[...i].slice(a,c).join("");if(ye(i,["array"]))return i.slice(a,c);throw new ti(`Expected first argument to be of type array or string, but found ${V(kr(i))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function la(r,t){const i=r.length-1;let a,c,m=0,g=i,_=0;for(;m<=g;)if(_=Math.floor((m+g)/2),a=r[_],c=r[_+1],a<=t){if(_===i||t<c)return _;m=_+1}else{if(!(a>t))throw new ti("Input is not a number.");g=_-1}return 0}class Bo{constructor(t,i,a){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[c,m]of a)this.labels.push(c),this.outputs.push(m)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(t[1],1,Ke);if(!a)return null;const c=[];let m=null;i.expectedType&&i.expectedType.kind!=="value"&&(m=i.expectedType);for(let g=1;g<t.length;g+=2){const _=g===1?-1/0:t[g],x=t[g+1],E=g,A=g+1;if(typeof _!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(c.length&&c[c.length-1][0]>=_)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const D=i.parse(x,A,m);if(!D)return null;m=m||D.type,c.push([_,D])}return new Bo(m,a,c)}evaluate(t){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);const c=this.input.evaluate(t);if(c<=i[0])return a[0].evaluate(t);const m=i.length;return c>=i[m-1]?a[m-1].evaluate(t):a[la(i,c)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function _u(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var xc=Cl;function Cl(r,t,i,a){this.cx=3*r,this.bx=3*(i-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=i,this.p2y=a}Cl.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var i=r,a=0;a<8;a++){var c=this.sampleCurveX(i)-r;if(Math.abs(c)<t)return i;var m=this.sampleCurveDerivativeX(i);if(Math.abs(m)<1e-6)break;i-=c/m}var g=0,_=1;for(i=r,a=0;a<20&&(c=this.sampleCurveX(i),!(Math.abs(c-r)<t));a++)r>c?g=i:_=i,i=.5*(_-g)+g;return i},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Ml=_u(xc);function Hi(r,t,i){return r+i*(t-r)}function Tn(r,t,i){return r.map(((a,c)=>Hi(a,t[c],i)))}const ri={number:Hi,color:function(r,t,i,a="rgb"){switch(a){case"rgb":{const[c,m,g,_]=Tn(r.rgb,t.rgb,i);return new Ot(c,m,g,_,!1)}case"hcl":{const[c,m,g,_]=r.hcl,[x,E,A,D]=t.hcl;let B,U;if(isNaN(c)||isNaN(x))isNaN(c)?isNaN(x)?B=NaN:(B=x,g!==1&&g!==0||(U=E)):(B=c,A!==1&&A!==0||(U=m));else{let Se=x-c;x>c&&Se>180?Se-=360:x<c&&c-x>180&&(Se+=360),B=c+i*Se}const[G,X,ie,le]=(function([Se,pe,xe,ze]){return Se=isNaN(Se)?0:Se*kt,jr([xe,Math.cos(Se)*pe,Math.sin(Se)*pe,ze])})([B,U??Hi(m,E,i),Hi(g,A,i),Hi(_,D,i)]);return new Ot(G,X,ie,le,!1)}case"lab":{const[c,m,g,_]=jr(Tn(r.lab,t.lab,i));return new Ot(c,m,g,_,!1)}}},array:Tn,padding:function(r,t,i){return new Pi(Tn(r.values,t.values,i))},variableAnchorOffsetCollection:function(r,t,i){const a=r.values,c=t.values;if(a.length!==c.length)throw new ti(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${t.toString()}`);const m=[];for(let g=0;g<a.length;g+=2){if(a[g]!==c[g])throw new ti(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${a[g]}, to[${g}]: ${c[g]}`);m.push(a[g]);const[_,x]=a[g+1],[E,A]=c[g+1];m.push([Hi(_,E,i),Hi(x,A,i)])}return new hn(m)}};class yi{constructor(t,i,a,c,m){this.type=t,this.operator=i,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[g,_]of m)this.labels.push(g),this.outputs.push(_)}static interpolationFactor(t,i,a,c){let m=0;if(t.name==="exponential")m=uo(i,t.base,a,c);else if(t.name==="linear")m=uo(i,1,a,c);else if(t.name==="cubic-bezier"){const g=t.controlPoints;m=new Ml(g[0],g[1],g[2],g[3]).solve(uo(i,1,a,c))}return m}static parse(t,i){let[a,c,m,...g]=t;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const E=c[1];if(typeof E!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:E}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const E=c.slice(1);if(E.length!==4||E.some((A=>typeof A!="number"||A<0||A>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:E}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(m=i.parse(m,2,Ke),!m)return null;const _=[];let x=null;a==="interpolate-hcl"||a==="interpolate-lab"?x=Ii:i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType);for(let E=0;E<g.length;E+=2){const A=g[E],D=g[E+1],B=E+3,U=E+4;if(typeof A!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(_.length&&_[_.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const G=i.parse(D,U,x);if(!G)return null;x=x||G.type,_.push([A,G])}return we(x,Ke)||we(x,Ii)||we(x,cn)||we(x,ne)||we(x,j(Ke))?new yi(x,a,c,m,_):i.error(`Type ${V(x)} is not interpolatable.`)}evaluate(t){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);const c=this.input.evaluate(t);if(c<=i[0])return a[0].evaluate(t);const m=i.length;if(c>=i[m-1])return a[m-1].evaluate(t);const g=la(i,c),_=yi.interpolationFactor(this.interpolation,c,i[g],i[g+1]),x=a[g].evaluate(t),E=a[g+1].evaluate(t);switch(this.operator){case"interpolate":return ri[this.type.kind](x,E,_);case"interpolate-hcl":return ri.color(x,E,_,"hcl");case"interpolate-lab":return ri.color(x,E,_,"lab")}}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function uo(r,t,i,a){const c=a-i,m=r-i;return c===0?0:t===1?m/c:(Math.pow(t,m)-1)/(Math.pow(t,c)-1)}class Xn{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let a=null;const c=i.expectedType;c&&c.kind!=="value"&&(a=c);const m=[];for(const _ of t.slice(1)){const x=i.parse(_,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!x)return null;a=a||x.type,m.push(x)}if(!a)throw new Error("No output type");const g=c&&m.some((_=>te(c,_.type)));return new Xn(g?Bt:a,m)}evaluate(t){let i,a=null,c=0;for(const m of this.args)if(c++,a=m.evaluate(t),a&&a instanceof Ci&&!a.available&&(i||(i=a.name),a=null,c===this.args.length&&(a=i)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Al(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function vu(r,t,i,a){return a.compare(t,i)===0}function xs(r,t,i){const a=r!=="=="&&r!=="!=";return class bm{constructor(m,g,_){this.type=Dt,this.lhs=m,this.rhs=g,this.collator=_,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const _=m[0];let x=g.parse(m[1],1,Bt);if(!x)return null;if(!Al(_,x.type))return g.concat(1).error(`"${_}" comparisons are not supported for type '${V(x.type)}'.`);let E=g.parse(m[2],2,Bt);if(!E)return null;if(!Al(_,E.type))return g.concat(2).error(`"${_}" comparisons are not supported for type '${V(E.type)}'.`);if(x.type.kind!==E.type.kind&&x.type.kind!=="value"&&E.type.kind!=="value")return g.error(`Cannot compare types '${V(x.type)}' and '${V(E.type)}'.`);a&&(x.type.kind==="value"&&E.type.kind!=="value"?x=new Zi(E.type,[x]):x.type.kind!=="value"&&E.type.kind==="value"&&(E=new Zi(x.type,[E])));let A=null;if(m.length===4){if(x.type.kind!=="string"&&E.type.kind!=="string"&&x.type.kind!=="value"&&E.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(A=g.parse(m[3],3,kn),!A)return null}return new bm(x,E,A)}evaluate(m){const g=this.lhs.evaluate(m),_=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){const x=kr(g),E=kr(_);if(x.kind!==E.kind||x.kind!=="string"&&x.kind!=="number")throw new ti(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${x.kind}, ${E.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const x=kr(g),E=kr(_);if(x.kind!=="string"||E.kind!=="string")return t(m,g,_)}return this.collator?i(m,g,_,this.collator.evaluate(m)):t(m,g,_)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const kh=xs("==",(function(r,t,i){return t===i}),vu),xu=xs("!=",(function(r,t,i){return t!==i}),(function(r,t,i,a){return!vu(0,t,i,a)})),Wa=xs("<",(function(r,t,i){return t<i}),(function(r,t,i,a){return a.compare(t,i)<0})),wc=xs(">",(function(r,t,i){return t>i}),(function(r,t,i,a){return a.compare(t,i)>0})),Th=xs("<=",(function(r,t,i){return t<=i}),(function(r,t,i,a){return a.compare(t,i)<=0})),ua=xs(">=",(function(r,t,i){return t>=i}),(function(r,t,i,a){return a.compare(t,i)>=0}));class Rs{constructor(t,i,a){this.type=kn,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const c=i.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Dt);if(!c)return null;const m=i.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Dt);if(!m)return null;let g=null;return a.locale&&(g=i.parse(a.locale,1,Wt),!g)?null:new Rs(c,m,g)}evaluate(t){return new gu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class co{constructor(t,i,a,c,m){this.type=Wt,this.number=t,this.locale=i,this.currency=a,this.minFractionDigits=c,this.maxFractionDigits=m}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const a=i.parse(t[1],1,Ke);if(!a)return null;const c=t[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=i.parse(c.locale,1,Wt),!m))return null;let g=null;if(c.currency&&(g=i.parse(c.currency,1,Wt),!g))return null;let _=null;if(c["min-fraction-digits"]&&(_=i.parse(c["min-fraction-digits"],1,Ke),!_))return null;let x=null;return c["max-fraction-digits"]&&(x=i.parse(c["max-fraction-digits"],1,Ke),!x)?null:new co(a,m,g,_,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Oo{constructor(t){this.type=Hn,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const c=[];let m=!1;for(let g=1;g<=t.length-1;++g){const _=t[g];if(m&&typeof _=="object"&&!Array.isArray(_)){m=!1;let x=null;if(_["font-scale"]&&(x=i.parse(_["font-scale"],1,Ke),!x))return null;let E=null;if(_["text-font"]&&(E=i.parse(_["text-font"],1,j(Wt)),!E))return null;let A=null;if(_["text-color"]&&(A=i.parse(_["text-color"],1,Ii),!A))return null;const D=c[c.length-1];D.scale=x,D.font=E,D.textColor=A}else{const x=i.parse(t[g],1,Bt);if(!x)return null;const E=x.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new Oo(c)}evaluate(t){return new qi(this.sections.map((i=>{const a=i.content.evaluate(t);return kr(a)===Li?new Za("",a,null,null,null):new Za(Ga(a),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)})))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}}class wu{constructor(t){this.type=Li,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");const a=i.parse(t[1],1,Wt);return a?new wu(a):i.error("No image name provided.")}evaluate(t){const i=this.input.evaluate(t),a=Ci.fromString(i);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(i)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class bu{constructor(t){this.type=Ke,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=i.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${V(a.type)} instead.`):new bu(a):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new ti(`Expected value to be of type string or array, but found ${V(kr(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const En=8192;function zl(r,t){const i=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(i*c*En),Math.round(a*c*En)]}function Xa(r,t){const i=Math.pow(2,t.z);return[(c=(r[0]/En+t.x)/i,360*c-180),(a=(r[1]/En+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,c}function ho(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function Bi(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function mr(r,t,i){const a=r[0]-t[0],c=r[1]-t[1],m=r[0]-i[0],g=r[1]-i[1];return a*g-m*c==0&&a*m<=0&&c*g<=0}function No(r,t,i,a){return(c=[a[0]-i[0],a[1]-i[1]])[0]*(m=[t[0]-r[0],t[1]-r[1]])[1]-c[1]*m[0]!=0&&!(!Vo(r,t,i,a)||!Vo(i,a,r,t));var c,m}function bc(r,t,i){for(const a of i)for(let c=0;c<a.length-1;++c)if(No(r,t,a[c],a[c+1]))return!0;return!1}function Fs(r,t,i=!1){let a=!1;for(const _ of t)for(let x=0;x<_.length-1;x++){if(mr(r,_[x],_[x+1]))return i;(m=_[x])[1]>(c=r)[1]!=(g=_[x+1])[1]>c[1]&&c[0]<(g[0]-m[0])*(c[1]-m[1])/(g[1]-m[1])+m[0]&&(a=!a)}var c,m,g;return a}function Dl(r,t){for(const i of t)if(Fs(r,i))return!0;return!1}function Su(r,t){for(const i of r)if(!Fs(i,t))return!1;for(let i=0;i<r.length-1;++i)if(bc(r[i],r[i+1],t))return!1;return!0}function dn(r,t){for(const i of t)if(Su(r,i))return!0;return!1}function Vo(r,t,i,a){const c=a[0]-i[0],m=a[1]-i[1],g=(r[0]-i[0])*m-c*(r[1]-i[1]),_=(t[0]-i[0])*m-c*(t[1]-i[1]);return g>0&&_<0||g<0&&_>0}function Ka(r,t,i){const a=[];for(let c=0;c<r.length;c++){const m=[];for(let g=0;g<r[c].length;g++){const _=zl(r[c][g],i);ho(t,_),m.push(_)}a.push(m)}return a}function ca(r,t,i){const a=[];for(let c=0;c<r.length;c++){const m=Ka(r[c],t,i);a.push(m)}return a}function Sc(r,t,i,a){if(r[0]<i[0]||r[0]>i[2]){const c=.5*a;let m=r[0]-i[0]>c?-a:i[0]-r[0]>c?a:0;m===0&&(m=r[0]-i[2]>c?-a:i[2]-r[0]>c?a:0),r[0]+=m}ho(t,r)}function Ll(r,t,i,a){const c=Math.pow(2,a.z)*En,m=[a.x*En,a.y*En],g=[];for(const _ of r)for(const x of _){const E=[x.x+m[0],x.y+m[1]];Sc(E,t,i,c),g.push(E)}return g}function Rl(r,t,i,a){const c=Math.pow(2,a.z)*En,m=[a.x*En,a.y*En],g=[];for(const x of r){const E=[];for(const A of x){const D=[A.x+m[0],A.y+m[1]];ho(t,D),E.push(D)}g.push(E)}if(t[2]-t[0]<=c/2){(_=t)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const x of g)for(const E of x)Sc(E,t,i,c)}var _;return g}class Kn{constructor(t,i){this.type=Dt,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Do(t[1])){const a=t[1];if(a.type==="FeatureCollection"){const c=[];for(const m of a.features){const{type:g,coordinates:_}=m.geometry;g==="Polygon"&&c.push(_),g==="MultiPolygon"&&c.push(..._)}if(c.length)return new Kn(a,{type:"MultiPolygon",coordinates:c})}else if(a.type==="Feature"){const c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Kn(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Kn(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(i,a){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(a.type==="Polygon"){const _=Ka(a.coordinates,m,g),x=Ll(i.geometry(),c,m,g);if(!Bi(c,m))return!1;for(const E of x)if(!Fs(E,_))return!1}if(a.type==="MultiPolygon"){const _=ca(a.coordinates,m,g),x=Ll(i.geometry(),c,m,g);if(!Bi(c,m))return!1;for(const E of x)if(!Dl(E,_))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(i,a){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(a.type==="Polygon"){const _=Ka(a.coordinates,m,g),x=Rl(i.geometry(),c,m,g);if(!Bi(c,m))return!1;for(const E of x)if(!Su(E,_))return!1}if(a.type==="MultiPolygon"){const _=ca(a.coordinates,m,g),x=Rl(i.geometry(),c,m,g);if(!Bi(c,m))return!1;for(const E of x)if(!dn(E,_))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ya=class{constructor(r=[],t=((i,a)=>i<a?-1:i>a?1:0)){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:i}=this,a=t[r];for(;r>0;){const c=r-1>>1,m=t[c];if(i(a,m)>=0)break;t[r]=m,r=c}t[r]=a}_down(r){const{data:t,compare:i}=this,a=this.length>>1,c=t[r];for(;r<a;){let m=1+(r<<1);const g=m+1;if(g<this.length&&i(t[g],t[m])<0&&(m=g),i(t[m],c)>=0)break;t[r]=t[m],r=m}t[r]=c}};function kc(r,t,i,a,c){Tc(r,t,i,a||r.length-1,c||Eh)}function Tc(r,t,i,a,c){for(;a>i;){if(a-i>600){var m=a-i+1,g=t-i+1,_=Math.log(m),x=.5*Math.exp(2*_/3),E=.5*Math.sqrt(_*x*(m-x)/m)*(g-m/2<0?-1:1);Tc(r,t,Math.max(i,Math.floor(t-g*x/m+E)),Math.min(a,Math.floor(t+(m-g)*x/m+E)),c)}var A=r[t],D=i,B=a;for(Ja(r,i,t),c(r[a],A)>0&&Ja(r,i,a);D<B;){for(Ja(r,D,B),D++,B--;c(r[D],A)<0;)D++;for(;c(r[B],A)>0;)B--}c(r[i],A)===0?Ja(r,i,B):Ja(r,++B,a),B<=t&&(i=B+1),t<=B&&(a=B-1)}}function Ja(r,t,i){var a=r[t];r[t]=r[i],r[i]=a}function Eh(r,t){return r<t?-1:r>t?1:0}function ha(r,t){if(r.length<=1)return[r];const i=[];let a,c;for(const m of r){const g=Ph(m);g!==0&&(m.area=Math.abs(g),c===void 0&&(c=g<0),c===g<0?(a&&i.push(a),a=[m]):a.push(m))}if(a&&i.push(a),t>1)for(let m=0;m<i.length;m++)i[m].length<=t||(kc(i[m],t,1,i[m].length-1,Ih),i[m]=i[m].slice(0,t));return i}function Ih(r,t){return t.area-r.area}function Ph(r){let t=0;for(let i,a,c=0,m=r.length,g=m-1;c<m;g=c++)i=r[c],a=r[g],t+=(a.x-i.x)*(i.y+a.y);return t}const Ec=1/298.257223563,Ic=Ec*(2-Ec),Pc=Math.PI/180;class Fl{constructor(t){const i=6378.137*Pc*1e3,a=Math.cos(t*Pc),c=1/(1-Ic*(1-a*a)),m=Math.sqrt(c);this.kx=i*m*a,this.ky=i*m*c*(1-Ic)}distance(t,i){const a=this.wrap(t[0]-i[0])*this.kx,c=(t[1]-i[1])*this.ky;return Math.sqrt(a*a+c*c)}pointOnLine(t,i){let a,c,m,g,_=1/0;for(let x=0;x<t.length-1;x++){let E=t[x][0],A=t[x][1],D=this.wrap(t[x+1][0]-E)*this.kx,B=(t[x+1][1]-A)*this.ky,U=0;D===0&&B===0||(U=(this.wrap(i[0]-E)*this.kx*D+(i[1]-A)*this.ky*B)/(D*D+B*B),U>1?(E=t[x+1][0],A=t[x+1][1]):U>0&&(E+=D/this.kx*U,A+=B/this.ky*U)),D=this.wrap(i[0]-E)*this.kx,B=(i[1]-A)*this.ky;const G=D*D+B*B;G<_&&(_=G,a=E,c=A,m=x,g=U)}return{point:[a,c],index:m,t:Math.max(0,Math.min(1,g))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Cc(r,t){return t[0]-r[0]}function Bl(r){return r[1]-r[0]+1}function Bs(r,t){return r[1]>=r[0]&&r[1]<t}function ku(r,t){if(r[0]>r[1])return[null,null];const i=Bl(r);if(t){if(i===2)return[r,null];const c=Math.floor(i/2);return[[r[0],r[0]+c],[r[0]+c,r[1]]]}if(i===1)return[r,null];const a=Math.floor(i/2)-1;return[[r[0],r[0]+a],[r[0]+a+1,r[1]]]}function Qa(r,t){if(!Bs(t,r.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)ho(i,r[a]);return i}function Tu(r){const t=[1/0,1/0,-1/0,-1/0];for(const i of r)for(const a of i)ho(t,a);return t}function Ol(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function Eu(r,t,i){if(!Ol(r)||!Ol(t))return NaN;let a=0,c=0;return r[2]<t[0]&&(a=t[0]-r[2]),r[0]>t[2]&&(a=r[0]-t[2]),r[1]>t[3]&&(c=r[1]-t[3]),r[3]<t[1]&&(c=t[1]-r[3]),i.distance([0,0],[a,c])}function po(r,t,i){const a=i.pointOnLine(t,r);return i.distance(r,a.point)}function Iu(r,t,i,a,c){const m=Math.min(po(r,[i,a],c),po(t,[i,a],c)),g=Math.min(po(i,[r,t],c),po(a,[r,t],c));return Math.min(m,g)}function Ch(r,t,i,a,c){if(!Bs(t,r.length)||!Bs(a,i.length))return 1/0;let m=1/0;for(let g=t[0];g<t[1];++g){const _=r[g],x=r[g+1];for(let E=a[0];E<a[1];++E){const A=i[E],D=i[E+1];if(No(_,x,A,D))return 0;m=Math.min(m,Iu(_,x,A,D,c))}}return m}function Yr(r,t,i,a,c){if(!Bs(t,r.length)||!Bs(a,i.length))return NaN;let m=1/0;for(let g=t[0];g<=t[1];++g)for(let _=a[0];_<=a[1];++_)if(m=Math.min(m,c.distance(r[g],i[_])),m===0)return m;return m}function Mh(r,t,i){if(Fs(r,t,!0))return 0;let a=1/0;for(const c of t){const m=c[0],g=c[c.length-1];if(m!==g&&(a=Math.min(a,po(r,[g,m],i)),a===0))return a;const _=i.pointOnLine(c,r);if(a=Math.min(a,i.distance(r,_.point)),a===0)return a}return a}function Qt(r,t,i,a){if(!Bs(t,r.length))return NaN;for(let m=t[0];m<=t[1];++m)if(Fs(r[m],i,!0))return 0;let c=1/0;for(let m=t[0];m<t[1];++m){const g=r[m],_=r[m+1];for(const x of i)for(let E=0,A=x.length,D=A-1;E<A;D=E++){const B=x[D],U=x[E];if(No(g,_,B,U))return 0;c=Math.min(c,Iu(g,_,B,U,a))}}return c}function Nl(r,t){for(const i of r)for(const a of i)if(Fs(a,t,!0))return!0;return!1}function Ar(r,t,i,a=1/0){const c=Tu(r),m=Tu(t);if(a!==1/0&&Eu(c,m,i)>=a)return a;if(Bi(c,m)){if(Nl(r,t))return 0}else if(Nl(t,r))return 0;let g=1/0;for(const _ of r)for(let x=0,E=_.length,A=E-1;x<E;A=x++){const D=_[A],B=_[x];for(const U of t)for(let G=0,X=U.length,ie=X-1;G<X;ie=G++){const le=U[ie],Se=U[G];if(No(D,B,le,Se))return 0;g=Math.min(g,Iu(D,B,le,Se,i))}}return g}function wr(r,t,i,a,c,m){if(!m)return;const g=Eu(Qa(a,m),c,i);g<t&&r.push([g,m,[0,0]])}function Yn(r,t,i,a,c,m,g){if(!m||!g)return;const _=Eu(Qa(a,m),Qa(c,g),i);_<t&&r.push([_,m,g])}function el(r,t,i,a,c=1/0){let m=Math.min(a.distance(r[0],i[0][0]),c);if(m===0)return m;const g=new Ya([[0,[0,r.length-1],[0,0]]],Cc),_=Tu(i);for(;g.length>0;){const x=g.pop();if(x[0]>=m)continue;const E=x[1],A=t?50:100;if(Bl(E)<=A){if(!Bs(E,r.length))return NaN;if(t){const D=Qt(r,E,i,a);if(isNaN(D)||D===0)return D;m=Math.min(m,D)}else for(let D=E[0];D<=E[1];++D){const B=Mh(r[D],i,a);if(m=Math.min(m,B),m===0)return 0}}else{const D=ku(E,t);wr(g,m,a,r,_,D[0]),wr(g,m,a,r,_,D[1])}}return m}function da(r,t,i,a,c,m=1/0){let g=Math.min(m,c.distance(r[0],i[0]));if(g===0)return g;const _=new Ya([[0,[0,r.length-1],[0,i.length-1]]],Cc);for(;_.length>0;){const x=_.pop();if(x[0]>=g)continue;const E=x[1],A=x[2],D=t?50:100,B=a?50:100;if(Bl(E)<=D&&Bl(A)<=B){if(!Bs(E,r.length)&&Bs(A,i.length))return NaN;let U;if(t&&a)U=Ch(r,E,i,A,c),g=Math.min(g,U);else if(t&&!a){const G=r.slice(E[0],E[1]+1);for(let X=A[0];X<=A[1];++X)if(U=po(i[X],G,c),g=Math.min(g,U),g===0)return g}else if(!t&&a){const G=i.slice(A[0],A[1]+1);for(let X=E[0];X<=E[1];++X)if(U=po(r[X],G,c),g=Math.min(g,U),g===0)return g}else U=Yr(r,E,i,A,c),g=Math.min(g,U)}else{const U=ku(E,t),G=ku(A,a);Yn(_,g,c,r,i,U[0],G[0]),Yn(_,g,c,r,i,U[0],G[1]),Yn(_,g,c,r,i,U[1],G[0]),Yn(_,g,c,r,i,U[1],G[1])}}return g}function Vl(r){return r.type==="MultiPolygon"?r.coordinates.map((t=>({type:"Polygon",coordinates:t}))):r.type==="MultiLineString"?r.coordinates.map((t=>({type:"LineString",coordinates:t}))):r.type==="MultiPoint"?r.coordinates.map((t=>({type:"Point",coordinates:t}))):[r]}class fo{constructor(t,i){this.type=Ke,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Do(t[1])){const a=t[1];if(a.type==="FeatureCollection")return new fo(a,a.features.map((c=>Vl(c.geometry))).flat());if(a.type==="Feature")return new fo(a,Vl(a.geometry));if("type"in a&&"coordinates"in a)return new fo(a,Vl(a))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(i,a){const c=i.geometry(),m=c.flat().map((x=>Xa([x.x,x.y],i.canonical)));if(c.length===0)return NaN;const g=new Fl(m[0][1]);let _=1/0;for(const x of a){switch(x.type){case"Point":_=Math.min(_,da(m,!1,[x.coordinates],!1,g,_));break;case"LineString":_=Math.min(_,da(m,!1,x.coordinates,!0,g,_));break;case"Polygon":_=Math.min(_,el(m,!1,x.coordinates,g,_))}if(_===0)return _}return _})(t,this.geometries);if(t.geometryType()==="LineString")return(function(i,a){const c=i.geometry(),m=c.flat().map((x=>Xa([x.x,x.y],i.canonical)));if(c.length===0)return NaN;const g=new Fl(m[0][1]);let _=1/0;for(const x of a){switch(x.type){case"Point":_=Math.min(_,da(m,!0,[x.coordinates],!1,g,_));break;case"LineString":_=Math.min(_,da(m,!0,x.coordinates,!0,g,_));break;case"Polygon":_=Math.min(_,el(m,!0,x.coordinates,g,_))}if(_===0)return _}return _})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(i,a){const c=i.geometry();if(c.length===0||c[0].length===0)return NaN;const m=ha(c,0).map((x=>x.map((E=>E.map((A=>Xa([A.x,A.y],i.canonical))))))),g=new Fl(m[0][0][0][1]);let _=1/0;for(const x of a)for(const E of m){switch(x.type){case"Point":_=Math.min(_,el([x.coordinates],!1,E,g,_));break;case"LineString":_=Math.min(_,el(x.coordinates,!0,E,g,_));break;case"Polygon":_=Math.min(_,Ar(E,x.coordinates,g,_))}if(_===0)return _}return _})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const jo={"==":kh,"!=":xu,">":wc,"<":Wa,">=":ua,"<=":Th,array:Zi,at:Fo,boolean:Zi,case:Ha,coalesce:Xn,collator:Rs,format:Oo,image:wu,in:yu,"index-of":lo,interpolate:yi,"interpolate-hcl":yi,"interpolate-lab":yi,length:bu,let:Ls,literal:Wn,match:xr,number:Zi,"number-format":co,object:Zi,slice:aa,step:Bo,string:Zi,"to-boolean":Gi,"to-color":Gi,"to-number":Gi,"to-string":Gi,var:fr,within:Kn,distance:fo};class pn{constructor(t,i,a,c){this.name=t,this.type=i,this._evaluate=a,this.args=c}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,i){const a=t[0],c=pn.definitions[a];if(!c)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=g.filter((([E])=>!Array.isArray(E)||E.length===t.length-1));let x=null;for(const[E,A]of _){x=new Ds(i.registry,pa,i.path,null,i.scope);const D=[];let B=!1;for(let U=1;U<t.length;U++){const G=t[U],X=Array.isArray(E)?E[U-1]:E.type,ie=x.parse(G,1+D.length,X);if(!ie){B=!0;break}D.push(ie)}if(!B)if(Array.isArray(E)&&E.length!==D.length)x.error(`Expected ${E.length} arguments, but found ${D.length} instead.`);else{for(let U=0;U<D.length;U++){const G=Array.isArray(E)?E[U]:E.type,X=D[U];x.concat(U+1).checkSubtype(G,X.type)}if(x.errors.length===0)return new pn(a,m,A,D)}}if(_.length===1)i.errors.push(...x.errors);else{const E=(_.length?_:g).map((([D])=>{return B=D,Array.isArray(B)?`(${B.map(V).join(", ")})`:`(${V(B.type)}...)`;var B})).join(" | "),A=[];for(let D=1;D<t.length;D++){const B=i.parse(t[D],1+A.length);if(!B)return null;A.push(V(B.type))}i.error(`Expected arguments of type ${E}, but found (${A.join(", ")}) instead.`)}return null}static register(t,i){pn.definitions=i;for(const a in i)t[a]=pn}}function mo(r,[t,i,a,c]){t=t.evaluate(r),i=i.evaluate(r),a=a.evaluate(r);const m=c?c.evaluate(r):1,g=Fi(t,i,a,m);if(g)throw new ti(g);return new Ot(t/255,i/255,a/255,m,!1)}function Pu(r,t){return r in t}function Cu(r,t){const i=t[r];return i===void 0?null:i}function Uo(r){return{type:r}}function pa(r){if(r instanceof fr)return pa(r.boundExpression);if(r instanceof pn&&r.name==="error"||r instanceof Rs||r instanceof Kn||r instanceof fo)return!1;const t=r instanceof Gi||r instanceof Zi;let i=!0;return r.eachChild((a=>{i=t?i&&pa(a):i&&a instanceof Wn})),!!i&&fa(r)&&Os(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function fa(r){if(r instanceof pn&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Kn||r instanceof fo)return!1;let t=!0;return r.eachChild((i=>{t&&!fa(i)&&(t=!1)})),t}function ws(r){if(r instanceof pn&&r.name==="feature-state")return!1;let t=!0;return r.eachChild((i=>{t&&!ws(i)&&(t=!1)})),t}function Os(r,t){if(r instanceof pn&&t.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild((a=>{i&&!Os(a,t)&&(i=!1)})),i}function jl(r){return{result:"success",value:r}}function Ns(r){return{result:"error",value:r}}function ma(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Mu(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function tl(r){return!!r.expression&&r.expression.interpolated}function lr(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function rl(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Mc(r){return r}function Au(r,t){const i=t.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",c=a||!(a||r.property!==void 0),m=r.type||(tl(t)?"exponential":"interval");if(i||t.type==="padding"){const A=i?Ot.parse:Pi.parse;(r=Gn({},r)).stops&&(r.stops=r.stops.map((D=>[D[0],A(D[1])]))),r.default=A(r.default?r.default:t.default)}if(r.colorSpace&&(g=r.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var g;let _,x,E;if(m==="exponential")_=zc;else if(m==="interval")_=Ul;else if(m==="categorical"){_=Ac,x=Object.create(null);for(const A of r.stops)x[A[0]]=A[1];E=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);_=Dc}if(a){const A={},D=[];for(let G=0;G<r.stops.length;G++){const X=r.stops[G],ie=X[0].zoom;A[ie]===void 0&&(A[ie]={zoom:ie,type:r.type,property:r.property,default:r.default,stops:[]},D.push(ie)),A[ie].stops.push([X[0].value,X[1]])}const B=[];for(const G of D)B.push([A[G].zoom,Au(A[G],t)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:yi.interpolationFactor.bind(void 0,U),zoomStops:B.map((G=>G[0])),evaluate:({zoom:G},X)=>zc({stops:B,base:r.base},t,G).evaluate(G,X)}}if(c){const A=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:yi.interpolationFactor.bind(void 0,A),zoomStops:r.stops.map((D=>D[0])),evaluate:({zoom:D})=>_(r,t,D,x,E)}}return{kind:"source",evaluate(A,D){const B=D&&D.properties?D.properties[r.property]:void 0;return B===void 0?ga(r.default,t.default):_(r,t,B,x,E)}}}function ga(r,t,i){return r!==void 0?r:t!==void 0?t:i!==void 0?i:void 0}function Ac(r,t,i,a,c){return ga(typeof i===c?a[i]:void 0,r.default,t.default)}function Ul(r,t,i){if(lr(i)!=="number")return ga(r.default,t.default);const a=r.stops.length;if(a===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[a-1][0])return r.stops[a-1][1];const c=la(r.stops.map((m=>m[0])),i);return r.stops[c][1]}function zc(r,t,i){const a=r.base!==void 0?r.base:1;if(lr(i)!=="number")return ga(r.default,t.default);const c=r.stops.length;if(c===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[c-1][0])return r.stops[c-1][1];const m=la(r.stops.map((A=>A[0])),i),g=(function(A,D,B,U){const G=U-B,X=A-B;return G===0?0:D===1?X/G:(Math.pow(D,X)-1)/(Math.pow(D,G)-1)})(i,a,r.stops[m][0],r.stops[m+1][0]),_=r.stops[m][1],x=r.stops[m+1][1],E=ri[t.type]||Mc;return typeof _.evaluate=="function"?{evaluate(...A){const D=_.evaluate.apply(void 0,A),B=x.evaluate.apply(void 0,A);if(D!==void 0&&B!==void 0)return E(D,B,g,r.colorSpace)}}:E(_,x,g,r.colorSpace)}function Dc(r,t,i){switch(t.type){case"color":i=Ot.parse(i);break;case"formatted":i=qi.fromString(i.toString());break;case"resolvedImage":i=Ci.fromString(i.toString());break;case"padding":i=Pi.parse(i);break;default:lr(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0)}return ga(i,r.default,t.default)}pn.register(jo,{error:[{kind:"error"},[Wt],(r,[t])=>{throw new ti(t.evaluate(r))}],typeof:[Wt,[Bt],(r,[t])=>V(kr(t.evaluate(r)))],"to-rgba":[j(Ke,4),[Ii],(r,[t])=>{const[i,a,c,m]=t.evaluate(r).rgb;return[255*i,255*a,255*c,m]}],rgb:[Ii,[Ke,Ke,Ke],mo],rgba:[Ii,[Ke,Ke,Ke,Ke],mo],has:{type:Dt,overloads:[[[Wt],(r,[t])=>Pu(t.evaluate(r),r.properties())],[[Wt,un],(r,[t,i])=>Pu(t.evaluate(r),i.evaluate(r))]]},get:{type:Bt,overloads:[[[Wt],(r,[t])=>Cu(t.evaluate(r),r.properties())],[[Wt,un],(r,[t,i])=>Cu(t.evaluate(r),i.evaluate(r))]]},"feature-state":[Bt,[Wt],(r,[t])=>Cu(t.evaluate(r),r.featureState||{})],properties:[un,[],r=>r.properties()],"geometry-type":[Wt,[],r=>r.geometryType()],id:[Bt,[],r=>r.id()],zoom:[Ke,[],r=>r.globals.zoom],"heatmap-density":[Ke,[],r=>r.globals.heatmapDensity||0],"line-progress":[Ke,[],r=>r.globals.lineProgress||0],accumulated:[Bt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Ke,Uo(Ke),(r,t)=>{let i=0;for(const a of t)i+=a.evaluate(r);return i}],"*":[Ke,Uo(Ke),(r,t)=>{let i=1;for(const a of t)i*=a.evaluate(r);return i}],"-":{type:Ke,overloads:[[[Ke,Ke],(r,[t,i])=>t.evaluate(r)-i.evaluate(r)],[[Ke],(r,[t])=>-t.evaluate(r)]]},"/":[Ke,[Ke,Ke],(r,[t,i])=>t.evaluate(r)/i.evaluate(r)],"%":[Ke,[Ke,Ke],(r,[t,i])=>t.evaluate(r)%i.evaluate(r)],ln2:[Ke,[],()=>Math.LN2],pi:[Ke,[],()=>Math.PI],e:[Ke,[],()=>Math.E],"^":[Ke,[Ke,Ke],(r,[t,i])=>Math.pow(t.evaluate(r),i.evaluate(r))],sqrt:[Ke,[Ke],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[Ke,[Ke],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[Ke,[Ke],(r,[t])=>Math.log(t.evaluate(r))],log2:[Ke,[Ke],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[Ke,[Ke],(r,[t])=>Math.sin(t.evaluate(r))],cos:[Ke,[Ke],(r,[t])=>Math.cos(t.evaluate(r))],tan:[Ke,[Ke],(r,[t])=>Math.tan(t.evaluate(r))],asin:[Ke,[Ke],(r,[t])=>Math.asin(t.evaluate(r))],acos:[Ke,[Ke],(r,[t])=>Math.acos(t.evaluate(r))],atan:[Ke,[Ke],(r,[t])=>Math.atan(t.evaluate(r))],min:[Ke,Uo(Ke),(r,t)=>Math.min(...t.map((i=>i.evaluate(r))))],max:[Ke,Uo(Ke),(r,t)=>Math.max(...t.map((i=>i.evaluate(r))))],abs:[Ke,[Ke],(r,[t])=>Math.abs(t.evaluate(r))],round:[Ke,[Ke],(r,[t])=>{const i=t.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ke,[Ke],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[Ke,[Ke],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[Dt,[Wt,Bt],(r,[t,i])=>r.properties()[t.value]===i.value],"filter-id-==":[Dt,[Bt],(r,[t])=>r.id()===t.value],"filter-type-==":[Dt,[Wt],(r,[t])=>r.geometryType()===t.value],"filter-<":[Dt,[Wt,Bt],(r,[t,i])=>{const a=r.properties()[t.value],c=i.value;return typeof a==typeof c&&a<c}],"filter-id-<":[Dt,[Bt],(r,[t])=>{const i=r.id(),a=t.value;return typeof i==typeof a&&i<a}],"filter->":[Dt,[Wt,Bt],(r,[t,i])=>{const a=r.properties()[t.value],c=i.value;return typeof a==typeof c&&a>c}],"filter-id->":[Dt,[Bt],(r,[t])=>{const i=r.id(),a=t.value;return typeof i==typeof a&&i>a}],"filter-<=":[Dt,[Wt,Bt],(r,[t,i])=>{const a=r.properties()[t.value],c=i.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[Dt,[Bt],(r,[t])=>{const i=r.id(),a=t.value;return typeof i==typeof a&&i<=a}],"filter->=":[Dt,[Wt,Bt],(r,[t,i])=>{const a=r.properties()[t.value],c=i.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[Dt,[Bt],(r,[t])=>{const i=r.id(),a=t.value;return typeof i==typeof a&&i>=a}],"filter-has":[Dt,[Bt],(r,[t])=>t.value in r.properties()],"filter-has-id":[Dt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Dt,[j(Wt)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[Dt,[j(Bt)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[Dt,[Wt,j(Bt)],(r,[t,i])=>i.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[Dt,[Wt,j(Bt)],(r,[t,i])=>(function(a,c,m,g){for(;m<=g;){const _=m+g>>1;if(c[_]===a)return!0;c[_]>a?g=_-1:m=_+1}return!1})(r.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Dt,overloads:[[[Dt,Dt],(r,[t,i])=>t.evaluate(r)&&i.evaluate(r)],[Uo(Dt),(r,t)=>{for(const i of t)if(!i.evaluate(r))return!1;return!0}]]},any:{type:Dt,overloads:[[[Dt,Dt],(r,[t,i])=>t.evaluate(r)||i.evaluate(r)],[Uo(Dt),(r,t)=>{for(const i of t)if(i.evaluate(r))return!0;return!1}]]},"!":[Dt,[Dt],(r,[t])=>!t.evaluate(r)],"is-supported-script":[Dt,[Wt],(r,[t])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(t.evaluate(r))}],upcase:[Wt,[Wt],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[Wt,[Wt],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[Wt,Uo(Bt),(r,t)=>t.map((i=>Ga(i.evaluate(r)))).join("")],"resolved-locale":[Wt,[kn],(r,[t])=>t.evaluate(r).resolvedLocale()]});class Wi{constructor(t,i){var a;this.expression=t,this._warningHistory={},this._evaluator=new Pl,this._defaultValue=i?(a=i).type==="color"&&rl(a.default)?new Ot(0,0,0,0):a.type==="color"?Ot.parse(a.default)||null:a.type==="padding"?Pi.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?hn.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,a,c,m,g){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(t,i,a,c,m,g){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new ti(`Expected value to be one of ${Object.keys(this._enumValues).map((x=>JSON.stringify(x))).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function go(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in jo}function $o(r,t){const i=new Ds(jo,pa,[],t?(function(c){const m={color:Ii,string:Wt,number:Ke,enum:Wt,boolean:Dt,formatted:Hn,padding:cn,resolvedImage:Li,variableAnchorOffsetCollection:ne};return c.type==="array"?j(m[c.value]||Bt,c.length):m[c.type]})(t):void 0),a=i.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?jl(new Wi(a,t)):Ns(i.errors)}class qo{constructor(t,i){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!ws(i.expression)}evaluateWithoutErrorHandling(t,i,a,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,c,m,g)}evaluate(t,i,a,c,m,g){return this._styleExpression.evaluate(t,i,a,c,m,g)}}class Zo{constructor(t,i,a,c){this.kind=t,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!ws(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,i,a,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,c,m,g)}evaluate(t,i,a,c,m,g){return this._styleExpression.evaluate(t,i,a,c,m,g)}interpolationFactor(t,i,a){return this.interpolationType?yi.interpolationFactor(this.interpolationType,t,i,a):0}}function $l(r,t){const i=$o(r,t);if(i.result==="error")return i;const a=i.value.expression,c=fa(a);if(!c&&!ma(t))return Ns([new ui("","data expressions not supported")]);const m=Os(a,["zoom"]);if(!m&&!Mu(t))return Ns([new ui("","zoom expressions not supported")]);const g=il(a);return g||m?g instanceof ui?Ns([g]):g instanceof yi&&!tl(t)?Ns([new ui("",'"interpolate" expressions cannot be used with this property')]):jl(g?new Zo(c?"camera":"composite",i.value,g.labels,g instanceof yi?g.interpolation:void 0):new qo(c?"constant":"source",i.value)):Ns([new ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class yo{constructor(t,i){this._parameters=t,this._specification=i,Gn(this,Au(this._parameters,this._specification))}static deserialize(t){return new yo(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function il(r){let t=null;if(r instanceof Ls)t=il(r.result);else if(r instanceof Xn){for(const i of r.args)if(t=il(i),t)break}else(r instanceof Bo||r instanceof yi)&&r.input instanceof pn&&r.input.name==="zoom"&&(t=r);return t instanceof ui||r.eachChild((i=>{const a=il(i);a instanceof ui?t=a:!t&&a?t=new ui("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new ui("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function ql(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!ql(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Vs={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function nl(r){if(r==null)return{filter:()=>!0,needGeometry:!1};ql(r)||(r=ol(r));const t=$o(r,Vs);if(t.result==="error")throw new Error(t.value.map((i=>`${i.key}: ${i.message}`)).join(", "));return{filter:(i,a,c)=>t.value.evaluate(i,a,{},c),needGeometry:Zl(r)}}function sl(r,t){return r<t?-1:r>t?1:0}function Zl(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(Zl(r[t]))return!0;return!1}function ol(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?ya(r[1],r[2],"=="):t==="!="?wi(ya(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?ya(r[1],r[2],t):t==="any"?(i=r.slice(1),["any"].concat(i.map(ol))):t==="all"?["all"].concat(r.slice(1).map(ol)):t==="none"?["all"].concat(r.slice(1).map(ol).map(wi)):t==="in"?bs(r[1],r.slice(2)):t==="!in"?wi(bs(r[1],r.slice(2))):t==="has"?Go(r[1]):t!=="!has"||wi(Go(r[1]));var i}function ya(r,t,i){switch(r){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,r,t]}}function bs(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((i=>typeof i!=typeof t[0]))?["filter-in-large",r,["literal",t.sort(sl)]]:["filter-in-small",r,["literal",t]]}}function Go(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function wi(r){return["!",r]}function Ss(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let c="[";for(const m of r)c+=`${Ss(m)},`;return`${c}]`}const i=Object.keys(r).sort();let a="{";for(let c=0;c<i.length;c++)a+=`${JSON.stringify(i[c])}:${Ss(r[i[c]])},`;return`${a}}`}function zu(r){let t="";for(const i of zs)t+=`/${Ss(r[i])}`;return t}function Du(r){const t=r.value;return t?[new $e(r.key,t,"constants have been deprecated as of v8")]:[]}function Hr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function In(r){if(Array.isArray(r))return r.map(In);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const i in r)t[i]=In(r[i]);return t}return Hr(r)}function Xi(r){const t=r.key,i=r.value,a=r.valueSpec||{},c=r.objectElementValidators||{},m=r.style,g=r.styleSpec,_=r.validateSpec;let x=[];const E=lr(i);if(E!=="object")return[new $e(t,i,`object expected, ${E} found`)];for(const A in i){const D=A.split(".")[0],B=a[D]||a["*"];let U;if(c[D])U=c[D];else if(a[D])U=_;else if(c["*"])U=c["*"];else{if(!a["*"]){x.push(new $e(t,i[A],`unknown property "${A}"`));continue}U=_}x=x.concat(U({key:(t&&`${t}.`)+A,value:i[A],valueSpec:B,style:m,styleSpec:g,object:i,objectKey:A,validateSpec:_},i))}for(const A in a)c[A]||a[A].required&&a[A].default===void 0&&i[A]===void 0&&x.push(new $e(t,i,`missing required property "${A}"`));return x}function _a(r){const t=r.value,i=r.valueSpec,a=r.style,c=r.styleSpec,m=r.key,g=r.arrayElementValidator||r.validateSpec;if(lr(t)!=="array")return[new $e(m,t,`array expected, ${lr(t)} found`)];if(i.length&&t.length!==i.length)return[new $e(m,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new $e(m,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let _={type:i.value,values:i.values};c.$version<7&&(_.function=i.function),lr(i.value)==="object"&&(_=i.value);let x=[];for(let E=0;E<t.length;E++)x=x.concat(g({array:t,arrayIndex:E,value:t[E],valueSpec:_,validateSpec:r.validateSpec,style:a,styleSpec:c,key:`${m}[${E}]`}));return x}function ks(r){const t=r.key,i=r.value,a=r.valueSpec;let c=lr(i);return c==="number"&&i!=i&&(c="NaN"),c!=="number"?[new $e(t,i,`number expected, ${c} found`)]:"minimum"in a&&i<a.minimum?[new $e(t,i,`${i} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&i>a.maximum?[new $e(t,i,`${i} is greater than the maximum value ${a.maximum}`)]:[]}function va(r){const t=r.valueSpec,i=Hr(r.value.type);let a,c,m,g={};const _=i!=="categorical"&&r.value.property===void 0,x=!_,E=lr(r.value.stops)==="array"&&lr(r.value.stops[0])==="array"&&lr(r.value.stops[0][0])==="object",A=Xi({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(U){if(i==="identity")return[new $e(U.key,U.value,'identity function may not have a "stops" property')];let G=[];const X=U.value;return G=G.concat(_a({key:U.key,value:X,valueSpec:U.valueSpec,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:D})),lr(X)==="array"&&X.length===0&&G.push(new $e(U.key,X,"array must have at least one stop")),G},default:function(U){return U.validateSpec({key:U.key,value:U.value,valueSpec:t,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec})}}});return i==="identity"&&_&&A.push(new $e(r.key,r.value,'missing required property "property"')),i==="identity"||r.value.stops||A.push(new $e(r.key,r.value,'missing required property "stops"')),i==="exponential"&&r.valueSpec.expression&&!tl(r.valueSpec)&&A.push(new $e(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(x&&!ma(r.valueSpec)?A.push(new $e(r.key,r.value,"property functions not supported")):_&&!Mu(r.valueSpec)&&A.push(new $e(r.key,r.value,"zoom functions not supported"))),i!=="categorical"&&!E||r.value.property!==void 0||A.push(new $e(r.key,r.value,'"property" property is required')),A;function D(U){let G=[];const X=U.value,ie=U.key;if(lr(X)!=="array")return[new $e(ie,X,`array expected, ${lr(X)} found`)];if(X.length!==2)return[new $e(ie,X,`array length 2 expected, length ${X.length} found`)];if(E){if(lr(X[0])!=="object")return[new $e(ie,X,`object expected, ${lr(X[0])} found`)];if(X[0].zoom===void 0)return[new $e(ie,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new $e(ie,X,"object stop key must have value")];if(m&&m>Hr(X[0].zoom))return[new $e(ie,X[0].zoom,"stop zoom values must appear in ascending order")];Hr(X[0].zoom)!==m&&(m=Hr(X[0].zoom),c=void 0,g={}),G=G.concat(Xi({key:`${ie}[0]`,value:X[0],valueSpec:{zoom:{}},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:ks,value:B}}))}else G=G.concat(B({key:`${ie}[0]`,value:X[0],validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec},X));return go(In(X[1]))?G.concat([new $e(`${ie}[1]`,X[1],"expressions are not allowed in function stops.")]):G.concat(U.validateSpec({key:`${ie}[1]`,value:X[1],valueSpec:t,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec}))}function B(U,G){const X=lr(U.value),ie=Hr(U.value),le=U.value!==null?U.value:G;if(a){if(X!==a)return[new $e(U.key,le,`${X} stop domain type must match previous stop domain type ${a}`)]}else a=X;if(X!=="number"&&X!=="string"&&X!=="boolean")return[new $e(U.key,le,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&i!=="categorical"){let Se=`number expected, ${X} found`;return ma(t)&&i===void 0&&(Se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $e(U.key,le,Se)]}return i!=="categorical"||X!=="number"||isFinite(ie)&&Math.floor(ie)===ie?i!=="categorical"&&X==="number"&&c!==void 0&&ie<c?[new $e(U.key,le,"stop domain values must appear in ascending order")]:(c=ie,i==="categorical"&&ie in g?[new $e(U.key,le,"stop domain values must be unique")]:(g[ie]=!0,[])):[new $e(U.key,le,`integer expected, found ${ie}`)]}}function _o(r){const t=(r.expressionContext==="property"?$l:$o)(In(r.value),r.valueSpec);if(t.result==="error")return t.value.map((a=>new $e(`${r.key}${a.key}`,r.value,a.message)));const i=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!i.outputDefined())return[new $e(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!ws(i))return[new $e(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!ws(i))return[new $e(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Os(i,["zoom","feature-state"]))return[new $e(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!fa(i))return[new $e(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function js(r){const t=r.key,i=r.value,a=r.valueSpec,c=[];return Array.isArray(a.values)?a.values.indexOf(Hr(i))===-1&&c.push(new $e(t,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(a.values).indexOf(Hr(i))===-1&&c.push(new $e(t,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),c}function Lu(r){return ql(In(r.value))?_o(Gn({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):vo(r)}function vo(r){const t=r.value,i=r.key;if(lr(t)!=="array")return[new $e(i,t,`array expected, ${lr(t)} found`)];const a=r.styleSpec;let c,m=[];if(t.length<1)return[new $e(i,t,"filter array must have at least 1 element")];switch(m=m.concat(js({key:`${i}[0]`,value:t[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),Hr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Hr(t[1])==="$type"&&m.push(new $e(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new $e(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=lr(t[1]),c!=="string"&&m.push(new $e(`${i}[1]`,t[1],`string expected, ${c} found`)));for(let g=2;g<t.length;g++)c=lr(t[g]),Hr(t[1])==="$type"?m=m.concat(js({key:`${i}[${g}]`,value:t[g],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&m.push(new $e(`${i}[${g}]`,t[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)m=m.concat(vo({key:`${i}[${g}]`,value:t[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=lr(t[1]),t.length!==2?m.push(new $e(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&m.push(new $e(`${i}[1]`,t[1],`string expected, ${c} found`))}return m}function Ru(r,t){const i=r.key,a=r.validateSpec,c=r.style,m=r.styleSpec,g=r.value,_=r.objectKey,x=m[`${t}_${r.layerType}`];if(!x)return[];const E=_.match(/^(.*)-transition$/);if(t==="paint"&&E&&x[E[1]]&&x[E[1]].transition)return a({key:i,value:g,valueSpec:m.transition,style:c,styleSpec:m});const A=r.valueSpec||x[_];if(!A)return[new $e(i,g,`unknown property "${_}"`)];let D;if(lr(g)==="string"&&ma(A)&&!A.tokens&&(D=/^{([^}]+)}$/.exec(g)))return[new $e(i,g,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(D[1])} }\`.`)];const B=[];return r.layerType==="symbol"&&(_==="text-field"&&c&&!c.glyphs&&B.push(new $e(i,g,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&rl(In(g))&&Hr(g.type)==="identity"&&B.push(new $e(i,g,'"text-font" does not support identity functions'))),B.concat(a({key:r.key,value:g,valueSpec:A,style:c,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:_}))}function al(r){return Ru(r,"paint")}function Gl(r){return Ru(r,"layout")}function zr(r){let t=[];const i=r.value,a=r.key,c=r.style,m=r.styleSpec;i.type||i.ref||t.push(new $e(a,i,'either "type" or "ref" is required'));let g=Hr(i.type);const _=Hr(i.ref);if(i.id){const x=Hr(i.id);for(let E=0;E<r.arrayIndex;E++){const A=c.layers[E];Hr(A.id)===x&&t.push(new $e(a,i.id,`duplicate layer id "${i.id}", previously used at line ${A.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach((E=>{E in i&&t.push(new $e(a,i[E],`"${E}" is prohibited for ref layers`))})),c.layers.forEach((E=>{Hr(E.id)===_&&(x=E)})),x?x.ref?t.push(new $e(a,i.ref,"ref cannot reference another ref layer")):g=Hr(x.type):t.push(new $e(a,i.ref,`ref layer "${_}" not found`))}else if(g!=="background")if(i.source){const x=c.sources&&c.sources[i.source],E=x&&Hr(x.type);x?E==="vector"&&g==="raster"?t.push(new $e(a,i.source,`layer "${i.id}" requires a raster source`)):E!=="raster-dem"&&g==="hillshade"?t.push(new $e(a,i.source,`layer "${i.id}" requires a raster-dem source`)):E==="raster"&&g!=="raster"?t.push(new $e(a,i.source,`layer "${i.id}" requires a vector source`)):E!=="vector"||i["source-layer"]?E==="raster-dem"&&g!=="hillshade"?t.push(new $e(a,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!i.paint||!i.paint["line-gradient"]||E==="geojson"&&x.lineMetrics||t.push(new $e(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new $e(a,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new $e(a,i.source,`source "${i.source}" not found`))}else t.push(new $e(a,i,'missing required property "source"'));return t=t.concat(Xi({key:a,value:i,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${a}.type`,value:i.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:i,objectKey:"type"}),filter:Lu,layout:x=>Xi({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":E=>Gl(Gn({layerType:g},E))}}),paint:x=>Xi({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":E=>al(Gn({layerType:g},E))}})}})),t}function Us(r){const t=r.value,i=r.key,a=lr(t);return a!=="string"?[new $e(i,t,`string expected, ${a} found`)]:[]}const Ho={promoteId:function({key:r,value:t}){if(lr(t)==="string")return Us({key:r,value:t});{const i=[];for(const a in t)i.push(...Us({key:`${r}.${a}`,value:t[a]}));return i}}};function $s(r){const t=r.value,i=r.key,a=r.styleSpec,c=r.style,m=r.validateSpec;if(!t.type)return[new $e(i,t,'"type" is required')];const g=Hr(t.type);let _;switch(g){case"vector":case"raster":return _=Xi({key:i,value:t,valueSpec:a[`source_${g.replace("-","_")}`],style:r.style,styleSpec:a,objectElementValidators:Ho,validateSpec:m}),_;case"raster-dem":return _=(function(x){var E;const A=(E=x.sourceName)!==null&&E!==void 0?E:"",D=x.value,B=x.styleSpec,U=B.source_raster_dem,G=x.style;let X=[];const ie=lr(D);if(D===void 0)return X;if(ie!=="object")return X.push(new $e("source_raster_dem",D,`object expected, ${ie} found`)),X;const le=Hr(D.encoding)==="custom",Se=["redFactor","greenFactor","blueFactor","baseShift"],pe=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const xe in D)!le&&Se.includes(xe)?X.push(new $e(xe,D[xe],`In "${A}": "${xe}" is only valid when "encoding" is set to "custom". ${pe} encoding found`)):U[xe]?X=X.concat(x.validateSpec({key:xe,value:D[xe],valueSpec:U[xe],validateSpec:x.validateSpec,style:G,styleSpec:B})):X.push(new $e(xe,D[xe],`unknown property "${xe}"`));return X})({sourceName:i,value:t,style:r.style,styleSpec:a,validateSpec:m}),_;case"geojson":if(_=Xi({key:i,value:t,valueSpec:a.source_geojson,style:c,styleSpec:a,validateSpec:m,objectElementValidators:Ho}),t.cluster)for(const x in t.clusterProperties){const[E,A]=t.clusterProperties[x],D=typeof E=="string"?[E,["accumulated"],["get",x]]:E;_.push(..._o({key:`${i}.${x}.map`,value:A,expressionContext:"cluster-map"})),_.push(..._o({key:`${i}.${x}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return _;case"video":return Xi({key:i,value:t,valueSpec:a.source_video,style:c,validateSpec:m,styleSpec:a});case"image":return Xi({key:i,value:t,valueSpec:a.source_image,style:c,validateSpec:m,styleSpec:a});case"canvas":return[new $e(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return js({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Hl(r){const t=r.value,i=r.styleSpec,a=i.light,c=r.style;let m=[];const g=lr(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new $e("light",t,`object expected, ${g} found`)]),m;for(const _ in t){const x=_.match(/^(.*)-transition$/);m=m.concat(x&&a[x[1]]&&a[x[1]].transition?r.validateSpec({key:_,value:t[_],valueSpec:i.transition,validateSpec:r.validateSpec,style:c,styleSpec:i}):a[_]?r.validateSpec({key:_,value:t[_],valueSpec:a[_],validateSpec:r.validateSpec,style:c,styleSpec:i}):[new $e(_,t[_],`unknown property "${_}"`)])}return m}function ll(r){const t=r.value,i=r.styleSpec,a=i.sky,c=r.style,m=lr(t);if(t===void 0)return[];if(m!=="object")return[new $e("sky",t,`object expected, ${m} found`)];let g=[];for(const _ in t)g=g.concat(a[_]?r.validateSpec({key:_,value:t[_],valueSpec:a[_],style:c,styleSpec:i}):[new $e(_,t[_],`unknown property "${_}"`)]);return g}function Wo(r){const t=r.value,i=r.styleSpec,a=i.terrain,c=r.style;let m=[];const g=lr(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new $e("terrain",t,`object expected, ${g} found`)]),m;for(const _ in t)m=m.concat(a[_]?r.validateSpec({key:_,value:t[_],valueSpec:a[_],validateSpec:r.validateSpec,style:c,styleSpec:i}):[new $e(_,t[_],`unknown property "${_}"`)]);return m}function xa(r){let t=[];const i=r.value,a=r.key;if(Array.isArray(i)){const c=[],m=[];for(const g in i)i[g].id&&c.includes(i[g].id)&&t.push(new $e(a,i,`all the sprites' ids must be unique, but ${i[g].id} is duplicated`)),c.push(i[g].id),i[g].url&&m.includes(i[g].url)&&t.push(new $e(a,i,`all the sprites' URLs must be unique, but ${i[g].url} is duplicated`)),m.push(i[g].url),t=t.concat(Xi({key:`${a}[${g}]`,value:i[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return Us({key:a,value:i})}const qs={"*":()=>[],array:_a,boolean:function(r){const t=r.value,i=r.key,a=lr(t);return a!=="boolean"?[new $e(i,t,`boolean expected, ${a} found`)]:[]},number:ks,color:function(r){const t=r.key,i=r.value,a=lr(i);return a!=="string"?[new $e(t,i,`color expected, ${a} found`)]:Ot.parse(String(i))?[]:[new $e(t,i,`color expected, "${i}" found`)]},constants:Du,enum:js,filter:Lu,function:va,layer:zr,object:Xi,source:$s,light:Hl,sky:ll,terrain:Wo,projection:function(r){const t=r.value,i=r.styleSpec,a=i.projection,c=r.style,m=lr(t);if(t===void 0)return[];if(m!=="object")return[new $e("projection",t,`object expected, ${m} found`)];let g=[];for(const _ in t)g=g.concat(a[_]?r.validateSpec({key:_,value:t[_],valueSpec:a[_],style:c,styleSpec:i}):[new $e(_,t[_],`unknown property "${_}"`)]);return g},string:Us,formatted:function(r){return Us(r).length===0?[]:_o(r)},resolvedImage:function(r){return Us(r).length===0?[]:_o(r)},padding:function(r){const t=r.key,i=r.value;if(lr(i)==="array"){if(i.length<1||i.length>4)return[new $e(t,i,`padding requires 1 to 4 values; ${i.length} values found`)];const a={type:"number"};let c=[];for(let m=0;m<i.length;m++)c=c.concat(r.validateSpec({key:`${t}[${m}]`,value:i[m],validateSpec:r.validateSpec,valueSpec:a}));return c}return ks({key:t,value:i,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const t=r.key,i=r.value,a=lr(i),c=r.styleSpec;if(a!=="array"||i.length<1||i.length%2!=0)return[new $e(t,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<i.length;g+=2)m=m.concat(js({key:`${t}[${g}]`,value:i[g],valueSpec:c.layout_symbol["text-anchor"]})),m=m.concat(_a({key:`${t}[${g+1}]`,value:i[g+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:c}));return m},sprite:xa};function wa(r){const t=r.value,i=r.valueSpec,a=r.styleSpec;return r.validateSpec=wa,i.expression&&rl(Hr(t))?va(r):i.expression&&go(In(t))?_o(r):i.type&&qs[i.type]?qs[i.type](r):Xi(Gn({},r,{valueSpec:i.type?a[i.type]:i}))}function Lc(r){const t=r.value,i=r.key,a=Us(r);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new $e(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new $e(i,t,'"glyphs" url must include a "{range}" token'))),a}function Pn(r,t=Pe){let i=[];return i=i.concat(wa({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:wa,objectElementValidators:{glyphs:Lc,"*":()=>[]}})),r.constants&&(i=i.concat(Du({key:"constants",value:r.constants}))),ba(i)}function Jn(r){return function(t){return r({...t,validateSpec:wa})}}function ba(r){return[].concat(r).sort(((t,i)=>t.line-i.line))}function Ki(r){return function(...t){return ba(r.apply(this,t))}}Pn.source=Ki(Jn($s)),Pn.sprite=Ki(Jn(xa)),Pn.glyphs=Ki(Jn(Lc)),Pn.light=Ki(Jn(Hl)),Pn.sky=Ki(Jn(ll)),Pn.terrain=Ki(Jn(Wo)),Pn.layer=Ki(Jn(zr)),Pn.filter=Ki(Jn(Lu)),Pn.paintProperty=Ki(Jn(al)),Pn.layoutProperty=Ki(Jn(Gl));const Zs=Pn,Fu=Zs.light,Bu=Zs.sky,Wl=Zs.paintProperty,Rc=Zs.layoutProperty;function Xl(r,t){let i=!1;if(t&&t.length)for(const a of t)r.fire(new gs(new Error(a.message))),i=!0;return i}class Sa{constructor(t,i,a){const c=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(i=g[1])+2*(a=g[2]);for(let x=0;x<this.d*this.d;x++){const E=g[3+x],A=g[3+x+1];c.push(E===A?null:g.subarray(E,A))}const _=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],_),this.bboxes=g.subarray(_),this.insert=this._insertReadonly}else{this.d=i+2*a;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=t,this.padding=a,this.scale=i/t,this.uid=0;const m=a/i*t;this.min=-m,this.max=t+m}insert(t,i,a,c,m){this._forEachCell(i,a,c,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,i,a,c,m,g){this.cells[m].push(g)}query(t,i,a,c,m){const g=this.min,_=this.max;if(t<=g&&i<=g&&_<=a&&_<=c&&!m)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,i,a,c,this._queryCell,x,{},m),x}}_queryCell(t,i,a,c,m,g,_,x){const E=this.cells[m];if(E!==null){const A=this.keys,D=this.bboxes;for(let B=0;B<E.length;B++){const U=E[B];if(_[U]===void 0){const G=4*U;(x?x(D[G+0],D[G+1],D[G+2],D[G+3]):t<=D[G+2]&&i<=D[G+3]&&a>=D[G+0]&&c>=D[G+1])?(_[U]=!0,g.push(A[U])):_[U]=!1}}}}_forEachCell(t,i,a,c,m,g,_,x){const E=this._convertToCellCoord(t),A=this._convertToCellCoord(i),D=this._convertToCellCoord(a),B=this._convertToCellCoord(c);for(let U=E;U<=D;U++)for(let G=A;G<=B;G++){const X=this.d*G+U;if((!x||x(this._convertFromCellCoord(U),this._convertFromCellCoord(G),this._convertFromCellCoord(U+1),this._convertFromCellCoord(G+1)))&&m.call(this,t,i,a,c,X,g,_,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,i=3+this.cells.length+1+1;let a=0;for(let g=0;g<this.cells.length;g++)a+=this.cells[g].length;const c=new Int32Array(i+a+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let m=i;for(let g=0;g<t.length;g++){const _=t[g];c[3+g]=m,c.set(_,m),m+=_.length}return c[3+t.length]=m,c.set(this.keys,m),m+=this.keys.length,c[3+t.length+1]=m,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer}static serialize(t,i){const a=t.toArrayBuffer();return i&&i.push(a),{buffer:a}}static deserialize(t){return new Sa(t.buffer)}}const Cn={};function at(r,t,i={}){if(Cn[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),Cn[r]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}at("Object",Object),at("TransferableGridIndex",Sa),at("Color",Ot),at("Error",Error),at("AJAXError",ir),at("ResolvedImage",Ci),at("StylePropertyFunction",yo),at("StyleExpression",Wi,{omit:["_evaluator"]}),at("ZoomDependentExpression",Zo),at("ZoomConstantExpression",qo),at("CompoundExpression",pn,{omit:["_evaluate"]});for(const r in jo)jo[r]._classRegistryKey||at(`Expression_${r}`,jo[r]);function Qn(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Kl(r){return r.$name||r.constructor._classRegistryKey}function Xo(r){return!(function(t){if(t===null||typeof t!="object")return!1;const i=Kl(t);return!(!i||i==="Object")})(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||Qn(r)||cr(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function Oi(r,t){if(Xo(r))return(Qn(r)||cr(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const m=[];for(const g of r)m.push(Oi(g,t));return m}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const i=Kl(r);if(!i)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!Cn[i])throw new Error(`${i} is not registered.`);const{klass:a}=Cn[i],c=a.serialize?a.serialize(r,t):{};if(a.serialize){if(t&&c===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in r){if(!r.hasOwnProperty(m)||Cn[i].omit.indexOf(m)>=0)continue;const g=r[m];c[m]=Cn[i].shallow.indexOf(m)>=0?g:Oi(g,t)}r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(c.$name=i),c}function Ts(r){if(Xo(r))return r;if(Array.isArray(r))return r.map(Ts);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=Kl(r)||"Object";if(!Cn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:i}=Cn[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(r);const a=Object.create(i.prototype);for(const c of Object.keys(r)){if(c==="$name")continue;const m=r[c];a[c]=Cn[t].shallow.indexOf(c)>=0?m:Ts(m)}return a}class es{constructor(){this.first=!0}update(t,i){const a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=i),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}const er={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Ou(r){for(const t of r)if(hl(t.charCodeAt(0)))return!0;return!1}function Ah(r){for(const t of r)if(!ts(t.charCodeAt(0)))return!1;return!0}function Gs(r){const t=r.map((i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}})).filter((i=>i));return new RegExp(t.join("|"),"u")}const ul=Gs(["Arab","Dupl","Mong","Ougr","Syrc"]);function ts(r){return!ul.test(String.fromCodePoint(r))}const cl=Gs(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function hl(r){return!(r!==746&&r!==747&&(r<4352||!(er["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||er["CJK Compatibility"](r)||er["CJK Strokes"](r)||!(!er["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||er["Enclosed CJK Letters and Months"](r)||er["Ideographic Description Characters"](r)||er.Kanbun(r)||er.Katakana(r)&&r!==12540||!(!er["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!er["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||er["Vertical Forms"](r)||er["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||cl.test(String.fromCodePoint(r)))))}function Ko(r){return!(hl(r)||(function(t){return!!(er["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||er["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||er["Letterlike Symbols"](t)||er["Number Forms"](t)||er["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||er["Control Pictures"](t)&&t!==9251||er["Optical Character Recognition"](t)||er["Enclosed Alphanumerics"](t)||er["Geometric Shapes"](t)||er["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||er["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||er["CJK Symbols and Punctuation"](t)||er.Katakana(t)||er["Private Use Area"](t)||er["CJK Compatibility Forms"](t)||er["Small Form Variants"](t)||er["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(r))}const xo=Gs(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Dr(r){return xo.test(String.fromCodePoint(r))}function Fr(r,t){return!(!t&&Dr(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||er.Khmer(r))}function wo(r){for(const t of r)if(Dr(t.charCodeAt(0)))return!0;return!1}const Er=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class rr{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new es,this.transition={})}isSupportedScript(t){return(function(i,a){for(const c of i)if(!Fr(c.charCodeAt(0),a))return!1;return!0})(t,Er.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,i=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*i}}}class Mn{constructor(t,i){this.property=t,this.value=i,this.expression=(function(a,c){if(rl(a))return new yo(a,c);if(go(a)){const m=$l(a,c);if(m.result==="error")throw new Error(m.value.map((g=>`${g.key}: ${g.message}`)).join(", "));return m.value}{let m=a;return c.type==="color"&&typeof a=="string"?m=Ot.parse(a):c.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(m=hn.parse(a)):m=Pi.parse(a),{kind:"constant",evaluate:()=>m}}})(i===void 0?t.specification.default:i,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,a){return this.property.possiblyEvaluate(this,t,i,a)}}class Hs{constructor(t){this.property=t,this.value=new Mn(t,void 0)}transitioned(t,i){return new dl(this.property,this.value,i,St({},t.transition,this.transition),t.now)}untransitioned(){return new dl(this.property,this.value,null,{},0)}}class bi{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return It(this._values[t].value.value)}setValue(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Hs(this._values[t].property)),this._values[t].value=new Mn(this._values[t].property,i===null?void 0:It(i))}getTransition(t){return It(this._values[t].transition)}setTransition(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Hs(this._values[t].property)),this._values[t].transition=It(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(t[i]=a);const c=this.getTransition(i);c!==void 0&&(t[`${i}-transition`]=c)}return t}transitioned(t,i){const a=new ka(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(t,i._values[c]);return a}untransitioned(){const t=new ka(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class dl{constructor(t,i,a,c,m){this.property=t,this.value=i,this.begin=m+c.delay||0,this.end=this.begin+c.duration||0,t.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(t,i,a){const c=t.now||0,m=this.value.possiblyEvaluate(t,i,a),g=this.prior;if(g){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return g.possiblyEvaluate(t,i,a);{const _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,i,a),m,(function(x){if(x<=0)return 0;if(x>=1)return 1;const E=x*x,A=E*x;return 4*(x<.5?A:3*(x-E)+A-.75)})(_))}}return m}}class ka{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,a){const c=new Ea(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,i,a);return c}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Ta{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return It(this._values[t].value)}setValue(t,i){this._values[t]=new Mn(this._values[t].property,i===null?void 0:It(i))}serialize(){const t={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(t[i]=a)}return t}possiblyEvaluate(t,i,a){const c=new Ea(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,i,a);return c}}class fn{constructor(t,i,a){this.property=t,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,a,c){return this.property.evaluate(this.value,this.parameters,t,i,a,c)}}class Ea{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class lt{constructor(t){this.specification=t}possiblyEvaluate(t,i){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(i)}interpolate(t,i,a){const c=ri[this.specification.type];return c?c(t,i,a):t}}class Et{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,a,c){return new fn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},a,c)}:t.expression,i)}interpolate(t,i,a){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new fn(this,{kind:"constant",value:void 0},t.parameters);const c=ri[this.specification.type];if(c){const m=c(t.value.value,i.value.value,a);return new fn(this,{kind:"constant",value:m},t.parameters)}return t}evaluate(t,i,a,c,m,g){return t.kind==="constant"?t.value:t.evaluate(i,a,c,m,g)}}class Ia extends Et{possiblyEvaluate(t,i,a,c){if(t.value===void 0)return new fn(this,{kind:"constant",value:void 0},i);if(t.expression.kind==="constant"){const m=t.expression.evaluate(i,null,{},a,c),g=t.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,_=this._calculate(g,g,g,i);return new fn(this,{kind:"constant",value:_},i)}if(t.expression.kind==="camera"){const m=this._calculate(t.expression.evaluate({zoom:i.zoom-1}),t.expression.evaluate({zoom:i.zoom}),t.expression.evaluate({zoom:i.zoom+1}),i);return new fn(this,{kind:"constant",value:m},i)}return new fn(this,t.expression,i)}evaluate(t,i,a,c,m,g){if(t.kind==="source"){const _=t.evaluate(i,a,c,m,g);return this._calculate(_,_,_,i)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(i.zoom)-1},a,c),t.evaluate({zoom:Math.floor(i.zoom)},a,c),t.evaluate({zoom:Math.floor(i.zoom)+1},a,c),i):t.value}_calculate(t,i,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:a,to:i}}interpolate(t){return t}}class pl{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,c){if(t.value!==void 0){if(t.expression.kind==="constant"){const m=t.expression.evaluate(i,null,{},a,c);return this._calculate(m,m,m,i)}return this._calculate(t.expression.evaluate(new rr(Math.floor(i.zoom-1),i)),t.expression.evaluate(new rr(Math.floor(i.zoom),i)),t.expression.evaluate(new rr(Math.floor(i.zoom+1),i)),i)}}_calculate(t,i,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:a,to:i}}interpolate(t){return t}}class Nu{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,c){return!!t.expression.evaluate(i,null,{},a,c)}interpolate(){return!1}}class f{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in t){const a=t[i];a.specification.overridable&&this.overridableProperties.push(i);const c=this.defaultPropertyValues[i]=new Mn(a,void 0),m=this.defaultTransitionablePropertyValues[i]=new Hs(a);this.defaultTransitioningPropertyValues[i]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=c.possiblyEvaluate({})}}}at("DataDrivenProperty",Et),at("DataConstantProperty",lt),at("CrossFadedDataDrivenProperty",Ia),at("CrossFadedProperty",pl),at("ColorRampProperty",Nu);const e="-transition";class s extends Mo{constructor(t,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),i.layout&&(this._unevaluatedLayout=new Ta(i.layout)),i.paint)){this._transitionablePaint=new bi(i.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ea(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i,a={}){i!=null&&this._validate(Rc,`layers.${this.id}.layout.${t}`,t,i,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,a={}){if(i!=null&&this._validate(Wl,`layers.${this.id}.paint.${t}`,t,i,a))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),i||void 0),!1;{const c=this._transitionablePaint._values[t],m=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),_=c.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(t,_,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,i,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),nr(t,((i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length)))}_validate(t,i,a,c,m={}){return(!m||m.validate!==!1)&&Xl(this,t.call(Zs,{key:i,layerType:this.type,objectKey:a,value:c,styleSpec:Pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof fn&&ma(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}const l={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class u{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class p{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function v(r,t=1){let i=0,a=0;return{members:r.map((c=>{const m=l[c.type].BYTES_PER_ELEMENT,g=i=w(i,Math.max(t,m)),_=c.components||1;return a=Math.max(a,m),i+=m*_,{name:c.name,type:c.type,components:_,offset:g}})),size:w(i,Math.max(a,t)),alignment:t}}function w(r,t){return Math.ceil(r/t)*t}class T extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const c=2*t;return this.int16[c+0]=i,this.int16[c+1]=a,t}}T.prototype.bytesPerElement=4,at("StructArrayLayout2i4",T);class M extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,a)}emplace(t,i,a,c){const m=3*t;return this.int16[m+0]=i,this.int16[m+1]=a,this.int16[m+2]=c,t}}M.prototype.bytesPerElement=6,at("StructArrayLayout3i6",M);class L extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,i,a,c)}emplace(t,i,a,c,m){const g=4*t;return this.int16[g+0]=i,this.int16[g+1]=a,this.int16[g+2]=c,this.int16[g+3]=m,t}}L.prototype.bytesPerElement=8,at("StructArrayLayout4i8",L);class R extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,i,a,c,m,g)}emplace(t,i,a,c,m,g,_){const x=6*t;return this.int16[x+0]=i,this.int16[x+1]=a,this.int16[x+2]=c,this.int16[x+3]=m,this.int16[x+4]=g,this.int16[x+5]=_,t}}R.prototype.bytesPerElement=12,at("StructArrayLayout2i4i12",R);class q extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,i,a,c,m,g)}emplace(t,i,a,c,m,g,_){const x=4*t,E=8*t;return this.int16[x+0]=i,this.int16[x+1]=a,this.uint8[E+4]=c,this.uint8[E+5]=m,this.uint8[E+6]=g,this.uint8[E+7]=_,t}}q.prototype.bytesPerElement=8,at("StructArrayLayout2i4ub8",q);class H extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const c=2*t;return this.float32[c+0]=i,this.float32[c+1]=a,t}}H.prototype.bytesPerElement=8,at("StructArrayLayout2f8",H);class K extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,m,g,_,x,E,A){const D=this.length;return this.resize(D+1),this.emplace(D,t,i,a,c,m,g,_,x,E,A)}emplace(t,i,a,c,m,g,_,x,E,A,D){const B=10*t;return this.uint16[B+0]=i,this.uint16[B+1]=a,this.uint16[B+2]=c,this.uint16[B+3]=m,this.uint16[B+4]=g,this.uint16[B+5]=_,this.uint16[B+6]=x,this.uint16[B+7]=E,this.uint16[B+8]=A,this.uint16[B+9]=D,t}}K.prototype.bytesPerElement=20,at("StructArrayLayout10ui20",K);class Q extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,m,g,_,x,E,A,D,B){const U=this.length;return this.resize(U+1),this.emplace(U,t,i,a,c,m,g,_,x,E,A,D,B)}emplace(t,i,a,c,m,g,_,x,E,A,D,B,U){const G=12*t;return this.int16[G+0]=i,this.int16[G+1]=a,this.int16[G+2]=c,this.int16[G+3]=m,this.uint16[G+4]=g,this.uint16[G+5]=_,this.uint16[G+6]=x,this.uint16[G+7]=E,this.int16[G+8]=A,this.int16[G+9]=D,this.int16[G+10]=B,this.int16[G+11]=U,t}}Q.prototype.bytesPerElement=24,at("StructArrayLayout4i4ui4i24",Q);class re extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,a)}emplace(t,i,a,c){const m=3*t;return this.float32[m+0]=i,this.float32[m+1]=a,this.float32[m+2]=c,t}}re.prototype.bytesPerElement=12,at("StructArrayLayout3f12",re);class oe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}oe.prototype.bytesPerElement=4,at("StructArrayLayout1ul4",oe);class ce extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,m,g,_,x,E){const A=this.length;return this.resize(A+1),this.emplace(A,t,i,a,c,m,g,_,x,E)}emplace(t,i,a,c,m,g,_,x,E,A){const D=10*t,B=5*t;return this.int16[D+0]=i,this.int16[D+1]=a,this.int16[D+2]=c,this.int16[D+3]=m,this.int16[D+4]=g,this.int16[D+5]=_,this.uint32[B+3]=x,this.uint16[D+8]=E,this.uint16[D+9]=A,t}}ce.prototype.bytesPerElement=20,at("StructArrayLayout6i1ul2ui20",ce);class ee extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,i,a,c,m,g)}emplace(t,i,a,c,m,g,_){const x=6*t;return this.int16[x+0]=i,this.int16[x+1]=a,this.int16[x+2]=c,this.int16[x+3]=m,this.int16[x+4]=g,this.int16[x+5]=_,t}}ee.prototype.bytesPerElement=12,at("StructArrayLayout2i2i2i12",ee);class ge extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,a,c,m)}emplace(t,i,a,c,m,g){const _=4*t,x=8*t;return this.float32[_+0]=i,this.float32[_+1]=a,this.float32[_+2]=c,this.int16[x+6]=m,this.int16[x+7]=g,t}}ge.prototype.bytesPerElement=16,at("StructArrayLayout2f1f2i16",ge);class ve extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,c,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,i,a,c,m,g)}emplace(t,i,a,c,m,g,_){const x=16*t,E=4*t,A=8*t;return this.uint8[x+0]=i,this.uint8[x+1]=a,this.float32[E+1]=c,this.float32[E+2]=m,this.int16[A+6]=g,this.int16[A+7]=_,t}}ve.prototype.bytesPerElement=16,at("StructArrayLayout2ub2f2i16",ve);class ke extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,a)}emplace(t,i,a,c){const m=3*t;return this.uint16[m+0]=i,this.uint16[m+1]=a,this.uint16[m+2]=c,t}}ke.prototype.bytesPerElement=6,at("StructArrayLayout3ui6",ke);class Fe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,c,m,g,_,x,E,A,D,B,U,G,X,ie,le){const Se=this.length;return this.resize(Se+1),this.emplace(Se,t,i,a,c,m,g,_,x,E,A,D,B,U,G,X,ie,le)}emplace(t,i,a,c,m,g,_,x,E,A,D,B,U,G,X,ie,le,Se){const pe=24*t,xe=12*t,ze=48*t;return this.int16[pe+0]=i,this.int16[pe+1]=a,this.uint16[pe+2]=c,this.uint16[pe+3]=m,this.uint32[xe+2]=g,this.uint32[xe+3]=_,this.uint32[xe+4]=x,this.uint16[pe+10]=E,this.uint16[pe+11]=A,this.uint16[pe+12]=D,this.float32[xe+7]=B,this.float32[xe+8]=U,this.uint8[ze+36]=G,this.uint8[ze+37]=X,this.uint8[ze+38]=ie,this.uint32[xe+10]=le,this.int16[pe+22]=Se,t}}Fe.prototype.bytesPerElement=48,at("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Fe);class Ue extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,c,m,g,_,x,E,A,D,B,U,G,X,ie,le,Se,pe,xe,ze,Ne,ot,Mt,st,et,vt,ft){const ct=this.length;return this.resize(ct+1),this.emplace(ct,t,i,a,c,m,g,_,x,E,A,D,B,U,G,X,ie,le,Se,pe,xe,ze,Ne,ot,Mt,st,et,vt,ft)}emplace(t,i,a,c,m,g,_,x,E,A,D,B,U,G,X,ie,le,Se,pe,xe,ze,Ne,ot,Mt,st,et,vt,ft,ct){const Re=32*t,bt=16*t;return this.int16[Re+0]=i,this.int16[Re+1]=a,this.int16[Re+2]=c,this.int16[Re+3]=m,this.int16[Re+4]=g,this.int16[Re+5]=_,this.int16[Re+6]=x,this.int16[Re+7]=E,this.uint16[Re+8]=A,this.uint16[Re+9]=D,this.uint16[Re+10]=B,this.uint16[Re+11]=U,this.uint16[Re+12]=G,this.uint16[Re+13]=X,this.uint16[Re+14]=ie,this.uint16[Re+15]=le,this.uint16[Re+16]=Se,this.uint16[Re+17]=pe,this.uint16[Re+18]=xe,this.uint16[Re+19]=ze,this.uint16[Re+20]=Ne,this.uint16[Re+21]=ot,this.uint16[Re+22]=Mt,this.uint32[bt+12]=st,this.float32[bt+13]=et,this.float32[bt+14]=vt,this.uint16[Re+30]=ft,this.uint16[Re+31]=ct,t}}Ue.prototype.bytesPerElement=64,at("StructArrayLayout8i15ui1ul2f2ui64",Ue);class We extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}We.prototype.bytesPerElement=4,at("StructArrayLayout1f4",We);class it extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,a)}emplace(t,i,a,c){const m=3*t;return this.uint16[6*t+0]=i,this.float32[m+1]=a,this.float32[m+2]=c,t}}it.prototype.bytesPerElement=12,at("StructArrayLayout1ui2f12",it);class Xe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,i,a)}emplace(t,i,a,c){const m=4*t;return this.uint32[2*t+0]=i,this.uint16[m+2]=a,this.uint16[m+3]=c,t}}Xe.prototype.bytesPerElement=8,at("StructArrayLayout1ul2ui8",Xe);class Ze extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){const c=2*t;return this.uint16[c+0]=i,this.uint16[c+1]=a,t}}Ze.prototype.bytesPerElement=4,at("StructArrayLayout2ui4",Ze);class dt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}dt.prototype.bytesPerElement=2,at("StructArrayLayout1ui2",dt);class Rt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,i,a,c)}emplace(t,i,a,c,m){const g=4*t;return this.float32[g+0]=i,this.float32[g+1]=a,this.float32[g+2]=c,this.float32[g+3]=m,t}}Rt.prototype.bytesPerElement=16,at("StructArrayLayout4f16",Rt);class Ye extends u{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new N(this.anchorPointX,this.anchorPointY)}}Ye.prototype.size=20;class Qe extends ce{get(t){return new Ye(this,t)}}at("CollisionBoxArray",Qe);class Lt extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Lt.prototype.size=48;class Tr extends Fe{get(t){return new Lt(this,t)}}at("PlacedSymbolArray",Tr);class Ut extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ut.prototype.size=64;class Xt extends Ue{get(t){return new Ut(this,t)}}at("SymbolInstanceArray",Xt);class Ir extends We{getoffsetX(t){return this.float32[1*t+0]}}at("GlyphOffsetArray",Ir);class _i extends M{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}at("SymbolLineVertexArray",_i);class mn extends u{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}mn.prototype.size=12;class Pr extends it{get(t){return new mn(this,t)}}at("TextAnchorOffsetArray",Pr);class hi extends u{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}hi.prototype.size=8;class Br extends Xe{get(t){return new hi(this,t)}}at("FeatureIndexArray",Br);class Jr extends T{}class Si extends T{}class rs extends T{}class Yi extends R{}class is extends q{}class bo extends H{}class gn extends K{}class An extends Q{}class Es extends re{}class Ni extends oe{}class yn extends ee{}class ns extends ve{}class zn extends ke{}class ii extends Ze{}const Nr=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:ki}=Nr;class Yt{constructor(t=[]){this.segments=t}prepareSegment(t,i,a,c){let m=this.segments[this.segments.length-1];return t>Yt.MAX_VERTEX_ARRAY_LENGTH&&Vt(`Max vertices per segment is ${Yt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!m||m.vertexLength+t>Yt.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:i.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,a,c){return new Yt([{vertexOffset:t,primitiveOffset:i,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function _n(r,t){return 256*(r=mt(Math.floor(r),0,255))+mt(Math.floor(t),0,255)}Yt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,at("SegmentVector",Yt);const So=v([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ss={exports:{}},Vu={exports:{}};Vu.exports=function(r,t){var i,a,c,m,g,_,x,E;for(a=r.length-(i=3&r.length),c=t,g=3432918353,_=461845907,E=0;E<a;)x=255&r.charCodeAt(E)|(255&r.charCodeAt(++E))<<8|(255&r.charCodeAt(++E))<<16|(255&r.charCodeAt(++E))<<24,++E,c=27492+(65535&(m=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(x=0,i){case 3:x^=(255&r.charCodeAt(E+2))<<16;case 2:x^=(255&r.charCodeAt(E+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&r.charCodeAt(E)))*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295}return c^=r.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var ju=Vu.exports,Ur={exports:{}};Ur.exports=function(r,t){for(var i,a=r.length,c=t^a,m=0;a>=4;)i=1540483477*(65535&(i=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(i>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),a-=4,++m;switch(a){case 3:c^=(255&r.charCodeAt(m+2))<<16;case 2:c^=(255&r.charCodeAt(m+1))<<8;case 1:c=1540483477*(65535&(c^=255&r.charCodeAt(m)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var os=ju,Yl=Ur.exports;ss.exports=os,ss.exports.murmur3=os,ss.exports.murmur2=Yl;var Pa=Y(ss.exports);class ko{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,a,c){this.ids.push(Ca(t)),this.positions.push(i,a,c)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=Ca(t);let a=0,c=this.ids.length-1;for(;a<c;){const g=a+c>>1;this.ids[g]>=i?c=g:a=g+1}const m=[];for(;this.ids[a]===i;)m.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return m}static serialize(t,i){const a=new Float64Array(t.ids),c=new Uint32Array(t.positions);return Is(a,c,0,a.length-1),i&&i.push(a.buffer,c.buffer),{ids:a,positions:c}}static deserialize(t){const i=new ko;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function Ca(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Pa(String(r))}function Is(r,t,i,a){for(;i<a;){const c=r[i+a>>1];let m=i-1,g=a+1;for(;;){do m++;while(r[m]<c);do g--;while(r[g]>c);if(m>=g)break;Cr(r,m,g),Cr(t,3*m,3*g),Cr(t,3*m+1,3*g+1),Cr(t,3*m+2,3*g+2)}g-i<a-g?(Is(r,t,i,g),i=g+1):(Is(r,t,g+1,a),a=g)}}function Cr(r,t,i){const a=r[t];r[t]=r[i],r[i]=a}at("FeaturePositionMap",ko);class Wr{constructor(t,i){this.gl=t.gl,this.location=i}}class di extends Wr{constructor(t,i){super(t,i),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Uu extends Wr{constructor(t,i){super(t,i),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Jl extends Wr{constructor(t,i){super(t,i),this.current=Ot.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const $u=new Float32Array(16);function zh(r){return[_n(255*r.r,255*r.g),_n(255*r.b,255*r.a)]}class vi{constructor(t,i,a){this.value=t,this.uniformNames=i.map((c=>`u_${c}`)),this.type=a}setUniform(t,i,a){t.set(a.constantOr(this.value))}getBinding(t,i,a){return this.type==="color"?new Jl(t,i):new di(t,i)}}class Ma{constructor(t,i){this.uniformNames=i.map((a=>`u_${a}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=t.tlbr}setUniform(t,i,a,c){const m=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)}getBinding(t,i,a){return a.substr(0,9)==="u_pattern"?new Uu(t,i):new di(t,i)}}class Ws{constructor(t,i,a,c){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map((m=>({name:`a_${m}`,type:"Float32",components:a==="color"?2:1,offset:0}))),this.paintVertexArray=new c}populatePaintArray(t,i,a,c,m){const g=this.paintVertexArray.length,_=this.expression.evaluate(new rr(0),i,{},c,[],m);this.paintVertexArray.resize(t),this._setPaintValue(g,t,_)}updatePaintArray(t,i,a,c){const m=this.expression.evaluate({zoom:0},a,c);this._setPaintValue(t,i,m)}_setPaintValue(t,i,a){if(this.type==="color"){const c=zh(a);for(let m=t;m<i;m++)this.paintVertexArray.emplace(m,c[0],c[1])}else{for(let c=t;c<i;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class as{constructor(t,i,a,c,m,g){this.expression=t,this.uniformNames=i.map((_=>`u_${_}_t`)),this.type=a,this.useIntegerZoom=c,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=i.map((_=>({name:`a_${_}`,type:"Float32",components:a==="color"?4:2,offset:0}))),this.paintVertexArray=new g}populatePaintArray(t,i,a,c,m){const g=this.expression.evaluate(new rr(this.zoom),i,{},c,[],m),_=this.expression.evaluate(new rr(this.zoom+1),i,{},c,[],m),x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,g,_)}updatePaintArray(t,i,a,c){const m=this.expression.evaluate({zoom:this.zoom},a,c),g=this.expression.evaluate({zoom:this.zoom+1},a,c);this._setPaintValue(t,i,m,g)}_setPaintValue(t,i,a,c){if(this.type==="color"){const m=zh(a),g=zh(c);for(let _=t;_<i;_++)this.paintVertexArray.emplace(_,m[0],m[1],g[0],g[1])}else{for(let m=t;m<i;m++)this.paintVertexArray.emplace(m,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i){const a=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,c=mt(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(c)}getBinding(t,i,a){return new di(t,i)}}class Vi{constructor(t,i,a,c,m,g){this.expression=t,this.type=i,this.useIntegerZoom=a,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(t,i,a){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(c,t,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(t,i,a,c,m){this._setPaintValues(t,i,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(t,i,a,c){if(!c||!a)return;const{min:m,mid:g,max:_}=a,x=c[m],E=c[g],A=c[_];if(x&&E&&A)for(let D=t;D<i;D++)this.zoomInPaintVertexArray.emplace(D,E.tl[0],E.tl[1],E.br[0],E.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],E.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(D,E.tl[0],E.tl[1],E.br[0],E.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],E.pixelRatio,A.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,So.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,So.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ls{constructor(t,i,a){this.binders={},this._buffers=[];const c=[];for(const m in t.paint._values){if(!a(m))continue;const g=t.paint.get(m);if(!(g instanceof fn&&ma(g.property.specification)))continue;const _=Dh(m,t.type),x=g.value,E=g.property.specification.type,A=g.property.useIntegerZoom,D=g.property.specification["property-type"],B=D==="cross-faded"||D==="cross-faded-data-driven";if(x.kind==="constant")this.binders[m]=B?new Ma(x.value,_):new vi(x.value,_,E),c.push(`/u_${m}`);else if(x.kind==="source"||B){const U=Fc(m,E,"source");this.binders[m]=B?new Vi(x,E,A,i,U,t.id):new Ws(x,_,E,U),c.push(`/a_${m}`)}else{const U=Fc(m,E,"composite");this.binders[m]=new as(x,_,E,A,i,U),c.push(`/z_${m}`)}}this.cacheKey=c.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof Ws||i instanceof as?i.maxValue:0}populatePaintArrays(t,i,a,c,m){for(const g in this.binders){const _=this.binders[g];(_ instanceof Ws||_ instanceof as||_ instanceof Vi)&&_.populatePaintArray(t,i,a,c,m)}}setConstantPatternPositions(t,i){for(const a in this.binders){const c=this.binders[a];c instanceof Ma&&c.setConstantPatternPositions(t,i)}}updatePaintArrays(t,i,a,c,m){let g=!1;for(const _ in t){const x=i.getPositions(_);for(const E of x){const A=a.feature(E.index);for(const D in this.binders){const B=this.binders[D];if((B instanceof Ws||B instanceof as||B instanceof Vi)&&B.expression.isStateDependent===!0){const U=c.paint.get(D);B.expression=U.value,B.updatePaintArray(E.start,E.end,A,t[_],m),g=!0}}}}return g}defines(){const t=[];for(const i in this.binders){const a=this.binders[i];(a instanceof vi||a instanceof Ma)&&t.push(...a.uniformNames.map((c=>`#define HAS_UNIFORM_${c}`)))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof Ws||a instanceof as)for(let c=0;c<a.paintVertexAttributes.length;c++)t.push(a.paintVertexAttributes[c].name);else if(a instanceof Vi)for(let c=0;c<So.members.length;c++)t.push(So.members[c].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof vi||a instanceof Ma||a instanceof as)for(const c of a.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,i){const a=[];for(const c in this.binders){const m=this.binders[c];if(m instanceof vi||m instanceof Ma||m instanceof as){for(const g of m.uniformNames)if(i[g]){const _=m.getBinding(t,i[g],g);a.push({name:g,property:c,binding:_})}}}return a}setUniforms(t,i,a,c){for(const{name:m,property:g,binding:_}of i)this.binders[g].setUniform(_,c,a.get(g),m)}updatePaintBuffers(t){this._buffers=[];for(const i in this.binders){const a=this.binders[i];if(t&&a instanceof Vi){const c=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(a instanceof Ws||a instanceof as)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const i in this.binders){const a=this.binders[i];(a instanceof Ws||a instanceof as||a instanceof Vi)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof Ws||i instanceof as||i instanceof Vi)&&i.destroy()}}}class Xs{constructor(t,i,a=(()=>!0)){this.programConfigurations={};for(const c of t)this.programConfigurations[c.id]=new ls(c,i,a);this.needsUpload=!1,this._featureMap=new ko,this._bufferOffset=0}populatePaintArrays(t,i,a,c,m,g){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,i,c,m,g);i.id!==void 0&&this._featureMap.add(i.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,a,c){for(const m of a)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(t,this._featureMap,i,m,c)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Dh(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function Fc(r,t,i){const a={color:{source:H,composite:Rt},number:{source:We,composite:H}},c=(function(m){return{"line-pattern":{source:gn,composite:gn},"fill-pattern":{source:gn,composite:gn},"fill-extrusion-pattern":{source:gn,composite:gn}}[m]})(r);return c&&c[i]||a[t][i]}at("ConstantBinder",vi),at("CrossFadedConstantBinder",Ma),at("SourceExpressionBinder",Ws),at("CrossFadedCompositeBinder",Vi),at("CompositeExpressionBinder",as),at("ProgramConfiguration",ls,{omit:["_buffers"]}),at("ProgramConfigurationSet",Xs);const ni=8192,Bc=Math.pow(2,14)-1,Lh=-Bc-1;function Aa(r){const t=ni/r.extent,i=r.loadGeometry();for(let a=0;a<i.length;a++){const c=i[a];for(let m=0;m<c.length;m++){const g=c[m],_=Math.round(g.x*t),x=Math.round(g.y*t);g.x=mt(_,Lh,Bc),g.y=mt(x,Lh,Bc),(_<g.x||_>g.x+1||x<g.y||x>g.y+1)&&Vt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function za(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?Aa(r):[]}}function qu(r,t,i,a,c){r.emplaceBack(2*t+(a+1)/2,2*i+(c+1)/2)}class Oc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Si,this.indexArray=new zn,this.segments=new Yt,this.programConfigurations=new Xs(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,a){const c=this.layers[0],m=[];let g=null,_=!1;c.type==="circle"&&(g=c.layout.get("circle-sort-key"),_=!g.isConstant());for(const{feature:x,id:E,index:A,sourceLayerIndex:D}of t){const B=this.layers[0]._featureFilter.needGeometry,U=za(x,B);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),U,a))continue;const G=_?g.evaluate(U,{},a):void 0,X={id:E,properties:x.properties,type:x.type,sourceLayerIndex:D,index:A,geometry:B?U.geometry:Aa(x),patterns:{},sortKey:G};m.push(X)}_&&m.sort(((x,E)=>x.sortKey-E.sortKey));for(const x of m){const{geometry:E,index:A,sourceLayerIndex:D}=x,B=t[A].feature;this.addFeature(x,E,A,a),i.featureIndex.insert(B,E,A,D,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ki),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,a,c){for(const m of i)for(const g of m){const _=g.x,x=g.y;if(_<0||_>=ni||x<0||x>=ni)continue;const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),A=E.vertexLength;qu(this.layoutVertexArray,_,x,-1,-1),qu(this.layoutVertexArray,_,x,1,-1),qu(this.layoutVertexArray,_,x,1,1),qu(this.layoutVertexArray,_,x,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+3,A+2),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},c)}}function Rh(r,t){for(let i=0;i<r.length;i++)if(fl(t,r[i]))return!0;for(let i=0;i<t.length;i++)if(fl(r,t[i]))return!0;return!!Ql(r,t)}function Zu(r,t,i){return!!fl(r,t)||!!Gu(t,r,i)}function Fh(r,t){if(r.length===1)return Oh(t,r[0]);for(let i=0;i<t.length;i++){const a=t[i];for(let c=0;c<a.length;c++)if(fl(r,a[c]))return!0}for(let i=0;i<r.length;i++)if(Oh(t,r[i]))return!0;for(let i=0;i<t.length;i++)if(Ql(r,t[i]))return!0;return!1}function Nc(r,t,i){if(r.length>1){if(Ql(r,t))return!0;for(let a=0;a<t.length;a++)if(Gu(t[a],r,i))return!0}for(let a=0;a<r.length;a++)if(Gu(r[a],t,i))return!0;return!1}function Ql(r,t){if(r.length===0||t.length===0)return!1;for(let i=0;i<r.length-1;i++){const a=r[i],c=r[i+1];for(let m=0;m<t.length-1;m++)if(vd(a,c,t[m],t[m+1]))return!0}return!1}function vd(r,t,i,a){return or(r,i,a)!==or(t,i,a)&&or(r,t,i)!==or(r,t,a)}function Gu(r,t,i){const a=i*i;if(t.length===1)return r.distSqr(t[0])<a;for(let c=1;c<t.length;c++)if(Bh(r,t[c-1],t[c])<a)return!0;return!1}function Bh(r,t,i){const a=t.distSqr(i);if(a===0)return r.distSqr(t);const c=((r.x-t.x)*(i.x-t.x)+(r.y-t.y)*(i.y-t.y))/a;return r.distSqr(c<0?t:c>1?i:i.sub(t)._mult(c)._add(t))}function Oh(r,t){let i,a,c,m=!1;for(let g=0;g<r.length;g++){i=r[g];for(let _=0,x=i.length-1;_<i.length;x=_++)a=i[_],c=i[x],a.y>t.y!=c.y>t.y&&t.x<(c.x-a.x)*(t.y-a.y)/(c.y-a.y)+a.x&&(m=!m)}return m}function fl(r,t){let i=!1;for(let a=0,c=r.length-1;a<r.length;c=a++){const m=r[a],g=r[c];m.y>t.y!=g.y>t.y&&t.x<(g.x-m.x)*(t.y-m.y)/(g.y-m.y)+m.x&&(i=!i)}return i}function xd(r,t,i){const a=i[0],c=i[2];if(r.x<a.x&&t.x<a.x||r.x>c.x&&t.x>c.x||r.y<a.y&&t.y<a.y||r.y>c.y&&t.y>c.y)return!1;const m=or(r,t,i[0]);return m!==or(r,t,i[1])||m!==or(r,t,i[2])||m!==or(r,t,i[3])}function ml(r,t,i){const a=t.paint.get(r).value;return a.kind==="constant"?a.value:i.programConfigurations.get(t.id).getMaxValue(r)}function Hu(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Wu(r,t,i,a,c){if(!t[0]&&!t[1])return r;const m=N.convert(t)._mult(c);i==="viewport"&&m._rotate(-a);const g=[];for(let _=0;_<r.length;_++)g.push(r[_].sub(m));return g}let Nh,wd;at("CircleBucket",Oc,{omit:["layers"]});var bd={get paint(){return wd=wd||new f({"circle-radius":new Et(Pe.paint_circle["circle-radius"]),"circle-color":new Et(Pe.paint_circle["circle-color"]),"circle-blur":new Et(Pe.paint_circle["circle-blur"]),"circle-opacity":new Et(Pe.paint_circle["circle-opacity"]),"circle-translate":new lt(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new lt(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new lt(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new lt(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Et(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Et(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Et(Pe.paint_circle["circle-stroke-opacity"])})},get layout(){return Nh=Nh||new f({"circle-sort-key":new Et(Pe.layout_circle["circle-sort-key"])})}},Ji=1e-6,eu=typeof Float32Array<"u"?Float32Array:Array;function Vc(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Vh(r,t,i){var a=t[0],c=t[1],m=t[2],g=t[3],_=t[4],x=t[5],E=t[6],A=t[7],D=t[8],B=t[9],U=t[10],G=t[11],X=t[12],ie=t[13],le=t[14],Se=t[15],pe=i[0],xe=i[1],ze=i[2],Ne=i[3];return r[0]=pe*a+xe*_+ze*D+Ne*X,r[1]=pe*c+xe*x+ze*B+Ne*ie,r[2]=pe*m+xe*E+ze*U+Ne*le,r[3]=pe*g+xe*A+ze*G+Ne*Se,r[4]=(pe=i[4])*a+(xe=i[5])*_+(ze=i[6])*D+(Ne=i[7])*X,r[5]=pe*c+xe*x+ze*B+Ne*ie,r[6]=pe*m+xe*E+ze*U+Ne*le,r[7]=pe*g+xe*A+ze*G+Ne*Se,r[8]=(pe=i[8])*a+(xe=i[9])*_+(ze=i[10])*D+(Ne=i[11])*X,r[9]=pe*c+xe*x+ze*B+Ne*ie,r[10]=pe*m+xe*E+ze*U+Ne*le,r[11]=pe*g+xe*A+ze*G+Ne*Se,r[12]=(pe=i[12])*a+(xe=i[13])*_+(ze=i[14])*D+(Ne=i[15])*X,r[13]=pe*c+xe*x+ze*B+Ne*ie,r[14]=pe*m+xe*E+ze*U+Ne*le,r[15]=pe*g+xe*A+ze*G+Ne*Se,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var tu,jc=Vh;function Uc(r,t,i){var a=t[0],c=t[1],m=t[2],g=t[3];return r[0]=i[0]*a+i[4]*c+i[8]*m+i[12]*g,r[1]=i[1]*a+i[5]*c+i[9]*m+i[13]*g,r[2]=i[2]*a+i[6]*c+i[10]*m+i[14]*g,r[3]=i[3]*a+i[7]*c+i[11]*m+i[15]*g,r}tu=new eu(4),eu!=Float32Array&&(tu[0]=0,tu[1]=0,tu[2]=0,tu[3]=0);class bp extends s{constructor(t){super(t,bd)}createBucket(t){return new Oc(t)}queryRadius(t){const i=t;return ml("circle-radius",this,i)+ml("circle-stroke-width",this,i)+Hu(this.paint.get("circle-translate"))}queryIntersectsFeature(t,i,a,c,m,g,_,x){const E=Wu(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,_),A=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a),D=this.paint.get("circle-pitch-alignment")==="map",B=D?E:(function(G,X){return G.map((ie=>Sd(ie,X)))})(E,x),U=D?A*_:A;for(const G of c)for(const X of G){const ie=D?X:Sd(X,x);let le=U;const Se=Uc([],[X.x,X.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?le*=Se[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(le*=g.cameraToCenterDistance/Se[3]),Zu(B,ie,le))return!0}return!1}}function Sd(r,t){const i=Uc([],[r.x,r.y,0,1],t);return new N(i[0]/i[3],i[1]/i[3])}class Ps extends Oc{}let $c;at("HeatmapBucket",Ps,{omit:["layers"]});var qc={get paint(){return $c=$c||new f({"heatmap-radius":new Et(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Et(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new lt(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Nu(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new lt(Pe.paint_heatmap["heatmap-opacity"])})}};function Zc(r,{width:t,height:i},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*i*a)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${t*i*a}`)}else c=new Uint8Array(t*i*a);return r.width=t,r.height=i,r.data=c,r}function jh(r,{width:t,height:i},a){if(t===r.width&&i===r.height)return;const c=Zc({},{width:t,height:i},a);Gc(r,c,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,i)},a),r.width=t,r.height=i,r.data=c.data}function Gc(r,t,i,a,c,m){if(c.width===0||c.height===0)return t;if(c.width>r.width||c.height>r.height||i.x>r.width-c.width||i.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||a.x>t.width-c.width||a.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,_=t.data;if(g===_)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<c.height;x++){const E=((i.y+x)*r.width+i.x)*m,A=((a.y+x)*t.width+a.x)*m;for(let D=0;D<c.width*m;D++)_[A+D]=g[E+D]}return t}class gl{constructor(t,i){Zc(this,t,1,i)}resize(t){jh(this,t,1)}clone(){return new gl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,c,m){Gc(t,i,a,c,m,1)}}class Mi{constructor(t,i){Zc(this,t,4,i)}resize(t){jh(this,t,4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Mi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,c,m){Gc(t,i,a,c,m,4)}}function Hc(r){const t={},i=r.resolution||256,a=r.clips?r.clips.length:1,c=r.image||new Mi({width:i,height:a});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const m=(g,_,x)=>{t[r.evaluationKey]=x;const E=r.expression.evaluate(t);c.data[g+_+0]=Math.floor(255*E.r/E.a),c.data[g+_+1]=Math.floor(255*E.g/E.a),c.data[g+_+2]=Math.floor(255*E.b/E.a),c.data[g+_+3]=Math.floor(255*E.a)};if(r.clips)for(let g=0,_=0;g<a;++g,_+=4*i)for(let x=0,E=0;x<i;x++,E+=4){const A=x/(i-1),{start:D,end:B}=r.clips[g];m(_,E,D*(1-A)+B*A)}else for(let g=0,_=0;g<i;g++,_+=4)m(0,_,g/(i-1));return c}at("AlphaImage",gl),at("RGBAImage",Mi);const Xu="big-fb";class Sp extends s{createBucket(t){return new Ps(t)}constructor(t){super(t,qc),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Hc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Xu)&&this.heatmapFbos.delete(Xu)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Uh;var kd={get paint(){return Uh=Uh||new f({"hillshade-illumination-direction":new lt(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new lt(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new lt(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new lt(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new lt(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new lt(Pe.paint_hillshade["hillshade-accent-color"])})}};class Td extends s{constructor(t){super(t,kd)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Ed=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:Id}=Ed;function Pd(r,t,i=2){const a=t&&t.length,c=a?t[0]*i:r.length;let m=vn(r,0,c,i,!0);const g=[];if(!m||m.next===m.prev)return g;let _,x,E;if(a&&(m=(function(A,D,B,U){const G=[];for(let X=0,ie=D.length;X<ie;X++){const le=vn(A,D[X]*U,X<ie-1?D[X+1]*U:A.length,U,!1);le===le.next&&(le.steiner=!0),G.push(Ld(le))}G.sort($h);for(let X=0;X<G.length;X++)B=Dd(G[X],B);return B})(r,t,m,i)),r.length>80*i){_=1/0,x=1/0;let A=-1/0,D=-1/0;for(let B=i;B<c;B+=i){const U=r[B],G=r[B+1];U<_&&(_=U),G<x&&(x=G),U>A&&(A=U),G>D&&(D=G)}E=Math.max(A-_,D-x),E=E!==0?32767/E:0}return ru(m,g,i,_,x,E,0),g}function vn(r,t,i,a,c){let m;if(c===(function(g,_,x,E){let A=0;for(let D=_,B=x-E;D<x;D+=E)A+=(g[B]-g[D])*(g[D+1]+g[B+1]),B=D;return A})(r,t,i,a)>0)for(let g=t;g<i;g+=a)m=Ju(g/a|0,r[g],r[g+1],m);else for(let g=i-a;g>=t;g-=a)m=Ju(g/a|0,r[g],r[g+1],m);return m&&iu(m,m.next)&&(us(m),m=m.next),m}function pi(r,t){if(!r)return r;t||(t=r);let i,a=r;do if(i=!1,a.steiner||!iu(a,a.next)&&Qr(a.prev,a,a.next)!==0)a=a.next;else{if(us(a),a=t=a.prev,a===a.next)break;i=!0}while(i||a!==t);return t}function ru(r,t,i,a,c,m,g){if(!r)return;!g&&m&&(function(x,E,A,D){let B=x;do B.z===0&&(B.z=Wc(B.x,B.y,E,A,D)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==x);B.prevZ.nextZ=null,B.prevZ=null,(function(U){let G,X=1;do{let ie,le=U;U=null;let Se=null;for(G=0;le;){G++;let pe=le,xe=0;for(let Ne=0;Ne<X&&(xe++,pe=pe.nextZ,pe);Ne++);let ze=X;for(;xe>0||ze>0&&pe;)xe!==0&&(ze===0||!pe||le.z<=pe.z)?(ie=le,le=le.nextZ,xe--):(ie=pe,pe=pe.nextZ,ze--),Se?Se.nextZ=ie:U=ie,ie.prevZ=Se,Se=ie;le=pe}Se.nextZ=null,X*=2}while(G>1)})(B)})(r,a,c,m);let _=r;for(;r.prev!==r.next;){const x=r.prev,E=r.next;if(m?Md(r,a,c,m):Cd(r))t.push(x.i,r.i,E.i),us(r),r=E.next,_=E.next;else if((r=E)===_){g?g===1?ru(r=Ad(pi(r),t),t,i,a,c,m,2):g===2&&zd(r,t,i,a,c,m):ru(pi(r),t,i,a,c,m,1);break}}}function Cd(r){const t=r.prev,i=r,a=r.next;if(Qr(t,i,a)>=0)return!1;const c=t.x,m=i.x,g=a.x,_=t.y,x=i.y,E=a.y,A=c<m?c<g?c:g:m<g?m:g,D=_<x?_<E?_:E:x<E?x:E,B=c>m?c>g?c:g:m>g?m:g,U=_>x?_>E?_:E:x>E?x:E;let G=a.next;for(;G!==t;){if(G.x>=A&&G.x<=B&&G.y>=D&&G.y<=U&&Da(c,_,m,x,g,E,G.x,G.y)&&Qr(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function Md(r,t,i,a){const c=r.prev,m=r,g=r.next;if(Qr(c,m,g)>=0)return!1;const _=c.x,x=m.x,E=g.x,A=c.y,D=m.y,B=g.y,U=_<x?_<E?_:E:x<E?x:E,G=A<D?A<B?A:B:D<B?D:B,X=_>x?_>E?_:E:x>E?x:E,ie=A>D?A>B?A:B:D>B?D:B,le=Wc(U,G,t,i,a),Se=Wc(X,ie,t,i,a);let pe=r.prevZ,xe=r.nextZ;for(;pe&&pe.z>=le&&xe&&xe.z<=Se;){if(pe.x>=U&&pe.x<=X&&pe.y>=G&&pe.y<=ie&&pe!==c&&pe!==g&&Da(_,A,x,D,E,B,pe.x,pe.y)&&Qr(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,xe.x>=U&&xe.x<=X&&xe.y>=G&&xe.y<=ie&&xe!==c&&xe!==g&&Da(_,A,x,D,E,B,xe.x,xe.y)&&Qr(xe.prev,xe,xe.next)>=0))return!1;xe=xe.nextZ}for(;pe&&pe.z>=le;){if(pe.x>=U&&pe.x<=X&&pe.y>=G&&pe.y<=ie&&pe!==c&&pe!==g&&Da(_,A,x,D,E,B,pe.x,pe.y)&&Qr(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;xe&&xe.z<=Se;){if(xe.x>=U&&xe.x<=X&&xe.y>=G&&xe.y<=ie&&xe!==c&&xe!==g&&Da(_,A,x,D,E,B,xe.x,xe.y)&&Qr(xe.prev,xe,xe.next)>=0)return!1;xe=xe.nextZ}return!0}function Ad(r,t){let i=r;do{const a=i.prev,c=i.next.next;!iu(a,c)&&Ku(a,i,i.next,c)&&yl(a,c)&&yl(c,a)&&(t.push(a.i,i.i,c.i),us(i),us(i.next),i=r=c),i=i.next}while(i!==r);return pi(i)}function zd(r,t,i,a,c,m){let g=r;do{let _=g.next.next;for(;_!==g.prev;){if(g.i!==_.i&&Zh(g,_)){let x=Gh(g,_);return g=pi(g,g.next),x=pi(x,x.next),ru(g,t,i,a,c,m,0),void ru(x,t,i,a,c,m,0)}_=_.next}g=g.next}while(g!==r)}function $h(r,t){return r.x-t.x}function Dd(r,t){const i=(function(c,m){let g=m;const _=c.x,x=c.y;let E,A=-1/0;do{if(x<=g.y&&x>=g.next.y&&g.next.y!==g.y){const X=g.x+(x-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(X<=_&&X>A&&(A=X,E=g.x<g.next.x?g:g.next,X===_))return E}g=g.next}while(g!==m);if(!E)return null;const D=E,B=E.x,U=E.y;let G=1/0;g=E;do{if(_>=g.x&&g.x>=B&&_!==g.x&&Da(x<U?_:A,x,B,U,x<U?A:_,x,g.x,g.y)){const X=Math.abs(x-g.y)/(_-g.x);yl(g,c)&&(X<G||X===G&&(g.x>E.x||g.x===E.x&&qh(E,g)))&&(E=g,G=X)}g=g.next}while(g!==D);return E})(r,t);if(!i)return t;const a=Gh(i,r);return pi(a,a.next),pi(i,i.next)}function qh(r,t){return Qr(r.prev,r,t.prev)<0&&Qr(t.next,r,r.next)<0}function Wc(r,t,i,a,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ld(r){let t=r,i=r;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==r);return i}function Da(r,t,i,a,c,m,g,_){return(c-g)*(t-_)>=(r-g)*(m-_)&&(r-g)*(a-_)>=(i-g)*(t-_)&&(i-g)*(m-_)>=(c-g)*(a-_)}function Zh(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!(function(i,a){let c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==a.i&&c.next.i!==a.i&&Ku(c,c.next,i,a))return!0;c=c.next}while(c!==i);return!1})(r,t)&&(yl(r,t)&&yl(t,r)&&(function(i,a){let c=i,m=!1;const g=(i.x+a.x)/2,_=(i.y+a.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&g<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==i);return m})(r,t)&&(Qr(r.prev,r,t.prev)||Qr(r,t.prev,t))||iu(r,t)&&Qr(r.prev,r,r.next)>0&&Qr(t.prev,t,t.next)>0)}function Qr(r,t,i){return(t.y-r.y)*(i.x-t.x)-(t.x-r.x)*(i.y-t.y)}function iu(r,t){return r.x===t.x&&r.y===t.y}function Ku(r,t,i,a){const c=Yu(Qr(r,t,i)),m=Yu(Qr(r,t,a)),g=Yu(Qr(i,a,r)),_=Yu(Qr(i,a,t));return c!==m&&g!==_||!(c!==0||!Xc(r,i,t))||!(m!==0||!Xc(r,a,t))||!(g!==0||!Xc(i,r,a))||!(_!==0||!Xc(i,t,a))}function Xc(r,t,i){return t.x<=Math.max(r.x,i.x)&&t.x>=Math.min(r.x,i.x)&&t.y<=Math.max(r.y,i.y)&&t.y>=Math.min(r.y,i.y)}function Yu(r){return r>0?1:r<0?-1:0}function yl(r,t){return Qr(r.prev,r,r.next)<0?Qr(r,t,r.next)>=0&&Qr(r,r.prev,t)>=0:Qr(r,t,r.prev)<0||Qr(r,r.next,t)<0}function Gh(r,t){const i=Hh(r.i,r.x,r.y),a=Hh(t.i,t.x,t.y),c=r.next,m=t.prev;return r.next=t,t.prev=r,i.next=c,c.prev=i,a.next=i,i.prev=a,m.next=a,a.prev=m,a}function Ju(r,t,i,a){const c=Hh(r,t,i);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function us(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Hh(r,t,i){return{i:r,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Kc(r,t,i){const a=i.patternDependencies;let c=!1;for(const m of t){const g=m.paint.get(`${r}-pattern`);g.isConstant()||(c=!0);const _=g.constantOr(null);_&&(c=!0,a[_.to]=!0,a[_.from]=!0)}return c}function Qu(r,t,i,a,c){const m=c.patternDependencies;for(const g of t){const _=g.paint.get(`${r}-pattern`).value;if(_.kind!=="constant"){let x=_.evaluate({zoom:a-1},i,{},c.availableImages),E=_.evaluate({zoom:a},i,{},c.availableImages),A=_.evaluate({zoom:a+1},i,{},c.availableImages);x=x&&x.name?x.name:x,E=E&&E.name?E.name:E,A=A&&A.name?A.name:A,m[x]=!0,m[E]=!0,m[A]=!0,i.patterns[g.id]={min:x,mid:E,max:A}}}return i}class Yc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new rs,this.indexArray=new zn,this.indexArray2=new ii,this.programConfigurations=new Xs(t.layers,t.zoom),this.segments=new Yt,this.segments2=new Yt,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,a){this.hasPattern=Kc("fill",this.layers,i);const c=this.layers[0].layout.get("fill-sort-key"),m=!c.isConstant(),g=[];for(const{feature:_,id:x,index:E,sourceLayerIndex:A}of t){const D=this.layers[0]._featureFilter.needGeometry,B=za(_,D);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),B,a))continue;const U=m?c.evaluate(B,{},a,i.availableImages):void 0,G={id:x,properties:_.properties,type:_.type,sourceLayerIndex:A,index:E,geometry:D?B.geometry:Aa(_),patterns:{},sortKey:U};g.push(G)}m&&g.sort(((_,x)=>_.sortKey-x.sortKey));for(const _ of g){const{geometry:x,index:E,sourceLayerIndex:A}=_;if(this.hasPattern){const D=Qu("fill",this.layers,_,this.zoom,i);this.patternFeatures.push(D)}else this.addFeature(_,x,E,a,{});i.featureIndex.insert(t[E].feature,x,E,A,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}addFeatures(t,i,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,i,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Id),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,a,c,m){for(const g of ha(i,500)){let _=0;for(const U of g)_+=U.length;const x=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),E=x.vertexLength,A=[],D=[];for(const U of g){if(U.length===0)continue;U!==g[0]&&D.push(A.length/2);const G=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),X=G.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(X+U.length-1,X),A.push(U[0].x),A.push(U[0].y);for(let ie=1;ie<U.length;ie++)this.layoutVertexArray.emplaceBack(U[ie].x,U[ie].y),this.indexArray2.emplaceBack(X+ie-1,X+ie),A.push(U[ie].x),A.push(U[ie].y);G.vertexLength+=U.length,G.primitiveLength+=U.length}const B=Pd(A,D);for(let U=0;U<B.length;U+=3)this.indexArray.emplaceBack(E+B[U],E+B[U+1],E+B[U+2]);x.vertexLength+=_,x.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,m,c)}}let Wh,nu;at("FillBucket",Yc,{omit:["layers","patternFeatures"]});var Qi={get paint(){return nu=nu||new f({"fill-antialias":new lt(Pe.paint_fill["fill-antialias"]),"fill-opacity":new Et(Pe.paint_fill["fill-opacity"]),"fill-color":new Et(Pe.paint_fill["fill-color"]),"fill-outline-color":new Et(Pe.paint_fill["fill-outline-color"]),"fill-translate":new lt(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new lt(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ia(Pe.paint_fill["fill-pattern"])})},get layout(){return Wh=Wh||new f({"fill-sort-key":new Et(Pe.layout_fill["fill-sort-key"])})}};class kp extends s{constructor(t){super(t,Qi)}recalculate(t,i){super.recalculate(t,i);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Yc(t)}queryRadius(){return Hu(this.paint.get("fill-translate"))}queryIntersectsFeature(t,i,a,c,m,g,_){return Fh(Wu(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,_),c)}isTileClipped(){return!0}}const Tp=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Jc=v([{name:"a_centroid",components:2,type:"Int16"}],4),{members:en}=Tp;var La={},wt=J,_l=Ra;function Ra(r,t,i,a,c){this.properties={},this.extent=i,this.type=0,this._pbf=r,this._geometry=-1,this._keys=a,this._values=c,r.readFields(Rd,this,t)}function Rd(r,t,i){r==1?t.id=i.readVarint():r==2?(function(a,c){for(var m=a.readVarint()+a.pos;a.pos<m;){var g=c._keys[a.readVarint()],_=c._values[a.readVarint()];c.properties[g]=_}})(i,t):r==3?t.type=i.readVarint():r==4&&(t._geometry=i.pos)}function Ep(r){for(var t,i,a=0,c=0,m=r.length,g=m-1;c<m;g=c++)a+=((i=r[g]).x-(t=r[c]).x)*(t.y+i.y);return a}Ra.types=["Unknown","Point","LineString","Polygon"],Ra.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,i=r.readVarint()+r.pos,a=1,c=0,m=0,g=0,_=[];r.pos<i;){if(c<=0){var x=r.readVarint();a=7&x,c=x>>3}if(c--,a===1||a===2)m+=r.readSVarint(),g+=r.readSVarint(),a===1&&(t&&_.push(t),t=[]),t.push(new wt(m,g));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&_.push(t),_},Ra.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,i=1,a=0,c=0,m=0,g=1/0,_=-1/0,x=1/0,E=-1/0;r.pos<t;){if(a<=0){var A=r.readVarint();i=7&A,a=A>>3}if(a--,i===1||i===2)(c+=r.readSVarint())<g&&(g=c),c>_&&(_=c),(m+=r.readSVarint())<x&&(x=m),m>E&&(E=m);else if(i!==7)throw new Error("unknown command "+i)}return[g,x,_,E]},Ra.prototype.toGeoJSON=function(r,t,i){var a,c,m=this.extent*Math.pow(2,i),g=this.extent*r,_=this.extent*t,x=this.loadGeometry(),E=Ra.types[this.type];function A(U){for(var G=0;G<U.length;G++){var X=U[G];U[G]=[360*(X.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+_)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(a=0;a<x.length;a++)D[a]=x[a][0];A(x=D);break;case 2:for(a=0;a<x.length;a++)A(x[a]);break;case 3:for(x=(function(U){var G=U.length;if(G<=1)return[U];for(var X,ie,le=[],Se=0;Se<G;Se++){var pe=Ep(U[Se]);pe!==0&&(ie===void 0&&(ie=pe<0),ie===pe<0?(X&&le.push(X),X=[U[Se]]):X.push(U[Se]))}return X&&le.push(X),le})(x),a=0;a<x.length;a++)for(c=0;c<x[a].length;c++)A(x[a][c])}x.length===1?x=x[0]:E="Multi"+E;var B={type:"Feature",geometry:{type:E,coordinates:x},properties:this.properties};return"id"in this&&(B.id=this.id),B};var ec=_l,tc=Qc;function Qc(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Fd,this,t),this.length=this._features.length}function Fd(r,t,i){r===15?t.version=i.readVarint():r===1?t.name=i.readString():r===5?t.extent=i.readVarint():r===2?t._features.push(i.pos):r===3?t._keys.push(i.readString()):r===4&&t._values.push((function(a){for(var c=null,m=a.readVarint()+a.pos;a.pos<m;){var g=a.readVarint()>>3;c=g===1?a.readString():g===2?a.readFloat():g===3?a.readDouble():g===4?a.readVarint64():g===5?a.readVarint():g===6?a.readSVarint():g===7?a.readBoolean():null}return c})(i))}Qc.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new ec(this._pbf,t,this.extent,this._keys,this._values)};var Bd=tc;function Od(r,t,i){if(r===3){var a=new Bd(i,i.readVarint()+i.pos);a.length&&(t[a.name]=a)}}La.VectorTile=function(r,t){this.layers=r.readFields(Od,{},t)},La.VectorTileFeature=_l,La.VectorTileLayer=tc;const Xh=La.VectorTileFeature.types,rc=Math.pow(2,13);function fi(r,t,i,a,c,m,g,_){r.emplaceBack(t,i,2*Math.floor(a*rc)+g,c*rc*2,m*rc*2,Math.round(_))}class cs{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Yi,this.centroidVertexArray=new Jr,this.indexArray=new zn,this.programConfigurations=new Xs(t.layers,t.zoom),this.segments=new Yt,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,a){this.features=[],this.hasPattern=Kc("fill-extrusion",this.layers,i);for(const{feature:c,id:m,index:g,sourceLayerIndex:_}of t){const x=this.layers[0]._featureFilter.needGeometry,E=za(c,x);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),E,a))continue;const A={id:m,sourceLayerIndex:_,index:g,geometry:x?E.geometry:Aa(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Qu("fill-extrusion",this.layers,A,this.zoom,i)):this.addFeature(A,A.geometry,g,a,{}),i.featureIndex.insert(c,A.geometry,g,_,this.index,!0)}}addFeatures(t,i,a){for(const c of this.features){const{geometry:m}=c;this.addFeature(c,m,c.index,i,a)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,en),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Jc.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,i,a,c,m){for(const g of ha(i,500)){const _={x:0,y:0,vertexCount:0};let x=0;for(const G of g)x+=G.length;let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const G of g){if(G.length===0||Nd(G))continue;let X=0;for(let ie=0;ie<G.length;ie++){const le=G[ie];if(ie>=1){const Se=G[ie-1];if(!Fa(le,Se)){E.vertexLength+4>Yt.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const pe=le.sub(Se)._perp()._unit(),xe=Se.dist(le);X+xe>32768&&(X=0),fi(this.layoutVertexArray,le.x,le.y,pe.x,pe.y,0,0,X),fi(this.layoutVertexArray,le.x,le.y,pe.x,pe.y,0,1,X),_.x+=2*le.x,_.y+=2*le.y,_.vertexCount+=2,X+=xe,fi(this.layoutVertexArray,Se.x,Se.y,pe.x,pe.y,0,0,X),fi(this.layoutVertexArray,Se.x,Se.y,pe.x,pe.y,0,1,X),_.x+=2*Se.x,_.y+=2*Se.y,_.vertexCount+=2;const ze=E.vertexLength;this.indexArray.emplaceBack(ze,ze+2,ze+1),this.indexArray.emplaceBack(ze+1,ze+2,ze+3),E.vertexLength+=4,E.primitiveLength+=2}}}}if(E.vertexLength+x>Yt.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),Xh[t.type]!=="Polygon")continue;const A=[],D=[],B=E.vertexLength;for(const G of g)if(G.length!==0){G!==g[0]&&D.push(A.length/2);for(let X=0;X<G.length;X++){const ie=G[X];fi(this.layoutVertexArray,ie.x,ie.y,0,0,1,1,0),_.x+=ie.x,_.y+=ie.y,_.vertexCount+=1,A.push(ie.x),A.push(ie.y)}}const U=Pd(A,D);for(let G=0;G<U.length;G+=3)this.indexArray.emplaceBack(B+U[G],B+U[G+2],B+U[G+1]);E.primitiveLength+=U.length/3,E.vertexLength+=x;for(let G=0;G<_.vertexCount;G++){const X=Math.floor(_.x/_.vertexCount),ie=Math.floor(_.y/_.vertexCount);this.centroidVertexArray.emplaceBack(X,ie)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,m,c)}}function Fa(r,t){return r.x===t.x&&(r.x<0||r.x>ni)||r.y===t.y&&(r.y<0||r.y>ni)}function Nd(r){return r.every((t=>t.x<0))||r.every((t=>t.x>ni))||r.every((t=>t.y<0))||r.every((t=>t.y>ni))}let Kh;at("FillExtrusionBucket",cs,{omit:["layers","features"]});var Ks={get paint(){return Kh=Kh||new f({"fill-extrusion-opacity":new lt(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Et(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new lt(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new lt(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ia(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Et(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Et(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new lt(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Vd extends s{constructor(t){super(t,Ks)}createBucket(t){return new cs(t)}queryRadius(){return Hu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,i,a,c,m,g,_,x){const E=Wu(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,_),A=this.paint.get("fill-extrusion-height").evaluate(i,a),D=this.paint.get("fill-extrusion-base").evaluate(i,a),B=(function(G,X,ie,le){const Se=[];for(const pe of G){const xe=[pe.x,pe.y,0,1];Uc(xe,xe,X),Se.push(new N(xe[0]/xe[3],xe[1]/xe[3]))}return Se})(E,x),U=(function(G,X,ie,le){const Se=[],pe=[],xe=le[8]*X,ze=le[9]*X,Ne=le[10]*X,ot=le[11]*X,Mt=le[8]*ie,st=le[9]*ie,et=le[10]*ie,vt=le[11]*ie;for(const ft of G){const ct=[],Re=[];for(const bt of ft){const _t=bt.x,Nt=bt.y,Or=le[0]*_t+le[4]*Nt+le[12],Lr=le[1]*_t+le[5]*Nt+le[13],Ai=le[2]*_t+le[6]*Nt+le[14],Io=le[3]*_t+le[7]*Nt+le[15],nn=Ai+Ne,zi=Io+ot,On=Or+Mt,Nn=Lr+st,Vn=Ai+et,ai=Io+vt,Di=new N((Or+xe)/zi,(Lr+ze)/zi);Di.z=nn/zi,ct.push(Di);const bn=new N(On/ai,Nn/ai);bn.z=Vn/ai,Re.push(bn)}Se.push(ct),pe.push(Re)}return[Se,pe]})(c,D,A,x);return(function(G,X,ie){let le=1/0;Fh(ie,X)&&(le=jd(ie,X[0]));for(let Se=0;Se<X.length;Se++){const pe=X[Se],xe=G[Se];for(let ze=0;ze<pe.length-1;ze++){const Ne=pe[ze],ot=[Ne,pe[ze+1],xe[ze+1],xe[ze],Ne];Rh(ie,ot)&&(le=Math.min(le,jd(ie,ot)))}}return le!==1/0&&le})(U[0],U[1],B)}}function Dn(r,t){return r.x*t.x+r.y*t.y}function jd(r,t){if(r.length===1){let i=0;const a=t[i++];let c;for(;!c||a.equals(c);)if(c=t[i++],!c)return 1/0;for(;i<t.length;i++){const m=t[i],g=r[0],_=c.sub(a),x=m.sub(a),E=g.sub(a),A=Dn(_,_),D=Dn(_,x),B=Dn(x,x),U=Dn(E,_),G=Dn(E,x),X=A*B-D*D,ie=(B*U-D*G)/X,le=(A*G-D*U)/X,Se=a.z*(1-ie-le)+c.z*ie+m.z*le;if(isFinite(Se))return Se}return 1/0}{let i=1/0;for(const a of t)i=Math.min(i,a.z);return i}}const Ud=v([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:$d}=Ud,qd=v([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Zd}=qd,Ip=La.VectorTileFeature.types,eh=Math.cos(Math.PI/180*37.5),th=Math.pow(2,14)/.5;class Ln{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new is,this.layoutVertexArray2=new bo,this.indexArray=new zn,this.programConfigurations=new Xs(t.layers,t.zoom),this.segments=new Yt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(t,i,a){this.hasPattern=Kc("line",this.layers,i);const c=this.layers[0].layout.get("line-sort-key"),m=!c.isConstant(),g=[];for(const{feature:_,id:x,index:E,sourceLayerIndex:A}of t){const D=this.layers[0]._featureFilter.needGeometry,B=za(_,D);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),B,a))continue;const U=m?c.evaluate(B,{},a):void 0,G={id:x,properties:_.properties,type:_.type,sourceLayerIndex:A,index:E,geometry:D?B.geometry:Aa(_),patterns:{},sortKey:U};g.push(G)}m&&g.sort(((_,x)=>_.sortKey-x.sortKey));for(const _ of g){const{geometry:x,index:E,sourceLayerIndex:A}=_;if(this.hasPattern){const D=Qu("line",this.layers,_,this.zoom,i);this.patternFeatures.push(D)}else this.addFeature(_,x,E,a,{});i.featureIndex.insert(t[E].feature,x,E,A,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}addFeatures(t,i,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,i,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Zd)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,$d),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,a,c,m){const g=this.layers[0].layout,_=g.get("line-join").evaluate(t,{}),x=g.get("line-cap"),E=g.get("line-miter-limit"),A=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const D of i)this.addLine(D,t,_,x,E,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,m,c)}addLine(t,i,a,c,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<t.length-1;le++)this.totalDistance+=t[le].dist(t[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=Ip[i.type]==="Polygon";let x=t.length;for(;x>=2&&t[x-1].equals(t[x-2]);)x--;let E=0;for(;E<x-1&&t[E].equals(t[E+1]);)E++;if(x<(_?3:2))return;a==="bevel"&&(m=1.05);const A=this.overscaling<=16?15*ni/(512*this.overscaling):0,D=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let B,U,G,X,ie;this.e1=this.e2=-1,_&&(B=t[x-2],ie=t[E].sub(B)._unit()._perp());for(let le=E;le<x;le++){if(G=le===x-1?_?t[E+1]:void 0:t[le+1],G&&t[le].equals(G))continue;ie&&(X=ie),B&&(U=B),B=t[le],ie=G?G.sub(B)._unit()._perp():X,X=X||ie;let Se=X.add(ie);Se.x===0&&Se.y===0||Se._unit();const pe=X.x*ie.x+X.y*ie.y,xe=Se.x*ie.x+Se.y*ie.y,ze=xe!==0?1/xe:1/0,Ne=2*Math.sqrt(2-2*xe),ot=xe<eh&&U&&G,Mt=X.x*ie.y-X.y*ie.x>0;if(ot&&le>E){const vt=B.dist(U);if(vt>2*A){const ft=B.sub(B.sub(U)._mult(A/vt)._round());this.updateDistance(U,ft),this.addCurrentVertex(ft,X,0,0,D),U=ft}}const st=U&&G;let et=st?a:_?"butt":c;if(st&&et==="round"&&(ze<g?et="miter":ze<=2&&(et="fakeround")),et==="miter"&&ze>m&&(et="bevel"),et==="bevel"&&(ze>2&&(et="flipbevel"),ze<m&&(et="miter")),U&&this.updateDistance(U,B),et==="miter")Se._mult(ze),this.addCurrentVertex(B,Se,0,0,D);else if(et==="flipbevel"){if(ze>100)Se=ie.mult(-1);else{const vt=ze*X.add(ie).mag()/X.sub(ie).mag();Se._perp()._mult(vt*(Mt?-1:1))}this.addCurrentVertex(B,Se,0,0,D),this.addCurrentVertex(B,Se.mult(-1),0,0,D)}else if(et==="bevel"||et==="fakeround"){const vt=-Math.sqrt(ze*ze-1),ft=Mt?vt:0,ct=Mt?0:vt;if(U&&this.addCurrentVertex(B,X,ft,ct,D),et==="fakeround"){const Re=Math.round(180*Ne/Math.PI/20);for(let bt=1;bt<Re;bt++){let _t=bt/Re;if(_t!==.5){const Or=_t-.5;_t+=_t*Or*(_t-1)*((1.0904+pe*(pe*(3.55645-1.43519*pe)-3.2452))*Or*Or+(.848013+pe*(.215638*pe-1.06021)))}const Nt=ie.sub(X)._mult(_t)._add(X)._unit()._mult(Mt?-1:1);this.addHalfVertex(B,Nt.x,Nt.y,!1,Mt,0,D)}}G&&this.addCurrentVertex(B,ie,-ft,-ct,D)}else if(et==="butt")this.addCurrentVertex(B,Se,0,0,D);else if(et==="square"){const vt=U?1:-1;this.addCurrentVertex(B,Se,vt,vt,D)}else et==="round"&&(U&&(this.addCurrentVertex(B,X,0,0,D),this.addCurrentVertex(B,X,1,1,D,!0)),G&&(this.addCurrentVertex(B,ie,-1,-1,D,!0),this.addCurrentVertex(B,ie,0,0,D)));if(ot&&le<x-1){const vt=B.dist(G);if(vt>2*A){const ft=B.add(G.sub(B)._mult(A/vt)._round());this.updateDistance(B,ft),this.addCurrentVertex(ft,ie,0,0,D),B=ft}}}}addCurrentVertex(t,i,a,c,m,g=!1){const _=i.y*c-i.x,x=-i.y-i.x*c;this.addHalfVertex(t,i.x+i.y*a,i.y-i.x*a,g,!1,a,m),this.addHalfVertex(t,_,x,g,!0,-c,m),this.distance>th/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,i,a,c,m,g))}addHalfVertex({x:t,y:i},a,c,m,g,_,x){const E=.5*(this.lineClips?this.scaledDistance*(th-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(i<<1)+(g?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(_===0?0:_<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),x.primitiveLength++),g?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}let yr,Ti;at("LineBucket",Ln,{omit:["layers","patternFeatures"]});var mi={get paint(){return Ti=Ti||new f({"line-opacity":new Et(Pe.paint_line["line-opacity"]),"line-color":new Et(Pe.paint_line["line-color"]),"line-translate":new lt(Pe.paint_line["line-translate"]),"line-translate-anchor":new lt(Pe.paint_line["line-translate-anchor"]),"line-width":new Et(Pe.paint_line["line-width"]),"line-gap-width":new Et(Pe.paint_line["line-gap-width"]),"line-offset":new Et(Pe.paint_line["line-offset"]),"line-blur":new Et(Pe.paint_line["line-blur"]),"line-dasharray":new pl(Pe.paint_line["line-dasharray"]),"line-pattern":new Ia(Pe.paint_line["line-pattern"]),"line-gradient":new Nu(Pe.paint_line["line-gradient"])})},get layout(){return yr=yr||new f({"line-cap":new lt(Pe.layout_line["line-cap"]),"line-join":new Et(Pe.layout_line["line-join"]),"line-miter-limit":new lt(Pe.layout_line["line-miter-limit"]),"line-round-limit":new lt(Pe.layout_line["line-round-limit"]),"line-sort-key":new Et(Pe.layout_line["line-sort-key"])})}};class ji extends Et{possiblyEvaluate(t,i){return i=new rr(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(t,i)}evaluate(t,i,a,c){return i=St({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(t,i,a,c)}}let tn;class su extends s{constructor(t){super(t,mi),this.gradientVersion=0,tn||(tn=new ji(mi.paint.properties["line-width"].specification),tn.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!(function(a){return a._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof Bo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,i){super.recalculate(t,i),this.paint._values["line-floorwidth"]=tn.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Ln(t)}queryRadius(t){const i=t,a=xi(ml("line-width",this,i),ml("line-gap-width",this,i)),c=ml("line-offset",this,i);return a/2+Math.abs(c)+Hu(this.paint.get("line-translate"))}queryIntersectsFeature(t,i,a,c,m,g,_){const x=Wu(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,_),E=_/2*xi(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),A=this.paint.get("line-offset").evaluate(i,a);return A&&(c=(function(D,B){const U=[];for(let G=0;G<D.length;G++){const X=D[G],ie=[];for(let le=0;le<X.length;le++){const Se=X[le-1],pe=X[le],xe=X[le+1],ze=le===0?new N(0,0):pe.sub(Se)._unit()._perp(),Ne=le===X.length-1?new N(0,0):xe.sub(pe)._unit()._perp(),ot=ze._add(Ne)._unit(),Mt=ot.x*Ne.x+ot.y*Ne.y;Mt!==0&&ot._mult(1/Mt),ie.push(ot._mult(B)._add(pe))}U.push(ie)}return U})(c,A*_)),(function(D,B,U){for(let G=0;G<B.length;G++){const X=B[G];if(D.length>=3){for(let ie=0;ie<X.length;ie++)if(fl(D,X[ie]))return!0}if(Nc(D,X,U))return!0}return!1})(x,c,E)}isTileClipped(){return!0}}function xi(r,t){return t>0?t+2*r:r}const ic=v([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),vl=v([{name:"a_projected_pos",components:3,type:"Float32"}],4);v([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const rh=v([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);v([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ih=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nc=v([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Rn(r,t,i){return r.sections.forEach((a=>{a.text=(function(c,m,g){const _=m.layout.get("text-transform").evaluate(g,{});return _==="uppercase"?c=c.toLocaleUpperCase():_==="lowercase"&&(c=c.toLocaleLowerCase()),Er.applyArabicShaping&&(c=Er.applyArabicShaping(c)),c})(a.text,t,i)})),r}v([{name:"triangle",components:3,type:"Uint16"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),v([{type:"Float32",name:"offsetX"}]),v([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),v([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const xl={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var $r=24,To=ur,sc=function(r,t,i,a,c){var m,g,_=8*c-a-1,x=(1<<_)-1,E=x>>1,A=-7,D=c-1,B=-1,U=r[t+D];for(D+=B,m=U&(1<<-A)-1,U>>=-A,A+=_;A>0;m=256*m+r[t+D],D+=B,A-=8);for(g=m&(1<<-A)-1,m>>=-A,A+=a;A>0;g=256*g+r[t+D],D+=B,A-=8);if(m===0)m=1-E;else{if(m===x)return g?NaN:1/0*(U?-1:1);g+=Math.pow(2,a),m-=E}return(U?-1:1)*g*Math.pow(2,m-a)},nh=function(r,t,i,a,c,m){var g,_,x,E=8*m-c-1,A=(1<<E)-1,D=A>>1,B=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,U=0,G=1,X=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(_=isNaN(t)?1:0,g=A):(g=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-g))<1&&(g--,x*=2),(t+=g+D>=1?B/x:B*Math.pow(2,1-D))*x>=2&&(g++,x/=2),g+D>=A?(_=0,g=A):g+D>=1?(_=(t*x-1)*Math.pow(2,c),g+=D):(_=t*Math.pow(2,D-1)*Math.pow(2,c),g=0));c>=8;r[i+U]=255&_,U+=G,_/=256,c-=8);for(g=g<<c|_,E+=c;E>0;r[i+U]=255&g,U+=G,g/=256,E-=8);r[i+U-G]|=128*X};function ur(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}ur.Varint=0,ur.Fixed64=1,ur.Bytes=2,ur.Fixed32=5;var ou=4294967296,Yo=1/ou,oc=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function hs(r){return r.type===ur.Bytes?r.readVarint()+r.pos:r.pos+1}function Ba(r,t,i){return i?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function ac(r,t,i){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(a);for(var c=i.pos-1;c>=r;c--)i.buf[c+a]=i.buf[c]}function sh(r,t){for(var i=0;i<r.length;i++)t.writeVarint(r[i])}function xn(r,t){for(var i=0;i<r.length;i++)t.writeSVarint(r[i])}function Oa(r,t){for(var i=0;i<r.length;i++)t.writeFloat(r[i])}function Ys(r,t){for(var i=0;i<r.length;i++)t.writeDouble(r[i])}function Fn(r,t){for(var i=0;i<r.length;i++)t.writeBoolean(r[i])}function Gd(r,t){for(var i=0;i<r.length;i++)t.writeFixed32(r[i])}function Yh(r,t){for(var i=0;i<r.length;i++)t.writeSFixed32(r[i])}function Jh(r,t){for(var i=0;i<r.length;i++)t.writeFixed64(r[i])}function Pp(r,t){for(var i=0;i<r.length;i++)t.writeSFixed64(r[i])}function Js(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function wl(r,t,i){r[i]=t,r[i+1]=t>>>8,r[i+2]=t>>>16,r[i+3]=t>>>24}function oh(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}ur.prototype={destroy:function(){this.buf=null},readFields:function(r,t,i){for(i=i||this.length;this.pos<i;){var a=this.readVarint(),c=a>>3,m=this.pos;this.type=7&a,r(c,t,this),this.pos===m&&this.skip(a)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=Js(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=oh(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Js(this.buf,this.pos)+Js(this.buf,this.pos+4)*ou;return this.pos+=8,r},readSFixed64:function(){var r=Js(this.buf,this.pos)+oh(this.buf,this.pos+4)*ou;return this.pos+=8,r},readFloat:function(){var r=sc(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=sc(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,i,a=this.buf;return t=127&(i=a[this.pos++]),i<128?t:(t|=(127&(i=a[this.pos++]))<<7,i<128?t:(t|=(127&(i=a[this.pos++]))<<14,i<128?t:(t|=(127&(i=a[this.pos++]))<<21,i<128?t:(function(c,m,g){var _,x,E=g.buf;if(_=(112&(x=E[g.pos++]))>>4,x<128||(_|=(127&(x=E[g.pos++]))<<3,x<128)||(_|=(127&(x=E[g.pos++]))<<10,x<128)||(_|=(127&(x=E[g.pos++]))<<17,x<128)||(_|=(127&(x=E[g.pos++]))<<24,x<128)||(_|=(1&(x=E[g.pos++]))<<31,x<128))return Ba(c,_,m);throw new Error("Expected varint not more than 10 bytes")})(t|=(15&(i=a[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&oc?(function(i,a,c){return oc.decode(i.subarray(a,c))})(this.buf,t,r):(function(i,a,c){for(var m="",g=a;g<c;){var _,x,E,A=i[g],D=null,B=A>239?4:A>223?3:A>191?2:1;if(g+B>c)break;B===1?A<128&&(D=A):B===2?(192&(_=i[g+1]))==128&&(D=(31&A)<<6|63&_)<=127&&(D=null):B===3?(x=i[g+2],(192&(_=i[g+1]))==128&&(192&x)==128&&((D=(15&A)<<12|(63&_)<<6|63&x)<=2047||D>=55296&&D<=57343)&&(D=null)):B===4&&(x=i[g+2],E=i[g+3],(192&(_=i[g+1]))==128&&(192&x)==128&&(192&E)==128&&((D=(15&A)<<18|(63&_)<<12|(63&x)<<6|63&E)<=65535||D>=1114112)&&(D=null)),D===null?(D=65533,B=1):D>65535&&(D-=65536,m+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),m+=String.fromCharCode(D),g+=B}return m})(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==ur.Bytes)return r.push(this.readVarint(t));var i=hs(this);for(r=r||[];this.pos<i;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==ur.Bytes)return r.push(this.readSVarint());var t=hs(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==ur.Bytes)return r.push(this.readBoolean());var t=hs(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==ur.Bytes)return r.push(this.readFloat());var t=hs(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==ur.Bytes)return r.push(this.readDouble());var t=hs(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==ur.Bytes)return r.push(this.readFixed32());var t=hs(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==ur.Bytes)return r.push(this.readSFixed32());var t=hs(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==ur.Bytes)return r.push(this.readFixed64());var t=hs(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==ur.Bytes)return r.push(this.readSFixed64());var t=hs(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===ur.Varint)for(;this.buf[this.pos++]>127;);else if(t===ur.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ur.Fixed32)this.pos+=4;else{if(t!==ur.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),wl(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),wl(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),wl(this.buf,-1&r,this.pos),wl(this.buf,Math.floor(r*Yo),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),wl(this.buf,-1&r,this.pos),wl(this.buf,Math.floor(r*Yo),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?(function(t,i){var a,c;if(t>=0?(a=t%4294967296|0,c=t/4294967296|0):(c=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,c=c+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(m,g,_){_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,_.buf[_.pos]=127&(m>>>=7)})(a,0,i),(function(m,g){var _=(7&m)<<4;g.buf[g.pos++]|=_|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))})(c,i)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=(function(a,c,m){for(var g,_,x=0;x<c.length;x++){if((g=c.charCodeAt(x))>55295&&g<57344){if(!_){g>56319||x+1===c.length?(a[m++]=239,a[m++]=191,a[m++]=189):_=g;continue}if(g<56320){a[m++]=239,a[m++]=191,a[m++]=189,_=g;continue}g=_-55296<<10|g-56320|65536,_=null}else _&&(a[m++]=239,a[m++]=191,a[m++]=189,_=null);g<128?a[m++]=g:(g<2048?a[m++]=g>>6|192:(g<65536?a[m++]=g>>12|224:(a[m++]=g>>18|240,a[m++]=g>>12&63|128),a[m++]=g>>6&63|128),a[m++]=63&g|128)}return m})(this.buf,r,this.pos);var i=this.pos-t;i>=128&&ac(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(r){this.realloc(4),nh(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),nh(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=r[i]},writeRawMessage:function(r,t){this.pos++;var i=this.pos;r(t,this);var a=this.pos-i;a>=128&&ac(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeMessage:function(r,t,i){this.writeTag(r,ur.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,sh,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,xn,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,Fn,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,Oa,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,Ys,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,Gd,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,Yh,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,Jh,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,Pp,t)},writeBytesField:function(r,t){this.writeTag(r,ur.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,ur.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,ur.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,ur.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,ur.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,ur.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,ur.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,ur.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,ur.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,ur.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};var Jo=Y(To);const lc=3;function bl(r,t,i){r===1&&i.readMessage(Hd,t)}function Hd(r,t,i){if(r===3){const{id:a,bitmap:c,width:m,height:g,left:_,top:x,advance:E}=i.readMessage(Wd,{});t.push({id:a,bitmap:new gl({width:m+2*lc,height:g+2*lc},c),metrics:{width:m,height:g,left:_,top:x,advance:E}})}}function Wd(r,t,i){r===1?t.id=i.readVarint():r===2?t.bitmap=i.readBytes():r===3?t.width=i.readVarint():r===4?t.height=i.readVarint():r===5?t.left=i.readSVarint():r===6?t.top=i.readSVarint():r===7&&(t.advance=i.readVarint())}const ah=lc;function uc(r){let t=0,i=0;for(const g of r)t+=g.w*g.h,i=Math.max(i,g.w);r.sort(((g,_)=>_.h-g.h));const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let c=0,m=0;for(const g of r)for(let _=a.length-1;_>=0;_--){const x=a[_];if(!(g.w>x.w||g.h>x.h)){if(g.x=x.x,g.y=x.y,m=Math.max(m,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===x.w&&g.h===x.h){const E=a.pop();_<a.length&&(a[_]=E)}else g.h===x.h?(x.x+=g.w,x.w-=g.w):g.w===x.w?(x.y+=g.h,x.h-=g.h):(a.push({x:x.x+g.w,y:x.y,w:x.w-g.w,h:g.h}),x.y+=g.h,x.h-=g.h);break}}return{w:c,h:m,fill:t/(c*m)||0}}const wn=1;class Qh{constructor(t,{pixelRatio:i,version:a,stretchX:c,stretchY:m,content:g,textFitWidth:_,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=c,this.stretchY=m,this.content=g,this.version=a,this.textFitWidth=_,this.textFitHeight=x}get tl(){return[this.paddedRect.x+wn,this.paddedRect.y+wn]}get br(){return[this.paddedRect.x+this.paddedRect.w-wn,this.paddedRect.y+this.paddedRect.h-wn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*wn)/this.pixelRatio,(this.paddedRect.h-2*wn)/this.pixelRatio]}}class ed{constructor(t,i){const a={},c={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,a,m),this.addImages(i,c,m);const{w:g,h:_}=uc(m),x=new Mi({width:g||1,height:_||1});for(const E in t){const A=t[E],D=a[E].paddedRect;Mi.copy(A.data,x,{x:0,y:0},{x:D.x+wn,y:D.y+wn},A.data)}for(const E in i){const A=i[E],D=c[E].paddedRect,B=D.x+wn,U=D.y+wn,G=A.data.width,X=A.data.height;Mi.copy(A.data,x,{x:0,y:0},{x:B,y:U},A.data),Mi.copy(A.data,x,{x:0,y:X-1},{x:B,y:U-1},{width:G,height:1}),Mi.copy(A.data,x,{x:0,y:0},{x:B,y:U+X},{width:G,height:1}),Mi.copy(A.data,x,{x:G-1,y:0},{x:B-1,y:U},{width:1,height:X}),Mi.copy(A.data,x,{x:0,y:0},{x:B+G,y:U},{width:1,height:X})}this.image=x,this.iconPositions=a,this.patternPositions=c}addImages(t,i,a){for(const c in t){const m=t[c],g={x:0,y:0,w:m.data.width+2*wn,h:m.data.height+2*wn};a.push(g),i[c]=new Qh(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,i){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),i),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),i)}patchUpdatedImage(t,i,a){if(!t||!i||t.version===i.version)return;t.version=i.version;const[c,m]=t.tl;a.update(i.data,void 0,{x:c,y:m})}}var Qo;at("ImagePosition",Qh),at("ImageAtlas",ed),I.ah=void 0,(Qo=I.ah||(I.ah={}))[Qo.none=0]="none",Qo[Qo.horizontal=1]="horizontal",Qo[Qo.vertical=2]="vertical",Qo[Qo.horizontalOnly=3]="horizontalOnly";const Qs=-17;class cc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){const a=new cc;return a.scale=t||1,a.fontStack=i,a}static forImage(t){const i=new cc;return i.imageName=t,i}}class eo{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){const a=new eo;for(let c=0;c<t.sections.length;c++){const m=t.sections[c];m.image?a.addImageSection(m):a.addTextSection(m,i)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let i="";for(let a=0;a<t.length;a++){const c=t.charCodeAt(a+1)||null,m=t.charCodeAt(a-1)||null;i+=c&&Ko(c)&&!xl[t[a+1]]||m&&Ko(m)&&!xl[t[a-1]]||!xl[t[a]]?t[a]:xl[t[a]]}return i})(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&Xr[this.text.charCodeAt(a)];a++)t++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&Xr[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const a=new eo;return a.text=this.text.substring(t,i),a.sectionIndex=this.sectionIndex.slice(t,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,i)=>Math.max(t,this.sections[i].scale)),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(cc.forText(t.scale,t.fontStack||i));const a=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(a)}addImageSection(t){const i=t.image?t.image.name:"";if(i.length===0)return void Vt("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(cc.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Vt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hc(r,t,i,a,c,m,g,_,x,E,A,D,B,U,G){const X=eo.fromFeature(r,c);let ie;D===I.ah.vertical&&X.verticalizePunctuation();const{processBidirectionalText:le,processStyledBidirectionalText:Se}=Er;if(le&&X.sections.length===1){ie=[];const ze=le(X.toString(),Bn(X,E,m,t,a,U));for(const Ne of ze){const ot=new eo;ot.text=Ne,ot.sections=X.sections;for(let Mt=0;Mt<Ne.length;Mt++)ot.sectionIndex.push(0);ie.push(ot)}}else if(Se){ie=[];const ze=Se(X.text,X.sectionIndex,Bn(X,E,m,t,a,U));for(const Ne of ze){const ot=new eo;ot.text=Ne[0],ot.sectionIndex=Ne[1],ot.sections=X.sections,ie.push(ot)}}else ie=(function(ze,Ne){const ot=[],Mt=ze.text;let st=0;for(const et of Ne)ot.push(ze.substring(st,et)),st=et;return st<Mt.length&&ot.push(ze.substring(st,Mt.length)),ot})(X,Bn(X,E,m,t,a,U));const pe=[],xe={positionedLines:pe,text:X.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:D,iconsInText:!1,verticalizable:!1};return(function(ze,Ne,ot,Mt,st,et,vt,ft,ct,Re,bt,_t){let Nt=0,Or=Qs,Lr=0,Ai=0;const Io=ft==="right"?1:ft==="left"?0:.5;let nn=0;for(const ai of st){ai.trim();const Di=ai.getMaxScale(),bn=(Di-1)*$r,sn={positionedGlyphs:[],lineOffset:0};ze.positionedLines[nn]=sn;const jn=sn.positionedGlyphs;let on=0;if(!ai.length()){Or+=et,++nn;continue}for(let ds=0;ds<ai.length();ds++){const _r=ai.getSection(ds),Vr=ai.getSectionIndex(ds),qr=ai.getCharCode(ds);let Ms=0,si=null,gh=null,Ua=null,$a=$r;const Po=!(ct===I.ah.horizontal||!bt&&!hl(qr)||bt&&(Xr[qr]||(zi=qr,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(zi)))));if(_r.imageName){const ro=Mt[_r.imageName];if(!ro)continue;Ua=_r.imageName,ze.iconsInText=ze.iconsInText||!0,gh=ro.paddedRect;const Ui=ro.displaySize;_r.scale=_r.scale*$r/_t,si={width:Ui[0],height:Ui[1],left:wn,top:-ah,advance:Po?Ui[1]:Ui[0]},Ms=bn+($r-Ui[1]*_r.scale),$a=si.advance;const kl=Po?Ui[0]*_r.scale-$r*Di:Ui[1]*_r.scale-$r*Di;kl>0&&kl>on&&(on=kl)}else{const ro=ot[_r.fontStack],Ui=ro&&ro[qr];if(Ui&&Ui.rect)gh=Ui.rect,si=Ui.metrics;else{const kl=Ne[_r.fontStack],od=kl&&kl[qr];if(!od)continue;si=od.metrics}Ms=(Di-_r.scale)*$r}Po?(ze.verticalizable=!0,jn.push({glyph:qr,imageName:Ua,x:Nt,y:Or+Ms,vertical:Po,scale:_r.scale,fontStack:_r.fontStack,sectionIndex:Vr,metrics:si,rect:gh}),Nt+=$a*_r.scale+Re):(jn.push({glyph:qr,imageName:Ua,x:Nt,y:Or+Ms,vertical:Po,scale:_r.scale,fontStack:_r.fontStack,sectionIndex:Vr,metrics:si,rect:gh}),Nt+=si.advance*_r.scale+Re)}jn.length!==0&&(Lr=Math.max(Nt-Re,Lr),Mp(jn,0,jn.length-1,Io,on)),Nt=0;const to=et*Di+on;sn.lineOffset=Math.max(on,bn),Or+=to,Ai=Math.max(to,Ai),++nn}var zi;const On=Or-Qs,{horizontalAlign:Nn,verticalAlign:Vn}=dc(vt);(function(ai,Di,bn,sn,jn,on,to,ds,_r){const Vr=(Di-bn)*jn;let qr=0;qr=on!==to?-ds*sn-Qs:(-sn*_r+.5)*to;for(const Ms of ai)for(const si of Ms.positionedGlyphs)si.x+=Vr,si.y+=qr})(ze.positionedLines,Io,Nn,Vn,Lr,Ai,et,On,st.length),ze.top+=-Vn*On,ze.bottom=ze.top+On,ze.left+=-Nn*Lr,ze.right=ze.left+Lr})(xe,t,i,a,ie,g,_,x,D,E,B,G),!(function(ze){for(const Ne of ze)if(Ne.positionedGlyphs.length!==0)return!1;return!0})(pe)&&xe}const Xr={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Cp={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Xd={40:!0};function Kd(r,t,i,a,c,m){if(t.imageName){const g=a[t.imageName];return g?g.displaySize[0]*t.scale*$r/m+c:0}{const g=i[t.fontStack],_=g&&g[r];return _?_.metrics.advance*t.scale+c:0}}function Yd(r,t,i,a){const c=Math.pow(r-t,2);return a?r<t?c/2:2*c:c+Math.abs(i)*i}function Jd(r,t,i){let a=0;return r===10&&(a-=1e4),i&&(a+=150),r!==40&&r!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function td(r,t,i,a,c,m){let g=null,_=Yd(t,i,c,m);for(const x of a){const E=Yd(t-x.x,i,c,m)+x.badness;E<=_&&(g=x,_=E)}return{index:r,x:t,priorBreak:g,badness:_}}function Qd(r){return r?Qd(r.priorBreak).concat(r.index):[]}function Bn(r,t,i,a,c,m){if(!r)return[];const g=[],_=(function(D,B,U,G,X,ie){let le=0;for(let Se=0;Se<D.length();Se++){const pe=D.getSection(Se);le+=Kd(D.getCharCode(Se),pe,G,X,B,ie)}return le/Math.max(1,Math.ceil(le/U))})(r,t,i,a,c,m),x=r.text.indexOf("")>=0;let E=0;for(let D=0;D<r.length();D++){const B=r.getSection(D),U=r.getCharCode(D);if(Xr[U]||(E+=Kd(U,B,a,c,t,m)),D<r.length()-1){const G=!((A=U)<11904)&&(!!er["CJK Compatibility Forms"](A)||!!er["CJK Compatibility"](A)||!!er["CJK Strokes"](A)||!!er["CJK Symbols and Punctuation"](A)||!!er["Enclosed CJK Letters and Months"](A)||!!er["Halfwidth and Fullwidth Forms"](A)||!!er["Ideographic Description Characters"](A)||!!er["Vertical Forms"](A)||cl.test(String.fromCodePoint(A)));(Cp[U]||G||B.imageName||D!==r.length()-2&&Xd[r.getCharCode(D+1)])&&g.push(td(D+1,E,_,g,Jd(U,r.getCharCode(D+1),G&&x),!1))}}var A;return Qd(td(r.length(),E,_,g,0,!0))}function dc(r){let t=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Mp(r,t,i,a,c){if(!a&&!c)return;const m=r[i],g=(r[i].x+m.metrics.advance*m.scale)*a;for(let _=t;_<=i;_++)r[_].x-=g,r[_].y+=c}function Na(r,t,i){const{horizontalAlign:a,verticalAlign:c}=dc(i),m=t[0]-r.displaySize[0]*a,g=t[1]-r.displaySize[1]*c;return{image:r,top:g,bottom:g+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function pc(r){var t,i;let a=r.left,c=r.top,m=r.right-a,g=r.bottom-c;const _=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(i=r.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",E=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(x==="proportional"){if(_==="stretchOnly"&&m/g<E||_==="proportional"){const A=Math.ceil(g*E);a*=A/m,m=A}}else if(_==="proportional"&&x==="stretchOnly"&&E!==0&&m/g>E){const A=Math.ceil(m/E);c*=A/g,g=A}return{x1:a,y1:c,x2:a+m,y2:c+g}}function Va(r,t,i,a,c,m){const g=r.image;let _;if(g.content){const ie=g.content,le=g.pixelRatio||1;_=[ie[0]/le,ie[1]/le,g.displaySize[0]-ie[2]/le,g.displaySize[1]-ie[3]/le]}const x=t.left*m,E=t.right*m;let A,D,B,U;i==="width"||i==="both"?(U=c[0]+x-a[3],D=c[0]+E+a[1]):(U=c[0]+(x+E-g.displaySize[0])/2,D=U+g.displaySize[0]);const G=t.top*m,X=t.bottom*m;return i==="height"||i==="both"?(A=c[1]+G-a[0],B=c[1]+X+a[2]):(A=c[1]+(G+X-g.displaySize[1])/2,B=A+g.displaySize[1]),{image:g,top:A,right:D,bottom:B,left:U,collisionPadding:_}}const ja=255,Cs=128,Eo=ja*Cs;function ep(r,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new rr(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:c}=i;let m=0;for(;m<a.length&&a[m]<=r;)m++;m=Math.max(0,m-1);let g=m;for(;g<a.length&&a[g]<r+1;)g++;g=Math.min(a.length-1,g);const _=a[m],x=a[g];return i.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:x,minSize:i.evaluate(new rr(_)),maxSize:i.evaluate(new rr(x)),interpolationType:c}}}function fc(r,t,i){let a="never";const c=r.get(t);return c?a=c:r.get(i)&&(a="always"),a}const Ap=La.VectorTileFeature.types,tp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function mc(r,t,i,a,c,m,g,_,x,E,A,D,B){const U=_?Math.min(Eo,Math.round(_[0])):0,G=_?Math.min(Eo,Math.round(_[1])):0;r.emplaceBack(t,i,Math.round(32*a),Math.round(32*c),m,g,(U<<1)+(x?1:0),G,16*E,16*A,256*D,256*B)}function au(r,t,i){r.emplaceBack(t.x,t.y,i),r.emplaceBack(t.x,t.y,i),r.emplaceBack(t.x,t.y,i),r.emplaceBack(t.x,t.y,i)}function lh(r){for(const t of r.sections)if(wo(t.text))return!0;return!1}class uh{constructor(t){this.layoutVertexArray=new An,this.indexArray=new zn,this.programConfigurations=t,this.segments=new Yt,this.dynamicLayoutVertexArray=new Es,this.opacityVertexArray=new Ni,this.hasVisibleVertices=!1,this.placedSymbolArray=new Tr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,a,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ic.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,vl.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,tp,!0),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}at("SymbolBuffers",uh);class gc{constructor(t,i,a){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new a,this.segments=new Yt,this.collisionVertexArray=new ns}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,rh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}at("CollisionBuffers",gc);class lu{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Vc([]),this.placementViewportMatrix=Vc([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ep(this.zoom,i["text-size"]),this.iconSizeData=ep(this.zoom,i["icon-size"]);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),m=a.get("symbol-z-order");this.canOverlap=fc(a,"text-overlap","text-allow-overlap")!=="never"||fc(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map((g=>I.ah[g]))),this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id)),this.sourceID=t.sourceID}createArrays(){this.text=new uh(new Xs(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new uh(new Xs(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new Ir,this.lineVertexArray=new _i,this.symbolInstances=new Xt,this.textAnchorOffsets=new Pr}calculateGlyphDependencies(t,i,a,c,m){for(let g=0;g<t.length;g++)if(i[t.charCodeAt(g)]=!0,(a||c)&&m){const _=xl[t.charAt(g)];_&&(i[_.charCodeAt(0)]=!0)}}populate(t,i,a){const c=this.layers[0],m=c.layout,g=m.get("text-font"),_=m.get("text-field"),x=m.get("icon-image"),E=(_.value.kind!=="constant"||_.value.value instanceof qi&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),A=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,D=m.get("symbol-sort-key");if(this.features=[],!E&&!A)return;const B=i.iconDependencies,U=i.glyphDependencies,G=i.availableImages,X=new rr(this.zoom);for(const{feature:ie,id:le,index:Se,sourceLayerIndex:pe}of t){const xe=c._featureFilter.needGeometry,ze=za(ie,xe);if(!c._featureFilter.filter(X,ze,a))continue;let Ne,ot;if(xe||(ze.geometry=Aa(ie)),E){const st=c.getValueAndResolveTokens("text-field",ze,a,G),et=qi.factory(st),vt=this.hasRTLText=this.hasRTLText||lh(et);(!vt||Er.getRTLTextPluginStatus()==="unavailable"||vt&&Er.isParsed())&&(Ne=Rn(et,c,ze))}if(A){const st=c.getValueAndResolveTokens("icon-image",ze,a,G);ot=st instanceof Ci?st:Ci.fromString(st)}if(!Ne&&!ot)continue;const Mt=this.sortFeaturesByKey?D.evaluate(ze,{},a):void 0;if(this.features.push({id:le,text:Ne,icon:ot,index:Se,sourceLayerIndex:pe,geometry:ze.geometry,properties:ie.properties,type:Ap[ie.type],sortKey:Mt}),ot&&(B[ot.name]=!0),Ne){const st=g.evaluate(ze,{},a).join(","),et=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(I.ah.vertical)>=0;for(const vt of Ne.sections)if(vt.image)B[vt.image.name]=!0;else{const ft=Ou(Ne.toString()),ct=vt.fontStack||st,Re=U[ct]=U[ct]||{};this.calculateGlyphDependencies(vt.text,Re,et,this.allowVerticalPlacement,ft)}}}m.get("symbol-placement")==="line"&&(this.features=(function(ie){const le={},Se={},pe=[];let xe=0;function ze(st){pe.push(ie[st]),xe++}function Ne(st,et,vt){const ft=Se[st];return delete Se[st],Se[et]=ft,pe[ft].geometry[0].pop(),pe[ft].geometry[0]=pe[ft].geometry[0].concat(vt[0]),ft}function ot(st,et,vt){const ft=le[et];return delete le[et],le[st]=ft,pe[ft].geometry[0].shift(),pe[ft].geometry[0]=vt[0].concat(pe[ft].geometry[0]),ft}function Mt(st,et,vt){const ft=vt?et[0][et[0].length-1]:et[0][0];return`${st}:${ft.x}:${ft.y}`}for(let st=0;st<ie.length;st++){const et=ie[st],vt=et.geometry,ft=et.text?et.text.toString():null;if(!ft){ze(st);continue}const ct=Mt(ft,vt),Re=Mt(ft,vt,!0);if(ct in Se&&Re in le&&Se[ct]!==le[Re]){const bt=ot(ct,Re,vt),_t=Ne(ct,Re,pe[bt].geometry);delete le[ct],delete Se[Re],Se[Mt(ft,pe[_t].geometry,!0)]=_t,pe[bt].geometry=null}else ct in Se?Ne(ct,Re,vt):Re in le?ot(ct,Re,vt):(ze(st),le[ct]=xe-1,Se[Re]=xe-1)}return pe.filter((st=>st.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((ie,le)=>ie.sortKey-le.sortKey))}update(t,i,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const a=this.lineVertexArray.length;if(t.segment!==void 0){let c=t.dist(i[t.segment+1]),m=t.dist(i[t.segment]);const g={};for(let _=t.segment+1;_<i.length;_++)g[_]={x:i[_].x,y:i[_].y,tileUnitDistanceFromAnchor:c},_<i.length-1&&(c+=i[_+1].dist(i[_]));for(let _=t.segment||0;_>=0;_--)g[_]={x:i[_].x,y:i[_].y,tileUnitDistanceFromAnchor:m},_>0&&(m+=i[_-1].dist(i[_]));for(let _=0;_<i.length;_++){const x=g[_];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,i,a,c,m,g,_,x,E,A,D,B){const U=t.indexArray,G=t.layoutVertexArray,X=t.segments.prepareSegment(4*i.length,G,U,this.canOverlap?g.sortKey:void 0),ie=this.glyphOffsetArray.length,le=X.vertexLength,Se=this.allowVerticalPlacement&&_===I.ah.vertical?Math.PI/2:0,pe=g.text&&g.text.sections;for(let xe=0;xe<i.length;xe++){const{tl:ze,tr:Ne,bl:ot,br:Mt,tex:st,pixelOffsetTL:et,pixelOffsetBR:vt,minFontScaleX:ft,minFontScaleY:ct,glyphOffset:Re,isSDF:bt,sectionIndex:_t}=i[xe],Nt=X.vertexLength,Or=Re[1];mc(G,x.x,x.y,ze.x,Or+ze.y,st.x,st.y,a,bt,et.x,et.y,ft,ct),mc(G,x.x,x.y,Ne.x,Or+Ne.y,st.x+st.w,st.y,a,bt,vt.x,et.y,ft,ct),mc(G,x.x,x.y,ot.x,Or+ot.y,st.x,st.y+st.h,a,bt,et.x,vt.y,ft,ct),mc(G,x.x,x.y,Mt.x,Or+Mt.y,st.x+st.w,st.y+st.h,a,bt,vt.x,vt.y,ft,ct),au(t.dynamicLayoutVertexArray,x,Se),U.emplaceBack(Nt,Nt+1,Nt+2),U.emplaceBack(Nt+1,Nt+2,Nt+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Re[0]),xe!==i.length-1&&_t===i[xe+1].sectionIndex||t.programConfigurations.populatePaintArrays(G.length,g,g.index,{},B,pe&&pe[_t])}t.placedSymbolArray.emplaceBack(x.x,x.y,ie,this.glyphOffsetArray.length-ie,le,E,A,x.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],_,0,!1,0,D)}_addCollisionDebugVertex(t,i,a,c,m,g){return i.emplaceBack(0,0),t.emplaceBack(a.x,a.y,c,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(t,i,a,c,m,g,_){const x=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),E=x.vertexLength,A=m.layoutVertexArray,D=m.collisionVertexArray,B=_.anchorX,U=_.anchorY;this._addCollisionDebugVertex(A,D,g,B,U,new N(t,i)),this._addCollisionDebugVertex(A,D,g,B,U,new N(a,i)),this._addCollisionDebugVertex(A,D,g,B,U,new N(a,c)),this._addCollisionDebugVertex(A,D,g,B,U,new N(t,c)),x.vertexLength+=4;const G=m.indexArray;G.emplaceBack(E,E+1),G.emplaceBack(E+1,E+2),G.emplaceBack(E+2,E+3),G.emplaceBack(E+3,E),x.primitiveLength+=4}addDebugCollisionBoxes(t,i,a,c){for(let m=t;m<i;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gc(yn,ih.members,ii),this.iconCollisionBox=new gc(yn,ih.members,ii);for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(t,i,a,c,m,g,_,x,E){const A={};for(let D=i;D<a;D++){const B=t.get(D);A.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},A.textFeatureIndex=B.featureIndex;break}for(let D=c;D<m;D++){const B=t.get(D);A.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},A.verticalTextFeatureIndex=B.featureIndex;break}for(let D=g;D<_;D++){const B=t.get(D);A.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},A.iconFeatureIndex=B.featureIndex;break}for(let D=x;D<E;D++){const B=t.get(D);A.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},A.verticalIconFeatureIndex=B.featureIndex;break}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){const a=t.placedSymbolArray.get(i),c=a.vertexStartIndex+4*a.numGlyphs;for(let m=a.vertexStartIndex;m<c;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),a=Math.cos(t),c=[],m=[],g=[];for(let _=0;_<this.symbolInstances.length;++_){g.push(_);const x=this.symbolInstances.get(_);c.push(0|Math.round(i*x.anchorX+a*x.anchorY)),m.push(x.featureIndex)}return g.sort(((_,x)=>c[_]-c[x]||m[x]-m[_])),g}addToSortKeyRanges(t,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach(((c,m,g)=>{c>=0&&g.indexOf(c)===m&&this.addIndicesForPlacedSymbol(this.text,c)})),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let rd,ch;at("SymbolBucket",lu,{omit:["layers","collisionBoxArray","features","compareText"]}),lu.MAX_GLYPHS=65535,lu.addDynamicAttributes=au;var uu={get paint(){return ch=ch||new f({"icon-opacity":new Et(Pe.paint_symbol["icon-opacity"]),"icon-color":new Et(Pe.paint_symbol["icon-color"]),"icon-halo-color":new Et(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Et(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Et(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new lt(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new lt(Pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Et(Pe.paint_symbol["text-opacity"]),"text-color":new Et(Pe.paint_symbol["text-color"],{runtimeType:Ii,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Et(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new Et(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new Et(Pe.paint_symbol["text-halo-blur"]),"text-translate":new lt(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new lt(Pe.paint_symbol["text-translate-anchor"])})},get layout(){return rd=rd||new f({"symbol-placement":new lt(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new lt(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new lt(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Et(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new lt(Pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new lt(Pe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new lt(Pe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new lt(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new lt(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new lt(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Et(Pe.layout_symbol["icon-size"]),"icon-text-fit":new lt(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new lt(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Et(Pe.layout_symbol["icon-image"]),"icon-rotate":new Et(Pe.layout_symbol["icon-rotate"]),"icon-padding":new Et(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new lt(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new Et(Pe.layout_symbol["icon-offset"]),"icon-anchor":new Et(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new lt(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new lt(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new lt(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new Et(Pe.layout_symbol["text-field"]),"text-font":new Et(Pe.layout_symbol["text-font"]),"text-size":new Et(Pe.layout_symbol["text-size"]),"text-max-width":new Et(Pe.layout_symbol["text-max-width"]),"text-line-height":new lt(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new Et(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new Et(Pe.layout_symbol["text-justify"]),"text-radial-offset":new Et(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new lt(Pe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Et(Pe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Et(Pe.layout_symbol["text-anchor"]),"text-max-angle":new lt(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new lt(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new Et(Pe.layout_symbol["text-rotate"]),"text-padding":new lt(Pe.layout_symbol["text-padding"]),"text-keep-upright":new lt(Pe.layout_symbol["text-keep-upright"]),"text-transform":new Et(Pe.layout_symbol["text-transform"]),"text-offset":new Et(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new lt(Pe.layout_symbol["text-allow-overlap"]),"text-overlap":new lt(Pe.layout_symbol["text-overlap"]),"text-ignore-placement":new lt(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new lt(Pe.layout_symbol["text-optional"])})}};class hh{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:ao,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}at("FormatSectionOverride",hh,{omit:["defaultValue"]});class Sl extends s{constructor(t){super(t,uu)}recalculate(t,i){if(super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const m of a)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,i,a,c){const m=this.layout.get(t).evaluate(i,{},a,c),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||go(g.value)||!m?m:(function(_,x){return x.replace(/{([^{}]+)}/g,((E,A)=>_&&A in _?String(_[A]):""))})(i.properties,m)}createBucket(t){return new lu(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of uu.paint.overridableProperties){if(!Sl.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),a=new hh(i),c=new Wi(a,i.property.specification);let m=null;m=i.value.kind==="constant"||i.value.kind==="source"?new qo("source",c):new Zo("composite",c,i.value.zoomStops),this.paint._values[t]=new fn(i.property,m,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&Sl.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const a=t.get("text-field"),c=uu.paint.properties[i];let m=!1;const g=_=>{for(const x of _)if(c.overrides&&c.overrides.hasOverride(x))return void(m=!0)};if(a.value.kind==="constant"&&a.value.value instanceof qi)g(a.value.value.sections);else if(a.value.kind==="source"){const _=E=>{m||(E instanceof Wn&&kr(E.value)===Hn?g(E.value.sections):E instanceof Oo?g(E.sections):E.eachChild(_))},x=a.value;x._styleExpression&&_(x._styleExpression.expression)}return m}}let id;var zp={get paint(){return id=id||new f({"background-color":new lt(Pe.paint_background["background-color"]),"background-pattern":new pl(Pe.paint_background["background-pattern"]),"background-opacity":new lt(Pe.paint_background["background-opacity"])})}};class dh extends s{constructor(t){super(t,zp)}}let rp;var yc={get paint(){return rp=rp||new f({"raster-opacity":new lt(Pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new lt(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new lt(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new lt(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new lt(Pe.paint_raster["raster-saturation"]),"raster-contrast":new lt(Pe.paint_raster["raster-contrast"]),"raster-resampling":new lt(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new lt(Pe.paint_raster["raster-fade-duration"])})}};class Dp extends s{constructor(t){super(t,yc)}}class ph extends s{constructor(t){super(t,{}),this.onAdd=i=>{this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)},this.onRemove=i=>{this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class n{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const o=63710088e-1;class d{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new d(pt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,a=this.lat*i,c=t.lat*i,m=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((t.lng-this.lng)*i);return o*Math.acos(Math.min(m,1))}static convert(t){if(t instanceof d)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new d(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new d(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const y=2*Math.PI*o;function k(r){return y*Math.cos(r*Math.PI/180)}function C(r){return(180+r)/360}function Z(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function ae(r,t){return r/k(t)}function me(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class Ce{constructor(t,i,a=0){this.x=+t,this.y=+i,this.z=+a}static fromLngLat(t,i=0){const a=d.convert(t);return new Ce(C(a.lng),Z(a.lat),ae(i,a.lat))}toLngLat(){return new d(360*this.x-180,me(this.y))}toAltitude(){return this.z*k(me(this.y))}meterInMercatorCoordinateUnits(){return 1/y*(t=me(this.y),1/Math.cos(t*Math.PI/180));var t}}function je(r,t,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[r*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class qe{constructor(t,i,a){if(!(function(c,m,g){return!(c<0||c>25||g<0||g>=Math.pow(2,c)||m<0||m>=Math.pow(2,c))})(t,i,a))throw new Error(`x=${i}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=i,this.y=a,this.key=yt(0,t,t,i,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i,a){const c=(g=this.y,_=this.z,x=je(256*(m=this.x),256*(g=Math.pow(2,_)-g-1),_),E=je(256*(m+1),256*(g+1),_),x[0]+","+x[1]+","+E[0]+","+E[1]);var m,g,_,x,E;const A=(function(D,B,U){let G,X="";for(let ie=D;ie>0;ie--)G=1<<ie-1,X+=(B&G?1:0)+(U&G?2:0);return X})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,c)}isChildOf(t){const i=this.z-t.z;return i>0&&t.x===this.x>>i&&t.y===this.y>>i}getTilePoint(t){const i=Math.pow(2,this.z);return new N((t.x*i-this.x)*ni,(t.y*i-this.y)*ni)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ve{constructor(t,i){this.wrap=t,this.canonical=i,this.key=yt(t,i.z,i.z,i.x,i.y)}}class nt{constructor(t,i,a,c,m){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=i,this.canonical=new qe(a,+c,+m),this.key=yt(i,t,a,c,m)}clone(){return new nt(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-t;return t>this.canonical.z?new nt(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new nt(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?yt(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y):yt(this.wrap*+i,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new nt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new nt(i,this.wrap,i,a,c),new nt(i,this.wrap,i,a+1,c),new nt(i,this.wrap,i,a,c+1),new nt(i,this.wrap,i,a+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new nt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new nt(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ve(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ce(t.x-this.wrap,t.y))}}function yt(r,t,i,a,c){(r*=2)<0&&(r=-1*r-1);const m=1<<i;return(m*m*r+m*c+a).toString(36)+i.toString(36)+t.toString(36)}at("CanonicalTileID",qe),at("OverscaledTileID",nt,{omit:["posMatrix"]});class Tt{constructor(t,i,a,c=1,m=1,g=1,_=0){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void Vt(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const x=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=m,this.blueFactor=g,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let E=0;E<x;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(x,E)]=this.data[this._idx(x-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,x)]=this.data[this._idx(E,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let E=0;E<x;E++)for(let A=0;A<x;A++){const D=this.get(E,A);D>this.max&&(this.max=D),D<this.min&&(this.min=D)}}get(t,i){const a=new Uint8Array(this.data.buffer),c=4*this._idx(t,i);return this.unpack(a[c],a[c+1],a[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}unpack(t,i,a){return t*this.redFactor+i*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new Mi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,i,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,m=i*this.dim+this.dim,g=a*this.dim,_=a*this.dim+this.dim;switch(i){case-1:c=m-1;break;case 1:m=c+1}switch(a){case-1:g=_-1;break;case 1:_=g+1}const x=-i*this.dim,E=-a*this.dim;for(let A=g;A<_;A++)for(let D=c;D<m;D++)this.data[this._idx(D,A)]=t.data[this._idx(D+x,A+E)]}}at("DEMData",Tt);class oi{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const a=t[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Te{constructor(t,i,a,c,m){this.type="Feature",this._vectorTileFeature=t,t._z=i,t._x=a,t._y=c,this.properties=t.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(t[i]=this[i]);return t}}class _e{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Sa(ni,16,0),this.grid3D=new Sa(ni,16,0),this.featureIndexArray=new Br,this.promoteId=i}insert(t,i,a,c,m,g){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,m);const x=g?this.grid3D:this.grid;for(let E=0;E<i.length;E++){const A=i[E],D=[1/0,1/0,-1/0,-1/0];for(let B=0;B<A.length;B++){const U=A[B];D[0]=Math.min(D[0],U.x),D[1]=Math.min(D[1],U.y),D[2]=Math.max(D[2],U.x),D[3]=Math.max(D[3],U.y)}D[0]<ni&&D[1]<ni&&D[2]>=0&&D[3]>=0&&x.insert(_,D[0],D[1],D[2],D[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new La.VectorTile(new Jo(this.rawTileData)).layers,this.sourceLayerCoder=new oi(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,i,a,c){this.loadVTLayers();const m=t.params||{},g=ni/t.tileSize/t.scale,_=nl(m.filter),x=t.queryGeometry,E=t.queryPadding*g,A=Je(x),D=this.grid.query(A.minX-E,A.minY-E,A.maxX+E,A.maxY+E),B=Je(t.cameraQueryGeometry),U=this.grid3D.query(B.minX-E,B.minY-E,B.maxX+E,B.maxY+E,((ie,le,Se,pe)=>(function(xe,ze,Ne,ot,Mt){for(const et of xe)if(ze<=et.x&&Ne<=et.y&&ot>=et.x&&Mt>=et.y)return!0;const st=[new N(ze,Ne),new N(ze,Mt),new N(ot,Mt),new N(ot,Ne)];if(xe.length>2){for(const et of st)if(fl(xe,et))return!0}for(let et=0;et<xe.length-1;et++)if(xd(xe[et],xe[et+1],st))return!0;return!1})(t.cameraQueryGeometry,ie-E,le-E,Se+E,pe+E)));for(const ie of U)D.push(ie);D.sort(Pt);const G={};let X;for(let ie=0;ie<D.length;ie++){const le=D[ie];if(le===X)continue;X=le;const Se=this.featureIndexArray.get(le);let pe=null;this.loadMatchingFeature(G,Se.bucketIndex,Se.sourceLayerIndex,Se.featureIndex,_,m.layers,m.availableImages,i,a,c,((xe,ze,Ne)=>(pe||(pe=Aa(xe)),ze.queryIntersectsFeature(x,xe,Ne,pe,this.z,t.transform,g,t.pixelPosMatrix))))}return G}loadMatchingFeature(t,i,a,c,m,g,_,x,E,A,D){const B=this.bucketLayerIDs[i];if(g&&!(function(ie,le){for(let Se=0;Se<ie.length;Se++)if(le.indexOf(ie[Se])>=0)return!0;return!1})(g,B))return;const U=this.sourceLayerCoder.decode(a),G=this.vtLayers[U].feature(c);if(m.needGeometry){const ie=za(G,!0);if(!m.filter(new rr(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!m.filter(new rr(this.tileID.overscaledZ),G))return;const X=this.getId(G,U);for(let ie=0;ie<B.length;ie++){const le=B[ie];if(g&&g.indexOf(le)<0)continue;const Se=x[le];if(!Se)continue;let pe={};X&&A&&(pe=A.getState(Se.sourceLayer||"_geojsonTileLayer",X));const xe=St({},E[le]);xe.paint=Ie(xe.paint,Se.paint,G,pe,_),xe.layout=Ie(xe.layout,Se.layout,G,pe,_);const ze=!D||D(G,Se,pe);if(!ze)continue;const Ne=new Te(G,this.z,this.x,this.y,X);Ne.layer=xe;let ot=t[le];ot===void 0&&(ot=t[le]=[]),ot.push({featureIndex:c,feature:Ne,intersectionZ:ze})}}lookupSymbolFeatures(t,i,a,c,m,g,_,x){const E={};this.loadVTLayers();const A=nl(m);for(const D of t)this.loadMatchingFeature(E,a,c,D,A,g,_,x,i);return E}hasLayer(t){for(const i of this.bucketLayerIDs)for(const a of i)if(t===a)return!0;return!1}getId(t,i){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof a=="boolean"&&(a=Number(a))),a}}function Ie(r,t,i,a,c){return Zt(r,((m,g)=>{const _=t instanceof Ea?t.get(g):null;return _&&_.evaluate?_.evaluate(i,a,c):_}))}function Je(r){let t=1/0,i=1/0,a=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),i=Math.min(i,m.y),a=Math.max(a,m.x),c=Math.max(c,m.y);return{minX:t,minY:i,maxX:a,maxY:c}}function Pt(r,t){return t-r}function Ft(r,t,i,a,c){const m=[];for(let g=0;g<r.length;g++){const _=r[g];let x;for(let E=0;E<_.length-1;E++){let A=_[E],D=_[E+1];A.x<t&&D.x<t||(A.x<t?A=new N(t,A.y+(t-A.x)/(D.x-A.x)*(D.y-A.y))._round():D.x<t&&(D=new N(t,A.y+(t-A.x)/(D.x-A.x)*(D.y-A.y))._round()),A.y<i&&D.y<i||(A.y<i?A=new N(A.x+(i-A.y)/(D.y-A.y)*(D.x-A.x),i)._round():D.y<i&&(D=new N(A.x+(i-A.y)/(D.y-A.y)*(D.x-A.x),i)._round()),A.x>=a&&D.x>=a||(A.x>=a?A=new N(a,A.y+(a-A.x)/(D.x-A.x)*(D.y-A.y))._round():D.x>=a&&(D=new N(a,A.y+(a-A.x)/(D.x-A.x)*(D.y-A.y))._round()),A.y>=c&&D.y>=c||(A.y>=c?A=new N(A.x+(c-A.y)/(D.y-A.y)*(D.x-A.x),c)._round():D.y>=c&&(D=new N(A.x+(c-A.y)/(D.y-A.y)*(D.x-A.x),c)._round()),x&&A.equals(x[x.length-1])||(x=[A],m.push(x)),x.push(D)))))}}return m}at("FeatureIndex",_e,{omit:["rawTileData","sourceLayerCoder"]});class Ct extends N{constructor(t,i,a,c){super(t,i),this.angle=a,c!==void 0&&(this.segment=c)}clone(){return new Ct(this.x,this.y,this.angle,this.segment)}}function $t(r,t,i,a,c){if(t.segment===void 0||i===0)return!0;let m=t,g=t.segment+1,_=0;for(;_>-i/2;){if(g--,g<0)return!1;_-=r[g].dist(m),m=r[g]}_+=r[g].dist(r[g+1]),g++;const x=[];let E=0;for(;_<i/2;){const A=r[g],D=r[g+1];if(!D)return!1;let B=r[g-1].angleTo(A)-A.angleTo(D);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:_,angleDelta:B}),E+=B;_-x[0].distance>a;)E-=x.shift().angleDelta;if(E>c)return!1;g++,_+=A.dist(D)}return!0}function Ei(r){let t=0;for(let i=0;i<r.length-1;i++)t+=r[i].dist(r[i+1]);return t}function br(r,t,i){return r?.6*t*i:0}function ea(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Lp(r,t,i,a,c,m){const g=br(i,c,m),_=ea(i,a)*m;let x=0;const E=Ei(r)/2;for(let A=0;A<r.length-1;A++){const D=r[A],B=r[A+1],U=D.dist(B);if(x+U>E){const G=(E-x)/U,X=ri.number(D.x,B.x,G),ie=ri.number(D.y,B.y,G),le=new Ct(X,ie,B.angleTo(D),A);return le._round(),!g||$t(r,le,_,g,t)?le:void 0}x+=U}}function Om(r,t,i,a,c,m,g,_,x){const E=br(a,m,g),A=ea(a,c),D=A*g,B=r[0].x===0||r[0].x===x||r[0].y===0||r[0].y===x;return t-D<t/4&&(t=D+t/4),vf(r,B?t/2*_%t:(A/2+2*m)*g*_%t,t,E,i,D,B,!1,x)}function vf(r,t,i,a,c,m,g,_,x){const E=m/2,A=Ei(r);let D=0,B=t-i,U=[];for(let G=0;G<r.length-1;G++){const X=r[G],ie=r[G+1],le=X.dist(ie),Se=ie.angleTo(X);for(;B+i<D+le;){B+=i;const pe=(B-D)/le,xe=ri.number(X.x,ie.x,pe),ze=ri.number(X.y,ie.y,pe);if(xe>=0&&xe<x&&ze>=0&&ze<x&&B-E>=0&&B+E<=A){const Ne=new Ct(xe,ze,Se,G);Ne._round(),a&&!$t(r,Ne,m,a,c)||U.push(Ne)}}D+=le}return _||U.length||g||(U=vf(r,D/2,i,a,c,m,g,!0,x)),U}at("Anchor",Ct);const fh=wn;function xf(r,t,i,a){const c=[],m=r.image,g=m.pixelRatio,_=m.paddedRect.w-2*fh,x=m.paddedRect.h-2*fh;let E={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const A=m.stretchX||[[0,_]],D=m.stretchY||[[0,x]],B=(Re,bt)=>Re+bt[1]-bt[0],U=A.reduce(B,0),G=D.reduce(B,0),X=_-U,ie=x-G;let le=0,Se=U,pe=0,xe=G,ze=0,Ne=X,ot=0,Mt=ie;if(m.content&&a){const Re=m.content,bt=Re[2]-Re[0],_t=Re[3]-Re[1];(m.textFitWidth||m.textFitHeight)&&(E=pc(r)),le=ip(A,0,Re[0]),pe=ip(D,0,Re[1]),Se=ip(A,Re[0],Re[2]),xe=ip(D,Re[1],Re[3]),ze=Re[0]-le,ot=Re[1]-pe,Ne=bt-Se,Mt=_t-xe}const st=E.x1,et=E.y1,vt=E.x2-st,ft=E.y2-et,ct=(Re,bt,_t,Nt)=>{const Or=np(Re.stretch-le,Se,vt,st),Lr=sp(Re.fixed-ze,Ne,Re.stretch,U),Ai=np(bt.stretch-pe,xe,ft,et),Io=sp(bt.fixed-ot,Mt,bt.stretch,G),nn=np(_t.stretch-le,Se,vt,st),zi=sp(_t.fixed-ze,Ne,_t.stretch,U),On=np(Nt.stretch-pe,xe,ft,et),Nn=sp(Nt.fixed-ot,Mt,Nt.stretch,G),Vn=new N(Or,Ai),ai=new N(nn,Ai),Di=new N(nn,On),bn=new N(Or,On),sn=new N(Lr/g,Io/g),jn=new N(zi/g,Nn/g),on=t*Math.PI/180;if(on){const _r=Math.sin(on),Vr=Math.cos(on),qr=[Vr,-_r,_r,Vr];Vn._matMult(qr),ai._matMult(qr),bn._matMult(qr),Di._matMult(qr)}const to=Re.stretch+Re.fixed,ds=bt.stretch+bt.fixed;return{tl:Vn,tr:ai,bl:bn,br:Di,tex:{x:m.paddedRect.x+fh+to,y:m.paddedRect.y+fh+ds,w:_t.stretch+_t.fixed-to,h:Nt.stretch+Nt.fixed-ds},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:sn,pixelOffsetBR:jn,minFontScaleX:Ne/g/vt,minFontScaleY:Mt/g/ft,isSDF:i}};if(a&&(m.stretchX||m.stretchY)){const Re=wf(A,X,U),bt=wf(D,ie,G);for(let _t=0;_t<Re.length-1;_t++){const Nt=Re[_t],Or=Re[_t+1];for(let Lr=0;Lr<bt.length-1;Lr++)c.push(ct(Nt,bt[Lr],Or,bt[Lr+1]))}}else c.push(ct({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:x+1}));return c}function ip(r,t,i){let a=0;for(const c of r)a+=Math.max(t,Math.min(i,c[1]))-Math.max(t,Math.min(i,c[0]));return a}function wf(r,t,i){const a=[{fixed:-fh,stretch:0}];for(const[c,m]of r){const g=a[a.length-1];a.push({fixed:c-g.stretch,stretch:g.stretch}),a.push({fixed:c-g.stretch,stretch:g.stretch+(m-c)})}return a.push({fixed:t+fh,stretch:i}),a}function np(r,t,i,a){return r/t*i+a}function sp(r,t,i,a){return r-t*i/a}class op{constructor(t,i,a,c,m,g,_,x,E,A){var D;if(this.boxStartIndex=t.length,E){let B=g.top,U=g.bottom;const G=g.collisionPadding;G&&(B-=G[1],U+=G[3]);let X=U-B;X>0&&(X=Math.max(10,X),this.circleDiameter=X)}else{const B=!((D=g.image)===null||D===void 0)&&D.content&&(g.image.textFitWidth||g.image.textFitHeight)?pc(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};B.y1=B.y1*_-x[0],B.y2=B.y2*_+x[2],B.x1=B.x1*_-x[3],B.x2=B.x2*_+x[1];const U=g.collisionPadding;if(U&&(B.x1-=U[0]*_,B.y1-=U[1]*_,B.x2+=U[2]*_,B.y2+=U[3]*_),A){const G=new N(B.x1,B.y1),X=new N(B.x2,B.y1),ie=new N(B.x1,B.y2),le=new N(B.x2,B.y2),Se=A*Math.PI/180;G._rotate(Se),X._rotate(Se),ie._rotate(Se),le._rotate(Se),B.x1=Math.min(G.x,X.x,ie.x,le.x),B.x2=Math.max(G.x,X.x,ie.x,le.x),B.y1=Math.min(G.y,X.y,ie.y,le.y),B.y2=Math.max(G.y,X.y,ie.y,le.y)}t.emplaceBack(i.x,i.y,B.x1,B.y1,B.x2,B.y2,a,c,m)}this.boxEndIndex=t.length}}class Nm{constructor(t=[],i=((a,c)=>a<c?-1:a>c?1:0)){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:a}=this,c=i[t];for(;t>0;){const m=t-1>>1,g=i[m];if(a(c,g)>=0)break;i[t]=g,t=m}i[t]=c}_down(t){const{data:i,compare:a}=this,c=this.length>>1,m=i[t];for(;t<c;){let g=1+(t<<1);const _=g+1;if(_<this.length&&a(i[_],i[g])<0&&(g=_),a(i[g],m)>=0)break;i[t]=i[g],t=g}i[t]=m}}function Vm(r,t=1,i=!1){let a=1/0,c=1/0,m=-1/0,g=-1/0;const _=r[0];for(let U=0;U<_.length;U++){const G=_[U];(!U||G.x<a)&&(a=G.x),(!U||G.y<c)&&(c=G.y),(!U||G.x>m)&&(m=G.x),(!U||G.y>g)&&(g=G.y)}const x=Math.min(m-a,g-c);let E=x/2;const A=new Nm([],jm);if(x===0)return new N(a,c);for(let U=a;U<m;U+=x)for(let G=c;G<g;G+=x)A.push(new mh(U+E,G+E,E,r));let D=(function(U){let G=0,X=0,ie=0;const le=U[0];for(let Se=0,pe=le.length,xe=pe-1;Se<pe;xe=Se++){const ze=le[Se],Ne=le[xe],ot=ze.x*Ne.y-Ne.x*ze.y;X+=(ze.x+Ne.x)*ot,ie+=(ze.y+Ne.y)*ot,G+=3*ot}return new mh(X/G,ie/G,0,U)})(r),B=A.length;for(;A.length;){const U=A.pop();(U.d>D.d||!D.d)&&(D=U,i&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,B)),U.max-D.d<=t||(E=U.h/2,A.push(new mh(U.p.x-E,U.p.y-E,E,r)),A.push(new mh(U.p.x+E,U.p.y-E,E,r)),A.push(new mh(U.p.x-E,U.p.y+E,E,r)),A.push(new mh(U.p.x+E,U.p.y+E,E,r)),B+=4)}return i&&(console.log(`num probes: ${B}`),console.log(`best distance: ${D.d}`)),D.p}function jm(r,t){return t.max-r.max}function mh(r,t,i,a){this.p=new N(r,t),this.h=i,this.d=(function(c,m){let g=!1,_=1/0;for(let x=0;x<m.length;x++){const E=m[x];for(let A=0,D=E.length,B=D-1;A<D;B=A++){const U=E[A],G=E[B];U.y>c.y!=G.y>c.y&&c.x<(G.x-U.x)*(c.y-U.y)/(G.y-U.y)+U.x&&(g=!g),_=Math.min(_,Bh(c,U,G))}}return(g?1:-1)*Math.sqrt(_)})(this.p,a),this.max=this.d+this.h*Math.SQRT2}var rn;I.aq=void 0,(rn=I.aq||(I.aq={}))[rn.center=1]="center",rn[rn.left=2]="left",rn[rn.right=3]="right",rn[rn.top=4]="top",rn[rn.bottom=5]="bottom",rn[rn["top-left"]=6]="top-left",rn[rn["top-right"]=7]="top-right",rn[rn["bottom-left"]=8]="bottom-left",rn[rn["bottom-right"]=9]="bottom-right";const cu=7,Rp=Number.POSITIVE_INFINITY;function bf(r,t){return t[1]!==Rp?(function(i,a,c){let m=0,g=0;switch(a=Math.abs(a),c=Math.abs(c),i){case"top-right":case"top-left":case"top":g=c-cu;break;case"bottom-right":case"bottom-left":case"bottom":g=-c+cu}switch(i){case"top-right":case"bottom-right":case"right":m=-a;break;case"top-left":case"bottom-left":case"left":m=a}return[m,g]})(r,t[0],t[1]):(function(i,a){let c=0,m=0;a<0&&(a=0);const g=a/Math.SQRT2;switch(i){case"top-right":case"top-left":m=g-cu;break;case"bottom-right":case"bottom-left":m=-g+cu;break;case"bottom":m=-a+cu;break;case"top":m=a-cu}switch(i){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=a;break;case"right":c=-a}return[c,m]})(r,t[0])}function Sf(r,t,i){var a;const c=r.layout,m=(a=c.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},i);if(m){const _=m.values,x=[];for(let E=0;E<_.length;E+=2){const A=x[E]=_[E],D=_[E+1].map((B=>B*$r));A.startsWith("top")?D[1]-=cu:A.startsWith("bottom")&&(D[1]+=cu),x[E+1]=D}return new hn(x)}const g=c.get("text-variable-anchor");if(g){let _;_=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(t,{},i)*$r,Rp]:c.get("text-offset").evaluate(t,{},i).map((E=>E*$r));const x=[];for(const E of g)x.push(E,bf(E,_));return new hn(x)}return null}function Fp(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Um(r,t,i,a,c,m,g,_,x,E,A){let D=m.textMaxSize.evaluate(t,{});D===void 0&&(D=g);const B=r.layers[0].layout,U=B.get("icon-offset").evaluate(t,{},A),G=Tf(i.horizontal),X=g/24,ie=r.tilePixelRatio*X,le=r.tilePixelRatio*D/24,Se=r.tilePixelRatio*_,pe=r.tilePixelRatio*B.get("symbol-spacing"),xe=B.get("text-padding")*r.tilePixelRatio,ze=(function(Re,bt,_t,Nt=1){const Or=Re.get("icon-padding").evaluate(bt,{},_t),Lr=Or&&Or.values;return[Lr[0]*Nt,Lr[1]*Nt,Lr[2]*Nt,Lr[3]*Nt]})(B,t,A,r.tilePixelRatio),Ne=B.get("text-max-angle")/180*Math.PI,ot=B.get("text-rotation-alignment")!=="viewport"&&B.get("symbol-placement")!=="point",Mt=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",st=B.get("symbol-placement"),et=pe/2,vt=B.get("icon-text-fit");let ft;a&&vt!=="none"&&(r.allowVerticalPlacement&&i.vertical&&(ft=Va(a,i.vertical,vt,B.get("icon-text-fit-padding"),U,X)),G&&(a=Va(a,G,vt,B.get("icon-text-fit-padding"),U,X)));const ct=(Re,bt)=>{bt.x<0||bt.x>=ni||bt.y<0||bt.y>=ni||(function(_t,Nt,Or,Lr,Ai,Io,nn,zi,On,Nn,Vn,ai,Di,bn,sn,jn,on,to,ds,_r,Vr,qr,Ms,si,gh){const Ua=_t.addToLineVertexArray(Nt,Or);let $a,Po,ro,Ui,kl=0,od=0,Cf=0,Mf=0,qp=-1,Zp=-1;const Tl={};let Af=Pa("");if(_t.allowVerticalPlacement&&Lr.vertical){const Sn=zi.layout.get("text-rotate").evaluate(Vr,{},si)+90;ro=new op(On,Nt,Nn,Vn,ai,Lr.vertical,Di,bn,sn,Sn),nn&&(Ui=new op(On,Nt,Nn,Vn,ai,nn,on,to,sn,Sn))}if(Ai){const Sn=zi.layout.get("icon-rotate").evaluate(Vr,{}),io=zi.layout.get("icon-text-fit")!=="none",_c=xf(Ai,Sn,Ms,io),ra=nn?xf(nn,Sn,Ms,io):void 0;Po=new op(On,Nt,Nn,Vn,ai,Ai,on,to,!1,Sn),kl=4*_c.length;const vc=_t.iconSizeData;let qa=null;vc.kind==="source"?(qa=[Cs*zi.layout.get("icon-size").evaluate(Vr,{})],qa[0]>Eo&&Vt(`${_t.layerIds[0]}: Value for "icon-size" is >= ${ja}. Reduce your "icon-size".`)):vc.kind==="composite"&&(qa=[Cs*qr.compositeIconSizes[0].evaluate(Vr,{},si),Cs*qr.compositeIconSizes[1].evaluate(Vr,{},si)],(qa[0]>Eo||qa[1]>Eo)&&Vt(`${_t.layerIds[0]}: Value for "icon-size" is >= ${ja}. Reduce your "icon-size".`)),_t.addSymbols(_t.icon,_c,qa,_r,ds,Vr,I.ah.none,Nt,Ua.lineStartIndex,Ua.lineLength,-1,si),qp=_t.icon.placedSymbolArray.length-1,ra&&(od=4*ra.length,_t.addSymbols(_t.icon,ra,qa,_r,ds,Vr,I.ah.vertical,Nt,Ua.lineStartIndex,Ua.lineLength,-1,si),Zp=_t.icon.placedSymbolArray.length-1)}const zf=Object.keys(Lr.horizontal);for(const Sn of zf){const io=Lr.horizontal[Sn];if(!$a){Af=Pa(io.text);const ra=zi.layout.get("text-rotate").evaluate(Vr,{},si);$a=new op(On,Nt,Nn,Vn,ai,io,Di,bn,sn,ra)}const _c=io.positionedLines.length===1;if(Cf+=kf(_t,Nt,io,Io,zi,sn,Vr,jn,Ua,Lr.vertical?I.ah.horizontal:I.ah.horizontalOnly,_c?zf:[Sn],Tl,qp,qr,si),_c)break}Lr.vertical&&(Mf+=kf(_t,Nt,Lr.vertical,Io,zi,sn,Vr,jn,Ua,I.ah.vertical,["vertical"],Tl,Zp,qr,si));const Zm=$a?$a.boxStartIndex:_t.collisionBoxArray.length,Gm=$a?$a.boxEndIndex:_t.collisionBoxArray.length,Hm=ro?ro.boxStartIndex:_t.collisionBoxArray.length,Wm=ro?ro.boxEndIndex:_t.collisionBoxArray.length,Xm=Po?Po.boxStartIndex:_t.collisionBoxArray.length,Km=Po?Po.boxEndIndex:_t.collisionBoxArray.length,Ym=Ui?Ui.boxStartIndex:_t.collisionBoxArray.length,Jm=Ui?Ui.boxEndIndex:_t.collisionBoxArray.length;let ta=-1;const lp=(Sn,io)=>Sn&&Sn.circleDiameter?Math.max(Sn.circleDiameter,io):io;ta=lp($a,ta),ta=lp(ro,ta),ta=lp(Po,ta),ta=lp(Ui,ta);const Df=ta>-1?1:0;Df&&(ta*=gh/$r),_t.glyphOffsetArray.length>=lu.MAX_GLYPHS&&Vt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Vr.sortKey!==void 0&&_t.addToSortKeyRanges(_t.symbolInstances.length,Vr.sortKey);const Qm=Sf(zi,Vr,si),[eg,tg]=(function(Sn,io){const _c=Sn.length,ra=io?.values;if(ra?.length>0)for(let vc=0;vc<ra.length;vc+=2){const qa=ra[vc+1];Sn.emplaceBack(I.aq[ra[vc]],qa[0],qa[1])}return[_c,Sn.length]})(_t.textAnchorOffsets,Qm);_t.symbolInstances.emplaceBack(Nt.x,Nt.y,Tl.right>=0?Tl.right:-1,Tl.center>=0?Tl.center:-1,Tl.left>=0?Tl.left:-1,Tl.vertical||-1,qp,Zp,Af,Zm,Gm,Hm,Wm,Xm,Km,Ym,Jm,Nn,Cf,Mf,kl,od,Df,0,Di,ta,eg,tg)})(r,bt,Re,i,a,c,ft,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,ie,[xe,xe,xe,xe],ot,x,Se,ze,Mt,U,t,m,E,A,g)};if(st==="line")for(const Re of Ft(t.geometry,0,0,ni,ni)){const bt=Om(Re,pe,Ne,i.vertical||G,a,24,le,r.overscaling,ni);for(const _t of bt)G&&$m(r,G.text,et,_t)||ct(Re,_t)}else if(st==="line-center"){for(const Re of t.geometry)if(Re.length>1){const bt=Lp(Re,Ne,i.vertical||G,a,24,le);bt&&ct(Re,bt)}}else if(t.type==="Polygon")for(const Re of ha(t.geometry,0)){const bt=Vm(Re,16);ct(Re[0],new Ct(bt.x,bt.y,0))}else if(t.type==="LineString")for(const Re of t.geometry)ct(Re,new Ct(Re[0].x,Re[0].y,0));else if(t.type==="Point")for(const Re of t.geometry)for(const bt of Re)ct([bt],new Ct(bt.x,bt.y,0))}function kf(r,t,i,a,c,m,g,_,x,E,A,D,B,U,G){const X=(function(Se,pe,xe,ze,Ne,ot,Mt,st){const et=ze.layout.get("text-rotate").evaluate(ot,{})*Math.PI/180,vt=[];for(const ft of pe.positionedLines)for(const ct of ft.positionedGlyphs){if(!ct.rect)continue;const Re=ct.rect||{};let bt=ah+1,_t=!0,Nt=1,Or=0;const Lr=(Ne||st)&&ct.vertical,Ai=ct.metrics.advance*ct.scale/2;if(st&&pe.verticalizable&&(Or=ft.lineOffset/2-(ct.imageName?-($r-ct.metrics.width*ct.scale)/2:(ct.scale-1)*$r)),ct.imageName){const _r=Mt[ct.imageName];_t=_r.sdf,Nt=_r.pixelRatio,bt=wn/Nt}const Io=Ne?[ct.x+Ai,ct.y]:[0,0];let nn=Ne?[0,0]:[ct.x+Ai+xe[0],ct.y+xe[1]-Or],zi=[0,0];Lr&&(zi=nn,nn=[0,0]);const On=ct.metrics.isDoubleResolution?2:1,Nn=(ct.metrics.left-bt)*ct.scale-Ai+nn[0],Vn=(-ct.metrics.top-bt)*ct.scale+nn[1],ai=Nn+Re.w/On*ct.scale/Nt,Di=Vn+Re.h/On*ct.scale/Nt,bn=new N(Nn,Vn),sn=new N(ai,Vn),jn=new N(Nn,Di),on=new N(ai,Di);if(Lr){const _r=new N(-Ai,Ai-Qs),Vr=-Math.PI/2,qr=$r/2-Ai,Ms=new N(5-Qs-qr,-(ct.imageName?qr:0)),si=new N(...zi);bn._rotateAround(Vr,_r)._add(Ms)._add(si),sn._rotateAround(Vr,_r)._add(Ms)._add(si),jn._rotateAround(Vr,_r)._add(Ms)._add(si),on._rotateAround(Vr,_r)._add(Ms)._add(si)}if(et){const _r=Math.sin(et),Vr=Math.cos(et),qr=[Vr,-_r,_r,Vr];bn._matMult(qr),sn._matMult(qr),jn._matMult(qr),on._matMult(qr)}const to=new N(0,0),ds=new N(0,0);vt.push({tl:bn,tr:sn,bl:jn,br:on,tex:Re,writingMode:pe.writingMode,glyphOffset:Io,sectionIndex:ct.sectionIndex,isSDF:_t,pixelOffsetTL:to,pixelOffsetBR:ds,minFontScaleX:0,minFontScaleY:0})}return vt})(0,i,_,c,m,g,a,r.allowVerticalPlacement),ie=r.textSizeData;let le=null;ie.kind==="source"?(le=[Cs*c.layout.get("text-size").evaluate(g,{})],le[0]>Eo&&Vt(`${r.layerIds[0]}: Value for "text-size" is >= ${ja}. Reduce your "text-size".`)):ie.kind==="composite"&&(le=[Cs*U.compositeTextSizes[0].evaluate(g,{},G),Cs*U.compositeTextSizes[1].evaluate(g,{},G)],(le[0]>Eo||le[1]>Eo)&&Vt(`${r.layerIds[0]}: Value for "text-size" is >= ${ja}. Reduce your "text-size".`)),r.addSymbols(r.text,X,le,_,m,g,E,t,x.lineStartIndex,x.lineLength,B,G);for(const Se of A)D[Se]=r.text.placedSymbolArray.length-1;return 4*X.length}function Tf(r){for(const t in r)return r[t];return null}function $m(r,t,i,a){const c=r.compareText;if(t in c){const m=c[t];for(let g=m.length-1;g>=0;g--)if(a.dist(m[g])<i)return!0}else c[t]=[];return c[t].push(a),!1}const Ef=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Bp{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const m=Ef[15&a];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[_]=new Uint32Array(t,4,1);return new Bp(_,g,m,t)}constructor(t,i=64,a=Float64Array,c){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const m=Ef.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,_=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-_%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+_+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=i,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Op(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:_}=this,x=[0,m.length-1,0],E=[];for(;x.length;){const A=x.pop()||0,D=x.pop()||0,B=x.pop()||0;if(D-B<=_){for(let ie=B;ie<=D;ie++){const le=g[2*ie],Se=g[2*ie+1];le>=t&&le<=a&&Se>=i&&Se<=c&&E.push(m[ie])}continue}const U=B+D>>1,G=g[2*U],X=g[2*U+1];G>=t&&G<=a&&X>=i&&X<=c&&E.push(m[U]),(A===0?t<=G:i<=X)&&(x.push(B),x.push(U-1),x.push(1-A)),(A===0?a>=G:c>=X)&&(x.push(U+1),x.push(D),x.push(1-A))}return E}within(t,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:m,nodeSize:g}=this,_=[0,c.length-1,0],x=[],E=a*a;for(;_.length;){const A=_.pop()||0,D=_.pop()||0,B=_.pop()||0;if(D-B<=g){for(let ie=B;ie<=D;ie++)Pf(m[2*ie],m[2*ie+1],t,i)<=E&&x.push(c[ie]);continue}const U=B+D>>1,G=m[2*U],X=m[2*U+1];Pf(G,X,t,i)<=E&&x.push(c[U]),(A===0?t-a<=G:i-a<=X)&&(_.push(B),_.push(U-1),_.push(1-A)),(A===0?t+a>=G:i+a>=X)&&(_.push(U+1),_.push(D),_.push(1-A))}return x}}function Op(r,t,i,a,c,m){if(c-a<=i)return;const g=a+c>>1;If(r,t,g,a,c,m),Op(r,t,i,a,g-1,1-m),Op(r,t,i,g+1,c,1-m)}function If(r,t,i,a,c,m){for(;c>a;){if(c-a>600){const E=c-a+1,A=i-a+1,D=Math.log(E),B=.5*Math.exp(2*D/3),U=.5*Math.sqrt(D*B*(E-B)/E)*(A-E/2<0?-1:1);If(r,t,i,Math.max(a,Math.floor(i-A*B/E+U)),Math.min(c,Math.floor(i+(E-A)*B/E+U)),m)}const g=t[2*i+m];let _=a,x=c;for(nd(r,t,a,i),t[2*c+m]>g&&nd(r,t,a,c);_<x;){for(nd(r,t,_,x),_++,x--;t[2*_+m]<g;)_++;for(;t[2*x+m]>g;)x--}t[2*a+m]===g?nd(r,t,a,x):(x++,nd(r,t,x,c)),x<=i&&(a=x+1),i<=x&&(c=x-1)}}function nd(r,t,i,a){Np(r,i,a),Np(t,2*i,2*a),Np(t,2*i+1,2*a+1)}function Np(r,t,i){const a=r[t];r[t]=r[i],r[i]=a}function Pf(r,t,i,a){const c=r-i,m=t-a;return c*c+m*m}var Vp;I.bg=void 0,(Vp=I.bg||(I.bg={})).create="create",Vp.load="load",Vp.fullLoad="fullLoad";let ap=null,sd=[];const jp=1e3/60,Up="loadTime",$p="fullLoadTime",qm={mark(r){performance.mark(r)},frame(r){const t=r;ap!=null&&sd.push(t-ap),ap=t},clearMetrics(){ap=null,sd=[],performance.clearMeasures(Up),performance.clearMeasures($p);for(const r in I.bg)performance.clearMarks(I.bg[r])},getPerformanceMetrics(){performance.measure(Up,I.bg.create,I.bg.load),performance.measure($p,I.bg.create,I.bg.fullLoad);const r=performance.getEntriesByName(Up)[0].duration,t=performance.getEntriesByName($p)[0].duration,i=sd.length,a=1/(sd.reduce(((m,g)=>m+g),0)/i/1e3),c=sd.filter((m=>m>jp)).reduce(((m,g)=>m+(g-jp)/jp),0);return{loadTime:r,fullLoadTime:t,fps:a,percentDroppedFrames:c/(i+c)*100,totalFrames:i}}};I.$=class extends L{},I.A=eu,I.B=Bu,I.C=function(r){if(Gr==null){const t=r.navigator?r.navigator.userAgent:null;Gr=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Gr},I.D=lt,I.E=Mo,I.F=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new n((()=>this.process())),this.subscription=(function(i,a,c,m){return i.addEventListener(a,c,!1),{unsubscribe:()=>{i.removeEventListener(a,c,!1)}}})(this.target,"message",(i=>this.receive(i))),this.globalScope=Kr(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise(((i,a)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[c]={resolve:i,reject:a},t&&t.signal.addEventListener("abort",(()=>{delete this.resolveRejects[c];const _={id:c,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)}),{once:!0});const m=[],g=Object.assign(Object.assign({},r),{id:c,sourceMapId:this.mapId,origin:location.origin,data:Oi(r.data,m)});this.target.postMessage(g,{transfer:m})}))}receive(r){const t=r.data,i=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[i];const a=this.abortControllers[i];return delete this.abortControllers[i],void(a&&a.abort())}if(Kr(self)||t.mustQueue)return this.tasks[i]=t,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return h(this,void 0,void 0,(function*(){if(t.type==="<response>"){const c=this.resolveRejects[r];return delete this.resolveRejects[r],c?void(t.error?c.reject(Ts(t.error)):c.resolve(Ts(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=Ts(t.data),a=new AbortController;this.abortControllers[r]=a;try{const c=yield this.messageHandlers[t.type](t.sourceMapId,i,a);this.completeTask(r,null,c)}catch(c){this.completeTask(r,c)}}))}completeTask(r,t,i){const a=[];delete this.abortControllers[r];const c={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Oi(t):null,data:Oi(i,a)};this.target.postMessage(c,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},I.G=ar,I.H=function(){var r=new eu(16);return eu!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},I.I=Qh,I.J=function(r,t,i){var a,c,m,g,_,x,E,A,D,B,U,G,X=i[0],ie=i[1],le=i[2];return t===r?(r[12]=t[0]*X+t[4]*ie+t[8]*le+t[12],r[13]=t[1]*X+t[5]*ie+t[9]*le+t[13],r[14]=t[2]*X+t[6]*ie+t[10]*le+t[14],r[15]=t[3]*X+t[7]*ie+t[11]*le+t[15]):(c=t[1],m=t[2],g=t[3],_=t[4],x=t[5],E=t[6],A=t[7],D=t[8],B=t[9],U=t[10],G=t[11],r[0]=a=t[0],r[1]=c,r[2]=m,r[3]=g,r[4]=_,r[5]=x,r[6]=E,r[7]=A,r[8]=D,r[9]=B,r[10]=U,r[11]=G,r[12]=a*X+_*ie+D*le+t[12],r[13]=c*X+x*ie+B*le+t[13],r[14]=m*X+E*ie+U*le+t[14],r[15]=g*X+A*ie+G*le+t[15]),r},I.K=function(r,t,i){var a=i[0],c=i[1],m=i[2];return r[0]=t[0]*a,r[1]=t[1]*a,r[2]=t[2]*a,r[3]=t[3]*a,r[4]=t[4]*c,r[5]=t[5]*c,r[6]=t[6]*c,r[7]=t[7]*c,r[8]=t[8]*m,r[9]=t[9]*m,r[10]=t[10]*m,r[11]=t[11]*m,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},I.L=Vh,I.M=function(r,t){const i={};for(let a=0;a<t.length;a++){const c=t[a];c in r&&(i[c]=r[c])}return i},I.N=d,I.O=C,I.P=N,I.Q=Z,I.R=Mi,I.S=nt,I.T=bi,I.U=Le,I.V=tt,I.W=zt,I.X=ni,I.Y=v,I.Z=Ce,I._=h,I.a=Ht,I.a$=function(r,t){var i=r[0],a=r[1],c=r[2],m=r[3],g=r[4],_=r[5],x=r[6],E=r[7],A=r[8],D=r[9],B=r[10],U=r[11],G=r[12],X=r[13],ie=r[14],le=r[15],Se=t[0],pe=t[1],xe=t[2],ze=t[3],Ne=t[4],ot=t[5],Mt=t[6],st=t[7],et=t[8],vt=t[9],ft=t[10],ct=t[11],Re=t[12],bt=t[13],_t=t[14],Nt=t[15];return Math.abs(i-Se)<=Ji*Math.max(1,Math.abs(i),Math.abs(Se))&&Math.abs(a-pe)<=Ji*Math.max(1,Math.abs(a),Math.abs(pe))&&Math.abs(c-xe)<=Ji*Math.max(1,Math.abs(c),Math.abs(xe))&&Math.abs(m-ze)<=Ji*Math.max(1,Math.abs(m),Math.abs(ze))&&Math.abs(g-Ne)<=Ji*Math.max(1,Math.abs(g),Math.abs(Ne))&&Math.abs(_-ot)<=Ji*Math.max(1,Math.abs(_),Math.abs(ot))&&Math.abs(x-Mt)<=Ji*Math.max(1,Math.abs(x),Math.abs(Mt))&&Math.abs(E-st)<=Ji*Math.max(1,Math.abs(E),Math.abs(st))&&Math.abs(A-et)<=Ji*Math.max(1,Math.abs(A),Math.abs(et))&&Math.abs(D-vt)<=Ji*Math.max(1,Math.abs(D),Math.abs(vt))&&Math.abs(B-ft)<=Ji*Math.max(1,Math.abs(B),Math.abs(ft))&&Math.abs(U-ct)<=Ji*Math.max(1,Math.abs(U),Math.abs(ct))&&Math.abs(G-Re)<=Ji*Math.max(1,Math.abs(G),Math.abs(Re))&&Math.abs(X-bt)<=Ji*Math.max(1,Math.abs(X),Math.abs(bt))&&Math.abs(ie-_t)<=Ji*Math.max(1,Math.abs(ie),Math.abs(_t))&&Math.abs(le-Nt)<=Ji*Math.max(1,Math.abs(le),Math.abs(Nt))},I.a0=Yt,I.a1=qe,I.a2=$e,I.a3=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((i=>{t.onloadstart=()=>{i(t)};for(const a of r){const c=window.document.createElement("source");li(a)||(t.crossOrigin="Anonymous"),c.src=a,t.appendChild(c)}}))},I.a4=function(){return At++},I.a5=Qe,I.a6=lu,I.a7=nl,I.a8=za,I.a9=Te,I.aA=function(r){if(r.type==="custom")return new ph(r);switch(r.type){case"background":return new dh(r);case"circle":return new bp(r);case"fill":return new kp(r);case"fill-extrusion":return new Vd(r);case"heatmap":return new Sp(r);case"hillshade":return new Td(r);case"line":return new su(r);case"raster":return new Dp(r);case"symbol":return new Sl(r)}},I.aB=It,I.aC=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let i=[];try{if(!hr(r.version,t.version))return[{command:"setStyle",args:[t]}];hr(r.center,t.center)||i.push({command:"setCenter",args:[t.center]}),hr(r.zoom,t.zoom)||i.push({command:"setZoom",args:[t.zoom]}),hr(r.bearing,t.bearing)||i.push({command:"setBearing",args:[t.bearing]}),hr(r.pitch,t.pitch)||i.push({command:"setPitch",args:[t.pitch]}),hr(r.sprite,t.sprite)||i.push({command:"setSprite",args:[t.sprite]}),hr(r.glyphs,t.glyphs)||i.push({command:"setGlyphs",args:[t.glyphs]}),hr(r.transition,t.transition)||i.push({command:"setTransition",args:[t.transition]}),hr(r.light,t.light)||i.push({command:"setLight",args:[t.light]}),hr(r.terrain,t.terrain)||i.push({command:"setTerrain",args:[t.terrain]}),hr(r.sky,t.sky)||i.push({command:"setSky",args:[t.sky]}),hr(r.projection,t.projection)||i.push({command:"setProjection",args:[t.projection]});const a={},c=[];(function(g,_,x,E){let A;for(A in _=_||{},g=g||{})Object.prototype.hasOwnProperty.call(g,A)&&(Object.prototype.hasOwnProperty.call(_,A)||_s(A,x,E));for(A in _)Object.prototype.hasOwnProperty.call(_,A)&&(Object.prototype.hasOwnProperty.call(g,A)?hr(g[A],_[A])||(g[A].type==="geojson"&&_[A].type==="geojson"&&Ao(g,_,A)?Mr(x,{command:"setGeoJSONSourceData",args:[A,_[A].data]}):vs(A,_,x,E)):ys(A,_,x))})(r.sources,t.sources,c,a);const m=[];r.layers&&r.layers.forEach((g=>{"source"in g&&a[g.source]?i.push({command:"removeLayer",args:[g.id]}):m.push(g)})),i=i.concat(c),(function(g,_,x){_=_||[];const E=(g=g||[]).map(sa),A=_.map(sa),D=g.reduce(zo,{}),B=_.reduce(zo,{}),U=E.slice(),G=Object.create(null);let X,ie,le,Se,pe;for(let xe=0,ze=0;xe<E.length;xe++)X=E[xe],Object.prototype.hasOwnProperty.call(B,X)?ze++:(Mr(x,{command:"removeLayer",args:[X]}),U.splice(U.indexOf(X,ze),1));for(let xe=0,ze=0;xe<A.length;xe++)X=A[A.length-1-xe],U[U.length-1-xe]!==X&&(Object.prototype.hasOwnProperty.call(D,X)?(Mr(x,{command:"removeLayer",args:[X]}),U.splice(U.lastIndexOf(X,U.length-ze),1)):ze++,Se=U[U.length-xe],Mr(x,{command:"addLayer",args:[B[X],Se]}),U.splice(U.length-xe,0,X),G[X]=!0);for(let xe=0;xe<A.length;xe++)if(X=A[xe],ie=D[X],le=B[X],!G[X]&&!hr(ie,le))if(hr(ie.source,le.source)&&hr(ie["source-layer"],le["source-layer"])&&hr(ie.type,le.type)){for(pe in ln(ie.layout,le.layout,x,X,null,"setLayoutProperty"),ln(ie.paint,le.paint,x,X,null,"setPaintProperty"),hr(ie.filter,le.filter)||Mr(x,{command:"setFilter",args:[X,le.filter]}),hr(ie.minzoom,le.minzoom)&&hr(ie.maxzoom,le.maxzoom)||Mr(x,{command:"setLayerZoomRange",args:[X,le.minzoom,le.maxzoom]}),ie)Object.prototype.hasOwnProperty.call(ie,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?ln(ie[pe],le[pe],x,X,pe.slice(6),"setPaintProperty"):hr(ie[pe],le[pe])||Mr(x,{command:"setLayerProperty",args:[X,pe,le[pe]]}));for(pe in le)Object.prototype.hasOwnProperty.call(le,pe)&&!Object.prototype.hasOwnProperty.call(ie,pe)&&pe!=="layout"&&pe!=="paint"&&pe!=="filter"&&pe!=="metadata"&&pe!=="minzoom"&&pe!=="maxzoom"&&(pe.indexOf("paint.")===0?ln(ie[pe],le[pe],x,X,pe.slice(6),"setPaintProperty"):hr(ie[pe],le[pe])||Mr(x,{command:"setLayerProperty",args:[X,pe,le[pe]]}))}else Mr(x,{command:"removeLayer",args:[X]}),Se=U[U.lastIndexOf(X)+1],Mr(x,{command:"addLayer",args:[le,Se]})})(m,t.layers,i)}catch(a){console.warn("Unable to compute style diff:",a),i=[{command:"setStyle",args:[t]}]}return i},I.aD=function(r){const t=[],i=r.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},I.aE=function r(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let a=0;a<t.length;a++)if(!r(t[a],i[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&i!==null){if(typeof i!="object"||Object.keys(t).length!==Object.keys(i).length)return!1;for(const a in t)if(!r(t[a],i[a]))return!1;return!0}return t===i},I.aF=Zt,I.aG=nr,I.aH=class extends Wr{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},I.aI=di,I.aJ=class extends Wr{constructor(r,t){super(r,t),this.current=$u}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},I.aK=Uu,I.aL=Jl,I.aM=Ot,I.aN=class extends Wr{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},I.aO=class extends Wr{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},I.aP=function(r,t,i,a,c,m,g){var _=1/(t-i),x=1/(a-c),E=1/(m-g);return r[0]=-2*_,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*E,r[11]=0,r[12]=(t+i)*_,r[13]=(c+a)*x,r[14]=(g+m)*E,r[15]=1,r},I.aQ=jc,I.aR=class extends ge{},I.aS=nc,I.aT=class extends ke{},I.aU=Xu,I.aV=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},I.aW=Hc,I.aX=Jr,I.aY=zn,I.aZ=class extends dt{},I.a_=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},I.aa=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,a,c,m)=>{const g=c||m;return t[a]=!g||g.toLowerCase(),""})),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t},I.ab=function(r,t){const i=[];for(const a in r)a in t||i.push(a);return i},I.ac=mt,I.ad=function(r,t,i){var a=Math.sin(i),c=Math.cos(i),m=t[0],g=t[1],_=t[2],x=t[3],E=t[4],A=t[5],D=t[6],B=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=m*c+E*a,r[1]=g*c+A*a,r[2]=_*c+D*a,r[3]=x*c+B*a,r[4]=E*c-m*a,r[5]=A*c-g*a,r[6]=D*c-_*a,r[7]=B*c-x*a,r},I.ae=function(r){var t=new eu(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},I.af=Uc,I.ag=function(r,t){let i=0,a=0;if(r.kind==="constant")a=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:c,minZoom:m,maxZoom:g}=r,_=c?mt(yi.interpolationFactor(c,t,m,g),0,1):0;r.kind==="camera"?a=ri.number(r.minSize,r.maxSize,_):i=_}return{uSizeT:i,uSize:a}},I.ai=function(r,{uSize:t,uSizeT:i},{lowerSize:a,upperSize:c}){return r.kind==="source"?a/Cs:r.kind==="composite"?ri.number(a/Cs,c/Cs,i):t},I.aj=au,I.ak=function(r,t,i,a){const c=t.y-r.y,m=t.x-r.x,g=a.y-i.y,_=a.x-i.x,x=g*m-_*c;if(x===0)return null;const E=(_*(r.y-i.y)-g*(r.x-i.x))/x;return new N(r.x+E*m,r.y+E*c)},I.al=Ft,I.am=Rh,I.an=Vc,I.ao=function(r){let t=1/0,i=1/0,a=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),i=Math.min(i,m.y),a=Math.max(a,m.x),c=Math.max(c,m.y);return[t,i,a,c]},I.ap=$r,I.ar=fc,I.as=function(r,t){var i=t[0],a=t[1],c=t[2],m=t[3],g=t[4],_=t[5],x=t[6],E=t[7],A=t[8],D=t[9],B=t[10],U=t[11],G=t[12],X=t[13],ie=t[14],le=t[15],Se=i*_-a*g,pe=i*x-c*g,xe=i*E-m*g,ze=a*x-c*_,Ne=a*E-m*_,ot=c*E-m*x,Mt=A*X-D*G,st=A*ie-B*G,et=A*le-U*G,vt=D*ie-B*X,ft=D*le-U*X,ct=B*le-U*ie,Re=Se*ct-pe*ft+xe*vt+ze*et-Ne*st+ot*Mt;return Re?(r[0]=(_*ct-x*ft+E*vt)*(Re=1/Re),r[1]=(c*ft-a*ct-m*vt)*Re,r[2]=(X*ot-ie*Ne+le*ze)*Re,r[3]=(B*Ne-D*ot-U*ze)*Re,r[4]=(x*et-g*ct-E*st)*Re,r[5]=(i*ct-c*et+m*st)*Re,r[6]=(ie*xe-G*ot-le*pe)*Re,r[7]=(A*ot-B*xe+U*pe)*Re,r[8]=(g*ft-_*et+E*Mt)*Re,r[9]=(a*et-i*ft-m*Mt)*Re,r[10]=(G*Ne-X*xe+le*Se)*Re,r[11]=(D*xe-A*Ne-U*Se)*Re,r[12]=(_*st-g*vt-x*Mt)*Re,r[13]=(i*vt-a*st+c*Mt)*Re,r[14]=(X*pe-G*ze-ie*Se)*Re,r[15]=(A*ze-D*pe+B*Se)*Re,r):null},I.at=Fp,I.au=dc,I.av=Bp,I.aw=function(){const r={},t=Pe.$version;for(const i in Pe.$root){const a=Pe.$root[i];if(a.required){let c=null;c=i==="version"?t:a.type==="array"?[]:{},c!=null&&(r[i]=c)}}return r},I.ax=es,I.ay=tr,I.az=function(r){r=r.slice();const t=Object.create(null);for(let i=0;i<r.length;i++)t[r[i].id]=r[i];for(let i=0;i<r.length;i++)"ref"in r[i]&&(r[i]=na(r[i],t[r[i].ref]));return r},I.b=cr,I.b0=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},I.b1=function(r,t,i){return r[0]=t[0]*i[0],r[1]=t[1]*i[1],r[2]=t[2]*i[2],r[3]=t[3]*i[3],r},I.b2=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},I.b3=pt,I.b4=Ve,I.b5=ae,I.b6=function(r,t,i,a,c){var m,g=1/Math.tan(t/2);return r[0]=g/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0?(r[10]=(c+a)*(m=1/(a-c)),r[14]=2*c*a*m):(r[10]=-1,r[14]=-2*a),r},I.b7=function(r,t,i){var a=Math.sin(i),c=Math.cos(i),m=t[4],g=t[5],_=t[6],x=t[7],E=t[8],A=t[9],D=t[10],B=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=m*c+E*a,r[5]=g*c+A*a,r[6]=_*c+D*a,r[7]=x*c+B*a,r[8]=E*c-m*a,r[9]=A*c-g*a,r[10]=D*c-_*a,r[11]=B*c-x*a,r},I.b8=Ge,I.b9=rt,I.bA=To,I.bB=function(r){return r.message===Oe},I.bC=$o,I.bD=Er,I.ba=function(r){return r*Math.PI/180},I.bb=function(r,t){const{x:i,y:a}=Ce.fromLngLat(t);return!(r<0||r>25||a<0||a>=1||i<0||i>=1)},I.bc=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},I.bd=class extends M{},I.be=o,I.bf=qm,I.bh=ir,I.bi=function(r,t){Ht.REGISTERED_PROTOCOLS[r]=t},I.bj=function(r){delete Ht.REGISTERED_PROTOCOLS[r]},I.bk=function(r,t){const i={};for(let c=0;c<r.length;c++){const m=t&&t[r[c].id]||zu(r[c]);t&&(t[r[c].id]=m);let g=i[m];g||(g=i[m]=[]),g.push(r[c])}const a=[];for(const c in i)a.push(i[c]);return a},I.bl=at,I.bm=oi,I.bn=_e,I.bo=ed,I.bp=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=ni/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],i=t.layout,a=t._unevaluatedLayout._values,c={layoutIconSize:a["icon-size"].possiblyEvaluate(new rr(r.bucket.zoom+1),r.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new rr(r.bucket.zoom+1),r.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new rr(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:E,maxZoom:A}=r.bucket.textSizeData;c.compositeTextSizes=[a["text-size"].possiblyEvaluate(new rr(E),r.canonical),a["text-size"].possiblyEvaluate(new rr(A),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:E,maxZoom:A}=r.bucket.iconSizeData;c.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new rr(E),r.canonical),a["icon-size"].possiblyEvaluate(new rr(A),r.canonical)]}const m=i.get("text-line-height")*$r,g=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",_=i.get("text-keep-upright"),x=i.get("text-size");for(const E of r.bucket.features){const A=i.get("text-font").evaluate(E,{},r.canonical).join(","),D=x.evaluate(E,{},r.canonical),B=c.layoutTextSize.evaluate(E,{},r.canonical),U=c.layoutIconSize.evaluate(E,{},r.canonical),G={horizontal:{},vertical:void 0},X=E.text;let ie,le=[0,0];if(X){const xe=X.toString(),ze=i.get("text-letter-spacing").evaluate(E,{},r.canonical)*$r,Ne=Ah(xe)?ze:0,ot=i.get("text-anchor").evaluate(E,{},r.canonical),Mt=Sf(t,E,r.canonical);if(!Mt){const ft=i.get("text-radial-offset").evaluate(E,{},r.canonical);le=ft?bf(ot,[ft*$r,Rp]):i.get("text-offset").evaluate(E,{},r.canonical).map((ct=>ct*$r))}let st=g?"center":i.get("text-justify").evaluate(E,{},r.canonical);const et=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(E,{},r.canonical)*$r:1/0,vt=()=>{r.bucket.allowVerticalPlacement&&Ou(xe)&&(G.vertical=hc(X,r.glyphMap,r.glyphPositions,r.imagePositions,A,et,m,ot,"left",Ne,le,I.ah.vertical,!0,B,D))};if(!g&&Mt){const ft=new Set;if(st==="auto")for(let Re=0;Re<Mt.values.length;Re+=2)ft.add(Fp(Mt.values[Re]));else ft.add(st);let ct=!1;for(const Re of ft)if(!G.horizontal[Re])if(ct)G.horizontal[Re]=G.horizontal[0];else{const bt=hc(X,r.glyphMap,r.glyphPositions,r.imagePositions,A,et,m,"center",Re,Ne,le,I.ah.horizontal,!1,B,D);bt&&(G.horizontal[Re]=bt,ct=bt.positionedLines.length===1)}vt()}else{st==="auto"&&(st=Fp(ot));const ft=hc(X,r.glyphMap,r.glyphPositions,r.imagePositions,A,et,m,ot,st,Ne,le,I.ah.horizontal,!1,B,D);ft&&(G.horizontal[st]=ft),vt(),Ou(xe)&&g&&_&&(G.vertical=hc(X,r.glyphMap,r.glyphPositions,r.imagePositions,A,et,m,ot,st,Ne,le,I.ah.vertical,!1,B,D))}}let Se=!1;if(E.icon&&E.icon.name){const xe=r.imageMap[E.icon.name];xe&&(ie=Na(r.imagePositions[E.icon.name],i.get("icon-offset").evaluate(E,{},r.canonical),i.get("icon-anchor").evaluate(E,{},r.canonical)),Se=!!xe.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=Se:r.bucket.sdfIcons!==Se&&Vt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xe.pixelRatio!==r.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const pe=Tf(G.horizontal)||G.vertical;r.bucket.iconsInText=!!pe&&pe.iconsInText,(pe||ie)&&Um(r.bucket,E,G,ie,r.imageMap,c,B,U,le,Se,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},I.bq=Ln,I.br=Yc,I.bs=cs,I.bt=La,I.bu=Jo,I.bv=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},I.bw=function(r,t,i,a,c){return h(this,void 0,void 0,(function*(){if(tt())try{return yield zt(r,t,i,a,c)}catch{}return(function(m,g,_,x,E){const A=m.width,D=m.height;ht&&be||(ht=new OffscreenCanvas(A,D),be=ht.getContext("2d",{willReadFrequently:!0})),ht.width=A,ht.height=D,be.drawImage(m,0,0,A,D);const B=be.getImageData(g,_,x,E);return be.clearRect(0,0,A,D),B.data})(r,t,i,a,c)}))},I.bx=Tt,I.by=Y,I.bz=J,I.c=Gt,I.d=r=>h(void 0,void 0,void 0,(function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),I.e=St,I.f=r=>new Promise(((t,i)=>{const a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame((()=>{a.src=ut}))},a.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(r)],{type:"image/png"});a.src=r.byteLength?URL.createObjectURL(c):ut})),I.g=Jt,I.h=(r,t)=>Sr(St(r,{type:"json"}),t),I.i=Kr,I.j=gs,I.k=Zn,I.l=(r,t)=>Sr(St(r,{type:"arrayBuffer"}),t),I.m=Sr,I.n=function(r){return new Jo(r).readFields(bl,[])},I.o=gl,I.p=uc,I.q=f,I.r=Fu,I.s=li,I.t=Xl,I.u=Zs,I.v=Pe,I.w=Vt,I.x=function([r,t,i]){return t+=90,t*=Math.PI/180,i*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(i),y:r*Math.sin(t)*Math.sin(i),z:r*Math.cos(i)}},I.y=ri,I.z=rr})),F("worker",["./shared"],(function(I){class h{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,V){for(const te of j){this._layerConfigs[te.id]=te;const de=this._layers[te.id]=I.aA(te);de._featureFilter=I.a7(de.filter),this.keyCache[te.id]&&delete this.keyCache[te.id]}for(const te of V)delete this.keyCache[te],delete this._layerConfigs[te],delete this._layers[te];this.familiesBySource={};const W=I.bk(Object.values(this._layerConfigs),this.keyCache);for(const te of W){const de=te.map((Ee=>this._layers[Ee.id])),ye=de[0];if(ye.visibility==="none")continue;const we=ye.source||"";let ue=this.familiesBySource[we];ue||(ue=this.familiesBySource[we]={});const Me=ye.sourceLayer||"_geojsonTileLayer";let Be=ue[Me];Be||(Be=ue[Me]=[]),Be.push(de)}}}class Y{constructor(j){const V={},W=[];for(const we in j){const ue=j[we],Me=V[we]={};for(const Be in ue){const Ee=ue[+Be];if(!Ee||Ee.bitmap.width===0||Ee.bitmap.height===0)continue;const He={x:0,y:0,w:Ee.bitmap.width+2,h:Ee.bitmap.height+2};W.push(He),Me[Be]={rect:He,metrics:Ee.metrics}}}const{w:te,h:de}=I.p(W),ye=new I.o({width:te||1,height:de||1});for(const we in j){const ue=j[we];for(const Me in ue){const Be=ue[+Me];if(!Be||Be.bitmap.width===0||Be.bitmap.height===0)continue;const Ee=V[we][Me].rect;I.o.copy(Be.bitmap,ye,{x:0,y:0},{x:Ee.x+1,y:Ee.y+1},Be.bitmap)}}this.image=ye,this.positions=V}}I.bl("GlyphAtlas",Y);class J{constructor(j){this.tileID=new I.S(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[]}parse(j,V,W,te){return I._(this,void 0,void 0,(function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new I.a5;const de=new I.bm(Object.keys(j.layers).sort()),ye=new I.bn(this.tileID,this.promoteId);ye.bucketLayerIDs=[];const we={},ue={featureIndex:ye,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:W},Me=V.familiesBySource[this.source];for(const Kt in Me){const vr=j.layers[Kt];if(!vr)continue;vr.version===1&&I.w(`Vector tile source "${this.source}" layer "${Kt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Rr=de.encode(Kt),ci=[];for(let gi=0;gi<vr.length;gi++){const Ri=vr.feature(gi),oa=ye.getId(Ri,Kt);ci.push({feature:Ri,id:oa,index:gi,sourceLayerIndex:Rr})}for(const gi of Me[Kt]){const Ri=gi[0];Ri.source!==this.source&&I.w(`layer.source = ${Ri.source} does not equal this.source = ${this.source}`),Ri.minzoom&&this.zoom<Math.floor(Ri.minzoom)||Ri.maxzoom&&this.zoom>=Ri.maxzoom||Ri.visibility!=="none"&&(he(gi,this.zoom,W),(we[Ri.id]=Ri.createBucket({index:ye.bucketLayerIDs.length,layers:gi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Rr,sourceID:this.source})).populate(ci,ue,this.tileID.canonical),ye.bucketLayerIDs.push(gi.map((oa=>oa.id))))}}const Be=I.aF(ue.glyphDependencies,(Kt=>Object.keys(Kt).map(Number)));this.inFlightDependencies.forEach((Kt=>Kt?.abort())),this.inFlightDependencies=[];let Ee=Promise.resolve({});if(Object.keys(Be).length){const Kt=new AbortController;this.inFlightDependencies.push(Kt),Ee=te.sendAsync({type:"GG",data:{stacks:Be,source:this.source,tileID:this.tileID,type:"glyphs"}},Kt)}const He=Object.keys(ue.iconDependencies);let gt=Promise.resolve({});if(He.length){const Kt=new AbortController;this.inFlightDependencies.push(Kt),gt=te.sendAsync({type:"GI",data:{icons:He,source:this.source,tileID:this.tileID,type:"icons"}},Kt)}const kt=Object.keys(ue.patternDependencies);let dr=Promise.resolve({});if(kt.length){const Kt=new AbortController;this.inFlightDependencies.push(Kt),dr=te.sendAsync({type:"GI",data:{icons:kt,source:this.source,tileID:this.tileID,type:"patterns"}},Kt)}const[jt,pr,qt]=yield Promise.all([Ee,gt,dr]),ei=new Y(jt),jr=new I.bo(pr,qt);for(const Kt in we){const vr=we[Kt];vr instanceof I.a6?(he(vr.layers,this.zoom,W),I.bp({bucket:vr,glyphMap:jt,glyphPositions:ei.positions,imageMap:pr,imagePositions:jr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):vr.hasPattern&&(vr instanceof I.bq||vr instanceof I.br||vr instanceof I.bs)&&(he(vr.layers,this.zoom,W),vr.addFeatures(ue,this.tileID.canonical,jr.patternPositions))}return this.status="done",{buckets:Object.values(we).filter((Kt=>!Kt.isEmpty())),featureIndex:ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ei.image,imageAtlas:jr,glyphMap:this.returnDependencies?jt:null,iconMap:this.returnDependencies?pr:null,glyphPositions:this.returnDependencies?ei.positions:null}}))}}function he(ne,j,V){const W=new I.z(j);for(const te of ne)te.recalculate(W,V)}class N{constructor(j,V,W){this.actor=j,this.layerIndex=V,this.availableImages=W,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(j,V){return I._(this,void 0,void 0,(function*(){const W=yield I.l(j.request,V);try{return{vectorTile:new I.bt.VectorTile(new I.bu(W.data)),rawData:W.data,cacheControl:W.cacheControl,expires:W.expires}}catch(te){const de=new Uint8Array(W.data);let ye=`Unable to parse the tile at ${j.request.url}, `;throw ye+=de[0]===31&&de[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${te.message}`,new Error(ye)}}))}loadTile(j){return I._(this,void 0,void 0,(function*(){const V=j.uid,W=!!(j&&j.request&&j.request.collectResourceTiming)&&new I.bv(j.request),te=new J(j);this.loading[V]=te;const de=new AbortController;te.abort=de;try{const ye=yield this.loadVectorTile(j,de);if(delete this.loading[V],!ye)return null;const we=ye.rawData,ue={};ye.expires&&(ue.expires=ye.expires),ye.cacheControl&&(ue.cacheControl=ye.cacheControl);const Me={};if(W){const Ee=W.finish();Ee&&(Me.resourceTiming=JSON.parse(JSON.stringify(Ee)))}te.vectorTile=ye.vectorTile;const Be=te.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[V]=te,this.fetching[V]={rawTileData:we,cacheControl:ue,resourceTiming:Me};try{const Ee=yield Be;return I.e({rawTileData:we.slice(0)},Ee,ue,Me)}finally{delete this.fetching[V]}}catch(ye){throw delete this.loading[V],te.status="done",this.loaded[V]=te,ye}}))}reloadTile(j){return I._(this,void 0,void 0,(function*(){const V=j.uid;if(!this.loaded||!this.loaded[V])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const W=this.loaded[V];if(W.showCollisionBoxes=j.showCollisionBoxes,W.status==="parsing"){const te=yield W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor);let de;if(this.fetching[V]){const{rawTileData:ye,cacheControl:we,resourceTiming:ue}=this.fetching[V];delete this.fetching[V],de=I.e({rawTileData:ye.slice(0)},te,we,ue)}else de=te;return de}if(W.status==="done"&&W.vectorTile)return W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor)}))}abortTile(j){return I._(this,void 0,void 0,(function*(){const V=this.loading,W=j.uid;V&&V[W]&&V[W].abort&&(V[W].abort.abort(),delete V[W])}))}removeTile(j){return I._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]}))}}class ${constructor(){this.loaded={}}loadTile(j){return I._(this,void 0,void 0,(function*(){const{uid:V,encoding:W,rawImageData:te,redFactor:de,greenFactor:ye,blueFactor:we,baseShift:ue}=j,Me=te.width+2,Be=te.height+2,Ee=I.b(te)?new I.R({width:Me,height:Be},yield I.bw(te,-1,-1,Me,Be)):te,He=new I.bx(V,Ee,W,de,ye,we,ue);return this.loaded=this.loaded||{},this.loaded[V]=He,He}))}removeTile(j){const V=this.loaded,W=j.uid;V&&V[W]&&delete V[W]}}function fe(ne,j){if(ne.length!==0){Ae(ne[0],j);for(var V=1;V<ne.length;V++)Ae(ne[V],!j)}}function Ae(ne,j){for(var V=0,W=0,te=0,de=ne.length,ye=de-1;te<de;ye=te++){var we=(ne[te][0]-ne[ye][0])*(ne[ye][1]+ne[te][1]),ue=V+we;W+=Math.abs(V)>=Math.abs(we)?V-ue+we:we-ue+V,V=ue}V+W>=0!=!!j&&ne.reverse()}var se=I.by((function ne(j,V){var W,te=j&&j.type;if(te==="FeatureCollection")for(W=0;W<j.features.length;W++)ne(j.features[W],V);else if(te==="GeometryCollection")for(W=0;W<j.geometries.length;W++)ne(j.geometries[W],V);else if(te==="Feature")ne(j.geometry,V);else if(te==="Polygon")fe(j.coordinates,V);else if(te==="MultiPolygon")for(W=0;W<j.coordinates.length;W++)fe(j.coordinates[W],V);return j}));const De=I.bt.VectorTileFeature.prototype.toGeoJSON;var Le={exports:{}},tt=I.bz,Ge=I.bt.VectorTileFeature,rt=mt;function mt(ne,j){this.options=j||{},this.features=ne,this.length=ne.length}function pt(ne,j){this.id=typeof ne.id=="number"?ne.id:void 0,this.type=ne.type,this.rawGeometry=ne.type===1?[ne.geometry]:ne.geometry,this.properties=ne.tags,this.extent=j||4096}mt.prototype.feature=function(ne){return new pt(this.features[ne],this.options.extent)},pt.prototype.loadGeometry=function(){var ne=this.rawGeometry;this.geometry=[];for(var j=0;j<ne.length;j++){for(var V=ne[j],W=[],te=0;te<V.length;te++)W.push(new tt(V[te][0],V[te][1]));this.geometry.push(W)}return this.geometry},pt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ne=this.geometry,j=1/0,V=-1/0,W=1/0,te=-1/0,de=0;de<ne.length;de++)for(var ye=ne[de],we=0;we<ye.length;we++){var ue=ye[we];j=Math.min(j,ue.x),V=Math.max(V,ue.x),W=Math.min(W,ue.y),te=Math.max(te,ue.y)}return[j,W,V,te]},pt.prototype.toGeoJSON=Ge.prototype.toGeoJSON;var St=I.bA,At=rt;function Zt(ne){var j=new St;return(function(V,W){for(var te in V.layers)W.writeMessage(3,nr,V.layers[te])})(ne,j),j.finish()}function nr(ne,j){var V;j.writeVarintField(15,ne.version||1),j.writeStringField(1,ne.name||""),j.writeVarintField(5,ne.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<ne.length;V++)W.feature=ne.feature(V),j.writeMessage(2,It,W);var te=W.keys;for(V=0;V<te.length;V++)j.writeStringField(3,te[V]);var de=W.values;for(V=0;V<de.length;V++)j.writeMessage(4,Gr,de[V])}function It(ne,j){var V=ne.feature;V.id!==void 0&&j.writeVarintField(1,V.id),j.writeMessage(2,sr,ne),j.writeVarintField(3,V.type),j.writeMessage(4,Kr,V)}function sr(ne,j){var V=ne.feature,W=ne.keys,te=ne.values,de=ne.keycache,ye=ne.valuecache;for(var we in V.properties){var ue=V.properties[we],Me=de[we];if(ue!==null){Me===void 0&&(W.push(we),de[we]=Me=W.length-1),j.writeVarint(Me);var Be=typeof ue;Be!=="string"&&Be!=="boolean"&&Be!=="number"&&(ue=JSON.stringify(ue));var Ee=Be+":"+ue,He=ye[Ee];He===void 0&&(te.push(ue),ye[Ee]=He=te.length-1),j.writeVarint(He)}}}function Vt(ne,j){return(j<<3)+(7&ne)}function or(ne){return ne<<1^ne>>31}function Kr(ne,j){for(var V=ne.loadGeometry(),W=ne.type,te=0,de=0,ye=V.length,we=0;we<ye;we++){var ue=V[we],Me=1;W===1&&(Me=ue.length),j.writeVarint(Vt(1,Me));for(var Be=W===3?ue.length-1:ue.length,Ee=0;Ee<Be;Ee++){Ee===1&&W!==1&&j.writeVarint(Vt(2,Be-1));var He=ue[Ee].x-te,gt=ue[Ee].y-de;j.writeVarint(or(He)),j.writeVarint(or(gt)),te+=He,de+=gt}W===3&&j.writeVarint(Vt(7,1))}}function Gr(ne,j){var V=typeof ne;V==="string"?j.writeStringField(1,ne):V==="boolean"?j.writeBooleanField(7,ne):V==="number"&&(ne%1!=0?j.writeDoubleField(3,ne):ne<0?j.writeSVarintField(6,ne):j.writeVarintField(5,ne))}Le.exports=Zt,Le.exports.fromVectorTileJs=Zt,Le.exports.fromGeojsonVt=function(ne,j){j=j||{};var V={};for(var W in ne)V[W]=new At(ne[W].features,j),V[W].name=W,V[W].version=j.version,V[W].extent=j.extent;return Zt({layers:V})},Le.exports.GeoJSONWrapper=At;var cr=I.by(Le.exports);const ut={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ne=>ne},zt=Math.fround||(ht=new Float32Array(1),ne=>(ht[0]=+ne,ht[0]));var ht;const be=3,Oe=5,Gt=6;class Ht{constructor(j){this.options=Object.assign(Object.create(ut),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:V,minZoom:W,maxZoom:te}=this.options;V&&console.time("total time");const de=`prepare ${j.length} points`;V&&console.time(de),this.points=j;const ye=[];for(let ue=0;ue<j.length;ue++){const Me=j[ue];if(!Me.geometry)continue;const[Be,Ee]=Me.geometry.coordinates,He=zt(ir(Be)),gt=zt(tr(Ee));ye.push(He,gt,1/0,ue,-1,1),this.options.reduce&&ye.push(0)}let we=this.trees[te+1]=this._createTree(ye);V&&console.timeEnd(de);for(let ue=te;ue>=W;ue--){const Me=+Date.now();we=this.trees[ue]=this._createTree(this._cluster(we,ue)),V&&console.log("z%d: %d clusters in %dms",ue,we.numItems,+Date.now()-Me)}return V&&console.timeEnd("total time"),this}getClusters(j,V){let W=((j[0]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,j[1]));let de=j[2]===180?180:((j[2]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)W=-180,de=180;else if(W>de){const Ee=this.getClusters([W,te,180,ye],V),He=this.getClusters([-180,te,de,ye],V);return Ee.concat(He)}const we=this.trees[this._limitZoom(V)],ue=we.range(ir(W),tr(ye),ir(de),tr(te)),Me=we.data,Be=[];for(const Ee of ue){const He=this.stride*Ee;Be.push(Me[He+Oe]>1?Jt(Me,He,this.clusterProps):this.points[Me[He+be]])}return Be}getChildren(j){const V=this._getOriginId(j),W=this._getOriginZoom(j),te="No cluster with the specified id.",de=this.trees[W];if(!de)throw new Error(te);const ye=de.data;if(V*this.stride>=ye.length)throw new Error(te);const we=this.options.radius/(this.options.extent*Math.pow(2,W-1)),ue=de.within(ye[V*this.stride],ye[V*this.stride+1],we),Me=[];for(const Be of ue){const Ee=Be*this.stride;ye[Ee+4]===j&&Me.push(ye[Ee+Oe]>1?Jt(ye,Ee,this.clusterProps):this.points[ye[Ee+be]])}if(Me.length===0)throw new Error(te);return Me}getLeaves(j,V,W){const te=[];return this._appendLeaves(te,j,V=V||10,W=W||0,0),te}getTile(j,V,W){const te=this.trees[this._limitZoom(j)],de=Math.pow(2,j),{extent:ye,radius:we}=this.options,ue=we/ye,Me=(W-ue)/de,Be=(W+1+ue)/de,Ee={features:[]};return this._addTileFeatures(te.range((V-ue)/de,Me,(V+1+ue)/de,Be),te.data,V,W,de,Ee),V===0&&this._addTileFeatures(te.range(1-ue/de,Me,1,Be),te.data,de,W,de,Ee),V===de-1&&this._addTileFeatures(te.range(0,Me,ue/de,Be),te.data,-1,W,de,Ee),Ee.features.length?Ee:null}getClusterExpansionZoom(j){let V=this._getOriginZoom(j)-1;for(;V<=this.options.maxZoom;){const W=this.getChildren(j);if(V++,W.length!==1)break;j=W[0].properties.cluster_id}return V}_appendLeaves(j,V,W,te,de){const ye=this.getChildren(V);for(const we of ye){const ue=we.properties;if(ue&&ue.cluster?de+ue.point_count<=te?de+=ue.point_count:de=this._appendLeaves(j,ue.cluster_id,W,te,de):de<te?de++:j.push(we),j.length===W)break}return de}_createTree(j){const V=new I.av(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let W=0;W<j.length;W+=this.stride)V.add(j[W],j[W+1]);return V.finish(),V.data=j,V}_addTileFeatures(j,V,W,te,de,ye){for(const we of j){const ue=we*this.stride,Me=V[ue+Oe]>1;let Be,Ee,He;if(Me)Be=ar(V,ue,this.clusterProps),Ee=V[ue],He=V[ue+1];else{const dr=this.points[V[ue+be]];Be=dr.properties;const[jt,pr]=dr.geometry.coordinates;Ee=ir(jt),He=tr(pr)}const gt={type:1,geometry:[[Math.round(this.options.extent*(Ee*de-W)),Math.round(this.options.extent*(He*de-te))]],tags:Be};let kt;kt=Me||this.options.generateId?V[ue+be]:this.points[V[ue+be]].id,kt!==void 0&&(gt.id=kt),ye.features.push(gt)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,V){const{radius:W,extent:te,reduce:de,minPoints:ye}=this.options,we=W/(te*Math.pow(2,V)),ue=j.data,Me=[],Be=this.stride;for(let Ee=0;Ee<ue.length;Ee+=Be){if(ue[Ee+2]<=V)continue;ue[Ee+2]=V;const He=ue[Ee],gt=ue[Ee+1],kt=j.within(ue[Ee],ue[Ee+1],we),dr=ue[Ee+Oe];let jt=dr;for(const pr of kt){const qt=pr*Be;ue[qt+2]>V&&(jt+=ue[qt+Oe])}if(jt>dr&&jt>=ye){let pr,qt=He*dr,ei=gt*dr,jr=-1;const Kt=((Ee/Be|0)<<5)+(V+1)+this.points.length;for(const vr of kt){const Rr=vr*Be;if(ue[Rr+2]<=V)continue;ue[Rr+2]=V;const ci=ue[Rr+Oe];qt+=ue[Rr]*ci,ei+=ue[Rr+1]*ci,ue[Rr+4]=Kt,de&&(pr||(pr=this._map(ue,Ee,!0),jr=this.clusterProps.length,this.clusterProps.push(pr)),de(pr,this._map(ue,Rr)))}ue[Ee+4]=Kt,Me.push(qt/jt,ei/jt,1/0,Kt,-1,jt),de&&Me.push(jr)}else{for(let pr=0;pr<Be;pr++)Me.push(ue[Ee+pr]);if(jt>1)for(const pr of kt){const qt=pr*Be;if(!(ue[qt+2]<=V)){ue[qt+2]=V;for(let ei=0;ei<Be;ei++)Me.push(ue[qt+ei])}}}}return Me}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,V,W){if(j[V+Oe]>1){const ye=this.clusterProps[j[V+Gt]];return W?Object.assign({},ye):ye}const te=this.points[j[V+be]].properties,de=this.options.map(te);return W&&de===te?Object.assign({},de):de}}function Jt(ne,j,V){return{type:"Feature",id:ne[j+be],properties:ar(ne,j,V),geometry:{type:"Point",coordinates:[(W=ne[j],360*(W-.5)),Sr(ne[j+1])]}};var W}function ar(ne,j,V){const W=ne[j+Oe],te=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W,de=ne[j+Gt],ye=de===-1?{}:Object.assign({},V[de]);return Object.assign(ye,{cluster:!0,cluster_id:ne[j+be],point_count:W,point_count_abbreviated:te})}function ir(ne){return ne/360+.5}function tr(ne){const j=Math.sin(ne*Math.PI/180),V=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return V<0?0:V>1?1:V}function Sr(ne){const j=(180-360*ne)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function li(ne,j,V,W){let te=W;const de=j+(V-j>>1);let ye,we=V-j;const ue=ne[j],Me=ne[j+1],Be=ne[V],Ee=ne[V+1];for(let He=j+3;He<V;He+=3){const gt=oo(ne[He],ne[He+1],ue,Me,Be,Ee);if(gt>te)ye=He,te=gt;else if(gt===te){const kt=Math.abs(He-de);kt<we&&(ye=He,we=kt)}}te>W&&(ye-j>3&&li(ne,j,ye,W),ne[ye+2]=te,V-ye>3&&li(ne,ye,V,W))}function oo(ne,j,V,W,te,de){let ye=te-V,we=de-W;if(ye!==0||we!==0){const ue=((ne-V)*ye+(j-W)*we)/(ye*ye+we*we);ue>1?(V=te,W=de):ue>0&&(V+=ye*ue,W+=we*ue)}return ye=ne-V,we=j-W,ye*ye+we*we}function ms(ne,j,V,W){const te={id:ne??null,type:j,geometry:V,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")Zn(te,V);else if(j==="Polygon")Zn(te,V[0]);else if(j==="MultiLineString")for(const de of V)Zn(te,de);else if(j==="MultiPolygon")for(const de of V)Zn(te,de[0]);return te}function Zn(ne,j){for(let V=0;V<j.length;V+=3)ne.minX=Math.min(ne.minX,j[V]),ne.minY=Math.min(ne.minY,j[V+1]),ne.maxX=Math.max(ne.maxX,j[V]),ne.maxY=Math.max(ne.maxY,j[V+1])}function gs(ne,j,V,W){if(!j.geometry)return;const te=j.geometry.coordinates;if(te&&te.length===0)return;const de=j.geometry.type,ye=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2);let we=[],ue=j.id;if(V.promoteId?ue=j.properties[V.promoteId]:V.generateId&&(ue=W||0),de==="Point")Mo(te,we);else if(de==="MultiPoint")for(const Me of te)Mo(Me,we);else if(de==="LineString")Pe(te,we,ye,!1);else if(de==="MultiLineString"){if(V.lineMetrics){for(const Me of te)we=[],Pe(Me,we,ye,!1),ne.push(ms(ue,"LineString",we,j.properties));return}zs(te,we,ye,!1)}else if(de==="Polygon")zs(te,we,ye,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(const Me of j.geometry.geometries)gs(ne,{id:ue,geometry:Me,properties:j.properties},V,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Me of te){const Be=[];zs(Me,Be,ye,!0),we.push(Be)}}ne.push(ms(ue,de,we,j.properties))}function Mo(ne,j){j.push(na(ne[0]),hr(ne[1]),0)}function Pe(ne,j,V,W){let te,de,ye=0;for(let ue=0;ue<ne.length;ue++){const Me=na(ne[ue][0]),Be=hr(ne[ue][1]);j.push(Me,Be,0),ue>0&&(ye+=W?(te*Be-Me*de)/2:Math.sqrt(Math.pow(Me-te,2)+Math.pow(Be-de,2))),te=Me,de=Be}const we=j.length-3;j[2]=1,li(j,0,we,V),j[we+2]=1,j.size=Math.abs(ye),j.start=0,j.end=j.size}function zs(ne,j,V,W){for(let te=0;te<ne.length;te++){const de=[];Pe(ne[te],de,V,W),j.push(de)}}function na(ne){return ne/360+.5}function hr(ne){const j=Math.sin(ne*Math.PI/180),V=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return V<0?0:V>1?1:V}function Mr(ne,j,V,W,te,de,ye,we){if(W/=j,de>=(V/=j)&&ye<W)return ne;if(ye<V||de>=W)return null;const ue=[];for(const Me of ne){const Be=Me.geometry;let Ee=Me.type;const He=te===0?Me.minX:Me.minY,gt=te===0?Me.maxX:Me.maxY;if(He>=V&&gt<W){ue.push(Me);continue}if(gt<V||He>=W)continue;let kt=[];if(Ee==="Point"||Ee==="MultiPoint")ys(Be,kt,V,W,te);else if(Ee==="LineString")_s(Be,kt,V,W,te,!1,we.lineMetrics);else if(Ee==="MultiLineString")Ao(Be,kt,V,W,te,!1);else if(Ee==="Polygon")Ao(Be,kt,V,W,te,!0);else if(Ee==="MultiPolygon")for(const dr of Be){const jt=[];Ao(dr,jt,V,W,te,!0),jt.length&&kt.push(jt)}if(kt.length){if(we.lineMetrics&&Ee==="LineString"){for(const dr of kt)ue.push(ms(Me.id,Ee,dr,Me.tags));continue}Ee!=="LineString"&&Ee!=="MultiLineString"||(kt.length===1?(Ee="LineString",kt=kt[0]):Ee="MultiLineString"),Ee!=="Point"&&Ee!=="MultiPoint"||(Ee=kt.length===3?"Point":"MultiPoint"),ue.push(ms(Me.id,Ee,kt,Me.tags))}}return ue.length?ue:null}function ys(ne,j,V,W,te){for(let de=0;de<ne.length;de+=3){const ye=ne[de+te];ye>=V&&ye<=W&&ln(j,ne[de],ne[de+1],ne[de+2])}}function _s(ne,j,V,W,te,de,ye){let we=vs(ne);const ue=te===0?sa:zo;let Me,Be,Ee=ne.start;for(let jt=0;jt<ne.length-3;jt+=3){const pr=ne[jt],qt=ne[jt+1],ei=ne[jt+2],jr=ne[jt+3],Kt=ne[jt+4],vr=te===0?pr:qt,Rr=te===0?jr:Kt;let ci=!1;ye&&(Me=Math.sqrt(Math.pow(pr-jr,2)+Math.pow(qt-Kt,2))),vr<V?Rr>V&&(Be=ue(we,pr,qt,jr,Kt,V),ye&&(we.start=Ee+Me*Be)):vr>W?Rr<W&&(Be=ue(we,pr,qt,jr,Kt,W),ye&&(we.start=Ee+Me*Be)):ln(we,pr,qt,ei),Rr<V&&vr>=V&&(Be=ue(we,pr,qt,jr,Kt,V),ci=!0),Rr>W&&vr<=W&&(Be=ue(we,pr,qt,jr,Kt,W),ci=!0),!de&&ci&&(ye&&(we.end=Ee+Me*Be),j.push(we),we=vs(ne)),ye&&(Ee+=Me)}let He=ne.length-3;const gt=ne[He],kt=ne[He+1],dr=te===0?gt:kt;dr>=V&&dr<=W&&ln(we,gt,kt,ne[He+2]),He=we.length-3,de&&He>=3&&(we[He]!==we[0]||we[He+1]!==we[1])&&ln(we,we[0],we[1],we[2]),we.length&&j.push(we)}function vs(ne){const j=[];return j.size=ne.size,j.start=ne.start,j.end=ne.end,j}function Ao(ne,j,V,W,te,de){for(const ye of ne)_s(ye,j,V,W,te,de,!1)}function ln(ne,j,V,W){ne.push(j,V,W)}function sa(ne,j,V,W,te,de){const ye=(de-j)/(W-j);return ln(ne,de,V+(te-V)*ye,1),ye}function zo(ne,j,V,W,te,de){const ye=(de-V)/(te-V);return ln(ne,j+(W-j)*ye,de,1),ye}function $e(ne,j){const V=[];for(let W=0;W<ne.length;W++){const te=ne[W],de=te.type;let ye;if(de==="Point"||de==="MultiPoint"||de==="LineString")ye=Gn(te.geometry,j);else if(de==="MultiLineString"||de==="Polygon"){ye=[];for(const we of te.geometry)ye.push(Gn(we,j))}else if(de==="MultiPolygon"){ye=[];for(const we of te.geometry){const ue=[];for(const Me of we)ue.push(Gn(Me,j));ye.push(ue)}}V.push(ms(te.id,de,ye,te.tags))}return V}function Gn(ne,j){const V=[];V.size=ne.size,ne.start!==void 0&&(V.start=ne.start,V.end=ne.end);for(let W=0;W<ne.length;W+=3)V.push(ne[W]+j,ne[W+1],ne[W+2]);return V}function ui(ne,j){if(ne.transformed)return ne;const V=1<<ne.z,W=ne.x,te=ne.y;for(const de of ne.features){const ye=de.geometry,we=de.type;if(de.geometry=[],we===1)for(let ue=0;ue<ye.length;ue+=2)de.geometry.push($i(ye[ue],ye[ue+1],j,V,W,te));else for(let ue=0;ue<ye.length;ue++){const Me=[];for(let Be=0;Be<ye[ue].length;Be+=2)Me.push($i(ye[ue][Be],ye[ue][Be+1],j,V,W,te));de.geometry.push(Me)}}return ne.transformed=!0,ne}function $i(ne,j,V,W,te,de){return[Math.round(V*(ne*W-te)),Math.round(V*(j*W-de))]}function ao(ne,j,V,W,te){const de=j===te.maxZoom?0:te.tolerance/((1<<j)*te.extent),ye={features:[],numPoints:0,numSimplified:0,numFeatures:ne.length,source:null,x:V,y:W,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const we of ne)Ke(ye,we,de,te);return ye}function Ke(ne,j,V,W){const te=j.geometry,de=j.type,ye=[];if(ne.minX=Math.min(ne.minX,j.minX),ne.minY=Math.min(ne.minY,j.minY),ne.maxX=Math.max(ne.maxX,j.maxX),ne.maxY=Math.max(ne.maxY,j.maxY),de==="Point"||de==="MultiPoint")for(let we=0;we<te.length;we+=3)ye.push(te[we],te[we+1]),ne.numPoints++,ne.numSimplified++;else if(de==="LineString")Wt(ye,te,ne,V,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(let we=0;we<te.length;we++)Wt(ye,te[we],ne,V,de==="Polygon",we===0);else if(de==="MultiPolygon")for(let we=0;we<te.length;we++){const ue=te[we];for(let Me=0;Me<ue.length;Me++)Wt(ye,ue[Me],ne,V,!0,Me===0)}if(ye.length){let we=j.tags||null;if(de==="LineString"&&W.lineMetrics){we={};for(const Me in j.tags)we[Me]=j.tags[Me];we.mapbox_clip_start=te.start/te.size,we.mapbox_clip_end=te.end/te.size}const ue={geometry:ye,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:we};j.id!==null&&(ue.id=j.id),ne.features.push(ue)}}function Wt(ne,j,V,W,te,de){const ye=W*W;if(W>0&&j.size<(te?ye:W))return void(V.numPoints+=j.length/3);const we=[];for(let ue=0;ue<j.length;ue+=3)(W===0||j[ue+2]>ye)&&(V.numSimplified++,we.push(j[ue],j[ue+1])),V.numPoints++;te&&(function(ue,Me){let Be=0;for(let Ee=0,He=ue.length,gt=He-2;Ee<He;gt=Ee,Ee+=2)Be+=(ue[Ee]-ue[gt])*(ue[Ee+1]+ue[gt+1]);if(Be>0===Me)for(let Ee=0,He=ue.length;Ee<He/2;Ee+=2){const gt=ue[Ee],kt=ue[Ee+1];ue[Ee]=ue[He-2-Ee],ue[Ee+1]=ue[He-1-Ee],ue[He-2-Ee]=gt,ue[He-1-Ee]=kt}})(we,de),ne.push(we)}const Dt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ii{constructor(j,V){const W=(V=this.options=(function(de,ye){for(const we in ye)de[we]=ye[we];return de})(Object.create(Dt),V)).debug;if(W&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");let te=(function(de,ye){const we=[];if(de.type==="FeatureCollection")for(let ue=0;ue<de.features.length;ue++)gs(we,de.features[ue],ye,ue);else gs(we,de.type==="Feature"?de:{geometry:de},ye);return we})(j,V);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=(function(de,ye){const we=ye.buffer/ye.extent;let ue=de;const Me=Mr(de,1,-1-we,we,0,-1,2,ye),Be=Mr(de,1,1-we,2+we,0,-1,2,ye);return(Me||Be)&&(ue=Mr(de,1,-we,1+we,0,-1,2,ye)||[],Me&&(ue=$e(Me,1).concat(ue)),Be&&(ue=ue.concat($e(Be,-1)))),ue})(te,V),te.length&&this.splitTile(te,0,0,0),W&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,V,W,te,de,ye,we){const ue=[j,V,W,te],Me=this.options,Be=Me.debug;for(;ue.length;){te=ue.pop(),W=ue.pop(),V=ue.pop(),j=ue.pop();const Ee=1<<V,He=un(V,W,te);let gt=this.tiles[He];if(!gt&&(Be>1&&console.time("creation"),gt=this.tiles[He]=ao(j,V,W,te,Me),this.tileCoords.push({z:V,x:W,y:te}),Be)){Be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,W,te,gt.numFeatures,gt.numPoints,gt.numSimplified),console.timeEnd("creation"));const ci=`z${V}`;this.stats[ci]=(this.stats[ci]||0)+1,this.total++}if(gt.source=j,de==null){if(V===Me.indexMaxZoom||gt.numPoints<=Me.indexMaxPoints)continue}else{if(V===Me.maxZoom||V===de)continue;if(de!=null){const ci=de-V;if(W!==ye>>ci||te!==we>>ci)continue}}if(gt.source=null,j.length===0)continue;Be>1&&console.time("clipping");const kt=.5*Me.buffer/Me.extent,dr=.5-kt,jt=.5+kt,pr=1+kt;let qt=null,ei=null,jr=null,Kt=null,vr=Mr(j,Ee,W-kt,W+jt,0,gt.minX,gt.maxX,Me),Rr=Mr(j,Ee,W+dr,W+pr,0,gt.minX,gt.maxX,Me);j=null,vr&&(qt=Mr(vr,Ee,te-kt,te+jt,1,gt.minY,gt.maxY,Me),ei=Mr(vr,Ee,te+dr,te+pr,1,gt.minY,gt.maxY,Me),vr=null),Rr&&(jr=Mr(Rr,Ee,te-kt,te+jt,1,gt.minY,gt.maxY,Me),Kt=Mr(Rr,Ee,te+dr,te+pr,1,gt.minY,gt.maxY,Me),Rr=null),Be>1&&console.timeEnd("clipping"),ue.push(qt||[],V+1,2*W,2*te),ue.push(ei||[],V+1,2*W,2*te+1),ue.push(jr||[],V+1,2*W+1,2*te),ue.push(Kt||[],V+1,2*W+1,2*te+1)}}getTile(j,V,W){j=+j,V=+V,W=+W;const te=this.options,{extent:de,debug:ye}=te;if(j<0||j>24)return null;const we=1<<j,ue=un(j,V=V+we&we-1,W);if(this.tiles[ue])return ui(this.tiles[ue],de);ye>1&&console.log("drilling down to z%d-%d-%d",j,V,W);let Me,Be=j,Ee=V,He=W;for(;!Me&&Be>0;)Be--,Ee>>=1,He>>=1,Me=this.tiles[un(Be,Ee,He)];return Me&&Me.source?(ye>1&&(console.log("found parent tile z%d-%d-%d",Be,Ee,He),console.time("drilling down")),this.splitTile(Me.source,Be,Ee,He,j,V,W),ye>1&&console.timeEnd("drilling down"),this.tiles[ue]?ui(this.tiles[ue],de):null):null}}function un(ne,j,V){return 32*((1<<ne)*V+j)+ne}function Bt(ne,j){return j?ne.properties[j]:ne.id}function kn(ne,j){if(ne==null)return!0;if(ne.type==="Feature")return Bt(ne,j)!=null;if(ne.type==="FeatureCollection"){const V=new Set;for(const W of ne.features){const te=Bt(W,j);if(te==null||V.has(te))return!1;V.add(te)}return!0}return!1}function Hn(ne,j){const V=new Map;if(ne!=null)if(ne.type==="Feature")V.set(Bt(ne,j),ne);else for(const W of ne.features)V.set(Bt(W,j),W);return V}class cn extends N{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(j,V){return I._(this,void 0,void 0,(function*(){const W=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const te=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!te)return null;const de=new class{constructor(we){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=I.X,this.length=we.length,this._features=we}feature(we){return new class{constructor(ue){this._feature=ue,this.extent=I.X,this.type=ue.type,this.properties=ue.tags,"id"in ue&&!isNaN(ue.id)&&(this.id=parseInt(ue.id,10))}loadGeometry(){if(this._feature.type===1){const ue=[];for(const Me of this._feature.geometry)ue.push([new I.P(Me[0],Me[1])]);return ue}{const ue=[];for(const Me of this._feature.geometry){const Be=[];for(const Ee of Me)Be.push(new I.P(Ee[0],Ee[1]));ue.push(Be)}return ue}}toGeoJSON(ue,Me,Be){return De.call(this,ue,Me,Be)}}(this._features[we])}}(te.features);let ye=cr(de);return ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),{vectorTile:de,rawData:ye.buffer}}))}loadData(j){return I._(this,void 0,void 0,(function*(){var V;(V=this._pendingRequest)===null||V===void 0||V.abort();const W=!!(j&&j.request&&j.request.collectResourceTiming)&&new I.bv(j.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest),this._geoJSONIndex=j.cluster?new Ht((function({superclusterOptions:ye,clusterProperties:we}){if(!we||!ye)return ye;const ue={},Me={},Be={accumulated:null,zoom:0},Ee={properties:null},He=Object.keys(we);for(const gt of He){const[kt,dr]=we[gt],jt=I.bC(dr),pr=I.bC(typeof kt=="string"?[kt,["accumulated"],["get",gt]]:kt);ue[gt]=jt.value,Me[gt]=pr.value}return ye.map=gt=>{Ee.properties=gt;const kt={};for(const dr of He)kt[dr]=ue[dr].evaluate(Be,Ee);return kt},ye.reduce=(gt,kt)=>{Ee.properties=kt;for(const dr of He)Be.accumulated=gt[dr],gt[dr]=Me[dr].evaluate(Be,Ee)},ye})(j)).load((yield this._pendingData).features):(te=yield this._pendingData,new Ii(te,j.geojsonVtOptions)),this.loaded={};const de={};if(W){const ye=W.finish();ye&&(de.resourceTiming={},de.resourceTiming[j.source]=JSON.parse(JSON.stringify(ye)))}return de}catch(de){if(delete this._pendingRequest,I.bB(de))return{abandoned:!0};throw de}var te}))}getData(){return I._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(j){const V=this.loaded;return V&&V[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,V){return I._(this,void 0,void 0,(function*(){let W=yield this.loadGeoJSON(j,V);if(delete this._pendingRequest,typeof W!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(se(W,!0),j.filter){const te=I.bC(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map((ye=>`${ye.key}: ${ye.message}`)).join(", "));W={type:"FeatureCollection",features:W.features.filter((ye=>te.value.evaluate({zoom:0},ye)))}}return W}))}loadGeoJSON(j,V){return I._(this,void 0,void 0,(function*(){const{promoteId:W}=j;if(j.request){const te=yield I.h(j.request,V);return this._dataUpdateable=kn(te.data,W)?Hn(te.data,W):void 0,te.data}if(typeof j.data=="string")try{const te=JSON.parse(j.data);return this._dataUpdateable=kn(te,W)?Hn(te,W):void 0,te}catch{throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`)}if(!j.dataDiff)throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${j.source}`);return(function(te,de,ye){var we,ue,Me,Be;if(de.removeAll&&te.clear(),de.remove)for(const Ee of de.remove)te.delete(Ee);if(de.add)for(const Ee of de.add){const He=Bt(Ee,ye);He!=null&&te.set(He,Ee)}if(de.update)for(const Ee of de.update){let He=te.get(Ee.id);if(He==null)continue;const gt=!Ee.removeAllProperties&&(((we=Ee.removeProperties)===null||we===void 0?void 0:we.length)>0||((ue=Ee.addOrUpdateProperties)===null||ue===void 0?void 0:ue.length)>0);if((Ee.newGeometry||Ee.removeAllProperties||gt)&&(He=Object.assign({},He),te.set(Ee.id,He),gt&&(He.properties=Object.assign({},He.properties))),Ee.newGeometry&&(He.geometry=Ee.newGeometry),Ee.removeAllProperties)He.properties={};else if(((Me=Ee.removeProperties)===null||Me===void 0?void 0:Me.length)>0)for(const kt of Ee.removeProperties)Object.prototype.hasOwnProperty.call(He.properties,kt)&&delete He.properties[kt];if(((Be=Ee.addOrUpdateProperties)===null||Be===void 0?void 0:Be.length)>0)for(const{key:kt,value:dr}of Ee.addOrUpdateProperties)He.properties[kt]=dr}})(this._dataUpdateable,j.dataDiff,W),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(j){return I._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}class Li{constructor(j){this.self=j,this.actor=new I.F(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(V,W)=>{if(this.externalWorkerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.externalWorkerSourceTypes[V]=W},this.self.addProtocol=I.bi,this.self.removeProtocol=I.bj,this.self.registerRTLTextPlugin=V=>{if(I.bD.isParsed())throw new Error("RTL text plugin already registered.");I.bD.setMethods(V)},this.actor.registerMessageHandler("LDT",((V,W)=>this._getDEMWorkerSource(V,W.source).loadTile(W))),this.actor.registerMessageHandler("RDT",((V,W)=>I._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(V,W.source).removeTile(W)})))),this.actor.registerMessageHandler("GCEZ",((V,W)=>I._(this,void 0,void 0,(function*(){return this._getWorkerSource(V,W.type,W.source).getClusterExpansionZoom(W)})))),this.actor.registerMessageHandler("GCC",((V,W)=>I._(this,void 0,void 0,(function*(){return this._getWorkerSource(V,W.type,W.source).getClusterChildren(W)})))),this.actor.registerMessageHandler("GCL",((V,W)=>I._(this,void 0,void 0,(function*(){return this._getWorkerSource(V,W.type,W.source).getClusterLeaves(W)})))),this.actor.registerMessageHandler("LD",((V,W)=>this._getWorkerSource(V,W.type,W.source).loadData(W))),this.actor.registerMessageHandler("GD",((V,W)=>this._getWorkerSource(V,W.type,W.source).getData())),this.actor.registerMessageHandler("LT",((V,W)=>this._getWorkerSource(V,W.type,W.source).loadTile(W))),this.actor.registerMessageHandler("RT",((V,W)=>this._getWorkerSource(V,W.type,W.source).reloadTile(W))),this.actor.registerMessageHandler("AT",((V,W)=>this._getWorkerSource(V,W.type,W.source).abortTile(W))),this.actor.registerMessageHandler("RMT",((V,W)=>this._getWorkerSource(V,W.type,W.source).removeTile(W))),this.actor.registerMessageHandler("RS",((V,W)=>I._(this,void 0,void 0,(function*(){if(!this.workerSources[V]||!this.workerSources[V][W.type]||!this.workerSources[V][W.type][W.source])return;const te=this.workerSources[V][W.type][W.source];delete this.workerSources[V][W.type][W.source],te.removeSource!==void 0&&te.removeSource(W)})))),this.actor.registerMessageHandler("RM",(V=>I._(this,void 0,void 0,(function*(){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V]})))),this.actor.registerMessageHandler("SR",((V,W)=>I._(this,void 0,void 0,(function*(){this.referrer=W})))),this.actor.registerMessageHandler("SRPS",((V,W)=>this._syncRTLPluginState(V,W))),this.actor.registerMessageHandler("IS",((V,W)=>I._(this,void 0,void 0,(function*(){this.self.importScripts(W)})))),this.actor.registerMessageHandler("SI",((V,W)=>this._setImages(V,W))),this.actor.registerMessageHandler("UL",((V,W)=>I._(this,void 0,void 0,(function*(){this._getLayerIndex(V).update(W.layers,W.removedIds)})))),this.actor.registerMessageHandler("SL",((V,W)=>I._(this,void 0,void 0,(function*(){this._getLayerIndex(V).replace(W)}))))}_setImages(j,V){return I._(this,void 0,void 0,(function*(){this.availableImages[j]=V;for(const W in this.workerSources[j]){const te=this.workerSources[j][W];for(const de in te)te[de].availableImages=V}}))}_syncRTLPluginState(j,V){return I._(this,void 0,void 0,(function*(){if(I.bD.isParsed())return I.bD.getState();if(V.pluginStatus!=="loading")return I.bD.setState(V),V;const W=V.pluginURL;if(this.self.importScripts(W),I.bD.isParsed()){const te={pluginStatus:"loaded",pluginURL:W};return I.bD.setState(te),te}throw I.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${W}`)}))}_getAvailableImages(j){let V=this.availableImages[j];return V||(V=[]),V}_getLayerIndex(j){let V=this.layerIndexes[j];return V||(V=this.layerIndexes[j]=new h),V}_getWorkerSource(j,V,W){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][V]||(this.workerSources[j][V]={}),!this.workerSources[j][V][W]){const te={sendAsync:(de,ye)=>(de.targetMapId=j,this.actor.sendAsync(de,ye))};switch(V){case"vector":this.workerSources[j][V][W]=new N(te,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][V][W]=new cn(te,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][V][W]=new this.externalWorkerSourceTypes[V](te,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][V][W]}_getDEMWorkerSource(j,V){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][V]||(this.demWorkerSources[j][V]=new $),this.demWorkerSources[j][V]}}return I.i(self)&&(self.worker=new Li(self)),Li})),F("index",["exports","./shared"],(function(I,h){var Y="4.7.1";let J,he;const N={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:f=>new Promise(((e,s)=>{const l=requestAnimationFrame(e);f.signal.addEventListener("abort",(()=>{cancelAnimationFrame(l),s(h.c())}))})),getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,s.drawImage(f,0,0,f.width,f.height),s},resolveURL:f=>(J||(J=document.createElement("a")),J.href=f,J.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(he==null&&(he=matchMedia("(prefers-reduced-motion: reduce)")),he.matches)}};class ${static testProp(e){if(!$.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in $.docStyle)return e[s];return e[0]}static create(e,s,l){const u=window.document.createElement(e);return s!==void 0&&(u.className=s),l&&l.appendChild(u),u}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){$.docStyle&&$.selectProp&&($.userSelect=$.docStyle[$.selectProp],$.docStyle[$.selectProp]="none")}static enableDrag(){$.docStyle&&$.selectProp&&($.docStyle[$.selectProp]=$.userSelect)}static setTransform(e,s){e.style[$.transformProp]=s}static addEventListener(e,s,l,u={}){e.addEventListener(s,l,"passive"in u?u:u.capture)}static removeEventListener(e,s,l,u={}){e.removeEventListener(s,l,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",$.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",$.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",$.suppressClickInternal,!0)}),0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,l){const u=s.boundingClientRect;return new h.P((l.clientX-u.left)/s.x-e.clientLeft,(l.clientY-u.top)/s.y-e.clientTop)}static mousePos(e,s){const l=$.getScale(e);return $.getPoint(e,l,s)}static touchPos(e,s){const l=[],u=$.getScale(e);for(let p=0;p<s.length;p++)l.push($.getPoint(e,u,s[p]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}$.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,$.selectProp=$.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),$.transformProp=$.testProp(["transform","WebkitTransform"]);const fe={supported:!1,testSupport:function(f){!De&&se&&(Le?tt(f):Ae=f)}};let Ae,se,De=!1,Le=!1;function tt(f){const e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,se),f.isContextLost())return;fe.supported=!0}catch{}f.deleteTexture(e),De=!0}var Ge;typeof document<"u"&&(se=document.createElement("img"),se.onload=()=>{Ae&&tt(Ae),Ae=null,Le=!0},se.onerror=()=>{De=!0,Ae=null},se.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(f){let e,s,l,u;f.resetRequestQueue=()=>{e=[],s=0,l=0,u={}},f.addThrottleControl=T=>{const M=l++;return u[M]=T,M},f.removeThrottleControl=T=>{delete u[T],v()},f.getImage=(T,M,L=!0)=>new Promise(((R,q)=>{fe.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),h.e(T,{type:"image"}),e.push({abortController:M,requestParameters:T,supportImageRefresh:L,state:"queued",onError:H=>{q(H)},onSuccess:H=>{R(H)}}),v()}));const p=T=>h._(this,void 0,void 0,(function*(){T.state="running";const{requestParameters:M,supportImageRefresh:L,onError:R,onSuccess:q,abortController:H}=T,K=L===!1&&!h.i(self)&&!h.g(M.url)&&(!M.headers||Object.keys(M.headers).reduce(((oe,ce)=>oe&&ce==="accept"),!0));s++;const Q=K?w(M,H):h.m(M,H);try{const oe=yield Q;delete T.abortController,T.state="completed",oe.data instanceof HTMLImageElement||h.b(oe.data)?q(oe):oe.data&&q({data:yield(re=oe.data,typeof createImageBitmap=="function"?h.d(re):h.f(re)),cacheControl:oe.cacheControl,expires:oe.expires})}catch(oe){delete T.abortController,R(oe)}finally{s--,v()}var re})),v=()=>{const T=(()=>{for(const M of Object.keys(u))if(u[M]())return!0;return!1})()?h.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let M=s;M<T&&e.length>0;M++){const L=e.shift();L.abortController.signal.aborted?M--:p(L)}},w=(T,M)=>new Promise(((L,R)=>{const q=new Image,H=T.url,K=T.credentials;K&&K==="include"?q.crossOrigin="use-credentials":(K&&K==="same-origin"||!h.s(H))&&(q.crossOrigin="anonymous"),M.signal.addEventListener("abort",(()=>{q.src="",R(h.c())})),q.fetchPriority="high",q.onload=()=>{q.onerror=q.onload=null,L({data:q})},q.onerror=()=>{q.onerror=q.onload=null,M.signal.aborted||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},q.src=H}))})(Ge||(Ge={})),Ge.resetRequestQueue();class rt{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function mt(f){var e=new h.A(3);return e[0]=f[0],e[1]=f[1],e[2]=f[2],e}var pt,St=function(f,e,s){return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],f};pt=new h.A(3),h.A!=Float32Array&&(pt[0]=0,pt[1]=0,pt[2]=0);var At=function(f){var e=f[0],s=f[1];return e*e+s*s};function Zt(f){const e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){const s=[];for(const{id:l,url:u}of f){const p=`${l}${u}`;s.indexOf(p)===-1&&(s.push(p),e.push({id:l,url:u}))}}return e}function nr(f,e,s){const l=f.split("?");return l[0]+=`${e}${s}`,l.join("?")}(function(){var f=new h.A(2);h.A!=Float32Array&&(f[0]=0,f[1]=0)})();class It{constructor(e,s,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,u)}update(e,s,l){const{width:u,height:p}=e,v=!(this.size&&this.size[0]===u&&this.size[1]===p||l),{context:w}=this,{gl:T}=w;if(this.useMipmap=!!(s&&s.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[u,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||h.b(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,u,p,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:M,y:L}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||h.b(e)?T.texSubImage2D(T.TEXTURE_2D,0,M,L,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,M,L,u,p,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(e,s,l){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),l!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,l||e),this.filter=e),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function sr(f){const{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class Vt extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new h.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let l=!0;const u=s.data||s.spriteData;return this._validateStretch(s.stretchX,u&&u.width)||(this.fire(new h.j(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,u&&u.height)||(this.fire(new h.j(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new h.j(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,s){if(!e)return!0;let l=0;for(const u of e){if(u[0]<l||u[1]<u[0]||s<u[1])return!1;l=u[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const l=s.spriteData,u=l&&l.width||s.data.width,p=l&&l.height||s.data.height;return!(e[0]<0||u<e[0]||e[1]<0||p<e[1]||e[2]<0||u<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,l=!0){const u=this.getImage(e);if(l&&(u.data.width!==s.data.width||u.data.height!==s.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((s,l)=>{let u=!0;if(!this.isLoaded())for(const p of e)this.images[p]||(u=!1);this.isLoaded()||u?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})}))}_getImagesForIds(e){const s={};for(const l of e){let u=this.getImage(l);u||(this.fire(new h.k("styleimagemissing",{id:l})),u=this.getImage(l)),u?s[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:h.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],l=this.getImage(e);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},p=new h.I(u,l);this.patterns[e]={bin:u,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new It(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const p in this.patterns)e.push(this.patterns[p].bin);const{w:s,h:l}=h.p(e),u=this.atlasImage;u.resize({width:s||1,height:l||1});for(const p in this.patterns){const{bin:v}=this.patterns[p],w=v.x+1,T=v.y+1,M=this.getImage(p).data,L=M.width,R=M.height;h.R.copy(M,u,{x:0,y:0},{x:w,y:T},{width:L,height:R}),h.R.copy(M,u,{x:0,y:R-1},{x:w,y:T-1},{width:L,height:1}),h.R.copy(M,u,{x:0,y:0},{x:w,y:T+R},{width:L,height:1}),h.R.copy(M,u,{x:L-1,y:0},{x:w-1,y:T},{width:1,height:R}),h.R.copy(M,u,{x:0,y:0},{x:w+L,y:T},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||h.w(`Image with ID: "${s}" was not found`),sr(l)&&this.updateImage(s,l)}}}const or=1e20;function Kr(f,e,s,l,u,p,v,w,T){for(let M=e;M<e+l;M++)Gr(f,s*p+M,p,u,v,w,T);for(let M=s;M<s+u;M++)Gr(f,M*p+e,1,l,v,w,T)}function Gr(f,e,s,l,u,p,v){p[0]=0,v[0]=-or,v[1]=or,u[0]=f[e];for(let w=1,T=0,M=0;w<l;w++){u[w]=f[e+w*s];const L=w*w;do{const R=p[T];M=(u[w]-u[R]+L-R*R)/(w-R)/2}while(M<=v[T]&&--T>-1);T++,p[T]=w,v[T]=M,v[T+1]=or}for(let w=0,T=0;w<l;w++){for(;v[T+1]<w;)T++;const M=p[T],L=w-M;f[e+w*s]=u[M]+L*L}}class cr{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return h._(this,void 0,void 0,(function*(){const s=[];for(const p in e)for(const v of e[p])s.push(this._getAndCacheGlyphsPromise(p,v));const l=yield Promise.all(s),u={};for(const{stack:p,id:v,glyph:w}of l)u[p]||(u[p]={}),u[p][v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return u}))}_getAndCacheGlyphsPromise(e,s){return h._(this,void 0,void 0,(function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let u=l.glyphs[s];if(u!==void 0)return{stack:e,id:s,glyph:u};if(u=this._tinySDF(l,e,s),u)return l.glyphs[s]=u,{stack:e,id:s,glyph:u};const p=Math.floor(s/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[p])return{stack:e,id:s,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[p]){const w=cr.loadGlyphRange(e,p,this.url,this.requestManager);l.requests[p]=w}const v=yield l.requests[p];for(const w in v)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=v[+w]);return l.ranges[p]=!0,{stack:e,id:s,glyph:v[s]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,s,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let w="400";/bold/i.test(s)?w="900":/medium/i.test(s)?w="500":/light/i.test(s)&&(w="200"),p=e.tinySDF=new cr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:w})}const v=p.draw(String.fromCharCode(l));return{id:l,bitmap:new h.o({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}cr.loadGlyphRange=function(f,e,s,l){return h._(this,void 0,void 0,(function*(){const u=256*e,p=u+255,v=l.transformRequest(s.replace("{fontstack}",f).replace("{range}",`${u}-${p}`),"Glyphs"),w=yield h.l(v,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${u}-${p}`);const T={};for(const M of h.n(w.data))T[M.id]=M;return T}))},cr.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:v="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=s;const w=this.size=f+4*e,T=this._createCanvas(w),M=this.ctx=T.getContext("2d",{willReadFrequently:!0});M.font=`${v} ${p} ${f}px ${u}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(f){const e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(f),v=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),T=Math.min(this.size-this.buffer,v+Math.ceil(l)),M=w+2*this.buffer,L=T+2*this.buffer,R=Math.max(M*L,0),q=new Uint8ClampedArray(R),H={data:q,width:M,height:L,glyphWidth:w,glyphHeight:T,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(w===0||T===0)return H;const{ctx:K,buffer:Q,gridInner:re,gridOuter:oe}=this;K.clearRect(Q,Q,w,T),K.fillText(f,Q,Q+v);const ce=K.getImageData(Q,Q,w,T);oe.fill(or,0,R),re.fill(0,0,R);for(let ee=0;ee<T;ee++)for(let ge=0;ge<w;ge++){const ve=ce.data[4*(ee*w+ge)+3]/255;if(ve===0)continue;const ke=(ee+Q)*M+ge+Q;if(ve===1)oe[ke]=0,re[ke]=or;else{const Fe=.5-ve;oe[ke]=Fe>0?Fe*Fe:0,re[ke]=Fe<0?Fe*Fe:0}}Kr(oe,0,0,M,L,M,this.f,this.v,this.z),Kr(re,Q,Q,w,T,M,this.f,this.v,this.z);for(let ee=0;ee<R;ee++){const ge=Math.sqrt(oe[ee])-Math.sqrt(re[ee]);q[ee]=Math.round(255-255*(ge/this.radius+this.cutoff))}return H}};class ut{constructor(){this.specification=h.v.light.position}possiblyEvaluate(e,s){return h.x(e.expression.evaluate(s))}interpolate(e,s,l){return{x:h.y.number(e.x,s.x,l),y:h.y.number(e.y,s.y,l),z:h.y.number(e.z,s.z,l)}}}let zt;class ht extends h.E{constructor(e){super(),zt=zt||new h.q({anchor:new h.D(h.v.light.anchor),position:new ut,color:new h.D(h.v.light.color),intensity:new h.D(h.v.light.intensity)}),this._transitionable=new h.T(zt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(h.r,e,s))for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l){return(!l||l.validate!==!1)&&h.t(this,e.call(h.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.v}))}}const be=new h.q({"sky-color":new h.D(h.v.sky["sky-color"]),"horizon-color":new h.D(h.v.sky["horizon-color"]),"fog-color":new h.D(h.v.sky["fog-color"]),"fog-ground-blend":new h.D(h.v.sky["fog-ground-blend"]),"horizon-fog-blend":new h.D(h.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new h.D(h.v.sky["sky-horizon-blend"]),"atmosphere-blend":new h.D(h.v.sky["atmosphere-blend"])});class Oe extends h.E{constructor(e){super(),this._transitionable=new h.T(be),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.z(0))}setSky(e,s={}){if(!this._validate(h.B,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l={}){return l?.validate!==!1&&h.t(this,e.call(h.u,h.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Gt{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const l=e.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,s)),this.dashEntry[l]}getDashRanges(e,s,l){const u=[];let p=e.length%2==1?-e[e.length-1]*l:0,v=e[0]*l,w=!0;u.push({left:p,right:v,isDash:w,zeroLength:e[0]===0});let T=e[0];for(let M=1;M<e.length;M++){w=!w;const L=e[M];p=T*l,T+=L,v=T*l,u.push({left:p,right:v,isDash:w,zeroLength:L===0})}return u}addRoundDash(e,s,l){const u=s/2;for(let p=-l;p<=l;p++){const v=this.width*(this.nextRow+l+p);let w=0,T=e[w];for(let M=0;M<this.width;M++){M/T.right>1&&(T=e[++w]);const L=Math.abs(M-T.left),R=Math.abs(M-T.right),q=Math.min(L,R);let H;const K=p/l*(u+1);if(T.isDash){const Q=u-Math.abs(K);H=Math.sqrt(q*q+Q*Q)}else H=u-Math.sqrt(q*q+K*K);this.data[v+M]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const T=e[w],M=e[w+1];T.zeroLength?e.splice(w,1):M&&M.isDash===T.isDash&&(M.left=T.left,e.splice(w,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const u=this.width*this.nextRow;let p=0,v=e[p];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++p]);const T=Math.abs(w-v.left),M=Math.abs(w-v.right),L=Math.min(T,M);this.data[u+w]=Math.max(0,Math.min(255,(v.isDash?L:-L)+128))}}addDash(e,s){const l=s?7:0,u=2*l+1;if(this.nextRow+u>this.height)return h.w("LineAtlas out of space"),null;let p=0;for(let w=0;w<e.length;w++)p+=e[w];if(p!==0){const w=this.width/p,T=this.getDashRanges(e,this.width,w);s?this.addRoundDash(T,w,l):this.addRegularDash(T)}const v={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:p};return this.nextRow+=u,this.dirty=!0,v}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Ht="maplibre_preloaded_worker_pool";class Jt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Jt.workerCount;)this.workers.push(new Worker(h.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((s=>{s.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ht]}numActive(){return Object.keys(this.active).length}}const ar=Math.floor(N.hardwareConcurrency/2);let ir,tr;function Sr(){return ir||(ir=new Jt),ir}Jt.workerCount=h.C(globalThis)?Math.max(Math.min(ar,3),1):1;class li{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let u=0;u<l.length;u++){const p=new h.F(l[u],s);p.name=`Worker ${u}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const l=[];for(const u of this.actors)l.push(u.sendAsync({type:e,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((s=>{s.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const l of this.actors)l.registerMessageHandler(e,s)}}function oo(){return tr||(tr=new li(Sr(),h.G),tr.registerMessageHandler("GR",((f,e,s)=>h.m(e,s)))),tr}function ms(f,e){const s=h.H();return h.J(s,s,[1,1,0]),h.K(s,s,[.5*f.width,.5*f.height,1]),h.L(s,s,f.calculatePosMatrix(e.toUnwrapped()))}function Zn(f,e,s,l,u,p){const v=(function(R,q,H){if(R)for(const K of R){const Q=q[K];if(Q&&Q.source===H&&Q.type==="fill-extrusion")return!0}else for(const K in q){const Q=q[K];if(Q.source===H&&Q.type==="fill-extrusion")return!0}return!1})(u&&u.layers,e,f.id),w=p.maxPitchScaleFactor(),T=f.tilesIn(l,w,v);T.sort(gs);const M=[];for(const R of T)M.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(e,s,f._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,u,p,w,ms(f.transform,R.tileID))});const L=(function(R){const q={},H={};for(const K of R){const Q=K.queryResults,re=K.wrappedTileID,oe=H[re]=H[re]||{};for(const ce in Q){const ee=Q[ce],ge=oe[ce]=oe[ce]||{},ve=q[ce]=q[ce]||[];for(const ke of ee)ge[ke.featureIndex]||(ge[ke.featureIndex]=!0,ve.push(ke))}}return q})(M);for(const R in L)L[R].forEach((q=>{const H=q.feature,K=f.getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=K}));return L}function gs(f,e){const s=f.tileID,l=e.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function Mo(f,e,s){return h._(this,void 0,void 0,(function*(){let l=f;if(f.url?l=(yield h.h(e.transformRequest(f.url,"Source"),s)).data:yield N.frameAsync(s),!l)return null;const u=h.M(h.e(l,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(u.vectorLayerIds=l.vector_layers.map((p=>p.id))),u}))}class Pe{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof h.N?new h.N(e.lng,e.lat):h.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof h.N?new h.N(e.lng,e.lat):h.N.convert(e),this}extend(e){const s=this._sw,l=this._ne;let u,p;if(e instanceof h.N)u=e,p=e;else{if(!(e instanceof Pe))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Pe.convert(e)):this.extend(h.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(h.N.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return s||l?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new h.N(u.lng,u.lat),this._ne=new h.N(p.lng,p.lat)),this}getCenter(){return new h.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.N(this.getWest(),this.getNorth())}getSouthEast(){return new h.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=h.N.convert(e);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return e instanceof Pe?e:e&&new Pe(e)}static fromLngLat(e,s=0){const l=360*s/40075017,u=l/Math.cos(Math.PI/180*e.lat);return new Pe(new h.N(e.lng-u,e.lat-l),new h.N(e.lng+u,e.lat+l))}adjustAntiMeridian(){const e=new h.N(this._sw.lng,this._sw.lat),s=new h.N(this._ne.lng,this._ne.lat);return new Pe(e,e.lng>s.lng?new h.N(s.lng+360,s.lat):s)}}class zs{constructor(e,s,l){this.bounds=Pe.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),l=Math.floor(h.O(this.bounds.getWest())*s),u=Math.floor(h.Q(this.bounds.getNorth())*s),p=Math.ceil(h.O(this.bounds.getEast())*s),v=Math.ceil(h.Q(this.bounds.getSouth())*s);return e.x>=l&&e.x<p&&e.y>=u&&e.y<v}}class na extends h.E{constructor(e,s,l,u){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.M(s,["url","scheme","tileSize","promoteId"])),this._options=h.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Mo(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(h.e(this,e),e.bounds&&(this.tileBounds=new zs(e.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new h.j(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(e){return h._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((p,v)=>{e.reloadPromise={resolve:p,reject:v}}))}else e.actor=this.dispatcher.getActor(),u="LT";e.abortController=new AbortController;try{const p=yield e.actor.sendAsync({type:u,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class hr extends h.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},s),h.e(this,h.M(s,["url","scheme","tileSize"]))}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Mo(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(h.e(this,e),e.bounds&&(this.tileBounds=new zs(e.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new h.j(e))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return h.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return h._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield Ge.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const u=this.map.painter.context,p=u.gl,v=l.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new It(u,v,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}}))}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class Mr extends hr{constructor(e,s,l,u){super(e,s,l,u),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return h._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const u=yield Ge.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){const p=u.data;this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const v=h.b(p)&&h.U()?p:yield this.readImageNow(p),w={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const T=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}}))}readImageNow(e){return h._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&h.V()){const s=e.width+2,l=e.height+2;try{return new h.R({width:s,height:l},yield h.W(e,-1,-1,s,l))}catch{}}return N.getImageData(e,1)}))}_getNeighboringTiles(e){const s=e.canonical,l=Math.pow(2,s.z),u=(s.x-1+l)%l,p=s.x===0?e.wrap-1:e.wrap,v=(s.x+1+l)%l,w=s.x+1===l?e.wrap+1:e.wrap,T={};return T[new h.S(e.overscaledZ,p,s.z,u,s.y).key]={backfilled:!1},T[new h.S(e.overscaledZ,w,s.z,v,s.y).key]={backfilled:!1},s.y>0&&(T[new h.S(e.overscaledZ,p,s.z,u,s.y-1).key]={backfilled:!1},T[new h.S(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},T[new h.S(e.overscaledZ,w,s.z,v,s.y-1).key]={backfilled:!1}),s.y+1<l&&(T[new h.S(e.overscaledZ,p,s.z,u,s.y+1).key]={backfilled:!1},T[new h.S(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},T[new h.S(e.overscaledZ,w,s.z,v,s.y+1).key]={backfilled:!1}),T}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class ys extends h.E{constructor(e,s,l,u){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=s.data,this._options=h.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const p=h.X/this.tileSize;s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&h.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=h.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*p,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*p,extent:h.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:h.X,radius:(s.clusterRadius||50)*p,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return h._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return h._(this,void 0,void 0,(function*(){const e=h.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:l}})}_updateWorkerData(e){return h._(this,void 0,void 0,(function*(){const s=h.e({type:this.type},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(N.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new h.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new h.k("dataabort",{dataType:"source"}));let u=null;l.resourceTiming&&l.resourceTiming[this.id]&&(u=l.resourceTiming[this.id].slice(0));const p={dataType:"source"};this._collectResourceTiming&&u&&u.length>0&&h.e(p,{resourceTiming:u}),this.fire(new h.k("data",Object.assign(Object.assign({},p),{sourceDataType:"metadata"}))),this.fire(new h.k("data",Object.assign(Object.assign({},p),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new h.k("dataabort",{dataType:"source"}));this.fire(new h.j(l))}}))}loaded(){return this._pendingLoads===0}loadTile(e){return h._(this,void 0,void 0,(function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const u=yield this.actor.sendAsync({type:s,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(u,this.map.painter,s==="RT")}))}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var _s=h.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class vs extends h.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=s}load(e){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield Ge.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new h.j(s))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(h.Z.fromLngLat);this.tileID=(function(u){let p=1/0,v=1/0,w=-1/0,T=-1/0;for(const q of u)p=Math.min(p,q.x),v=Math.min(v,q.y),w=Math.max(w,q.x),T=Math.max(T,q.y);const M=Math.max(w-p,T-v),L=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),R=Math.pow(2,L);return new h.a1(L,Math.floor((p+w)/2*R),Math.floor((v+T)/2*R))})(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map((u=>this.tileID.getTilePoint(u)._round()));return this._boundsArray=new h.$,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,h.X,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,h.X),this._boundsArray.emplaceBack(l[2].x,l[2].y,h.X,h.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,_s.members)),this.boundsSegments||(this.boundsSegments=h.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new It(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return h._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ao extends vs{constructor(e,s,l,u){super(e,s,l,u),this.roundZoom=!0,this.type="video",this.options=s}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield h.a3(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new h.j(s))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new h.j(new h.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,_s.members)),this.boundsSegments||(this.boundsSegments=h.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new It(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ln extends vs{constructor(e,s,l,u){super(e,s,l,u),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some((p=>!Array.isArray(p)||p.length!==2||p.some((v=>typeof v!="number"))))||this.fire(new h.j(new h.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.j(new h.a2(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new h.j(new h.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new h.j(new h.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.j(new h.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,_s.members)),this.boundsSegments||(this.boundsSegments=h.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new It(s,this.canvas,l.RGBA,{premultiply:!0});let u=!1;for(const p in this.tiles){const v=this.tiles[p];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,u=!0)}u&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const sa={},zo=f=>{switch(f){case"geojson":return ys;case"image":return vs;case"raster":return hr;case"raster-dem":return Mr;case"vector":return na;case"video":return Ao;case"canvas":return ln}return sa[f]},$e="RTLPluginLoaded";class Gn extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=oo()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((s=>{throw this.status="error",s}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return h._(this,arguments,void 0,(function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=N.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return h._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.k($e))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ui=null;function $i(){return ui||(ui=new Gn),ui}class ao{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=h.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(u,p){const v={};if(!p)return v;for(const w of u){const T=w.layerIds.map((M=>p.getLayer(M))).filter(Boolean);if(T.length!==0){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map((M=>T.filter((L=>L.id===M))[0])));for(const M of T)v[M.id]=w}}return v})(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof h.a6){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof h.a6&&p.hasRTLText){this.hasRTLText=!0,$i().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new h.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new It(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new It(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,l,u,p,v,w,T,M,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:p,scale:v,tileSize:this.tileSize,pixelPosMatrix:L,transform:T,params:w,queryPadding:this.queryPadding*M},e,s,l):{}}querySourceFeatures(e,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),p=s&&s.sourceLayer?s.sourceLayer:"",v=u._geojsonTileLayer||u[p];if(!v)return;const w=h.a7(s&&s.filter),{z:T,x:M,y:L}=this.tileID.canonical,R={z:T,x:M,y:L};for(let q=0;q<v.length;q++){const H=v.feature(q);if(w.needGeometry){const re=h.a8(H,!0);if(!w.filter(new h.z(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!w.filter(new h.z(this.tileID.overscaledZ),H))continue;const K=l.getId(H,p),Q=new h.a9(H,T,M,L,K);Q.tile=R,e.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const l=h.aa(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const p=this.expirationTime-s;p?this.expirationTime=l+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const p=this.buckets[u],v=p.layers[0].sourceLayer||"_geojsonTileLayer",w=l[v],T=e[v];if(!w||!T||Object.keys(T).length===0)continue;p.update(T,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const M=s&&s.style&&s.style.getLayer(u);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<N.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=N.now()+e}setDependencies(e,s){const l={};for(const u of s)l[u]=!0;this.dependencies[e]=l}hasDependency(e,s){for(const l of e){const u=this.dependencies[l];if(u){for(const p of s)if(u[p])return!0}}return!1}}class Ke{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const p={value:s,timeout:void 0};if(l!==void 0&&(p.timeout=setTimeout((()=>{this.remove(e,p)}),l)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const l=e.wrapped().key,u=s===void 0?0:this.data[l].indexOf(s),p=this.data[l][u];return this.data[l].splice(u,1),p.timeout&&clearTimeout(p.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||s.push(u);for(const l of s)this.remove(l.value.tileID,l)}}class Wt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,l){const u=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},h.e(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==u&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const p in this.state[e][u])l[p]||(this.deletedStates[e][u][p]=null)}else for(const p in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][p]===null&&delete this.deletedStates[e][u][p]}removeFeatureState(e,s,l){if(this.deletedStates[e]===null)return;const u=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&s!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,s){const l=String(s),u=h.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][s];if(p===null)return{};for(const v in p)delete u[v]}return u}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const v in this.stateChanges[u])this.state[u][v]||(this.state[u][v]={}),h.e(this.state[u][v],this.stateChanges[u][v]),p[v]=this.state[u][v];l[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(this.deletedStates[u]===null)for(const v in this.state[u])p[v]={},this.state[u][v]={};else for(const v in this.deletedStates[u]){if(this.deletedStates[u][v]===null)this.state[u][v]={};else for(const w of Object.keys(this.deletedStates[u][v]))delete this.state[u][v][w];p[v]=this.state[u][v]}l[u]=l[u]||{},h.e(l[u],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,s)}}class Dt extends h.E{constructor(e,s,l){super(),this.id=e,this.dispatcher=l,this.on("data",(u=>this._dataHandler(u))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((u,p,v,w)=>{const T=new(zo(p.type))(u,p,v,w);if(T.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${T.id}`);return T})(e,s,l,this),this._tiles={},this._cache=new Ke(0,(u=>this._unloadTile(u))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Wt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,l){return h._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,l)}catch(u){e.state="errored",u.status!==404?this._source.fire(new h.j(u,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new h.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(Ii).map((e=>e.key))}getRenderableIds(e){const s=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&s.push(this._tiles[l]);return e?s.sort(((l,u)=>{const p=l.tileID,v=u.tileID,w=new h.P(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),T=new h.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-v.overscaledZ||T.y-w.y||T.x-w.x})).map((l=>l.tileID.key)):s.map((l=>l.tileID)).sort(Ii).map((l=>l.key))}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){return h._(this,void 0,void 0,(function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,e,s))}))}_tileLoaded(e,s,l){e.timeAdded=N.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new h.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const p=s[u];if(e.neighboringTiles&&e.neighboringTiles[p]){const v=this.getTileByID(p);l(e,v),l(v,e)}}function l(u,p){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let v=p.tileID.canonical.x-u.tileID.canonical.x;const w=p.tileID.canonical.y-u.tileID.canonical.y,T=Math.pow(2,u.tileID.canonical.z),M=p.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+T)===1?v+=T:Math.abs(v-T)===1&&(v-=T)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,v,w),u.neighboringTiles&&u.neighboringTiles[M]&&(u.neighboringTiles[M].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,l,u){for(const p in this._tiles){let v=this._tiles[p];if(u[p]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>l)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const M=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[M.key],v&&v.hasData()&&(w=M)}let T=w;for(;T.overscaledZ>s;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){u[w.key]=w;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=e.overscaledZ-1;l>=s;l--){const u=e.scaledTo(l),p=this._getLoadedTile(u);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?h.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(p)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const l={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),l[p.tileID.key]=p}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(e,s,l,u,p,v){const w={},T={},M=Object.keys(e),L=N.now();for(const R of M){const q=e[R],H=this._tiles[R];if(!H||H.fadeEndTime!==0&&H.fadeEndTime<=L)continue;const K=this.findLoadedParent(q,s),Q=this.findLoadedSibling(q),re=K||Q||null;re&&(this._addTile(re.tileID),w[re.tileID.key]=re.tileID),T[R]=q}this._retainLoadedChildren(T,u,l,e);for(const R in w)e[R]||(this._coveredTiles[R]=!0,e[R]=w[R]);if(v){const R={},q={};for(const H of p)this._tiles[H.key].hasData()?R[H.key]=H:q[H.key]=H;for(const H in q){const K=q[H].children(this._source.maxzoom);this._tiles[K[0].key]&&this._tiles[K[1].key]&&this._tiles[K[2].key]&&this._tiles[K[3].key]&&(R[K[0].key]=e[K[0].key]=K[0],R[K[1].key]=e[K[1].key]=K[1],R[K[2].key]=e[K[2].key]=K[2],R[K[3].key]=e[K[3].key]=K[3],delete q[H])}for(const H in q){const K=q[H],Q=this.findLoadedParent(K,this._source.minzoom),re=this.findLoadedSibling(K),oe=Q||re||null;if(oe){R[oe.tileID.key]=e[oe.tileID.key]=oe.tileID;for(const ce in R)R[ce].isChildOf(oe.tileID)&&delete R[ce]}}for(const H in this._tiles)R[H]||(this._coveredTiles[H]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((L=>new h.S(L.canonical.z,L.wrap,L.canonical.z,L.canonical.x,L.canonical.y))):(l=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter((L=>this._source.hasTile(L))))):l=[];const u=e.coveringZoomLevel(this._source),p=Math.max(u-Dt.maxOverzooming,this._source.minzoom),v=Math.max(u+Dt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const L={};for(const R of l)if(R.canonical.z>this._source.minzoom){const q=R.scaledTo(R.canonical.z-1);L[q.key]=q;const H=R.scaledTo(Math.max(this._source.minzoom,Math.min(R.canonical.z,5)));L[H.key]=H}l=l.concat(Object.values(L))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new h.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(l,u);un(this._source.type)&&this._updateCoveredAndRetainedTiles(T,p,v,u,l,s);for(const L in T)this._tiles[L].clearFadeHold();const M=h.ab(this._tiles,T);for(const L of M){const R=this._tiles[L];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(L)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var l;const u={},p={},v=Math.max(s-Dt.maxOverzooming,this._source.minzoom),w=Math.max(s+Dt.maxUnderzooming,this._source.minzoom),T={};for(const M of e){const L=this._addTile(M);u[M.key]=M,L.hasData()||s<this._source.maxzoom&&(T[M.key]=M)}this._retainLoadedChildren(T,s,w,u);for(const M of e){let L=this._tiles[M.key];if(L.hasData())continue;if(s+1>this._source.maxzoom){const q=M.children(this._source.maxzoom)[0],H=this.getTile(q);if(H&&H.hasData()){u[q.key]=q;continue}}else{const q=M.children(this._source.maxzoom);if(u[q[0].key]&&u[q[1].key]&&u[q[2].key]&&u[q[3].key])continue}let R=L.wasRequested();for(let q=M.overscaledZ-1;q>=v;--q){const H=M.scaledTo(q);if(p[H.key])break;if(p[H.key]=!0,L=this.getTile(H),!L&&R&&(L=this._addTile(H)),L){const K=L.hasData();if((K||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||R)&&(u[H.key]=H),R=L.wasRequested(),K)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}s.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;u=p}for(const p of s)this._loadedParentTiles[p]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,l=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=l}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const l=s;return s||(s=new ao(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,l||this._source.fire(new h.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=s.getExpiryTimeout();l&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),l))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,l){const u=[],p=this.transform;if(!p)return u;const v=l?p.getCameraQueryGeometry(e):e,w=e.map((K=>p.pointCoordinate(K,this.terrain))),T=v.map((K=>p.pointCoordinate(K,this.terrain))),M=this.getIds();let L=1/0,R=1/0,q=-1/0,H=-1/0;for(const K of T)L=Math.min(L,K.x),R=Math.min(R,K.y),q=Math.max(q,K.x),H=Math.max(H,K.y);for(let K=0;K<M.length;K++){const Q=this._tiles[M[K]];if(Q.holdingForFade())continue;const re=Q.tileID,oe=Math.pow(2,p.zoom-Q.tileID.overscaledZ),ce=s*Q.queryPadding*h.X/Q.tileSize/oe,ee=[re.getTilePoint(new h.Z(L,R)),re.getTilePoint(new h.Z(q,H))];if(ee[0].x-ce<h.X&&ee[0].y-ce<h.X&&ee[1].x+ce>=0&&ee[1].y+ce>=0){const ge=w.map((ke=>re.getTilePoint(ke))),ve=T.map((ke=>re.getTilePoint(ke)));u.push({tile:Q,tileID:re,queryGeometry:ge,cameraQueryGeometry:ve,scale:oe})}}return u}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map((l=>this._tiles[l].tileID));for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(un(this._source.type)){const e=N.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,l){this._state.updateState(e=e||"_geojsonTileLayer",s,l)}removeFeatureState(e,s,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,l)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,l){const u=this._tiles[e];u&&u.setDependencies(s,l)}reloadTilesForDependencies(e,s){for(const l in this._tiles)this._tiles[l].hasDependency(e,s)&&this._reloadTile(l,"reloading");this._cache.filter((l=>!l.hasDependency(e,s)))}}function Ii(f,e){const s=Math.abs(2*f.wrap)-+(f.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||l-s||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function un(f){return f==="raster"||f==="image"||f==="video"}Dt.maxOverzooming=10,Dt.maxUnderzooming=3;class Bt{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=h.ac(e,0,1);let s=1,l=this._distances[s];const u=e*this.paddedLength+this.padding;for(;l<u&&s<this._distances.length;)l=this._distances[++s];const p=s-1,v=this._distances[p],w=l-v,T=w>0?(u-v)/w:0;return this.points[p].mult(1-T).add(this.points[s].mult(T))}}function kn(f,e){let s=!0;return f==="always"||f!=="never"&&e!=="never"||(s=!1),s}class Hn{constructor(e,s,l){const u=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(s/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)u.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,l,u,p){this._forEachCell(s,l,u,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(p)}insertCircle(e,s,l,u){this._forEachCell(s-u,l-u,s+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(l),this.circles.push(u)}_insertBoxCell(e,s,l,u,p,v){this.boxCells[p].push(v)}_insertCircleCell(e,s,l,u,p,v){this.circleCells[p].push(v)}_query(e,s,l,u,p,v,w){if(l<0||e>this.width||u<0||s>this.height)return[];const T=[];if(e<=0&&s<=0&&this.width<=l&&this.height<=u){if(p)return[{key:null,x1:e,y1:s,x2:l,y2:u}];for(let M=0;M<this.boxKeys.length;M++)T.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const L=this.circles[3*M],R=this.circles[3*M+1],q=this.circles[3*M+2];T.push({key:this.circleKeys[M],x1:L-q,y1:R-q,x2:L+q,y2:R+q})}}else this._forEachCell(e,s,l,u,this._queryCell,T,{hitTest:p,overlapMode:v,seenUids:{box:{},circle:{}}},w);return T}query(e,s,l,u){return this._query(e,s,l,u,!1,null)}hitTest(e,s,l,u,p,v){return this._query(e,s,l,u,!0,p,v).length>0}hitTestCircle(e,s,l,u,p){const v=e-l,w=e+l,T=s-l,M=s+l;if(w<0||v>this.width||M<0||T>this.height)return!1;const L=[];return this._forEachCell(v,T,w,M,this._queryCellCircle,L,{hitTest:!0,overlapMode:u,circle:{x:e,y:s,radius:l},seenUids:{box:{},circle:{}}},p),L.length>0}_queryCell(e,s,l,u,p,v,w,T){const{seenUids:M,hitTest:L,overlapMode:R}=w,q=this.boxCells[p];if(q!==null){const K=this.bboxes;for(const Q of q)if(!M.box[Q]){M.box[Q]=!0;const re=4*Q,oe=this.boxKeys[Q];if(e<=K[re+2]&&s<=K[re+3]&&l>=K[re+0]&&u>=K[re+1]&&(!T||T(oe))&&(!L||!kn(R,oe.overlapMode))&&(v.push({key:oe,x1:K[re],y1:K[re+1],x2:K[re+2],y2:K[re+3]}),L))return!0}}const H=this.circleCells[p];if(H!==null){const K=this.circles;for(const Q of H)if(!M.circle[Q]){M.circle[Q]=!0;const re=3*Q,oe=this.circleKeys[Q];if(this._circleAndRectCollide(K[re],K[re+1],K[re+2],e,s,l,u)&&(!T||T(oe))&&(!L||!kn(R,oe.overlapMode))){const ce=K[re],ee=K[re+1],ge=K[re+2];if(v.push({key:oe,x1:ce-ge,y1:ee-ge,x2:ce+ge,y2:ee+ge}),L)return!0}}}return!1}_queryCellCircle(e,s,l,u,p,v,w,T){const{circle:M,seenUids:L,overlapMode:R}=w,q=this.boxCells[p];if(q!==null){const K=this.bboxes;for(const Q of q)if(!L.box[Q]){L.box[Q]=!0;const re=4*Q,oe=this.boxKeys[Q];if(this._circleAndRectCollide(M.x,M.y,M.radius,K[re+0],K[re+1],K[re+2],K[re+3])&&(!T||T(oe))&&!kn(R,oe.overlapMode))return v.push(!0),!0}}const H=this.circleCells[p];if(H!==null){const K=this.circles;for(const Q of H)if(!L.circle[Q]){L.circle[Q]=!0;const re=3*Q,oe=this.circleKeys[Q];if(this._circlesCollide(K[re],K[re+1],K[re+2],M.x,M.y,M.radius)&&(!T||T(oe))&&!kn(R,oe.overlapMode))return v.push(!0),!0}}}_forEachCell(e,s,l,u,p,v,w,T){const M=this._convertToXCellCoord(e),L=this._convertToYCellCoord(s),R=this._convertToXCellCoord(l),q=this._convertToYCellCoord(u);for(let H=M;H<=R;H++)for(let K=L;K<=q;K++)if(p.call(this,e,s,l,u,this.xCellCount*K+H,v,w,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,l,u,p,v){const w=u-e,T=p-s,M=l+v;return M*M>w*w+T*T}_circleAndRectCollide(e,s,l,u,p,v,w){const T=(v-u)/2,M=Math.abs(e-(u+T));if(M>T+l)return!1;const L=(w-p)/2,R=Math.abs(s-(p+L));if(R>L+l)return!1;if(M<=T||R<=L)return!0;const q=M-T,H=R-L;return q*q+H*H<=l*l}}function cn(f,e,s,l,u){const p=h.H();return e?(h.K(p,p,[1/u,1/u,1]),s||h.ad(p,p,l.angle)):h.L(p,l.labelPlaneMatrix,f),p}function Li(f,e,s,l,u){if(e){const p=h.ae(f);return h.K(p,p,[u,u,1]),s||h.ad(p,p,-l.angle),p}return l.glCoordMatrix}function ne(f,e,s,l){let u;l?(u=[f,e,l(f,e),1],h.af(u,u,s)):(u=[f,e,0,1],dr(u,u,s));const p=u[3];return{point:new h.P(u[0]/p,u[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function j(f,e){return .5+f/e*.5}function V(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function W(f,e,s,l,u,p,v,w,T,M,L,R,q,H,K){const Q=l?f.textSizeData:f.iconSizeData,re=h.ag(Q,s.transform.zoom),oe=[256/s.width*2+1,256/s.height*2+1],ce=l?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ce.clear();const ee=f.lineVertexArray,ge=l?f.text.placedSymbolArray:f.icon.placedSymbolArray,ve=s.transform.width/s.transform.height;let ke=!1;for(let Fe=0;Fe<ge.length;Fe++){const Ue=ge.get(Fe);if(Ue.hidden||Ue.writingMode===h.ah.vertical&&!ke){kt(Ue.numGlyphs,ce);continue}ke=!1;const We=ne(Ue.anchorX,Ue.anchorY,e,K);if(!V(We.point,oe)){kt(Ue.numGlyphs,ce);continue}const it=j(s.transform.cameraToCenterDistance,We.signedDistanceFromCamera),Xe=h.ai(Q,re,Ue),Ze=v?Xe/it:Xe*it,dt={getElevation:K,labelPlaneMatrix:u,lineVertexArray:ee,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:M,tileAnchorPoint:new h.P(Ue.anchorX,Ue.anchorY),unwrappedTileID:L,width:R,height:q,translation:H},Rt=ye(dt,Ue,Ze,!1,w,e,p,f.glyphOffsetArray,ce,ve,T);ke=Rt.useVertical,(Rt.notEnoughRoom||ke||Rt.needsFlipping&&ye(dt,Ue,Ze,!0,w,e,p,f.glyphOffsetArray,ce,ve,T).notEnoughRoom)&&kt(Ue.numGlyphs,ce)}l?f.text.dynamicLayoutVertexBuffer.updateData(ce):f.icon.dynamicLayoutVertexBuffer.updateData(ce)}function te(f,e,s,l,u,p,v,w){const T=p.glyphStartIndex+p.numGlyphs,M=p.lineStartIndex,L=p.lineStartIndex+p.lineLength,R=e.getoffsetX(p.glyphStartIndex),q=e.getoffsetX(T-1),H=He(f*R,s,l,u,p.segment,M,L,w,v);if(!H)return null;const K=He(f*q,s,l,u,p.segment,M,L,w,v);return K?w.projectionCache.anyProjectionOccluded?null:{first:H,last:K}:null}function de(f,e,s,l){return f===h.ah.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*l?{useVertical:!0}:(f===h.ah.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function ye(f,e,s,l,u,p,v,w,T,M,L){const R=s/24,q=e.lineOffsetX*R,H=e.lineOffsetY*R;let K;if(e.numGlyphs>1){const Q=e.glyphStartIndex+e.numGlyphs,re=e.lineStartIndex,oe=e.lineStartIndex+e.lineLength,ce=te(R,w,q,H,l,e,L,f);if(!ce)return{notEnoughRoom:!0};const ee=ne(ce.first.point.x,ce.first.point.y,v,f.getElevation).point,ge=ne(ce.last.point.x,ce.last.point.y,v,f.getElevation).point;if(u&&!l){const ve=de(e.writingMode,ee,ge,M);if(ve)return ve}K=[ce.first];for(let ve=e.glyphStartIndex+1;ve<Q-1;ve++)K.push(He(R*w.getoffsetX(ve),q,H,l,e.segment,re,oe,f,L));K.push(ce.last)}else{if(u&&!l){const re=ne(f.tileAnchorPoint.x,f.tileAnchorPoint.y,p,f.getElevation).point,oe=e.lineStartIndex+e.segment+1,ce=new h.P(f.lineVertexArray.getx(oe),f.lineVertexArray.gety(oe)),ee=ne(ce.x,ce.y,p,f.getElevation),ge=ee.signedDistanceFromCamera>0?ee.point:(function(ke,Fe,Ue,We,it,Xe){return we(ke,Fe,Ue,1,it,Xe)})(f.tileAnchorPoint,ce,re,0,p,f),ve=de(e.writingMode,re,ge,M);if(ve)return ve}const Q=He(R*w.getoffsetX(e.glyphStartIndex),q,H,l,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,f,L);if(!Q||f.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};K=[Q]}for(const Q of K)h.aj(T,Q.point,Q.angle);return{}}function we(f,e,s,l,u,p){const v=f.add(f.sub(e)._unit()),w=u!==void 0?ne(v.x,v.y,u,p.getElevation).point:Me(v.x,v.y,p).point,T=s.sub(w);return s.add(T._mult(l/T.mag()))}function ue(f,e,s){const l=e.projectionCache;if(l.projections[f])return l.projections[f];const u=new h.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),p=Me(u.x,u.y,e);if(p.signedDistanceFromCamera>0)return l.projections[f]=p.point,l.anyProjectionOccluded=l.anyProjectionOccluded||p.isOccluded,p.point;const v=f-s.direction;return(function(w,T,M,L,R){return we(w,T,M,L,void 0,R)})(s.distanceFromAnchor===0?e.tileAnchorPoint:new h.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),u,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function Me(f,e,s){const l=f+s.translation[0],u=e+s.translation[1];let p;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(p=s.projection.projectTileCoordinates(l,u,s.unwrappedTileID,s.getElevation),p.point.x=(.5*p.point.x+.5)*s.width,p.point.y=(.5*-p.point.y+.5)*s.height):(p=ne(l,u,s.labelPlaneMatrix,s.getElevation),p.isOccluded=!1),p}function Be(f,e,s){return f._unit()._perp()._mult(e*s)}function Ee(f,e,s,l,u,p,v,w,T){if(w.projectionCache.offsets[f])return w.projectionCache.offsets[f];const M=s.add(e);if(f+T.direction<l||f+T.direction>=u)return w.projectionCache.offsets[f]=M,M;const L=ue(f+T.direction,w,T),R=Be(L.sub(s),v,T.direction),q=s.add(R),H=L.add(R);return w.projectionCache.offsets[f]=h.ak(p,M,q,H)||M,w.projectionCache.offsets[f]}function He(f,e,s,l,u,p,v,w,T){const M=l?f-e:f+e;let L=M>0?1:-1,R=0;l&&(L*=-1,R=Math.PI),L<0&&(R+=Math.PI);let q,H=L>0?p+u:p+u+1;w.projectionCache.cachedAnchorPoint?q=w.projectionCache.cachedAnchorPoint:(q=Me(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=q);let K,Q,re=q,oe=q,ce=0,ee=0;const ge=Math.abs(M),ve=[];let ke;for(;ce+ee<=ge;){if(H+=L,H<p||H>=v)return null;ce+=ee,oe=re,Q=K;const We={absOffsetX:ge,direction:L,distanceFromAnchor:ce,previousVertex:oe};if(re=ue(H,w,We),s===0)ve.push(oe),ke=re.sub(oe);else{let it;const Xe=re.sub(oe);it=Xe.mag()===0?Be(ue(H+L,w,We).sub(re),s,L):Be(Xe,s,L),Q||(Q=oe.add(it)),K=Ee(H,it,re,p,v,Q,s,w,We),ve.push(Q),ke=K.sub(Q)}ee=ke.mag()}const Fe=ke._mult((ge-ce)/ee)._add(Q||oe),Ue=R+Math.atan2(re.y-oe.y,re.x-oe.x);return ve.push(Fe),{point:Fe,angle:T?Ue:0,path:ve}}const gt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function kt(f,e){for(let s=0;s<f;s++){const l=e.length;e.resize(l+4),e.float32.set(gt,3*l)}}function dr(f,e,s){const l=e[0],u=e[1];return f[0]=s[0]*l+s[4]*u+s[12],f[1]=s[1]*l+s[5]*u+s[13],f[3]=s[3]*l+s[7]*u+s[15],f}const jt=100;class pr{constructor(e,s,l=new Hn(e.width+200,e.height+200,25),u=new Hn(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=s,this.grid=l,this.ignoredGrid=u,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+jt,this.screenBottomBoundary=e.height+jt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,l,u,p,v,w,T,M,L,R){const q=e.anchorPointX+T[0],H=e.anchorPointY+T[1],K=this.projectAndGetPerspectiveRatio(u,q,H,p,L),Q=l*K.perspectiveRatio;let re;if(v||w)re=this._projectCollisionBox(e,Q,u,p,v,w,T,K,L,R);else{const ve=K.point.x+(R?R.x*Q:0),ke=K.point.y+(R?R.y*Q:0);re={allPointsOccluded:!1,box:[ve+e.x1*Q,ke+e.y1*Q,ve+e.x2*Q,ke+e.y2*Q]}}const[oe,ce,ee,ge]=re.box;return this.mapProjection.useSpecialProjectionForSymbols&&(v?re.allPointsOccluded:this.mapProjection.isOccluded(q,H,p))||K.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(oe,ce,ee,ge)||s!=="always"&&this.grid.hitTest(oe,ce,ee,ge,s,M)?{box:[oe,ce,ee,ge],placeable:!1,offscreen:!1}:{box:[oe,ce,ee,ge],placeable:!0,offscreen:this.isOffscreen(oe,ce,ee,ge)}}placeCollisionCircles(e,s,l,u,p,v,w,T,M,L,R,q,H,K,Q,re){const oe=[],ce=new h.P(s.anchorX,s.anchorY),ee=this.getPerspectiveRatio(v,ce.x,ce.y,w,re),ge=(R?p/ee:p*ee)/h.ap,ve={getElevation:re,labelPlaneMatrix:T,lineVertexArray:l,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ce,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:Q},ke=te(ge,u,s.lineOffsetX*ge,s.lineOffsetY*ge,!1,s,!1,ve);let Fe=!1,Ue=!1,We=!0;if(ke){const it=.5*H*ee+K,Xe=new h.P(-100,-100),Ze=new h.P(this.screenRightBoundary,this.screenBottomBoundary),dt=new Bt,Rt=ke.first,Ye=ke.last;let Qe=[];for(let Ut=Rt.path.length-1;Ut>=1;Ut--)Qe.push(Rt.path[Ut]);for(let Ut=1;Ut<Ye.path.length;Ut++)Qe.push(Ye.path[Ut]);const Lt=2.5*it;if(M){const Ut=this.projectPathToScreenSpace(Qe,ve,M);Qe=Ut.some((Xt=>Xt.signedDistanceFromCamera<=0))?[]:Ut.map((Xt=>Xt.point))}let Tr=[];if(Qe.length>0){const Ut=Qe[0].clone(),Xt=Qe[0].clone();for(let Ir=1;Ir<Qe.length;Ir++)Ut.x=Math.min(Ut.x,Qe[Ir].x),Ut.y=Math.min(Ut.y,Qe[Ir].y),Xt.x=Math.max(Xt.x,Qe[Ir].x),Xt.y=Math.max(Xt.y,Qe[Ir].y);Tr=Ut.x>=Xe.x&&Xt.x<=Ze.x&&Ut.y>=Xe.y&&Xt.y<=Ze.y?[Qe]:Xt.x<Xe.x||Ut.x>Ze.x||Xt.y<Xe.y||Ut.y>Ze.y?[]:h.al([Qe],Xe.x,Xe.y,Ze.x,Ze.y)}for(const Ut of Tr){dt.reset(Ut,.25*it);let Xt=0;Xt=dt.length<=.5*it?1:Math.ceil(dt.paddedLength/Lt)+1;for(let Ir=0;Ir<Xt;Ir++){const _i=Ir/Math.max(Xt-1,1),mn=dt.lerp(_i),Pr=mn.x+jt,hi=mn.y+jt;oe.push(Pr,hi,it,0);const Br=Pr-it,Jr=hi-it,Si=Pr+it,rs=hi+it;if(We=We&&this.isOffscreen(Br,Jr,Si,rs),Ue=Ue||this.isInsideGrid(Br,Jr,Si,rs),e!=="always"&&this.grid.hitTestCircle(Pr,hi,it,e,q)&&(Fe=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Fe}}}}return{circles:!L&&Fe||!Ue||ee<this.perspectiveRatioCutoff?[]:oe,offscreen:We,collisionDetected:Fe}}projectPathToScreenSpace(e,s,l){return e.map((u=>ne(u.x,u.y,l,s.getElevation)))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,u=1/0,p=-1/0,v=-1/0;for(const L of e){const R=new h.P(L.x+jt,L.y+jt);l=Math.min(l,R.x),u=Math.min(u,R.y),p=Math.max(p,R.x),v=Math.max(v,R.y),s.push(R)}const w=this.grid.query(l,u,p,v).concat(this.ignoredGrid.query(l,u,p,v)),T={},M={};for(const L of w){const R=L.key;if(T[R.bucketInstanceId]===void 0&&(T[R.bucketInstanceId]={}),T[R.bucketInstanceId][R.featureIndex])continue;const q=[new h.P(L.x1,L.y1),new h.P(L.x2,L.y1),new h.P(L.x2,L.y2),new h.P(L.x1,L.y2)];h.am(s,q)&&(T[R.bucketInstanceId][R.featureIndex]=!0,M[R.bucketInstanceId]===void 0&&(M[R.bucketInstanceId]=[]),M[R.bucketInstanceId].push(R.featureIndex))}return M}insertCollisionBox(e,s,l,u,p,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:v,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,l,u,p,v){const w=l?this.ignoredGrid:this.grid,T={bucketInstanceId:u,featureIndex:p,collisionGroupID:v,overlapMode:s};for(let M=0;M<e.length;M+=4)w.insertCircle(T,e[M],e[M+1],e[M+2])}projectAndGetPerspectiveRatio(e,s,l,u,p){let v;p?(v=[s,l,p(s,l),1],h.af(v,v,e)):(v=[s,l,0,1],dr(v,v,e));const w=v[3];return{point:new h.P((v[0]/w+1)/2*this.transform.width+jt,(-v[1]/w+1)/2*this.transform.height+jt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}getPerspectiveRatio(e,s,l,u,p){const v=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,l,u,p):ne(s,l,e,p);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(e,s,l,u){return l<jt||e>=this.screenRightBoundary||u<jt||s>this.screenBottomBoundary}isInsideGrid(e,s,l,u){return l>=0&&e<this.gridRightBoundary&&u>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=h.an([]);return h.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,l,u,p,v,w,T,M,L){let R=new h.P(1,0),q=new h.P(0,1);const H=new h.P(e.anchorPointX+w[0],e.anchorPointY+w[1]);if(v&&!p){const We=this.projectAndGetPerspectiveRatio(l,H.x+1,H.y,u,M).point.sub(T.point).unit(),it=Math.atan(We.y/We.x)+(We.x<0?Math.PI:0),Xe=Math.sin(it),Ze=Math.cos(it);R=new h.P(Ze,Xe),q=new h.P(-Xe,Ze)}else if(!v&&p){const We=-this.transform.angle,it=Math.sin(We),Xe=Math.cos(We);R=new h.P(Xe,it),q=new h.P(-it,Xe)}let K=T.point,Q=s;if(p){K=H;const We=this.transform.zoom-Math.floor(this.transform.zoom);Q=Math.pow(2,-We),Q*=this.mapProjection.getPitchedTextCorrection(this.transform,H,u),L||(Q*=h.ac(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}L&&(K=K.add(R.mult(L.x*Q)).add(q.mult(L.y*Q)));const re=e.x1*Q,oe=e.x2*Q,ce=(re+oe)/2,ee=e.y1*Q,ge=e.y2*Q,ve=(ee+ge)/2,ke=[{offsetX:re,offsetY:ee},{offsetX:ce,offsetY:ee},{offsetX:oe,offsetY:ee},{offsetX:oe,offsetY:ve},{offsetX:oe,offsetY:ge},{offsetX:ce,offsetY:ge},{offsetX:re,offsetY:ge},{offsetX:re,offsetY:ve}];let Fe=[];for(const{offsetX:We,offsetY:it}of ke)Fe.push(new h.P(K.x+R.x*We+q.x*it,K.y+R.y*We+q.y*it));let Ue=!1;if(p){const We=Fe.map((it=>this.projectAndGetPerspectiveRatio(l,it.x,it.y,u,M)));Ue=We.some((it=>!it.isOccluded)),Fe=We.map((it=>it.point))}else Ue=!0;return{box:h.ao(Fe),allPointsOccluded:!Ue}}}function qt(f,e,s){return e*(h.X/(f.tileSize*Math.pow(2,s-f.tileID.overscaledZ)))}class ei{constructor(e,s,l,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class jr{constructor(e,s,l,u,p){this.text=new ei(e?e.text:null,s,l,p),this.icon=new ei(e?e.icon:null,s,u,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Kt{constructor(e,s,l){this.text=e,this.icon=s,this.skipFade=l}}class vr{constructor(){this.invProjMatrix=h.H(),this.viewportMatrix=h.H(),this.circles=[]}}class Rr{constructor(e,s,l,u,p){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=p}}class ci{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[e]}}function gi(f,e,s,l,u){const{horizontalAlign:p,verticalAlign:v}=h.au(f);return new h.P(-(p-.5)*e+l[0]*u,-(v-.5)*s+l[1]*u)}class Ri{constructor(e,s,l,u,p,v){this.transform=e.clone(),this.terrain=l,this.collisionIndex=new pr(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new ci(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(l,u)=>s.getElevation(e,l,u):null}getBucketParts(e,s,l,u){const p=l.getBucket(s),v=l.latestFeatureIndex;if(!p||!v||s.id!==p.layerIds[0])return;const w=l.collisionBoxArray,T=p.layers[0].layout,M=p.layers[0].paint,L=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),R=l.tileSize/h.X,q=l.tileID.toUnwrapped(),H=this.transform.calculatePosMatrix(q),K=T.get("text-pitch-alignment")==="map",Q=T.get("text-rotation-alignment")==="map",re=qt(l,1,this.transform.zoom),oe=this.collisionIndex.mapProjection.translatePosition(this.transform,l,M.get("text-translate"),M.get("text-translate-anchor")),ce=this.collisionIndex.mapProjection.translatePosition(this.transform,l,M.get("icon-translate"),M.get("icon-translate-anchor")),ee=cn(H,K,Q,this.transform,re);let ge=null;if(K){const ke=Li(H,K,Q,this.transform,re);ge=h.L([],this.transform.labelPlaneMatrix,ke)}this.retainedQueryData[p.bucketInstanceId]=new Rr(p.bucketInstanceId,v,p.sourceLayerIndex,p.index,l.tileID);const ve={bucket:p,layout:T,translationText:oe,translationIcon:ce,posMatrix:H,unwrappedTileID:q,textLabelPlaneMatrix:ee,labelToScreenMatrix:ge,scale:L,textPixelRatio:R,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:h.ag(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(u)for(const ke of p.sortKeyRanges){const{sortKey:Fe,symbolInstanceStart:Ue,symbolInstanceEnd:We}=ke;e.push({sortKey:Fe,symbolInstanceStart:Ue,symbolInstanceEnd:We,parameters:ve})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:ve})}attemptAnchorPlacement(e,s,l,u,p,v,w,T,M,L,R,q,H,K,Q,re,oe,ce,ee){const ge=h.aq[e.textAnchor],ve=[e.textOffset0,e.textOffset1],ke=gi(ge,l,u,ve,p),Fe=this.collisionIndex.placeCollisionBox(s,q,T,M,L,w,v,re,R.predicate,ee,ke);if((!ce||this.collisionIndex.placeCollisionBox(ce,q,T,M,L,w,v,oe,R.predicate,ee,ke).placeable)&&Fe.placeable){let Ue;if(this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(Ue=this.prevPlacement.variableOffsets[H.crossTileID].anchor),H.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[H.crossTileID]={textOffset:ve,width:l,height:u,anchor:ge,textBoxScale:p,prevAnchor:Ue},this.markUsedJustification(K,ge,H,Q),K.allowVerticalPlacement&&(this.markUsedOrientation(K,Q,H),this.placedOrientations[H.crossTileID]=Q),{shift:ke,placedGlyphBoxes:Fe}}}placeLayerBucketPart(e,s,l){const{bucket:u,layout:p,translationText:v,translationIcon:w,posMatrix:T,unwrappedTileID:M,textLabelPlaneMatrix:L,labelToScreenMatrix:R,textPixelRatio:q,holdingForFade:H,collisionBoxArray:K,partiallyEvaluatedTextSize:Q,collisionGroup:re}=e.parameters,oe=p.get("text-optional"),ce=p.get("icon-optional"),ee=h.ar(p,"text-overlap","text-allow-overlap"),ge=ee==="always",ve=h.ar(p,"icon-overlap","icon-allow-overlap"),ke=ve==="always",Fe=p.get("text-rotation-alignment")==="map",Ue=p.get("text-pitch-alignment")==="map",We=p.get("icon-text-fit")!=="none",it=p.get("symbol-z-order")==="viewport-y",Xe=ge&&(ke||!u.hasIconData()||ce),Ze=ke&&(ge||!u.hasTextData()||oe);!u.collisionArrays&&K&&u.deserializeCollisionBoxes(K);const dt=this._getTerrainElevationFunc(this.retainedQueryData[u.bucketInstanceId].tileID),Rt=(Ye,Qe,Lt)=>{var Tr,Ut;if(s[Ye.crossTileID])return;if(H)return void(this.placements[Ye.crossTileID]=new Kt(!1,!1,!1));let Xt=!1,Ir=!1,_i=!0,mn=null,Pr={box:null,placeable:!1,offscreen:null},hi={placeable:!1},Br=null,Jr=null,Si=null,rs=0,Yi=0,is=0;Qe.textFeatureIndex?rs=Qe.textFeatureIndex:Ye.useRuntimeCollisionCircles&&(rs=Ye.featureIndex),Qe.verticalTextFeatureIndex&&(Yi=Qe.verticalTextFeatureIndex);const bo=Qe.textBox;if(bo){const Ni=ii=>{let Nr=h.ah.horizontal;if(u.allowVerticalPlacement&&!ii&&this.prevPlacement){const ki=this.prevPlacement.placedOrientations[Ye.crossTileID];ki&&(this.placedOrientations[Ye.crossTileID]=ki,Nr=ki,this.markUsedOrientation(u,Nr,Ye))}return Nr},yn=(ii,Nr)=>{if(u.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&Qe.verticalTextBox){for(const ki of u.writingModes)if(ki===h.ah.vertical?(Pr=Nr(),hi=Pr):Pr=ii(),Pr&&Pr.placeable)break}else Pr=ii()},ns=Ye.textAnchorOffsetStartIndex,zn=Ye.textAnchorOffsetEndIndex;if(zn===ns){const ii=(Nr,ki)=>{const Yt=this.collisionIndex.placeCollisionBox(Nr,ee,q,T,M,Ue,Fe,v,re.predicate,dt);return Yt&&Yt.placeable&&(this.markUsedOrientation(u,ki,Ye),this.placedOrientations[Ye.crossTileID]=ki),Yt};yn((()=>ii(bo,h.ah.horizontal)),(()=>{const Nr=Qe.verticalTextBox;return u.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&Nr?ii(Nr,h.ah.vertical):{box:null,offscreen:null}})),Ni(Pr&&Pr.placeable)}else{let ii=h.aq[(Ut=(Tr=this.prevPlacement)===null||Tr===void 0?void 0:Tr.variableOffsets[Ye.crossTileID])===null||Ut===void 0?void 0:Ut.anchor];const Nr=(Yt,_n,So)=>{const ss=Yt.x2-Yt.x1,Vu=Yt.y2-Yt.y1,ju=Ye.textBoxScale,Ur=We&&ve==="never"?_n:null;let os=null,Yl=ee==="never"?1:2,Pa="never";ii&&Yl++;for(let ko=0;ko<Yl;ko++){for(let Ca=ns;Ca<zn;Ca++){const Is=u.textAnchorOffsets.get(Ca);if(ii&&Is.textAnchor!==ii)continue;const Cr=this.attemptAnchorPlacement(Is,Yt,ss,Vu,ju,Fe,Ue,q,T,M,re,Pa,Ye,u,So,v,w,Ur,dt);if(Cr&&(os=Cr.placedGlyphBoxes,os&&os.placeable))return Xt=!0,mn=Cr.shift,os}ii?ii=null:Pa=ee}return l&&!os&&(os={box:this.collisionIndex.placeCollisionBox(bo,"always",q,T,M,Ue,Fe,v,re.predicate,dt,new h.P(0,0)).box,offscreen:!1,placeable:!1}),os};yn((()=>Nr(bo,Qe.iconBox,h.ah.horizontal)),(()=>{const Yt=Qe.verticalTextBox;return u.allowVerticalPlacement&&(!Pr||!Pr.placeable)&&Ye.numVerticalGlyphVertices>0&&Yt?Nr(Yt,Qe.verticalIconBox,h.ah.vertical):{box:null,occluded:!0,offscreen:null}})),Pr&&(Xt=Pr.placeable,_i=Pr.offscreen);const ki=Ni(Pr&&Pr.placeable);if(!Xt&&this.prevPlacement){const Yt=this.prevPlacement.variableOffsets[Ye.crossTileID];Yt&&(this.variableOffsets[Ye.crossTileID]=Yt,this.markUsedJustification(u,Yt.anchor,Ye,ki))}}}if(Br=Pr,Xt=Br&&Br.placeable,_i=Br&&Br.offscreen,Ye.useRuntimeCollisionCircles){const Ni=u.text.placedSymbolArray.get(Ye.centerJustifiedTextSymbolIndex),yn=h.ai(u.textSizeData,Q,Ni),ns=p.get("text-padding");Jr=this.collisionIndex.placeCollisionCircles(ee,Ni,u.lineVertexArray,u.glyphOffsetArray,yn,T,M,L,R,l,Ue,re.predicate,Ye.collisionCircleDiameter,ns,v,dt),Jr.circles.length&&Jr.collisionDetected&&!l&&h.w("Collisions detected, but collision boxes are not shown"),Xt=ge||Jr.circles.length>0&&!Jr.collisionDetected,_i=_i&&Jr.offscreen}if(Qe.iconFeatureIndex&&(is=Qe.iconFeatureIndex),Qe.iconBox){const Ni=yn=>this.collisionIndex.placeCollisionBox(yn,ve,q,T,M,Ue,Fe,w,re.predicate,dt,We&&mn?mn:void 0);hi&&hi.placeable&&Qe.verticalIconBox?(Si=Ni(Qe.verticalIconBox),Ir=Si.placeable):(Si=Ni(Qe.iconBox),Ir=Si.placeable),_i=_i&&Si.offscreen}const gn=oe||Ye.numHorizontalGlyphVertices===0&&Ye.numVerticalGlyphVertices===0,An=ce||Ye.numIconVertices===0;gn||An?An?gn||(Ir=Ir&&Xt):Xt=Ir&&Xt:Ir=Xt=Ir&&Xt;const Es=Ir&&Si.placeable;if(Xt&&Br.placeable&&this.collisionIndex.insertCollisionBox(Br.box,ee,p.get("text-ignore-placement"),u.bucketInstanceId,hi&&hi.placeable&&Yi?Yi:rs,re.ID),Es&&this.collisionIndex.insertCollisionBox(Si.box,ve,p.get("icon-ignore-placement"),u.bucketInstanceId,is,re.ID),Jr&&Xt&&this.collisionIndex.insertCollisionCircles(Jr.circles,ee,p.get("text-ignore-placement"),u.bucketInstanceId,rs,re.ID),l&&this.storeCollisionData(u.bucketInstanceId,Lt,Qe,Br,Si,Jr),Ye.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ye.crossTileID]=new Kt(Xt||Xe,Ir||Ze,_i||u.justReloaded),s[Ye.crossTileID]=!0};if(it){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ye=u.getSortedSymbolIndexes(this.transform.angle);for(let Qe=Ye.length-1;Qe>=0;--Qe){const Lt=Ye[Qe];Rt(u.symbolInstances.get(Lt),u.collisionArrays[Lt],Lt)}}else for(let Ye=e.symbolInstanceStart;Ye<e.symbolInstanceEnd;Ye++)Rt(u.symbolInstances.get(Ye),u.collisionArrays[Ye],Ye);if(l&&u.bucketInstanceId in this.collisionCircleArrays){const Ye=this.collisionCircleArrays[u.bucketInstanceId];h.as(Ye.invProjMatrix,T),Ye.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}storeCollisionData(e,s,l,u,p,v){if(l.textBox||l.iconBox){let w,T;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(s)?T=w.get(s):(T={text:null,icon:null},w.set(s,T)),l.textBox&&(T.text=u.box),l.iconBox&&(T.icon=p.box)}if(v){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=new vr);for(let T=0;T<v.circles.length;T+=4)w.circles.push(v.circles[T+0]),w.circles.push(v.circles[T+1]),w.circles.push(v.circles[T+2]),w.circles.push(v.collisionDetected?1:0)}}markUsedJustification(e,s,l,u){let p;p=u===h.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[h.at(s)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of v)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=p>=0&&w!==p?0:l.crossTileID)}markUsedOrientation(e,s,l){const u=s===h.ah.horizontal||s===h.ah.horizontalOnly?s:0,p=s===h.ah.vertical?s:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of v)e.text.placedSymbolArray.get(w).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const u=s?s.symbolFadeChange(e):1,p=s?s.opacities:{},v=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(const T in this.placements){const M=this.placements[T],L=p[T];L?(this.opacities[T]=new jr(L,u,M.text,M.icon),l=l||M.text!==L.text.placed||M.icon!==L.icon.placed):(this.opacities[T]=new jr(null,u,M.text,M.icon,M.skipFade),l=l||M.text||M.icon)}for(const T in p){const M=p[T];if(!this.opacities[T]){const L=new jr(M,u,!1,!1);L.isHidden()||(this.opacities[T]=L,l=l||M.text.placed||M.icon.placed)}}for(const T in v)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=v[T]);for(const T in w)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=w[T]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const l={};for(const u of s){const p=u.getBucket(e);p&&u.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,u.tileID,l,u.collisionBoxArray)}}updateBucketOpacities(e,s,l,u){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const p=e.layers[0],v=p.layout,w=new jr(null,0,!1,!1,!0),T=v.get("text-allow-overlap"),M=v.get("icon-allow-overlap"),L=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=v.get("text-rotation-alignment")==="map",q=v.get("text-pitch-alignment")==="map",H=v.get("icon-text-fit")!=="none",K=new jr(null,0,T&&(M||!e.hasIconData()||v.get("icon-optional")),M&&(T||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&u&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(u);const Q=(oe,ce,ee)=>{for(let ge=0;ge<ce/4;ge++)oe.opacityVertexArray.emplaceBack(ee);oe.hasVisibleVertices=oe.hasVisibleVertices||ee!==Fi},re=this.collisionBoxArrays.get(e.bucketInstanceId);for(let oe=0;oe<e.symbolInstances.length;oe++){const ce=e.symbolInstances.get(oe),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:ge,crossTileID:ve}=ce;let ke=this.opacities[ve];l[ve]?ke=w:ke||(ke=K,this.opacities[ve]=ke),l[ve]=!0;const Fe=ce.numIconVertices>0,Ue=this.placedOrientations[ce.crossTileID],We=Ue===h.ah.vertical,it=Ue===h.ah.horizontal||Ue===h.ah.horizontalOnly;if(ee>0||ge>0){const Ze=Ci(ke.text);Q(e.text,ee,We?Fi:Ze),Q(e.text,ge,it?Fi:Ze);const dt=ke.text.isHidden();[ce.rightJustifiedTextSymbolIndex,ce.centerJustifiedTextSymbolIndex,ce.leftJustifiedTextSymbolIndex].forEach((Qe=>{Qe>=0&&(e.text.placedSymbolArray.get(Qe).hidden=dt||We?1:0)})),ce.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ce.verticalPlacedTextSymbolIndex).hidden=dt||it?1:0);const Rt=this.variableOffsets[ce.crossTileID];Rt&&this.markUsedJustification(e,Rt.anchor,ce,Ue);const Ye=this.placedOrientations[ce.crossTileID];Ye&&(this.markUsedJustification(e,"left",ce,Ye),this.markUsedOrientation(e,Ye,ce))}if(Fe){const Ze=Ci(ke.icon),dt=!(H&&ce.verticalPlacedIconSymbolIndex&&We);ce.placedIconSymbolIndex>=0&&(Q(e.icon,ce.numIconVertices,dt?Ze:Fi),e.icon.placedSymbolArray.get(ce.placedIconSymbolIndex).hidden=ke.icon.isHidden()),ce.verticalPlacedIconSymbolIndex>=0&&(Q(e.icon,ce.numVerticalIconVertices,dt?Fi:Ze),e.icon.placedSymbolArray.get(ce.verticalPlacedIconSymbolIndex).hidden=ke.icon.isHidden())}const Xe=re&&re.has(oe)?re.get(oe):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ze=e.collisionArrays[oe];if(Ze){let dt=new h.P(0,0);if(Ze.textBox||Ze.verticalTextBox){let Rt=!0;if(L){const Ye=this.variableOffsets[ve];Ye?(dt=gi(Ye.anchor,Ye.width,Ye.height,Ye.textOffset,Ye.textBoxScale),R&&dt._rotate(q?this.transform.angle:-this.transform.angle)):Rt=!1}if(Ze.textBox||Ze.verticalTextBox){let Ye;Ze.textBox&&(Ye=We),Ze.verticalTextBox&&(Ye=it),oa(e.textCollisionBox.collisionVertexArray,ke.text.placed,!Rt||Ye,Xe.text,dt.x,dt.y)}}if(Ze.iconBox||Ze.verticalIconBox){const Rt=!!(!it&&Ze.verticalIconBox);let Ye;Ze.iconBox&&(Ye=Rt),Ze.verticalIconBox&&(Ye=!Rt),oa(e.iconCollisionBox.collisionVertexArray,ke.icon.placed,Ye,Xe.icon,H?dt.x:0,H?dt.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const oe=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=oe.invProjMatrix,e.placementViewportMatrix=oe.viewportMatrix,e.collisionCircleArray=oe.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function oa(f,e,s,l,u,p){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-jt,w=l[1]-jt,T=l[2]-jt,M=l[3]-jt;f.emplaceBack(e?1:0,s?1:0,u||0,p||0,v,w),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,T,w),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,T,M),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,v,M)}const Ot=Math.pow(2,25),gu=Math.pow(2,24),Za=Math.pow(2,17),qi=Math.pow(2,16),Pi=Math.pow(2,9),bh=Math.pow(2,8),hn=Math.pow(2,1);function Ci(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const e=f.placed?1:0,s=Math.floor(127*f.opacity);return s*Ot+e*gu+s*Za+e*qi+s*Pi+e*bh+s*hn+e}const Fi=0;function Do(){return{isOccluded:(f,e,s)=>!1,getPitchedTextCorrection:(f,e,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(f,e,s,l){throw new Error("Not implemented.")},translatePosition:(f,e,s,l)=>(function(u,p,v,w,T=!1){if(!v[0]&&!v[1])return[0,0];const M=T?w==="map"?u.angle:0:w==="viewport"?-u.angle:0;if(M){const L=Math.sin(M),R=Math.cos(M);v=[v[0]*R-v[1]*L,v[0]*L+v[1]*R]}return[T?v[0]:qt(p,v[0],u.zoom),T?v[1]:qt(p,v[1],u.zoom)]})(f,e,s,l),getCircleRadiusCorrection:f=>1}}class kr{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,l,u,p){const v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(v,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort(((w,T)=>w.sortKey-T.sortKey)));this._currentPartIndex<v.length;)if(s.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,p())return!0;return!1}}class Ga{constructor(e,s,l,u,p,v,w,T){this.placement=new Ri(e,Do(),s,v,w,T),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,s,l){const u=N.now(),p=()=>!this._forceFullPlacement&&N.now()-u>2;for(;this._currentPlacementIndex>=0;){const v=s[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=w)&&(!v.maxzoom||v.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new kr(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Wn=512/h.X/2;class ti{constructor(e,s,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let p=0;p<s.length;p++){const v=s.get(p),w=v.key,T=u.get(w);T?T.push(v):u.set(w,[v])}for(const[p,v]of u){const w={positions:v.map((T=>({x:Math.floor(T.anchorX*Wn),y:Math.floor(T.anchorY*Wn)}))),crossTileIDs:v.map((T=>T.crossTileID))};if(w.positions.length>128){const T=new h.av(w.positions.length,16,Uint16Array);for(const{x:M,y:L}of w.positions)T.add(M,L);T.finish(),delete w.positions,w.index=T}this._symbolsByKey[p]=w}}getScaledCoordinates(e,s){const{x:l,y:u,z:p}=this.tileID.canonical,{x:v,y:w,z:T}=s.canonical,M=Wn/Math.pow(2,T-p),L=(w*h.X+e.anchorY)*M,R=u*h.X*Wn;return{x:Math.floor((v*h.X+e.anchorX)*M-l*h.X*Wn),y:Math.floor(L-R)}}findMatches(e,s,l){const u=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let p=0;p<e.length;p++){const v=e.get(p);if(v.crossTileID)continue;const w=this._symbolsByKey[v.key];if(!w)continue;const T=this.getScaledCoordinates(v,s);if(w.index){const M=w.index.range(T.x-u,T.y-u,T.x+u,T.y+u).sort();for(const L of M){const R=w.crossTileIDs[L];if(!l[R]){l[R]=!0,v.crossTileID=R;break}}}else if(w.positions)for(let M=0;M<w.positions.length;M++){const L=w.positions[M],R=w.crossTileIDs[M];if(Math.abs(L.x-T.x)<=u&&Math.abs(L.y-T.y)<=u&&!l[R]){l[R]=!0,v.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class Lo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Zi{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const l in this.indexes){const u=this.indexes[l],p={};for(const v in u){const w=u[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),p[w.tileID.key]=w}this.indexes[l]=p}this.lng=e}addBucket(e,s,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<s.symbolInstances.length;p++)s.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const p in this.indexes){const v=this.indexes[p];if(Number(p)>e.overscaledZ)for(const w in v){const T=v[w];T.tileID.isChildOf(e)&&T.findMatches(s.symbolInstances,e,u)}else{const w=v[e.scaledTo(Number(p)).key];w&&w.findMatches(s.symbolInstances,e,u)}}for(let p=0;p<s.symbolInstances.length;p++){const v=s.symbolInstances.get(p);v.crossTileID||(v.crossTileID=l.generate(),u[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new ti(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const l of s.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let s=!1;for(const l in this.indexes){const u=this.indexes[l];for(const p in u)e[u[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[p]),delete u[p],s=!0)}return s}}class Ro{constructor(){this.layerIndexes={},this.crossTileIDs=new Lo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,l){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new Zi);let p=!1;const v={};u.handleWrapJump(l);for(const w of s){const T=w.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(w.tileID,T,this.crossTileIDs)&&(p=!0),v[T.bucketInstanceId]=!0)}return u.removeStaleBuckets(v)&&(p=!0),p}pruneUnusedLayers(e){const s={};e.forEach((l=>{s[l]=!0}));for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const Gi=(f,e)=>h.t(f,e&&e.filter((s=>s.identifier!=="source.canvas"))),Sh=h.aw();class Pl extends h.E{constructor(e,s={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const u=this.sourceCaches[l].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new li(Sr(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((l,u)=>this.getGlyphs(l,u))),this.dispatcher.registerMessageHandler("GI",((l,u)=>this.getImages(l,u))),this.imageManager=new Vt,this.imageManager.setEventedParent(this),this.glyphManager=new cr(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Gt(256,512),this.crossTileSymbolIndex=new Ro,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",h.ay()),$i().on($e,this._rtlPluginLoaded),this.on("data",(l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const u=this.sourceCaches[l.sourceId];if(!u)return;const p=u.getSource();if(p&&p.vectorLayerIds)for(const v in this._layers){const w=this._layers[v];w.source===p.id&&this._validateLayer(w)}}))}loadURL(e,s={},l){this.fire(new h.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const u=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;h.h(u,this._loadStyleRequest).then((v=>{this._loadStyleRequest=null,this._load(v.data,s,l)})).catch((v=>{this._loadStyleRequest=null,v&&!p.signal.aborted&&this.fire(new h.j(v))}))}loadJSON(e,s={},l){this.fire(new h.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,N.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,l)})).catch((()=>{}))}loadEmpty(){this.fire(new h.k("dataloading",{dataType:"style"})),this._load(Sh,{validate:!1})}_load(e,s,l){var u;const p=s.transformStyle?s.transformStyle(l,e):e;if(!s.validate||!Gi(this,h.u(p))){this._loaded=!0,this.stylesheet=p;for(const v in p.sources)this.addSource(v,p.sources[v],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs),this._createLayers(),this.light=new ht(this.stylesheet.light),this.sky=new Oe(this.stylesheet.sky),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new h.k("data",{dataType:"style"})),this.fire(new h.k("style.load"))}}_createLayers(){const e=h.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((s=>s.id)),this._layers={},this._serializedLayers=null;for(const s of e){const l=h.aA(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(e,s=!1,l=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(p,v,w,T){return h._(this,void 0,void 0,(function*(){const M=Zt(p),L=w>1?"@2x":"",R={},q={};for(const{id:H,url:K}of M){const Q=v.transformRequest(nr(K,L,".json"),"SpriteJSON");R[H]=h.h(Q,T);const re=v.transformRequest(nr(K,L,".png"),"SpriteImage");q[H]=Ge.getImage(re,T)}return yield Promise.all([...Object.values(R),...Object.values(q)]),(function(H,K){return h._(this,void 0,void 0,(function*(){const Q={};for(const re in H){Q[re]={};const oe=N.getImageCanvasContext((yield K[re]).data),ce=(yield H[re]).data;for(const ee in ce){const{width:ge,height:ve,x:ke,y:Fe,sdf:Ue,pixelRatio:We,stretchX:it,stretchY:Xe,content:Ze,textFitWidth:dt,textFitHeight:Rt}=ce[ee];Q[re][ee]={data:null,pixelRatio:We,sdf:Ue,stretchX:it,stretchY:Xe,content:Ze,textFitWidth:dt,textFitHeight:Rt,spriteData:{width:ge,height:ve,x:ke,y:Fe,context:oe}}}}return Q}))})(R,q)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((p=>{if(this._spriteRequest=null,p)for(const v in p){this._spritesImagesIds[v]=[];const w=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter((T=>!(T in p))):[];for(const T of w)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in p[v]){const M=v==="default"?T:`${v}:${T}`;this._spritesImagesIds[v].push(M),M in this.imageManager.images?this.imageManager.updateImage(M,p[v][T],!1):this.imageManager.addImage(M,p[v][T]),s&&(this._changedImages[M]=!0)}}})).catch((p=>{this._spriteRequest=null,u=p,this.fire(new h.j(u))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"})),l&&l(u)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const l=e.sourceLayer;if(!l)return;const u=s.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new h.j(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?h.aB(l):l);const u=[];for(const p of e)if(l[p]){const v=s?h.aB(l[p]):l[p];u.push(v)}return u}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const u=this._layers[l];u.type!=="custom"&&(e[l]=u.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const u=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(u.length||p.length)&&this._updateWorkerLayers(u,p);for(const v in this._updatedSources){const w=this._updatedSources[v];if(w==="reload")this._reloadSource(v);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const p=this.sourceCaches[u];l[u]=p.used,p.used=!1}for(const u of this._order){const p=this._layers[u];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const u in l){const p=this.sourceCaches[u];!!l[u]!=!!p.used&&p.fire(new h.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,s&&this.fire(new h.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var l;this._checkLoaded();const u=this.serialize();if(e=s.transformStyle?s.transformStyle(u,e):e,((l=s.validate)===null||l===void 0||l)&&Gi(this,h.u(e)))return!1;(e=h.aB(e)).layers=h.az(e.layers);const p=h.aC(u,e),v=this._getOperationsToPerform(p);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const w of v.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],l=[];for(const u of e)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push((()=>this.addLayer.apply(this,u.args)));break;case"removeLayer":s.push((()=>this.removeLayer.apply(this,u.args)));break;case"setPaintProperty":s.push((()=>this.setPaintProperty.apply(this,u.args)));break;case"setLayoutProperty":s.push((()=>this.setLayoutProperty.apply(this,u.args)));break;case"setFilter":s.push((()=>this.setFilter.apply(this,u.args)));break;case"addSource":s.push((()=>this.addSource.apply(this,u.args)));break;case"removeSource":s.push((()=>this.removeSource.apply(this,u.args)));break;case"setLayerZoomRange":s.push((()=>this.setLayerZoomRange.apply(this,u.args)));break;case"setLight":s.push((()=>this.setLight.apply(this,u.args)));break;case"setGeoJSONSourceData":s.push((()=>this.setGeoJSONSourceData.apply(this,u.args)));break;case"setGlyphs":s.push((()=>this.setGlyphs.apply(this,u.args)));break;case"setSprite":s.push((()=>this.setSprite.apply(this,u.args)));break;case"setSky":s.push((()=>this.setSky.apply(this,u.args)));break;case"setTerrain":s.push((()=>this.map.setTerrain.apply(this,u.args)));break;case"setTransition":s.push((()=>{}));break;default:l.push(u.command)}return{operations:s,unimplemented:l}}addImage(e,s){if(this.getImage(e))return this.fire(new h.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new h.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(h.u.source,`sources.${e}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const u=this.sourceCaches[e]=new Dt(e,s,this.dispatcher);u.style=this,u.setEventedParent(this,(()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e}))),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new h.j(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new h.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,l={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new h.j(new Error(`Layer "${u}" already exists on this map.`)));let p;if(e.type==="custom"){if(Gi(this,h.aD(e)))return;p=h.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(u,e.source),e=h.aB(e),e=h.e(e,{source:u})),this._validate(h.u.layer,`layers.${u}`,e,{arrayIndex:-1},l))return;p=h.aA(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:u}})}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)this.fire(new h.j(new Error(`Cannot add layer "${u}" before non-existing layer "${s}".`)));else{if(this._order.splice(v,0,u),this._layerOrderChanged=!0,this._layers[u]=p,this._removedLayers[u]&&p.source&&p.type!=="custom"){const w=this._removedLayers[u];delete this._removedLayers[u],w.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new h.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const l=this._order.indexOf(e);this._order.splice(l,1);const u=s?this._order.indexOf(s):this._order.length;s&&u===-1?this.fire(new h.j(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new h.j(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,l){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===s&&u.maxzoom===l||(s!=null&&(u.minzoom=s),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new h.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,l={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!h.aE(u.filter,s))return s==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(h.u.filter,`layers.${u.id}.filter`,s,null,l)||(u.filter=h.aB(s),this._updateLayer(u)))}else this.fire(new h.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return h.aB(this.getLayer(e).filter)}setLayoutProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?h.aE(p.getLayoutProperty(s),l)||(p.setLayoutProperty(s,l,u),this._updateLayer(p)):this.fire(new h.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const l=this.getLayer(e);if(l)return l.getLayoutProperty(s);this.fire(new h.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?h.aE(p.getPaintProperty(s),l)||(p.setPaintProperty(s,l,u)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new h.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const l=e.source,u=e.sourceLayer,p=this.sourceCaches[l];if(p===void 0)return void this.fire(new h.j(new Error(`The source '${l}' does not exist in the map's style.`)));const v=p.getSource().type;v==="geojson"&&u?this.fire(new h.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||u?(e.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),p.setFeatureState(u,e.id,s)):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const l=e.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new h.j(new Error(`The source '${l}' does not exist in the map's style.`)));const p=u.getSource().type,v=p==="vector"?e.sourceLayer:void 0;p!=="vector"||v?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new h.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(v,e.id,s):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,l=e.sourceLayer,u=this.sourceCaches[s];if(u!==void 0)return u.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,e.id)):void this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=h.aF(this.sourceCaches,(p=>p.serialize())),s=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,u=this.stylesheet;return h.aG({version:u.version,name:u.name,metadata:u.metadata,light:u.light,sky:u.sky,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:e,layers:s,terrain:l},(p=>p!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=v=>this._layers[v].type==="fill-extrusion",l={},u=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w)){l[w]=v;for(const T of e){const M=T[w];if(M)for(const L of M)u.push(L)}}}u.sort(((v,w)=>w.intersectionZ-v.intersectionZ));const p=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w))for(let T=u.length-1;T>=0;T--){const M=u[T].feature;if(l[M.layer.id]<v)break;p.push(M),u.pop()}else for(const T of e){const M=T[w];if(M)for(const L of M)p.push(L.feature)}}return p}queryRenderedFeatures(e,s,l){s&&s.filter&&this._validate(h.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const u={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new h.j(new Error("parameters.layers must be an Array."))),[];for(const w of s.layers){const T=this._layers[w];if(!T)return this.fire(new h.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];u[T.source]=!0}}const p=[];s.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const w in this.sourceCaches)s.layers&&!u[w]||p.push(Zn(this.sourceCaches[w],this._layers,v,e,s,l));return this.placement&&p.push((function(w,T,M,L,R,q,H){const K={},Q=q.queryRenderedSymbols(L),re=[];for(const oe of Object.keys(Q).map(Number))re.push(H[oe]);re.sort(gs);for(const oe of re){const ce=oe.featureIndex.lookupSymbolFeatures(Q[oe.bucketInstanceId],T,oe.bucketIndex,oe.sourceLayerIndex,R.filter,R.layers,R.availableImages,w);for(const ee in ce){const ge=K[ee]=K[ee]||[],ve=ce[ee];ve.sort(((ke,Fe)=>{const Ue=oe.featureSortOrder;if(Ue){const We=Ue.indexOf(ke.featureIndex);return Ue.indexOf(Fe.featureIndex)-We}return Fe.featureIndex-ke.featureIndex}));for(const ke of ve)ge.push(ke)}}for(const oe in K)K[oe].forEach((ce=>{const ee=ce.feature,ge=M[w[oe].source].getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=ge}));return K})(this._layers,v,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,s){s&&s.filter&&this._validate(h.u.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[e];return l?(function(u,p){const v=u.getRenderableIds().map((M=>u.getTileByID(M))),w=[],T={};for(let M=0;M<v.length;M++){const L=v[M],R=L.tileID.canonical.key;T[R]||(T[R]=!0,L.querySourceFeatures(w,p))}return w})(l,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const v in e)if(!h.aE(e[v],l[v])){u=!0;break}if(!u)return;const p={now:N.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(p)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){const l=this.getSky();let u=!1;if(!e&&!l)return;if(e&&!l)u=!0;else if(!e&&l)u=!0;else for(const v in e)if(!h.aE(e[v],l[v])){u=!0;break}if(!u)return;const p={now:N.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(p)}_validate(e,s,l,u,p={}){return(!p||p.validate!==!1)&&Gi(this,e.call(h.u,h.e({key:s,style:this.serialize(),value:l,styleSpec:h.v},u)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),$i().off($e,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,l,u,p=!1){let v=!1,w=!1;const T={};for(const M of this._order){const L=this._layers[M];if(L.type!=="symbol")continue;if(!T[L.source]){const q=this.sourceCaches[L.source];T[L.source]=q.getRenderableIds(!0).map((H=>q.getTileByID(H))).sort(((H,K)=>K.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(K.tileID)?-1:1)))}const R=this.crossTileSymbolIndex.addLayer(L,T[L.source],e.center.lng);v=v||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(N.now(),e.zoom))&&(this.pauseablePlacement=new Ga(e,this.map.terrain,this._order,p,s,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(N.now()),w=!0),v&&this.pauseablePlacement.placement.setStale()),w||v)for(const M of this._order){const L=this._layers[M];L.type==="symbol"&&this.placement.updateLayerOpacities(L,T[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(N.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return h._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,s.icons),l}))}getGlyphs(e,s){return h._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(h.u.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,l={},u){this._checkLoaded();const p=[{id:e,url:s}],v=[...Zt(this.stylesheet.sprite),...p];this._validate(h.u.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(p,!0,u))}removeSprite(e){this._checkLoaded();const s=Zt(this.stylesheet.sprite);if(s.find((l=>l.id===e))){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex((l=>l.id===e)),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}else this.fire(new h.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Zt(this.stylesheet.sprite)}setSprite(e,s={},l){this._checkLoaded(),e&&this._validate(h.u.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var Ds=h.Y([{name:"a_pos",type:"Int16",components:2}]);const Ls={prelude:fr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:fr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:fr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:fr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:fr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:fr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:fr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:fr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:fr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:fr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:fr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:fr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:fr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:fr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:fr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:fr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:fr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:fr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:fr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:fr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:fr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:fr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:fr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:fr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:fr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:fr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:fr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:fr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function fr(f,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/attribute ([\w]+) ([\w]+)/g),u=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=p?p.concat(u):u,w={};return{fragmentSource:f=f.replace(s,((T,M,L,R,q)=>(w[q]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${q}
varying ${L} ${R} ${q};
#else
uniform ${L} ${R} u_${q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${q}
    ${L} ${R} ${q} = u_${q};
#endif
`))),vertexSource:e=e.replace(s,((T,M,L,R,q)=>{const H=R==="float"?"vec2":"vec4",K=q.match(/color/)?"color":H;return w[q]?M==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${L} ${H} a_${q};
varying ${L} ${R} ${q};
#else
uniform ${L} ${R} u_${q};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${L} ${R} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${K}(a_${q}, u_${q}_t);
#else
    ${L} ${R} ${q} = u_${q};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
attribute ${L} ${H} a_${q};
#else
uniform ${L} ${R} u_${q};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${L} ${R} ${q} = a_${q};
#else
    ${L} ${R} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${L} ${R} ${q} = unpack_mix_${K}(a_${q}, u_${q}_t);
#else
    ${L} ${R} ${q} = u_${q};
#endif
`})),staticAttributes:l,staticUniforms:v}}class Fo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,l,u,p,v,w,T,M){this.context=e;let L=this.boundPaintVertexBuffers.length!==u.length;for(let R=0;!L&&R<u.length;R++)this.boundPaintVertexBuffers[R]!==u[R]&&(L=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||L||this.boundIndexBuffer!==p||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==M?this.freshBind(s,l,u,p,v,w,T,M):(e.bindVertexArray.set(this.vao),w&&w.bind(),p&&p.dynamicDraw&&p.bind(),T&&T.bind(),M&&M.bind())}freshBind(e,s,l,u,p,v,w,T){const M=e.numAttributes,L=this.context,R=L.gl;this.vao&&this.destroy(),this.vao=L.createVertexArray(),L.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=T,s.enableAttributes(R,e);for(const q of l)q.enableAttributes(R,e);v&&v.enableAttributes(R,e),w&&w.enableAttributes(R,e),T&&T.enableAttributes(R,e),s.bind(),s.setVertexAttribPointers(R,e,p);for(const q of l)q.bind(),q.setVertexAttribPointers(R,e,p);v&&(v.bind(),v.setVertexAttribPointers(R,e,p)),u&&u.bind(),w&&(w.bind(),w.setVertexAttribPointers(R,e,p)),T&&(T.bind(),T.setVertexAttribPointers(R,e,p)),L.currentNumAttributes=M}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const yu=(f,e,s,l,u)=>({u_matrix:f,u_texture:0,u_ele_delta:e,u_fog_matrix:s,u_fog_color:l?l.properties.get("fog-color"):h.aM.white,u_fog_ground_blend:l?l.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:l?l.calculateFogBlendOpacity(u):0,u_horizon_color:l?l.properties.get("horizon-color"):h.aM.white,u_horizon_fog_blend:l?l.properties.get("horizon-fog-blend"):1});function lo(f){const e=[];for(let s=0;s<f.length;s++){if(f[s]===null)continue;const l=f[s].split(" ");e.push(l.pop())}return e}class xr{constructor(e,s,l,u,p,v){const w=e.gl;this.program=w.createProgram();const T=lo(s.staticAttributes),M=l?l.getBinderAttributes():[],L=T.concat(M),R=Ls.prelude.staticUniforms?lo(Ls.prelude.staticUniforms):[],q=s.staticUniforms?lo(s.staticUniforms):[],H=l?l.getBinderUniforms():[],K=R.concat(q).concat(H),Q=[];for(const ke of K)Q.indexOf(ke)<0&&Q.push(ke);const re=l?l.defines():[];p&&re.push("#define OVERDRAW_INSPECTOR;"),v&&re.push("#define TERRAIN3D;");const oe=re.concat(Ls.prelude.fragmentSource,s.fragmentSource).join(`
`),ce=re.concat(Ls.prelude.vertexSource,s.vertexSource).join(`
`),ee=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(ee,oe),w.compileShader(ee),!w.getShaderParameter(ee,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(ee)}`);w.attachShader(this.program,ee);const ge=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(ge,ce),w.compileShader(ge),!w.getShaderParameter(ge,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(ge)}`);w.attachShader(this.program,ge),this.attributes={};const ve={};this.numAttributes=L.length;for(let ke=0;ke<this.numAttributes;ke++)L[ke]&&(w.bindAttribLocation(this.program,ke,L[ke]),this.attributes[L[ke]]=ke);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(ge),w.deleteShader(ee);for(let ke=0;ke<Q.length;ke++){const Fe=Q[ke];if(Fe&&!ve[Fe]){const Ue=w.getUniformLocation(this.program,Fe);Ue&&(ve[Fe]=Ue)}}this.fixedUniforms=u(e,ve),this.terrainUniforms=((ke,Fe)=>({u_depth:new h.aH(ke,Fe.u_depth),u_terrain:new h.aH(ke,Fe.u_terrain),u_terrain_dim:new h.aI(ke,Fe.u_terrain_dim),u_terrain_matrix:new h.aJ(ke,Fe.u_terrain_matrix),u_terrain_unpack:new h.aK(ke,Fe.u_terrain_unpack),u_terrain_exaggeration:new h.aI(ke,Fe.u_terrain_exaggeration)}))(e,ve),this.binderUniforms=l?l.getUniforms(e,ve):[]}draw(e,s,l,u,p,v,w,T,M,L,R,q,H,K,Q,re,oe,ce){const ee=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(u),e.setColorMode(p),e.setCullFace(v),T){e.activeTexture.set(ee.TEXTURE2),ee.bindTexture(ee.TEXTURE_2D,T.depthTexture),e.activeTexture.set(ee.TEXTURE3),ee.bindTexture(ee.TEXTURE_2D,T.texture);for(const ve in this.terrainUniforms)this.terrainUniforms[ve].set(T[ve])}for(const ve in this.fixedUniforms)this.fixedUniforms[ve].set(w[ve]);Q&&Q.setUniforms(e,this.binderUniforms,H,{zoom:K});let ge=0;switch(s){case ee.LINES:ge=2;break;case ee.TRIANGLES:ge=3;break;case ee.LINE_STRIP:ge=1}for(const ve of q.get()){const ke=ve.vaos||(ve.vaos={});(ke[M]||(ke[M]=new Fo)).bind(e,this,L,Q?Q.getPaintVertexBuffers():[],R,ve.vertexOffset,re,oe,ce),ee.drawElements(s,ve.primitiveLength*ge,ee.UNSIGNED_SHORT,ve.primitiveOffset*ge*2)}}}function Ha(f,e,s){const l=1/qt(s,1,e.transform.tileZoom),u=Math.pow(2,s.tileID.overscaledZ),p=s.tileSize*Math.pow(2,e.transform.tileZoom)/u,v=p*(s.tileID.canonical.x+s.tileID.wrap*u),w=p*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const aa=(f,e,s,l)=>{const u=e.style.light,p=u.properties.get("position"),v=[p.x,p.y,p.z],w=(function(){var M=new h.A(9);return h.A!=Float32Array&&(M[1]=0,M[2]=0,M[3]=0,M[5]=0,M[6]=0,M[7]=0),M[0]=1,M[4]=1,M[8]=1,M})();u.properties.get("anchor")==="viewport"&&(function(M,L){var R=Math.sin(L),q=Math.cos(L);M[0]=q,M[1]=R,M[2]=0,M[3]=-R,M[4]=q,M[5]=0,M[6]=0,M[7]=0,M[8]=1})(w,-e.transform.angle),(function(M,L,R){var q=L[0],H=L[1],K=L[2];M[0]=q*R[0]+H*R[3]+K*R[6],M[1]=q*R[1]+H*R[4]+K*R[7],M[2]=q*R[2]+H*R[5]+K*R[8]})(v,v,w);const T=u.properties.get("color");return{u_matrix:f,u_lightpos:v,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+s,u_opacity:l}},la=(f,e,s,l,u,p,v)=>h.e(aa(f,e,s,l),Ha(p,e,v),{u_height_factor:-Math.pow(2,u.overscaledZ)/v.tileSize/8}),Bo=f=>({u_matrix:f}),_u=(f,e,s,l)=>h.e(Bo(f),Ha(s,e,l)),xc=(f,e)=>({u_matrix:f,u_world:e}),Cl=(f,e,s,l,u)=>h.e(_u(f,e,s,l),{u_world:u}),Ml=(f,e,s,l)=>{const u=f.transform;let p,v;if(l.paint.get("circle-pitch-alignment")==="map"){const w=qt(s,1,u.zoom);p=!0,v=[w,w]}else p=!1,v=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(e.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:v}},Hi=(f,e,s)=>({u_matrix:f,u_inv_matrix:e,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),Tn=(f,e,s=1)=>({u_matrix:f,u_color:e,u_overlay:0,u_overlay_scale:s}),ri=f=>({u_matrix:f}),yi=(f,e,s,l)=>({u_matrix:f,u_extrude_scale:qt(e,1,s),u_intensity:l}),uo=(f,e,s,l)=>{const u=h.H();h.aP(u,0,f.width,f.height,0,0,1);const p=f.context.gl;return{u_matrix:u,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:s,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}};function Xn(f,e){const s=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new h.Z(0,l/s).toLngLat().lat,new h.Z(0,(l+1)/s).toLngLat().lat]}const Al=(f,e,s,l)=>{const u=f.transform;return{u_matrix:Wa(f,e,s,l),u_ratio:1/qt(e,1,u.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},vu=(f,e,s,l,u)=>h.e(Al(f,e,s,u),{u_image:0,u_image_height:l}),xs=(f,e,s,l,u)=>{const p=f.transform,v=xu(e,p);return{u_matrix:Wa(f,e,s,u),u_texsize:e.imageAtlasTexture.size,u_ratio:1/qt(e,1,p.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[v,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},kh=(f,e,s,l,u,p)=>{const v=f.lineAtlas,w=xu(e,f.transform),T=s.layout.get("line-cap")==="round",M=v.getDash(l.from,T),L=v.getDash(l.to,T),R=M.width*u.fromScale,q=L.width*u.toScale;return h.e(Al(f,e,s,p),{u_patternscale_a:[w/R,-M.height/2],u_patternscale_b:[w/q,-L.height/2],u_sdfgamma:v.width/(256*Math.min(R,q)*f.pixelRatio)/2,u_image:0,u_tex_y_a:M.y,u_tex_y_b:L.y,u_mix:u.t})};function xu(f,e){return 1/qt(f,1,e.tileZoom)}function Wa(f,e,s,l){return f.translatePosMatrix(l?l.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const wc=(f,e,s,l,u)=>{return{u_matrix:f,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(v=u.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(p=u.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:Th(u.paint.get("raster-hue-rotate"))};var p,v};function Th(f){f*=Math.PI/180;const e=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const ua=(f,e,s,l,u,p,v,w,T,M,L,R,q,H)=>{const K=v.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:K.cameraToCenterDistance,u_pitch:K.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:K.width/K.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:T,u_coord_matrix:M,u_is_text:+R,u_pitch_with_map:+l,u_is_along_line:u,u_is_variable_anchor:p,u_texsize:q,u_texture:0,u_translation:L,u_pitched_scale:H}},Rs=(f,e,s,l,u,p,v,w,T,M,L,R,q,H,K)=>{const Q=v.transform;return h.e(ua(f,e,s,l,u,p,v,w,T,M,L,R,q,K),{u_gamma_scale:l?Math.cos(Q._pitch)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},co=(f,e,s,l,u,p,v,w,T,M,L,R,q,H)=>h.e(Rs(f,e,s,l,u,p,v,w,T,M,L,!0,R,!0,H),{u_texsize_icon:q,u_texture_icon:1}),Oo=(f,e,s)=>({u_matrix:f,u_opacity:e,u_color:s}),wu=(f,e,s,l,u,p)=>h.e((function(v,w,T,M){const L=T.imageManager.getPattern(v.from.toString()),R=T.imageManager.getPattern(v.to.toString()),{width:q,height:H}=T.imageManager.getPixelSize(),K=Math.pow(2,M.tileID.overscaledZ),Q=M.tileSize*Math.pow(2,T.transform.tileZoom)/K,re=Q*(M.tileID.canonical.x+M.tileID.wrap*K),oe=Q*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[q,H],u_mix:w.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/qt(M,1,T.transform.tileZoom),u_pixel_coord_upper:[re>>16,oe>>16],u_pixel_coord_lower:[65535&re,65535&oe]}})(l,p,s,u),{u_matrix:f,u_opacity:e}),bu={fillExtrusion:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_lightpos:new h.aN(f,e.u_lightpos),u_lightintensity:new h.aI(f,e.u_lightintensity),u_lightcolor:new h.aN(f,e.u_lightcolor),u_vertical_gradient:new h.aI(f,e.u_vertical_gradient),u_opacity:new h.aI(f,e.u_opacity)}),fillExtrusionPattern:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_lightpos:new h.aN(f,e.u_lightpos),u_lightintensity:new h.aI(f,e.u_lightintensity),u_lightcolor:new h.aN(f,e.u_lightcolor),u_vertical_gradient:new h.aI(f,e.u_vertical_gradient),u_height_factor:new h.aI(f,e.u_height_factor),u_image:new h.aH(f,e.u_image),u_texsize:new h.aO(f,e.u_texsize),u_pixel_coord_upper:new h.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(f,e.u_pixel_coord_lower),u_scale:new h.aN(f,e.u_scale),u_fade:new h.aI(f,e.u_fade),u_opacity:new h.aI(f,e.u_opacity)}),fill:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix)}),fillPattern:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_image:new h.aH(f,e.u_image),u_texsize:new h.aO(f,e.u_texsize),u_pixel_coord_upper:new h.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(f,e.u_pixel_coord_lower),u_scale:new h.aN(f,e.u_scale),u_fade:new h.aI(f,e.u_fade)}),fillOutline:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_world:new h.aO(f,e.u_world)}),fillOutlinePattern:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_world:new h.aO(f,e.u_world),u_image:new h.aH(f,e.u_image),u_texsize:new h.aO(f,e.u_texsize),u_pixel_coord_upper:new h.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(f,e.u_pixel_coord_lower),u_scale:new h.aN(f,e.u_scale),u_fade:new h.aI(f,e.u_fade)}),circle:(f,e)=>({u_camera_to_center_distance:new h.aI(f,e.u_camera_to_center_distance),u_scale_with_map:new h.aH(f,e.u_scale_with_map),u_pitch_with_map:new h.aH(f,e.u_pitch_with_map),u_extrude_scale:new h.aO(f,e.u_extrude_scale),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_matrix:new h.aJ(f,e.u_matrix)}),collisionBox:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_pixel_extrude_scale:new h.aO(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_inv_matrix:new h.aJ(f,e.u_inv_matrix),u_camera_to_center_distance:new h.aI(f,e.u_camera_to_center_distance),u_viewport_size:new h.aO(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new h.aL(f,e.u_color),u_matrix:new h.aJ(f,e.u_matrix),u_overlay:new h.aH(f,e.u_overlay),u_overlay_scale:new h.aI(f,e.u_overlay_scale)}),clippingMask:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix)}),heatmap:(f,e)=>({u_extrude_scale:new h.aI(f,e.u_extrude_scale),u_intensity:new h.aI(f,e.u_intensity),u_matrix:new h.aJ(f,e.u_matrix)}),heatmapTexture:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_world:new h.aO(f,e.u_world),u_image:new h.aH(f,e.u_image),u_color_ramp:new h.aH(f,e.u_color_ramp),u_opacity:new h.aI(f,e.u_opacity)}),hillshade:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_image:new h.aH(f,e.u_image),u_latrange:new h.aO(f,e.u_latrange),u_light:new h.aO(f,e.u_light),u_shadow:new h.aL(f,e.u_shadow),u_highlight:new h.aL(f,e.u_highlight),u_accent:new h.aL(f,e.u_accent)}),hillshadePrepare:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_image:new h.aH(f,e.u_image),u_dimension:new h.aO(f,e.u_dimension),u_zoom:new h.aI(f,e.u_zoom),u_unpack:new h.aK(f,e.u_unpack)}),line:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_ratio:new h.aI(f,e.u_ratio),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new h.aO(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_ratio:new h.aI(f,e.u_ratio),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new h.aO(f,e.u_units_to_pixels),u_image:new h.aH(f,e.u_image),u_image_height:new h.aI(f,e.u_image_height)}),linePattern:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_texsize:new h.aO(f,e.u_texsize),u_ratio:new h.aI(f,e.u_ratio),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_image:new h.aH(f,e.u_image),u_units_to_pixels:new h.aO(f,e.u_units_to_pixels),u_scale:new h.aN(f,e.u_scale),u_fade:new h.aI(f,e.u_fade)}),lineSDF:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_ratio:new h.aI(f,e.u_ratio),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new h.aO(f,e.u_units_to_pixels),u_patternscale_a:new h.aO(f,e.u_patternscale_a),u_patternscale_b:new h.aO(f,e.u_patternscale_b),u_sdfgamma:new h.aI(f,e.u_sdfgamma),u_image:new h.aH(f,e.u_image),u_tex_y_a:new h.aI(f,e.u_tex_y_a),u_tex_y_b:new h.aI(f,e.u_tex_y_b),u_mix:new h.aI(f,e.u_mix)}),raster:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_tl_parent:new h.aO(f,e.u_tl_parent),u_scale_parent:new h.aI(f,e.u_scale_parent),u_buffer_scale:new h.aI(f,e.u_buffer_scale),u_fade_t:new h.aI(f,e.u_fade_t),u_opacity:new h.aI(f,e.u_opacity),u_image0:new h.aH(f,e.u_image0),u_image1:new h.aH(f,e.u_image1),u_brightness_low:new h.aI(f,e.u_brightness_low),u_brightness_high:new h.aI(f,e.u_brightness_high),u_saturation_factor:new h.aI(f,e.u_saturation_factor),u_contrast_factor:new h.aI(f,e.u_contrast_factor),u_spin_weights:new h.aN(f,e.u_spin_weights)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new h.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aH(f,e.u_is_size_feature_constant),u_size_t:new h.aI(f,e.u_size_t),u_size:new h.aI(f,e.u_size),u_camera_to_center_distance:new h.aI(f,e.u_camera_to_center_distance),u_pitch:new h.aI(f,e.u_pitch),u_rotate_symbol:new h.aH(f,e.u_rotate_symbol),u_aspect_ratio:new h.aI(f,e.u_aspect_ratio),u_fade_change:new h.aI(f,e.u_fade_change),u_matrix:new h.aJ(f,e.u_matrix),u_label_plane_matrix:new h.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new h.aJ(f,e.u_coord_matrix),u_is_text:new h.aH(f,e.u_is_text),u_pitch_with_map:new h.aH(f,e.u_pitch_with_map),u_is_along_line:new h.aH(f,e.u_is_along_line),u_is_variable_anchor:new h.aH(f,e.u_is_variable_anchor),u_texsize:new h.aO(f,e.u_texsize),u_texture:new h.aH(f,e.u_texture),u_translation:new h.aO(f,e.u_translation),u_pitched_scale:new h.aI(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new h.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aH(f,e.u_is_size_feature_constant),u_size_t:new h.aI(f,e.u_size_t),u_size:new h.aI(f,e.u_size),u_camera_to_center_distance:new h.aI(f,e.u_camera_to_center_distance),u_pitch:new h.aI(f,e.u_pitch),u_rotate_symbol:new h.aH(f,e.u_rotate_symbol),u_aspect_ratio:new h.aI(f,e.u_aspect_ratio),u_fade_change:new h.aI(f,e.u_fade_change),u_matrix:new h.aJ(f,e.u_matrix),u_label_plane_matrix:new h.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new h.aJ(f,e.u_coord_matrix),u_is_text:new h.aH(f,e.u_is_text),u_pitch_with_map:new h.aH(f,e.u_pitch_with_map),u_is_along_line:new h.aH(f,e.u_is_along_line),u_is_variable_anchor:new h.aH(f,e.u_is_variable_anchor),u_texsize:new h.aO(f,e.u_texsize),u_texture:new h.aH(f,e.u_texture),u_gamma_scale:new h.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_is_halo:new h.aH(f,e.u_is_halo),u_translation:new h.aO(f,e.u_translation),u_pitched_scale:new h.aI(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new h.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aH(f,e.u_is_size_feature_constant),u_size_t:new h.aI(f,e.u_size_t),u_size:new h.aI(f,e.u_size),u_camera_to_center_distance:new h.aI(f,e.u_camera_to_center_distance),u_pitch:new h.aI(f,e.u_pitch),u_rotate_symbol:new h.aH(f,e.u_rotate_symbol),u_aspect_ratio:new h.aI(f,e.u_aspect_ratio),u_fade_change:new h.aI(f,e.u_fade_change),u_matrix:new h.aJ(f,e.u_matrix),u_label_plane_matrix:new h.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new h.aJ(f,e.u_coord_matrix),u_is_text:new h.aH(f,e.u_is_text),u_pitch_with_map:new h.aH(f,e.u_pitch_with_map),u_is_along_line:new h.aH(f,e.u_is_along_line),u_is_variable_anchor:new h.aH(f,e.u_is_variable_anchor),u_texsize:new h.aO(f,e.u_texsize),u_texsize_icon:new h.aO(f,e.u_texsize_icon),u_texture:new h.aH(f,e.u_texture),u_texture_icon:new h.aH(f,e.u_texture_icon),u_gamma_scale:new h.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_is_halo:new h.aH(f,e.u_is_halo),u_translation:new h.aO(f,e.u_translation),u_pitched_scale:new h.aI(f,e.u_pitched_scale)}),background:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_opacity:new h.aI(f,e.u_opacity),u_color:new h.aL(f,e.u_color)}),backgroundPattern:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_opacity:new h.aI(f,e.u_opacity),u_image:new h.aH(f,e.u_image),u_pattern_tl_a:new h.aO(f,e.u_pattern_tl_a),u_pattern_br_a:new h.aO(f,e.u_pattern_br_a),u_pattern_tl_b:new h.aO(f,e.u_pattern_tl_b),u_pattern_br_b:new h.aO(f,e.u_pattern_br_b),u_texsize:new h.aO(f,e.u_texsize),u_mix:new h.aI(f,e.u_mix),u_pattern_size_a:new h.aO(f,e.u_pattern_size_a),u_pattern_size_b:new h.aO(f,e.u_pattern_size_b),u_scale_a:new h.aI(f,e.u_scale_a),u_scale_b:new h.aI(f,e.u_scale_b),u_pixel_coord_upper:new h.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new h.aI(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_texture:new h.aH(f,e.u_texture),u_ele_delta:new h.aI(f,e.u_ele_delta),u_fog_matrix:new h.aJ(f,e.u_fog_matrix),u_fog_color:new h.aL(f,e.u_fog_color),u_fog_ground_blend:new h.aI(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new h.aI(f,e.u_fog_ground_blend_opacity),u_horizon_color:new h.aL(f,e.u_horizon_color),u_horizon_fog_blend:new h.aI(f,e.u_horizon_fog_blend)}),terrainDepth:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_ele_delta:new h.aI(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_texture:new h.aH(f,e.u_texture),u_terrain_coords_id:new h.aI(f,e.u_terrain_coords_id),u_ele_delta:new h.aI(f,e.u_ele_delta)}),sky:(f,e)=>({u_sky_color:new h.aL(f,e.u_sky_color),u_horizon_color:new h.aL(f,e.u_horizon_color),u_horizon:new h.aI(f,e.u_horizon),u_sky_horizon_blend:new h.aI(f,e.u_sky_horizon_blend)})};class En{constructor(e,s,l){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const zl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xa{constructor(e,s,l,u){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=u,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let l=0;l<this.attributes.length;l++){const u=s.attributes[this.attributes[l].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,s,l){for(let u=0;u<this.attributes.length;u++){const p=this.attributes[u],v=s.attributes[p.name];v!==void 0&&e.vertexAttribPointer(v,p.components,e[zl[p.type]],!1,this.itemSize,p.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ho=new WeakMap;function Bi(f){var e;if(ho.has(f))return ho.get(f);{const s=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return ho.set(f,s),s}}class mr{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class No extends mr{getDefault(){return h.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class bc extends mr{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Fs extends mr{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Dl extends mr{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Su extends mr{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class dn extends mr{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Vo extends mr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Ka extends mr{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ca extends mr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class Sc extends mr{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ll extends mr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class Rl extends mr{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Kn extends mr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class Ya extends mr{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class kc extends mr{getDefault(){return h.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Tc extends mr{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Ja extends mr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class Eh extends mr{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ha extends mr{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Ih extends mr{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Ph extends mr{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Ec extends mr{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ic extends mr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Pc extends mr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Fl extends mr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Cc extends mr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Bl extends mr{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Bs extends mr{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const l=this.gl;Bi(l)?l.bindVertexArray(e):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class ku extends mr{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Qa extends mr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Tu extends mr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ol extends mr{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class Eu extends Ol{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class po extends Ol{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Iu extends Ol{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ch{constructor(e,s,l,u,p){this.context=e,this.width=s,this.height=l;const v=e.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new Eu(e,w),u)this.depthAttachment=p?new Iu(e,w):new po(e,w);else if(p)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class Yr{constructor(e,s,l){this.blendFunction=e,this.blendColor=s,this.mask=l}}Yr.Replace=[1,0],Yr.disabled=new Yr(Yr.Replace,h.aM.transparent,[!1,!1,!1,!1]),Yr.unblended=new Yr(Yr.Replace,h.aM.transparent,[!0,!0,!0,!0]),Yr.alphaBlended=new Yr([1,771],h.aM.transparent,[!0,!0,!0,!0]);class Mh{constructor(e){var s,l;if(this.gl=e,this.clearColor=new No(this),this.clearDepth=new bc(this),this.clearStencil=new Fs(this),this.colorMask=new Dl(this),this.depthMask=new Su(this),this.stencilMask=new dn(this),this.stencilFunc=new Vo(this),this.stencilOp=new Ka(this),this.stencilTest=new ca(this),this.depthRange=new Sc(this),this.depthTest=new Ll(this),this.depthFunc=new Rl(this),this.blend=new Kn(this),this.blendFunc=new Ya(this),this.blendColor=new kc(this),this.blendEquation=new Tc(this),this.cullFace=new Ja(this),this.cullFaceSide=new Eh(this),this.frontFace=new ha(this),this.program=new Ih(this),this.activeTexture=new Ph(this),this.viewport=new Ec(this),this.bindFramebuffer=new Ic(this),this.bindRenderbuffer=new Pc(this),this.bindTexture=new Fl(this),this.bindVertexBuffer=new Cc(this),this.bindElementBuffer=new Bl(this),this.bindVertexArray=new Bs(this),this.pixelStoreUnpack=new ku(this),this.pixelStoreUnpackPremultiplyAlpha=new Qa(this),this.pixelStoreUnpackFlipY=new Tu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Bi(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:u?.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:u?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new En(this,e,s)}createVertexBuffer(e,s,l){return new Xa(this,e,s,l)}createRenderbuffer(e,s,l){const u=this.gl,p=u.createRenderbuffer();return this.bindRenderbuffer.set(p),u.renderbufferStorage(u.RENDERBUFFER,e,s,l),this.bindRenderbuffer.set(null),p}createFramebuffer(e,s,l,u){return new Ch(this,e,s,l,u)}clear({color:e,depth:s,stencil:l}){const u=this.gl;let p=0;e&&(p|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(p|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){h.aE(e.blendFunction,Yr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Bi(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return Bi(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Qt{constructor(e,s,l){this.func=e,this.mask=s,this.range=l}}Qt.ReadOnly=!1,Qt.ReadWrite=!0,Qt.disabled=new Qt(519,Qt.ReadOnly,[0,1]);const Nl=7680;class Ar{constructor(e,s,l,u,p,v){this.test=e,this.ref=s,this.mask=l,this.fail=u,this.depthFail=p,this.pass=v}}Ar.disabled=new Ar({func:519,mask:0},0,0,Nl,Nl,Nl);class wr{constructor(e,s,l){this.enable=e,this.mode=s,this.frontFace=l}}let Yn;function el(f,e,s,l,u){const p=f.context,v=p.gl,w=f.useProgram("collisionBox"),T=[];let M=0,L=0;for(let oe=0;oe<l.length;oe++){const ce=l[oe],ee=e.getTile(ce).getBucket(s);if(!ee)continue;const ge=u?ee.textCollisionBox:ee.iconCollisionBox,ve=ee.collisionCircleArray;if(ve.length>0){const ke=h.H();h.aQ(ke,ee.placementInvProjMatrix,f.transform.glCoordMatrix),h.aQ(ke,ke,ee.placementViewportMatrix),T.push({circleArray:ve,circleOffset:L,transform:ce.posMatrix,invTransform:ke,coord:ce}),M+=ve.length/4,L=M}ge&&w.draw(p,v.LINES,Qt.disabled,Ar.disabled,f.colorModeForRenderPass(),wr.disabled,{u_matrix:ce.posMatrix,u_pixel_extrude_scale:[1/(R=f.transform).width,1/R.height]},f.style.map.terrain&&f.style.map.terrain.getTerrainData(ce),s.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,f.transform.zoom,null,null,ge.collisionVertexBuffer)}var R;if(!u||!T.length)return;const q=f.useProgram("collisionCircle"),H=new h.aR;H.resize(4*M),H._trim();let K=0;for(const oe of T)for(let ce=0;ce<oe.circleArray.length/4;ce++){const ee=4*ce,ge=oe.circleArray[ee+0],ve=oe.circleArray[ee+1],ke=oe.circleArray[ee+2],Fe=oe.circleArray[ee+3];H.emplace(K++,ge,ve,ke,Fe,0),H.emplace(K++,ge,ve,ke,Fe,1),H.emplace(K++,ge,ve,ke,Fe,2),H.emplace(K++,ge,ve,ke,Fe,3)}(!Yn||Yn.length<2*M)&&(Yn=(function(oe){const ce=2*oe,ee=new h.aT;ee.resize(ce),ee._trim();for(let ge=0;ge<ce;ge++){const ve=6*ge;ee.uint16[ve+0]=4*ge+0,ee.uint16[ve+1]=4*ge+1,ee.uint16[ve+2]=4*ge+2,ee.uint16[ve+3]=4*ge+2,ee.uint16[ve+4]=4*ge+3,ee.uint16[ve+5]=4*ge+0}return ee})(M));const Q=p.createIndexBuffer(Yn,!0),re=p.createVertexBuffer(H,h.aS.members,!0);for(const oe of T){const ce=Hi(oe.transform,oe.invTransform,f.transform);q.draw(p,v.TRIANGLES,Qt.disabled,Ar.disabled,f.colorModeForRenderPass(),wr.disabled,ce,f.style.map.terrain&&f.style.map.terrain.getTerrainData(oe.coord),s.id,re,Q,h.a0.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,f.transform.zoom,null,null,null)}re.destroy(),Q.destroy()}wr.disabled=new wr(!1,1029,2305),wr.backCCW=new wr(!0,1029,2305);const da=h.an(new Float32Array(16));function Vl(f,e,s,l,u,p){const{horizontalAlign:v,verticalAlign:w}=h.au(f);return new h.P((-(v-.5)*e/u+l[0])*p,(-(w-.5)*s/u+l[1])*p)}function fo(f,e,s,l,u,p){const v=e.tileAnchorPoint.add(new h.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=l.mult(p);s||(w=w.rotate(-u));const T=v.add(w);return ne(T.x,T.y,e.labelPlaneMatrix,e.getElevation).point}if(s){const w=Me(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),T=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return f.add(l.rotate(T))}return f.add(l)}function jo(f,e,s,l,u,p,v,w,T,M,L,R,q,H){const K=f.text.placedSymbolArray,Q=f.text.dynamicLayoutVertexArray,re=f.icon.dynamicLayoutVertexArray,oe={};Q.clear();for(let ce=0;ce<K.length;ce++){const ee=K.get(ce),ge=ee.hidden||!ee.crossTileID||f.allowVerticalPlacement&&!ee.placedOrientation?null:l[ee.crossTileID];if(ge){const ve=new h.P(ee.anchorX,ee.anchorY),ke={getElevation:H,width:u.width,height:u.height,labelPlaneMatrix:p,pitchWithMap:s,projection:L,tileAnchorPoint:ve,translation:R,unwrappedTileID:q},Fe=s?ne(ve.x,ve.y,v,H):Me(ve.x,ve.y,ke),Ue=j(u.cameraToCenterDistance,Fe.signedDistanceFromCamera);let We=h.ai(f.textSizeData,T,ee)*Ue/h.ap;s&&(We*=f.tilePixelRatio/w);const{width:it,height:Xe,anchor:Ze,textOffset:dt,textBoxScale:Rt}=ge,Ye=Vl(Ze,it,Xe,dt,Rt,We),Qe=L.getPitchedTextCorrection(u,ve.add(new h.P(R[0],R[1])),q),Lt=fo(Fe.point,ke,e,Ye,u.angle,Qe),Tr=f.allowVerticalPlacement&&ee.placedOrientation===h.ah.vertical?Math.PI/2:0;for(let Ut=0;Ut<ee.numGlyphs;Ut++)h.aj(Q,Lt,Tr);M&&ee.associatedIconIndex>=0&&(oe[ee.associatedIconIndex]={shiftedAnchor:Lt,angle:Tr})}else kt(ee.numGlyphs,Q)}if(M){re.clear();const ce=f.icon.placedSymbolArray;for(let ee=0;ee<ce.length;ee++){const ge=ce.get(ee);if(ge.hidden)kt(ge.numGlyphs,re);else{const ve=oe[ee];if(ve)for(let ke=0;ke<ge.numGlyphs;ke++)h.aj(re,ve.shiftedAnchor,ve.angle);else kt(ge.numGlyphs,re)}}f.icon.dynamicLayoutVertexBuffer.updateData(re)}f.text.dynamicLayoutVertexBuffer.updateData(Q)}function pn(f,e,s){return s.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function mo(f,e,s,l,u,p,v,w,T,M,L,R){const q=f.context,H=q.gl,K=f.transform,Q=Do(),re=w==="map",oe=T==="map",ce=w!=="viewport"&&s.layout.get("symbol-placement")!=="point",ee=re&&!oe&&!ce,ge=!oe&&ce,ve=!s.layout.get("symbol-sort-key").isConstant();let ke=!1;const Fe=f.depthModeForSublayer(0,Qt.ReadOnly),Ue=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),We=[],it=Q.getCircleRadiusCorrection(K);for(const Xe of l){const Ze=e.getTile(Xe),dt=Ze.getBucket(s);if(!dt)continue;const Rt=u?dt.text:dt.icon;if(!Rt||!Rt.segments.get().length||!Rt.hasVisibleVertices)continue;const Ye=Rt.programConfigurations.get(s.id),Qe=u||dt.sdfIcons,Lt=u?dt.textSizeData:dt.iconSizeData,Tr=oe||K.pitch!==0,Ut=f.useProgram(pn(Qe,u,dt),Ye),Xt=h.ag(Lt,K.zoom),Ir=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Xe);let _i,mn,Pr,hi,Br=[0,0],Jr=null;if(u)mn=Ze.glyphAtlasTexture,Pr=H.LINEAR,_i=Ze.glyphAtlasTexture.size,dt.iconsInText&&(Br=Ze.imageAtlasTexture.size,Jr=Ze.imageAtlasTexture,hi=Tr||f.options.rotating||f.options.zooming||Lt.kind==="composite"||Lt.kind==="camera"?H.LINEAR:H.NEAREST);else{const Yt=s.layout.get("icon-size").constantOr(0)!==1||dt.iconsNeedLinear;mn=Ze.imageAtlasTexture,Pr=Qe||f.options.rotating||f.options.zooming||Yt||Tr?H.LINEAR:H.NEAREST,_i=Ze.imageAtlasTexture.size}const Si=qt(Ze,1,f.transform.zoom),rs=ge?Xe.posMatrix:da,Yi=cn(rs,oe,re,f.transform,Si),is=Li(rs,oe,re,f.transform,Si),bo=Li(Xe.posMatrix,oe,re,f.transform,Si),gn=Q.translatePosition(f.transform,Ze,p,v),An=Ue&&dt.hasTextData(),Es=s.layout.get("icon-text-fit")!=="none"&&An&&dt.hasIconData();if(ce){const Yt=f.style.map.terrain?(So,ss)=>f.style.map.terrain.getElevation(Xe,So,ss):null,_n=s.layout.get("text-rotation-alignment")==="map";W(dt,Xe.posMatrix,f,u,Yi,bo,oe,M,_n,Q,Xe.toUnwrapped(),K.width,K.height,gn,Yt)}const Ni=Xe.posMatrix,yn=u&&Ue||Es,ns=ce||yn?da:Yi,zn=is,ii=Qe&&s.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Nr;Nr=Qe?dt.iconsInText?co(Lt.kind,Xt,ee,oe,ce,yn,f,Ni,ns,zn,gn,_i,Br,it):Rs(Lt.kind,Xt,ee,oe,ce,yn,f,Ni,ns,zn,gn,u,_i,!0,it):ua(Lt.kind,Xt,ee,oe,ce,yn,f,Ni,ns,zn,gn,u,_i,it);const ki={program:Ut,buffers:Rt,uniformValues:Nr,atlasTexture:mn,atlasTextureIcon:Jr,atlasInterpolation:Pr,atlasInterpolationIcon:hi,isSDF:Qe,hasHalo:ii};if(ve&&dt.canOverlap){ke=!0;const Yt=Rt.segments.get();for(const _n of Yt)We.push({segments:new h.a0([_n]),sortKey:_n.sortKey,state:ki,terrainData:Ir})}else We.push({segments:Rt.segments,sortKey:0,state:ki,terrainData:Ir})}ke&&We.sort(((Xe,Ze)=>Xe.sortKey-Ze.sortKey));for(const Xe of We){const Ze=Xe.state;if(q.activeTexture.set(H.TEXTURE0),Ze.atlasTexture.bind(Ze.atlasInterpolation,H.CLAMP_TO_EDGE),Ze.atlasTextureIcon&&(q.activeTexture.set(H.TEXTURE1),Ze.atlasTextureIcon&&Ze.atlasTextureIcon.bind(Ze.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),Ze.isSDF){const dt=Ze.uniformValues;Ze.hasHalo&&(dt.u_is_halo=1,Pu(Ze.buffers,Xe.segments,s,f,Ze.program,Fe,L,R,dt,Xe.terrainData)),dt.u_is_halo=0}Pu(Ze.buffers,Xe.segments,s,f,Ze.program,Fe,L,R,Ze.uniformValues,Xe.terrainData)}}function Pu(f,e,s,l,u,p,v,w,T,M){const L=l.context;u.draw(L,L.gl.TRIANGLES,p,v,w,wr.disabled,T,M,s.id,f.layoutVertexBuffer,f.indexBuffer,e,s.paint,l.transform.zoom,f.programConfigurations.get(s.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Cu(f,e,s,l){const u=f.context,p=u.gl,v=Ar.disabled,w=new Yr([p.ONE,p.ONE],h.aM.transparent,[!0,!0,!0,!0]),T=e.getBucket(s);if(!T)return;const M=l.key;let L=s.heatmapFbos.get(M);L||(L=pa(u,e.tileSize,e.tileSize),s.heatmapFbos.set(M,L)),u.bindFramebuffer.set(L.framebuffer),u.viewport.set([0,0,e.tileSize,e.tileSize]),u.clear({color:h.aM.transparent});const R=T.programConfigurations.get(s.id),q=f.useProgram("heatmap",R),H=f.style.map.terrain.getTerrainData(l);q.draw(u,p.TRIANGLES,Qt.disabled,v,w,wr.disabled,yi(l.posMatrix,e,f.transform.zoom,s.paint.get("heatmap-intensity")),H,s.id,T.layoutVertexBuffer,T.indexBuffer,T.segments,s.paint,f.transform.zoom,R)}function Uo(f,e,s){const l=f.context,u=l.gl;l.setColorMode(f.colorModeForRenderPass());const p=fa(l,e),v=s.key,w=e.heatmapFbos.get(v);w&&(l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,w.colorAttachment.get()),l.activeTexture.set(u.TEXTURE1),p.bind(u.LINEAR,u.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(l,u.TRIANGLES,Qt.disabled,Ar.disabled,f.colorModeForRenderPass(),wr.disabled,uo(f,e,0,1),null,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,f.transform.zoom),w.destroy(),e.heatmapFbos.delete(v))}function pa(f,e,s){var l,u;const p=f.gl,v=p.createTexture();p.bindTexture(p.TEXTURE_2D,v),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const w=(l=f.HALF_FLOAT)!==null&&l!==void 0?l:p.UNSIGNED_BYTE,T=(u=f.RGBA16F)!==null&&u!==void 0?u:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,T,e,s,0,p.RGBA,w,null);const M=f.createFramebuffer(e,s,!1,!1);return M.colorAttachment.set(v),M}function fa(f,e){return e.colorRampTexture||(e.colorRampTexture=new It(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function ws(f,e,s,l,u){if(!s||!l||!l.imageAtlas)return;const p=l.imageAtlas.patternPositions;let v=p[s.to.toString()],w=p[s.from.toString()];if(!v&&w&&(v=w),!w&&v&&(w=v),!v||!w){const T=u.getPaintProperty(e);v=p[T],w=p[T]}v&&w&&f.setConstantPatternPositions(v,w)}function Os(f,e,s,l,u,p,v){const w=f.context.gl,T="fill-pattern",M=s.paint.get(T),L=M&&M.constantOr(1),R=s.getCrossfadeParameters();let q,H,K,Q,re;v?(H=L&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=w.LINES):(H=L?"fillPattern":"fill",q=w.TRIANGLES);const oe=M.constantOr(null);for(const ce of l){const ee=e.getTile(ce);if(L&&!ee.patternsLoaded())continue;const ge=ee.getBucket(s);if(!ge)continue;const ve=ge.programConfigurations.get(s.id),ke=f.useProgram(H,ve),Fe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ce);L&&(f.context.activeTexture.set(w.TEXTURE0),ee.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),ve.updatePaintBuffers(R)),ws(ve,T,oe,ee,s);const Ue=Fe?ce:null,We=f.translatePosMatrix(Ue?Ue.posMatrix:ce.posMatrix,ee,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){Q=ge.indexBuffer2,re=ge.segments2;const it=[w.drawingBufferWidth,w.drawingBufferHeight];K=H==="fillOutlinePattern"&&L?Cl(We,f,R,ee,it):xc(We,it)}else Q=ge.indexBuffer,re=ge.segments,K=L?_u(We,f,R,ee):Bo(We);ke.draw(f.context,q,u,f.stencilModeForClipping(ce),p,wr.disabled,K,Fe,s.id,ge.layoutVertexBuffer,Q,re,s.paint,f.transform.zoom,ve)}}function jl(f,e,s,l,u,p,v){const w=f.context,T=w.gl,M="fill-extrusion-pattern",L=s.paint.get(M),R=L.constantOr(1),q=s.getCrossfadeParameters(),H=s.paint.get("fill-extrusion-opacity"),K=L.constantOr(null);for(const Q of l){const re=e.getTile(Q),oe=re.getBucket(s);if(!oe)continue;const ce=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Q),ee=oe.programConfigurations.get(s.id),ge=f.useProgram(R?"fillExtrusionPattern":"fillExtrusion",ee);R&&(f.context.activeTexture.set(T.TEXTURE0),re.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),ee.updatePaintBuffers(q)),ws(ee,M,K,re,s);const ve=f.translatePosMatrix(Q.posMatrix,re,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),ke=s.paint.get("fill-extrusion-vertical-gradient"),Fe=R?la(ve,f,ke,H,Q,q,re):aa(ve,f,ke,H);ge.draw(w,w.gl.TRIANGLES,u,p,v,wr.backCCW,Fe,ce,s.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,s.paint,f.transform.zoom,ee,f.style.map.terrain&&oe.centroidVertexBuffer)}}function Ns(f,e,s,l,u,p,v){const w=f.context,T=w.gl,M=s.fbo;if(!M)return;const L=f.useProgram("hillshade"),R=f.style.map.terrain&&f.style.map.terrain.getTerrainData(e);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,M.colorAttachment.get()),L.draw(w,T.TRIANGLES,u,p,v,wr.disabled,((q,H,K,Q)=>{const re=K.paint.get("hillshade-shadow-color"),oe=K.paint.get("hillshade-highlight-color"),ce=K.paint.get("hillshade-accent-color");let ee=K.paint.get("hillshade-illumination-direction")*(Math.PI/180);K.paint.get("hillshade-illumination-anchor")==="viewport"&&(ee-=q.transform.angle);const ge=!q.options.moving;return{u_matrix:Q?Q.posMatrix:q.transform.calculatePosMatrix(H.tileID.toUnwrapped(),ge),u_image:0,u_latrange:Xn(0,H.tileID),u_light:[K.paint.get("hillshade-exaggeration"),ee],u_shadow:re,u_highlight:oe,u_accent:ce}})(f,s,l,R?e:null),R,l.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function ma(f,e,s,l,u,p){const v=f.context,w=v.gl,T=e.dem;if(T&&T.data){const M=T.dim,L=T.stride,R=T.getPixels();if(v.activeTexture.set(w.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||f.getTileTexture(L),e.demTexture){const H=e.demTexture;H.update(R,{premultiply:!1}),H.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else e.demTexture=new It(v,R,w.RGBA,{premultiply:!1}),e.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);v.activeTexture.set(w.TEXTURE0);let q=e.fbo;if(!q){const H=new It(v,{width:M,height:M,data:null},w.RGBA);H.bind(w.LINEAR,w.CLAMP_TO_EDGE),q=e.fbo=v.createFramebuffer(M,M,!0,!1),q.colorAttachment.set(H.texture)}v.bindFramebuffer.set(q.framebuffer),v.viewport.set([0,0,M,M]),f.useProgram("hillshadePrepare").draw(v,w.TRIANGLES,l,u,p,wr.disabled,((H,K)=>{const Q=K.stride,re=h.H();return h.aP(re,0,h.X,-h.X,0,0,1),h.J(re,re,[0,-h.X,0]),{u_matrix:re,u_image:1,u_dimension:[Q,Q],u_zoom:H.overscaledZ,u_unpack:K.getUnpackVector()}})(e.tileID,T),null,s.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Mu(f,e,s,l,u,p){const v=l.paint.get("raster-fade-duration");if(!p&&v>0){const w=N.now(),T=(w-f.timeAdded)/v,M=e?(w-e.timeAdded)/v:-1,L=s.getSource(),R=u.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),q=!e||Math.abs(e.tileID.overscaledZ-R)>Math.abs(f.tileID.overscaledZ-R),H=q&&f.refreshedUponExpiration?1:h.ac(q?T:1-M,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}const tl=new h.aM(1,0,0,1),lr=new h.aM(0,1,0,1),rl=new h.aM(0,0,1,1),Mc=new h.aM(1,0,1,1),Au=new h.aM(0,1,1,1);function ga(f,e,s,l){Ul(f,0,e+s/2,f.transform.width,s,l)}function Ac(f,e,s,l){Ul(f,e-s/2,0,s,f.transform.height,l)}function Ul(f,e,s,l,u,p){const v=f.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*f.pixelRatio,s*f.pixelRatio,l*f.pixelRatio,u*f.pixelRatio),v.clear({color:p}),w.disable(w.SCISSOR_TEST)}function zc(f,e,s){const l=f.context,u=l.gl,p=s.posMatrix,v=f.useProgram("debug"),w=Qt.disabled,T=Ar.disabled,M=f.colorModeForRenderPass(),L="$debug",R=f.style.map.terrain&&f.style.map.terrain.getTerrainData(s);l.activeTexture.set(u.TEXTURE0);const q=e.getTileByID(s.key).latestRawTileData,H=Math.floor((q&&q.byteLength||0)/1024),K=e.getTile(s).tileSize,Q=512/Math.min(K,512)*(s.overscaledZ/f.transform.zoom)*.5;let re=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(re+=` => ${s.overscaledZ}`),(function(oe,ce){oe.initDebugOverlayCanvas();const ee=oe.debugOverlayCanvas,ge=oe.context.gl,ve=oe.debugOverlayCanvas.getContext("2d");ve.clearRect(0,0,ee.width,ee.height),ve.shadowColor="white",ve.shadowBlur=2,ve.lineWidth=1.5,ve.strokeStyle="white",ve.textBaseline="top",ve.font="bold 36px Open Sans, sans-serif",ve.fillText(ce,5,5),ve.strokeText(ce,5,5),oe.debugOverlayTexture.update(ee),oe.debugOverlayTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)})(f,`${re} ${H}kB`),v.draw(l,u.TRIANGLES,w,T,Yr.alphaBlended,wr.disabled,Tn(p,h.aM.transparent,Q),null,L,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),v.draw(l,u.LINE_STRIP,w,T,M,wr.disabled,Tn(p,h.aM.red),R,L,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function Dc(f,e,s){const l=f.context,u=l.gl,p=f.colorModeForRenderPass(),v=new Qt(u.LEQUAL,Qt.ReadWrite,f.depthRangeFor3D),w=f.useProgram("terrain"),T=e.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,f.width,f.height]);for(const M of s){const L=f.renderToTexture.getTexture(M),R=e.getTerrainData(M.tileID);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,L.texture);const q=f.transform.calculatePosMatrix(M.tileID.toUnwrapped()),H=e.getMeshFrameDelta(f.transform.zoom),K=f.transform.calculateFogMatrix(M.tileID.toUnwrapped()),Q=yu(q,H,K,f.style.sky,f.transform.pitch);w.draw(l,u.TRIANGLES,v,Ar.disabled,p,wr.backCCW,Q,R,"terrain",T.vertexBuffer,T.indexBuffer,T.segments)}}class Wi{constructor(e,s,l){this.vertexBuffer=e,this.indexBuffer=s,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class go{constructor(e,s){this.context=new Mh(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Dt.maxUnderzooming+Dt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ro}resize(e,s,l){if(this.width=Math.floor(e*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,s=new h.aX;s.emplaceBack(0,0),s.emplaceBack(h.X,0),s.emplaceBack(0,h.X),s.emplaceBack(h.X,h.X),this.tileExtentBuffer=e.createVertexBuffer(s,Ds.members),this.tileExtentSegments=h.a0.simpleSegment(0,0,4,2);const l=new h.aX;l.emplaceBack(0,0),l.emplaceBack(h.X,0),l.emplaceBack(0,h.X),l.emplaceBack(h.X,h.X),this.debugBuffer=e.createVertexBuffer(l,Ds.members),this.debugSegments=h.a0.simpleSegment(0,0,4,5);const u=new h.$;u.emplaceBack(0,0,0,0),u.emplaceBack(h.X,0,h.X,0),u.emplaceBack(0,h.X,0,h.X),u.emplaceBack(h.X,h.X,h.X,h.X),this.rasterBoundsBuffer=e.createVertexBuffer(u,_s.members),this.rasterBoundsSegments=h.a0.simpleSegment(0,0,4,2);const p=new h.aX;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(p,Ds.members),this.viewportSegments=h.a0.simpleSegment(0,0,4,2);const v=new h.aZ;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(v);const w=new h.aY;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(w);const T=this.context.gl;this.stencilClearMode=new Ar({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=h.H();h.aP(l,0,this.width,this.height,0,0,1),h.K(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,Qt.disabled,this.stencilClearMode,Yr.disabled,wr.disabled,ri(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const l=this.context,u=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(Yr.disabled),l.setDepthMode(Qt.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of s){const w=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,T=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);p.draw(l,u.TRIANGLES,Qt.disabled,new Ar({func:u.ALWAYS,mask:0},w,255,u.KEEP,u.KEEP,u.REPLACE),Yr.disabled,wr.disabled,ri(v.posMatrix),T,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new Ar({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new Ar({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,l=e.sort(((v,w)=>w.overscaledZ-v.overscaledZ)),u=l[l.length-1].overscaledZ,p=l[0].overscaledZ-u+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const v={};for(let w=0;w<p;w++)v[w+u]=new Ar({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=p,[v,l]}return[{[u]:Ar.disabled},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Yr([e.CONSTANT_COLOR,e.ONE],new h.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Yr.unblended:Yr.alphaBlended}depthModeForSublayer(e,s,l){if(!this.opaquePassEnabledForLayer())return Qt.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Qt(l||this.context.gl.LEQUAL,s,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(N.now()),this.imageManager.beginFrame();const l=this.style._order,u=this.style.sourceCaches,p={},v={},w={};for(const T in u){const M=u[T];M.used&&M.prepare(this.context),p[T]=M.getVisibleCoordinates(),v[T]=p[T].slice().reverse(),w[T]=M.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<l.length;T++)if(this.style._layers[l[T]].is3D()){this.opaquePassCutoff=T;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const T of l){const M=this.style._layers[T];if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const L=v[M.source];(M.type==="custom"||L.length)&&this.renderLayer(this,u[M.source],M,L)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?h.aM.black:h.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(T,M){const L=T.context,R=L.gl,q=((oe,ce,ee)=>({u_sky_color:oe.properties.get("sky-color"),u_horizon_color:oe.properties.get("horizon-color"),u_horizon:(ce.height/2+ce.getHorizon())*ee,u_sky_horizon_blend:oe.properties.get("sky-horizon-blend")*ce.height/2*ee}))(M,T.style.map.transform,T.pixelRatio),H=new Qt(R.LEQUAL,Qt.ReadWrite,[0,1]),K=Ar.disabled,Q=T.colorModeForRenderPass(),re=T.useProgram("sky");if(!M.mesh){const oe=new h.aX;oe.emplaceBack(-1,-1),oe.emplaceBack(1,-1),oe.emplaceBack(1,1),oe.emplaceBack(-1,1);const ce=new h.aY;ce.emplaceBack(0,1,2),ce.emplaceBack(0,2,3),M.mesh=new Wi(L.createVertexBuffer(oe,Ds.members),L.createIndexBuffer(ce),h.a0.simpleSegment(0,0,oe.length,ce.length))}re.draw(L,R.TRIANGLES,H,K,Q,wr.disabled,q,void 0,"sky",M.mesh.vertexBuffer,M.mesh.indexBuffer,M.mesh.segments)})(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[l[this.currentLayer]],M=u[T.source],L=p[T.source];this._renderTileClippingMasks(T,L),this.renderLayer(this,M,T,L)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const T=this.style._layers[l[this.currentLayer]],M=u[T.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(T))continue;const L=(T.type==="symbol"?w:v)[T.source];this._renderTileClippingMasks(T,p[T.source]),this.renderLayer(this,M,T,L)}if(this.options.showTileBoundaries){const T=(function(M,L){let R=null;const q=Object.values(M._layers).flatMap((re=>re.source&&!re.isHidden(L)?[M.sourceCaches[re.source]]:[])),H=q.filter((re=>re.getSource().type==="vector")),K=q.filter((re=>re.getSource().type!=="vector")),Q=re=>{(!R||R.getSource().maxzoom<re.getSource().maxzoom)&&(R=re)};return H.forEach((re=>Q(re))),R||K.forEach((re=>Q(re))),R})(this.style,this.transform.zoom);T&&(function(M,L,R){for(let q=0;q<R.length;q++)zc(M,L,R[q])})(this,T,T.getVisibleCoordinates())}this.options.showPadding&&(function(T){const M=T.transform.padding;ga(T,T.transform.height-(M.top||0),3,tl),ga(T,M.bottom||0,3,lr),Ac(T,M.left||0,3,rl),Ac(T,T.transform.width-(M.right||0),3,Mc);const L=T.transform.centerPoint;(function(R,q,H,K){Ul(R,q-1,H-10,2,20,K),Ul(R,q-10,H-1,20,2,K)})(T,L.x,T.transform.height-L.y,Au)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let u=this.terrainFacilitator.dirty;u||(u=e?!h.a_(s,l):!h.a$(s,l)),u||(u=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),u&&(h.b0(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(p,v){const w=p.context,T=w.gl,M=Yr.unblended,L=new Qt(T.LEQUAL,Qt.ReadWrite,[0,1]),R=v.getTerrainMesh(),q=v.sourceCache.getRenderableTiles(),H=p.useProgram("terrainDepth");w.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:h.aM.transparent,depth:1});for(const K of q){const Q=v.getTerrainData(K.tileID),re={u_matrix:p.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_ele_delta:v.getMeshFrameDelta(p.transform.zoom)};H.draw(w,T.TRIANGLES,L,Ar.disabled,M,wr.backCCW,re,Q,"terrain",R.vertexBuffer,R.indexBuffer,R.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])})(this,this.style.map.terrain),(function(p,v){const w=p.context,T=w.gl,M=Yr.unblended,L=new Qt(T.LEQUAL,Qt.ReadWrite,[0,1]),R=v.getTerrainMesh(),q=v.getCoordsTexture(),H=v.sourceCache.getRenderableTiles(),K=p.useProgram("terrainCoords");w.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:h.aM.transparent,depth:1}),v.coordsIndex=[];for(const Q of H){const re=v.getTerrainData(Q.tileID);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,q.texture);const oe={u_matrix:p.transform.calculatePosMatrix(Q.tileID.toUnwrapped()),u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(p.transform.zoom)};K.draw(w,T.TRIANGLES,L,Ar.disabled,M,wr.backCCW,oe,re,"terrain",R.vertexBuffer,R.indexBuffer,R.segments),v.coordsIndex.push(Q.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])})(this,this.style.map.terrain))}renderLayer(e,s,l,u){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(u||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(p,v,w,T,M){if(p.renderPass!=="translucent")return;const L=Ar.disabled,R=p.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(q,H,K,Q,re,oe,ce,ee,ge){const ve=H.transform,ke=Do(),Fe=re==="map",Ue=oe==="map";for(const We of q){const it=Q.getTile(We),Xe=it.getBucket(K);if(!Xe||!Xe.text||!Xe.text.segments.get().length)continue;const Ze=h.ag(Xe.textSizeData,ve.zoom),dt=qt(it,1,H.transform.zoom),Rt=cn(We.posMatrix,Ue,Fe,H.transform,dt),Ye=K.layout.get("icon-text-fit")!=="none"&&Xe.hasIconData();if(Ze){const Qe=Math.pow(2,ve.zoom-it.tileID.overscaledZ),Lt=H.style.map.terrain?(Ut,Xt)=>H.style.map.terrain.getElevation(We,Ut,Xt):null,Tr=ke.translatePosition(ve,it,ce,ee);jo(Xe,Fe,Ue,ge,ve,Rt,We.posMatrix,Qe,Ze,Ye,ke,Tr,We.toUnwrapped(),Lt)}}})(T,p,w,v,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),M),w.paint.get("icon-opacity").constantOr(1)!==0&&mo(p,v,w,T,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),L,R),w.paint.get("text-opacity").constantOr(1)!==0&&mo(p,v,w,T,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),L,R),v.map.showCollisionBoxes&&(el(p,v,w,T,!0),el(p,v,w,T,!1))})(e,s,l,u,this.style.placement.variableOffsets);break;case"circle":(function(p,v,w,T){if(p.renderPass!=="translucent")return;const M=w.paint.get("circle-opacity"),L=w.paint.get("circle-stroke-width"),R=w.paint.get("circle-stroke-opacity"),q=!w.layout.get("circle-sort-key").isConstant();if(M.constantOr(1)===0&&(L.constantOr(1)===0||R.constantOr(1)===0))return;const H=p.context,K=H.gl,Q=p.depthModeForSublayer(0,Qt.ReadOnly),re=Ar.disabled,oe=p.colorModeForRenderPass(),ce=[];for(let ee=0;ee<T.length;ee++){const ge=T[ee],ve=v.getTile(ge),ke=ve.getBucket(w);if(!ke)continue;const Fe=ke.programConfigurations.get(w.id),Ue=p.useProgram("circle",Fe),We=ke.layoutVertexBuffer,it=ke.indexBuffer,Xe=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ge),Ze={programConfiguration:Fe,program:Ue,layoutVertexBuffer:We,indexBuffer:it,uniformValues:Ml(p,ge,ve,w),terrainData:Xe};if(q){const dt=ke.segments.get();for(const Rt of dt)ce.push({segments:new h.a0([Rt]),sortKey:Rt.sortKey,state:Ze})}else ce.push({segments:ke.segments,sortKey:0,state:Ze})}q&&ce.sort(((ee,ge)=>ee.sortKey-ge.sortKey));for(const ee of ce){const{programConfiguration:ge,program:ve,layoutVertexBuffer:ke,indexBuffer:Fe,uniformValues:Ue,terrainData:We}=ee.state;ve.draw(H,K.TRIANGLES,Q,re,oe,wr.disabled,Ue,We,w.id,ke,Fe,ee.segments,w.paint,p.transform.zoom,ge)}})(e,s,l,u);break;case"heatmap":(function(p,v,w,T){if(w.paint.get("heatmap-opacity")===0)return;const M=p.context;if(p.style.map.terrain){for(const L of T){const R=v.getTile(L);v.hasRenderableParent(L)||(p.renderPass==="offscreen"?Cu(p,R,w,L):p.renderPass==="translucent"&&Uo(p,w,L))}M.viewport.set([0,0,p.width,p.height])}else p.renderPass==="offscreen"?(function(L,R,q,H){const K=L.context,Q=K.gl,re=Ar.disabled,oe=new Yr([Q.ONE,Q.ONE],h.aM.transparent,[!0,!0,!0,!0]);(function(ce,ee,ge){const ve=ce.gl;ce.activeTexture.set(ve.TEXTURE1),ce.viewport.set([0,0,ee.width/4,ee.height/4]);let ke=ge.heatmapFbos.get(h.aU);ke?(ve.bindTexture(ve.TEXTURE_2D,ke.colorAttachment.get()),ce.bindFramebuffer.set(ke.framebuffer)):(ke=pa(ce,ee.width/4,ee.height/4),ge.heatmapFbos.set(h.aU,ke))})(K,L,q),K.clear({color:h.aM.transparent});for(let ce=0;ce<H.length;ce++){const ee=H[ce];if(R.hasRenderableParent(ee))continue;const ge=R.getTile(ee),ve=ge.getBucket(q);if(!ve)continue;const ke=ve.programConfigurations.get(q.id),Fe=L.useProgram("heatmap",ke),{zoom:Ue}=L.transform;Fe.draw(K,Q.TRIANGLES,Qt.disabled,re,oe,wr.disabled,yi(ee.posMatrix,ge,Ue,q.paint.get("heatmap-intensity")),null,q.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,q.paint,L.transform.zoom,ke)}K.viewport.set([0,0,L.width,L.height])})(p,v,w,T):p.renderPass==="translucent"&&(function(L,R){const q=L.context,H=q.gl;q.setColorMode(L.colorModeForRenderPass());const K=R.heatmapFbos.get(h.aU);K&&(q.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,K.colorAttachment.get()),q.activeTexture.set(H.TEXTURE1),fa(q,R).bind(H.LINEAR,H.CLAMP_TO_EDGE),L.useProgram("heatmapTexture").draw(q,H.TRIANGLES,Qt.disabled,Ar.disabled,L.colorModeForRenderPass(),wr.disabled,uo(L,R,0,1),null,R.id,L.viewportBuffer,L.quadTriangleIndexBuffer,L.viewportSegments,R.paint,L.transform.zoom))})(p,w)})(e,s,l,u);break;case"line":(function(p,v,w,T){if(p.renderPass!=="translucent")return;const M=w.paint.get("line-opacity"),L=w.paint.get("line-width");if(M.constantOr(1)===0||L.constantOr(1)===0)return;const R=p.depthModeForSublayer(0,Qt.ReadOnly),q=p.colorModeForRenderPass(),H=w.paint.get("line-dasharray"),K=w.paint.get("line-pattern"),Q=K.constantOr(1),re=w.paint.get("line-gradient"),oe=w.getCrossfadeParameters(),ce=Q?"linePattern":H?"lineSDF":re?"lineGradient":"line",ee=p.context,ge=ee.gl;let ve=!0;for(const ke of T){const Fe=v.getTile(ke);if(Q&&!Fe.patternsLoaded())continue;const Ue=Fe.getBucket(w);if(!Ue)continue;const We=Ue.programConfigurations.get(w.id),it=p.context.program.get(),Xe=p.useProgram(ce,We),Ze=ve||Xe.program!==it,dt=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ke),Rt=K.constantOr(null);if(Rt&&Fe.imageAtlas){const Lt=Fe.imageAtlas,Tr=Lt.patternPositions[Rt.to.toString()],Ut=Lt.patternPositions[Rt.from.toString()];Tr&&Ut&&We.setConstantPatternPositions(Tr,Ut)}const Ye=dt?ke:null,Qe=Q?xs(p,Fe,w,oe,Ye):H?kh(p,Fe,w,H,oe,Ye):re?vu(p,Fe,w,Ue.lineClipsArray.length,Ye):Al(p,Fe,w,Ye);if(Q)ee.activeTexture.set(ge.TEXTURE0),Fe.imageAtlasTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),We.updatePaintBuffers(oe);else if(H&&(Ze||p.lineAtlas.dirty))ee.activeTexture.set(ge.TEXTURE0),p.lineAtlas.bind(ee);else if(re){const Lt=Ue.gradients[w.id];let Tr=Lt.texture;if(w.gradientVersion!==Lt.version){let Ut=256;if(w.stepInterpolant){const Xt=v.getSource().maxzoom,Ir=ke.canonical.z===Xt?Math.ceil(1<<p.transform.maxZoom-ke.canonical.z):1;Ut=h.ac(h.aV(Ue.maxLineLength/h.X*1024*Ir),256,ee.maxTextureSize)}Lt.gradient=h.aW({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:Ut,image:Lt.gradient||void 0,clips:Ue.lineClipsArray}),Lt.texture?Lt.texture.update(Lt.gradient):Lt.texture=new It(ee,Lt.gradient,ge.RGBA),Lt.version=w.gradientVersion,Tr=Lt.texture}ee.activeTexture.set(ge.TEXTURE0),Tr.bind(w.stepInterpolant?ge.NEAREST:ge.LINEAR,ge.CLAMP_TO_EDGE)}Xe.draw(ee,ge.TRIANGLES,R,p.stencilModeForClipping(ke),q,wr.disabled,Qe,dt,w.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,w.paint,p.transform.zoom,We,Ue.layoutVertexBuffer2),ve=!1}})(e,s,l,u);break;case"fill":(function(p,v,w,T){const M=w.paint.get("fill-color"),L=w.paint.get("fill-opacity");if(L.constantOr(1)===0)return;const R=p.colorModeForRenderPass(),q=w.paint.get("fill-pattern"),H=p.opaquePassEnabledForLayer()&&!q.constantOr(1)&&M.constantOr(h.aM.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===H){const K=p.depthModeForSublayer(1,p.renderPass==="opaque"?Qt.ReadWrite:Qt.ReadOnly);Os(p,v,w,T,K,R,!1)}if(p.renderPass==="translucent"&&w.paint.get("fill-antialias")){const K=p.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,Qt.ReadOnly);Os(p,v,w,T,K,R,!0)}})(e,s,l,u);break;case"fill-extrusion":(function(p,v,w,T){const M=w.paint.get("fill-extrusion-opacity");if(M!==0&&p.renderPass==="translucent"){const L=new Qt(p.context.gl.LEQUAL,Qt.ReadWrite,p.depthRangeFor3D);if(M!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))jl(p,v,w,T,L,Ar.disabled,Yr.disabled),jl(p,v,w,T,L,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const R=p.colorModeForRenderPass();jl(p,v,w,T,L,Ar.disabled,R)}}})(e,s,l,u);break;case"hillshade":(function(p,v,w,T){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const M=p.context,L=p.depthModeForSublayer(0,Qt.ReadOnly),R=p.colorModeForRenderPass(),[q,H]=p.renderPass==="translucent"?p.stencilConfigForOverlap(T):[{},T];for(const K of H){const Q=v.getTile(K);Q.needsHillshadePrepare!==void 0&&Q.needsHillshadePrepare&&p.renderPass==="offscreen"?ma(p,Q,w,L,Ar.disabled,R):p.renderPass==="translucent"&&Ns(p,K,Q,w,L,q[K.overscaledZ],R)}M.viewport.set([0,0,p.width,p.height])})(e,s,l,u);break;case"raster":(function(p,v,w,T){if(p.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!T.length)return;const M=p.context,L=M.gl,R=v.getSource(),q=p.useProgram("raster"),H=p.colorModeForRenderPass(),[K,Q]=R instanceof vs?[{},T]:p.stencilConfigForOverlap(T),re=Q[Q.length-1].overscaledZ,oe=!p.options.moving;for(const ce of Q){const ee=p.depthModeForSublayer(ce.overscaledZ-re,w.paint.get("raster-opacity")===1?Qt.ReadWrite:Qt.ReadOnly,L.LESS),ge=v.getTile(ce);ge.registerFadeDuration(w.paint.get("raster-fade-duration"));const ve=v.findLoadedParent(ce,0),ke=v.findLoadedSibling(ce),Fe=Mu(ge,ve||ke||null,v,w,p.transform,p.style.map.terrain);let Ue,We;const it=w.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;M.activeTexture.set(L.TEXTURE0),ge.texture.bind(it,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),M.activeTexture.set(L.TEXTURE1),ve?(ve.texture.bind(it,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),Ue=Math.pow(2,ve.tileID.overscaledZ-ge.tileID.overscaledZ),We=[ge.tileID.canonical.x*Ue%1,ge.tileID.canonical.y*Ue%1]):ge.texture.bind(it,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),ge.texture.useMipmap&&M.extTextureFilterAnisotropic&&p.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const Xe=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ce),Ze=Xe?ce:null,dt=Ze?Ze.posMatrix:p.transform.calculatePosMatrix(ce.toUnwrapped(),oe),Rt=wc(dt,We||[0,0],Ue||1,Fe,w);R instanceof vs?q.draw(M,L.TRIANGLES,ee,Ar.disabled,H,wr.disabled,Rt,Xe,w.id,R.boundsBuffer,p.quadTriangleIndexBuffer,R.boundsSegments):q.draw(M,L.TRIANGLES,ee,K[ce.overscaledZ],H,wr.disabled,Rt,Xe,w.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}})(e,s,l,u);break;case"background":(function(p,v,w,T){const M=w.paint.get("background-color"),L=w.paint.get("background-opacity");if(L===0)return;const R=p.context,q=R.gl,H=p.transform,K=H.tileSize,Q=w.paint.get("background-pattern");if(p.isPatternMissing(Q))return;const re=!Q&&M.a===1&&L===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==re)return;const oe=Ar.disabled,ce=p.depthModeForSublayer(0,re==="opaque"?Qt.ReadWrite:Qt.ReadOnly),ee=p.colorModeForRenderPass(),ge=p.useProgram(Q?"backgroundPattern":"background"),ve=T||H.coveringTiles({tileSize:K,terrain:p.style.map.terrain});Q&&(R.activeTexture.set(q.TEXTURE0),p.imageManager.bind(p.context));const ke=w.getCrossfadeParameters();for(const Fe of ve){const Ue=T?Fe.posMatrix:p.transform.calculatePosMatrix(Fe.toUnwrapped()),We=Q?wu(Ue,L,p,Q,{tileID:Fe,tileSize:K},ke):Oo(Ue,L,M),it=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Fe);ge.draw(R,q.TRIANGLES,ce,oe,ee,wr.disabled,We,it,w.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}})(e,0,l,u);break;case"custom":(function(p,v,w){const T=p.context,M=w.implementation;if(p.renderPass==="offscreen"){const L=M.prerender;L&&(p.setCustomLayerDefaults(),T.setColorMode(p.colorModeForRenderPass()),L.call(M,T.gl,p.transform.customLayerMatrix()),T.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),T.setColorMode(p.colorModeForRenderPass()),T.setStencilMode(Ar.disabled);const L=M.renderingMode==="3d"?new Qt(p.context.gl.LEQUAL,Qt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,Qt.ReadOnly);T.setDepthMode(L),M.render(T.gl,p.transform.customLayerMatrix(),{farZ:p.transform.farZ,nearZ:p.transform.nearZ,fov:p.transform._fov,modelViewProjectionMatrix:p.transform.modelViewProjectionMatrix,projectionMatrix:p.transform.projectionMatrix}),T.setDirty(),p.setBaseState(),T.bindFramebuffer.set(null)}})(e,0,l)}}translatePosMatrix(e,s,l,u,p){if(!l[0]&&!l[1])return e;const v=p?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(v){const M=Math.sin(v),L=Math.cos(v);l=[l[0]*L-l[1]*M,l[0]*M+l[1]*L]}const w=[p?l[0]:qt(s,l[0],this.transform.zoom),p?l[1]:qt(s,l[1],this.transform.zoom),0],T=new Float32Array(16);return h.J(T,e,w),T}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!s||!l}useProgram(e,s){this.cache=this.cache||{};const l=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new xr(this.context,Ls[e],s,bu[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new It(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}class $o{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,l){const u=Math.pow(2,l),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((w=>{const T=1/(w=h.af([],w,e))[3]/s*u;return h.b1(w,w,[T,T,1/w[3],T])})),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((w=>{const T=(function(q,H){var K=H[0],Q=H[1],re=H[2],oe=K*K+Q*Q+re*re;return oe>0&&(oe=1/Math.sqrt(oe)),q[0]=H[0]*oe,q[1]=H[1]*oe,q[2]=H[2]*oe,q})([],(function(q,H,K){var Q=H[0],re=H[1],oe=H[2],ce=K[0],ee=K[1],ge=K[2];return q[0]=re*ge-oe*ee,q[1]=oe*ce-Q*ge,q[2]=Q*ee-re*ce,q})([],St([],p[w[0]],p[w[1]]),St([],p[w[2]],p[w[1]]))),M=-((L=T)[0]*(R=p[w[1]])[0]+L[1]*R[1]+L[2]*R[2]);var L,R;return T.concat(M)}));return new $o(p,v)}}class qo{constructor(e,s){this.min=e,this.max=s,this.center=(function(l,u,p){return l[0]=.5*u[0],l[1]=.5*u[1],l[2]=.5*u[2],l})([],(function(l,u,p){return l[0]=u[0]+p[0],l[1]=u[1]+p[1],l[2]=u[2]+p[2],l})([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],l=mt(this.min),u=mt(this.max);for(let p=0;p<s.length;p++)l[p]=s[p]?this.min[p]:this.center[p],u[p]=s[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new qo(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let u=0;u<e.planes.length;u++){const p=e.planes[u];let v=0;for(let w=0;w<s.length;w++)h.b2(p,s[w])>=0&&v++;if(v===0)return 0;v!==s.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const T=e.points[w][u]-this.min[u];p=Math.min(p,T),v=Math.max(v,T)}if(v<0||p>this.max[u]-this.min[u])return 0}return 1}}class Zo{constructor(e=0,s=0,l=0,u=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=l,this.right=u}interpolate(e,s,l){return s.top!=null&&e.top!=null&&(this.top=h.y.number(e.top,s.top,l)),s.bottom!=null&&e.bottom!=null&&(this.bottom=h.y.number(e.bottom,s.bottom,l)),s.left!=null&&e.left!=null&&(this.left=h.y.number(e.left,s.left,l)),s.right!=null&&e.right!=null&&(this.right=h.y.number(e.right,s.right,l)),this}getCenter(e,s){const l=h.ac((this.left+e-this.right)/2,0,e),u=h.ac((this.top+s-this.bottom)/2,0,s);return new h.P(l,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Zo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const $l=85.051129;class yo{constructor(e,s,l,u,p){this.tileSize=512,this._renderWorldCopies=p===void 0||!!p,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Zo,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new yo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-h.b3(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(function(){var l=new h.A(4);return h.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l})(),(function(l,u,p){var v=u[0],w=u[1],T=u[2],M=u[3],L=Math.sin(p),R=Math.cos(p);l[0]=v*R+T*L,l[1]=w*R+M*L,l[2]=v*-L+T*R,l[3]=w*-L+M*R})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=h.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,l){this._unmodified=!1,this._edgeInsets.interpolate(e,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new h.b4(0,e)];if(this._renderWorldCopies){const l=this.pointCoordinate(new h.P(0,0)),u=this.pointCoordinate(new h.P(this.width,0)),p=this.pointCoordinate(new h.P(this.width,this.height)),v=this.pointCoordinate(new h.P(0,this.height)),w=Math.floor(Math.min(l.x,u.x,p.x,v.x)),T=Math.floor(Math.max(l.x,u.x,p.x,v.x)),M=1;for(let L=w-M;L<=T+M;L++)L!==0&&s.push(new h.b4(L,e))}return s}coveringTiles(e){var s,l;let u=this.coveringZoomLevel(e);const p=u;if(e.minzoom!==void 0&&u<e.minzoom)return[];e.maxzoom!==void 0&&u>e.maxzoom&&(u=e.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),w=h.Z.fromLngLat(this.center),T=Math.pow(2,u),M=[T*v.x,T*v.y,0],L=[T*w.x,T*w.y,0],R=$o.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,u);let q=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(q=u);const H=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,K=ee=>({aabb:new qo([ee*T,0,0],[(ee+1)*T,T,0]),zoom:0,x:0,y:0,wrap:ee,fullyVisible:!1}),Q=[],re=[],oe=u,ce=e.reparseOverscaled?p:u;if(this._renderWorldCopies)for(let ee=1;ee<=3;ee++)Q.push(K(-ee)),Q.push(K(ee));for(Q.push(K(0));Q.length>0;){const ee=Q.pop(),ge=ee.x,ve=ee.y;let ke=ee.fullyVisible;if(!ke){const Xe=ee.aabb.intersects(R);if(Xe===0)continue;ke=Xe===2}const Fe=e.terrain?M:L,Ue=ee.aabb.distanceX(Fe),We=ee.aabb.distanceY(Fe),it=Math.max(Math.abs(Ue),Math.abs(We));if(ee.zoom===oe||it>H+(1<<oe-ee.zoom)-2&&ee.zoom>=q){const Xe=oe-ee.zoom,Ze=M[0]-.5-(ge<<Xe),dt=M[1]-.5-(ve<<Xe);re.push({tileID:new h.S(ee.zoom===oe?ce:ee.zoom,ee.wrap,ee.zoom,ge,ve),distanceSq:At([L[0]-.5-ge,L[1]-.5-ve]),tileDistanceToCamera:Math.sqrt(Ze*Ze+dt*dt)})}else for(let Xe=0;Xe<4;Xe++){const Ze=(ge<<1)+Xe%2,dt=(ve<<1)+(Xe>>1),Rt=ee.zoom+1;let Ye=ee.aabb.quadrant(Xe);if(e.terrain){const Qe=new h.S(Rt,ee.wrap,Rt,Ze,dt),Lt=e.terrain.getMinMaxElevation(Qe),Tr=(s=Lt.minElevation)!==null&&s!==void 0?s:this.elevation,Ut=(l=Lt.maxElevation)!==null&&l!==void 0?l:this.elevation;Ye=new qo([Ye.min[0],Ye.min[1],Tr],[Ye.max[0],Ye.max[1],Ut])}Q.push({aabb:Ye,zoom:Rt,x:Ze,y:dt,wrap:ee.wrap,fullyVisible:ke})}}return re.sort(((ee,ge)=>ee.distanceSq-ge.distanceSq)).map((ee=>ee.tileID))}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=h.ac(e.lat,-85.051129,$l);return new h.P(h.O(e.lng)*this.worldSize,h.Q(s)*this.worldSize)}unproject(e){return new h.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,u=this.pointLocation(this.centerPoint,e),p=e.getElevationForLngLatZoom(u,this.tileZoom);if(!(this.elevation-p))return;const v=l+s-p,w=Math.cos(this._pitch)*this.cameraToCenterDistance/v/h.b5(1,u.lat),T=this.scaleZoom(w/this.tileSize);this._elevation=p,this._center=u,this.zoom=T}setLocationAtPoint(e,s){const l=this.pointCoordinate(s),u=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(e),v=new h.Z(p.x-(l.x-u.x),p.y-(l.y-u.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),s.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return h.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const q=s.pointCoordinate(e);if(q!=null)return q}const l=[e.x,e.y,0,1],u=[e.x,e.y,1,1];h.af(l,l,this.pixelMatrixInverse),h.af(u,u,this.pixelMatrixInverse);const p=l[3],v=u[3],w=l[1]/p,T=u[1]/v,M=l[2]/p,L=u[2]/v,R=M===L?0:(0-M)/(L-M);return new h.Z(h.y.number(l[0]/p,u[0]/v,R)/this.worldSize,h.y.number(w,T,R)/this.worldSize)}coordinatePoint(e,s=0,l=this.pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,s,1];return h.af(u,u,l),new h.P(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new Pe().extend(this.pointLocation(new h.P(0,e))).extend(this.pointLocation(new h.P(this.width,e))).extend(this.pointLocation(new h.P(this.width,this.height))).extend(this.pointLocation(new h.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Pe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,$l])}calculateTileMatrix(e){const s=e.canonical,l=this.worldSize/this.zoomScale(s.z),u=s.x+Math.pow(2,s.z)*e.wrap,p=h.an(new Float64Array(16));return h.J(p,p,[u*l,s.y*l,0]),h.K(p,p,[l/h.X,l/h.X,1]),p}calculatePosMatrix(e,s=!1){const l=e.key,u=s?this._alignedPosMatrixCache:this._posMatrixCache;if(u[l])return u[l];const p=this.calculateTileMatrix(e);return h.L(p,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,p),u[l]=new Float32Array(p),u[l]}calculateFogMatrix(e){const s=e.key,l=this._fogMatrixCache;if(l[s])return l[s];const u=this.calculateTileMatrix(e);return h.L(u,this.fogMatrix,u),l[s]=new Float32Array(u),l[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,s){s=h.ac(+s,this.minZoom,this.maxZoom);const l={center:new h.N(e.lng,e.lat),zoom:s};let u=this.lngRange;if(!this._renderWorldCopies&&u===null){const ee=179.9999999999;u=[-ee,ee]}const p=this.tileSize*this.zoomScale(l.zoom);let v=0,w=p,T=0,M=p,L=0,R=0;const{x:q,y:H}=this.size;if(this.latRange){const ee=this.latRange;v=h.Q(ee[1])*p,w=h.Q(ee[0])*p,w-v<H&&(L=H/(w-v))}u&&(T=h.b3(h.O(u[0])*p,0,p),M=h.b3(h.O(u[1])*p,0,p),M<T&&(M+=p),M-T<q&&(R=q/(M-T)));const{x:K,y:Q}=this.project.call({worldSize:p},e);let re,oe;const ce=Math.max(R||0,L||0);if(ce){const ee=new h.P(R?(M+T)/2:K,L?(w+v)/2:Q);return l.center=this.unproject.call({worldSize:p},ee).wrap(),l.zoom+=this.scaleZoom(ce),l}if(this.latRange){const ee=H/2;Q-ee<v&&(oe=v+ee),Q+ee>w&&(oe=w-ee)}if(u){const ee=(T+M)/2;let ge=K;this._renderWorldCopies&&(ge=h.b3(K,ee-p/2,ee+p/2));const ve=q/2;ge-ve<T&&(re=T+ve),ge+ve>M&&(re=M-ve)}if(re!==void 0||oe!==void 0){const ee=new h.P(re??K,oe??Q);l.center=this.unproject.call({worldSize:p},ee).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=l,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=h.b5(1,this.center.lat)*this.worldSize;let u=h.an(new Float64Array(16));h.K(u,u,[this.width/2,-this.height/2,1]),h.J(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=h.an(new Float64Array(16)),h.K(u,u,[1,-1,1]),h.J(u,u,[-1,-1,0]),h.K(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const p=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this.minElevationForCurrentTile),w=p-v*this._pixelPerMeter/Math.cos(this._pitch),T=v<0?w:p,M=Math.PI/2+this._pitch,L=this._fov*(.5+e.y/this.height),R=Math.sin(L)*T/Math.sin(h.ac(Math.PI-M-L,.01,Math.PI-.01)),q=this.getHorizon(),H=2*Math.atan(q/this.cameraToCenterDistance)*(.5+e.y/(2*q)),K=Math.sin(H)*T/Math.sin(h.ac(Math.PI-M-H,.01,Math.PI-.01)),Q=Math.min(R,K);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Q+T),this.nearZ=this.height/50,u=new Float64Array(16),h.b6(u,this._fov,this.width/this.height,this.nearZ,this.farZ),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,this.projectionMatrix=h.ae(u),h.K(u,u,[1,-1,1]),h.J(u,u,[0,0,-this.cameraToCenterDistance]),h.b7(u,u,this._pitch),h.ad(u,u,this.angle),h.J(u,u,[-s,-l,0]),this.mercatorMatrix=h.K([],u,[this.worldSize,this.worldSize,this.worldSize]),h.K(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=h.L(new Float64Array(16),this.labelPlaneMatrix,u),h.J(u,u,[0,0,-this.elevation]),this.modelViewProjectionMatrix=u,this.invModelViewProjectionMatrix=h.as([],u),this.fogMatrix=new Float64Array(16),h.b6(this.fogMatrix,this._fov,this.width/this.height,p,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,h.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),h.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),h.b7(this.fogMatrix,this.fogMatrix,this._pitch),h.ad(this.fogMatrix,this.fogMatrix,this.angle),h.J(this.fogMatrix,this.fogMatrix,[-s,-l,0]),h.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),h.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=h.L(new Float64Array(16),this.labelPlaneMatrix,u);const re=this.width%2/2,oe=this.height%2/2,ce=Math.cos(this.angle),ee=Math.sin(this.angle),ge=s-Math.round(s)+ce*re+ee*oe,ve=l-Math.round(l)+ce*oe+ee*re,ke=new Float64Array(u);if(h.J(ke,ke,[ge>.5?ge-1:ge,ve>.5?ve-1:ve,0]),this.alignedModelViewProjectionMatrix=ke,u=h.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new h.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return h.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let l=s.x,u=s.y,p=s.x,v=s.y;for(const w of e)l=Math.min(l,w.x),u=Math.min(u,w.y),p=Math.max(p,w.x),v=Math.max(v,w.y);return[new h.P(l,u),new h.P(p,u),new h.P(p,v),new h.P(l,v),new h.P(l,u)]}}lngLatToCameraDepth(e,s){const l=this.locationCoordinate(e),u=[l.x*this.worldSize,l.y*this.worldSize,s,1];return h.af(u,u,this.modelViewProjectionMatrix),u[2]/u[3]}}function il(f,e){let s,l=!1,u=null,p=null;const v=()=>{u=null,l&&(f.apply(p,s),u=setTimeout(v,e),l=!1)};return(...w)=>(l=!0,p=this,s=w,u||v(),u)}class ql{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map((u=>u.split("="))).forEach((u=>{u[0]===this._hashName&&(l=u)})),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some((l=>isNaN(l)))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const l=s.join("/");let u=l;u.split("&").length>0&&(u=u.split("&")[0]),this._hashName&&(u=`${this._hashName}=${l}`);let p=window.location.hash.replace(u,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let v=window.location.href.replace(/(#.+)?$/,p);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=il(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,u),v=Math.round(s.lng*p)/p,w=Math.round(s.lat*p)/p,T=this._map.getBearing(),M=this._map.getPitch();let L="";if(L+=e?`/${v}/${w}/${l}`:`${l}/${w}/${v}`,(T||M)&&(L+="/"+Math.round(10*T)/10),M&&(L+=`/${Math.round(M)}`),this._hashName){const R=this._hashName;let q=!1;const H=window.location.hash.slice(1).split("&").map((K=>{const Q=K.split("=")[0];return Q===R?(q=!0,`${Q}=${L}`):K})).filter((K=>K));return q||H.push(`${R}=${L}`),`#${H.join("&")}`}return`#${L}`}}const Vs={linearity:.3,easing:h.b8(0,0,.3,1)},nl=h.e({deceleration:2500,maxSpeed:1400},Vs),sl=h.e({deceleration:20,maxSpeed:1400},Vs),Zl=h.e({deceleration:1e3,maxSpeed:360},Vs),ol=h.e({deceleration:1e3,maxSpeed:90},Vs);class ya{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:N.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=N.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)s.zoom+=p.zoomDelta||0,s.bearing+=p.bearingDelta||0,s.pitch+=p.pitchDelta||0,p.panDelta&&s.pan._add(p.panDelta),p.around&&(s.around=p.around),p.pinchAround&&(s.pinchAround=p.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(s.pan.mag()){const p=Go(s.pan.mag(),l,h.e({},nl,e||{}));u.offset=s.pan.mult(p.amount/s.pan.mag()),u.center=this._map.transform.center,bs(u,p)}if(s.zoom){const p=Go(s.zoom,l,sl);u.zoom=this._map.transform.zoom+p.amount,bs(u,p)}if(s.bearing){const p=Go(s.bearing,l,Zl);u.bearing=this._map.transform.bearing+h.ac(p.amount,-179,179),bs(u,p)}if(s.pitch){const p=Go(s.pitch,l,ol);u.pitch=this._map.transform.pitch+p.amount,bs(u,p)}if(u.zoom||u.bearing){const p=s.pinchAround===void 0?s.around:s.pinchAround;u.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),h.e(u,{noMoveStart:!0})}}function bs(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function Go(f,e,s){const{maxSpeed:l,linearity:u,deceleration:p}=s,v=h.ac(f*u/(e/1e3),-l,l),w=Math.abs(v)/(p*u);return{easing:s.easing,duration:1e3*w,amount:v*(w/2)}}class wi extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l,u={}){const p=$.mousePos(s.getCanvas(),l),v=s.unproject(p);super(e,h.e({point:p,lngLat:v,originalEvent:l},u)),this._defaultPrevented=!1,this.target=s}}class Ss extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){const u=e==="touchend"?l.changedTouches:l.touches,p=$.touchPos(s.getCanvasContainer(),u),v=p.map((T=>s.unproject(T))),w=p.reduce(((T,M,L,R)=>T.add(M.div(R.length))),new h.P(0,0));super(e,{points:p,point:w,lngLats:v,lngLat:s.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class zu extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class Du{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new zu(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new wi(e.type,this._map,e))}mouseup(e){this._map.fire(new wi(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new wi(e.type,this._map,e))}dblclick(e){return this._firePreventable(new wi(e.type,this._map,e))}mouseover(e){this._map.fire(new wi(e.type,this._map,e))}mouseout(e){this._map.fire(new wi(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ss(e.type,this._map,e))}touchmove(e){this._map.fire(new Ss(e.type,this._map,e))}touchend(e){this._map.fire(new Ss(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ss(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new wi(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new wi(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class In{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(h.P.convert(e),this._map.terrain)}}class Xi{constructor(e,s){this._map=e,this._tr=new In(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&($.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=$.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const p=Math.min(u.x,l.x),v=Math.max(u.x,l.x),w=Math.min(u.y,l.y),T=Math.max(u.y,l.y);$.setTransform(this._box,`translate(${p}px,${w}px)`),this._box.style.width=v-p+"px",this._box.style.height=T-w+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const l=this._startPos,u=s;if(this.reset(),$.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new h.k("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&($.remove(this._box),this._box=null),$.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new h.k(e,{originalEvent:s}))}}function _a(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);const s={};for(let l=0;l<f.length;l++)s[f[l].identifier]=e[l];return s}class ks{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=(function(u){const p=new h.P(0,0);for(const v of u)p._add(v);return p.div(u.length)})(s),this.touches=_a(l,s)))}touchmove(e,s,l){if(this.aborted||!this.centroid)return;const u=_a(l,s);for(const p in this.touches){const v=u[p];(!v||v.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,s,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class va{constructor(e){this.singleTap=new ks(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,l){this.singleTap.touchstart(e,s,l)}touchmove(e,s,l){this.singleTap.touchmove(e,s,l)}touchend(e,s,l){const u=this.singleTap.touchend(e,s,l);if(u){const p=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(u)<30;if(p&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class _o{constructor(e){this._tr=new In(e),this._zoomIn=new va({numTouches:1,numTaps:2}),this._zoomOut=new va({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,l){this._zoomIn.touchstart(e,s,l),this._zoomOut.touchstart(e,s,l)}touchmove(e,s,l){this._zoomIn.touchmove(e,s,l),this._zoomOut.touchmove(e,s,l)}touchend(e,s,l){const u=this._zoomIn.touchend(e,s,l),p=this._zoomOut.touchend(e,s,l),v=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(u)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class js{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=s.length?s[0]:s;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&$.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Lu={0:1,2:2};class vo{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=$.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(s,l){const u=Lu[l];return s.buttons===void 0||(s.buttons&u)!==u})(e,this._eventButton)}isValidEndEvent(e){return $.mouseButton(e)===this._eventButton}}class Ru{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const al=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}},Gl=({enable:f,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const l=new vo({checkCorrectEvent:u=>$.mouseButton(u)===0&&u.ctrlKey||$.mouseButton(u)===2});return new js({clickTolerance:e,move:(u,p)=>({bearingDelta:(p.x-u.x)*s}),moveStateManager:l,enable:f,assignEvents:al})},zr=({enable:f,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new vo({checkCorrectEvent:u=>$.mouseButton(u)===0&&u.ctrlKey||$.mouseButton(u)===2});return new js({clickTolerance:e,move:(u,p)=>({pitchDelta:(p.y-u.y)*s}),moveStateManager:l,enable:f,assignEvents:al})};class Us{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,l){return this._calculateTransform(e,s,l)}touchmove(e,s,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,s,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,l){this._calculateTransform(e,s,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,l){l.length>0&&(this._active=!0);const u=_a(l,s),p=new h.P(0,0),v=new h.P(0,0);let w=0;for(const M in u){const L=u[M],R=this._touches[M];R&&(p._add(L),v._add(L.sub(R)),w++,u[M]=L)}if(this._touches=u,this._shouldBePrevented(w)||!v.mag())return;const T=v.div(w);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(w),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ho{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,l){if(!this._firstTwoTouches)return;e.preventDefault();const[u,p]=this._firstTwoTouches,v=$s(l,s,u),w=$s(l,s,p);if(!v||!w)return;const T=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],T,e)}touchend(e,s,l){if(!this._firstTwoTouches)return;const[u,p]=this._firstTwoTouches,v=$s(l,s,u),w=$s(l,s,p);v&&w||(this._active&&$.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function $s(f,e,s){for(let l=0;l<f.length;l++)if(f[l].identifier===s)return e[l]}function Hl(f,e){return Math.log(f/e)/Math.LN2}class ll extends Ho{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Hl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Hl(this._distance,l),pinchAround:s}}}function Wo(f,e){return 180*f.angleWith(e)/Math.PI}class xa extends Ho{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,l){const u=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Wo(this._vector,u),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,l=Wo(e,this._startVector);return Math.abs(l)<s}}function qs(f){return Math.abs(f.y)>Math.abs(f.x)}class wa extends Ho{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,l){super.touchstart(e,s,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,qs(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,p,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,l){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,p=s.mag()>=2;if(!u&&!p)return;if(!u||!p)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=e.y>0==s.y>0;return qs(e)&&qs(s)&&v}}const Lc={panStep:100,bearingStep:15,pitchStep:10};class Pn{constructor(e){this._tr=new In(e);const s=Lc;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,l=0,u=0,p=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:w=>{const T=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Jn,zoom:s?Math.round(T.zoom)+s*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+l*this._bearingStep,pitch:T.pitch+u*this._pitchStep,offset:[-p*this._panStep,-v*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Jn(f){return f*(2-f)}const ba=4.000244140625;class Ki{constructor(e,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new In(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=N.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%ba==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=$.mousePos(this._map.getCanvas(),e),l=this._tr;this._around=s.y>l.transform.height/2-l.transform.getHorizon()?h.N.convert(this._aroundCenter?l.center:l.unproject(s)):h.N.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>ba?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&M!==0&&(M=1/M);const L=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(L*M))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,l=this._startZoom,u=this._easing;let p,v=!1;const w=N.now()-this._lastWheelEventTime;if(this._type==="wheel"&&l&&u&&w){const T=Math.min(w/200,1),M=u(T);p=h.y.number(l,s,M),T<1?this._frameId||(this._frameId=!0):v=!0}else p=s,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=h.b9;if(this._prevEase){const l=this._prevEase,u=(N.now()-l.start)/l.duration,p=l.easing(u+.01)-l.easing(u),v=.27/Math.sqrt(p*p+1e-4)*.01,w=Math.sqrt(.0729-v*v);s=h.b8(v,w,.25,1)}return this._prevEase={start:N.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Zs{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Fu{constructor(e){this._tr=new In(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bu{constructor(){this._tap=new va({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,l){if(!this._swipePoint)if(this._tapTime){const u=s[0],p=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(u)<30;p&&v?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,s,l)}touchmove(e,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=s[0],p=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,s,l)}touchend(e,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(e,s,l);u&&(this._tapTime=e.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wl{constructor(e,s,l){this._el=e,this._mousePan=s,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Rc{constructor(e,s,l){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xl{constructor(e,s,l,u){this._el=e,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Sa{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=$.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="maplibregl-desktop-message",u.textContent=s,this._container.appendChild(u);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=l,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&($.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new h.k("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Cn=f=>f.zoom||f.drag||f.pitch||f.rotate;class at extends h.k{}function Qn(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Kl{constructor(e,s){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,p)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=u.type==="renderFrame"?void 0:u,w={needsRenderFrame:!1},T={},M={},L=u.touches,R=L?this._getMapTouches(L):void 0,q=R?$.touchPos(this._map.getCanvas(),R):$.mousePos(this._map.getCanvas(),u);for(const{handlerName:Q,handler:re,allowed:oe}of this._handlers){if(!re.isEnabled())continue;let ce;this._blockedByActive(M,oe,Q)?re.reset():re[p||u.type]&&(ce=re[p||u.type](u,q,R),this.mergeHandlerResult(w,T,ce,Q,v),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||re.isActive())&&(M[Q]=re)}const H={};for(const Q in this._previousActiveHandlers)M[Q]||(H[Q]=v);this._previousActiveHandlers=M,(Object.keys(H).length||Qn(w))&&(this._changes.push([w,T,H]),this._triggerRenderFrame()),(Object.keys(M).length||Qn(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:K}=w;K&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],K(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ya(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,p,v]of this._listeners)$.addEventListener(u,p,u===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[e,s,l]of this._listeners)$.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new Du(s,e));const u=s.boxZoom=new Xi(s,e);this._add("boxZoom",u),e.interactive&&e.boxZoom&&u.enable();const p=s.cooperativeGestures=new Sa(s,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();const v=new _o(s),w=new Fu(s);s.doubleClickZoom=new Zs(w,v),this._add("tapZoom",v),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const T=new Bu;this._add("tapDragZoom",T);const M=s.touchPitch=new wa(s);this._add("touchPitch",M),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const L=Gl(e),R=zr(e);s.dragRotate=new Rc(e,L,R),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const q=(({enable:ce,clickTolerance:ee})=>{const ge=new vo({checkCorrectEvent:ve=>$.mouseButton(ve)===0&&!ve.ctrlKey});return new js({clickTolerance:ee,move:(ve,ke)=>({around:ke,panDelta:ke.sub(ve)}),activateOnStart:!0,moveStateManager:ge,enable:ce,assignEvents:al})})(e),H=new Us(e,s);s.dragPan=new Wl(l,q,H),this._add("mousePan",q),this._add("touchPan",H,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const K=new xa,Q=new ll;s.touchZoomRotate=new Xl(l,Q,K,T),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const re=s.scrollZoom=new Ki(s,(()=>this._triggerRenderFrame()));this._add("scrollZoom",re,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const oe=s.keyboard=new Pn(s);this._add("keyboard",oe),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new Hr(s))}_add(e,s,l){this._handlers.push({handlerName:e,handler:s,allowed:l}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Cn(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,l){for(const u in e)if(u!==l&&(!s||s.indexOf(u)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const l of e)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(e,s,l,u,p){if(!l)return;h.e(e,l);const v={handlerName:u,originalEvent:l.originalEvent||p};l.zoomDelta!==void 0&&(s.zoom=v),l.panDelta!==void 0&&(s.drag=v),l.pitchDelta!==void 0&&(s.pitch=v),l.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const e={},s={},l={};for(const[u,p,v]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new h.P(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),h.e(s,p),h.e(l,v);this._updateMapTransform(e,s,l),this._changes=[]}_updateMapTransform(e,s,l){const u=this._map,p=u._getTransformForUpdate(),v=u.terrain;if(!(Qn(e)||v&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:w,zoomDelta:T,bearingDelta:M,pitchDelta:L,around:R,pinchAround:q}=e;q!==void 0&&(R=q),u._stop(!0),R=R||u.transform.centerPoint;const H=p.pointLocation(w?R.sub(w):R);M&&(p.bearing+=M),L&&(p.pitch+=L),T&&(p.zoom+=T),v?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?p.center=p.pointLocation(p.centerPoint.sub(w)):p.setLocationAtPoint(H,R):(this._terrainMovement=!0,this._map._elevationFreeze=!0,p.setLocationAtPoint(H,R)):p.setLocationAtPoint(H,R),u._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,l,!0)}_fireEvents(e,s,l){const u=Cn(this._eventsInProgress),p=Cn(e),v={};for(const R in e){const{originalEvent:q}=e[R];this._eventsInProgress[R]||(v[`${R}start`]=q),this._eventsInProgress[R]=e[R]}!u&&p&&this._fireEvent("movestart",p.originalEvent);for(const R in v)this._fireEvent(R,v[R]);p&&this._fireEvent("move",p.originalEvent);for(const R in e){const{originalEvent:q}=e[R];this._fireEvent(R,q)}const w={};let T;for(const R in this._eventsInProgress){const{handlerName:q,originalEvent:H}=this._eventsInProgress[R];this._handlersById[q].isActive()||(delete this._eventsInProgress[R],T=s[q]||H,w[`${R}end`]=T)}for(const R in w)this._fireEvent(R,w[R]);const M=Cn(this._eventsInProgress),L=(u||p)&&!M;if(L&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const R=this._map._getTransformForUpdate();R.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(R)}if(l&&L){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;!R||!R.essential&&N.prefersReducedMotion?(this._map.fire(new h.k("moveend",{originalEvent:T})),q(this._map.getBearing())&&this._map.resetNorth()):(q(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new h.k(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new at("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Xo extends h.E{constructor(e,s){super(),this._renderFrameCallback=()=>{const l=Math.min((N.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new h.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,l){return e=h.P.convert(e).mult(-1),this.panTo(this.transform.center,h.e({offset:e},s),l)}panTo(e,s,l){return this.easeTo(h.e({center:e},s),l)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,l){return this.easeTo(h.e({zoom:e},s),l)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,l){return this.easeTo(h.e({bearing:e},s),l)}resetNorth(e,s){return this.rotateTo(0,h.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(h.e({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=Pe.convert(e).adjustAntiMeridian();const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,s)}_cameraForBoxAndBearing(e,s,l,u){const p={top:0,bottom:0,right:0,left:0};if(typeof(u=h.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const Xe=u.padding;u.padding={top:Xe,bottom:Xe,right:Xe,left:Xe}}u.padding=h.e(p,u.padding);const v=this.transform,w=v.padding,T=new Pe(e,s),M=v.project(T.getNorthWest()),L=v.project(T.getNorthEast()),R=v.project(T.getSouthEast()),q=v.project(T.getSouthWest()),H=h.ba(-l),K=M.rotate(H),Q=L.rotate(H),re=R.rotate(H),oe=q.rotate(H),ce=new h.P(Math.max(K.x,Q.x,oe.x,re.x),Math.max(K.y,Q.y,oe.y,re.y)),ee=new h.P(Math.min(K.x,Q.x,oe.x,re.x),Math.min(K.y,Q.y,oe.y,re.y)),ge=ce.sub(ee),ve=(v.width-(w.left+w.right+u.padding.left+u.padding.right))/ge.x,ke=(v.height-(w.top+w.bottom+u.padding.top+u.padding.bottom))/ge.y;if(ke<0||ve<0)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Fe=Math.min(v.scaleZoom(v.scale*Math.min(ve,ke)),u.maxZoom),Ue=h.P.convert(u.offset),We=new h.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(h.ba(l)),it=Ue.add(We).mult(v.scale/v.zoomScale(Fe));return{center:v.unproject(M.add(R).div(2).sub(it)),zoom:Fe,bearing:l}}fitBounds(e,s,l){return this._fitInternal(this.cameraForBounds(e,s),s,l)}fitScreenCoordinates(e,s,l,u,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(h.P.convert(e)),this.transform.pointLocation(h.P.convert(s)),l,u),u,p)}_fitInternal(e,s,l){return e?(delete(s=h.e(e,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(e,s){this.stop();const l=this._getTransformForUpdate();let u=!1,p=!1,v=!1;return"zoom"in e&&l.zoom!==+e.zoom&&(u=!0,l.zoom=+e.zoom),e.center!==void 0&&(l.center=h.N.convert(e.center)),"bearing"in e&&l.bearing!==+e.bearing&&(p=!0,l.bearing=+e.bearing),"pitch"in e&&l.pitch!==+e.pitch&&(v=!0,l.pitch=+e.pitch),e.padding==null||l.isPaddingEqual(e.padding)||(l.padding=e.padding),this._applyUpdatedTransform(l),this.fire(new h.k("movestart",s)).fire(new h.k("move",s)),u&&this.fire(new h.k("zoomstart",s)).fire(new h.k("zoom",s)).fire(new h.k("zoomend",s)),p&&this.fire(new h.k("rotatestart",s)).fire(new h.k("rotate",s)).fire(new h.k("rotateend",s)),v&&this.fire(new h.k("pitchstart",s)).fire(new h.k("pitch",s)).fire(new h.k("pitchend",s)),this.fire(new h.k("moveend",s))}calculateCameraOptionsFromTo(e,s,l,u=0){const p=h.Z.fromLngLat(e,s),v=h.Z.fromLngLat(l,u),w=v.x-p.x,T=v.y-p.y,M=v.z-p.z,L=Math.hypot(w,T,M);if(L===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(w,T),q=this.transform.scaleZoom(this.transform.cameraToCenterDistance/L/this.transform.tileSize),H=180*Math.atan2(w,-T)/Math.PI;let K=180*Math.acos(R/L)/Math.PI;return K=M<0?90-K:90+K,{center:v.toLngLat(),zoom:q,pitch:K,bearing:H}}easeTo(e,s){var l;this._stop(!1,e.easeId),((e=h.e({offset:[0,0],duration:500,easing:h.b9},e)).animate===!1||!e.essential&&N.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),p=u.zoom,v=u.bearing,w=u.pitch,T=u.padding,M="bearing"in e?this._normalizeBearing(e.bearing,v):v,L="pitch"in e?+e.pitch:w,R="padding"in e?e.padding:u.padding,q=h.P.convert(e.offset);let H=u.centerPoint.add(q);const K=u.pointLocation(H),{center:Q,zoom:re}=u.getConstrained(h.N.convert(e.center||K),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(Q,u);const oe=u.project(K),ce=u.project(Q).sub(oe),ee=u.zoomScale(re-p);let ge,ve;e.around&&(ge=h.N.convert(e.around),ve=u.locationPoint(ge));const ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||re!==p,this._rotating=this._rotating||v!==M,this._pitching=this._pitching||L!==w,this._padding=!u.isPaddingEqual(R),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,ke),this.terrain&&this._prepareElevation(Q),this._ease((Fe=>{if(this._zooming&&(u.zoom=h.y.number(p,re,Fe)),this._rotating&&(u.bearing=h.y.number(v,M,Fe)),this._pitching&&(u.pitch=h.y.number(w,L,Fe)),this._padding&&(u.interpolatePadding(T,R,Fe),H=u.centerPoint.add(q)),this.terrain&&!e.freezeElevation&&this._updateElevation(Fe),ge)u.setLocationAtPoint(ge,ve);else{const Ue=u.zoomScale(u.zoom-p),We=re>p?Math.min(2,ee):Math.max(.5,ee),it=Math.pow(We,1-Fe),Xe=u.unproject(oe.add(ce.mult(Fe*it)).mult(Ue));u.setLocationAtPoint(u.renderWorldCopies?Xe.wrap():Xe,H)}this._applyUpdatedTransform(u),this._fireMoveEvents(s)}),(Fe=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,Fe)}),e),this}_prepareEase(e,s,l={}){this._moving=!0,s||l.moving||this.fire(new h.k("movestart",e)),this._zooming&&!l.zooming&&this.fire(new h.k("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new h.k("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new h.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(s-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=h.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const s=e.getCameraPosition(),l=this.terrain.getElevationForLngLatZoom(s.lngLat,e.zoom);if(s.altitude<l){const u=this.calculateCameraOptionsFromTo(s.lngLat,l,e.center,e.elevation);return{pitch:u.pitch,zoom:u.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(this.terrain&&s.push((u=>this._elevateCameraIfInsideTerrain(u))),this.transformCameraUpdate&&s.push((u=>this.transformCameraUpdate(u))),!s.length)return;const l=e.clone();for(const u of s){const p=l.clone(),{center:v,zoom:w,pitch:T,bearing:M,elevation:L}=u(p);v&&(p.center=v),w!==void 0&&(p.zoom=w),T!==void 0&&(p.pitch=T),M!==void 0&&(p.bearing=M),L!==void 0&&(p.elevation=L),l.apply(p)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new h.k("move",e)),this._zooming&&this.fire(new h.k("zoom",e)),this._rotating&&this.fire(new h.k("rotate",e)),this._pitching&&this.fire(new h.k("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,u=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new h.k("zoomend",e)),u&&this.fire(new h.k("rotateend",e)),p&&this.fire(new h.k("pitchend",e)),this.fire(new h.k("moveend",e))}flyTo(e,s){var l;if(!e.essential&&N.prefersReducedMotion){const Qe=h.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Qe,s)}this.stop(),e=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.b9},e);const u=this._getTransformForUpdate(),p=u.zoom,v=u.bearing,w=u.pitch,T=u.padding,M="bearing"in e?this._normalizeBearing(e.bearing,v):v,L="pitch"in e?+e.pitch:w,R="padding"in e?e.padding:u.padding,q=h.P.convert(e.offset);let H=u.centerPoint.add(q);const K=u.pointLocation(H),{center:Q,zoom:re}=u.getConstrained(h.N.convert(e.center||K),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(Q,u);const oe=u.zoomScale(re-p),ce=u.project(K),ee=u.project(Q).sub(ce);let ge=e.curve;const ve=Math.max(u.width,u.height),ke=ve/oe,Fe=ee.mag();if("minZoom"in e){const Qe=h.ac(Math.min(e.minZoom,p,re),u.minZoom,u.maxZoom),Lt=ve/u.zoomScale(Qe-p);ge=Math.sqrt(Lt/Fe*2)}const Ue=ge*ge;function We(Qe){const Lt=(ke*ke-ve*ve+(Qe?-1:1)*Ue*Ue*Fe*Fe)/(2*(Qe?ke:ve)*Ue*Fe);return Math.log(Math.sqrt(Lt*Lt+1)-Lt)}function it(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function Xe(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const Ze=We(!1);let dt=function(Qe){return Xe(Ze)/Xe(Ze+ge*Qe)},Rt=function(Qe){return ve*((Xe(Ze)*(it(Lt=Ze+ge*Qe)/Xe(Lt))-it(Ze))/Ue)/Fe;var Lt},Ye=(We(!0)-Ze)/ge;if(Math.abs(Fe)<1e-6||!isFinite(Ye)){if(Math.abs(ve-ke)<1e-6)return this.easeTo(e,s);const Qe=ke<ve?-1:1;Ye=Math.abs(Math.log(ke/ve))/ge,Rt=()=>0,dt=Lt=>Math.exp(Qe*ge*Lt)}return e.duration="duration"in e?+e.duration:1e3*Ye/("screenSpeed"in e?+e.screenSpeed/ge:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=v!==M,this._pitching=L!==w,this._padding=!u.isPaddingEqual(R),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(Q),this._ease((Qe=>{const Lt=Qe*Ye,Tr=1/dt(Lt);u.zoom=Qe===1?re:p+u.scaleZoom(Tr),this._rotating&&(u.bearing=h.y.number(v,M,Qe)),this._pitching&&(u.pitch=h.y.number(w,L,Qe)),this._padding&&(u.interpolatePadding(T,R,Qe),H=u.centerPoint.add(q)),this.terrain&&!e.freezeElevation&&this._updateElevation(Qe);const Ut=Qe===1?Q:u.unproject(ce.add(ee.mult(Rt(Lt))).mult(Tr));u.setLocationAtPoint(u.renderWorldCopies?Ut.wrap():Ut,H),this._applyUpdatedTransform(u),this._fireMoveEvents(s)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,s)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,s,l){l.animate===!1||l.duration===0?(e(1),s()):(this._easeStart=N.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=h.b3(e,-180,180);const l=Math.abs(e-s);return Math.abs(e-360-s)<l&&(e-=360),Math.abs(e+360-s)<l&&(e+=360),e}_normalizeCenter(e,s){if(!s.renderWorldCopies||s.lngRange)return;const l=e.lng-s.center.lng;e.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(h.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const Oi={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ts{constructor(e=Oi){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=$.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=$.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){$.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const l=this._map._getUIString(`AttributionControl.${s}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((u=>typeof u!="string"?"":u))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const s=this._map.style.sourceCaches;for(const u in s){const p=s[u];if(p.used||p.usedForTerrain){const v=p.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter((u=>String(u).trim())),e.sort(((u,p)=>u.length-p.length)),e=e.filter(((u,p)=>{for(let v=p+1;v<e.length;v++)if(e[v].indexOf(u)>=0)return!1;return!0}));const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class es{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=$.create("div","maplibregl-ctrl");const s=$.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){$.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class er{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const u of l)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ou=h.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Ah extends h.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const l={};for(const u of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),h.aP(u.posMatrix,0,h.X,0,h.X,0,1),this._tiles[u.key]=new ao(u,this.tileSize));for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(e){for(const s in this._tiles){const l=this._tiles[s];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID;if(u.canonical.equals(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16),h.aP(p.posMatrix,0,h.X,0,h.X,0,1),s[l]=p}else if(u.canonical.isChildOf(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const v=u.canonical.z-e.canonical.z,w=u.canonical.x-(u.canonical.x>>v<<v),T=u.canonical.y-(u.canonical.y>>v<<v),M=h.X>>v;h.aP(p.posMatrix,0,M,0,M,0,1),h.J(p.posMatrix,p.posMatrix,[-w*M,-T*M,0]),s[l]=p}else if(e.canonical.isChildOf(u.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const v=e.canonical.z-u.canonical.z,w=e.canonical.x-(e.canonical.x>>v<<v),T=e.canonical.y-(e.canonical.y>>v<<v),M=h.X>>v;h.aP(p.posMatrix,0,h.X,0,h.X,0,1),h.J(p.posMatrix,p.posMatrix,[w*M,T*M,0]),h.K(p.posMatrix,p.posMatrix,[1/2**v,1/2**v,0]),s[l]=p}}return s}getSourceTile(e,s){const l=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&s)for(;u>=l.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(u--).key);return p}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter((s=>s.timeAdded>=e))}}class Gs{constructor(e,s,l){this.painter=e,this.sourceCache=new Ah(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,l,u=h.X){var p;if(!(s>=0&&s<u&&l>=0&&l<u))return 0;const v=this.getTerrainData(e),w=(p=v.tile)===null||p===void 0?void 0:p.dem;if(!w)return 0;const T=(function(K,Q,re){var oe=Q[0],ce=Q[1];return K[0]=re[0]*oe+re[4]*ce+re[12],K[1]=re[1]*oe+re[5]*ce+re[13],K})([],[s/u*h.X,l/u*h.X],v.u_terrain_matrix),M=[T[0]*w.dim,T[1]*w.dim],L=Math.floor(M[0]),R=Math.floor(M[1]),q=M[0]-L,H=M[1]-R;return w.get(L,R)*(1-q)*(1-H)+w.get(L+1,R)*q*(1-H)+w.get(L,R+1)*(1-q)*H+w.get(L+1,R+1)*q*H}getElevationForLngLatZoom(e,s){if(!h.bb(s,e.wrap()))return 0;const{tileID:l,mercatorX:u,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(l,u%h.X,p%h.X,h.X)}getElevation(e,s,l,u=h.X){return this.getDEMElevation(e,s,l,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,p=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new It(u,p,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new It(u,new h.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.an([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const u=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new It(u,s.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),s.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let p=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?p=e.canonical.z-u:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=e.canonical.x-(e.canonical.x>>p<<p),w=e.canonical.y-(e.canonical.y>>p<<p),T=h.bc(new Float64Array(16),[1/(h.X<<p),1/(h.X<<p),0]);h.J(T,T,[v*h.X,w*h.X,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,l=s.width/devicePixelRatio,u=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new It(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new It(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,v=0;p<this._coordsTextureSize;p++)for(let w=0;w<this._coordsTextureSize;w++,v+=4)s[v+0]=255&w,s[v+1]=255&p,s[v+2]=w>>8<<4|p>>8,s[v+3]=0;const l=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),u=new It(e,l,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,u=l.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(p,w-v-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const T=s[0]+(s[2]>>4<<8),M=s[1]+((15&s[2])<<8),L=this.coordsIndex[255-s[3]],R=L&&this.sourceCache.getTileByID(L);if(!R)return null;const q=this._coordsTextureSize,H=(1<<R.tileID.canonical.z)*q;return new h.Z((R.tileID.canonical.x*q+T)/H+R.tileID.wrap,(R.tileID.canonical.y*q+M)/H,this.getElevation(R.tileID,T,M,q))}depthAtPoint(e){const s=new Uint8Array(4),l=this.painter.context,u=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new h.bd,l=new h.aY,u=this.meshSize,p=h.X/u,v=u*u;for(let R=0;R<=u;R++)for(let q=0;q<=u;q++)s.emplaceBack(q*p,R*p,0);for(let R=0;R<v;R+=u+1)for(let q=0;q<u;q++)l.emplaceBack(q+R,u+q+R+1,u+q+R+2),l.emplaceBack(q+R,u+q+R+2,q+R+1);const w=s.length,T=w+2*(u+1);for(const R of[0,1])for(let q=0;q<=u;q++)for(const H of[0,1])s.emplaceBack(q*p,R*h.X,H);for(let R=0;R<2*u;R+=2)l.emplaceBack(T+R,T+R+1,T+R+3),l.emplaceBack(T+R,T+R+3,T+R+2),l.emplaceBack(w+R,w+R+3,w+R+1),l.emplaceBack(w+R,w+R+2,w+R+3);const M=s.length,L=M+2*(u+1);for(const R of[0,1])for(let q=0;q<=u;q++)for(const H of[0,1])s.emplaceBack(R*h.X,q*p,H);for(let R=0;R<2*u;R+=2)l.emplaceBack(M+R,M+R+1,M+R+3),l.emplaceBack(M+R,M+R+3,M+R+2),l.emplaceBack(L+R,L+R+3,L+R+1),l.emplaceBack(L+R,L+R+2,L+R+3);return this._mesh=new Wi(e.createVertexBuffer(s,Ou.members),e.createIndexBuffer(l),h.a0.simpleSegment(0,0,s.length,l.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*h.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,s){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,s){const l=h.Z.fromLngLat(e.wrap()),u=(1<<s)*h.X,p=l.x*u,v=l.y*u,w=Math.floor(p/h.X),T=Math.floor(v/h.X);return{tileID:new h.S(s,0,s,w,T),mercatorX:p,mercatorY:v}}}class ul{constructor(e,s,l){this._context=e,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new It(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:e,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((s=>e.id!==s)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const ts={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class cl{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new ul(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((l=>!e._layers[l].isHidden(s))),this._coordsDescendingInv={};for(const l in e.sourceCaches){this._coordsDescendingInv[l]={};const u=e.sourceCaches[l].getVisibleCoordinates();for(const p of u){const v=this.terrain.sourceCache.getTerrainCoords(p);for(const w in v)this._coordsDescendingInv[l][w]||(this._coordsDescendingInv[l][w]=[]),this._coordsDescendingInv[l][w].push(v[w])}}this._coordsDescendingInvStr={};for(const l of e._order){const u=e._layers[l],p=u.source;if(ts[u.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const v in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][v]=this._coordsDescendingInv[p][v].map((w=>w.key)).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[u][l.tileID.key];p&&p!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,l=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(ts[s]&&(this._prevType&&ts[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!u))return!0;if(ts[this._prevType]||ts[s]&&u){this._prevType=s;const p=this._stacks.length-1,v=this._stacks[p]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(Dc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[p]){const M=this.pool.getObjectForId(w.rtt[p].id);if(M.stamp===w.rtt[p].stamp){this.pool.useObject(M);continue}}const T=this.pool.getOrCreateFreeObject();this.pool.useObject(T),this.pool.stampObject(T),w.rtt[p]={id:T.id,stamp:T.stamp},l.context.bindFramebuffer.set(T.fbo.framebuffer),l.context.clear({color:h.aM.transparent,stencil:0}),l.currentStencilSource=void 0;for(let M=0;M<v.length;M++){const L=l.style._layers[v[M]],R=L.source?this._coordsDescendingInv[L.source][w.tileID.key]:[w.tileID];l.context.viewport.set([0,0,T.fbo.width,T.fbo.height]),l._renderTileClippingMasks(L,R),l.renderLayer(l,l.style.sourceCaches[L.source],L,R),L.source&&(w.rttCoords[L.source]=this._coordsDescendingInvStr[L.source][w.tileID.key])}}return Dc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ts[s]}return!1}}const hl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ko=Y,xo={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Oi,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Dr=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},Fr={showCompass:!0,showZoom:!0,visualizePitch:!1};class wo{constructor(e,s,l=!1){this.mousedown=v=>{this.startMouse(h.e({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),$.mousePos(this.element,v)),$.addEventListener(window,"mousemove",this.mousemove),$.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,$.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=$.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),$.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=$.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=e.dragRotate._mouseRotate.getClickTolerance(),p=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=Gl({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:w,bearingDegreesPerPixelMoved:T=.8})=>{const M=new Ru;return new js({clickTolerance:w,move:(L,R)=>({bearingDelta:(R.x-L.x)*T}),moveStateManager:M,enable:v,assignEvents:Dr})})({clickTolerance:u,enable:!0}),this.map=e,l&&(this.mousePitch=zr({clickTolerance:p,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:w,pitchDegreesPerPixelMoved:T=-.5})=>{const M=new Ru;return new js({clickTolerance:w,move:(L,R)=>({pitchDelta:(R.y-L.y)*T}),moveStateManager:M,enable:v,assignEvents:Dr})})({clickTolerance:p,enable:!0})),$.addEventListener(s,"mousedown",this.mousedown),$.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),$.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),$.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),$.disableDrag()}moveMouse(e,s){const l=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.mousePitch){const{pitchDelta:p}=this.mousePitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}moveTouch(e,s){const l=this.map,{bearingDelta:u}=this.touchRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.touchPitch){const{pitchDelta:p}=this.touchPitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}off(){const e=this.element;$.removeEventListener(e,"mousedown",this.mousedown),$.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend),$.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){$.enableDrag(),$.removeEventListener(window,"mousemove",this.mousemove),$.removeEventListener(window,"mouseup",this.mouseup),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend)}}let Er;function rr(f,e,s){const l=new h.N(f.lng,f.lat);if(f=new h.N(f.lng,f.lat),e){const u=new h.N(f.lng-360,f.lat),p=new h.N(f.lng+360,f.lat),v=s.locationPoint(f).distSqr(e);s.locationPoint(u).distSqr(e)<v?f=u:s.locationPoint(p).distSqr(e)<v&&(f=p)}for(;Math.abs(f.lng-s.center.lng)>180;){const u=s.locationPoint(f);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f.lng!==l.lng&&s.locationPoint(f).y>s.height/2-s.getHorizon()?f:l}const Mn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Hs(f,e,s){const l=f.classList;for(const u in Mn)l.remove(`maplibregl-${s}-anchor-${u}`);l.add(`maplibregl-${s}-anchor-${e}`)}class bi extends h.E{constructor(e){if(super(),this._onKeyPress=s=>{const l=s.code,u=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=s=>{var l;if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();(s?.type==="terrain"||s?.type==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?rr(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),$.setTransform(this._element,`${Mn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${p}`),N.frameAsync(new AbortController).then((()=>{this._updateOpacity(s&&s.type==="moveend")})).catch((()=>{}))},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.k("dragstart"))),this.fire(new h.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=h.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=$.create("div");const s=$.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${u}px`),s.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const p=$.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const v=$.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const w=$.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const oe of T){const ce=$.createNS("http://www.w3.org/2000/svg","ellipse");ce.setAttributeNS(null,"opacity","0.04"),ce.setAttributeNS(null,"cx","10.5"),ce.setAttributeNS(null,"cy","5.80029008"),ce.setAttributeNS(null,"rx",oe.rx),ce.setAttributeNS(null,"ry",oe.ry),w.appendChild(ce)}const M=$.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill",this._color);const L=$.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),M.appendChild(L);const R=$.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const q=$.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(q);const H=$.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(6.0, 7.0)"),H.setAttributeNS(null,"fill","#FFFFFF");const K=$.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Q=$.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#000000"),Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962");const re=$.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#FFFFFF"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962"),K.appendChild(Q),K.appendChild(re),v.appendChild(w),v.appendChild(M),v.appendChild(R),v.appendChild(H),v.appendChild(K),s.appendChild(v),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(s),this._offset=h.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(s=>{s.preventDefault()})),this._element.addEventListener("mousedown",(s=>{s.preventDefault()})),Hs(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),$.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=h.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,l;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const u=this._map,p=u.terrain.depthAtPoint(this._pos),v=u.terrain.getElevationForLngLatZoom(this._lngLat,u.transform.tileZoom);if(u.transform.lngLatToCameraDepth(this._lngLat,v)-p<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/u.transform._pixelPerMeter,T=Math.sin(u.getPitch()*Math.PI/180)*w,M=u.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),L=u.transform.lngLatToCameraDepth(this._lngLat,v+T)-M>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&L&&this._popup.remove(),this._element.style.opacity=L?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=h.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return e===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const dl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ka=0,Ta=!1;const fn={maxWidth:100,unit:"metric"};function Ea(f,e,s){const l=s&&s.maxWidth||100,u=f._container.clientHeight/2,p=f.unproject([0,u]),v=f.unproject([l,u]),w=p.distanceTo(v);if(s&&s.unit==="imperial"){const T=3.2808*w;T>5280?lt(e,l,T/5280,f._getUIString("ScaleControl.Miles")):lt(e,l,T,f._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?lt(e,l,w/1852,f._getUIString("ScaleControl.NauticalMiles")):w>=1e3?lt(e,l,w/1e3,f._getUIString("ScaleControl.Kilometers")):lt(e,l,w,f._getUIString("ScaleControl.Meters"))}function lt(f,e,s,l){const u=(function(p){const v=Math.pow(10,`${Math.floor(p)}`.length-1);let w=p/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(T){const M=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*M)/M})(w),v*w})(s);f.style.width=e*(u/s)+"px",f.innerHTML=`${u}&nbsp;${l}`}const Et={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Ia=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function pl(f){if(f){if(typeof f=="number"){const e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,f),"top-left":new h.P(e,e),"top-right":new h.P(-e,e),bottom:new h.P(0,-f),"bottom-left":new h.P(e,-e),"bottom-right":new h.P(-e,-e),left:new h.P(f,0),right:new h.P(-f,0)}}if(f instanceof h.P||Array.isArray(f)){const e=h.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:h.P.convert(f.center||[0,0]),top:h.P.convert(f.top||[0,0]),"top-left":h.P.convert(f["top-left"]||[0,0]),"top-right":h.P.convert(f["top-right"]||[0,0]),bottom:h.P.convert(f.bottom||[0,0]),"bottom-left":h.P.convert(f["bottom-left"]||[0,0]),"bottom-right":h.P.convert(f["bottom-right"]||[0,0]),left:h.P.convert(f.left||[0,0]),right:h.P.convert(f.right||[0,0])}}return pl(new h.P(0,0))}const Nu=Y;I.AJAXError=h.bh,I.Evented=h.E,I.LngLat=h.N,I.MercatorCoordinate=h.Z,I.Point=h.P,I.addProtocol=h.bi,I.config=h.a,I.removeProtocol=h.bj,I.AttributionControl=Ts,I.BoxZoomHandler=Xi,I.CanvasSource=ln,I.CooperativeGesturesHandler=Sa,I.DoubleClickZoomHandler=Zs,I.DragPanHandler=Wl,I.DragRotateHandler=Rc,I.EdgeInsets=Zo,I.FullscreenControl=class extends h.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){$.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=$.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);$.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},I.GeoJSONSource=ys,I.GeolocateControl=class extends h.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new h.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new h.N(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,u=this._map.getBearing(),p=h.e({bearing:u},this.options.fitBoundsOptions),v=Pe.fromLngLat(s,l);this._map.fitBounds(v,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new h.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ta)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=$.create("button","maplibregl-ctrl-geolocate",this._container),$.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new bi({element:this._dotElement}),this._circleElement=$.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.k("trackuserlocationend")),this.fire(new h.k("userlocationlostfocus")))}))}},this.options=h.e({},dl,f)}onAdd(f){return this._map=f,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return h._(this,arguments,void 0,(function*(e=!1){if(Er!==void 0&&!e)return Er;if(window.navigator.permissions===void 0)return Er=!!window.navigator.geolocation,Er;try{Er=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Er=!!window.navigator.geolocation}return Er}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),$.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ka=0,Ta=!1}_isOutOfMapMaxBounds(f){const e=this._map.getMaxBounds(),s=f.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),e=f.getSouthEast(),s=f.getNorthEast(),l=e.distanceTo(s),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ka--,Ta=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.k("trackuserlocationstart")),this.fire(new h.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ka++,ka>1?(f={maximumAge:6e5,timeout:0},Ta=!0):(f=this.options.positionOptions,Ta=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},I.Hash=ql,I.ImageSource=vs,I.KeyboardHandler=Pn,I.LngLatBounds=Pe,I.LogoControl=es,I.Map=class extends Xo{constructor(f){h.bf.mark(h.bg.create);const e=Object.assign(Object.assign({},xo),f);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new yo(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new er,this._controls=[],this._mapId=h.a4(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new h.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new h.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},hl),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ge.addThrottleControl((()=>this.isMoving())),this._requestManager=new rt(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))).on("moveend",(()=>this._update(!1))).on("zoom",(()=>this._update(!0))).on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})).once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const l=il((u=>{this._trackResize&&!this._removed&&(this.resize(u),this.redraw())}),50);this._resizeObserver=new ResizeObserver((u=>{s?l(u):s=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Kl(this,e),this._hash=e.hash&&new ql(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,h.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Ts(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new es,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(s=>{this._update(s.dataType==="style"),this.fire(new h.k(`${s.dataType}data`,s))})),this.on("dataloading",(s=>{this.fire(new h.k(`${s.dataType}dataloading`,s))})),this.on("dataabort",(s=>{this.fire(new h.k("sourcedataabort",s))}))}_getMapId(){return this._mapId}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new h.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new h.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,s,l)}resize(f){var e;const s=this._containerDimensions(),l=s[0],u=s[1],p=this._getClampedPixelRatio(l,u);if(this._resizeCanvas(l,u,p),this.painter.resize(l,u,p),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const T=this._getClampedPixelRatio(l,u);this._resizeCanvas(l,u,T),this.painter.resize(l,u,T)}this.transform.resize(l,u),(e=this._requestedCameraState)===null||e===void 0||e.resize(l,u);const v=!this._moving;return v&&(this.stop(),this.fire(new h.k("movestart",f)).fire(new h.k("move",f))),this.fire(new h.k("resize",f)),v&&this.fire(new h.k("moveend",f)),this}_getClampedPixelRatio(f,e){const{0:s,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),p=f*u,v=e*u;return Math.min(p>s?s/p:1,v>l?l/v:1)*u}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(Pe.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint(h.N.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(h.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,s){if(f==="mouseenter"||f==="mouseover"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:p=>{const v=e.filter((T=>this.getLayer(T))),w=v.length!==0?this.queryRenderedFeatures(p.point,{layers:v}):[];w.length?l||(l=!0,s.call(this,new wi(f,this,p.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(f==="mouseleave"||f==="mouseout"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:v=>{const w=e.filter((T=>this.getLayer(T)));(w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[]).length?l=!0:l&&(l=!1,s.call(this,new wi(f,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,s.call(this,new wi(f,this,v.originalEvent)))}}}}{const l=u=>{const p=e.filter((w=>this.getLayer(w))),v=p.length!==0?this.queryRenderedFeatures(u.point,{layers:p}):[];v.length&&(u.features=v,s.call(this,u),delete u.features)};return{layers:e,listener:s,delegates:{[f]:l}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,s){if(!this._delegatedListeners||!this._delegatedListeners[f])return;const l=this._delegatedListeners[f];for(let u=0;u<l.length;u++){const p=l[u];if(p.listener===s&&p.layers.length===e.length&&p.layers.every((v=>e.includes(v)))){for(const v in p.delegates)this.off(v,p.delegates[v]);return void l.splice(u,1)}}}on(f,e,s){if(s===void 0)return super.on(f,e);const l=this._createDelegatedListener(f,typeof e=="string"?[e]:e,s);this._saveDelegatedListener(f,l);for(const u in l.delegates)this.on(u,l.delegates[u]);return this}once(f,e,s){if(s===void 0)return super.once(f,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(f,l,s);for(const p in u.delegates){const v=u.delegates[p];u.delegates[p]=(...w)=>{this._removeDelegatedListener(f,l,s),v(...w)}}this._saveDelegatedListener(f,u);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(f,e,s){return s===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let s;const l=f instanceof h.P||Array.isArray(f),u=l?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:f)||{},u instanceof h.P||typeof u[0]=="number")s=[h.P.convert(u)];else{const p=h.P.convert(u[0]),v=h.P.convert(u[1]);s=[p,new h.P(v.x,p.y),v,new h.P(p.x,v.y),p]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(f,e)));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new Pl(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,s):this.style.loadJSON(f,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Pl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){const s=this._requestManager.transformRequest(f,"Style");h.h(s,new AbortController).then((l=>{this._updateDiff(l.data,e)})).catch((l=>{l&&this.fire(new h.j(l))}))}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(s){h.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){const e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new h.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===f.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Gs(this.painter,e,f),this.painter.renderToTexture=new cl(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==f.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new h.k("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const e in f){const s=f[e]._tiles;for(const l in s){const u=s[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,e,s={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:p,stretchY:v,content:w,textFitWidth:T,textFitHeight:M}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||h.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:R,data:q}=e,H=e;return this.style.addImage(f,{data:new h.R({width:L,height:R},new Uint8Array(q)),pixelRatio:l,stretchX:p,stretchY:v,content:w,textFitWidth:T,textFitHeight:M,sdf:u,version:0,userImage:H}),H.onAdd&&H.onAdd(this,f),this}}{const{width:L,height:R,data:q}=N.getImageData(e);this.style.addImage(f,{data:new h.R({width:L,height:R},q),pixelRatio:l,stretchX:p,stretchY:v,content:w,textFitWidth:T,textFitHeight:M,sdf:u,version:0})}}updateImage(f,e){const s=this.style.getImage(f);if(!s)return this.fire(new h.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||h.b(e)?N.getImageData(e):e,{width:u,height:p,data:v}=l;if(u===void 0||p===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==s.data.width||p!==s.data.height)return this.fire(new h.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||h.b(e));return s.data.replace(v,w),this.style.updateImage(f,s),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new h.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return Ge.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,s){return this.style.setLayerZoomRange(f,e,s),this._update(!0)}setFilter(f,e,s={}){return this.style.setFilter(f,e,s),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,s,l={}){return this.style.setPaintProperty(f,e,s,l),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,s,l={}){return this.style.setLayoutProperty(f,e,s,l),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,s,(l=>{l||this._update(!0)})),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,(s=>{s||this._update(!0)})),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f){return this._lazyInitEmptyStyle(),this.style.setSky(f),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const e=this._canvasContainer=$.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=$.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const u=this._controlContainer=$.create("div","maplibregl-control-container",f),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((v=>{p[v]=$.create("div",`maplibregl-ctrl-${v} `,u)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,s){this._canvas.width=Math.floor(s*f),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{e={requestedAttributes:f},l&&(e.statusMessage=l.statusMessage,e.type=l.type)}),{once:!0});const s=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!s){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new go(s,this.transform),fe.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,p=N.now();this.style.zoomHistory.update(u,p);const v=new h.z(u,{now:p,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=v.crossFadingFactor();w===1&&w===this._crossFadingFactor||(s=!0,this._crossFadingFactor=w),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new h.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.bf.mark(h.bg.load),this.fire(new h.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,h.bf.mark(h.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ge.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),$.remove(this._canvasContainer),$.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),h.bf.clearMetrics(),this._removed=!0,this.fire(new h.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,N.frameAsync(this._frameRequest).then((f=>{h.bf.frame(f),this._frameRequest=null,this._render(f)})).catch((()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return Ko}getCameraTargetElevation(){return this.transform.elevation}},I.MapMouseEvent=wi,I.MapTouchEvent=Ss,I.MapWheelEvent=zu,I.Marker=bi,I.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);e.title=l,e.setAttribute("aria-label",l)},this.options=h.e({},Fr,f),this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),$.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),$.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=$.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wo(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){$.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){const s=$.create("button",f,this._container);return s.type="button",s.addEventListener("click",e),s}},I.Popup=class extends h.E{constructor(f){super(),this.remove=()=>(this._content&&$.remove(this._content),this._container&&($.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=$.create("div","maplibregl-popup",this._map.getContainer()),this._tip=$.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?rr(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!e)return;const l=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let u=this.options.anchor;const p=pl(this.options.offset);if(!u){const w=this._container.offsetWidth,T=this._container.offsetHeight;let M;M=l.y+p.bottom.y<T?["top"]:l.y>this._map.transform.height-T?["bottom"]:[],l.x<w/2?M.push("left"):l.x>this._map.transform.width-w/2&&M.push("right"),u=M.length===0?"bottom":M.join("-")}let v=l.add(p[u]);this.options.subpixelPositioning||(v=v.round()),$.setTransform(this._container,`${Mn[u]} translate(${v.x}px,${v.y}px)`),Hs(this._container,u,"popup")},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(Et),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=h.N.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const e=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=f;l=s.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=$.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=$.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Ia);f&&f.focus()}},I.RasterDEMTileSource=Mr,I.RasterTileSource=hr,I.ScaleControl=class{constructor(f){this._onMove=()=>{Ea(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Ea(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},fn),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){$.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},I.ScrollZoomHandler=Ki,I.Style=Pl,I.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=$.create("button","maplibregl-ctrl-terrain",this._container),$.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){$.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},I.TwoFingersTouchPitchHandler=wa,I.TwoFingersTouchRotateHandler=xa,I.TwoFingersTouchZoomHandler=ll,I.TwoFingersTouchZoomRotateHandler=Xl,I.VectorTileSource=na,I.VideoSource=Ao,I.addSourceType=(f,e)=>h._(void 0,void 0,void 0,(function*(){if(zo(f))throw new Error(`A source type called "${f}" already exists.`);((s,l)=>{sa[s]=l})(f,e)})),I.clearPrewarmedResources=function(){const f=ir;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Ht),ir=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},I.getMaxParallelImageRequests=function(){return h.a.MAX_PARALLEL_IMAGE_REQUESTS},I.getRTLTextPluginStatus=function(){return $i().getRTLTextPluginStatus()},I.getVersion=function(){return Nu},I.getWorkerCount=function(){return Jt.workerCount},I.getWorkerUrl=function(){return h.a.WORKER_URL},I.importScriptInWorkers=function(f){return oo().broadcast("IS",f)},I.prewarm=function(){Sr().acquire(Ht)},I.setMaxParallelImageRequests=function(f){h.a.MAX_PARALLEL_IMAGE_REQUESTS=f},I.setRTLTextPlugin=function(f,e){return $i().setRTLTextPlugin(f,e)},I.setWorkerCount=function(f){Jt.workerCount=f},I.setWorkerUrl=function(f){h.a.WORKER_URL=f}}));var O=S;return O}))})(dp)),dp.exports}var fg=pg();const Yp=xp(fg);var no=63710088e-1,mg={centimeters:no*100,centimetres:no*100,degrees:360/(2*Math.PI),feet:no*3.28084,inches:no*39.37,kilometers:no/1e3,kilometres:no/1e3,meters:no,metres:no,miles:no/1609.344,millimeters:no*1e3,millimetres:no*1e3,nauticalmiles:no/1852,radians:1,yards:no*1.0936};function Sm(P,b,S={}){const z={type:"Feature"};return(S.id===0||S.id)&&(z.id=S.id),S.bbox&&(z.bbox=S.bbox),z.properties=b||{},z.geometry=P,z}function pd(P,b,S={}){if(!P)throw new Error("coordinates is required");if(!Array.isArray(P))throw new Error("coordinates must be an Array");if(P.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Zf(P[0])||!Zf(P[1]))throw new Error("coordinates must contain numbers");return Sm({type:"Point",coordinates:P},b,S)}function gf(P,b,S={}){for(const F of P){if(F.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(F[F.length-1].length!==F[0].length)throw new Error("First and last Position are not equivalent.");for(let O=0;O<F[F.length-1].length;O++)if(F[F.length-1][O]!==F[0][O])throw new Error("First and last Position are not equivalent.")}return Sm({type:"Polygon",coordinates:P},b,S)}function km(P,b={}){const S={type:"FeatureCollection"};return b.id&&(S.id=b.id),b.bbox&&(S.bbox=b.bbox),S.features=P,S}function gg(P,b="kilometers"){const S=mg[b];if(!S)throw new Error(b+" units is invalid");return P/S}function qf(P){return P%(2*Math.PI)*180/Math.PI}function Jp(P){return P%360*Math.PI/180}function Zf(P){return!isNaN(P)&&P!==null&&!Array.isArray(P)}function yg(P){return P!==null&&typeof P=="object"&&!Array.isArray(P)}function Tm(P){if(!P)throw new Error("coord is required");if(!Array.isArray(P)){if(P.type==="Feature"&&P.geometry!==null&&P.geometry.type==="Point")return[...P.geometry.coordinates];if(P.type==="Point")return[...P.coordinates]}if(Array.isArray(P)&&P.length>=2&&!Array.isArray(P[0])&&!Array.isArray(P[1]))return[...P];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function _g(P,b,S){if(!P)throw new Error("No featureCollection passed");if(!P||P.type!=="FeatureCollection")throw new Error("Invalid input to "+S+", FeatureCollection required");for(const z of P.features){if(!z||z.type!=="Feature"||!z.geometry)throw new Error("Invalid input to "+S+", Feature with geometry required");if(!z.geometry||z.geometry.type!==b)throw new Error("Invalid input to "+S+": must be a "+b+", given "+z.geometry.type)}}function vg(P){return P.type==="Feature"?P.geometry:P}function xg(P,b,S,z={}){const F=Tm(P),O=Jp(F[0]),I=Jp(F[1]),h=Jp(S),Y=gg(b,z.units),J=Math.asin(Math.sin(I)*Math.cos(Y)+Math.cos(I)*Math.sin(Y)*Math.cos(h)),he=O+Math.atan2(Math.sin(h)*Math.sin(Y)*Math.cos(I),Math.cos(Y)-Math.sin(I)*Math.sin(J)),N=qf(he),$=qf(J);return F[2]!==void 0?pd([N,$,F[2]],z.properties):pd([N,$],z.properties)}function Em(P,b,S){if(P!==null)for(var z,F,O,I,h,Y,J,he=0,N=0,$,fe=P.type,Ae=fe==="FeatureCollection",se=fe==="Feature",De=Ae?P.features.length:1,Le=0;Le<De;Le++){J=Ae?P.features[Le].geometry:se?P.geometry:P,$=J?J.type==="GeometryCollection":!1,h=$?J.geometries.length:1;for(var tt=0;tt<h;tt++){var Ge=0,rt=0;if(I=$?J.geometries[tt]:J,I!==null){Y=I.coordinates;var mt=I.type;switch(he=0,mt){case null:break;case"Point":if(b(Y,N,Le,Ge,rt)===!1)return!1;N++,Ge++;break;case"LineString":case"MultiPoint":for(z=0;z<Y.length;z++){if(b(Y[z],N,Le,Ge,rt)===!1)return!1;N++,mt==="MultiPoint"&&Ge++}mt==="LineString"&&Ge++;break;case"Polygon":case"MultiLineString":for(z=0;z<Y.length;z++){for(F=0;F<Y[z].length-he;F++){if(b(Y[z][F],N,Le,Ge,rt)===!1)return!1;N++}mt==="MultiLineString"&&Ge++,mt==="Polygon"&&rt++}mt==="Polygon"&&Ge++;break;case"MultiPolygon":for(z=0;z<Y.length;z++){for(rt=0,F=0;F<Y[z].length;F++){for(O=0;O<Y[z][F].length-he;O++){if(b(Y[z][F][O],N,Le,Ge,rt)===!1)return!1;N++}rt++}Ge++}break;case"GeometryCollection":for(z=0;z<I.geometries.length;z++)if(Em(I.geometries[z],b)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function fp(P,b={}){if(P.bbox!=null&&b.recompute!==!0)return P.bbox;const S=[1/0,1/0,-1/0,-1/0];return Em(P,z=>{S[0]>z[0]&&(S[0]=z[0]),S[1]>z[1]&&(S[1]=z[1]),S[2]<z[0]&&(S[2]=z[0]),S[3]<z[1]&&(S[3]=z[1])}),S}function wg(P,b={}){const S=Number(P[0]),z=Number(P[1]),F=Number(P[2]),O=Number(P[3]);if(P.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const I=[S,z];return gf([[I,[F,z],[F,O],[S,O],I]],b.properties,{bbox:P,id:b.id})}const El=11102230246251565e-32,Un=134217729,bg=(3+8*El)*El;function Qp(P,b,S,z,F){let O,I,h,Y,J=b[0],he=z[0],N=0,$=0;he>J==he>-J?(O=J,J=b[++N]):(O=he,he=z[++$]);let fe=0;if(N<P&&$<S)for(he>J==he>-J?(I=J+O,h=O-(I-J),J=b[++N]):(I=he+O,h=O-(I-he),he=z[++$]),O=I,h!==0&&(F[fe++]=h);N<P&&$<S;)he>J==he>-J?(I=O+J,Y=I-O,h=O-(I-Y)+(J-Y),J=b[++N]):(I=O+he,Y=I-O,h=O-(I-Y)+(he-Y),he=z[++$]),O=I,h!==0&&(F[fe++]=h);for(;N<P;)I=O+J,Y=I-O,h=O-(I-Y)+(J-Y),J=b[++N],O=I,h!==0&&(F[fe++]=h);for(;$<S;)I=O+he,Y=I-O,h=O-(I-Y)+(he-Y),he=z[++$],O=I,h!==0&&(F[fe++]=h);return(O!==0||fe===0)&&(F[fe++]=O),fe}function Sg(P,b){let S=b[0];for(let z=1;z<P;z++)S+=b[z];return S}function yd(P){return new Float64Array(P)}const kg=(3+16*El)*El,Tg=(2+12*El)*El,Eg=(9+64*El)*El*El,yh=yd(4),Gf=yd(8),Hf=yd(12),Wf=yd(16),ps=yd(4);function Ig(P,b,S,z,F,O,I){let h,Y,J,he,N,$,fe,Ae,se,De,Le,tt,Ge,rt,mt,pt,St,At;const Zt=P-F,nr=S-F,It=b-O,sr=z-O;rt=Zt*sr,$=Un*Zt,fe=$-($-Zt),Ae=Zt-fe,$=Un*sr,se=$-($-sr),De=sr-se,mt=Ae*De-(rt-fe*se-Ae*se-fe*De),pt=It*nr,$=Un*It,fe=$-($-It),Ae=It-fe,$=Un*nr,se=$-($-nr),De=nr-se,St=Ae*De-(pt-fe*se-Ae*se-fe*De),Le=mt-St,N=mt-Le,yh[0]=mt-(Le+N)+(N-St),tt=rt+Le,N=tt-rt,Ge=rt-(tt-N)+(Le-N),Le=Ge-pt,N=Ge-Le,yh[1]=Ge-(Le+N)+(N-pt),At=tt+Le,N=At-tt,yh[2]=tt-(At-N)+(Le-N),yh[3]=At;let Vt=Sg(4,yh),or=Tg*I;if(Vt>=or||-Vt>=or||(N=P-Zt,h=P-(Zt+N)+(N-F),N=S-nr,J=S-(nr+N)+(N-F),N=b-It,Y=b-(It+N)+(N-O),N=z-sr,he=z-(sr+N)+(N-O),h===0&&Y===0&&J===0&&he===0)||(or=Eg*I+bg*Math.abs(Vt),Vt+=Zt*he+sr*h-(It*J+nr*Y),Vt>=or||-Vt>=or))return Vt;rt=h*sr,$=Un*h,fe=$-($-h),Ae=h-fe,$=Un*sr,se=$-($-sr),De=sr-se,mt=Ae*De-(rt-fe*se-Ae*se-fe*De),pt=Y*nr,$=Un*Y,fe=$-($-Y),Ae=Y-fe,$=Un*nr,se=$-($-nr),De=nr-se,St=Ae*De-(pt-fe*se-Ae*se-fe*De),Le=mt-St,N=mt-Le,ps[0]=mt-(Le+N)+(N-St),tt=rt+Le,N=tt-rt,Ge=rt-(tt-N)+(Le-N),Le=Ge-pt,N=Ge-Le,ps[1]=Ge-(Le+N)+(N-pt),At=tt+Le,N=At-tt,ps[2]=tt-(At-N)+(Le-N),ps[3]=At;const Kr=Qp(4,yh,4,ps,Gf);rt=Zt*he,$=Un*Zt,fe=$-($-Zt),Ae=Zt-fe,$=Un*he,se=$-($-he),De=he-se,mt=Ae*De-(rt-fe*se-Ae*se-fe*De),pt=It*J,$=Un*It,fe=$-($-It),Ae=It-fe,$=Un*J,se=$-($-J),De=J-se,St=Ae*De-(pt-fe*se-Ae*se-fe*De),Le=mt-St,N=mt-Le,ps[0]=mt-(Le+N)+(N-St),tt=rt+Le,N=tt-rt,Ge=rt-(tt-N)+(Le-N),Le=Ge-pt,N=Ge-Le,ps[1]=Ge-(Le+N)+(N-pt),At=tt+Le,N=At-tt,ps[2]=tt-(At-N)+(Le-N),ps[3]=At;const Gr=Qp(Kr,Gf,4,ps,Hf);rt=h*he,$=Un*h,fe=$-($-h),Ae=h-fe,$=Un*he,se=$-($-he),De=he-se,mt=Ae*De-(rt-fe*se-Ae*se-fe*De),pt=Y*J,$=Un*Y,fe=$-($-Y),Ae=Y-fe,$=Un*J,se=$-($-J),De=J-se,St=Ae*De-(pt-fe*se-Ae*se-fe*De),Le=mt-St,N=mt-Le,ps[0]=mt-(Le+N)+(N-St),tt=rt+Le,N=tt-rt,Ge=rt-(tt-N)+(Le-N),Le=Ge-pt,N=Ge-Le,ps[1]=Ge-(Le+N)+(N-pt),At=tt+Le,N=At-tt,ps[2]=tt-(At-N)+(Le-N),ps[3]=At;const cr=Qp(Gr,Hf,4,ps,Wf);return Wf[cr-1]}function Pg(P,b,S,z,F,O){const I=(b-O)*(S-F),h=(P-F)*(z-O),Y=I-h,J=Math.abs(I+h);return Math.abs(Y)>=kg*J?Y:-Ig(P,b,S,z,F,O,J)}function Cg(P,b){var S,z,F=0,O,I,h,Y,J,he,N,$=P[0],fe=P[1],Ae=b.length;for(S=0;S<Ae;S++){z=0;var se=b[S],De=se.length-1;if(he=se[0],he[0]!==se[De][0]&&he[1]!==se[De][1])throw new Error("First and last coordinates in a ring must be the same");for(I=he[0]-$,h=he[1]-fe,z;z<De;z++){if(N=se[z+1],Y=N[0]-$,J=N[1]-fe,h===0&&J===0){if(Y<=0&&I>=0||I<=0&&Y>=0)return 0}else if(J>=0&&h<=0||J<=0&&h>=0){if(O=Pg(I,Y,h,J,0,0),O===0)return 0;(O>0&&J>0&&h<=0||O<0&&J<=0&&h>0)&&F++}he=N,h=J,I=Y}}return F%2!==0}function Xf(P,b,S={}){if(!P)throw new Error("point is required");if(!b)throw new Error("polygon is required");const z=Tm(P),F=vg(b),O=F.type,I=b.bbox;let h=F.coordinates;if(I&&Mg(z,I)===!1)return!1;O==="Polygon"&&(h=[h]);let Y=!1;for(var J=0;J<h.length;++J){const he=Cg(z,h[J]);if(he===0)return!S.ignoreBoundary;he&&(Y=!0)}return Y}function Mg(P,b){return b[0]<=P[0]&&b[1]<=P[1]&&b[2]>=P[0]&&b[3]>=P[1]}function Ag(P,b,S={}){const z=S.steps||64,F=S.properties?S.properties:!Array.isArray(P)&&P.type==="Feature"&&P.properties?P.properties:{},O=[];for(let I=0;I<z;I++)O.push(xg(P,b,I*-360/z,S).geometry.coordinates);return O.push(O[0]),gf([O],F)}function Im(P){const b={};return P&&Object.keys(P).forEach(S=>{const z=P[S];typeof z=="object"?z===null?b[S]=null:Array.isArray(z)?b[S]=z.map(F=>F):b[S]=Im(z):b[S]=z}),b}function Kf(P){return function(){return P}}function zg(P){return P[0]}function Dg(P){return P[1]}function mp(){this._=null}function wp(P){P.U=P.C=P.L=P.R=P.P=P.N=null}mp.prototype={constructor:mp,insert:function(P,b){var S,z,F;if(P){if(b.P=P,b.N=P.N,P.N&&(P.N.P=b),P.N=b,P.R){for(P=P.R;P.L;)P=P.L;P.L=b}else P.R=b;S=P}else this._?(P=Yf(this._),b.P=null,b.N=P,P.P=P.L=b,S=P):(b.P=b.N=null,this._=b,S=null);for(b.L=b.R=null,b.U=S,b.C=!0,P=b;S&&S.C;)z=S.U,S===z.L?(F=z.R,F&&F.C?(S.C=F.C=!1,z.C=!0,P=z):(P===S.R&&(ld(this,S),P=S,S=P.U),S.C=!1,z.C=!0,ud(this,z))):(F=z.L,F&&F.C?(S.C=F.C=!1,z.C=!0,P=z):(P===S.L&&(ud(this,S),P=S,S=P.U),S.C=!1,z.C=!0,ld(this,z))),S=P.U;this._.C=!1},remove:function(P){P.N&&(P.N.P=P.P),P.P&&(P.P.N=P.N),P.N=P.P=null;var b=P.U,S,z=P.L,F=P.R,O,I;if(z?F?O=Yf(F):O=z:O=F,b?b.L===P?b.L=O:b.R=O:this._=O,z&&F?(I=O.C,O.C=P.C,O.L=z,z.U=O,O!==F?(b=O.U,O.U=P.U,P=O.R,b.L=P,O.R=F,F.U=O):(O.U=b,b=O,P=O.R)):(I=P.C,P=O),P&&(P.U=b),!I){if(P&&P.C){P.C=!1;return}do{if(P===this._)break;if(P===b.L){if(S=b.R,S.C&&(S.C=!1,b.C=!0,ld(this,b),S=b.R),S.L&&S.L.C||S.R&&S.R.C){(!S.R||!S.R.C)&&(S.L.C=!1,S.C=!0,ud(this,S),S=b.R),S.C=b.C,b.C=S.R.C=!1,ld(this,b),P=this._;break}}else if(S=b.L,S.C&&(S.C=!1,b.C=!0,ud(this,b),S=b.L),S.L&&S.L.C||S.R&&S.R.C){(!S.L||!S.L.C)&&(S.R.C=!1,S.C=!0,ld(this,S),S=b.L),S.C=b.C,b.C=S.L.C=!1,ud(this,b),P=this._;break}S.C=!0,P=b,b=b.U}while(!P.C);P&&(P.C=!1)}}};function ld(P,b){var S=b,z=b.R,F=S.U;F?F.L===S?F.L=z:F.R=z:P._=z,z.U=F,S.U=z,S.R=z.L,S.R&&(S.R.U=S),z.L=S}function ud(P,b){var S=b,z=b.L,F=S.U;F?F.L===S?F.L=z:F.R=z:P._=z,z.U=F,S.U=z,S.L=z.R,S.L&&(S.L.U=S),z.R=S}function Yf(P){for(;P.L;)P=P.L;return P}function dd(P,b,S,z){var F=[null,null],O=qn.push(F)-1;return F.left=P,F.right=b,S&&gp(F,P,b,S),z&&gp(F,b,P,z),so[P.index].halfedges.push(O),so[b.index].halfedges.push(O),F}function cd(P,b,S){var z=[b,S];return z.left=P,z}function gp(P,b,S,z){!P[0]&&!P[1]?(P[0]=z,P.left=b,P.right=S):P.left===S?P[1]=z:P[0]=z}function Lg(P,b,S,z,F){var O=P[0],I=P[1],h=O[0],Y=O[1],J=I[0],he=I[1],N=0,$=1,fe=J-h,Ae=he-Y,se;if(se=b-h,!(!fe&&se>0)){if(se/=fe,fe<0){if(se<N)return;se<$&&($=se)}else if(fe>0){if(se>$)return;se>N&&(N=se)}if(se=z-h,!(!fe&&se<0)){if(se/=fe,fe<0){if(se>$)return;se>N&&(N=se)}else if(fe>0){if(se<N)return;se<$&&($=se)}if(se=S-Y,!(!Ae&&se>0)){if(se/=Ae,Ae<0){if(se<N)return;se<$&&($=se)}else if(Ae>0){if(se>$)return;se>N&&(N=se)}if(se=F-Y,!(!Ae&&se<0)){if(se/=Ae,Ae<0){if(se>$)return;se>N&&(N=se)}else if(Ae>0){if(se<N)return;se<$&&($=se)}return!(N>0)&&!($<1)||(N>0&&(P[0]=[h+N*fe,Y+N*Ae]),$<1&&(P[1]=[h+$*fe,Y+$*Ae])),!0}}}}}function Rg(P,b,S,z,F){var O=P[1];if(O)return!0;var I=P[0],h=P.left,Y=P.right,J=h[0],he=h[1],N=Y[0],$=Y[1],fe=(J+N)/2,Ae=(he+$)/2,se,De;if($===he){if(fe<b||fe>=z)return;if(J>N){if(!I)I=[fe,S];else if(I[1]>=F)return;O=[fe,F]}else{if(!I)I=[fe,F];else if(I[1]<S)return;O=[fe,S]}}else if(se=(J-N)/($-he),De=Ae-se*fe,se<-1||se>1)if(J>N){if(!I)I=[(S-De)/se,S];else if(I[1]>=F)return;O=[(F-De)/se,F]}else{if(!I)I=[(F-De)/se,F];else if(I[1]<S)return;O=[(S-De)/se,S]}else if(he<$){if(!I)I=[b,se*b+De];else if(I[0]>=z)return;O=[z,se*z+De]}else{if(!I)I=[z,se*z+De];else if(I[0]<b)return;O=[b,se*b+De]}return P[0]=I,P[1]=O,!0}function Fg(P,b,S,z){for(var F=qn.length,O;F--;)(!Rg(O=qn[F],P,b,S,z)||!Lg(O,P,b,S,z)||!(Math.abs(O[0][0]-O[1][0])>Zr||Math.abs(O[0][1]-O[1][1])>Zr))&&delete qn[F]}function Bg(P){return so[P.index]={site:P,halfedges:[]}}function Og(P,b){var S=P.site,z=b.left,F=b.right;return S===F&&(F=z,z=S),F?Math.atan2(F[1]-z[1],F[0]-z[0]):(S===z?(z=b[1],F=b[0]):(z=b[0],F=b[1]),Math.atan2(z[0]-F[0],F[1]-z[1]))}function Pm(P,b){return b[+(b.left!==P.site)]}function Ng(P,b){return b[+(b.left===P.site)]}function Vg(){for(var P=0,b=so.length,S,z,F,O;P<b;++P)if((S=so[P])&&(O=(z=S.halfedges).length)){var I=new Array(O),h=new Array(O);for(F=0;F<O;++F)I[F]=F,h[F]=Og(S,qn[z[F]]);for(I.sort(function(Y,J){return h[J]-h[Y]}),F=0;F<O;++F)h[F]=z[I[F]];for(F=0;F<O;++F)z[F]=h[F]}}function jg(P,b,S,z){var F=so.length,O,I,h,Y,J,he,N,$,fe,Ae,se,De,Le=!0;for(O=0;O<F;++O)if(I=so[O]){for(h=I.site,J=I.halfedges,Y=J.length;Y--;)qn[J[Y]]||J.splice(Y,1);for(Y=0,he=J.length;Y<he;)Ae=Ng(I,qn[J[Y]]),se=Ae[0],De=Ae[1],N=Pm(I,qn[J[++Y%he]]),$=N[0],fe=N[1],(Math.abs(se-$)>Zr||Math.abs(De-fe)>Zr)&&(J.splice(Y,0,qn.push(cd(h,Ae,Math.abs(se-P)<Zr&&z-De>Zr?[P,Math.abs($-P)<Zr?fe:z]:Math.abs(De-z)<Zr&&S-se>Zr?[Math.abs(fe-z)<Zr?$:S,z]:Math.abs(se-S)<Zr&&De-b>Zr?[S,Math.abs($-S)<Zr?fe:b]:Math.abs(De-b)<Zr&&se-P>Zr?[Math.abs(fe-b)<Zr?$:P,b]:null))-1),++he);he&&(Le=!1)}if(Le){var tt,Ge,rt,mt=1/0;for(O=0,Le=null;O<F;++O)(I=so[O])&&(h=I.site,tt=h[0]-P,Ge=h[1]-b,rt=tt*tt+Ge*Ge,rt<mt&&(mt=rt,Le=I));if(Le){var pt=[P,b],St=[P,z],At=[S,z],Zt=[S,b];Le.halfedges.push(qn.push(cd(h=Le.site,pt,St))-1,qn.push(cd(h,St,At))-1,qn.push(cd(h,At,Zt))-1,qn.push(cd(h,Zt,pt))-1)}}for(O=0;O<F;++O)(I=so[O])&&(I.halfedges.length||delete so[O])}var Cm=[],yf;function Ug(){wp(this),this.x=this.y=this.arc=this.site=this.cy=null}function vh(P){var b=P.P,S=P.N;if(!(!b||!S)){var z=b.site,F=P.site,O=S.site;if(z!==O){var I=F[0],h=F[1],Y=z[0]-I,J=z[1]-h,he=O[0]-I,N=O[1]-h,$=2*(Y*N-J*he);if(!($>=-1e-12)){var fe=Y*Y+J*J,Ae=he*he+N*N,se=(N*fe-J*Ae)/$,De=(Y*Ae-he*fe)/$,Le=Cm.pop()||new Ug;Le.arc=P,Le.site=F,Le.x=se+I,Le.y=(Le.cy=De+h)+Math.sqrt(se*se+De*De),P.circle=Le;for(var tt=null,Ge=fd._;Ge;)if(Le.y<Ge.y||Le.y===Ge.y&&Le.x<=Ge.x)if(Ge.L)Ge=Ge.L;else{tt=Ge.P;break}else if(Ge.R)Ge=Ge.R;else{tt=Ge;break}fd.insert(tt,Le),tt||(yf=Le)}}}}function xh(P){var b=P.circle;b&&(b.P||(yf=b.N),fd.remove(b),Cm.push(b),wp(b),P.circle=null)}var Mm=[];function $g(){wp(this),this.edge=this.site=this.circle=null}function Jf(P){var b=Mm.pop()||new $g;return b.site=P,b}function ef(P){xh(P),wh.remove(P),Mm.push(P),wp(P)}function qg(P){var b=P.circle,S=b.x,z=b.cy,F=[S,z],O=P.P,I=P.N,h=[P];ef(P);for(var Y=O;Y.circle&&Math.abs(S-Y.circle.x)<Zr&&Math.abs(z-Y.circle.cy)<Zr;)O=Y.P,h.unshift(Y),ef(Y),Y=O;h.unshift(Y),xh(Y);for(var J=I;J.circle&&Math.abs(S-J.circle.x)<Zr&&Math.abs(z-J.circle.cy)<Zr;)I=J.N,h.push(J),ef(J),J=I;h.push(J),xh(J);var he=h.length,N;for(N=1;N<he;++N)J=h[N],Y=h[N-1],gp(J.edge,Y.site,J.site,F);Y=h[0],J=h[he-1],J.edge=dd(Y.site,J.site,null,F),vh(Y),vh(J)}function Zg(P){for(var b=P[0],S=P[1],z,F,O,I,h=wh._;h;)if(O=Am(h,S)-b,O>Zr)h=h.L;else if(I=b-Gg(h,S),I>Zr){if(!h.R){z=h;break}h=h.R}else{O>-Zr?(z=h.P,F=h):I>-Zr?(z=h,F=h.N):z=F=h;break}Bg(P);var Y=Jf(P);if(wh.insert(z,Y),!(!z&&!F)){if(z===F){xh(z),F=Jf(z.site),wh.insert(Y,F),Y.edge=F.edge=dd(z.site,Y.site),vh(z),vh(F);return}if(!F){Y.edge=dd(z.site,Y.site);return}xh(z),xh(F);var J=z.site,he=J[0],N=J[1],$=P[0]-he,fe=P[1]-N,Ae=F.site,se=Ae[0]-he,De=Ae[1]-N,Le=2*($*De-fe*se),tt=$*$+fe*fe,Ge=se*se+De*De,rt=[(De*tt-fe*Ge)/Le+he,($*Ge-se*tt)/Le+N];gp(F.edge,J,Ae,rt),Y.edge=dd(J,P,null,rt),F.edge=dd(P,Ae,null,rt),vh(z),vh(F)}}function Am(P,b){var S=P.site,z=S[0],F=S[1],O=F-b;if(!O)return z;var I=P.P;if(!I)return-1/0;S=I.site;var h=S[0],Y=S[1],J=Y-b;if(!J)return h;var he=h-z,N=1/O-1/J,$=he/J;return N?(-$+Math.sqrt($*$-2*N*(he*he/(-2*J)-Y+J/2+F-O/2)))/N+z:(z+h)/2}function Gg(P,b){var S=P.N;if(S)return Am(S,b);var z=P.site;return z[1]===b?z[0]:1/0}var Zr=1e-6,wh,so,fd,qn;function Hg(P,b,S){return(P[0]-S[0])*(b[1]-P[1])-(P[0]-b[0])*(S[1]-P[1])}function Wg(P,b){return b[1]-P[1]||b[0]-P[0]}function cf(P,b){var S=P.sort(Wg).pop(),z,F,O;for(qn=[],so=new Array(P.length),wh=new mp,fd=new mp;;)if(O=yf,S&&(!O||S[1]<O.y||S[1]===O.y&&S[0]<O.x))(S[0]!==z||S[1]!==F)&&(Zg(S),z=S[0],F=S[1]),S=P.pop();else if(O)qg(O.arc);else break;if(Vg(),b){var I=+b[0][0],h=+b[0][1],Y=+b[1][0],J=+b[1][1];Fg(I,h,Y,J),jg(I,h,Y,J)}this.edges=qn,this.cells=so,wh=fd=qn=so=null}cf.prototype={constructor:cf,polygons:function(){var P=this.edges;return this.cells.map(function(b){var S=b.halfedges.map(function(z){return Pm(b,P[z])});return S.data=b.site.data,S})},triangles:function(){var P=[],b=this.edges;return this.cells.forEach(function(S,z){if(h=(O=S.halfedges).length)for(var F=S.site,O,I=-1,h,Y,J=b[O[h-1]],he=J.left===F?J.right:J.left;++I<h;)Y=he,J=b[O[I]],he=J.left===F?J.right:J.left,Y&&he&&z<Y.index&&z<he.index&&Hg(F,Y,he)<0&&P.push([F.data,Y.data,he.data])}),P},links:function(){return this.edges.filter(function(P){return P.right}).map(function(P){return{source:P.left.data,target:P.right.data}})},find:function(P,b,S){for(var z=this,F,O=z._found||0,I=z.cells.length,h;!(h=z.cells[O]);)if(++O>=I)return null;var Y=P-h.site[0],J=b-h.site[1],he=Y*Y+J*J;do h=z.cells[F=O],O=null,h.halfedges.forEach(function(N){var $=z.edges[N],fe=$.left;if(!((fe===h.site||!fe)&&!(fe=$.right))){var Ae=P-fe[0],se=b-fe[1],De=Ae*Ae+se*se;De<he&&(he=De,O=fe.index)}});while(O!==null);return z._found=F,S==null||he<=S*S?h.site:null}};function Xg(){var P=zg,b=Dg,S=null;function z(F){return new cf(F.map(function(O,I){var h=[Math.round(P(O,I,F)/Zr)*Zr,Math.round(b(O,I,F)/Zr)*Zr];return h.index=I,h.data=O,h}),S)}return z.polygons=function(F){return z(F).polygons()},z.links=function(F){return z(F).links()},z.triangles=function(F){return z(F).triangles()},z.x=function(F){return arguments.length?(P=typeof F=="function"?F:Kf(+F),z):P},z.y=function(F){return arguments.length?(b=typeof F=="function"?F:Kf(+F),z):b},z.extent=function(F){return arguments.length?(S=F==null?null:[[+F[0][0],+F[0][1]],[+F[1][0],+F[1][1]]],z):S&&[[S[0][0],S[0][1]],[S[1][0],S[1][1]]]},z.size=function(F){return arguments.length?(S=F==null?null:[[0,0],[+F[0],+F[1]]],z):S&&[S[1][0]-S[0][0],S[1][1]-S[0][1]]},z}function Kg(P){return P=P.slice(),P.push(P[0]),gf([P])}function Yg(P,b){if(b=b||{},!yg(b))throw new Error("options is invalid");const S=b.bbox||[-180,-85,180,85];if(!P)throw new Error("points is required");if(!Array.isArray(S))throw new Error("bbox is invalid");return _g(P,"Point","points"),km(Xg().x(z=>z.geometry.coordinates[0]).y(z=>z.geometry.coordinates[1]).extent([[S[0],S[1]],[S[2],S[3]]]).polygons(P.features).map(function(z,F){return Object.assign(Kg(z),{properties:Im(P.features[F].properties)})}))}const Jg={},Qf=P=>{let b;const S=new Set,z=(he,N)=>{const $=typeof he=="function"?he(b):he;if(!Object.is($,b)){const fe=b;b=N??(typeof $!="object"||$===null)?$:Object.assign({},b,$),S.forEach(Ae=>Ae(b,fe))}},F=()=>b,Y={setState:z,getState:F,getInitialState:()=>J,subscribe:he=>(S.add(he),()=>S.delete(he)),destroy:()=>{(Jg?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),S.clear()}},J=b=P(z,F,Y);return Y},Qg=P=>P?Qf(P):Qf;var tf={exports:{}},rf={},nf={exports:{}},sf={};var em;function ey(){if(em)return sf;em=1;var P=gd();function b(N,$){return N===$&&(N!==0||1/N===1/$)||N!==N&&$!==$}var S=typeof Object.is=="function"?Object.is:b,z=P.useState,F=P.useEffect,O=P.useLayoutEffect,I=P.useDebugValue;function h(N,$){var fe=$(),Ae=z({inst:{value:fe,getSnapshot:$}}),se=Ae[0].inst,De=Ae[1];return O(function(){se.value=fe,se.getSnapshot=$,Y(se)&&De({inst:se})},[N,fe,$]),F(function(){return Y(se)&&De({inst:se}),N(function(){Y(se)&&De({inst:se})})},[N]),I(fe),fe}function Y(N){var $=N.getSnapshot;N=N.value;try{var fe=$();return!S(N,fe)}catch{return!0}}function J(N,$){return $()}var he=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?J:h;return sf.useSyncExternalStore=P.useSyncExternalStore!==void 0?P.useSyncExternalStore:he,sf}var tm;function ty(){return tm||(tm=1,nf.exports=ey()),nf.exports}var rm;function ry(){if(rm)return rf;rm=1;var P=gd(),b=ty();function S(J,he){return J===he&&(J!==0||1/J===1/he)||J!==J&&he!==he}var z=typeof Object.is=="function"?Object.is:S,F=b.useSyncExternalStore,O=P.useRef,I=P.useEffect,h=P.useMemo,Y=P.useDebugValue;return rf.useSyncExternalStoreWithSelector=function(J,he,N,$,fe){var Ae=O(null);if(Ae.current===null){var se={hasValue:!1,value:null};Ae.current=se}else se=Ae.current;Ae=h(function(){function Le(pt){if(!tt){if(tt=!0,Ge=pt,pt=$(pt),fe!==void 0&&se.hasValue){var St=se.value;if(fe(St,pt))return rt=St}return rt=pt}if(St=rt,z(Ge,pt))return St;var At=$(pt);return fe!==void 0&&fe(St,At)?(Ge=pt,St):(Ge=pt,rt=At)}var tt=!1,Ge,rt,mt=N===void 0?null:N;return[function(){return Le(he())},mt===null?void 0:function(){return Le(mt())}]},[he,N,$,fe]);var De=F(J,Ae[0],Ae[1]);return I(function(){se.hasValue=!0,se.value=De},[De]),Y(De),De},rf}var im;function iy(){return im||(im=1,tf.exports=ry()),tf.exports}var ny=iy();const sy=xp(ny),zm={},{useDebugValue:oy}=wm,{useSyncExternalStoreWithSelector:ay}=sy;let nm=!1;const ly=P=>P;function uy(P,b=ly,S){(zm?"production":void 0)!=="production"&&S&&!nm&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),nm=!0);const z=ay(P.subscribe,P.getState,P.getServerState||P.getInitialState,b,S);return oy(z),z}const sm=P=>{(zm?"production":void 0)!=="production"&&typeof P!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const b=typeof P=="function"?Qg(P):P,S=(z,F)=>uy(b,z,F);return Object.assign(S,b),S},cy=P=>P?sm(P):sm,hy={features:[{type:"Feature",properties:{name:"United Kingdom",iso_a2:"GB"},geometry:{type:"MultiPolygon",coordinates:[[[[-7.57,49.96],[-6,50],[-5.2,50.2],[-4.4,50.3],[-3.4,50.6],[-2,50.8],[-1.1,50.9],[.4,51],[1.6,52],[1.8,53],[1.4,54.2],[.2,55.1],[-1.3,55.8],[-3.2,56.4],[-4.6,57.4],[-5.5,58.2],[-6,58.6],[-6.8,58.2],[-7.2,57],[-7,55],[-7.5,53],[-7,51.5],[-7.57,49.96]]]]}},{type:"Feature",properties:{name:"United States",iso_a2:"US"},geometry:{type:"Polygon",coordinates:[[[-124.8,24.4],[-66.9,24.4],[-66.9,49.4],[-124.8,49.4],[-124.8,24.4]]]}}]};class mu{constructor(b,S){this.next=null,this.key=b,this.data=S,this.left=null,this.right=null}}function dy(P,b){return P>b?1:P<b?-1:0}function du(P,b,S){const z=new mu(null,null);let F=z,O=z;for(;;){const I=S(P,b.key);if(I<0){if(b.left===null)break;if(S(P,b.left.key)<0){const h=b.left;if(b.left=h.right,h.right=b,b=h,b.left===null)break}O.left=b,O=b,b=b.left}else if(I>0){if(b.right===null)break;if(S(P,b.right.key)>0){const h=b.right;if(b.right=h.left,h.left=b,b=h,b.right===null)break}F.right=b,F=b,b=b.right}else break}return F.right=b.left,O.left=b.right,b.left=z.right,b.right=z.left,b}function of(P,b,S,z){const F=new mu(P,b);if(S===null)return F.left=F.right=null,F;S=du(P,S,z);const O=z(P,S.key);return O<0?(F.left=S.left,F.right=S,S.left=null):O>=0&&(F.right=S.right,F.left=S,S.right=null),F}function om(P,b,S){let z=null,F=null;if(b){b=du(P,b,S);const O=S(b.key,P);O===0?(z=b.left,F=b.right):O<0?(F=b.right,b.right=null,z=b):(z=b.left,b.left=null,F=b)}return{left:z,right:F}}function py(P,b,S){return b===null?P:(P===null||(b=du(P.key,b,S),b.left=P),b)}function hf(P,b,S,z,F){if(P){z(`${b}${S?" ":" "}${F(P)}
`);const O=b+(S?"    ":"   ");P.left&&hf(P.left,O,!1,z,F),P.right&&hf(P.right,O,!0,z,F)}}class _f{constructor(b=dy){this._root=null,this._size=0,this._comparator=b}insert(b,S){return this._size++,this._root=of(b,S,this._root,this._comparator)}add(b,S){const z=new mu(b,S);this._root===null&&(z.left=z.right=null,this._size++,this._root=z);const F=this._comparator,O=du(b,this._root,F),I=F(b,O.key);return I===0?this._root=O:(I<0?(z.left=O.left,z.right=O,O.left=null):I>0&&(z.right=O.right,z.left=O,O.right=null),this._size++,this._root=z),this._root}remove(b){this._root=this._remove(b,this._root,this._comparator)}_remove(b,S,z){let F;return S===null?null:(S=du(b,S,z),z(b,S.key)===0?(S.left===null?F=S.right:(F=du(b,S.left,z),F.right=S.right),this._size--,F):S)}pop(){let b=this._root;if(b){for(;b.left;)b=b.left;return this._root=du(b.key,this._root,this._comparator),this._root=this._remove(b.key,this._root,this._comparator),{key:b.key,data:b.data}}return null}findStatic(b){let S=this._root;const z=this._comparator;for(;S;){const F=z(b,S.key);if(F===0)return S;F<0?S=S.left:S=S.right}return null}find(b){return this._root&&(this._root=du(b,this._root,this._comparator),this._comparator(b,this._root.key)!==0)?null:this._root}contains(b){let S=this._root;const z=this._comparator;for(;S;){const F=z(b,S.key);if(F===0)return!0;F<0?S=S.left:S=S.right}return!1}forEach(b,S){let z=this._root;const F=[];let O=!1;for(;!O;)z!==null?(F.push(z),z=z.left):F.length!==0?(z=F.pop(),b.call(S,z),z=z.right):O=!0;return this}range(b,S,z,F){const O=[],I=this._comparator;let h=this._root,Y;for(;O.length!==0||h;)if(h)O.push(h),h=h.left;else{if(h=O.pop(),Y=I(h.key,S),Y>0)break;if(I(h.key,b)>=0&&z.call(F,h))return this;h=h.right}return this}keys(){const b=[];return this.forEach(({key:S})=>{b.push(S)}),b}values(){const b=[];return this.forEach(({data:S})=>{b.push(S)}),b}min(){return this._root?this.minNode(this._root).key:null}max(){return this._root?this.maxNode(this._root).key:null}minNode(b=this._root){if(b)for(;b.left;)b=b.left;return b}maxNode(b=this._root){if(b)for(;b.right;)b=b.right;return b}at(b){let S=this._root,z=!1,F=0;const O=[];for(;!z;)if(S)O.push(S),S=S.left;else if(O.length>0){if(S=O.pop(),F===b)return S;F++,S=S.right}else z=!0;return null}next(b){let S=this._root,z=null;if(b.right){for(z=b.right;z.left;)z=z.left;return z}const F=this._comparator;for(;S;){const O=F(b.key,S.key);if(O===0)break;O<0?(z=S,S=S.left):S=S.right}return z}prev(b){let S=this._root,z=null;if(b.left!==null){for(z=b.left;z.right;)z=z.right;return z}const F=this._comparator;for(;S;){const O=F(b.key,S.key);if(O===0)break;O<0?S=S.left:(z=S,S=S.right)}return z}clear(){return this._root=null,this._size=0,this}toList(){return my(this._root)}load(b,S=[],z=!1){let F=b.length;const O=this._comparator;if(z&&ff(b,S,0,F-1,O),this._root===null)this._root=df(b,S,0,F),this._size=F;else{const I=gy(this.toList(),fy(b,S),O);F=this._size+F,this._root=pf({head:I},0,F)}return this}isEmpty(){return this._root===null}get size(){return this._size}get root(){return this._root}toString(b=S=>String(S.key)){const S=[];return hf(this._root,"",!0,z=>S.push(z),b),S.join("")}update(b,S,z){const F=this._comparator;let{left:O,right:I}=om(b,this._root,F);F(b,S)<0?I=of(S,z,I,F):O=of(S,z,O,F),this._root=py(O,I,F)}split(b){return om(b,this._root,this._comparator)}*[Symbol.iterator](){let b=this._root;const S=[];let z=!1;for(;!z;)b!==null?(S.push(b),b=b.left):S.length!==0?(b=S.pop(),yield b,b=b.right):z=!0}}function df(P,b,S,z){const F=z-S;if(F>0){const O=S+Math.floor(F/2),I=P[O],h=b[O],Y=new mu(I,h);return Y.left=df(P,b,S,O),Y.right=df(P,b,O+1,z),Y}return null}function fy(P,b){const S=new mu(null,null);let z=S;for(let F=0;F<P.length;F++)z=z.next=new mu(P[F],b[F]);return z.next=null,S.next}function my(P){let b=P;const S=[];let z=!1;const F=new mu(null,null);let O=F;for(;!z;)b?(S.push(b),b=b.left):S.length>0?(b=O=O.next=S.pop(),b=b.right):z=!0;return O.next=null,F.next}function pf(P,b,S){const z=S-b;if(z>0){const F=b+Math.floor(z/2),O=pf(P,b,F),I=P.head;return I.left=O,P.head=P.head.next,I.right=pf(P,F+1,S),I}return null}function gy(P,b,S){const z=new mu(null,null);let F=z,O=P,I=b;for(;O!==null&&I!==null;)S(O.key,I.key)<0?(F.next=O,O=O.next):(F.next=I,I=I.next),F=F.next;return O!==null?F.next=O:I!==null&&(F.next=I),z.next}function ff(P,b,S,z,F){if(S>=z)return;const O=P[S+z>>1];let I=S-1,h=z+1;for(;;){do I++;while(F(P[I],O)<0);do h--;while(F(P[h],O)>0);if(I>=h)break;let Y=P[I];P[I]=P[h],P[h]=Y,Y=b[I],b[I]=b[h],b[h]=Y}ff(P,b,S,h,F),ff(P,b,h+1,z,F)}const Il=11102230246251565e-32,$n=134217729,yy=(3+8*Il)*Il;function af(P,b,S,z,F){let O,I,h,Y,J=b[0],he=z[0],N=0,$=0;he>J==he>-J?(O=J,J=b[++N]):(O=he,he=z[++$]);let fe=0;if(N<P&&$<S)for(he>J==he>-J?(I=J+O,h=O-(I-J),J=b[++N]):(I=he+O,h=O-(I-he),he=z[++$]),O=I,h!==0&&(F[fe++]=h);N<P&&$<S;)he>J==he>-J?(I=O+J,Y=I-O,h=O-(I-Y)+(J-Y),J=b[++N]):(I=O+he,Y=I-O,h=O-(I-Y)+(he-Y),he=z[++$]),O=I,h!==0&&(F[fe++]=h);for(;N<P;)I=O+J,Y=I-O,h=O-(I-Y)+(J-Y),J=b[++N],O=I,h!==0&&(F[fe++]=h);for(;$<S;)I=O+he,Y=I-O,h=O-(I-Y)+(he-Y),he=z[++$],O=I,h!==0&&(F[fe++]=h);return(O!==0||fe===0)&&(F[fe++]=O),fe}function _y(P,b){let S=b[0];for(let z=1;z<P;z++)S+=b[z];return S}function _d(P){return new Float64Array(P)}const vy=(3+16*Il)*Il,xy=(2+12*Il)*Il,wy=(9+64*Il)*Il*Il,_h=_d(4),am=_d(8),lm=_d(12),um=_d(16),fs=_d(4);function by(P,b,S,z,F,O,I){let h,Y,J,he,N,$,fe,Ae,se,De,Le,tt,Ge,rt,mt,pt,St,At;const Zt=P-F,nr=S-F,It=b-O,sr=z-O;rt=Zt*sr,$=$n*Zt,fe=$-($-Zt),Ae=Zt-fe,$=$n*sr,se=$-($-sr),De=sr-se,mt=Ae*De-(rt-fe*se-Ae*se-fe*De),pt=It*nr,$=$n*It,fe=$-($-It),Ae=It-fe,$=$n*nr,se=$-($-nr),De=nr-se,St=Ae*De-(pt-fe*se-Ae*se-fe*De),Le=mt-St,N=mt-Le,_h[0]=mt-(Le+N)+(N-St),tt=rt+Le,N=tt-rt,Ge=rt-(tt-N)+(Le-N),Le=Ge-pt,N=Ge-Le,_h[1]=Ge-(Le+N)+(N-pt),At=tt+Le,N=At-tt,_h[2]=tt-(At-N)+(Le-N),_h[3]=At;let Vt=_y(4,_h),or=xy*I;if(Vt>=or||-Vt>=or||(N=P-Zt,h=P-(Zt+N)+(N-F),N=S-nr,J=S-(nr+N)+(N-F),N=b-It,Y=b-(It+N)+(N-O),N=z-sr,he=z-(sr+N)+(N-O),h===0&&Y===0&&J===0&&he===0)||(or=wy*I+yy*Math.abs(Vt),Vt+=Zt*he+sr*h-(It*J+nr*Y),Vt>=or||-Vt>=or))return Vt;rt=h*sr,$=$n*h,fe=$-($-h),Ae=h-fe,$=$n*sr,se=$-($-sr),De=sr-se,mt=Ae*De-(rt-fe*se-Ae*se-fe*De),pt=Y*nr,$=$n*Y,fe=$-($-Y),Ae=Y-fe,$=$n*nr,se=$-($-nr),De=nr-se,St=Ae*De-(pt-fe*se-Ae*se-fe*De),Le=mt-St,N=mt-Le,fs[0]=mt-(Le+N)+(N-St),tt=rt+Le,N=tt-rt,Ge=rt-(tt-N)+(Le-N),Le=Ge-pt,N=Ge-Le,fs[1]=Ge-(Le+N)+(N-pt),At=tt+Le,N=At-tt,fs[2]=tt-(At-N)+(Le-N),fs[3]=At;const Kr=af(4,_h,4,fs,am);rt=Zt*he,$=$n*Zt,fe=$-($-Zt),Ae=Zt-fe,$=$n*he,se=$-($-he),De=he-se,mt=Ae*De-(rt-fe*se-Ae*se-fe*De),pt=It*J,$=$n*It,fe=$-($-It),Ae=It-fe,$=$n*J,se=$-($-J),De=J-se,St=Ae*De-(pt-fe*se-Ae*se-fe*De),Le=mt-St,N=mt-Le,fs[0]=mt-(Le+N)+(N-St),tt=rt+Le,N=tt-rt,Ge=rt-(tt-N)+(Le-N),Le=Ge-pt,N=Ge-Le,fs[1]=Ge-(Le+N)+(N-pt),At=tt+Le,N=At-tt,fs[2]=tt-(At-N)+(Le-N),fs[3]=At;const Gr=af(Kr,am,4,fs,lm);rt=h*he,$=$n*h,fe=$-($-h),Ae=h-fe,$=$n*he,se=$-($-he),De=he-se,mt=Ae*De-(rt-fe*se-Ae*se-fe*De),pt=Y*J,$=$n*Y,fe=$-($-Y),Ae=Y-fe,$=$n*J,se=$-($-J),De=J-se,St=Ae*De-(pt-fe*se-Ae*se-fe*De),Le=mt-St,N=mt-Le,fs[0]=mt-(Le+N)+(N-St),tt=rt+Le,N=tt-rt,Ge=rt-(tt-N)+(Le-N),Le=Ge-pt,N=Ge-Le,fs[1]=Ge-(Le+N)+(N-pt),At=tt+Le,N=At-tt,fs[2]=tt-(At-N)+(Le-N),fs[3]=At;const cr=af(Gr,lm,4,fs,um);return um[cr-1]}function Sy(P,b,S,z,F,O){const I=(b-O)*(S-F),h=(P-F)*(z-O),Y=I-h,J=Math.abs(I+h);return Math.abs(Y)>=vy*J?Y:-by(P,b,S,z,F,O,J)}var Dm={};const hd=(P,b)=>P.ll.x<=b.x&&b.x<=P.ur.x&&P.ll.y<=b.y&&b.y<=P.ur.y,mf=(P,b)=>{if(b.ur.x<P.ll.x||P.ur.x<b.ll.x||b.ur.y<P.ll.y||P.ur.y<b.ll.y)return null;const S=P.ll.x<b.ll.x?b.ll.x:P.ll.x,z=P.ur.x<b.ur.x?P.ur.x:b.ur.x,F=P.ll.y<b.ll.y?b.ll.y:P.ll.y,O=P.ur.y<b.ur.y?P.ur.y:b.ur.y;return{ll:{x:S,y:F},ur:{x:z,y:O}}};let pu=Number.EPSILON;pu===void 0&&(pu=Math.pow(2,-52));const ky=pu*pu,cm=(P,b)=>{if(-pu<P&&P<pu&&-pu<b&&b<pu)return 0;const S=P-b;return S*S<ky*P*b?0:P<b?-1:1};class Ty{constructor(){this.reset()}reset(){this.xRounder=new hm,this.yRounder=new hm}round(b,S){return{x:this.xRounder.round(b),y:this.yRounder.round(S)}}}class hm{constructor(){this.tree=new _f,this.round(0)}round(b){const S=this.tree.add(b),z=this.tree.prev(S);if(z!==null&&cm(S.key,z.key)===0)return this.tree.remove(b),z.key;const F=this.tree.next(S);return F!==null&&cm(S.key,F.key)===0?(this.tree.remove(b),F.key):b}}const md=new Ty,pp=(P,b)=>P.x*b.y-P.y*b.x,Lm=(P,b)=>P.x*b.x+P.y*b.y,dm=(P,b,S)=>{const z=Sy(P.x,P.y,b.x,b.y,S.x,S.y);return z>0?-1:z<0?1:0},yp=P=>Math.sqrt(Lm(P,P)),Ey=(P,b,S)=>{const z={x:b.x-P.x,y:b.y-P.y},F={x:S.x-P.x,y:S.y-P.y};return pp(F,z)/yp(F)/yp(z)},Iy=(P,b,S)=>{const z={x:b.x-P.x,y:b.y-P.y},F={x:S.x-P.x,y:S.y-P.y};return Lm(F,z)/yp(F)/yp(z)},pm=(P,b,S)=>b.y===0?null:{x:P.x+b.x/b.y*(S-P.y),y:S},fm=(P,b,S)=>b.x===0?null:{x:S,y:P.y+b.y/b.x*(S-P.x)},Py=(P,b,S,z)=>{if(b.x===0)return fm(S,z,P.x);if(z.x===0)return fm(P,b,S.x);if(b.y===0)return pm(S,z,P.y);if(z.y===0)return pm(P,b,S.y);const F=pp(b,z);if(F==0)return null;const O={x:S.x-P.x,y:S.y-P.y},I=pp(O,b)/F,h=pp(O,z)/F,Y=P.x+h*b.x,J=S.x+I*z.x,he=P.y+h*b.y,N=S.y+I*z.y,$=(Y+J)/2,fe=(he+N)/2;return{x:$,y:fe}};class Co{static compare(b,S){const z=Co.comparePoints(b.point,S.point);return z!==0?z:(b.point!==S.point&&b.link(S),b.isLeft!==S.isLeft?b.isLeft?1:-1:fu.compare(b.segment,S.segment))}static comparePoints(b,S){return b.x<S.x?-1:b.x>S.x?1:b.y<S.y?-1:b.y>S.y?1:0}constructor(b,S){b.events===void 0?b.events=[this]:b.events.push(this),this.point=b,this.isLeft=S}link(b){if(b.point===this.point)throw new Error("Tried to link already linked events");const S=b.point.events;for(let z=0,F=S.length;z<F;z++){const O=S[z];this.point.events.push(O),O.point=this.point}this.checkForConsuming()}checkForConsuming(){const b=this.point.events.length;for(let S=0;S<b;S++){const z=this.point.events[S];if(z.segment.consumedBy===void 0)for(let F=S+1;F<b;F++){const O=this.point.events[F];O.consumedBy===void 0&&z.otherSE.point.events===O.otherSE.point.events&&z.segment.consume(O.segment)}}}getAvailableLinkedEvents(){const b=[];for(let S=0,z=this.point.events.length;S<z;S++){const F=this.point.events[S];F!==this&&!F.segment.ringOut&&F.segment.isInResult()&&b.push(F)}return b}getLeftmostComparator(b){const S=new Map,z=F=>{const O=F.otherSE;S.set(F,{sine:Ey(this.point,b.point,O.point),cosine:Iy(this.point,b.point,O.point)})};return(F,O)=>{S.has(F)||z(F),S.has(O)||z(O);const{sine:I,cosine:h}=S.get(F),{sine:Y,cosine:J}=S.get(O);return I>=0&&Y>=0?h<J?1:h>J?-1:0:I<0&&Y<0?h<J?-1:h>J?1:0:Y<I?-1:Y>I?1:0}}}let Cy=0;class fu{static compare(b,S){const z=b.leftSE.point.x,F=S.leftSE.point.x,O=b.rightSE.point.x,I=S.rightSE.point.x;if(I<z)return 1;if(O<F)return-1;const h=b.leftSE.point.y,Y=S.leftSE.point.y,J=b.rightSE.point.y,he=S.rightSE.point.y;if(z<F){if(Y<h&&Y<J)return 1;if(Y>h&&Y>J)return-1;const N=b.comparePoint(S.leftSE.point);if(N<0)return 1;if(N>0)return-1;const $=S.comparePoint(b.rightSE.point);return $!==0?$:-1}if(z>F){if(h<Y&&h<he)return-1;if(h>Y&&h>he)return 1;const N=S.comparePoint(b.leftSE.point);if(N!==0)return N;const $=b.comparePoint(S.rightSE.point);return $<0?1:$>0?-1:1}if(h<Y)return-1;if(h>Y)return 1;if(O<I){const N=S.comparePoint(b.rightSE.point);if(N!==0)return N}if(O>I){const N=b.comparePoint(S.rightSE.point);if(N<0)return 1;if(N>0)return-1}if(O!==I){const N=J-h,$=O-z,fe=he-Y,Ae=I-F;if(N>$&&fe<Ae)return 1;if(N<$&&fe>Ae)return-1}return O>I?1:O<I||J<he?-1:J>he?1:b.id<S.id?-1:b.id>S.id?1:0}constructor(b,S,z,F){this.id=++Cy,this.leftSE=b,b.segment=this,b.otherSE=S,this.rightSE=S,S.segment=this,S.otherSE=b,this.rings=z,this.windings=F}static fromRing(b,S,z){let F,O,I;const h=Co.comparePoints(b,S);if(h<0)F=b,O=S,I=1;else if(h>0)F=S,O=b,I=-1;else throw new Error(`Tried to create degenerate segment at [${b.x}, ${b.y}]`);const Y=new Co(F,!0),J=new Co(O,!1);return new fu(Y,J,[z],[I])}replaceRightSE(b){this.rightSE=b,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const b=this.leftSE.point.y,S=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:b<S?b:S},ur:{x:this.rightSE.point.x,y:b>S?b:S}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(b){return b.x===this.leftSE.point.x&&b.y===this.leftSE.point.y||b.x===this.rightSE.point.x&&b.y===this.rightSE.point.y}comparePoint(b){if(this.isAnEndpoint(b))return 0;const S=this.leftSE.point,z=this.rightSE.point,F=this.vector();if(S.x===z.x)return b.x===S.x?0:b.x<S.x?1:-1;const O=(b.y-S.y)/F.y,I=S.x+O*F.x;if(b.x===I)return 0;const h=(b.x-S.x)/F.x,Y=S.y+h*F.y;return b.y===Y?0:b.y<Y?-1:1}getIntersection(b){const S=this.bbox(),z=b.bbox(),F=mf(S,z);if(F===null)return null;const O=this.leftSE.point,I=this.rightSE.point,h=b.leftSE.point,Y=b.rightSE.point,J=hd(S,h)&&this.comparePoint(h)===0,he=hd(z,O)&&b.comparePoint(O)===0,N=hd(S,Y)&&this.comparePoint(Y)===0,$=hd(z,I)&&b.comparePoint(I)===0;if(he&&J)return $&&!N?I:!$&&N?Y:null;if(he)return N&&O.x===Y.x&&O.y===Y.y?null:O;if(J)return $&&I.x===h.x&&I.y===h.y?null:h;if($&&N)return null;if($)return I;if(N)return Y;const fe=Py(O,this.vector(),h,b.vector());return fe===null||!hd(F,fe)?null:md.round(fe.x,fe.y)}split(b){const S=[],z=b.events!==void 0,F=new Co(b,!0),O=new Co(b,!1),I=this.rightSE;this.replaceRightSE(O),S.push(O),S.push(F);const h=new fu(F,I,this.rings.slice(),this.windings.slice());return Co.comparePoints(h.leftSE.point,h.rightSE.point)>0&&h.swapEvents(),Co.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),z&&(F.checkForConsuming(),O.checkForConsuming()),S}swapEvents(){const b=this.rightSE;this.rightSE=this.leftSE,this.leftSE=b,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let S=0,z=this.windings.length;S<z;S++)this.windings[S]*=-1}consume(b){let S=this,z=b;for(;S.consumedBy;)S=S.consumedBy;for(;z.consumedBy;)z=z.consumedBy;const F=fu.compare(S,z);if(F!==0){if(F>0){const O=S;S=z,z=O}if(S.prev===z){const O=S;S=z,z=O}for(let O=0,I=z.rings.length;O<I;O++){const h=z.rings[O],Y=z.windings[O],J=S.rings.indexOf(h);J===-1?(S.rings.push(h),S.windings.push(Y)):S.windings[J]+=Y}z.rings=null,z.windings=null,z.consumedBy=S,z.leftSE.consumedBy=S.leftSE,z.rightSE.consumedBy=S.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const b=this.prev.consumedBy||this.prev;this._beforeState=b.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const b=this.beforeState();this._afterState={rings:b.rings.slice(0),windings:b.windings.slice(0),multiPolys:[]};const S=this._afterState.rings,z=this._afterState.windings,F=this._afterState.multiPolys;for(let h=0,Y=this.rings.length;h<Y;h++){const J=this.rings[h],he=this.windings[h],N=S.indexOf(J);N===-1?(S.push(J),z.push(he)):z[N]+=he}const O=[],I=[];for(let h=0,Y=S.length;h<Y;h++){if(z[h]===0)continue;const J=S[h],he=J.poly;if(I.indexOf(he)===-1)if(J.isExterior)O.push(he);else{I.indexOf(he)===-1&&I.push(he);const N=O.indexOf(J.poly);N!==-1&&O.splice(N,1)}}for(let h=0,Y=O.length;h<Y;h++){const J=O[h].multiPoly;F.indexOf(J)===-1&&F.push(J)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const b=this.beforeState().multiPolys,S=this.afterState().multiPolys;switch(ia.type){case"union":{const z=b.length===0,F=S.length===0;this._isInResult=z!==F;break}case"intersection":{let z,F;b.length<S.length?(z=b.length,F=S.length):(z=S.length,F=b.length),this._isInResult=F===ia.numMultiPolys&&z<F;break}case"xor":{const z=Math.abs(b.length-S.length);this._isInResult=z%2===1;break}case"difference":{const z=F=>F.length===1&&F[0].isSubject;this._isInResult=z(b)!==z(S);break}default:throw new Error(`Unrecognized operation type found ${ia.type}`)}return this._isInResult}}class mm{constructor(b,S,z){if(!Array.isArray(b)||b.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=S,this.isExterior=z,this.segments=[],typeof b[0][0]!="number"||typeof b[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const F=md.round(b[0][0],b[0][1]);this.bbox={ll:{x:F.x,y:F.y},ur:{x:F.x,y:F.y}};let O=F;for(let I=1,h=b.length;I<h;I++){if(typeof b[I][0]!="number"||typeof b[I][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let Y=md.round(b[I][0],b[I][1]);Y.x===O.x&&Y.y===O.y||(this.segments.push(fu.fromRing(O,Y,this)),Y.x<this.bbox.ll.x&&(this.bbox.ll.x=Y.x),Y.y<this.bbox.ll.y&&(this.bbox.ll.y=Y.y),Y.x>this.bbox.ur.x&&(this.bbox.ur.x=Y.x),Y.y>this.bbox.ur.y&&(this.bbox.ur.y=Y.y),O=Y)}(F.x!==O.x||F.y!==O.y)&&this.segments.push(fu.fromRing(O,F,this))}getSweepEvents(){const b=[];for(let S=0,z=this.segments.length;S<z;S++){const F=this.segments[S];b.push(F.leftSE),b.push(F.rightSE)}return b}}class My{constructor(b,S){if(!Array.isArray(b))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new mm(b[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let z=1,F=b.length;z<F;z++){const O=new mm(b[z],this,!1);O.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=O.bbox.ll.x),O.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=O.bbox.ll.y),O.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=O.bbox.ur.x),O.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=O.bbox.ur.y),this.interiorRings.push(O)}this.multiPoly=S}getSweepEvents(){const b=this.exteriorRing.getSweepEvents();for(let S=0,z=this.interiorRings.length;S<z;S++){const F=this.interiorRings[S].getSweepEvents();for(let O=0,I=F.length;O<I;O++)b.push(F[O])}return b}}class gm{constructor(b,S){if(!Array.isArray(b))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof b[0][0][0]=="number"&&(b=[b])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let z=0,F=b.length;z<F;z++){const O=new My(b[z],this);O.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=O.bbox.ll.x),O.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=O.bbox.ll.y),O.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=O.bbox.ur.x),O.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=O.bbox.ur.y),this.polys.push(O)}this.isSubject=S}getSweepEvents(){const b=[];for(let S=0,z=this.polys.length;S<z;S++){const F=this.polys[S].getSweepEvents();for(let O=0,I=F.length;O<I;O++)b.push(F[O])}return b}}class _p{static factory(b){const S=[];for(let z=0,F=b.length;z<F;z++){const O=b[z];if(!O.isInResult()||O.ringOut)continue;let I=null,h=O.leftSE,Y=O.rightSE;const J=[h],he=h.point,N=[];for(;I=h,h=Y,J.push(h),h.point!==he;)for(;;){const $=h.getAvailableLinkedEvents();if($.length===0){const se=J[0].point,De=J[J.length-1].point;throw new Error(`Unable to complete output ring starting at [${se.x}, ${se.y}]. Last matching segment found ends at [${De.x}, ${De.y}].`)}if($.length===1){Y=$[0].otherSE;break}let fe=null;for(let se=0,De=N.length;se<De;se++)if(N[se].point===h.point){fe=se;break}if(fe!==null){const se=N.splice(fe)[0],De=J.splice(se.index);De.unshift(De[0].otherSE),S.push(new _p(De.reverse()));continue}N.push({index:J.length,point:h.point});const Ae=h.getLeftmostComparator(I);Y=$.sort(Ae)[0].otherSE;break}S.push(new _p(J))}return S}constructor(b){this.events=b;for(let S=0,z=b.length;S<z;S++)b[S].segment.ringOut=this;this.poly=null}getGeom(){let b=this.events[0].point;const S=[b];for(let J=1,he=this.events.length-1;J<he;J++){const N=this.events[J].point,$=this.events[J+1].point;dm(N,b,$)!==0&&(S.push(N),b=N)}if(S.length===1)return null;const z=S[0],F=S[1];dm(z,b,F)===0&&S.shift(),S.push(S[0]);const O=this.isExteriorRing()?1:-1,I=this.isExteriorRing()?0:S.length-1,h=this.isExteriorRing()?S.length:-1,Y=[];for(let J=I;J!=h;J+=O)Y.push([S[J].x,S[J].y]);return Y}isExteriorRing(){if(this._isExteriorRing===void 0){const b=this.enclosingRing();this._isExteriorRing=b?!b.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let b=this.events[0];for(let F=1,O=this.events.length;F<O;F++){const I=this.events[F];Co.compare(b,I)>0&&(b=I)}let S=b.segment.prevInResult(),z=S?S.prevInResult():null;for(;;){if(!S)return null;if(!z)return S.ringOut;if(z.ringOut!==S.ringOut)return z.ringOut.enclosingRing()!==S.ringOut?S.ringOut:S.ringOut.enclosingRing();S=z.prevInResult(),z=S?S.prevInResult():null}}}class ym{constructor(b){this.exteriorRing=b,b.poly=this,this.interiorRings=[]}addInterior(b){this.interiorRings.push(b),b.poly=this}getGeom(){const b=[this.exteriorRing.getGeom()];if(b[0]===null)return null;for(let S=0,z=this.interiorRings.length;S<z;S++){const F=this.interiorRings[S].getGeom();F!==null&&b.push(F)}return b}}class Ay{constructor(b){this.rings=b,this.polys=this._composePolys(b)}getGeom(){const b=[];for(let S=0,z=this.polys.length;S<z;S++){const F=this.polys[S].getGeom();F!==null&&b.push(F)}return b}_composePolys(b){const S=[];for(let z=0,F=b.length;z<F;z++){const O=b[z];if(!O.poly)if(O.isExteriorRing())S.push(new ym(O));else{const I=O.enclosingRing();I.poly||S.push(new ym(I)),I.poly.addInterior(O)}}return S}}class zy{constructor(b){let S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fu.compare;this.queue=b,this.tree=new _f(S),this.segments=[]}process(b){const S=b.segment,z=[];if(b.consumedBy)return b.isLeft?this.queue.remove(b.otherSE):this.tree.remove(S),z;const F=b.isLeft?this.tree.add(S):this.tree.find(S);if(!F)throw new Error(`Unable to find segment #${S.id} [${S.leftSE.point.x}, ${S.leftSE.point.y}] -> [${S.rightSE.point.x}, ${S.rightSE.point.y}] in SweepLine tree.`);let O=F,I=F,h,Y;for(;h===void 0;)O=this.tree.prev(O),O===null?h=null:O.key.consumedBy===void 0&&(h=O.key);for(;Y===void 0;)I=this.tree.next(I),I===null?Y=null:I.key.consumedBy===void 0&&(Y=I.key);if(b.isLeft){let J=null;if(h){const N=h.getIntersection(S);if(N!==null&&(S.isAnEndpoint(N)||(J=N),!h.isAnEndpoint(N))){const $=this._splitSafely(h,N);for(let fe=0,Ae=$.length;fe<Ae;fe++)z.push($[fe])}}let he=null;if(Y){const N=Y.getIntersection(S);if(N!==null&&(S.isAnEndpoint(N)||(he=N),!Y.isAnEndpoint(N))){const $=this._splitSafely(Y,N);for(let fe=0,Ae=$.length;fe<Ae;fe++)z.push($[fe])}}if(J!==null||he!==null){let N=null;J===null?N=he:he===null?N=J:N=Co.comparePoints(J,he)<=0?J:he,this.queue.remove(S.rightSE),z.push(S.rightSE);const $=S.split(N);for(let fe=0,Ae=$.length;fe<Ae;fe++)z.push($[fe])}z.length>0?(this.tree.remove(S),z.push(b)):(this.segments.push(S),S.prev=h)}else{if(h&&Y){const J=h.getIntersection(Y);if(J!==null){if(!h.isAnEndpoint(J)){const he=this._splitSafely(h,J);for(let N=0,$=he.length;N<$;N++)z.push(he[N])}if(!Y.isAnEndpoint(J)){const he=this._splitSafely(Y,J);for(let N=0,$=he.length;N<$;N++)z.push(he[N])}}}this.tree.remove(S)}return z}_splitSafely(b,S){this.tree.remove(b);const z=b.rightSE;this.queue.remove(z);const F=b.split(S);return F.push(z),b.consumedBy===void 0&&this.tree.add(b),F}}const _m=typeof process<"u"&&Dm.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Dy=typeof process<"u"&&Dm.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class Ly{run(b,S,z){ia.type=b,md.reset();const F=[new gm(S,!0)];for(let N=0,$=z.length;N<$;N++)F.push(new gm(z[N],!1));if(ia.numMultiPolys=F.length,ia.type==="difference"){const N=F[0];let $=1;for(;$<F.length;)mf(F[$].bbox,N.bbox)!==null?$++:F.splice($,1)}if(ia.type==="intersection")for(let N=0,$=F.length;N<$;N++){const fe=F[N];for(let Ae=N+1,se=F.length;Ae<se;Ae++)if(mf(fe.bbox,F[Ae].bbox)===null)return[]}const O=new _f(Co.compare);for(let N=0,$=F.length;N<$;N++){const fe=F[N].getSweepEvents();for(let Ae=0,se=fe.length;Ae<se;Ae++)if(O.insert(fe[Ae]),O.size>_m)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const I=new zy(O);let h=O.size,Y=O.pop();for(;Y;){const N=Y.key;if(O.size===h){const fe=N.segment;throw new Error(`Unable to pop() ${N.isLeft?"left":"right"} SweepEvent [${N.point.x}, ${N.point.y}] from segment #${fe.id} [${fe.leftSE.point.x}, ${fe.leftSE.point.y}] -> [${fe.rightSE.point.x}, ${fe.rightSE.point.y}] from queue.`)}if(O.size>_m)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(I.segments.length>Dy)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const $=I.process(N);for(let fe=0,Ae=$.length;fe<Ae;fe++){const se=$[fe];se.consumedBy===void 0&&O.insert(se)}h=O.size,Y=O.pop()}md.reset();const J=_p.factory(I.segments);return new Ay(J).getGeom()}}const ia=new Ly,Ry=function(P){for(var b=arguments.length,S=new Array(b>1?b-1:0),z=1;z<b;z++)S[z-1]=arguments[z];return ia.run("union",P,S)},Fy=function(P){for(var b=arguments.length,S=new Array(b>1?b-1:0),z=1;z<b;z++)S[z-1]=arguments[z];return ia.run("intersection",P,S)},By=function(P){for(var b=arguments.length,S=new Array(b>1?b-1:0),z=1;z<b;z++)S[z-1]=arguments[z];return ia.run("xor",P,S)},Oy=function(P){for(var b=arguments.length,S=new Array(b>1?b-1:0),z=1;z<b;z++)S[z-1]=arguments[z];return ia.run("difference",P,S)};var Rm={union:Ry,intersection:Fy,xor:By,difference:Oy};function vp(P){return P.type==="Polygon"?[P.coordinates]:P.coordinates}function Fm(P){return!P||P.length===0?null:P.length===1?{type:"Polygon",coordinates:P[0]}:{type:"MultiPolygon",coordinates:P}}function Bm(P,b){const S=Rm.intersection(vp(P),vp(b));return Fm(S)}function Ny(P,b){const S=Rm.difference(vp(P),vp(b));return Fm(S)}function Vy(P,b=.5){const S=fp(P),z=[S[0]-b,S[1]-b,S[2]+b,S[3]+b];return wg(z)}function jy(P,b,S,z){const F=pd(b),I=Ag(F,S,{units:"miles",steps:96}).geometry;return z?Bm(P,I):Ny(P,I)}function Uy(P,b,S,z){const F=pd(b,{id:"A"}),O=pd(S,{id:"B"}),I=km([F,O]),h=Vy(P,1),Y=fp(h),J=Yg(I,{bbox:Y});if(!J)return null;let he=null,N=null;for(const fe of J.features){if(!fe?.geometry)continue;const Ae=fe.geometry;Xf(F,Ae)&&(he=Ae),Xf(O,Ae)&&(N=Ae)}const $=z?N:he;return $?Bm(P,$):null}function cp(){return Math.random().toString(16).slice(2)+"-"+Date.now().toString(16)}function $y(){return hy.features??[]}function lf(P,b){const S=b.trim().toUpperCase();return P.find(z=>(z.properties?.iso_a2??"").toUpperCase()===S)??null}const an=cy((P,b)=>{const S=$y(),z=(S[0]?.properties?.iso_a2??"GB").toUpperCase(),F=lf(S,z),O=F?.geometry??null,I=F?[{id:cp(),ts:Date.now(),type:"SET_COUNTRY",isoA2:z,name:F.properties?.name}]:[];return{countries:S,selectedIsoA2:z,candidate:O,seekerLngLat:null,seekerAccuracyM:null,thermoStart:null,thermoEnd:null,history:I,undoStack:[],redoStack:[],setCountry:h=>{const Y=lf(b().countries,h);if(!Y)return;const J=(Y.properties?.iso_a2??h).toUpperCase();P({selectedIsoA2:J,candidate:Y.geometry,undoStack:[],redoStack:[],thermoStart:null,thermoEnd:null,history:[...b().history,{id:cp(),ts:Date.now(),type:"SET_COUNTRY",isoA2:J,name:Y.properties?.name}]})},updateSeekerFromGPS:async()=>{if(!navigator.geolocation)throw new Error("Geolocation not supported");const h=await new Promise((he,N)=>{navigator.geolocation.getCurrentPosition(he,N,{enableHighAccuracy:!0,timeout:12e3,maximumAge:2e3})}),Y=h.coords.longitude,J=h.coords.latitude;P({seekerLngLat:[Y,J],seekerAccuracyM:h.coords.accuracy??null})},setThermoStartNow:()=>{const h=b().seekerLngLat;h&&P({thermoStart:h})},setThermoEndNow:()=>{const h=b().seekerLngLat;h&&P({thermoEnd:h})},applyRadarNow:(h,Y)=>{const J=b().candidate,he=b().seekerLngLat;if(!J||!he)return;const N=jy(J,he,h,Y);N&&P({candidate:N,undoStack:[...b().undoStack,J],redoStack:[],history:[...b().history,{id:cp(),ts:Date.now(),type:"RADAR",radiusMiles:h,hit:Y,seeker:he}]})},applyThermo:h=>{const Y=b().candidate,J=b().thermoStart,he=b().thermoEnd;if(!Y||!J||!he)return;const N=Uy(Y,J,he,h);N&&P({candidate:N,undoStack:[...b().undoStack,Y],redoStack:[],history:[...b().history,{id:cp(),ts:Date.now(),type:"THERMOMETER",hotter:h,start:J,end:he}]})},undo:()=>{const h=b().undoStack;if(h.length===0)return;const Y=h[h.length-1],J=b().candidate;P({candidate:Y,undoStack:h.slice(0,-1),redoStack:J?[...b().redoStack,J]:b().redoStack})},redo:()=>{const h=b().redoStack;if(h.length===0)return;const Y=h[h.length-1],J=b().candidate;P({candidate:Y,redoStack:h.slice(0,-1),undoStack:J?[...b().undoStack,J]:b().undoStack})},resetCandidateToCountry:()=>{const h=lf(b().countries,b().selectedIsoA2);h&&P({candidate:h.geometry,undoStack:[],redoStack:[],thermoStart:null,thermoEnd:null})}}}),hp={candidate:"candidate"},vm={candidateFill:"candidate-fill",candidateOutline:"candidate-outline"};function qy(P){return{type:"FeatureCollection",features:P?[{type:"Feature",properties:{},geometry:P}]:[]}}function Zy(){const P=hu.useRef(null),b=hu.useRef(null),S=hu.useRef(null),z=an(I=>I.candidate),F=an(I=>I.seekerLngLat),O=hu.useMemo(()=>qy(z),[z]);return hu.useEffect(()=>{if(!P.current)return;const I=new Yp.Map({container:P.current,style:"https://demotiles.maplibre.org/style.json",center:[0,20],zoom:2});return I.addControl(new Yp.NavigationControl,"top-right"),b.current=I,I.on("load",()=>{if(I.addSource(hp.candidate,{type:"geojson",data:O}),I.addLayer({id:vm.candidateFill,type:"fill",source:hp.candidate,paint:{"fill-opacity":.35}}),I.addLayer({id:vm.candidateOutline,type:"line",source:hp.candidate,paint:{"line-width":2}}),z){const h=fp(z);I.fitBounds([[h[0],h[1]],[h[2],h[3]]],{padding:40,duration:0})}}),()=>{S.current?.remove(),S.current=null,I.remove(),b.current=null}},[]),hu.useEffect(()=>{const I=b.current;if(!I)return;const h=I.getSource(hp.candidate);if(h&&(h.setData(O),z)){const Y=fp(z);I.fitBounds([[Y[0],Y[1]],[Y[2],Y[3]]],{padding:40,duration:450})}},[O,z]),hu.useEffect(()=>{const I=b.current;if(!I||(S.current?.remove(),S.current=null,!F))return;const h=new Yp.Marker().setLngLat(F).addTo(I);S.current=h},[F]),xt.jsx("div",{className:"map",ref:P})}const xm=[.5,1,3,5,10,25,50,100];function Gy(){const P=an(se=>se.countries),b=an(se=>se.selectedIsoA2),S=an(se=>se.setCountry),z=an(se=>se.seekerLngLat),F=an(se=>se.seekerAccuracyM),O=an(se=>se.updateSeekerFromGPS),I=an(se=>se.thermoStart),h=an(se=>se.thermoEnd),Y=an(se=>se.setThermoStartNow),J=an(se=>se.setThermoEndNow),he=an(se=>se.applyRadarNow),N=an(se=>se.applyThermo),$=an(se=>se.undo),fe=an(se=>se.redo),Ae=an(se=>se.resetCandidateToCountry);return xt.jsxs(xt.Fragment,{children:[xt.jsxs("div",{className:"card",children:[xt.jsx("div",{className:"row",children:xt.jsx("strong",{children:"Country"})}),xt.jsx("div",{className:"row",children:xt.jsx("select",{value:b,onChange:se=>S(se.target.value),children:P.map(se=>{const De=(se.properties?.iso_a2??"").toUpperCase(),Le=se.properties?.name??De;return xt.jsxs("option",{value:De,children:[Le," (",De,")"]},De)})})}),xt.jsxs("small",{className:"muted",children:["Replace ",xt.jsx("code",{children:"src/data/countries.sample.geojson"})," with a full world file when ready."]})]}),xt.jsxs("div",{className:"card",children:[xt.jsx("div",{className:"row",children:xt.jsx("strong",{children:"Seeker GPS"})}),xt.jsxs("div",{className:"row",children:[xt.jsx("button",{className:"primary",onClick:()=>O().catch(se=>alert(se?.message??String(se))),children:"Use GPS"}),xt.jsx("button",{onClick:Ae,children:"Reset Area"}),xt.jsx("button",{onClick:$,children:"Undo"}),xt.jsx("button",{onClick:fe,children:"Redo"})]}),xt.jsx("div",{className:"row",children:xt.jsxs("small",{className:"muted",children:[z?`LngLat: ${z[0].toFixed(5)}, ${z[1].toFixed(5)}`:"No seeker position yet.",F?`  ${Math.round(F)}m`:""]})})]}),xt.jsxs("div",{className:"card",children:[xt.jsx("strong",{children:"Radar"}),xt.jsx("div",{className:"hr"}),xt.jsx("div",{className:"row",children:xm.map(se=>xt.jsxs("button",{onClick:()=>he(se,!0),disabled:!z,children:["Hit ",se," mi"]},`hit-${se}`))}),xt.jsx("div",{className:"row",children:xm.map(se=>xt.jsxs("button",{onClick:()=>he(se,!1),disabled:!z,children:["Miss ",se," mi"]},`miss-${se}`))}),xt.jsx("small",{className:"muted",children:"Requires seeker GPS."})]}),xt.jsxs("div",{className:"card",children:[xt.jsx("strong",{children:"Thermometer"}),xt.jsx("div",{className:"hr"}),xt.jsxs("div",{className:"row",children:[xt.jsx("button",{onClick:Y,disabled:!z,children:"Set Start"}),xt.jsx("button",{onClick:J,disabled:!z,children:"Set End"})]}),xt.jsxs("small",{className:"muted",children:["Start: ",I?`${I[0].toFixed(4)}, ${I[1].toFixed(4)}`:"not set",xt.jsx("br",{}),"End: ",h?`${h[0].toFixed(4)}, ${h[1].toFixed(4)}`:"not set"]}),xt.jsx("div",{className:"hr"}),xt.jsxs("div",{className:"row",children:[xt.jsx("button",{className:"primary",onClick:()=>N(!0),disabled:!I||!h,children:"Hotter"}),xt.jsx("button",{className:"primary",onClick:()=>N(!1),disabled:!I||!h,children:"Colder"})]}),xt.jsx("small",{className:"muted",children:"Uses a Voronoi split between Start and End, then keeps the correct half."})]})]})}function uf(P){return new Date(P).toLocaleString()}function Hy(){const P=an(b=>b.history);return xt.jsxs("div",{className:"card",children:[xt.jsx("strong",{children:"History"}),xt.jsx("div",{className:"hr"}),xt.jsxs("div",{style:{display:"grid",gap:8},children:[P.length===0&&xt.jsx("small",{className:"muted",children:"No actions yet."}),P.slice().reverse().map(b=>b.type==="SET_COUNTRY"?xt.jsxs("div",{children:[xt.jsx("small",{className:"muted",children:uf(b.ts)}),xt.jsxs("div",{children:["Country: ",b.name??b.isoA2," (",b.isoA2,")"]})]},b.id):b.type==="RADAR"?xt.jsxs("div",{children:[xt.jsx("small",{className:"muted",children:uf(b.ts)}),xt.jsxs("div",{children:["Radar: ",b.hit?"Hit":"Miss"," ",b.radiusMiles," mi"]})]},b.id):xt.jsxs("div",{children:[xt.jsx("small",{className:"muted",children:uf(b.ts)}),xt.jsxs("div",{children:["Thermometer: ",b.hotter?"Hotter":"Colder"]})]},b.id))]})]})}function Wy(){return xt.jsxs("div",{className:"app",children:[xt.jsxs("div",{className:"sidebar",children:[xt.jsx("h1",{children:"MorLag"}),xt.jsx("small",{className:"muted",children:"GPS-only seeker, manual iMessage answers, shaded possible area."}),xt.jsx(Gy,{}),xt.jsx(Hy,{}),xt.jsxs("div",{className:"card",children:[xt.jsx("strong",{children:"Next upgrades"}),xt.jsx("div",{className:"hr"}),xt.jsx("small",{className:"muted",children:"Hatch fill pattern, export session JSON, save/load, Matching by region, Measuring, Photo prompts."})]})]}),xt.jsx(Zy,{})]})}hg.createRoot(document.getElementById("root")).render(xt.jsx(wm.StrictMode,{children:xt.jsx(Wy,{})}));
