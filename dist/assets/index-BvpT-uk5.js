(function(){const w=document.createElement("link").relList;if(w&&w.supports&&w.supports("modulepreload"))return;for(const T of document.querySelectorAll('link[rel="modulepreload"]'))E(T);new MutationObserver(T=>{for(const N of T)if(N.type==="childList")for(const L of N.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&E(L)}).observe(document,{childList:!0,subtree:!0});function S(T){const N={};return T.integrity&&(N.integrity=T.integrity),T.referrerPolicy&&(N.referrerPolicy=T.referrerPolicy),T.crossOrigin==="use-credentials"?N.credentials="include":T.crossOrigin==="anonymous"?N.credentials="omit":N.credentials="same-origin",N}function E(T){if(T.ep)return;T.ep=!0;const N=S(T);fetch(T.href,N)}})();function Uf(k){return k&&k.__esModule&&Object.prototype.hasOwnProperty.call(k,"default")?k.default:k}var Lp={exports:{}},Cf={},Rp={exports:{}},Jn={};var Om;function Xy(){if(Om)return Jn;Om=1;var k=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),L=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),ee=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),F=Symbol.iterator;function q(Re){return Re===null||typeof Re!="object"?null:(Re=F&&Re[F]||Re["@@iterator"],typeof Re=="function"?Re:null)}var se={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},le=Object.assign,fe={};function Ie(Re,rt,on){this.props=Re,this.context=rt,this.refs=fe,this.updater=on||se}Ie.prototype.isReactComponent={},Ie.prototype.setState=function(Re,rt){if(typeof Re!="object"&&typeof Re!="function"&&Re!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Re,rt,"setState")},Ie.prototype.forceUpdate=function(Re){this.updater.enqueueForceUpdate(this,Re,"forceUpdate")};function Be(){}Be.prototype=Ie.prototype;function Ce(Re,rt,on){this.props=Re,this.context=rt,this.refs=fe,this.updater=on||se}var Ge=Ce.prototype=new Be;Ge.constructor=Ce,le(Ge,Ie.prototype),Ge.isPureReactComponent=!0;var it=Array.isArray,We=Object.prototype.hasOwnProperty,tt={current:null},at={key:!0,ref:!0,__self:!0,__source:!0};function ht(Re,rt,on){var Pt,yn={},Dn=null,Rn=null;if(rt!=null)for(Pt in rt.ref!==void 0&&(Rn=rt.ref),rt.key!==void 0&&(Dn=""+rt.key),rt)We.call(rt,Pt)&&!at.hasOwnProperty(Pt)&&(yn[Pt]=rt[Pt]);var Ne=arguments.length-2;if(Ne===1)yn.children=on;else if(1<Ne){for(var ei=Array(Ne),Cn=0;Cn<Ne;Cn++)ei[Cn]=arguments[Cn+2];yn.children=ei}if(Re&&Re.defaultProps)for(Pt in Ne=Re.defaultProps,Ne)yn[Pt]===void 0&&(yn[Pt]=Ne[Pt]);return{$$typeof:k,type:Re,key:Dn,ref:Rn,props:yn,_owner:tt.current}}function ft(Re,rt){return{$$typeof:k,type:Re.type,key:rt,ref:Re.ref,props:Re.props,_owner:Re._owner}}function $t(Re){return typeof Re=="object"&&Re!==null&&Re.$$typeof===k}function wt(Re){var rt={"=":"=0",":":"=2"};return"$"+Re.replace(/[=:]/g,function(on){return rt[on]})}var Zt=/\/+/g;function Bt(Re,rt){return typeof Re=="object"&&Re!==null&&Re.key!=null?wt(""+Re.key):rt.toString(36)}function je(Re,rt,on,Pt,yn){var Dn=typeof Re;(Dn==="undefined"||Dn==="boolean")&&(Re=null);var Rn=!1;if(Re===null)Rn=!0;else switch(Dn){case"string":case"number":Rn=!0;break;case"object":switch(Re.$$typeof){case k:case w:Rn=!0}}if(Rn)return Rn=Re,yn=yn(Rn),Re=Pt===""?"."+Bt(Rn,0):Pt,it(yn)?(on="",Re!=null&&(on=Re.replace(Zt,"$&/")+"/"),je(yn,rt,on,"",function(Cn){return Cn})):yn!=null&&($t(yn)&&(yn=ft(yn,on+(!yn.key||Rn&&Rn.key===yn.key?"":(""+yn.key).replace(Zt,"$&/")+"/")+Re)),rt.push(yn)),1;if(Rn=0,Pt=Pt===""?".":Pt+":",it(Re))for(var Ne=0;Ne<Re.length;Ne++){Dn=Re[Ne];var ei=Pt+Bt(Dn,Ne);Rn+=je(Dn,rt,on,ei,yn)}else if(ei=q(Re),typeof ei=="function")for(Re=ei.call(Re),Ne=0;!(Dn=Re.next()).done;)Dn=Dn.value,ei=Pt+Bt(Dn,Ne++),Rn+=je(Dn,rt,on,ei,yn);else if(Dn==="object")throw rt=String(Re),Error("Objects are not valid as a React child (found: "+(rt==="[object Object]"?"object with keys {"+Object.keys(Re).join(", ")+"}":rt)+"). If you meant to render a collection of children, use an array instead.");return Rn}function zt(Re,rt,on){if(Re==null)return Re;var Pt=[],yn=0;return je(Re,Pt,"","",function(Dn){return rt.call(on,Dn,yn++)}),Pt}function an(Re){if(Re._status===-1){var rt=Re._result;rt=rt(),rt.then(function(on){(Re._status===0||Re._status===-1)&&(Re._status=1,Re._result=on)},function(on){(Re._status===0||Re._status===-1)&&(Re._status=2,Re._result=on)}),Re._status===-1&&(Re._status=0,Re._result=rt)}if(Re._status===1)return Re._result.default;throw Re._result}var rn={current:null},bt={transition:null},jt={ReactCurrentDispatcher:rn,ReactCurrentBatchConfig:bt,ReactCurrentOwner:tt};function nt(){throw Error("act(...) is not supported in production builds of React.")}return Jn.Children={map:zt,forEach:function(Re,rt,on){zt(Re,function(){rt.apply(this,arguments)},on)},count:function(Re){var rt=0;return zt(Re,function(){rt++}),rt},toArray:function(Re){return zt(Re,function(rt){return rt})||[]},only:function(Re){if(!$t(Re))throw Error("React.Children.only expected to receive a single React element child.");return Re}},Jn.Component=Ie,Jn.Fragment=S,Jn.Profiler=T,Jn.PureComponent=Ce,Jn.StrictMode=E,Jn.Suspense=W,Jn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jt,Jn.act=nt,Jn.cloneElement=function(Re,rt,on){if(Re==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Re+".");var Pt=le({},Re.props),yn=Re.key,Dn=Re.ref,Rn=Re._owner;if(rt!=null){if(rt.ref!==void 0&&(Dn=rt.ref,Rn=tt.current),rt.key!==void 0&&(yn=""+rt.key),Re.type&&Re.type.defaultProps)var Ne=Re.type.defaultProps;for(ei in rt)We.call(rt,ei)&&!at.hasOwnProperty(ei)&&(Pt[ei]=rt[ei]===void 0&&Ne!==void 0?Ne[ei]:rt[ei])}var ei=arguments.length-2;if(ei===1)Pt.children=on;else if(1<ei){Ne=Array(ei);for(var Cn=0;Cn<ei;Cn++)Ne[Cn]=arguments[Cn+2];Pt.children=Ne}return{$$typeof:k,type:Re.type,key:yn,ref:Dn,props:Pt,_owner:Rn}},Jn.createContext=function(Re){return Re={$$typeof:L,_currentValue:Re,_currentValue2:Re,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Re.Provider={$$typeof:N,_context:Re},Re.Consumer=Re},Jn.createElement=ht,Jn.createFactory=function(Re){var rt=ht.bind(null,Re);return rt.type=Re,rt},Jn.createRef=function(){return{current:null}},Jn.forwardRef=function(Re){return{$$typeof:c,render:Re}},Jn.isValidElement=$t,Jn.lazy=function(Re){return{$$typeof:Q,_payload:{_status:-1,_result:Re},_init:an}},Jn.memo=function(Re,rt){return{$$typeof:ee,type:Re,compare:rt===void 0?null:rt}},Jn.startTransition=function(Re){var rt=bt.transition;bt.transition={};try{Re()}finally{bt.transition=rt}},Jn.unstable_act=nt,Jn.useCallback=function(Re,rt){return rn.current.useCallback(Re,rt)},Jn.useContext=function(Re){return rn.current.useContext(Re)},Jn.useDebugValue=function(){},Jn.useDeferredValue=function(Re){return rn.current.useDeferredValue(Re)},Jn.useEffect=function(Re,rt){return rn.current.useEffect(Re,rt)},Jn.useId=function(){return rn.current.useId()},Jn.useImperativeHandle=function(Re,rt,on){return rn.current.useImperativeHandle(Re,rt,on)},Jn.useInsertionEffect=function(Re,rt){return rn.current.useInsertionEffect(Re,rt)},Jn.useLayoutEffect=function(Re,rt){return rn.current.useLayoutEffect(Re,rt)},Jn.useMemo=function(Re,rt){return rn.current.useMemo(Re,rt)},Jn.useReducer=function(Re,rt,on){return rn.current.useReducer(Re,rt,on)},Jn.useRef=function(Re){return rn.current.useRef(Re)},Jn.useState=function(Re){return rn.current.useState(Re)},Jn.useSyncExternalStore=function(Re,rt,on){return rn.current.useSyncExternalStore(Re,rt,on)},Jn.useTransition=function(){return rn.current.useTransition()},Jn.version="18.3.1",Jn}var Fm;function qf(){return Fm||(Fm=1,Rp.exports=Xy()),Rp.exports}var Bm;function Wy(){if(Bm)return Cf;Bm=1;var k=qf(),w=Symbol.for("react.element"),S=Symbol.for("react.fragment"),E=Object.prototype.hasOwnProperty,T=k.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,N={key:!0,ref:!0,__self:!0,__source:!0};function L(c,W,ee){var Q,F={},q=null,se=null;ee!==void 0&&(q=""+ee),W.key!==void 0&&(q=""+W.key),W.ref!==void 0&&(se=W.ref);for(Q in W)E.call(W,Q)&&!N.hasOwnProperty(Q)&&(F[Q]=W[Q]);if(c&&c.defaultProps)for(Q in W=c.defaultProps,W)F[Q]===void 0&&(F[Q]=W[Q]);return{$$typeof:w,type:c,key:q,ref:se,props:F,_owner:T.current}}return Cf.Fragment=S,Cf.jsx=L,Cf.jsxs=L,Cf}var jm;function Yy(){return jm||(jm=1,Lp.exports=Wy()),Lp.exports}var Le=Yy(),vi=qf();const Kg=Uf(vi);var Fd={},Np={exports:{}},Za={},zp={exports:{}},Dp={};var Vm;function Ky(){return Vm||(Vm=1,(function(k){function w(bt,jt){var nt=bt.length;bt.push(jt);e:for(;0<nt;){var Re=nt-1>>>1,rt=bt[Re];if(0<T(rt,jt))bt[Re]=jt,bt[nt]=rt,nt=Re;else break e}}function S(bt){return bt.length===0?null:bt[0]}function E(bt){if(bt.length===0)return null;var jt=bt[0],nt=bt.pop();if(nt!==jt){bt[0]=nt;e:for(var Re=0,rt=bt.length,on=rt>>>1;Re<on;){var Pt=2*(Re+1)-1,yn=bt[Pt],Dn=Pt+1,Rn=bt[Dn];if(0>T(yn,nt))Dn<rt&&0>T(Rn,yn)?(bt[Re]=Rn,bt[Dn]=nt,Re=Dn):(bt[Re]=yn,bt[Pt]=nt,Re=Pt);else if(Dn<rt&&0>T(Rn,nt))bt[Re]=Rn,bt[Dn]=nt,Re=Dn;else break e}}return jt}function T(bt,jt){var nt=bt.sortIndex-jt.sortIndex;return nt!==0?nt:bt.id-jt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var N=performance;k.unstable_now=function(){return N.now()}}else{var L=Date,c=L.now();k.unstable_now=function(){return L.now()-c}}var W=[],ee=[],Q=1,F=null,q=3,se=!1,le=!1,fe=!1,Ie=typeof setTimeout=="function"?setTimeout:null,Be=typeof clearTimeout=="function"?clearTimeout:null,Ce=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Ge(bt){for(var jt=S(ee);jt!==null;){if(jt.callback===null)E(ee);else if(jt.startTime<=bt)E(ee),jt.sortIndex=jt.expirationTime,w(W,jt);else break;jt=S(ee)}}function it(bt){if(fe=!1,Ge(bt),!le)if(S(W)!==null)le=!0,an(We);else{var jt=S(ee);jt!==null&&rn(it,jt.startTime-bt)}}function We(bt,jt){le=!1,fe&&(fe=!1,Be(ht),ht=-1),se=!0;var nt=q;try{for(Ge(jt),F=S(W);F!==null&&(!(F.expirationTime>jt)||bt&&!wt());){var Re=F.callback;if(typeof Re=="function"){F.callback=null,q=F.priorityLevel;var rt=Re(F.expirationTime<=jt);jt=k.unstable_now(),typeof rt=="function"?F.callback=rt:F===S(W)&&E(W),Ge(jt)}else E(W);F=S(W)}if(F!==null)var on=!0;else{var Pt=S(ee);Pt!==null&&rn(it,Pt.startTime-jt),on=!1}return on}finally{F=null,q=nt,se=!1}}var tt=!1,at=null,ht=-1,ft=5,$t=-1;function wt(){return!(k.unstable_now()-$t<ft)}function Zt(){if(at!==null){var bt=k.unstable_now();$t=bt;var jt=!0;try{jt=at(!0,bt)}finally{jt?Bt():(tt=!1,at=null)}}else tt=!1}var Bt;if(typeof Ce=="function")Bt=function(){Ce(Zt)};else if(typeof MessageChannel<"u"){var je=new MessageChannel,zt=je.port2;je.port1.onmessage=Zt,Bt=function(){zt.postMessage(null)}}else Bt=function(){Ie(Zt,0)};function an(bt){at=bt,tt||(tt=!0,Bt())}function rn(bt,jt){ht=Ie(function(){bt(k.unstable_now())},jt)}k.unstable_IdlePriority=5,k.unstable_ImmediatePriority=1,k.unstable_LowPriority=4,k.unstable_NormalPriority=3,k.unstable_Profiling=null,k.unstable_UserBlockingPriority=2,k.unstable_cancelCallback=function(bt){bt.callback=null},k.unstable_continueExecution=function(){le||se||(le=!0,an(We))},k.unstable_forceFrameRate=function(bt){0>bt||125<bt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ft=0<bt?Math.floor(1e3/bt):5},k.unstable_getCurrentPriorityLevel=function(){return q},k.unstable_getFirstCallbackNode=function(){return S(W)},k.unstable_next=function(bt){switch(q){case 1:case 2:case 3:var jt=3;break;default:jt=q}var nt=q;q=jt;try{return bt()}finally{q=nt}},k.unstable_pauseExecution=function(){},k.unstable_requestPaint=function(){},k.unstable_runWithPriority=function(bt,jt){switch(bt){case 1:case 2:case 3:case 4:case 5:break;default:bt=3}var nt=q;q=bt;try{return jt()}finally{q=nt}},k.unstable_scheduleCallback=function(bt,jt,nt){var Re=k.unstable_now();switch(typeof nt=="object"&&nt!==null?(nt=nt.delay,nt=typeof nt=="number"&&0<nt?Re+nt:Re):nt=Re,bt){case 1:var rt=-1;break;case 2:rt=250;break;case 5:rt=1073741823;break;case 4:rt=1e4;break;default:rt=5e3}return rt=nt+rt,bt={id:Q++,callback:jt,priorityLevel:bt,startTime:nt,expirationTime:rt,sortIndex:-1},nt>Re?(bt.sortIndex=nt,w(ee,bt),S(W)===null&&bt===S(ee)&&(fe?(Be(ht),ht=-1):fe=!0,rn(it,nt-Re))):(bt.sortIndex=rt,w(W,bt),le||se||(le=!0,an(We))),bt},k.unstable_shouldYield=wt,k.unstable_wrapCallback=function(bt){var jt=q;return function(){var nt=q;q=jt;try{return bt.apply(this,arguments)}finally{q=nt}}}})(Dp)),Dp}var Um;function Jy(){return Um||(Um=1,zp.exports=Ky()),zp.exports}var qm;function Qy(){if(qm)return Za;qm=1;var k=qf(),w=Jy();function S(a){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+a,g=1;g<arguments.length;g++)l+="&args[]="+encodeURIComponent(arguments[g]);return"Minified React error #"+a+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var E=new Set,T={};function N(a,l){L(a,l),L(a+"Capture",l)}function L(a,l){for(T[a]=l,a=0;a<l.length;a++)E.add(l[a])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),W=Object.prototype.hasOwnProperty,ee=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Q={},F={};function q(a){return W.call(F,a)?!0:W.call(Q,a)?!1:ee.test(a)?F[a]=!0:(Q[a]=!0,!1)}function se(a,l,g,I){if(g!==null&&g.type===0)return!1;switch(typeof l){case"function":case"symbol":return!0;case"boolean":return I?!1:g!==null?!g.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function le(a,l,g,I){if(l===null||typeof l>"u"||se(a,l,g,I))return!0;if(I)return!1;if(g!==null)switch(g.type){case 3:return!l;case 4:return l===!1;case 5:return isNaN(l);case 6:return isNaN(l)||1>l}return!1}function fe(a,l,g,I,z,j,ne){this.acceptsBooleans=l===2||l===3||l===4,this.attributeName=I,this.attributeNamespace=z,this.mustUseProperty=g,this.propertyName=a,this.type=l,this.sanitizeURL=j,this.removeEmptyString=ne}var Ie={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){Ie[a]=new fe(a,0,!1,a,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var l=a[0];Ie[l]=new fe(l,1,!1,a[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(a){Ie[a]=new fe(a,2,!1,a.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){Ie[a]=new fe(a,2,!1,a,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){Ie[a]=new fe(a,3,!1,a.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(a){Ie[a]=new fe(a,3,!0,a,null,!1,!1)}),["capture","download"].forEach(function(a){Ie[a]=new fe(a,4,!1,a,null,!1,!1)}),["cols","rows","size","span"].forEach(function(a){Ie[a]=new fe(a,6,!1,a,null,!1,!1)}),["rowSpan","start"].forEach(function(a){Ie[a]=new fe(a,5,!1,a.toLowerCase(),null,!1,!1)});var Be=/[\-:]([a-z])/g;function Ce(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var l=a.replace(Be,Ce);Ie[l]=new fe(l,1,!1,a,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var l=a.replace(Be,Ce);Ie[l]=new fe(l,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(a){var l=a.replace(Be,Ce);Ie[l]=new fe(l,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(a){Ie[a]=new fe(a,1,!1,a.toLowerCase(),null,!1,!1)}),Ie.xlinkHref=new fe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(a){Ie[a]=new fe(a,1,!1,a.toLowerCase(),null,!0,!0)});function Ge(a,l,g,I){var z=Ie.hasOwnProperty(l)?Ie[l]:null;(z!==null?z.type!==0:I||!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(le(l,g,z,I)&&(g=null),I||z===null?q(l)&&(g===null?a.removeAttribute(l):a.setAttribute(l,""+g)):z.mustUseProperty?a[z.propertyName]=g===null?z.type===3?!1:"":g:(l=z.attributeName,I=z.attributeNamespace,g===null?a.removeAttribute(l):(z=z.type,g=z===3||z===4&&g===!0?"":""+g,I?a.setAttributeNS(I,l,g):a.setAttribute(l,g))))}var it=k.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,We=Symbol.for("react.element"),tt=Symbol.for("react.portal"),at=Symbol.for("react.fragment"),ht=Symbol.for("react.strict_mode"),ft=Symbol.for("react.profiler"),$t=Symbol.for("react.provider"),wt=Symbol.for("react.context"),Zt=Symbol.for("react.forward_ref"),Bt=Symbol.for("react.suspense"),je=Symbol.for("react.suspense_list"),zt=Symbol.for("react.memo"),an=Symbol.for("react.lazy"),rn=Symbol.for("react.offscreen"),bt=Symbol.iterator;function jt(a){return a===null||typeof a!="object"?null:(a=bt&&a[bt]||a["@@iterator"],typeof a=="function"?a:null)}var nt=Object.assign,Re;function rt(a){if(Re===void 0)try{throw Error()}catch(g){var l=g.stack.trim().match(/\n( *(at )?)/);Re=l&&l[1]||""}return`
`+Re+a}var on=!1;function Pt(a,l){if(!a||on)return"";on=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(l)if(l=function(){throw Error()},Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(Je){var I=Je}Reflect.construct(a,[],l)}else{try{l.call()}catch(Je){I=Je}a.call(l.prototype)}else{try{throw Error()}catch(Je){I=Je}a()}}catch(Je){if(Je&&I&&typeof Je.stack=="string"){for(var z=Je.stack.split(`
`),j=I.stack.split(`
`),ne=z.length-1,xe=j.length-1;1<=ne&&0<=xe&&z[ne]!==j[xe];)xe--;for(;1<=ne&&0<=xe;ne--,xe--)if(z[ne]!==j[xe]){if(ne!==1||xe!==1)do if(ne--,xe--,0>xe||z[ne]!==j[xe]){var Pe=`
`+z[ne].replace(" at new "," at ");return a.displayName&&Pe.includes("<anonymous>")&&(Pe=Pe.replace("<anonymous>",a.displayName)),Pe}while(1<=ne&&0<=xe);break}}}finally{on=!1,Error.prepareStackTrace=g}return(a=a?a.displayName||a.name:"")?rt(a):""}function yn(a){switch(a.tag){case 5:return rt(a.type);case 16:return rt("Lazy");case 13:return rt("Suspense");case 19:return rt("SuspenseList");case 0:case 2:case 15:return a=Pt(a.type,!1),a;case 11:return a=Pt(a.type.render,!1),a;case 1:return a=Pt(a.type,!0),a;default:return""}}function Dn(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case at:return"Fragment";case tt:return"Portal";case ft:return"Profiler";case ht:return"StrictMode";case Bt:return"Suspense";case je:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case wt:return(a.displayName||"Context")+".Consumer";case $t:return(a._context.displayName||"Context")+".Provider";case Zt:var l=a.render;return a=a.displayName,a||(a=l.displayName||l.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case zt:return l=a.displayName||null,l!==null?l:Dn(a.type)||"Memo";case an:l=a._payload,a=a._init;try{return Dn(a(l))}catch{}}return null}function Rn(a){var l=a.type;switch(a.tag){case 24:return"Cache";case 9:return(l.displayName||"Context")+".Consumer";case 10:return(l._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=l.render,a=a.displayName||a.name||"",l.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return l;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Dn(l);case 8:return l===ht?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l}return null}function Ne(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function ei(a){var l=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function Cn(a){var l=ei(a)?"checked":"value",g=Object.getOwnPropertyDescriptor(a.constructor.prototype,l),I=""+a[l];if(!a.hasOwnProperty(l)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var z=g.get,j=g.set;return Object.defineProperty(a,l,{configurable:!0,get:function(){return z.call(this)},set:function(ne){I=""+ne,j.call(this,ne)}}),Object.defineProperty(a,l,{enumerable:g.enumerable}),{getValue:function(){return I},setValue:function(ne){I=""+ne},stopTracking:function(){a._valueTracker=null,delete a[l]}}}}function Kt(a){a._valueTracker||(a._valueTracker=Cn(a))}function we(a){if(!a)return!1;var l=a._valueTracker;if(!l)return!0;var g=l.getValue(),I="";return a&&(I=ei(a)?a.checked?"true":"false":a.value),a=I,a!==g?(l.setValue(a),!0):!1}function $i(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function Vr(a,l){var g=l.checked;return nt({},l,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:g??a._wrapperState.initialChecked})}function Rr(a,l){var g=l.defaultValue==null?"":l.defaultValue,I=l.checked!=null?l.checked:l.defaultChecked;g=Ne(l.value!=null?l.value:g),a._wrapperState={initialChecked:I,initialValue:g,controlled:l.type==="checkbox"||l.type==="radio"?l.checked!=null:l.value!=null}}function Ye(a,l){l=l.checked,l!=null&&Ge(a,"checked",l,!1)}function ds(a,l){Ye(a,l);var g=Ne(l.value),I=l.type;if(g!=null)I==="number"?(g===0&&a.value===""||a.value!=g)&&(a.value=""+g):a.value!==""+g&&(a.value=""+g);else if(I==="submit"||I==="reset"){a.removeAttribute("value");return}l.hasOwnProperty("value")?lt(a,l.type,g):l.hasOwnProperty("defaultValue")&&lt(a,l.type,Ne(l.defaultValue)),l.checked==null&&l.defaultChecked!=null&&(a.defaultChecked=!!l.defaultChecked)}function Co(a,l,g){if(l.hasOwnProperty("value")||l.hasOwnProperty("defaultValue")){var I=l.type;if(!(I!=="submit"&&I!=="reset"||l.value!==void 0&&l.value!==null))return;l=""+a._wrapperState.initialValue,g||l===a.value||(a.value=l),a.defaultValue=l}g=a.name,g!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,g!==""&&(a.name=g)}function lt(a,l,g){(l!=="number"||$i(a.ownerDocument)!==a)&&(g==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+g&&(a.defaultValue=""+g))}var ai=Array.isArray;function ps(a,l,g,I){if(a=a.options,l){l={};for(var z=0;z<g.length;z++)l["$"+g[z]]=!0;for(g=0;g<a.length;g++)z=l.hasOwnProperty("$"+a[g].value),a[g].selected!==z&&(a[g].selected=z),z&&I&&(a[g].defaultSelected=!0)}else{for(g=""+Ne(g),l=null,z=0;z<a.length;z++){if(a[z].value===g){a[z].selected=!0,I&&(a[z].defaultSelected=!0);return}l!==null||a[z].disabled||(l=a[z])}l!==null&&(l.selected=!0)}}function pr(a,l){if(l.dangerouslySetInnerHTML!=null)throw Error(S(91));return nt({},l,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function As(a,l){var g=l.value;if(g==null){if(g=l.children,l=l.defaultValue,g!=null){if(l!=null)throw Error(S(92));if(ai(g)){if(1<g.length)throw Error(S(93));g=g[0]}l=g}l==null&&(l=""),g=l}a._wrapperState={initialValue:Ne(g)}}function vn(a,l){var g=Ne(l.value),I=Ne(l.defaultValue);g!=null&&(g=""+g,g!==a.value&&(a.value=g),l.defaultValue==null&&a.defaultValue!==g&&(a.defaultValue=g)),I!=null&&(a.defaultValue=""+I)}function ir(a){var l=a.textContent;l===a._wrapperState.initialValue&&l!==""&&l!==null&&(a.value=l)}function aa(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function oa(a,l){return a==null||a==="http://www.w3.org/1999/xhtml"?aa(l):a==="http://www.w3.org/2000/svg"&&l==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var Qe,Ur=(function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(l,g,I,z){MSApp.execUnsafeLocalFunction(function(){return a(l,g,I,z)})}:a})(function(a,l){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=l;else{for(Qe=Qe||document.createElement("div"),Qe.innerHTML="<svg>"+l.valueOf().toString()+"</svg>",l=Qe.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;l.firstChild;)a.appendChild(l.firstChild)}});function dn(a,l){if(l){var g=a.firstChild;if(g&&g===a.lastChild&&g.nodeType===3){g.nodeValue=l;return}}a.textContent=l}var tn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Aa=["Webkit","ms","Moz","O"];Object.keys(tn).forEach(function(a){Aa.forEach(function(l){l=l+a.charAt(0).toUpperCase()+a.substring(1),tn[l]=tn[a]})});function _t(a,l,g){return l==null||typeof l=="boolean"||l===""?"":g||typeof l!="number"||l===0||tn.hasOwnProperty(a)&&tn[a]?(""+l).trim():l+"px"}function In(a,l){a=a.style;for(var g in l)if(l.hasOwnProperty(g)){var I=g.indexOf("--")===0,z=_t(g,l[g],I);g==="float"&&(g="cssFloat"),I?a.setProperty(g,z):a[g]=z}}var pt=nt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mr(a,l){if(l){if(pt[a]&&(l.children!=null||l.dangerouslySetInnerHTML!=null))throw Error(S(137,a));if(l.dangerouslySetInnerHTML!=null){if(l.children!=null)throw Error(S(60));if(typeof l.dangerouslySetInnerHTML!="object"||!("__html"in l.dangerouslySetInnerHTML))throw Error(S(61))}if(l.style!=null&&typeof l.style!="object")throw Error(S(62))}}function qr(a,l){if(a.indexOf("-")===-1)return typeof l.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var pn=null;function Si(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Sr=null,Ai=null,gr=null;function _e(a){if(a=du(a)){if(typeof Sr!="function")throw Error(S(280));var l=a.stateNode;l&&(l=pu(l),Sr(a.stateNode,a.type,l))}}function K(a){Ai?gr?gr.push(a):gr=[a]:Ai=a}function Y(){if(Ai){var a=Ai,l=gr;if(gr=Ai=null,_e(a),l)for(a=0;a<l.length;a++)_e(l[a])}}function oe(a,l){return a(l)}function ae(){}var Ee=!1;function Me(a,l,g){if(Ee)return a(l,g);Ee=!0;try{return oe(a,l,g)}finally{Ee=!1,(Ai!==null||gr!==null)&&(ae(),Y())}}function Fe(a,l){var g=a.stateNode;if(g===null)return null;var I=pu(g);if(I===null)return null;g=I[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(a=a.type,I=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!I;break e;default:a=!1}if(a)return null;if(g&&typeof g!="function")throw Error(S(231,l,typeof g));return g}var ke=!1;if(c)try{var Ke={};Object.defineProperty(Ke,"passive",{get:function(){ke=!0}}),window.addEventListener("test",Ke,Ke),window.removeEventListener("test",Ke,Ke)}catch{ke=!1}function ut(a,l,g,I,z,j,ne,xe,Pe){var Je=Array.prototype.slice.call(arguments,3);try{l.apply(g,Je)}catch(gt){this.onError(gt)}}var Ze=!1,vt=null,Ut=!1,Qt=null,Fn={onError:function(a){Ze=!0,vt=a}};function bn(a,l,g,I,z,j,ne,xe,Pe){Ze=!1,vt=null,ut.apply(Fn,arguments)}function kn(a,l,g,I,z,j,ne,xe,Pe){if(bn.apply(this,arguments),Ze){if(Ze){var Je=vt;Ze=!1,vt=null}else throw Error(S(198));Ut||(Ut=!0,Qt=Je)}}function Sn(a){var l=a,g=a;if(a.alternate)for(;l.return;)l=l.return;else{a=l;do l=a,(l.flags&4098)!==0&&(g=l.return),a=l.return;while(a)}return l.tag===3?g:null}function pi(a){if(a.tag===13){var l=a.memoizedState;if(l===null&&(a=a.alternate,a!==null&&(l=a.memoizedState)),l!==null)return l.dehydrated}return null}function ti(a){if(Sn(a)!==a)throw Error(S(188))}function xn(a){var l=a.alternate;if(!l){if(l=Sn(a),l===null)throw Error(S(188));return l!==a?null:a}for(var g=a,I=l;;){var z=g.return;if(z===null)break;var j=z.alternate;if(j===null){if(I=z.return,I!==null){g=I;continue}break}if(z.child===j.child){for(j=z.child;j;){if(j===g)return ti(z),a;if(j===I)return ti(z),l;j=j.sibling}throw Error(S(188))}if(g.return!==I.return)g=z,I=j;else{for(var ne=!1,xe=z.child;xe;){if(xe===g){ne=!0,g=z,I=j;break}if(xe===I){ne=!0,I=z,g=j;break}xe=xe.sibling}if(!ne){for(xe=j.child;xe;){if(xe===g){ne=!0,g=j,I=z;break}if(xe===I){ne=!0,I=j,g=z;break}xe=xe.sibling}if(!ne)throw Error(S(189))}}if(g.alternate!==I)throw Error(S(190))}if(g.tag!==3)throw Error(S(188));return g.stateNode.current===g?a:l}function Hn(a){return a=xn(a),a!==null?ri(a):null}function ri(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var l=ri(a);if(l!==null)return l;a=a.sibling}return null}var Ei=w.unstable_scheduleCallback,Bn=w.unstable_cancelCallback,Er=w.unstable_shouldYield,Po=w.unstable_requestPaint,fn=w.unstable_now,Ha=w.unstable_getCurrentPriorityLevel,Xa=w.unstable_ImmediatePriority,yr=w.unstable_UserBlockingPriority,rr=w.unstable_NormalPriority,hc=w.unstable_LowPriority,Ii=w.unstable_IdlePriority,Bi=null,sr=null;function Qr(a){if(sr&&typeof sr.onCommitFiberRoot=="function")try{sr.onCommitFiberRoot(Bi,a,void 0,(a.current.flags&128)===128)}catch{}}var Wn=Math.clz32?Math.clz32:ji,Xo=Math.log,ms=Math.LN2;function ji(a){return a>>>=0,a===0?32:31-(Xo(a)/ms|0)|0}var La=64,Ir=4194304;function Ls(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function Li(a,l){var g=a.pendingLanes;if(g===0)return 0;var I=0,z=a.suspendedLanes,j=a.pingedLanes,ne=g&268435455;if(ne!==0){var xe=ne&~z;xe!==0?I=Ls(xe):(j&=ne,j!==0&&(I=Ls(j)))}else ne=g&~z,ne!==0?I=Ls(ne):j!==0&&(I=Ls(j));if(I===0)return 0;if(l!==0&&l!==I&&(l&z)===0&&(z=I&-I,j=l&-l,z>=j||z===16&&(j&4194240)!==0))return l;if((I&4)!==0&&(I|=g&16),l=a.entangledLanes,l!==0)for(a=a.entanglements,l&=I;0<l;)g=31-Wn(l),z=1<<g,I|=a[g],l&=~z;return I}function Ra(a,l){switch(a){case 1:case 2:case 4:return l+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Wo(a,l){for(var g=a.suspendedLanes,I=a.pingedLanes,z=a.expirationTimes,j=a.pendingLanes;0<j;){var ne=31-Wn(j),xe=1<<ne,Pe=z[ne];Pe===-1?((xe&g)===0||(xe&I)!==0)&&(z[ne]=Ra(xe,l)):Pe<=l&&(a.expiredLanes|=xe),j&=~xe}}function Nr(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function la(){var a=La;return La<<=1,(La&4194240)===0&&(La=64),a}function Un(a){for(var l=[],g=0;31>g;g++)l.push(a);return l}function Wa(a,l,g){a.pendingLanes|=l,l!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,l=31-Wn(l),a[l]=g}function au(a,l){var g=a.pendingLanes&~l;a.pendingLanes=l,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=l,a.mutableReadLanes&=l,a.entangledLanes&=l,l=a.entanglements;var I=a.eventTimes;for(a=a.expirationTimes;0<g;){var z=31-Wn(g),j=1<<z;l[z]=0,I[z]=-1,a[z]=-1,g&=~j}}function ua(a,l){var g=a.entangledLanes|=l;for(a=a.entanglements;g;){var I=31-Wn(g),z=1<<I;z&l|a[I]&l&&(a[I]|=l),g&=~z}}var qn=0;function Mo(a){return a&=-a,1<a?4<a?(a&268435455)!==0?16:536870912:4:1}var Ao,Ya,Ka,Yo,mi,Rs=!1,yl=[],_r=null,Ti=null,Yn=null,Vi=new Map,Na=new Map,gs=[],Ko="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lo(a,l){switch(a){case"focusin":case"focusout":_r=null;break;case"dragenter":case"dragleave":Ti=null;break;case"mouseover":case"mouseout":Yn=null;break;case"pointerover":case"pointerout":Vi.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":Na.delete(l.pointerId)}}function Ns(a,l,g,I,z,j){return a===null||a.nativeEvent!==j?(a={blockedOn:l,domEventName:g,eventSystemFlags:I,nativeEvent:j,targetContainers:[z]},l!==null&&(l=du(l),l!==null&&Ya(l)),a):(a.eventSystemFlags|=I,l=a.targetContainers,z!==null&&l.indexOf(z)===-1&&l.push(z),a)}function Lu(a,l,g,I,z){switch(l){case"focusin":return _r=Ns(_r,a,l,g,I,z),!0;case"dragenter":return Ti=Ns(Ti,a,l,g,I,z),!0;case"mouseover":return Yn=Ns(Yn,a,l,g,I,z),!0;case"pointerover":var j=z.pointerId;return Vi.set(j,Ns(Vi.get(j)||null,a,l,g,I,z)),!0;case"gotpointercapture":return j=z.pointerId,Na.set(j,Ns(Na.get(j)||null,a,l,g,I,z)),!0}return!1}function Xn(a){var l=mo(a.target);if(l!==null){var g=Sn(l);if(g!==null){if(l=g.tag,l===13){if(l=pi(g),l!==null){a.blockedOn=l,mi(a.priority,function(){Ka(g)});return}}else if(l===3&&g.stateNode.current.memoizedState.isDehydrated){a.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}a.blockedOn=null}function zr(a){if(a.blockedOn!==null)return!1;for(var l=a.targetContainers;0<l.length;){var g=Ro(a.domEventName,a.eventSystemFlags,l[0],a.nativeEvent);if(g===null){g=a.nativeEvent;var I=new g.constructor(g.type,g);pn=I,g.target.dispatchEvent(I),pn=null}else return l=du(g),l!==null&&Ya(l),a.blockedOn=g,!1;l.shift()}return!0}function _l(a,l,g){zr(a)&&g.delete(l)}function Ru(){Rs=!1,_r!==null&&zr(_r)&&(_r=null),Ti!==null&&zr(Ti)&&(Ti=null),Yn!==null&&zr(Yn)&&(Yn=null),Vi.forEach(_l),Na.forEach(_l)}function zs(a,l){a.blockedOn===l&&(a.blockedOn=null,Rs||(Rs=!0,w.unstable_scheduleCallback(w.unstable_NormalPriority,Ru)))}function Ds(a){function l(z){return zs(z,a)}if(0<yl.length){zs(yl[0],a);for(var g=1;g<yl.length;g++){var I=yl[g];I.blockedOn===a&&(I.blockedOn=null)}}for(_r!==null&&zs(_r,a),Ti!==null&&zs(Ti,a),Yn!==null&&zs(Yn,a),Vi.forEach(l),Na.forEach(l),g=0;g<gs.length;g++)I=gs[g],I.blockedOn===a&&(I.blockedOn=null);for(;0<gs.length&&(g=gs[0],g.blockedOn===null);)Xn(g),g.blockedOn===null&&gs.shift()}var Ri=it.ReactCurrentBatchConfig,za=!0;function Jo(a,l,g,I){var z=qn,j=Ri.transition;Ri.transition=null;try{qn=1,Gr(a,l,g,I)}finally{qn=z,Ri.transition=j}}function vl(a,l,g,I){var z=qn,j=Ri.transition;Ri.transition=null;try{qn=4,Gr(a,l,g,I)}finally{qn=z,Ri.transition=j}}function Gr(a,l,g,I){if(za){var z=Ro(a,l,g,I);if(z===null)fu(a,l,I,xl,g),Lo(a,I);else if(Lu(z,a,l,g,I))I.stopPropagation();else if(Lo(a,I),l&4&&-1<Ko.indexOf(a)){for(;z!==null;){var j=du(z);if(j!==null&&Ao(j),j=Ro(a,l,g,I),j===null&&fu(a,l,I,xl,g),j===z)break;z=j}z!==null&&I.stopPropagation()}else fu(a,l,I,null,g)}}var xl=null;function Ro(a,l,g,I){if(xl=null,a=Si(I),a=mo(a),a!==null)if(l=Sn(a),l===null)a=null;else if(g=l.tag,g===13){if(a=pi(l),a!==null)return a;a=null}else if(g===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;a=null}else l!==a&&(a=null);return xl=a,null}function vr(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ha()){case Xa:return 1;case yr:return 4;case rr:case hc:return 16;case Ii:return 536870912;default:return 16}default:return 16}}var Ji=null,Gn=null,Qi=null;function Ja(){if(Qi)return Qi;var a,l=Gn,g=l.length,I,z="value"in Ji?Ji.value:Ji.textContent,j=z.length;for(a=0;a<g&&l[a]===z[a];a++);var ne=g-a;for(I=1;I<=ne&&l[g-I]===z[j-I];I++);return Qi=z.slice(a,1<I?1-I:void 0)}function ca(a){var l=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&l===13&&(a=13)):a=l,a===10&&(a=13),32<=a||a===13?a:0}function ha(){return!0}function wl(){return!1}function er(a){function l(g,I,z,j,ne){this._reactName=g,this._targetInst=z,this.type=I,this.nativeEvent=j,this.target=ne,this.currentTarget=null;for(var xe in a)a.hasOwnProperty(xe)&&(g=a[xe],this[xe]=g?g(j):j[xe]);return this.isDefaultPrevented=(j.defaultPrevented!=null?j.defaultPrevented:j.returnValue===!1)?ha:wl,this.isPropagationStopped=wl,this}return nt(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=ha)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=ha)},persist:function(){},isPersistent:ha}),l}var Qa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Dr=er(Qa),eo=nt({},Qa,{view:0,detail:0}),Nu=er(eo),bl,kl,ys,Qo=nt({},eo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nl,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==ys&&(ys&&a.type==="mousemove"?(bl=a.screenX-ys.screenX,kl=a.screenY-ys.screenY):kl=bl=0,ys=a),bl)},movementY:function(a){return"movementY"in a?a.movementY:kl}}),zu=er(Qo),Du=nt({},Qo,{dataTransfer:0}),_s=er(Du),$r=nt({},eo,{relatedTarget:0}),No=er($r),Ou=nt({},Qa,{animationName:0,elapsedTime:0,pseudoElement:0}),fc=er(Ou),Sl=nt({},Qa,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),ou=er(Sl),El=nt({},Qa,{data:0}),el=er(El),es={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},tl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ui={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function to(a){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(a):(a=Ui[a])?!!l[a]:!1}function nl(){return to}var Il=nt({},eo,{key:function(a){if(a.key){var l=es[a.key]||a.key;if(l!=="Unidentified")return l}return a.type==="keypress"?(a=ca(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?tl[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nl,charCode:function(a){return a.type==="keypress"?ca(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?ca(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),il=er(Il),Tl=nt({},Qo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Os=er(Tl),lu=nt({},eo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nl}),dc=er(lu),Ni=nt({},Qa,{propertyName:0,elapsedTime:0,pseudoElement:0}),pc=er(Ni),Mn=nt({},Qo,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Cl=er(Mn),oi=[9,13,27,32],Qn=c&&"CompositionEvent"in window,ts=null;c&&"documentMode"in document&&(ts=document.documentMode);var rl=c&&"TextEvent"in window&&!ts,no=c&&(!Qn||ts&&8<ts&&11>=ts),Pl=" ",Da=!1;function io(a,l){switch(a){case"keyup":return oi.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Zr(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Oa=!1;function uu(a,l){switch(a){case"compositionend":return Zr(l);case"keypress":return l.which!==32?null:(Da=!0,Pl);case"textInput":return a=l.data,a===Pl&&Da?null:a;default:return null}}function cu(a,l){if(Oa)return a==="compositionend"||!Qn&&io(a,l)?(a=Ja(),Qi=Gn=Ji=null,Oa=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return no&&l.locale!=="ko"?null:l.data;default:return null}}var Fa={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ro(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l==="input"?!!Fa[a.type]:l==="textarea"}function so(a,l,g,I){K(I),l=Rl(l,"onChange"),0<l.length&&(g=new Dr("onChange","change",null,g,I),a.push({event:g,listeners:l}))}var Fs=null,Bs=null;function zo(a){Bu(a,0)}function fa(a){var l=ga(a);if(we(l))return a}function ao(a,l){if(a==="change")return l}var Ml=!1;if(c){var sl;if(c){var jn="oninput"in document;if(!jn){var js=document.createElement("div");js.setAttribute("oninput","return;"),jn=typeof js.oninput=="function"}sl=jn}else sl=!1;Ml=sl&&(!document.documentMode||9<document.documentMode)}function Fu(){Fs&&(Fs.detachEvent("onpropertychange",Al),Bs=Fs=null)}function Al(a){if(a.propertyName==="value"&&fa(Bs)){var l=[];so(l,Bs,a,Si(a)),Me(zo,l)}}function ar(a,l,g){a==="focusin"?(Fu(),Fs=l,Bs=g,Fs.attachEvent("onpropertychange",Al)):a==="focusout"&&Fu()}function vs(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return fa(Bs)}function f(a,l){if(a==="click")return fa(l)}function i(a,l){if(a==="input"||a==="change")return fa(l)}function s(a,l){return a===l&&(a!==0||1/a===1/l)||a!==a&&l!==l}var h=typeof Object.is=="function"?Object.is:s;function b(a,l){if(h(a,l))return!0;if(typeof a!="object"||a===null||typeof l!="object"||l===null)return!1;var g=Object.keys(a),I=Object.keys(l);if(g.length!==I.length)return!1;for(I=0;I<g.length;I++){var z=g[I];if(!W.call(l,z)||!h(a[z],l[z]))return!1}return!0}function R(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function B(a,l){var g=R(a);a=0;for(var I;g;){if(g.nodeType===3){if(I=a+g.textContent.length,a<=l&&I>=l)return{node:g,offset:l-a};a=I}e:{for(;g;){if(g.nextSibling){g=g.nextSibling;break e}g=g.parentNode}g=void 0}g=R(g)}}function H(a,l){return a&&l?a===l?!0:a&&a.nodeType===3?!1:l&&l.nodeType===3?H(a,l.parentNode):"contains"in a?a.contains(l):a.compareDocumentPosition?!!(a.compareDocumentPosition(l)&16):!1:!1}function re(){for(var a=window,l=$i();l instanceof a.HTMLIFrameElement;){try{var g=typeof l.contentWindow.location.href=="string"}catch{g=!1}if(g)a=l.contentWindow;else break;l=$i(a.document)}return l}function de(a){var l=a&&a.nodeName&&a.nodeName.toLowerCase();return l&&(l==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||l==="textarea"||a.contentEditable==="true")}function De(a){var l=re(),g=a.focusedElem,I=a.selectionRange;if(l!==g&&g&&g.ownerDocument&&H(g.ownerDocument.documentElement,g)){if(I!==null&&de(g)){if(l=I.start,a=I.end,a===void 0&&(a=l),"selectionStart"in g)g.selectionStart=l,g.selectionEnd=Math.min(a,g.value.length);else if(a=(l=g.ownerDocument||document)&&l.defaultView||window,a.getSelection){a=a.getSelection();var z=g.textContent.length,j=Math.min(I.start,z);I=I.end===void 0?j:Math.min(I.end,z),!a.extend&&j>I&&(z=I,I=j,j=z),z=B(g,j);var ne=B(g,I);z&&ne&&(a.rangeCount!==1||a.anchorNode!==z.node||a.anchorOffset!==z.offset||a.focusNode!==ne.node||a.focusOffset!==ne.offset)&&(l=l.createRange(),l.setStart(z.node,z.offset),a.removeAllRanges(),j>I?(a.addRange(l),a.extend(ne.node,ne.offset)):(l.setEnd(ne.node,ne.offset),a.addRange(l)))}}for(l=[],a=g;a=a.parentNode;)a.nodeType===1&&l.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof g.focus=="function"&&g.focus(),g=0;g<l.length;g++)a=l[g],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var $e=c&&"documentMode"in document&&11>=document.documentMode,ct=null,At=null,Ht=null,ln=!1;function Nn(a,l,g){var I=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;ln||ct==null||ct!==$i(I)||(I=ct,"selectionStart"in I&&de(I)?I={start:I.selectionStart,end:I.selectionEnd}:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection(),I={anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}),Ht&&b(Ht,I)||(Ht=I,I=Rl(At,"onSelect"),0<I.length&&(l=new Dr("onSelect","select",null,l,g),a.push({event:l,listeners:I}),l.target=ct)))}function An(a,l){var g={};return g[a.toLowerCase()]=l.toLowerCase(),g["Webkit"+a]="webkit"+l,g["Moz"+a]="moz"+l,g}var Vn={animationend:An("Animation","AnimationEnd"),animationiteration:An("Animation","AnimationIteration"),animationstart:An("Animation","AnimationStart"),transitionend:An("Transition","TransitionEnd")},Ci={},Kn={};c&&(Kn=document.createElement("div").style,"AnimationEvent"in window||(delete Vn.animationend.animation,delete Vn.animationiteration.animation,delete Vn.animationstart.animation),"TransitionEvent"in window||delete Vn.transitionend.transition);function xr(a){if(Ci[a])return Ci[a];if(!Vn[a])return a;var l=Vn[a],g;for(g in l)if(l.hasOwnProperty(g)&&g in Kn)return Ci[a]=l[g];return a}var oo=xr("animationend"),Ll=xr("animationiteration"),xi=xr("animationstart"),Hr=xr("transitionend"),Tr=new Map,lo="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xs(a,l){Tr.set(a,l),N(l,[a])}for(var Ba=0;Ba<lo.length;Ba++){var Vs=lo[Ba],uo=Vs.toLowerCase(),mc=Vs[0].toUpperCase()+Vs.slice(1);xs(uo,"on"+mc)}xs(oo,"onAnimationEnd"),xs(Ll,"onAnimationIteration"),xs(xi,"onAnimationStart"),xs("dblclick","onDoubleClick"),xs("focusin","onFocus"),xs("focusout","onBlur"),xs(Hr,"onTransitionEnd"),L("onMouseEnter",["mouseout","mouseover"]),L("onMouseLeave",["mouseout","mouseover"]),L("onPointerEnter",["pointerout","pointerover"]),L("onPointerLeave",["pointerout","pointerover"]),N("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),N("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),N("onBeforeInput",["compositionend","keypress","textInput","paste"]),N("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),N("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),N("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Do="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),gc=new Set("cancel close invalid load scroll toggle".split(" ").concat(Do));function hu(a,l,g){var I=a.type||"unknown-event";a.currentTarget=g,kn(I,l,void 0,a),a.currentTarget=null}function Bu(a,l){l=(l&4)!==0;for(var g=0;g<a.length;g++){var I=a[g],z=I.event;I=I.listeners;e:{var j=void 0;if(l)for(var ne=I.length-1;0<=ne;ne--){var xe=I[ne],Pe=xe.instance,Je=xe.currentTarget;if(xe=xe.listener,Pe!==j&&z.isPropagationStopped())break e;hu(z,xe,Je),j=Pe}else for(ne=0;ne<I.length;ne++){if(xe=I[ne],Pe=xe.instance,Je=xe.currentTarget,xe=xe.listener,Pe!==j&&z.isPropagationStopped())break e;hu(z,xe,Je),j=Pe}}}if(Ut)throw a=Qt,Ut=!1,Qt=null,a}function gi(a,l){var g=l[zn];g===void 0&&(g=l[zn]=new Set);var I=a+"__bubble";g.has(I)||(ju(l,a,2,!1),g.add(I))}function co(a,l,g){var I=0;l&&(I|=4),ju(g,a,I,l)}var al="_reactListening"+Math.random().toString(36).slice(2);function ho(a){if(!a[al]){a[al]=!0,E.forEach(function(g){g!=="selectionchange"&&(gc.has(g)||co(g,!1,a),co(g,!0,a))});var l=a.nodeType===9?a:a.ownerDocument;l===null||l[al]||(l[al]=!0,co("selectionchange",!1,l))}}function ju(a,l,g,I){switch(vr(l)){case 1:var z=Jo;break;case 4:z=vl;break;default:z=Gr}g=z.bind(null,l,g,a),z=void 0,!ke||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(z=!0),I?z!==void 0?a.addEventListener(l,g,{capture:!0,passive:z}):a.addEventListener(l,g,!0):z!==void 0?a.addEventListener(l,g,{passive:z}):a.addEventListener(l,g,!1)}function fu(a,l,g,I,z){var j=I;if((l&1)===0&&(l&2)===0&&I!==null)e:for(;;){if(I===null)return;var ne=I.tag;if(ne===3||ne===4){var xe=I.stateNode.containerInfo;if(xe===z||xe.nodeType===8&&xe.parentNode===z)break;if(ne===4)for(ne=I.return;ne!==null;){var Pe=ne.tag;if((Pe===3||Pe===4)&&(Pe=ne.stateNode.containerInfo,Pe===z||Pe.nodeType===8&&Pe.parentNode===z))return;ne=ne.return}for(;xe!==null;){if(ne=mo(xe),ne===null)return;if(Pe=ne.tag,Pe===5||Pe===6){I=j=ne;continue e}xe=xe.parentNode}}I=I.return}Me(function(){var Je=j,gt=Si(g),xt=[];e:{var mt=Tr.get(a);if(mt!==void 0){var Rt=Dr,Xt=a;switch(a){case"keypress":if(ca(g)===0)break e;case"keydown":case"keyup":Rt=il;break;case"focusin":Xt="focus",Rt=No;break;case"focusout":Xt="blur",Rt=No;break;case"beforeblur":case"afterblur":Rt=No;break;case"click":if(g.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Rt=zu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Rt=_s;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Rt=dc;break;case oo:case Ll:case xi:Rt=fc;break;case Hr:Rt=pc;break;case"scroll":Rt=Nu;break;case"wheel":Rt=Cl;break;case"copy":case"cut":case"paste":Rt=ou;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Rt=Os}var nn=(l&4)!==0,tr=!nn&&a==="scroll",He=nn?mt!==null?mt+"Capture":null:mt;nn=[];for(var ze=Je,Xe;ze!==null;){Xe=ze;var Tt=Xe.stateNode;if(Xe.tag===5&&Tt!==null&&(Xe=Tt,He!==null&&(Tt=Fe(ze,He),Tt!=null&&nn.push(ol(ze,Tt,Xe)))),tr)break;ze=ze.return}0<nn.length&&(mt=new Rt(mt,Xt,null,g,gt),xt.push({event:mt,listeners:nn}))}}if((l&7)===0){e:{if(mt=a==="mouseover"||a==="pointerover",Rt=a==="mouseout"||a==="pointerout",mt&&g!==pn&&(Xt=g.relatedTarget||g.fromElement)&&(mo(Xt)||Xt[ma]))break e;if((Rt||mt)&&(mt=gt.window===gt?gt:(mt=gt.ownerDocument)?mt.defaultView||mt.parentWindow:window,Rt?(Xt=g.relatedTarget||g.toElement,Rt=Je,Xt=Xt?mo(Xt):null,Xt!==null&&(tr=Sn(Xt),Xt!==tr||Xt.tag!==5&&Xt.tag!==6)&&(Xt=null)):(Rt=null,Xt=Je),Rt!==Xt)){if(nn=zu,Tt="onMouseLeave",He="onMouseEnter",ze="mouse",(a==="pointerout"||a==="pointerover")&&(nn=Os,Tt="onPointerLeave",He="onPointerEnter",ze="pointer"),tr=Rt==null?mt:ga(Rt),Xe=Xt==null?mt:ga(Xt),mt=new nn(Tt,ze+"leave",Rt,g,gt),mt.target=tr,mt.relatedTarget=Xe,Tt=null,mo(gt)===Je&&(nn=new nn(He,ze+"enter",Xt,g,gt),nn.target=Xe,nn.relatedTarget=tr,Tt=nn),tr=Tt,Rt&&Xt)t:{for(nn=Rt,He=Xt,ze=0,Xe=nn;Xe;Xe=fo(Xe))ze++;for(Xe=0,Tt=He;Tt;Tt=fo(Tt))Xe++;for(;0<ze-Xe;)nn=fo(nn),ze--;for(;0<Xe-ze;)He=fo(He),Xe--;for(;ze--;){if(nn===He||He!==null&&nn===He.alternate)break t;nn=fo(nn),He=fo(He)}nn=null}else nn=null;Rt!==null&&Nl(xt,mt,Rt,nn,!1),Xt!==null&&tr!==null&&Nl(xt,tr,Xt,nn,!0)}}e:{if(mt=Je?ga(Je):window,Rt=mt.nodeName&&mt.nodeName.toLowerCase(),Rt==="select"||Rt==="input"&&mt.type==="file")var un=ao;else if(ro(mt))if(Ml)un=i;else{un=vs;var _n=ar}else(Rt=mt.nodeName)&&Rt.toLowerCase()==="input"&&(mt.type==="checkbox"||mt.type==="radio")&&(un=f);if(un&&(un=un(a,Je))){so(xt,un,g,gt);break e}_n&&_n(a,mt,Je),a==="focusout"&&(_n=mt._wrapperState)&&_n.controlled&&mt.type==="number"&&lt(mt,"number",mt.value)}switch(_n=Je?ga(Je):window,a){case"focusin":(ro(_n)||_n.contentEditable==="true")&&(ct=_n,At=Je,Ht=null);break;case"focusout":Ht=At=ct=null;break;case"mousedown":ln=!0;break;case"contextmenu":case"mouseup":case"dragend":ln=!1,Nn(xt,g,gt);break;case"selectionchange":if($e)break;case"keydown":case"keyup":Nn(xt,g,gt)}var cn;if(Qn)e:{switch(a){case"compositionstart":var Tn="onCompositionStart";break e;case"compositionend":Tn="onCompositionEnd";break e;case"compositionupdate":Tn="onCompositionUpdate";break e}Tn=void 0}else Oa?io(a,g)&&(Tn="onCompositionEnd"):a==="keydown"&&g.keyCode===229&&(Tn="onCompositionStart");Tn&&(no&&g.locale!=="ko"&&(Oa||Tn!=="onCompositionStart"?Tn==="onCompositionEnd"&&Oa&&(cn=Ja()):(Ji=gt,Gn="value"in Ji?Ji.value:Ji.textContent,Oa=!0)),_n=Rl(Je,Tn),0<_n.length&&(Tn=new el(Tn,a,null,g,gt),xt.push({event:Tn,listeners:_n}),cn?Tn.data=cn:(cn=Zr(g),cn!==null&&(Tn.data=cn)))),(cn=rl?uu(a,g):cu(a,g))&&(Je=Rl(Je,"onBeforeInput"),0<Je.length&&(gt=new el("onBeforeInput","beforeinput",null,g,gt),xt.push({event:gt,listeners:Je}),gt.data=cn))}Bu(xt,l)})}function ol(a,l,g){return{instance:a,listener:l,currentTarget:g}}function Rl(a,l){for(var g=l+"Capture",I=[];a!==null;){var z=a,j=z.stateNode;z.tag===5&&j!==null&&(z=j,j=Fe(a,g),j!=null&&I.unshift(ol(a,j,z)),j=Fe(a,l),j!=null&&I.push(ol(a,j,z))),a=a.return}return I}function fo(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function Nl(a,l,g,I,z){for(var j=l._reactName,ne=[];g!==null&&g!==I;){var xe=g,Pe=xe.alternate,Je=xe.stateNode;if(Pe!==null&&Pe===I)break;xe.tag===5&&Je!==null&&(xe=Je,z?(Pe=Fe(g,j),Pe!=null&&ne.unshift(ol(g,Pe,xe))):z||(Pe=Fe(g,j),Pe!=null&&ne.push(ol(g,Pe,xe)))),g=g.return}ne.length!==0&&a.push({event:l,listeners:ne})}var rh=/\r\n?/g,Us=/\u0000|\uFFFD/g;function da(a){return(typeof a=="string"?a:""+a).replace(rh,`
`).replace(Us,"")}function zl(a,l,g){if(l=da(l),da(a)!==l&&g)throw Error(S(425))}function ns(){}var po=null,yc=null;function _c(a,l){return a==="textarea"||a==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var Vu=typeof setTimeout=="function"?setTimeout:void 0,sh=typeof clearTimeout=="function"?clearTimeout:void 0,Uu=typeof Promise=="function"?Promise:void 0,Dl=typeof queueMicrotask=="function"?queueMicrotask:typeof Uu<"u"?function(a){return Uu.resolve(null).then(a).catch(qs)}:Vu;function qs(a){setTimeout(function(){throw a})}function Ot(a,l){var g=l,I=0;do{var z=g.nextSibling;if(a.removeChild(g),z&&z.nodeType===8)if(g=z.data,g==="/$"){if(I===0){a.removeChild(z),Ds(l);return}I--}else g!=="$"&&g!=="$?"&&g!=="$!"||I++;g=z}while(g);Ds(l)}function pa(a){for(;a!=null;a=a.nextSibling){var l=a.nodeType;if(l===1||l===3)break;if(l===8){if(l=a.data,l==="$"||l==="$!"||l==="$?")break;if(l==="/$")return null}}return a}function qu(a){a=a.previousSibling;for(var l=0;a;){if(a.nodeType===8){var g=a.data;if(g==="$"||g==="$!"||g==="$?"){if(l===0)return a;l--}else g==="/$"&&l++}a=a.previousSibling}return null}var ll=Math.random().toString(36).slice(2),Xr="__reactFiber$"+ll,ja="__reactProps$"+ll,ma="__reactContainer$"+ll,zn="__reactEvents$"+ll,vc="__reactListeners$"+ll,Kh="__reactHandles$"+ll;function mo(a){var l=a[Xr];if(l)return l;for(var g=a.parentNode;g;){if(l=g[ma]||g[Xr]){if(g=l.alternate,l.child!==null||g!==null&&g.child!==null)for(a=qu(a);a!==null;){if(g=a[Xr])return g;a=qu(a)}return l}a=g,g=a.parentNode}return null}function du(a){return a=a[Xr]||a[ma],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function ga(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(S(33))}function pu(a){return a[ja]||null}var mu=[],ul=-1;function Oo(a){return{current:a}}function yi(a){0>ul||(a.current=mu[ul],mu[ul]=null,ul--)}function wi(a,l){ul++,mu[ul]=a.current,a.current=l}var Fo={},ui=Oo(Fo),On=Oo(!1),Gs=Fo;function go(a,l){var g=a.type.contextTypes;if(!g)return Fo;var I=a.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===l)return I.__reactInternalMemoizedMaskedChildContext;var z={},j;for(j in g)z[j]=l[j];return I&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=l,a.__reactInternalMemoizedMaskedChildContext=z),z}function Cr(a){return a=a.childContextTypes,a!=null}function gu(){yi(On),yi(ui)}function Ol(a,l,g){if(ui.current!==Fo)throw Error(S(168));wi(ui,l),wi(On,g)}function Fl(a,l,g){var I=a.stateNode;if(l=l.childContextTypes,typeof I.getChildContext!="function")return g;I=I.getChildContext();for(var z in I)if(!(z in l))throw Error(S(108,Rn(a)||"Unknown",z));return nt({},g,I)}function ws(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Fo,Gs=ui.current,wi(ui,a),wi(On,On.current),!0}function Bl(a,l,g){var I=a.stateNode;if(!I)throw Error(S(169));g?(a=Fl(a,l,Gs),I.__reactInternalMemoizedMergedChildContext=a,yi(On),yi(ui),wi(ui,a)):yi(On),wi(On,g)}var Ft=null,sn=!1,jl=!1;function yu(a){Ft===null?Ft=[a]:Ft.push(a)}function xc(a){sn=!0,yu(a)}function _(){if(!jl&&Ft!==null){jl=!0;var a=0,l=qn;try{var g=Ft;for(qn=1;a<g.length;a++){var I=g[a];do I=I(!0);while(I!==null)}Ft=null,sn=!1}catch(z){throw Ft!==null&&(Ft=Ft.slice(a+1)),Ei(Xa,_),z}finally{qn=l,jl=!1}}return null}var e=[],o=0,d=null,p=0,y=[],P=0,A=null,D=1,V="";function $(a,l){e[o++]=p,e[o++]=d,d=a,p=l}function Z(a,l,g){y[P++]=D,y[P++]=V,y[P++]=A,A=a;var I=D;a=V;var z=32-Wn(I)-1;I&=~(1<<z),g+=1;var j=32-Wn(l)+z;if(30<j){var ne=z-z%5;j=(I&(1<<ne)-1).toString(32),I>>=ne,z-=ne,D=1<<32-Wn(l)+z|g<<z|I,V=j+a}else D=1<<j|g<<z|I,V=a}function te(a){a.return!==null&&($(a,1),Z(a,1,0))}function ue(a){for(;a===d;)d=e[--o],e[o]=null,p=e[--o],e[o]=null;for(;a===A;)A=y[--P],y[P]=null,V=y[--P],y[P]=null,D=y[--P],y[P]=null}var he=null,pe=null,ge=!1,ve=null;function Se(a,l){var g=Ks(5,null,null,0);g.elementType="DELETED",g.stateNode=l,g.return=a,l=a.deletions,l===null?(a.deletions=[g],a.flags|=16):l.push(g)}function me(a,l){switch(a.tag){case 5:var g=a.type;return l=l.nodeType!==1||g.toLowerCase()!==l.nodeName.toLowerCase()?null:l,l!==null?(a.stateNode=l,he=a,pe=pa(l.firstChild),!0):!1;case 6:return l=a.pendingProps===""||l.nodeType!==3?null:l,l!==null?(a.stateNode=l,he=a,pe=null,!0):!1;case 13:return l=l.nodeType!==8?null:l,l!==null?(g=A!==null?{id:D,overflow:V}:null,a.memoizedState={dehydrated:l,treeContext:g,retryLane:1073741824},g=Ks(18,null,null,0),g.stateNode=l,g.return=a,a.child=g,he=a,pe=null,!0):!1;default:return!1}}function Ae(a){return(a.mode&1)!==0&&(a.flags&128)===0}function Oe(a){if(ge){var l=pe;if(l){var g=l;if(!me(a,l)){if(Ae(a))throw Error(S(418));l=pa(g.nextSibling);var I=he;l&&me(a,l)?Se(I,g):(a.flags=a.flags&-4097|2,ge=!1,he=a)}}else{if(Ae(a))throw Error(S(418));a.flags=a.flags&-4097|2,ge=!1,he=a}}}function qe(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;he=a}function ot(a){if(a!==he)return!1;if(!ge)return qe(a),ge=!0,!1;var l;if((l=a.tag!==3)&&!(l=a.tag!==5)&&(l=a.type,l=l!=="head"&&l!=="body"&&!_c(a.type,a.memoizedProps)),l&&(l=pe)){if(Ae(a))throw yt(),Error(S(418));for(;l;)Se(a,l),l=pa(l.nextSibling)}if(qe(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(S(317));e:{for(a=a.nextSibling,l=0;a;){if(a.nodeType===8){var g=a.data;if(g==="/$"){if(l===0){pe=pa(a.nextSibling);break e}l--}else g!=="$"&&g!=="$!"&&g!=="$?"||l++}a=a.nextSibling}pe=null}}else pe=he?pa(a.stateNode.nextSibling):null;return!0}function yt(){for(var a=pe;a;)a=pa(a.nextSibling)}function St(){pe=he=null,ge=!1}function Lt(a){ve===null?ve=[a]:ve.push(a)}var Et=it.ReactCurrentBatchConfig;function kt(a,l,g){if(a=g.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(g._owner){if(g=g._owner,g){if(g.tag!==1)throw Error(S(309));var I=g.stateNode}if(!I)throw Error(S(147,a));var z=I,j=""+a;return l!==null&&l.ref!==null&&typeof l.ref=="function"&&l.ref._stringRef===j?l.ref:(l=function(ne){var xe=z.refs;ne===null?delete xe[j]:xe[j]=ne},l._stringRef=j,l)}if(typeof a!="string")throw Error(S(284));if(!g._owner)throw Error(S(290,a))}return a}function qt(a,l){throw a=Object.prototype.toString.call(l),Error(S(31,a==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":a))}function gn(a){var l=a._init;return l(a._payload)}function It(a){function l(He,ze){if(a){var Xe=He.deletions;Xe===null?(He.deletions=[ze],He.flags|=16):Xe.push(ze)}}function g(He,ze){if(!a)return null;for(;ze!==null;)l(He,ze),ze=ze.sibling;return null}function I(He,ze){for(He=new Map;ze!==null;)ze.key!==null?He.set(ze.key,ze):He.set(ze.index,ze),ze=ze.sibling;return He}function z(He,ze){return He=Jl(He,ze),He.index=0,He.sibling=null,He}function j(He,ze,Xe){return He.index=Xe,a?(Xe=He.alternate,Xe!==null?(Xe=Xe.index,Xe<ze?(He.flags|=2,ze):Xe):(He.flags|=2,ze)):(He.flags|=1048576,ze)}function ne(He){return a&&He.alternate===null&&(He.flags|=2),He}function xe(He,ze,Xe,Tt){return ze===null||ze.tag!==6?(ze=Ga(Xe,He.mode,Tt),ze.return=He,ze):(ze=z(ze,Xe),ze.return=He,ze)}function Pe(He,ze,Xe,Tt){var un=Xe.type;return un===at?gt(He,ze,Xe.props.children,Tt,Xe.key):ze!==null&&(ze.elementType===un||typeof un=="object"&&un!==null&&un.$$typeof===an&&gn(un)===ze.type)?(Tt=z(ze,Xe.props),Tt.ref=kt(He,ze,Xe),Tt.return=He,Tt):(Tt=Xc(Xe.type,Xe.key,Xe.props,null,He.mode,Tt),Tt.ref=kt(He,ze,Xe),Tt.return=He,Tt)}function Je(He,ze,Xe,Tt){return ze===null||ze.tag!==4||ze.stateNode.containerInfo!==Xe.containerInfo||ze.stateNode.implementation!==Xe.implementation?(ze=qo(Xe,He.mode,Tt),ze.return=He,ze):(ze=z(ze,Xe.children||[]),ze.return=He,ze)}function gt(He,ze,Xe,Tt,un){return ze===null||ze.tag!==7?(ze=Ql(Xe,He.mode,Tt,un),ze.return=He,ze):(ze=z(ze,Xe),ze.return=He,ze)}function xt(He,ze,Xe){if(typeof ze=="string"&&ze!==""||typeof ze=="number")return ze=Ga(""+ze,He.mode,Xe),ze.return=He,ze;if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case We:return Xe=Xc(ze.type,ze.key,ze.props,null,He.mode,Xe),Xe.ref=kt(He,null,ze),Xe.return=He,Xe;case tt:return ze=qo(ze,He.mode,Xe),ze.return=He,ze;case an:var Tt=ze._init;return xt(He,Tt(ze._payload),Xe)}if(ai(ze)||jt(ze))return ze=Ql(ze,He.mode,Xe,null),ze.return=He,ze;qt(He,ze)}return null}function mt(He,ze,Xe,Tt){var un=ze!==null?ze.key:null;if(typeof Xe=="string"&&Xe!==""||typeof Xe=="number")return un!==null?null:xe(He,ze,""+Xe,Tt);if(typeof Xe=="object"&&Xe!==null){switch(Xe.$$typeof){case We:return Xe.key===un?Pe(He,ze,Xe,Tt):null;case tt:return Xe.key===un?Je(He,ze,Xe,Tt):null;case an:return un=Xe._init,mt(He,ze,un(Xe._payload),Tt)}if(ai(Xe)||jt(Xe))return un!==null?null:gt(He,ze,Xe,Tt,null);qt(He,Xe)}return null}function Rt(He,ze,Xe,Tt,un){if(typeof Tt=="string"&&Tt!==""||typeof Tt=="number")return He=He.get(Xe)||null,xe(ze,He,""+Tt,un);if(typeof Tt=="object"&&Tt!==null){switch(Tt.$$typeof){case We:return He=He.get(Tt.key===null?Xe:Tt.key)||null,Pe(ze,He,Tt,un);case tt:return He=He.get(Tt.key===null?Xe:Tt.key)||null,Je(ze,He,Tt,un);case an:var _n=Tt._init;return Rt(He,ze,Xe,_n(Tt._payload),un)}if(ai(Tt)||jt(Tt))return He=He.get(Xe)||null,gt(ze,He,Tt,un,null);qt(ze,Tt)}return null}function Xt(He,ze,Xe,Tt){for(var un=null,_n=null,cn=ze,Tn=ze=0,Lr=null;cn!==null&&Tn<Xe.length;Tn++){cn.index>Tn?(Lr=cn,cn=null):Lr=cn.sibling;var si=mt(He,cn,Xe[Tn],Tt);if(si===null){cn===null&&(cn=Lr);break}a&&cn&&si.alternate===null&&l(He,cn),ze=j(si,ze,Tn),_n===null?un=si:_n.sibling=si,_n=si,cn=Lr}if(Tn===Xe.length)return g(He,cn),ge&&$(He,Tn),un;if(cn===null){for(;Tn<Xe.length;Tn++)cn=xt(He,Xe[Tn],Tt),cn!==null&&(ze=j(cn,ze,Tn),_n===null?un=cn:_n.sibling=cn,_n=cn);return ge&&$(He,Tn),un}for(cn=I(He,cn);Tn<Xe.length;Tn++)Lr=Rt(cn,He,Tn,Xe[Tn],Tt),Lr!==null&&(a&&Lr.alternate!==null&&cn.delete(Lr.key===null?Tn:Lr.key),ze=j(Lr,ze,Tn),_n===null?un=Lr:_n.sibling=Lr,_n=Lr);return a&&cn.forEach(function(dl){return l(He,dl)}),ge&&$(He,Tn),un}function nn(He,ze,Xe,Tt){var un=jt(Xe);if(typeof un!="function")throw Error(S(150));if(Xe=un.call(Xe),Xe==null)throw Error(S(151));for(var _n=un=null,cn=ze,Tn=ze=0,Lr=null,si=Xe.next();cn!==null&&!si.done;Tn++,si=Xe.next()){cn.index>Tn?(Lr=cn,cn=null):Lr=cn.sibling;var dl=mt(He,cn,si.value,Tt);if(dl===null){cn===null&&(cn=Lr);break}a&&cn&&dl.alternate===null&&l(He,cn),ze=j(dl,ze,Tn),_n===null?un=dl:_n.sibling=dl,_n=dl,cn=Lr}if(si.done)return g(He,cn),ge&&$(He,Tn),un;if(cn===null){for(;!si.done;Tn++,si=Xe.next())si=xt(He,si.value,Tt),si!==null&&(ze=j(si,ze,Tn),_n===null?un=si:_n.sibling=si,_n=si);return ge&&$(He,Tn),un}for(cn=I(He,cn);!si.done;Tn++,si=Xe.next())si=Rt(cn,He,Tn,si.value,Tt),si!==null&&(a&&si.alternate!==null&&cn.delete(si.key===null?Tn:si.key),ze=j(si,ze,Tn),_n===null?un=si:_n.sibling=si,_n=si);return a&&cn.forEach(function(xp){return l(He,xp)}),ge&&$(He,Tn),un}function tr(He,ze,Xe,Tt){if(typeof Xe=="object"&&Xe!==null&&Xe.type===at&&Xe.key===null&&(Xe=Xe.props.children),typeof Xe=="object"&&Xe!==null){switch(Xe.$$typeof){case We:e:{for(var un=Xe.key,_n=ze;_n!==null;){if(_n.key===un){if(un=Xe.type,un===at){if(_n.tag===7){g(He,_n.sibling),ze=z(_n,Xe.props.children),ze.return=He,He=ze;break e}}else if(_n.elementType===un||typeof un=="object"&&un!==null&&un.$$typeof===an&&gn(un)===_n.type){g(He,_n.sibling),ze=z(_n,Xe.props),ze.ref=kt(He,_n,Xe),ze.return=He,He=ze;break e}g(He,_n);break}else l(He,_n);_n=_n.sibling}Xe.type===at?(ze=Ql(Xe.props.children,He.mode,Tt,Xe.key),ze.return=He,He=ze):(Tt=Xc(Xe.type,Xe.key,Xe.props,null,He.mode,Tt),Tt.ref=kt(He,ze,Xe),Tt.return=He,He=Tt)}return ne(He);case tt:e:{for(_n=Xe.key;ze!==null;){if(ze.key===_n)if(ze.tag===4&&ze.stateNode.containerInfo===Xe.containerInfo&&ze.stateNode.implementation===Xe.implementation){g(He,ze.sibling),ze=z(ze,Xe.children||[]),ze.return=He,He=ze;break e}else{g(He,ze);break}else l(He,ze);ze=ze.sibling}ze=qo(Xe,He.mode,Tt),ze.return=He,He=ze}return ne(He);case an:return _n=Xe._init,tr(He,ze,_n(Xe._payload),Tt)}if(ai(Xe))return Xt(He,ze,Xe,Tt);if(jt(Xe))return nn(He,ze,Xe,Tt);qt(He,Xe)}return typeof Xe=="string"&&Xe!==""||typeof Xe=="number"?(Xe=""+Xe,ze!==null&&ze.tag===6?(g(He,ze.sibling),ze=z(ze,Xe),ze.return=He,He=ze):(g(He,ze),ze=Ga(Xe,He.mode,Tt),ze.return=He,He=ze),ne(He)):g(He,ze)}return tr}var Ct=It(!0),mn=It(!1),li=Oo(null),En=null,Pn=null,ci=null;function wr(){ci=Pn=En=null}function bs(a){var l=li.current;yi(li),a._currentValue=l}function hi(a,l,g){for(;a!==null;){var I=a.alternate;if((a.childLanes&l)!==l?(a.childLanes|=l,I!==null&&(I.childLanes|=l)):I!==null&&(I.childLanes&l)!==l&&(I.childLanes|=l),a===g)break;a=a.return}}function or(a,l){En=a,ci=Pn=null,a=a.dependencies,a!==null&&a.firstContext!==null&&((a.lanes&l)!==0&&(Is=!0),a.firstContext=null)}function bi(a){var l=a._currentValue;if(ci!==a)if(a={context:a,memoizedValue:l,next:null},Pn===null){if(En===null)throw Error(S(308));Pn=a,En.dependencies={lanes:0,firstContext:a}}else Pn=Pn.next=a;return l}var Zi=null;function Pr(a){Zi===null?Zi=[a]:Zi.push(a)}function ya(a,l,g,I){var z=l.interleaved;return z===null?(g.next=g,Pr(l)):(g.next=z.next,z.next=g),l.interleaved=g,is(a,I)}function is(a,l){a.lanes|=l;var g=a.alternate;for(g!==null&&(g.lanes|=l),g=a,a=a.return;a!==null;)a.childLanes|=l,g=a.alternate,g!==null&&(g.childLanes|=l),g=a,a=a.return;return g.tag===3?g.stateNode:null}var _a=!1;function Bo(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ks(a,l){a=a.updateQueue,l.updateQueue===a&&(l.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function $s(a,l){return{eventTime:a,lane:l,tag:0,payload:null,callback:null,next:null}}function Va(a,l,g){var I=a.updateQueue;if(I===null)return null;if(I=I.shared,(ni&2)!==0){var z=I.pending;return z===null?l.next=l:(l.next=z.next,z.next=l),I.pending=l,is(a,g)}return z=I.interleaved,z===null?(l.next=l,Pr(I)):(l.next=z.next,z.next=l),I.interleaved=l,is(a,g)}function Wr(a,l,g){if(l=l.updateQueue,l!==null&&(l=l.shared,(g&4194240)!==0)){var I=l.lanes;I&=a.pendingLanes,g|=I,l.lanes=g,ua(a,g)}}function Ss(a,l){var g=a.updateQueue,I=a.alternate;if(I!==null&&(I=I.updateQueue,g===I)){var z=null,j=null;if(g=g.firstBaseUpdate,g!==null){do{var ne={eventTime:g.eventTime,lane:g.lane,tag:g.tag,payload:g.payload,callback:g.callback,next:null};j===null?z=j=ne:j=j.next=ne,g=g.next}while(g!==null);j===null?z=j=l:j=j.next=l}else z=j=l;g={baseState:I.baseState,firstBaseUpdate:z,lastBaseUpdate:j,shared:I.shared,effects:I.effects},a.updateQueue=g;return}a=g.lastBaseUpdate,a===null?g.firstBaseUpdate=l:a.next=l,g.lastBaseUpdate=l}function va(a,l,g,I){var z=a.updateQueue;_a=!1;var j=z.firstBaseUpdate,ne=z.lastBaseUpdate,xe=z.shared.pending;if(xe!==null){z.shared.pending=null;var Pe=xe,Je=Pe.next;Pe.next=null,ne===null?j=Je:ne.next=Je,ne=Pe;var gt=a.alternate;gt!==null&&(gt=gt.updateQueue,xe=gt.lastBaseUpdate,xe!==ne&&(xe===null?gt.firstBaseUpdate=Je:xe.next=Je,gt.lastBaseUpdate=Pe))}if(j!==null){var xt=z.baseState;ne=0,gt=Je=Pe=null,xe=j;do{var mt=xe.lane,Rt=xe.eventTime;if((I&mt)===mt){gt!==null&&(gt=gt.next={eventTime:Rt,lane:0,tag:xe.tag,payload:xe.payload,callback:xe.callback,next:null});e:{var Xt=a,nn=xe;switch(mt=l,Rt=g,nn.tag){case 1:if(Xt=nn.payload,typeof Xt=="function"){xt=Xt.call(Rt,xt,mt);break e}xt=Xt;break e;case 3:Xt.flags=Xt.flags&-65537|128;case 0:if(Xt=nn.payload,mt=typeof Xt=="function"?Xt.call(Rt,xt,mt):Xt,mt==null)break e;xt=nt({},xt,mt);break e;case 2:_a=!0}}xe.callback!==null&&xe.lane!==0&&(a.flags|=64,mt=z.effects,mt===null?z.effects=[xe]:mt.push(xe))}else Rt={eventTime:Rt,lane:mt,tag:xe.tag,payload:xe.payload,callback:xe.callback,next:null},gt===null?(Je=gt=Rt,Pe=xt):gt=gt.next=Rt,ne|=mt;if(xe=xe.next,xe===null){if(xe=z.shared.pending,xe===null)break;mt=xe,xe=mt.next,mt.next=null,z.lastBaseUpdate=mt,z.shared.pending=null}}while(!0);if(gt===null&&(Pe=xt),z.baseState=Pe,z.firstBaseUpdate=Je,z.lastBaseUpdate=gt,l=z.shared.interleaved,l!==null){z=l;do ne|=z.lane,z=z.next;while(z!==l)}else j===null&&(z.shared.lanes=0);ku|=ne,a.lanes=ne,a.memoizedState=xt}}function Zs(a,l,g){if(a=l.effects,l.effects=null,a!==null)for(l=0;l<a.length;l++){var I=a[l],z=I.callback;if(z!==null){if(I.callback=null,I=g,typeof z!="function")throw Error(S(191,z));z.call(I)}}}var Wi={},Pi=Oo(Wi),Mr=Oo(Wi),Ln=Oo(Wi);function Es(a){if(a===Wi)throw Error(S(174));return a}function jo(a,l){switch(wi(Ln,l),wi(Mr,a),wi(Pi,Wi),a=l.nodeType,a){case 9:case 11:l=(l=l.documentElement)?l.namespaceURI:oa(null,"");break;default:a=a===8?l.parentNode:l,l=a.namespaceURI||null,a=a.tagName,l=oa(l,a)}yi(Pi),wi(Pi,l)}function xa(){yi(Pi),yi(Mr),yi(Ln)}function wc(a){Es(Ln.current);var l=Es(Pi.current),g=oa(l,a.type);l!==g&&(wi(Mr,a),wi(Pi,g))}function bc(a){Mr.current===a&&(yi(Pi),yi(Mr))}var zi=Oo(0);function wa(a){for(var l=a;l!==null;){if(l.tag===13){var g=l.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||g.data==="$?"||g.data==="$!"))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var Gu=[];function Vl(){for(var a=0;a<Gu.length;a++)Gu[a]._workInProgressVersionPrimary=null;Gu.length=0}var Vo=it.ReactCurrentDispatcher,Ul=it.ReactCurrentBatchConfig,Ua=0,fi=null,qi=null,lr=null,kc=!1,$u=!1,Sc=0,Jh=0;function br(){throw Error(S(321))}function ql(a,l){if(l===null)return!1;for(var g=0;g<l.length&&g<a.length;g++)if(!h(a[g],l[g]))return!1;return!0}function yo(a,l,g,I,z,j){if(Ua=j,fi=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,Vo.current=a===null||a.memoizedState===null?fh:lp,a=g(I,z),$u){j=0;do{if($u=!1,Sc=0,25<=j)throw Error(S(301));j+=1,lr=qi=null,l.updateQueue=null,Vo.current=Jf,a=g(I,z)}while($u)}if(Vo.current=hh,l=qi!==null&&qi.next!==null,Ua=0,lr=qi=fi=null,kc=!1,l)throw Error(S(300));return a}function ba(){var a=Sc!==0;return Sc=0,a}function Yr(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return lr===null?fi.memoizedState=lr=a:lr=lr.next=a,lr}function ka(){if(qi===null){var a=fi.alternate;a=a!==null?a.memoizedState:null}else a=qi.next;var l=lr===null?fi.memoizedState:lr.next;if(l!==null)lr=l,qi=a;else{if(a===null)throw Error(S(310));qi=a,a={memoizedState:qi.memoizedState,baseState:qi.baseState,baseQueue:qi.baseQueue,queue:qi.queue,next:null},lr===null?fi.memoizedState=lr=a:lr=lr.next=a}return lr}function _o(a,l){return typeof l=="function"?l(a):l}function Qh(a){var l=ka(),g=l.queue;if(g===null)throw Error(S(311));g.lastRenderedReducer=a;var I=qi,z=I.baseQueue,j=g.pending;if(j!==null){if(z!==null){var ne=z.next;z.next=j.next,j.next=ne}I.baseQueue=z=j,g.pending=null}if(z!==null){j=z.next,I=I.baseState;var xe=ne=null,Pe=null,Je=j;do{var gt=Je.lane;if((Ua&gt)===gt)Pe!==null&&(Pe=Pe.next={lane:0,action:Je.action,hasEagerState:Je.hasEagerState,eagerState:Je.eagerState,next:null}),I=Je.hasEagerState?Je.eagerState:a(I,Je.action);else{var xt={lane:gt,action:Je.action,hasEagerState:Je.hasEagerState,eagerState:Je.eagerState,next:null};Pe===null?(xe=Pe=xt,ne=I):Pe=Pe.next=xt,fi.lanes|=gt,ku|=gt}Je=Je.next}while(Je!==null&&Je!==j);Pe===null?ne=I:Pe.next=xe,h(I,l.memoizedState)||(Is=!0),l.memoizedState=I,l.baseState=ne,l.baseQueue=Pe,g.lastRenderedState=I}if(a=g.interleaved,a!==null){z=a;do j=z.lane,fi.lanes|=j,ku|=j,z=z.next;while(z!==a)}else z===null&&(g.lanes=0);return[l.memoizedState,g.dispatch]}function ah(a){var l=ka(),g=l.queue;if(g===null)throw Error(S(311));g.lastRenderedReducer=a;var I=g.dispatch,z=g.pending,j=l.memoizedState;if(z!==null){g.pending=null;var ne=z=z.next;do j=a(j,ne.action),ne=ne.next;while(ne!==z);h(j,l.memoizedState)||(Is=!0),l.memoizedState=j,l.baseQueue===null&&(l.baseState=j),g.lastRenderedState=j}return[j,I]}function Yi(){}function oh(a,l){var g=fi,I=ka(),z=l(),j=!h(I.memoizedState,z);if(j&&(I.memoizedState=z,Is=!0),I=I.queue,Tc($l.bind(null,g,I,a),[a]),I.getSnapshot!==l||j||lr!==null&&lr.memoizedState.tag&1){if(g.flags|=2048,Ic(9,Gl.bind(null,g,I,z,l),void 0,null),Ar===null)throw Error(S(349));(Ua&30)!==0||ef(g,l,z)}return z}function ef(a,l,g){a.flags|=16384,a={getSnapshot:l,value:g},l=fi.updateQueue,l===null?(l={lastEffect:null,stores:null},fi.updateQueue=l,l.stores=[a]):(g=l.stores,g===null?l.stores=[a]:g.push(a))}function Gl(a,l,g,I){l.value=g,l.getSnapshot=I,Ec(l)&&lh(a)}function $l(a,l,g){return g(function(){Ec(l)&&lh(a)})}function Ec(a){var l=a.getSnapshot;a=a.value;try{var g=l();return!h(a,g)}catch{return!0}}function lh(a){var l=is(a,1);l!==null&&xo(l,a,1,-1)}function tf(a){var l=Yr();return typeof a=="function"&&(a=a()),l.memoizedState=l.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_o,lastRenderedState:a},l.queue=a,a=a.dispatch=Hu.bind(null,fi,a),[l.memoizedState,a]}function Ic(a,l,g,I){return a={tag:a,create:l,destroy:g,deps:I,next:null},l=fi.updateQueue,l===null?(l={lastEffect:null,stores:null},fi.updateQueue=l,l.lastEffect=a.next=a):(g=l.lastEffect,g===null?l.lastEffect=a.next=a:(I=g.next,g.next=a,a.next=I,l.lastEffect=a)),a}function nf(){return ka().memoizedState}function uh(a,l,g,I){var z=Yr();fi.flags|=a,z.memoizedState=Ic(1|l,g,void 0,I===void 0?null:I)}function Zu(a,l,g,I){var z=ka();I=I===void 0?null:I;var j=void 0;if(qi!==null){var ne=qi.memoizedState;if(j=ne.destroy,I!==null&&ql(I,ne.deps)){z.memoizedState=Ic(l,g,j,I);return}}fi.flags|=a,z.memoizedState=Ic(1|l,g,j,I)}function Xf(a,l){return uh(8390656,8,a,l)}function Tc(a,l){return Zu(2048,8,a,l)}function rf(a,l){return Zu(4,2,a,l)}function sf(a,l){return Zu(4,4,a,l)}function _u(a,l){if(typeof l=="function")return a=a(),l(a),function(){l(null)};if(l!=null)return a=a(),l.current=a,function(){l.current=null}}function Wf(a,l,g){return g=g!=null?g.concat([a]):null,Zu(4,4,_u.bind(null,l,a),g)}function vu(){}function Cc(a,l){var g=ka();l=l===void 0?null:l;var I=g.memoizedState;return I!==null&&l!==null&&ql(l,I[1])?I[0]:(g.memoizedState=[a,l],a)}function Pc(a,l){var g=ka();l=l===void 0?null:l;var I=g.memoizedState;return I!==null&&l!==null&&ql(l,I[1])?I[0]:(a=a(),g.memoizedState=[a,l],a)}function af(a,l,g){return(Ua&21)===0?(a.baseState&&(a.baseState=!1,Is=!0),a.memoizedState=g):(h(g,l)||(g=la(),fi.lanes|=g,ku|=g,a.baseState=!0),l)}function Yf(a,l){var g=qn;qn=g!==0&&4>g?g:4,a(!0);var I=Ul.transition;Ul.transition={};try{a(!1),l()}finally{qn=g,Ul.transition=I}}function Kf(){return ka().memoizedState}function rs(a,l,g){var I=Kl(a);if(g={lane:I,action:g,hasEagerState:!1,eagerState:null,next:null},ch(a))of(l,g);else if(g=ya(a,l,g,I),g!==null){var z=Ts();xo(g,a,I,z),Xu(g,l,I)}}function Hu(a,l,g){var I=Kl(a),z={lane:I,action:g,hasEagerState:!1,eagerState:null,next:null};if(ch(a))of(l,z);else{var j=a.alternate;if(a.lanes===0&&(j===null||j.lanes===0)&&(j=l.lastRenderedReducer,j!==null))try{var ne=l.lastRenderedState,xe=j(ne,g);if(z.hasEagerState=!0,z.eagerState=xe,h(xe,ne)){var Pe=l.interleaved;Pe===null?(z.next=z,Pr(l)):(z.next=Pe.next,Pe.next=z),l.interleaved=z;return}}catch{}g=ya(a,l,z,I),g!==null&&(z=Ts(),xo(g,a,I,z),Xu(g,l,I))}}function ch(a){var l=a.alternate;return a===fi||l!==null&&l===fi}function of(a,l){$u=kc=!0;var g=a.pending;g===null?l.next=l:(l.next=g.next,g.next=l),a.pending=l}function Xu(a,l,g){if((g&4194240)!==0){var I=l.lanes;I&=a.pendingLanes,g|=I,l.lanes=g,ua(a,g)}}var hh={readContext:bi,useCallback:br,useContext:br,useEffect:br,useImperativeHandle:br,useInsertionEffect:br,useLayoutEffect:br,useMemo:br,useReducer:br,useRef:br,useState:br,useDebugValue:br,useDeferredValue:br,useTransition:br,useMutableSource:br,useSyncExternalStore:br,useId:br,unstable_isNewReconciler:!1},fh={readContext:bi,useCallback:function(a,l){return Yr().memoizedState=[a,l===void 0?null:l],a},useContext:bi,useEffect:Xf,useImperativeHandle:function(a,l,g){return g=g!=null?g.concat([a]):null,uh(4194308,4,_u.bind(null,l,a),g)},useLayoutEffect:function(a,l){return uh(4194308,4,a,l)},useInsertionEffect:function(a,l){return uh(4,2,a,l)},useMemo:function(a,l){var g=Yr();return l=l===void 0?null:l,a=a(),g.memoizedState=[a,l],a},useReducer:function(a,l,g){var I=Yr();return l=g!==void 0?g(l):l,I.memoizedState=I.baseState=l,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:l},I.queue=a,a=a.dispatch=rs.bind(null,fi,a),[I.memoizedState,a]},useRef:function(a){var l=Yr();return a={current:a},l.memoizedState=a},useState:tf,useDebugValue:vu,useDeferredValue:function(a){return Yr().memoizedState=a},useTransition:function(){var a=tf(!1),l=a[0];return a=Yf.bind(null,a[1]),Yr().memoizedState=a,[l,a]},useMutableSource:function(){},useSyncExternalStore:function(a,l,g){var I=fi,z=Yr();if(ge){if(g===void 0)throw Error(S(407));g=g()}else{if(g=l(),Ar===null)throw Error(S(349));(Ua&30)!==0||ef(I,l,g)}z.memoizedState=g;var j={value:g,getSnapshot:l};return z.queue=j,Xf($l.bind(null,I,j,a),[a]),I.flags|=2048,Ic(9,Gl.bind(null,I,j,g,l),void 0,null),g},useId:function(){var a=Yr(),l=Ar.identifierPrefix;if(ge){var g=V,I=D;g=(I&~(1<<32-Wn(I)-1)).toString(32)+g,l=":"+l+"R"+g,g=Sc++,0<g&&(l+="H"+g.toString(32)),l+=":"}else g=Jh++,l=":"+l+"r"+g.toString(32)+":";return a.memoizedState=l},unstable_isNewReconciler:!1},lp={readContext:bi,useCallback:Cc,useContext:bi,useEffect:Tc,useImperativeHandle:Wf,useInsertionEffect:rf,useLayoutEffect:sf,useMemo:Pc,useReducer:Qh,useRef:nf,useState:function(){return Qh(_o)},useDebugValue:vu,useDeferredValue:function(a){var l=ka();return af(l,qi.memoizedState,a)},useTransition:function(){var a=Qh(_o)[0],l=ka().memoizedState;return[a,l]},useMutableSource:Yi,useSyncExternalStore:oh,useId:Kf,unstable_isNewReconciler:!1},Jf={readContext:bi,useCallback:Cc,useContext:bi,useEffect:Tc,useImperativeHandle:Wf,useInsertionEffect:rf,useLayoutEffect:sf,useMemo:Pc,useReducer:ah,useRef:nf,useState:function(){return ah(_o)},useDebugValue:vu,useDeferredValue:function(a){var l=ka();return qi===null?l.memoizedState=a:af(l,qi.memoizedState,a)},useTransition:function(){var a=ah(_o)[0],l=ka().memoizedState;return[a,l]},useMutableSource:Yi,useSyncExternalStore:oh,useId:Kf,unstable_isNewReconciler:!1};function qa(a,l){if(a&&a.defaultProps){l=nt({},l),a=a.defaultProps;for(var g in a)l[g]===void 0&&(l[g]=a[g]);return l}return l}function dh(a,l,g,I){l=a.memoizedState,g=g(I,l),g=g==null?l:nt({},l,g),a.memoizedState=g,a.lanes===0&&(a.updateQueue.baseState=g)}var ph={isMounted:function(a){return(a=a._reactInternals)?Sn(a)===a:!1},enqueueSetState:function(a,l,g){a=a._reactInternals;var I=Ts(),z=Kl(a),j=$s(I,z);j.payload=l,g!=null&&(j.callback=g),l=Va(a,j,z),l!==null&&(xo(l,a,z,I),Wr(l,a,z))},enqueueReplaceState:function(a,l,g){a=a._reactInternals;var I=Ts(),z=Kl(a),j=$s(I,z);j.tag=1,j.payload=l,g!=null&&(j.callback=g),l=Va(a,j,z),l!==null&&(xo(l,a,z,I),Wr(l,a,z))},enqueueForceUpdate:function(a,l){a=a._reactInternals;var g=Ts(),I=Kl(a),z=$s(g,I);z.tag=2,l!=null&&(z.callback=l),l=Va(a,z,I),l!==null&&(xo(l,a,I,g),Wr(l,a,I))}};function mh(a,l,g,I,z,j,ne){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(I,j,ne):l.prototype&&l.prototype.isPureReactComponent?!b(g,I)||!b(z,j):!0}function lf(a,l,g){var I=!1,z=Fo,j=l.contextType;return typeof j=="object"&&j!==null?j=bi(j):(z=Cr(l)?Gs:ui.current,I=l.contextTypes,j=(I=I!=null)?go(a,z):Fo),l=new l(g,j),a.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=ph,a.stateNode=l,l._reactInternals=a,I&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=z,a.__reactInternalMemoizedMaskedChildContext=j),l}function gh(a,l,g,I){a=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(g,I),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(g,I),l.state!==a&&ph.enqueueReplaceState(l,l.state,null)}function xu(a,l,g,I){var z=a.stateNode;z.props=g,z.state=a.memoizedState,z.refs={},Bo(a);var j=l.contextType;typeof j=="object"&&j!==null?z.context=bi(j):(j=Cr(l)?Gs:ui.current,z.context=go(a,j)),z.state=a.memoizedState,j=l.getDerivedStateFromProps,typeof j=="function"&&(dh(a,l,j,g),z.state=a.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof z.getSnapshotBeforeUpdate=="function"||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(l=z.state,typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount(),l!==z.state&&ph.enqueueReplaceState(z,z.state,null),va(a,g,z,I),z.state=a.memoizedState),typeof z.componentDidMount=="function"&&(a.flags|=4194308)}function Or(a,l){try{var g="",I=l;do g+=yn(I),I=I.return;while(I);var z=g}catch(j){z=`
Error generating stack: `+j.message+`
`+j.stack}return{value:a,source:l,stack:z,digest:null}}function yh(a,l,g){return{value:a,source:null,stack:g??null,digest:l??null}}function Mc(a,l){try{console.error(l.value)}catch(g){setTimeout(function(){throw g})}}var up=typeof WeakMap=="function"?WeakMap:Map;function uf(a,l,g){g=$s(-1,g),g.tag=3,g.payload={element:null};var I=l.value;return g.callback=function(){jc||(jc=!0,Ch=I),Mc(a,l)},g}function Qf(a,l,g){g=$s(-1,g),g.tag=3;var I=a.type.getDerivedStateFromError;if(typeof I=="function"){var z=l.value;g.payload=function(){return I(z)},g.callback=function(){Mc(a,l)}}var j=a.stateNode;return j!==null&&typeof j.componentDidCatch=="function"&&(g.callback=function(){Mc(a,l),typeof I!="function"&&($n===null?$n=new Set([this]):$n.add(this));var ne=l.stack;this.componentDidCatch(l.value,{componentStack:ne!==null?ne:""})}),g}function ed(a,l,g){var I=a.pingCache;if(I===null){I=a.pingCache=new up;var z=new Set;I.set(l,z)}else z=I.get(l),z===void 0&&(z=new Set,I.set(l,z));z.has(g)||(z.add(g),a=mp.bind(null,a,l,g),l.then(a,a))}function td(a){do{var l;if((l=a.tag===13)&&(l=a.memoizedState,l=l!==null?l.dehydrated!==null:!0),l)return a;a=a.return}while(a!==null);return null}function nd(a,l,g,I,z){return(a.mode&1)===0?(a===l?a.flags|=65536:(a.flags|=128,g.flags|=131072,g.flags&=-52805,g.tag===1&&(g.alternate===null?g.tag=17:(l=$s(-1,1),l.tag=2,Va(g,l,1))),g.lanes|=1),a):(a.flags|=65536,a.lanes=z,a)}var id=it.ReactCurrentOwner,Is=!1;function ur(a,l,g,I){l.child=a===null?mn(l,null,g,I):Ct(l,a.child,g,I)}function Wu(a,l,g,I,z){g=g.render;var j=l.ref;return or(l,z),I=yo(a,l,g,I,j,z),g=ba(),a!==null&&!Is?(l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~z,Sa(a,l,z)):(ge&&g&&te(l),l.flags|=1,ur(a,l,I,z),l.child)}function rd(a,l,g,I,z){if(a===null){var j=g.type;return typeof j=="function"&&!Hc(j)&&j.defaultProps===void 0&&g.compare===null&&g.defaultProps===void 0?(l.tag=15,l.type=j,sd(a,l,j,I,z)):(a=Xc(g.type,null,I,l,l.mode,z),a.ref=l.ref,a.return=l,l.child=a)}if(j=a.child,(a.lanes&z)===0){var ne=j.memoizedProps;if(g=g.compare,g=g!==null?g:b,g(ne,I)&&a.ref===l.ref)return Sa(a,l,z)}return l.flags|=1,a=Jl(j,I),a.ref=l.ref,a.return=l,l.child=a}function sd(a,l,g,I,z){if(a!==null){var j=a.memoizedProps;if(b(j,I)&&a.ref===l.ref)if(Is=!1,l.pendingProps=I=j,(a.lanes&z)!==0)(a.flags&131072)!==0&&(Is=!0);else return l.lanes=a.lanes,Sa(a,l,z)}return cf(a,l,g,I,z)}function ad(a,l,g){var I=l.pendingProps,z=I.children,j=a!==null?a.memoizedState:null;if(I.mode==="hidden")if((l.mode&1)===0)l.memoizedState={baseLanes:0,cachePool:null,transitions:null},wi(Ju,os),os|=g;else{if((g&1073741824)===0)return a=j!==null?j.baseLanes|g:g,l.lanes=l.childLanes=1073741824,l.memoizedState={baseLanes:a,cachePool:null,transitions:null},l.updateQueue=null,wi(Ju,os),os|=a,null;l.memoizedState={baseLanes:0,cachePool:null,transitions:null},I=j!==null?j.baseLanes:g,wi(Ju,os),os|=I}else j!==null?(I=j.baseLanes|g,l.memoizedState=null):I=g,wi(Ju,os),os|=I;return ur(a,l,z,g),l.child}function od(a,l){var g=l.ref;(a===null&&g!==null||a!==null&&a.ref!==g)&&(l.flags|=512,l.flags|=2097152)}function cf(a,l,g,I,z){var j=Cr(g)?Gs:ui.current;return j=go(l,j),or(l,z),g=yo(a,l,g,I,j,z),I=ba(),a!==null&&!Is?(l.updateQueue=a.updateQueue,l.flags&=-2053,a.lanes&=~z,Sa(a,l,z)):(ge&&I&&te(l),l.flags|=1,ur(a,l,g,z),l.child)}function ld(a,l,g,I,z){if(Cr(g)){var j=!0;ws(l)}else j=!1;if(or(l,z),l.stateNode===null)Rc(a,l),lf(l,g,I),xu(l,g,I,z),I=!0;else if(a===null){var ne=l.stateNode,xe=l.memoizedProps;ne.props=xe;var Pe=ne.context,Je=g.contextType;typeof Je=="object"&&Je!==null?Je=bi(Je):(Je=Cr(g)?Gs:ui.current,Je=go(l,Je));var gt=g.getDerivedStateFromProps,xt=typeof gt=="function"||typeof ne.getSnapshotBeforeUpdate=="function";xt||typeof ne.UNSAFE_componentWillReceiveProps!="function"&&typeof ne.componentWillReceiveProps!="function"||(xe!==I||Pe!==Je)&&gh(l,ne,I,Je),_a=!1;var mt=l.memoizedState;ne.state=mt,va(l,I,ne,z),Pe=l.memoizedState,xe!==I||mt!==Pe||On.current||_a?(typeof gt=="function"&&(dh(l,g,gt,I),Pe=l.memoizedState),(xe=_a||mh(l,g,xe,I,mt,Pe,Je))?(xt||typeof ne.UNSAFE_componentWillMount!="function"&&typeof ne.componentWillMount!="function"||(typeof ne.componentWillMount=="function"&&ne.componentWillMount(),typeof ne.UNSAFE_componentWillMount=="function"&&ne.UNSAFE_componentWillMount()),typeof ne.componentDidMount=="function"&&(l.flags|=4194308)):(typeof ne.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=I,l.memoizedState=Pe),ne.props=I,ne.state=Pe,ne.context=Je,I=xe):(typeof ne.componentDidMount=="function"&&(l.flags|=4194308),I=!1)}else{ne=l.stateNode,ks(a,l),xe=l.memoizedProps,Je=l.type===l.elementType?xe:qa(l.type,xe),ne.props=Je,xt=l.pendingProps,mt=ne.context,Pe=g.contextType,typeof Pe=="object"&&Pe!==null?Pe=bi(Pe):(Pe=Cr(g)?Gs:ui.current,Pe=go(l,Pe));var Rt=g.getDerivedStateFromProps;(gt=typeof Rt=="function"||typeof ne.getSnapshotBeforeUpdate=="function")||typeof ne.UNSAFE_componentWillReceiveProps!="function"&&typeof ne.componentWillReceiveProps!="function"||(xe!==xt||mt!==Pe)&&gh(l,ne,I,Pe),_a=!1,mt=l.memoizedState,ne.state=mt,va(l,I,ne,z);var Xt=l.memoizedState;xe!==xt||mt!==Xt||On.current||_a?(typeof Rt=="function"&&(dh(l,g,Rt,I),Xt=l.memoizedState),(Je=_a||mh(l,g,Je,I,mt,Xt,Pe)||!1)?(gt||typeof ne.UNSAFE_componentWillUpdate!="function"&&typeof ne.componentWillUpdate!="function"||(typeof ne.componentWillUpdate=="function"&&ne.componentWillUpdate(I,Xt,Pe),typeof ne.UNSAFE_componentWillUpdate=="function"&&ne.UNSAFE_componentWillUpdate(I,Xt,Pe)),typeof ne.componentDidUpdate=="function"&&(l.flags|=4),typeof ne.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof ne.componentDidUpdate!="function"||xe===a.memoizedProps&&mt===a.memoizedState||(l.flags|=4),typeof ne.getSnapshotBeforeUpdate!="function"||xe===a.memoizedProps&&mt===a.memoizedState||(l.flags|=1024),l.memoizedProps=I,l.memoizedState=Xt),ne.props=I,ne.state=Xt,ne.context=Pe,I=Je):(typeof ne.componentDidUpdate!="function"||xe===a.memoizedProps&&mt===a.memoizedState||(l.flags|=4),typeof ne.getSnapshotBeforeUpdate!="function"||xe===a.memoizedProps&&mt===a.memoizedState||(l.flags|=1024),I=!1)}return hf(a,l,g,I,j,z)}function hf(a,l,g,I,z,j){od(a,l);var ne=(l.flags&128)!==0;if(!I&&!ne)return z&&Bl(l,g,!1),Sa(a,l,j);I=l.stateNode,id.current=l;var xe=ne&&typeof g.getDerivedStateFromError!="function"?null:I.render();return l.flags|=1,a!==null&&ne?(l.child=Ct(l,a.child,null,j),l.child=Ct(l,null,xe,j)):ur(a,l,xe,j),l.memoizedState=I.state,z&&Bl(l,g,!0),l.child}function _h(a){var l=a.stateNode;l.pendingContext?Ol(a,l.pendingContext,l.pendingContext!==l.context):l.context&&Ol(a,l.context,!1),jo(a,l.containerInfo)}function ud(a,l,g,I,z){return St(),Lt(z),l.flags|=256,ur(a,l,g,I),l.child}var Zl={dehydrated:null,treeContext:null,retryLane:0};function ff(a){return{baseLanes:a,cachePool:null,transitions:null}}function Hi(a,l,g){var I=l.pendingProps,z=zi.current,j=!1,ne=(l.flags&128)!==0,xe;if((xe=ne)||(xe=a!==null&&a.memoizedState===null?!1:(z&2)!==0),xe?(j=!0,l.flags&=-129):(a===null||a.memoizedState!==null)&&(z|=1),wi(zi,z&1),a===null)return Oe(l),a=l.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?((l.mode&1)===0?l.lanes=1:a.data==="$!"?l.lanes=8:l.lanes=1073741824,null):(ne=I.children,a=I.fallback,j?(I=l.mode,j=l.child,ne={mode:"hidden",children:ne},(I&1)===0&&j!==null?(j.childLanes=0,j.pendingProps=ne):j=eu(ne,I,0,null),a=Ql(a,I,g,null),j.return=l,a.return=l,j.sibling=a,l.child=j,l.child.memoizedState=ff(g),l.memoizedState=Zl,a):Yu(l,ne));if(z=a.memoizedState,z!==null&&(xe=z.dehydrated,xe!==null))return vh(a,l,ne,I,xe,z,g);if(j){j=I.fallback,ne=l.mode,z=a.child,xe=z.sibling;var Pe={mode:"hidden",children:I.children};return(ne&1)===0&&l.child!==z?(I=l.child,I.childLanes=0,I.pendingProps=Pe,l.deletions=null):(I=Jl(z,Pe),I.subtreeFlags=z.subtreeFlags&14680064),xe!==null?j=Jl(xe,j):(j=Ql(j,ne,g,null),j.flags|=2),j.return=l,I.return=l,I.sibling=j,l.child=I,I=j,j=l.child,ne=a.child.memoizedState,ne=ne===null?ff(g):{baseLanes:ne.baseLanes|g,cachePool:null,transitions:ne.transitions},j.memoizedState=ne,j.childLanes=a.childLanes&~g,l.memoizedState=Zl,I}return j=a.child,a=j.sibling,I=Jl(j,{mode:"visible",children:I.children}),(l.mode&1)===0&&(I.lanes=g),I.return=l,I.sibling=null,a!==null&&(g=l.deletions,g===null?(l.deletions=[a],l.flags|=16):g.push(a)),l.child=I,l.memoizedState=null,I}function Yu(a,l){return l=eu({mode:"visible",children:l},a.mode,0,null),l.return=a,a.child=l}function Ac(a,l,g,I){return I!==null&&Lt(I),Ct(l,a.child,null,g),a=Yu(l,l.pendingProps.children),a.flags|=2,l.memoizedState=null,a}function vh(a,l,g,I,z,j,ne){if(g)return l.flags&256?(l.flags&=-257,I=yh(Error(S(422))),Ac(a,l,ne,I)):l.memoizedState!==null?(l.child=a.child,l.flags|=128,null):(j=I.fallback,z=l.mode,I=eu({mode:"visible",children:I.children},z,0,null),j=Ql(j,z,ne,null),j.flags|=2,I.return=l,j.return=l,I.sibling=j,l.child=I,(l.mode&1)!==0&&Ct(l,a.child,null,ne),l.child.memoizedState=ff(ne),l.memoizedState=Zl,j);if((l.mode&1)===0)return Ac(a,l,ne,null);if(z.data==="$!"){if(I=z.nextSibling&&z.nextSibling.dataset,I)var xe=I.dgst;return I=xe,j=Error(S(419)),I=yh(j,I,void 0),Ac(a,l,ne,I)}if(xe=(ne&a.childLanes)!==0,Is||xe){if(I=Ar,I!==null){switch(ne&-ne){case 4:z=2;break;case 16:z=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:z=32;break;case 536870912:z=268435456;break;default:z=0}z=(z&(I.suspendedLanes|ne))!==0?0:z,z!==0&&z!==j.retryLane&&(j.retryLane=z,is(a,z),xo(I,a,z,-1))}return Ah(),I=yh(Error(S(421))),Ac(a,l,ne,I)}return z.data==="$?"?(l.flags|=128,l.child=a.child,l=Ed.bind(null,a),z._reactRetry=l,null):(a=j.treeContext,pe=pa(z.nextSibling),he=l,ge=!0,ve=null,a!==null&&(y[P++]=D,y[P++]=V,y[P++]=A,D=a.id,V=a.overflow,A=l),l=Yu(l,I.children),l.flags|=4096,l)}function Lc(a,l,g){a.lanes|=l;var I=a.alternate;I!==null&&(I.lanes|=l),hi(a.return,l,g)}function wu(a,l,g,I,z){var j=a.memoizedState;j===null?a.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:I,tail:g,tailMode:z}:(j.isBackwards=l,j.rendering=null,j.renderingStartTime=0,j.last=I,j.tail=g,j.tailMode=z)}function df(a,l,g){var I=l.pendingProps,z=I.revealOrder,j=I.tail;if(ur(a,l,I.children,g),I=zi.current,(I&2)!==0)I=I&1|2,l.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=l.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Lc(a,g,l);else if(a.tag===19)Lc(a,g,l);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===l)break e;for(;a.sibling===null;){if(a.return===null||a.return===l)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}I&=1}if(wi(zi,I),(l.mode&1)===0)l.memoizedState=null;else switch(z){case"forwards":for(g=l.child,z=null;g!==null;)a=g.alternate,a!==null&&wa(a)===null&&(z=g),g=g.sibling;g=z,g===null?(z=l.child,l.child=null):(z=g.sibling,g.sibling=null),wu(l,!1,z,g,j);break;case"backwards":for(g=null,z=l.child,l.child=null;z!==null;){if(a=z.alternate,a!==null&&wa(a)===null){l.child=z;break}a=z.sibling,z.sibling=g,g=z,z=a}wu(l,!0,g,null,j);break;case"together":wu(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function Rc(a,l){(l.mode&1)===0&&a!==null&&(a.alternate=null,l.alternate=null,l.flags|=2)}function Sa(a,l,g){if(a!==null&&(l.dependencies=a.dependencies),ku|=l.lanes,(g&l.childLanes)===0)return null;if(a!==null&&l.child!==a.child)throw Error(S(153));if(l.child!==null){for(a=l.child,g=Jl(a,a.pendingProps),l.child=g,g.return=l;a.sibling!==null;)a=a.sibling,g=g.sibling=Jl(a,a.pendingProps),g.return=l;g.sibling=null}return l.child}function pf(a,l,g){switch(l.tag){case 3:_h(l),St();break;case 5:wc(l);break;case 1:Cr(l.type)&&ws(l);break;case 4:jo(l,l.stateNode.containerInfo);break;case 10:var I=l.type._context,z=l.memoizedProps.value;wi(li,I._currentValue),I._currentValue=z;break;case 13:if(I=l.memoizedState,I!==null)return I.dehydrated!==null?(wi(zi,zi.current&1),l.flags|=128,null):(g&l.child.childLanes)!==0?Hi(a,l,g):(wi(zi,zi.current&1),a=Sa(a,l,g),a!==null?a.sibling:null);wi(zi,zi.current&1);break;case 19:if(I=(g&l.childLanes)!==0,(a.flags&128)!==0){if(I)return df(a,l,g);l.flags|=128}if(z=l.memoizedState,z!==null&&(z.rendering=null,z.tail=null,z.lastEffect=null),wi(zi,zi.current),I)break;return null;case 22:case 23:return l.lanes=0,ad(a,l,g)}return Sa(a,l,g)}var xh,Nc,wh,mf;xh=function(a,l){for(var g=l.child;g!==null;){if(g.tag===5||g.tag===6)a.appendChild(g.stateNode);else if(g.tag!==4&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===l)break;for(;g.sibling===null;){if(g.return===null||g.return===l)return;g=g.return}g.sibling.return=g.return,g=g.sibling}},Nc=function(){},wh=function(a,l,g,I){var z=a.memoizedProps;if(z!==I){a=l.stateNode,Es(Pi.current);var j=null;switch(g){case"input":z=Vr(a,z),I=Vr(a,I),j=[];break;case"select":z=nt({},z,{value:void 0}),I=nt({},I,{value:void 0}),j=[];break;case"textarea":z=pr(a,z),I=pr(a,I),j=[];break;default:typeof z.onClick!="function"&&typeof I.onClick=="function"&&(a.onclick=ns)}mr(g,I);var ne;g=null;for(Je in z)if(!I.hasOwnProperty(Je)&&z.hasOwnProperty(Je)&&z[Je]!=null)if(Je==="style"){var xe=z[Je];for(ne in xe)xe.hasOwnProperty(ne)&&(g||(g={}),g[ne]="")}else Je!=="dangerouslySetInnerHTML"&&Je!=="children"&&Je!=="suppressContentEditableWarning"&&Je!=="suppressHydrationWarning"&&Je!=="autoFocus"&&(T.hasOwnProperty(Je)?j||(j=[]):(j=j||[]).push(Je,null));for(Je in I){var Pe=I[Je];if(xe=z?.[Je],I.hasOwnProperty(Je)&&Pe!==xe&&(Pe!=null||xe!=null))if(Je==="style")if(xe){for(ne in xe)!xe.hasOwnProperty(ne)||Pe&&Pe.hasOwnProperty(ne)||(g||(g={}),g[ne]="");for(ne in Pe)Pe.hasOwnProperty(ne)&&xe[ne]!==Pe[ne]&&(g||(g={}),g[ne]=Pe[ne])}else g||(j||(j=[]),j.push(Je,g)),g=Pe;else Je==="dangerouslySetInnerHTML"?(Pe=Pe?Pe.__html:void 0,xe=xe?xe.__html:void 0,Pe!=null&&xe!==Pe&&(j=j||[]).push(Je,Pe)):Je==="children"?typeof Pe!="string"&&typeof Pe!="number"||(j=j||[]).push(Je,""+Pe):Je!=="suppressContentEditableWarning"&&Je!=="suppressHydrationWarning"&&(T.hasOwnProperty(Je)?(Pe!=null&&Je==="onScroll"&&gi("scroll",a),j||xe===Pe||(j=[])):(j=j||[]).push(Je,Pe))}g&&(j=j||[]).push("style",g);var Je=j;(l.updateQueue=Je)&&(l.flags|=4)}},mf=function(a,l,g,I){g!==I&&(l.flags|=4)};function Ku(a,l){if(!ge)switch(a.tailMode){case"hidden":l=a.tail;for(var g=null;l!==null;)l.alternate!==null&&(g=l),l=l.sibling;g===null?a.tail=null:g.sibling=null;break;case"collapsed":g=a.tail;for(var I=null;g!==null;)g.alternate!==null&&(I=g),g=g.sibling;I===null?l||a.tail===null?a.tail=null:a.tail.sibling=null:I.sibling=null}}function ss(a){var l=a.alternate!==null&&a.alternate.child===a.child,g=0,I=0;if(l)for(var z=a.child;z!==null;)g|=z.lanes|z.childLanes,I|=z.subtreeFlags&14680064,I|=z.flags&14680064,z.return=a,z=z.sibling;else for(z=a.child;z!==null;)g|=z.lanes|z.childLanes,I|=z.subtreeFlags,I|=z.flags,z.return=a,z=z.sibling;return a.subtreeFlags|=I,a.childLanes=g,l}function cp(a,l,g){var I=l.pendingProps;switch(ue(l),l.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ss(l),null;case 1:return Cr(l.type)&&gu(),ss(l),null;case 3:return I=l.stateNode,xa(),yi(On),yi(ui),Vl(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),(a===null||a.child===null)&&(ot(l)?l.flags|=4:a===null||a.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,ve!==null&&(vf(ve),ve=null))),Nc(a,l),ss(l),null;case 5:bc(l);var z=Es(Ln.current);if(g=l.type,a!==null&&l.stateNode!=null)wh(a,l,g,I,z),a.ref!==l.ref&&(l.flags|=512,l.flags|=2097152);else{if(!I){if(l.stateNode===null)throw Error(S(166));return ss(l),null}if(a=Es(Pi.current),ot(l)){I=l.stateNode,g=l.type;var j=l.memoizedProps;switch(I[Xr]=l,I[ja]=j,a=(l.mode&1)!==0,g){case"dialog":gi("cancel",I),gi("close",I);break;case"iframe":case"object":case"embed":gi("load",I);break;case"video":case"audio":for(z=0;z<Do.length;z++)gi(Do[z],I);break;case"source":gi("error",I);break;case"img":case"image":case"link":gi("error",I),gi("load",I);break;case"details":gi("toggle",I);break;case"input":Rr(I,j),gi("invalid",I);break;case"select":I._wrapperState={wasMultiple:!!j.multiple},gi("invalid",I);break;case"textarea":As(I,j),gi("invalid",I)}mr(g,j),z=null;for(var ne in j)if(j.hasOwnProperty(ne)){var xe=j[ne];ne==="children"?typeof xe=="string"?I.textContent!==xe&&(j.suppressHydrationWarning!==!0&&zl(I.textContent,xe,a),z=["children",xe]):typeof xe=="number"&&I.textContent!==""+xe&&(j.suppressHydrationWarning!==!0&&zl(I.textContent,xe,a),z=["children",""+xe]):T.hasOwnProperty(ne)&&xe!=null&&ne==="onScroll"&&gi("scroll",I)}switch(g){case"input":Kt(I),Co(I,j,!0);break;case"textarea":Kt(I),ir(I);break;case"select":case"option":break;default:typeof j.onClick=="function"&&(I.onclick=ns)}I=z,l.updateQueue=I,I!==null&&(l.flags|=4)}else{ne=z.nodeType===9?z:z.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=aa(g)),a==="http://www.w3.org/1999/xhtml"?g==="script"?(a=ne.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof I.is=="string"?a=ne.createElement(g,{is:I.is}):(a=ne.createElement(g),g==="select"&&(ne=a,I.multiple?ne.multiple=!0:I.size&&(ne.size=I.size))):a=ne.createElementNS(a,g),a[Xr]=l,a[ja]=I,xh(a,l,!1,!1),l.stateNode=a;e:{switch(ne=qr(g,I),g){case"dialog":gi("cancel",a),gi("close",a),z=I;break;case"iframe":case"object":case"embed":gi("load",a),z=I;break;case"video":case"audio":for(z=0;z<Do.length;z++)gi(Do[z],a);z=I;break;case"source":gi("error",a),z=I;break;case"img":case"image":case"link":gi("error",a),gi("load",a),z=I;break;case"details":gi("toggle",a),z=I;break;case"input":Rr(a,I),z=Vr(a,I),gi("invalid",a);break;case"option":z=I;break;case"select":a._wrapperState={wasMultiple:!!I.multiple},z=nt({},I,{value:void 0}),gi("invalid",a);break;case"textarea":As(a,I),z=pr(a,I),gi("invalid",a);break;default:z=I}mr(g,z),xe=z;for(j in xe)if(xe.hasOwnProperty(j)){var Pe=xe[j];j==="style"?In(a,Pe):j==="dangerouslySetInnerHTML"?(Pe=Pe?Pe.__html:void 0,Pe!=null&&Ur(a,Pe)):j==="children"?typeof Pe=="string"?(g!=="textarea"||Pe!=="")&&dn(a,Pe):typeof Pe=="number"&&dn(a,""+Pe):j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&j!=="autoFocus"&&(T.hasOwnProperty(j)?Pe!=null&&j==="onScroll"&&gi("scroll",a):Pe!=null&&Ge(a,j,Pe,ne))}switch(g){case"input":Kt(a),Co(a,I,!1);break;case"textarea":Kt(a),ir(a);break;case"option":I.value!=null&&a.setAttribute("value",""+Ne(I.value));break;case"select":a.multiple=!!I.multiple,j=I.value,j!=null?ps(a,!!I.multiple,j,!1):I.defaultValue!=null&&ps(a,!!I.multiple,I.defaultValue,!0);break;default:typeof z.onClick=="function"&&(a.onclick=ns)}switch(g){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break e;case"img":I=!0;break e;default:I=!1}}I&&(l.flags|=4)}l.ref!==null&&(l.flags|=512,l.flags|=2097152)}return ss(l),null;case 6:if(a&&l.stateNode!=null)mf(a,l,a.memoizedProps,I);else{if(typeof I!="string"&&l.stateNode===null)throw Error(S(166));if(g=Es(Ln.current),Es(Pi.current),ot(l)){if(I=l.stateNode,g=l.memoizedProps,I[Xr]=l,(j=I.nodeValue!==g)&&(a=he,a!==null))switch(a.tag){case 3:zl(I.nodeValue,g,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&zl(I.nodeValue,g,(a.mode&1)!==0)}j&&(l.flags|=4)}else I=(g.nodeType===9?g:g.ownerDocument).createTextNode(I),I[Xr]=l,l.stateNode=I}return ss(l),null;case 13:if(yi(zi),I=l.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(ge&&pe!==null&&(l.mode&1)!==0&&(l.flags&128)===0)yt(),St(),l.flags|=98560,j=!1;else if(j=ot(l),I!==null&&I.dehydrated!==null){if(a===null){if(!j)throw Error(S(318));if(j=l.memoizedState,j=j!==null?j.dehydrated:null,!j)throw Error(S(317));j[Xr]=l}else St(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;ss(l),j=!1}else ve!==null&&(vf(ve),ve=null),j=!0;if(!j)return l.flags&65536?l:null}return(l.flags&128)!==0?(l.lanes=g,l):(I=I!==null,I!==(a!==null&&a.memoizedState!==null)&&I&&(l.child.flags|=8192,(l.mode&1)!==0&&(a===null||(zi.current&1)!==0?kr===0&&(kr=3):Ah())),l.updateQueue!==null&&(l.flags|=4),ss(l),null);case 4:return xa(),Nc(a,l),a===null&&ho(l.stateNode.containerInfo),ss(l),null;case 10:return bs(l.type._context),ss(l),null;case 17:return Cr(l.type)&&gu(),ss(l),null;case 19:if(yi(zi),j=l.memoizedState,j===null)return ss(l),null;if(I=(l.flags&128)!==0,ne=j.rendering,ne===null)if(I)Ku(j,!1);else{if(kr!==0||a!==null&&(a.flags&128)!==0)for(a=l.child;a!==null;){if(ne=wa(a),ne!==null){for(l.flags|=128,Ku(j,!1),I=ne.updateQueue,I!==null&&(l.updateQueue=I,l.flags|=4),l.subtreeFlags=0,I=g,g=l.child;g!==null;)j=g,a=I,j.flags&=14680066,ne=j.alternate,ne===null?(j.childLanes=0,j.lanes=a,j.child=null,j.subtreeFlags=0,j.memoizedProps=null,j.memoizedState=null,j.updateQueue=null,j.dependencies=null,j.stateNode=null):(j.childLanes=ne.childLanes,j.lanes=ne.lanes,j.child=ne.child,j.subtreeFlags=0,j.deletions=null,j.memoizedProps=ne.memoizedProps,j.memoizedState=ne.memoizedState,j.updateQueue=ne.updateQueue,j.type=ne.type,a=ne.dependencies,j.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),g=g.sibling;return wi(zi,zi.current&1|2),l.child}a=a.sibling}j.tail!==null&&fn()>Di&&(l.flags|=128,I=!0,Ku(j,!1),l.lanes=4194304)}else{if(!I)if(a=wa(ne),a!==null){if(l.flags|=128,I=!0,g=a.updateQueue,g!==null&&(l.updateQueue=g,l.flags|=4),Ku(j,!0),j.tail===null&&j.tailMode==="hidden"&&!ne.alternate&&!ge)return ss(l),null}else 2*fn()-j.renderingStartTime>Di&&g!==1073741824&&(l.flags|=128,I=!0,Ku(j,!1),l.lanes=4194304);j.isBackwards?(ne.sibling=l.child,l.child=ne):(g=j.last,g!==null?g.sibling=ne:l.child=ne,j.last=ne)}return j.tail!==null?(l=j.tail,j.rendering=l,j.tail=l.sibling,j.renderingStartTime=fn(),l.sibling=null,g=zi.current,wi(zi,I?g&1|2:g&1),l):(ss(l),null);case 22:case 23:return qc(),I=l.memoizedState!==null,a!==null&&a.memoizedState!==null!==I&&(l.flags|=8192),I&&(l.mode&1)!==0?(os&1073741824)!==0&&(ss(l),l.subtreeFlags&6&&(l.flags|=8192)):ss(l),null;case 24:return null;case 25:return null}throw Error(S(156,l.tag))}function hp(a,l){switch(ue(l),l.tag){case 1:return Cr(l.type)&&gu(),a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 3:return xa(),yi(On),yi(ui),Vl(),a=l.flags,(a&65536)!==0&&(a&128)===0?(l.flags=a&-65537|128,l):null;case 5:return bc(l),null;case 13:if(yi(zi),a=l.memoizedState,a!==null&&a.dehydrated!==null){if(l.alternate===null)throw Error(S(340));St()}return a=l.flags,a&65536?(l.flags=a&-65537|128,l):null;case 19:return yi(zi),null;case 4:return xa(),null;case 10:return bs(l.type._context),null;case 22:case 23:return qc(),null;case 24:return null;default:return null}}var bh=!1,as=!1,Hl=typeof WeakSet=="function"?WeakSet:Set,Jt=null;function bu(a,l){var g=a.ref;if(g!==null)if(typeof g=="function")try{g(null)}catch(I){Gi(a,l,I)}else g.current=null}function Xl(a,l,g){try{g()}catch(I){Gi(a,l,I)}}var cd=!1;function fp(a,l){if(po=za,a=re(),de(a)){if("selectionStart"in a)var g={start:a.selectionStart,end:a.selectionEnd};else e:{g=(g=a.ownerDocument)&&g.defaultView||window;var I=g.getSelection&&g.getSelection();if(I&&I.rangeCount!==0){g=I.anchorNode;var z=I.anchorOffset,j=I.focusNode;I=I.focusOffset;try{g.nodeType,j.nodeType}catch{g=null;break e}var ne=0,xe=-1,Pe=-1,Je=0,gt=0,xt=a,mt=null;t:for(;;){for(var Rt;xt!==g||z!==0&&xt.nodeType!==3||(xe=ne+z),xt!==j||I!==0&&xt.nodeType!==3||(Pe=ne+I),xt.nodeType===3&&(ne+=xt.nodeValue.length),(Rt=xt.firstChild)!==null;)mt=xt,xt=Rt;for(;;){if(xt===a)break t;if(mt===g&&++Je===z&&(xe=ne),mt===j&&++gt===I&&(Pe=ne),(Rt=xt.nextSibling)!==null)break;xt=mt,mt=xt.parentNode}xt=Rt}g=xe===-1||Pe===-1?null:{start:xe,end:Pe}}else g=null}g=g||{start:0,end:0}}else g=null;for(yc={focusedElem:a,selectionRange:g},za=!1,Jt=l;Jt!==null;)if(l=Jt,a=l.child,(l.subtreeFlags&1028)!==0&&a!==null)a.return=l,Jt=a;else for(;Jt!==null;){l=Jt;try{var Xt=l.alternate;if((l.flags&1024)!==0)switch(l.tag){case 0:case 11:case 15:break;case 1:if(Xt!==null){var nn=Xt.memoizedProps,tr=Xt.memoizedState,He=l.stateNode,ze=He.getSnapshotBeforeUpdate(l.elementType===l.type?nn:qa(l.type,nn),tr);He.__reactInternalSnapshotBeforeUpdate=ze}break;case 3:var Xe=l.stateNode.containerInfo;Xe.nodeType===1?Xe.textContent="":Xe.nodeType===9&&Xe.documentElement&&Xe.removeChild(Xe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(S(163))}}catch(Tt){Gi(l,l.return,Tt)}if(a=l.sibling,a!==null){a.return=l.return,Jt=a;break}Jt=l.return}return Xt=cd,cd=!1,Xt}function zc(a,l,g){var I=l.updateQueue;if(I=I!==null?I.lastEffect:null,I!==null){var z=I=I.next;do{if((z.tag&a)===a){var j=z.destroy;z.destroy=void 0,j!==void 0&&Xl(l,g,j)}z=z.next}while(z!==I)}}function Dc(a,l){if(l=l.updateQueue,l=l!==null?l.lastEffect:null,l!==null){var g=l=l.next;do{if((g.tag&a)===a){var I=g.create;g.destroy=I()}g=g.next}while(g!==l)}}function kh(a){var l=a.ref;if(l!==null){var g=a.stateNode;a.tag,a=g,typeof l=="function"?l(a):l.current=a}}function hd(a){var l=a.alternate;l!==null&&(a.alternate=null,hd(l)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(l=a.stateNode,l!==null&&(delete l[Xr],delete l[ja],delete l[zn],delete l[vc],delete l[Kh])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function fd(a){return a.tag===5||a.tag===3||a.tag===4}function dd(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||fd(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function gf(a,l,g){var I=a.tag;if(I===5||I===6)a=a.stateNode,l?g.nodeType===8?g.parentNode.insertBefore(a,l):g.insertBefore(a,l):(g.nodeType===8?(l=g.parentNode,l.insertBefore(a,g)):(l=g,l.appendChild(a)),g=g._reactRootContainer,g!=null||l.onclick!==null||(l.onclick=ns));else if(I!==4&&(a=a.child,a!==null))for(gf(a,l,g),a=a.sibling;a!==null;)gf(a,l,g),a=a.sibling}function Oc(a,l,g){var I=a.tag;if(I===5||I===6)a=a.stateNode,l?g.insertBefore(a,l):g.appendChild(a);else if(I!==4&&(a=a.child,a!==null))for(Oc(a,l,g),a=a.sibling;a!==null;)Oc(a,l,g),a=a.sibling}var cr=null,Ea=!1;function Wl(a,l,g){for(g=g.child;g!==null;)pd(a,l,g),g=g.sibling}function pd(a,l,g){if(sr&&typeof sr.onCommitFiberUnmount=="function")try{sr.onCommitFiberUnmount(Bi,g)}catch{}switch(g.tag){case 5:as||bu(g,l);case 6:var I=cr,z=Ea;cr=null,Wl(a,l,g),cr=I,Ea=z,cr!==null&&(Ea?(a=cr,g=g.stateNode,a.nodeType===8?a.parentNode.removeChild(g):a.removeChild(g)):cr.removeChild(g.stateNode));break;case 18:cr!==null&&(Ea?(a=cr,g=g.stateNode,a.nodeType===8?Ot(a.parentNode,g):a.nodeType===1&&Ot(a,g),Ds(a)):Ot(cr,g.stateNode));break;case 4:I=cr,z=Ea,cr=g.stateNode.containerInfo,Ea=!0,Wl(a,l,g),cr=I,Ea=z;break;case 0:case 11:case 14:case 15:if(!as&&(I=g.updateQueue,I!==null&&(I=I.lastEffect,I!==null))){z=I=I.next;do{var j=z,ne=j.destroy;j=j.tag,ne!==void 0&&((j&2)!==0||(j&4)!==0)&&Xl(g,l,ne),z=z.next}while(z!==I)}Wl(a,l,g);break;case 1:if(!as&&(bu(g,l),I=g.stateNode,typeof I.componentWillUnmount=="function"))try{I.props=g.memoizedProps,I.state=g.memoizedState,I.componentWillUnmount()}catch(xe){Gi(g,l,xe)}Wl(a,l,g);break;case 21:Wl(a,l,g);break;case 22:g.mode&1?(as=(I=as)||g.memoizedState!==null,Wl(a,l,g),as=I):Wl(a,l,g);break;default:Wl(a,l,g)}}function yf(a){var l=a.updateQueue;if(l!==null){a.updateQueue=null;var g=a.stateNode;g===null&&(g=a.stateNode=new Hl),l.forEach(function(I){var z=Id.bind(null,a,I);g.has(I)||(g.add(I),I.then(z,z))})}}function vo(a,l){var g=l.deletions;if(g!==null)for(var I=0;I<g.length;I++){var z=g[I];try{var j=a,ne=l,xe=ne;e:for(;xe!==null;){switch(xe.tag){case 5:cr=xe.stateNode,Ea=!1;break e;case 3:cr=xe.stateNode.containerInfo,Ea=!0;break e;case 4:cr=xe.stateNode.containerInfo,Ea=!0;break e}xe=xe.return}if(cr===null)throw Error(S(160));pd(j,ne,z),cr=null,Ea=!1;var Pe=z.alternate;Pe!==null&&(Pe.return=null),z.return=null}catch(Je){Gi(z,l,Je)}}if(l.subtreeFlags&12854)for(l=l.child;l!==null;)md(l,a),l=l.sibling}function md(a,l){var g=a.alternate,I=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(vo(l,a),Hs(a),I&4){try{zc(3,a,a.return),Dc(3,a)}catch(nn){Gi(a,a.return,nn)}try{zc(5,a,a.return)}catch(nn){Gi(a,a.return,nn)}}break;case 1:vo(l,a),Hs(a),I&512&&g!==null&&bu(g,g.return);break;case 5:if(vo(l,a),Hs(a),I&512&&g!==null&&bu(g,g.return),a.flags&32){var z=a.stateNode;try{dn(z,"")}catch(nn){Gi(a,a.return,nn)}}if(I&4&&(z=a.stateNode,z!=null)){var j=a.memoizedProps,ne=g!==null?g.memoizedProps:j,xe=a.type,Pe=a.updateQueue;if(a.updateQueue=null,Pe!==null)try{xe==="input"&&j.type==="radio"&&j.name!=null&&Ye(z,j),qr(xe,ne);var Je=qr(xe,j);for(ne=0;ne<Pe.length;ne+=2){var gt=Pe[ne],xt=Pe[ne+1];gt==="style"?In(z,xt):gt==="dangerouslySetInnerHTML"?Ur(z,xt):gt==="children"?dn(z,xt):Ge(z,gt,xt,Je)}switch(xe){case"input":ds(z,j);break;case"textarea":vn(z,j);break;case"select":var mt=z._wrapperState.wasMultiple;z._wrapperState.wasMultiple=!!j.multiple;var Rt=j.value;Rt!=null?ps(z,!!j.multiple,Rt,!1):mt!==!!j.multiple&&(j.defaultValue!=null?ps(z,!!j.multiple,j.defaultValue,!0):ps(z,!!j.multiple,j.multiple?[]:"",!1))}z[ja]=j}catch(nn){Gi(a,a.return,nn)}}break;case 6:if(vo(l,a),Hs(a),I&4){if(a.stateNode===null)throw Error(S(162));z=a.stateNode,j=a.memoizedProps;try{z.nodeValue=j}catch(nn){Gi(a,a.return,nn)}}break;case 3:if(vo(l,a),Hs(a),I&4&&g!==null&&g.memoizedState.isDehydrated)try{Ds(l.containerInfo)}catch(nn){Gi(a,a.return,nn)}break;case 4:vo(l,a),Hs(a);break;case 13:vo(l,a),Hs(a),z=a.child,z.flags&8192&&(j=z.memoizedState!==null,z.stateNode.isHidden=j,!j||z.alternate!==null&&z.alternate.memoizedState!==null||(Su=fn())),I&4&&yf(a);break;case 22:if(gt=g!==null&&g.memoizedState!==null,a.mode&1?(as=(Je=as)||gt,vo(l,a),as=Je):vo(l,a),Hs(a),I&8192){if(Je=a.memoizedState!==null,(a.stateNode.isHidden=Je)&&!gt&&(a.mode&1)!==0)for(Jt=a,gt=a.child;gt!==null;){for(xt=Jt=gt;Jt!==null;){switch(mt=Jt,Rt=mt.child,mt.tag){case 0:case 11:case 14:case 15:zc(4,mt,mt.return);break;case 1:bu(mt,mt.return);var Xt=mt.stateNode;if(typeof Xt.componentWillUnmount=="function"){I=mt,g=mt.return;try{l=I,Xt.props=l.memoizedProps,Xt.state=l.memoizedState,Xt.componentWillUnmount()}catch(nn){Gi(I,g,nn)}}break;case 5:bu(mt,mt.return);break;case 22:if(mt.memoizedState!==null){vd(xt);continue}}Rt!==null?(Rt.return=mt,Jt=Rt):vd(xt)}gt=gt.sibling}e:for(gt=null,xt=a;;){if(xt.tag===5){if(gt===null){gt=xt;try{z=xt.stateNode,Je?(j=z.style,typeof j.setProperty=="function"?j.setProperty("display","none","important"):j.display="none"):(xe=xt.stateNode,Pe=xt.memoizedProps.style,ne=Pe!=null&&Pe.hasOwnProperty("display")?Pe.display:null,xe.style.display=_t("display",ne))}catch(nn){Gi(a,a.return,nn)}}}else if(xt.tag===6){if(gt===null)try{xt.stateNode.nodeValue=Je?"":xt.memoizedProps}catch(nn){Gi(a,a.return,nn)}}else if((xt.tag!==22&&xt.tag!==23||xt.memoizedState===null||xt===a)&&xt.child!==null){xt.child.return=xt,xt=xt.child;continue}if(xt===a)break e;for(;xt.sibling===null;){if(xt.return===null||xt.return===a)break e;gt===xt&&(gt=null),xt=xt.return}gt===xt&&(gt=null),xt.sibling.return=xt.return,xt=xt.sibling}}break;case 19:vo(l,a),Hs(a),I&4&&yf(a);break;case 21:break;default:vo(l,a),Hs(a)}}function Hs(a){var l=a.flags;if(l&2){try{e:{for(var g=a.return;g!==null;){if(fd(g)){var I=g;break e}g=g.return}throw Error(S(160))}switch(I.tag){case 5:var z=I.stateNode;I.flags&32&&(dn(z,""),I.flags&=-33);var j=dd(a);Oc(a,j,z);break;case 3:case 4:var ne=I.stateNode.containerInfo,xe=dd(a);gf(a,xe,ne);break;default:throw Error(S(161))}}catch(Pe){Gi(a,a.return,Pe)}a.flags&=-3}l&4096&&(a.flags&=-4097)}function gd(a,l,g){Jt=a,yd(a)}function yd(a,l,g){for(var I=(a.mode&1)!==0;Jt!==null;){var z=Jt,j=z.child;if(z.tag===22&&I){var ne=z.memoizedState!==null||bh;if(!ne){var xe=z.alternate,Pe=xe!==null&&xe.memoizedState!==null||as;xe=bh;var Je=as;if(bh=ne,(as=Pe)&&!Je)for(Jt=z;Jt!==null;)ne=Jt,Pe=ne.child,ne.tag===22&&ne.memoizedState!==null?xd(z):Pe!==null?(Pe.return=ne,Jt=Pe):xd(z);for(;j!==null;)Jt=j,yd(j),j=j.sibling;Jt=z,bh=xe,as=Je}_d(a)}else(z.subtreeFlags&8772)!==0&&j!==null?(j.return=z,Jt=j):_d(a)}}function _d(a){for(;Jt!==null;){var l=Jt;if((l.flags&8772)!==0){var g=l.alternate;try{if((l.flags&8772)!==0)switch(l.tag){case 0:case 11:case 15:as||Dc(5,l);break;case 1:var I=l.stateNode;if(l.flags&4&&!as)if(g===null)I.componentDidMount();else{var z=l.elementType===l.type?g.memoizedProps:qa(l.type,g.memoizedProps);I.componentDidUpdate(z,g.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var j=l.updateQueue;j!==null&&Zs(l,j,I);break;case 3:var ne=l.updateQueue;if(ne!==null){if(g=null,l.child!==null)switch(l.child.tag){case 5:g=l.child.stateNode;break;case 1:g=l.child.stateNode}Zs(l,ne,g)}break;case 5:var xe=l.stateNode;if(g===null&&l.flags&4){g=xe;var Pe=l.memoizedProps;switch(l.type){case"button":case"input":case"select":case"textarea":Pe.autoFocus&&g.focus();break;case"img":Pe.src&&(g.src=Pe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(l.memoizedState===null){var Je=l.alternate;if(Je!==null){var gt=Je.memoizedState;if(gt!==null){var xt=gt.dehydrated;xt!==null&&Ds(xt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(S(163))}as||l.flags&512&&kh(l)}catch(mt){Gi(l,l.return,mt)}}if(l===a){Jt=null;break}if(g=l.sibling,g!==null){g.return=l.return,Jt=g;break}Jt=l.return}}function vd(a){for(;Jt!==null;){var l=Jt;if(l===a){Jt=null;break}var g=l.sibling;if(g!==null){g.return=l.return,Jt=g;break}Jt=l.return}}function xd(a){for(;Jt!==null;){var l=Jt;try{switch(l.tag){case 0:case 11:case 15:var g=l.return;try{Dc(4,l)}catch(Pe){Gi(l,g,Pe)}break;case 1:var I=l.stateNode;if(typeof I.componentDidMount=="function"){var z=l.return;try{I.componentDidMount()}catch(Pe){Gi(l,z,Pe)}}var j=l.return;try{kh(l)}catch(Pe){Gi(l,j,Pe)}break;case 5:var ne=l.return;try{kh(l)}catch(Pe){Gi(l,ne,Pe)}}}catch(Pe){Gi(l,l.return,Pe)}if(l===a){Jt=null;break}var xe=l.sibling;if(xe!==null){xe.return=l.return,Jt=xe;break}Jt=l.return}}var dp=Math.ceil,Sh=it.ReactCurrentDispatcher,Eh=it.ReactCurrentOwner,Xs=it.ReactCurrentBatchConfig,ni=0,Ar=null,hr=null,Kr=0,os=0,Ju=Oo(0),kr=0,Fc=null,ku=0,Ih=0,Th=0,Bc=null,Ws=null,Su=0,Di=1/0,Uo=null,jc=!1,Ch=null,$n=null,Qu=!1,cl=null,Vc=0,Ia=0,Yl=null,Uc=-1,Ph=0;function Ts(){return(ni&6)!==0?fn():Uc!==-1?Uc:Uc=fn()}function Kl(a){return(a.mode&1)===0?1:(ni&2)!==0&&Kr!==0?Kr&-Kr:Et.transition!==null?(Ph===0&&(Ph=la()),Ph):(a=qn,a!==0||(a=window.event,a=a===void 0?16:vr(a.type)),a)}function xo(a,l,g,I){if(50<Ia)throw Ia=0,Yl=null,Error(S(185));Wa(a,g,I),((ni&2)===0||a!==Ar)&&(a===Ar&&((ni&2)===0&&(Ih|=g),kr===4&&wo(a,Kr)),Ys(a,I),g===1&&ni===0&&(l.mode&1)===0&&(Di=fn()+500,sn&&_()))}function Ys(a,l){var g=a.callbackNode;Wo(a,l);var I=Li(a,a===Ar?Kr:0);if(I===0)g!==null&&Bn(g),a.callbackNode=null,a.callbackPriority=0;else if(l=I&-I,a.callbackPriority!==l){if(g!=null&&Bn(g),l===1)a.tag===0?xc(Eu.bind(null,a)):yu(Eu.bind(null,a)),Dl(function(){(ni&6)===0&&_()}),g=null;else{switch(Mo(I)){case 1:g=Xa;break;case 4:g=yr;break;case 16:g=rr;break;case 536870912:g=Ii;break;default:g=rr}g=bf(g,wd.bind(null,a))}a.callbackPriority=l,a.callbackNode=g}}function wd(a,l){if(Uc=-1,Ph=0,(ni&6)!==0)throw Error(S(327));var g=a.callbackNode;if(ko()&&a.callbackNode!==g)return null;var I=Li(a,a===Ar?Kr:0);if(I===0)return null;if((I&30)!==0||(I&a.expiredLanes)!==0||l)l=Gc(a,I);else{l=I;var z=ni;ni|=2;var j=kd();(Ar!==a||Kr!==l)&&(Uo=null,Di=fn()+500,Iu(a,l));do try{xf();break}catch(xe){bd(a,xe)}while(!0);wr(),Sh.current=j,ni=z,hr!==null?l=0:(Ar=null,Kr=0,l=kr)}if(l!==0){if(l===2&&(z=Nr(a),z!==0&&(I=z,l=_f(a,z))),l===1)throw g=Fc,Iu(a,0),wo(a,I),Ys(a,fn()),g;if(l===6)wo(a,I);else{if(z=a.current.alternate,(I&30)===0&&!pp(z)&&(l=Gc(a,I),l===2&&(j=Nr(a),j!==0&&(I=j,l=_f(a,j))),l===1))throw g=Fc,Iu(a,0),wo(a,I),Ys(a,fn()),g;switch(a.finishedWork=z,a.finishedLanes=I,l){case 0:case 1:throw Error(S(345));case 2:bo(a,Ws,Uo);break;case 3:if(wo(a,I),(I&130023424)===I&&(l=Su+500-fn(),10<l)){if(Li(a,0)!==0)break;if(z=a.suspendedLanes,(z&I)!==I){Ts(),a.pingedLanes|=a.suspendedLanes&z;break}a.timeoutHandle=Vu(bo.bind(null,a,Ws,Uo),l);break}bo(a,Ws,Uo);break;case 4:if(wo(a,I),(I&4194240)===I)break;for(l=a.eventTimes,z=-1;0<I;){var ne=31-Wn(I);j=1<<ne,ne=l[ne],ne>z&&(z=ne),I&=~j}if(I=z,I=fn()-I,I=(120>I?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*dp(I/1960))-I,10<I){a.timeoutHandle=Vu(bo.bind(null,a,Ws,Uo),I);break}bo(a,Ws,Uo);break;case 5:bo(a,Ws,Uo);break;default:throw Error(S(329))}}}return Ys(a,fn()),a.callbackNode===g?wd.bind(null,a):null}function _f(a,l){var g=Bc;return a.current.memoizedState.isDehydrated&&(Iu(a,l).flags|=256),a=Gc(a,l),a!==2&&(l=Ws,Ws=g,l!==null&&vf(l)),a}function vf(a){Ws===null?Ws=a:Ws.push.apply(Ws,a)}function pp(a){for(var l=a;;){if(l.flags&16384){var g=l.updateQueue;if(g!==null&&(g=g.stores,g!==null))for(var I=0;I<g.length;I++){var z=g[I],j=z.getSnapshot;z=z.value;try{if(!h(j(),z))return!1}catch{return!1}}}if(g=l.child,l.subtreeFlags&16384&&g!==null)g.return=l,l=g;else{if(l===a)break;for(;l.sibling===null;){if(l.return===null||l.return===a)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function wo(a,l){for(l&=~Th,l&=~Ih,a.suspendedLanes|=l,a.pingedLanes&=~l,a=a.expirationTimes;0<l;){var g=31-Wn(l),I=1<<g;a[g]=-1,l&=~I}}function Eu(a){if((ni&6)!==0)throw Error(S(327));ko();var l=Li(a,0);if((l&1)===0)return Ys(a,fn()),null;var g=Gc(a,l);if(a.tag!==0&&g===2){var I=Nr(a);I!==0&&(l=I,g=_f(a,I))}if(g===1)throw g=Fc,Iu(a,0),wo(a,l),Ys(a,fn()),g;if(g===6)throw Error(S(345));return a.finishedWork=a.current.alternate,a.finishedLanes=l,bo(a,Ws,Uo),Ys(a,fn()),null}function Mh(a,l){var g=ni;ni|=1;try{return a(l)}finally{ni=g,ni===0&&(Di=fn()+500,sn&&_())}}function hl(a){cl!==null&&cl.tag===0&&(ni&6)===0&&ko();var l=ni;ni|=1;var g=Xs.transition,I=qn;try{if(Xs.transition=null,qn=1,a)return a()}finally{qn=I,Xs.transition=g,ni=l,(ni&6)===0&&_()}}function qc(){os=Ju.current,yi(Ju)}function Iu(a,l){a.finishedWork=null,a.finishedLanes=0;var g=a.timeoutHandle;if(g!==-1&&(a.timeoutHandle=-1,sh(g)),hr!==null)for(g=hr.return;g!==null;){var I=g;switch(ue(I),I.tag){case 1:I=I.type.childContextTypes,I!=null&&gu();break;case 3:xa(),yi(On),yi(ui),Vl();break;case 5:bc(I);break;case 4:xa();break;case 13:yi(zi);break;case 19:yi(zi);break;case 10:bs(I.type._context);break;case 22:case 23:qc()}g=g.return}if(Ar=a,hr=a=Jl(a.current,null),Kr=os=l,kr=0,Fc=null,Th=Ih=ku=0,Ws=Bc=null,Zi!==null){for(l=0;l<Zi.length;l++)if(g=Zi[l],I=g.interleaved,I!==null){g.interleaved=null;var z=I.next,j=g.pending;if(j!==null){var ne=j.next;j.next=z,I.next=ne}g.pending=I}Zi=null}return a}function bd(a,l){do{var g=hr;try{if(wr(),Vo.current=hh,kc){for(var I=fi.memoizedState;I!==null;){var z=I.queue;z!==null&&(z.pending=null),I=I.next}kc=!1}if(Ua=0,lr=qi=fi=null,$u=!1,Sc=0,Eh.current=null,g===null||g.return===null){kr=1,Fc=l,hr=null;break}e:{var j=a,ne=g.return,xe=g,Pe=l;if(l=Kr,xe.flags|=32768,Pe!==null&&typeof Pe=="object"&&typeof Pe.then=="function"){var Je=Pe,gt=xe,xt=gt.tag;if((gt.mode&1)===0&&(xt===0||xt===11||xt===15)){var mt=gt.alternate;mt?(gt.updateQueue=mt.updateQueue,gt.memoizedState=mt.memoizedState,gt.lanes=mt.lanes):(gt.updateQueue=null,gt.memoizedState=null)}var Rt=td(ne);if(Rt!==null){Rt.flags&=-257,nd(Rt,ne,xe,j,l),Rt.mode&1&&ed(j,Je,l),l=Rt,Pe=Je;var Xt=l.updateQueue;if(Xt===null){var nn=new Set;nn.add(Pe),l.updateQueue=nn}else Xt.add(Pe);break e}else{if((l&1)===0){ed(j,Je,l),Ah();break e}Pe=Error(S(426))}}else if(ge&&xe.mode&1){var tr=td(ne);if(tr!==null){(tr.flags&65536)===0&&(tr.flags|=256),nd(tr,ne,xe,j,l),Lt(Or(Pe,xe));break e}}j=Pe=Or(Pe,xe),kr!==4&&(kr=2),Bc===null?Bc=[j]:Bc.push(j),j=ne;do{switch(j.tag){case 3:j.flags|=65536,l&=-l,j.lanes|=l;var He=uf(j,Pe,l);Ss(j,He);break e;case 1:xe=Pe;var ze=j.type,Xe=j.stateNode;if((j.flags&128)===0&&(typeof ze.getDerivedStateFromError=="function"||Xe!==null&&typeof Xe.componentDidCatch=="function"&&($n===null||!$n.has(Xe)))){j.flags|=65536,l&=-l,j.lanes|=l;var Tt=Qf(j,xe,l);Ss(j,Tt);break e}}j=j.return}while(j!==null)}fl(g)}catch(un){l=un,hr===g&&g!==null&&(hr=g=g.return);continue}break}while(!0)}function kd(){var a=Sh.current;return Sh.current=hh,a===null?hh:a}function Ah(){(kr===0||kr===3||kr===2)&&(kr=4),Ar===null||(ku&268435455)===0&&(Ih&268435455)===0||wo(Ar,Kr)}function Gc(a,l){var g=ni;ni|=2;var I=kd();(Ar!==a||Kr!==l)&&(Uo=null,Iu(a,l));do try{Cs();break}catch(z){bd(a,z)}while(!0);if(wr(),ni=g,Sh.current=I,hr!==null)throw Error(S(261));return Ar=null,Kr=0,kr}function Cs(){for(;hr!==null;)wf(hr)}function xf(){for(;hr!==null&&!Er();)wf(hr)}function wf(a){var l=Td(a.alternate,a,os);a.memoizedProps=a.pendingProps,l===null?fl(a):hr=l,Eh.current=null}function fl(a){var l=a;do{var g=l.alternate;if(a=l.return,(l.flags&32768)===0){if(g=cp(g,l,os),g!==null){hr=g;return}}else{if(g=hp(g,l),g!==null){g.flags&=32767,hr=g;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{kr=6,hr=null;return}}if(l=l.sibling,l!==null){hr=l;return}hr=l=a}while(l!==null);kr===0&&(kr=5)}function bo(a,l,g){var I=qn,z=Xs.transition;try{Xs.transition=null,qn=1,$c(a,l,g,I)}finally{Xs.transition=z,qn=I}return null}function $c(a,l,g,I){do ko();while(cl!==null);if((ni&6)!==0)throw Error(S(327));g=a.finishedWork;var z=a.finishedLanes;if(g===null)return null;if(a.finishedWork=null,a.finishedLanes=0,g===a.current)throw Error(S(177));a.callbackNode=null,a.callbackPriority=0;var j=g.lanes|g.childLanes;if(au(a,j),a===Ar&&(hr=Ar=null,Kr=0),(g.subtreeFlags&2064)===0&&(g.flags&2064)===0||Qu||(Qu=!0,bf(rr,function(){return ko(),null})),j=(g.flags&15990)!==0,(g.subtreeFlags&15990)!==0||j){j=Xs.transition,Xs.transition=null;var ne=qn;qn=1;var xe=ni;ni|=4,Eh.current=null,fp(a,g),md(g,a),De(yc),za=!!po,yc=po=null,a.current=g,gd(g),Po(),ni=xe,qn=ne,Xs.transition=j}else a.current=g;if(Qu&&(Qu=!1,cl=a,Vc=z),j=a.pendingLanes,j===0&&($n=null),Qr(g.stateNode),Ys(a,fn()),l!==null)for(I=a.onRecoverableError,g=0;g<l.length;g++)z=l[g],I(z.value,{componentStack:z.stack,digest:z.digest});if(jc)throw jc=!1,a=Ch,Ch=null,a;return(Vc&1)!==0&&a.tag!==0&&ko(),j=a.pendingLanes,(j&1)!==0?a===Yl?Ia++:(Ia=0,Yl=a):Ia=0,_(),null}function ko(){if(cl!==null){var a=Mo(Vc),l=Xs.transition,g=qn;try{if(Xs.transition=null,qn=16>a?16:a,cl===null)var I=!1;else{if(a=cl,cl=null,Vc=0,(ni&6)!==0)throw Error(S(331));var z=ni;for(ni|=4,Jt=a.current;Jt!==null;){var j=Jt,ne=j.child;if((Jt.flags&16)!==0){var xe=j.deletions;if(xe!==null){for(var Pe=0;Pe<xe.length;Pe++){var Je=xe[Pe];for(Jt=Je;Jt!==null;){var gt=Jt;switch(gt.tag){case 0:case 11:case 15:zc(8,gt,j)}var xt=gt.child;if(xt!==null)xt.return=gt,Jt=xt;else for(;Jt!==null;){gt=Jt;var mt=gt.sibling,Rt=gt.return;if(hd(gt),gt===Je){Jt=null;break}if(mt!==null){mt.return=Rt,Jt=mt;break}Jt=Rt}}}var Xt=j.alternate;if(Xt!==null){var nn=Xt.child;if(nn!==null){Xt.child=null;do{var tr=nn.sibling;nn.sibling=null,nn=tr}while(nn!==null)}}Jt=j}}if((j.subtreeFlags&2064)!==0&&ne!==null)ne.return=j,Jt=ne;else e:for(;Jt!==null;){if(j=Jt,(j.flags&2048)!==0)switch(j.tag){case 0:case 11:case 15:zc(9,j,j.return)}var He=j.sibling;if(He!==null){He.return=j.return,Jt=He;break e}Jt=j.return}}var ze=a.current;for(Jt=ze;Jt!==null;){ne=Jt;var Xe=ne.child;if((ne.subtreeFlags&2064)!==0&&Xe!==null)Xe.return=ne,Jt=Xe;else e:for(ne=ze;Jt!==null;){if(xe=Jt,(xe.flags&2048)!==0)try{switch(xe.tag){case 0:case 11:case 15:Dc(9,xe)}}catch(un){Gi(xe,xe.return,un)}if(xe===ne){Jt=null;break e}var Tt=xe.sibling;if(Tt!==null){Tt.return=xe.return,Jt=Tt;break e}Jt=xe.return}}if(ni=z,_(),sr&&typeof sr.onPostCommitFiberRoot=="function")try{sr.onPostCommitFiberRoot(Bi,a)}catch{}I=!0}return I}finally{qn=g,Xs.transition=l}}return!1}function Zc(a,l,g){l=Or(g,l),l=uf(a,l,1),a=Va(a,l,1),l=Ts(),a!==null&&(Wa(a,1,l),Ys(a,l))}function Gi(a,l,g){if(a.tag===3)Zc(a,a,g);else for(;l!==null;){if(l.tag===3){Zc(l,a,g);break}else if(l.tag===1){var I=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&($n===null||!$n.has(I))){a=Or(g,a),a=Qf(l,a,1),l=Va(l,a,1),a=Ts(),l!==null&&(Wa(l,1,a),Ys(l,a));break}}l=l.return}}function mp(a,l,g){var I=a.pingCache;I!==null&&I.delete(l),l=Ts(),a.pingedLanes|=a.suspendedLanes&g,Ar===a&&(Kr&g)===g&&(kr===4||kr===3&&(Kr&130023424)===Kr&&500>fn()-Su?Iu(a,0):Th|=g),Ys(a,l)}function Sd(a,l){l===0&&((a.mode&1)===0?l=1:(l=Ir,Ir<<=1,(Ir&130023424)===0&&(Ir=4194304)));var g=Ts();a=is(a,l),a!==null&&(Wa(a,l,g),Ys(a,g))}function Ed(a){var l=a.memoizedState,g=0;l!==null&&(g=l.retryLane),Sd(a,g)}function Id(a,l){var g=0;switch(a.tag){case 13:var I=a.stateNode,z=a.memoizedState;z!==null&&(g=z.retryLane);break;case 19:I=a.stateNode;break;default:throw Error(S(314))}I!==null&&I.delete(l),Sd(a,g)}var Td;Td=function(a,l,g){if(a!==null)if(a.memoizedProps!==l.pendingProps||On.current)Is=!0;else{if((a.lanes&g)===0&&(l.flags&128)===0)return Is=!1,pf(a,l,g);Is=(a.flags&131072)!==0}else Is=!1,ge&&(l.flags&1048576)!==0&&Z(l,p,l.index);switch(l.lanes=0,l.tag){case 2:var I=l.type;Rc(a,l),a=l.pendingProps;var z=go(l,ui.current);or(l,g),z=yo(null,l,I,a,z,g);var j=ba();return l.flags|=1,typeof z=="object"&&z!==null&&typeof z.render=="function"&&z.$$typeof===void 0?(l.tag=1,l.memoizedState=null,l.updateQueue=null,Cr(I)?(j=!0,ws(l)):j=!1,l.memoizedState=z.state!==null&&z.state!==void 0?z.state:null,Bo(l),z.updater=ph,l.stateNode=z,z._reactInternals=l,xu(l,I,a,g),l=hf(null,l,I,!0,j,g)):(l.tag=0,ge&&j&&te(l),ur(null,l,z,g),l=l.child),l;case 16:I=l.elementType;e:{switch(Rc(a,l),a=l.pendingProps,z=I._init,I=z(I._payload),l.type=I,z=l.tag=gp(I),a=qa(I,a),z){case 0:l=cf(null,l,I,a,g);break e;case 1:l=ld(null,l,I,a,g);break e;case 11:l=Wu(null,l,I,a,g);break e;case 14:l=rd(null,l,I,qa(I.type,a),g);break e}throw Error(S(306,I,""))}return l;case 0:return I=l.type,z=l.pendingProps,z=l.elementType===I?z:qa(I,z),cf(a,l,I,z,g);case 1:return I=l.type,z=l.pendingProps,z=l.elementType===I?z:qa(I,z),ld(a,l,I,z,g);case 3:e:{if(_h(l),a===null)throw Error(S(387));I=l.pendingProps,j=l.memoizedState,z=j.element,ks(a,l),va(l,I,null,g);var ne=l.memoizedState;if(I=ne.element,j.isDehydrated)if(j={element:I,isDehydrated:!1,cache:ne.cache,pendingSuspenseBoundaries:ne.pendingSuspenseBoundaries,transitions:ne.transitions},l.updateQueue.baseState=j,l.memoizedState=j,l.flags&256){z=Or(Error(S(423)),l),l=ud(a,l,I,g,z);break e}else if(I!==z){z=Or(Error(S(424)),l),l=ud(a,l,I,g,z);break e}else for(pe=pa(l.stateNode.containerInfo.firstChild),he=l,ge=!0,ve=null,g=mn(l,null,I,g),l.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling;else{if(St(),I===z){l=Sa(a,l,g);break e}ur(a,l,I,g)}l=l.child}return l;case 5:return wc(l),a===null&&Oe(l),I=l.type,z=l.pendingProps,j=a!==null?a.memoizedProps:null,ne=z.children,_c(I,z)?ne=null:j!==null&&_c(I,j)&&(l.flags|=32),od(a,l),ur(a,l,ne,g),l.child;case 6:return a===null&&Oe(l),null;case 13:return Hi(a,l,g);case 4:return jo(l,l.stateNode.containerInfo),I=l.pendingProps,a===null?l.child=Ct(l,null,I,g):ur(a,l,I,g),l.child;case 11:return I=l.type,z=l.pendingProps,z=l.elementType===I?z:qa(I,z),Wu(a,l,I,z,g);case 7:return ur(a,l,l.pendingProps,g),l.child;case 8:return ur(a,l,l.pendingProps.children,g),l.child;case 12:return ur(a,l,l.pendingProps.children,g),l.child;case 10:e:{if(I=l.type._context,z=l.pendingProps,j=l.memoizedProps,ne=z.value,wi(li,I._currentValue),I._currentValue=ne,j!==null)if(h(j.value,ne)){if(j.children===z.children&&!On.current){l=Sa(a,l,g);break e}}else for(j=l.child,j!==null&&(j.return=l);j!==null;){var xe=j.dependencies;if(xe!==null){ne=j.child;for(var Pe=xe.firstContext;Pe!==null;){if(Pe.context===I){if(j.tag===1){Pe=$s(-1,g&-g),Pe.tag=2;var Je=j.updateQueue;if(Je!==null){Je=Je.shared;var gt=Je.pending;gt===null?Pe.next=Pe:(Pe.next=gt.next,gt.next=Pe),Je.pending=Pe}}j.lanes|=g,Pe=j.alternate,Pe!==null&&(Pe.lanes|=g),hi(j.return,g,l),xe.lanes|=g;break}Pe=Pe.next}}else if(j.tag===10)ne=j.type===l.type?null:j.child;else if(j.tag===18){if(ne=j.return,ne===null)throw Error(S(341));ne.lanes|=g,xe=ne.alternate,xe!==null&&(xe.lanes|=g),hi(ne,g,l),ne=j.sibling}else ne=j.child;if(ne!==null)ne.return=j;else for(ne=j;ne!==null;){if(ne===l){ne=null;break}if(j=ne.sibling,j!==null){j.return=ne.return,ne=j;break}ne=ne.return}j=ne}ur(a,l,z.children,g),l=l.child}return l;case 9:return z=l.type,I=l.pendingProps.children,or(l,g),z=bi(z),I=I(z),l.flags|=1,ur(a,l,I,g),l.child;case 14:return I=l.type,z=qa(I,l.pendingProps),z=qa(I.type,z),rd(a,l,I,z,g);case 15:return sd(a,l,l.type,l.pendingProps,g);case 17:return I=l.type,z=l.pendingProps,z=l.elementType===I?z:qa(I,z),Rc(a,l),l.tag=1,Cr(I)?(a=!0,ws(l)):a=!1,or(l,g),lf(l,I,z),xu(l,I,z,g),hf(null,l,I,!0,a,g);case 19:return df(a,l,g);case 22:return ad(a,l,g)}throw Error(S(156,l.tag))};function bf(a,l){return Ei(a,l)}function Cd(a,l,g,I){this.tag=a,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ks(a,l,g,I){return new Cd(a,l,g,I)}function Hc(a){return a=a.prototype,!(!a||!a.isReactComponent)}function gp(a){if(typeof a=="function")return Hc(a)?1:0;if(a!=null){if(a=a.$$typeof,a===Zt)return 11;if(a===zt)return 14}return 2}function Jl(a,l){var g=a.alternate;return g===null?(g=Ks(a.tag,l,a.key,a.mode),g.elementType=a.elementType,g.type=a.type,g.stateNode=a.stateNode,g.alternate=a,a.alternate=g):(g.pendingProps=l,g.type=a.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=a.flags&14680064,g.childLanes=a.childLanes,g.lanes=a.lanes,g.child=a.child,g.memoizedProps=a.memoizedProps,g.memoizedState=a.memoizedState,g.updateQueue=a.updateQueue,l=a.dependencies,g.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},g.sibling=a.sibling,g.index=a.index,g.ref=a.ref,g}function Xc(a,l,g,I,z,j){var ne=2;if(I=a,typeof a=="function")Hc(a)&&(ne=1);else if(typeof a=="string")ne=5;else e:switch(a){case at:return Ql(g.children,z,j,l);case ht:ne=8,z|=8;break;case ft:return a=Ks(12,g,l,z|2),a.elementType=ft,a.lanes=j,a;case Bt:return a=Ks(13,g,l,z),a.elementType=Bt,a.lanes=j,a;case je:return a=Ks(19,g,l,z),a.elementType=je,a.lanes=j,a;case rn:return eu(g,z,j,l);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case $t:ne=10;break e;case wt:ne=9;break e;case Zt:ne=11;break e;case zt:ne=14;break e;case an:ne=16,I=null;break e}throw Error(S(130,a==null?a:typeof a,""))}return l=Ks(ne,g,l,z),l.elementType=a,l.type=I,l.lanes=j,l}function Ql(a,l,g,I){return a=Ks(7,a,I,l),a.lanes=g,a}function eu(a,l,g,I){return a=Ks(22,a,I,l),a.elementType=rn,a.lanes=g,a.stateNode={isHidden:!1},a}function Ga(a,l,g){return a=Ks(6,a,null,l),a.lanes=g,a}function qo(a,l,g){return l=Ks(4,a.children!==null?a.children:[],a.key,l),l.lanes=g,l.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},l}function Pd(a,l,g,I,z){this.tag=l,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Un(0),this.expirationTimes=Un(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Un(0),this.identifierPrefix=I,this.onRecoverableError=z,this.mutableSourceEagerHydrationData=null}function Wc(a,l,g,I,z,j,ne,xe,Pe){return a=new Pd(a,l,g,xe,Pe),l===1?(l=1,j===!0&&(l|=8)):l=0,j=Ks(3,null,null,l),a.current=j,j.stateNode=a,j.memoizedState={element:I,isDehydrated:g,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bo(j),a}function yp(a,l,g){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:tt,key:I==null?null:""+I,children:a,containerInfo:l,implementation:g}}function Md(a){if(!a)return Fo;a=a._reactInternals;e:{if(Sn(a)!==a||a.tag!==1)throw Error(S(170));var l=a;do{switch(l.tag){case 3:l=l.stateNode.context;break e;case 1:if(Cr(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break e}}l=l.return}while(l!==null);throw Error(S(171))}if(a.tag===1){var g=a.type;if(Cr(g))return Fl(a,g,l)}return l}function Yc(a,l,g,I,z,j,ne,xe,Pe){return a=Wc(g,I,!0,a,z,j,ne,xe,Pe),a.context=Md(null),g=a.current,I=Ts(),z=Kl(g),j=$s(I,z),j.callback=l??null,Va(g,j,z),a.current.lanes=z,Wa(a,z,I),Ys(a,I),a}function ec(a,l,g,I){var z=l.current,j=Ts(),ne=Kl(z);return g=Md(g),l.context===null?l.context=g:l.pendingContext=g,l=$s(j,ne),l.payload={element:a},I=I===void 0?null:I,I!==null&&(l.callback=I),a=Va(z,l,ne),a!==null&&(xo(a,z,ne,j),Wr(a,z,ne)),ne}function Lh(a){return a=a.current,a.child?(a.child.tag===5,a.child.stateNode):null}function Rh(a,l){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var g=a.retryLane;a.retryLane=g!==0&&g<l?g:l}}function Kc(a,l){Rh(a,l),(a=a.alternate)&&Rh(a,l)}function tc(){return null}var kf=typeof reportError=="function"?reportError:function(a){console.error(a)};function Nh(a){this._internalRoot=a}nc.prototype.render=Nh.prototype.render=function(a){var l=this._internalRoot;if(l===null)throw Error(S(409));ec(a,l,null,null)},nc.prototype.unmount=Nh.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var l=a.containerInfo;hl(function(){ec(null,a,null,null)}),l[ma]=null}};function nc(a){this._internalRoot=a}nc.prototype.unstable_scheduleHydration=function(a){if(a){var l=Yo();a={blockedOn:null,target:a,priority:l};for(var g=0;g<gs.length&&l!==0&&l<gs[g].priority;g++);gs.splice(g,0,a),g===0&&Xn(a)}};function zh(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function Tu(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function Sf(){}function _p(a,l,g,I,z){if(z){if(typeof I=="function"){var j=I;I=function(){var Je=Lh(ne);j.call(Je)}}var ne=Yc(l,I,a,0,null,!1,!1,"",Sf);return a._reactRootContainer=ne,a[ma]=ne.current,ho(a.nodeType===8?a.parentNode:a),hl(),ne}for(;z=a.lastChild;)a.removeChild(z);if(typeof I=="function"){var xe=I;I=function(){var Je=Lh(Pe);xe.call(Je)}}var Pe=Wc(a,0,!1,null,null,!1,!1,"",Sf);return a._reactRootContainer=Pe,a[ma]=Pe.current,ho(a.nodeType===8?a.parentNode:a),hl(function(){ec(l,Pe,g,I)}),Pe}function Dh(a,l,g,I,z){var j=g._reactRootContainer;if(j){var ne=j;if(typeof z=="function"){var xe=z;z=function(){var Pe=Lh(ne);xe.call(Pe)}}ec(l,ne,a,z)}else ne=_p(g,l,a,z,I);return Lh(ne)}Ao=function(a){switch(a.tag){case 3:var l=a.stateNode;if(l.current.memoizedState.isDehydrated){var g=Ls(l.pendingLanes);g!==0&&(ua(l,g|1),Ys(l,fn()),(ni&6)===0&&(Di=fn()+500,_()))}break;case 13:hl(function(){var I=is(a,1);if(I!==null){var z=Ts();xo(I,a,1,z)}}),Kc(a,1)}},Ya=function(a){if(a.tag===13){var l=is(a,134217728);if(l!==null){var g=Ts();xo(l,a,134217728,g)}Kc(a,134217728)}},Ka=function(a){if(a.tag===13){var l=Kl(a),g=is(a,l);if(g!==null){var I=Ts();xo(g,a,l,I)}Kc(a,l)}},Yo=function(){return qn},mi=function(a,l){var g=qn;try{return qn=a,l()}finally{qn=g}},Sr=function(a,l,g){switch(l){case"input":if(ds(a,g),l=g.name,g.type==="radio"&&l!=null){for(g=a;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll("input[name="+JSON.stringify(""+l)+'][type="radio"]'),l=0;l<g.length;l++){var I=g[l];if(I!==a&&I.form===a.form){var z=pu(I);if(!z)throw Error(S(90));we(I),ds(I,z)}}}break;case"textarea":vn(a,g);break;case"select":l=g.value,l!=null&&ps(a,!!g.multiple,l,!1)}},oe=Mh,ae=hl;var Ad={usingClientEntryPoint:!1,Events:[du,ga,pu,K,Y,Mh]},Jc={findFiberByHostInstance:mo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},vp={bundleType:Jc.bundleType,version:Jc.version,rendererPackageName:Jc.rendererPackageName,rendererConfig:Jc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:it.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=Hn(a),a===null?null:a.stateNode},findFiberByHostInstance:Jc.findFiberByHostInstance||tc,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Oh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Oh.isDisabled&&Oh.supportsFiber)try{Bi=Oh.inject(vp),sr=Oh}catch{}}return Za.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ad,Za.createPortal=function(a,l){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!zh(l))throw Error(S(200));return yp(a,l,null,g)},Za.createRoot=function(a,l){if(!zh(a))throw Error(S(299));var g=!1,I="",z=kf;return l!=null&&(l.unstable_strictMode===!0&&(g=!0),l.identifierPrefix!==void 0&&(I=l.identifierPrefix),l.onRecoverableError!==void 0&&(z=l.onRecoverableError)),l=Wc(a,1,!1,null,null,g,!1,I,z),a[ma]=l.current,ho(a.nodeType===8?a.parentNode:a),new Nh(l)},Za.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var l=a._reactInternals;if(l===void 0)throw typeof a.render=="function"?Error(S(188)):(a=Object.keys(a).join(","),Error(S(268,a)));return a=Hn(l),a=a===null?null:a.stateNode,a},Za.flushSync=function(a){return hl(a)},Za.hydrate=function(a,l,g){if(!Tu(l))throw Error(S(200));return Dh(null,a,l,!0,g)},Za.hydrateRoot=function(a,l,g){if(!zh(a))throw Error(S(405));var I=g!=null&&g.hydratedSources||null,z=!1,j="",ne=kf;if(g!=null&&(g.unstable_strictMode===!0&&(z=!0),g.identifierPrefix!==void 0&&(j=g.identifierPrefix),g.onRecoverableError!==void 0&&(ne=g.onRecoverableError)),l=Yc(l,null,a,1,g??null,z,!1,j,ne),a[ma]=l.current,ho(a),I)for(a=0;a<I.length;a++)g=I[a],z=g._getVersion,z=z(g._source),l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[g,z]:l.mutableSourceEagerHydrationData.push(g,z);return new nc(l)},Za.render=function(a,l,g){if(!Tu(l))throw Error(S(200));return Dh(null,a,l,!1,g)},Za.unmountComponentAtNode=function(a){if(!Tu(a))throw Error(S(40));return a._reactRootContainer?(hl(function(){Dh(null,null,a,!1,function(){a._reactRootContainer=null,a[ma]=null})}),!0):!1},Za.unstable_batchedUpdates=Mh,Za.unstable_renderSubtreeIntoContainer=function(a,l,g,I){if(!Tu(g))throw Error(S(200));if(a==null||a._reactInternals===void 0)throw Error(S(38));return Dh(a,l,g,!1,I)},Za.version="18.3.1-next-f1338f8080-20240426",Za}var Gm;function e_(){if(Gm)return Np.exports;Gm=1;function k(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(k)}catch(w){console.error(w)}}return k(),Np.exports=Qy(),Np.exports}var $m;function t_(){if($m)return Fd;$m=1;var k=e_();return Fd.createRoot=k.createRoot,Fd.hydrateRoot=k.hydrateRoot,Fd}var n_=t_();const i_=Uf(n_),r_={},Zm=k=>{let w;const S=new Set,E=(Q,F)=>{const q=typeof Q=="function"?Q(w):Q;if(!Object.is(q,w)){const se=w;w=F??(typeof q!="object"||q===null)?q:Object.assign({},w,q),S.forEach(le=>le(w,se))}},T=()=>w,W={setState:E,getState:T,getInitialState:()=>ee,subscribe:Q=>(S.add(Q),()=>S.delete(Q)),destroy:()=>{(r_?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),S.clear()}},ee=w=k(E,T,W);return W},s_=k=>k?Zm(k):Zm;var Op={exports:{}},Fp={},Bp={exports:{}},jp={};var Hm;function a_(){if(Hm)return jp;Hm=1;var k=qf();function w(F,q){return F===q&&(F!==0||1/F===1/q)||F!==F&&q!==q}var S=typeof Object.is=="function"?Object.is:w,E=k.useState,T=k.useEffect,N=k.useLayoutEffect,L=k.useDebugValue;function c(F,q){var se=q(),le=E({inst:{value:se,getSnapshot:q}}),fe=le[0].inst,Ie=le[1];return N(function(){fe.value=se,fe.getSnapshot=q,W(fe)&&Ie({inst:fe})},[F,se,q]),T(function(){return W(fe)&&Ie({inst:fe}),F(function(){W(fe)&&Ie({inst:fe})})},[F]),L(se),se}function W(F){var q=F.getSnapshot;F=F.value;try{var se=q();return!S(F,se)}catch{return!0}}function ee(F,q){return q()}var Q=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ee:c;return jp.useSyncExternalStore=k.useSyncExternalStore!==void 0?k.useSyncExternalStore:Q,jp}var Xm;function o_(){return Xm||(Xm=1,Bp.exports=a_()),Bp.exports}var Wm;function l_(){if(Wm)return Fp;Wm=1;var k=qf(),w=o_();function S(ee,Q){return ee===Q&&(ee!==0||1/ee===1/Q)||ee!==ee&&Q!==Q}var E=typeof Object.is=="function"?Object.is:S,T=w.useSyncExternalStore,N=k.useRef,L=k.useEffect,c=k.useMemo,W=k.useDebugValue;return Fp.useSyncExternalStoreWithSelector=function(ee,Q,F,q,se){var le=N(null);if(le.current===null){var fe={hasValue:!1,value:null};le.current=fe}else fe=le.current;le=c(function(){function Be(tt){if(!Ce){if(Ce=!0,Ge=tt,tt=q(tt),se!==void 0&&fe.hasValue){var at=fe.value;if(se(at,tt))return it=at}return it=tt}if(at=it,E(Ge,tt))return at;var ht=q(tt);return se!==void 0&&se(at,ht)?(Ge=tt,at):(Ge=tt,it=ht)}var Ce=!1,Ge,it,We=F===void 0?null:F;return[function(){return Be(Q())},We===null?void 0:function(){return Be(We())}]},[Q,F,q,se]);var Ie=T(ee,le[0],le[1]);return L(function(){fe.hasValue=!0,fe.value=Ie},[Ie]),W(Ie),Ie},Fp}var Ym;function u_(){return Ym||(Ym=1,Op.exports=l_()),Op.exports}var c_=u_();const h_=Uf(c_),Jg={},{useDebugValue:f_}=Kg,{useSyncExternalStoreWithSelector:d_}=h_;let Km=!1;const p_=k=>k;function m_(k,w=p_,S){(Jg?"production":void 0)!=="production"&&S&&!Km&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Km=!0);const E=d_(k.subscribe,k.getState,k.getServerState||k.getInitialState,w,S);return f_(E),E}const Jm=k=>{(Jg?"production":void 0)!=="production"&&typeof k!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const w=typeof k=="function"?s_(k):k,S=(E,T)=>m_(w,E,T);return Object.assign(S,w),S},g_=k=>k?Jm(k):Jm;var ra=63710088e-1,Qg={centimeters:ra*100,centimetres:ra*100,degrees:360/(2*Math.PI),feet:ra*3.28084,inches:ra*39.37,kilometers:ra/1e3,kilometres:ra/1e3,meters:ra,metres:ra,miles:ra/1609.344,millimeters:ra*1e3,millimetres:ra*1e3,nauticalmiles:ra/1852,radians:1,yards:ra*1.0936};function Gf(k,w,S={}){const E={type:"Feature"};return(S.id===0||S.id)&&(E.id=S.id),S.bbox&&(E.bbox=S.bbox),E.properties=w||{},E.geometry=k,E}function nh(k,w,S={}){if(!k)throw new Error("coordinates is required");if(!Array.isArray(k))throw new Error("coordinates must be an Array");if(k.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!tg(k[0])||!tg(k[1]))throw new Error("coordinates must contain numbers");return Gf({type:"Point",coordinates:k},w,S)}function dm(k,w,S={}){for(const T of k){if(T.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(T[T.length-1].length!==T[0].length)throw new Error("First and last Position are not equivalent.");for(let N=0;N<T[T.length-1].length;N++)if(T[T.length-1][N]!==T[0][N])throw new Error("First and last Position are not equivalent.")}return Gf({type:"Polygon",coordinates:k},w,S)}function Qm(k,w,S={}){if(k.length<2)throw new Error("coordinates must be an array of two or more positions");return Gf({type:"LineString",coordinates:k},w,S)}function Ff(k,w={}){const S={type:"FeatureCollection"};return w.id&&(S.id=w.id),w.bbox&&(S.bbox=w.bbox),S.features=k,S}function y_(k,w="kilometers"){const S=Qg[w];if(!S)throw new Error(w+" units is invalid");return k*S}function ey(k,w="kilometers"){const S=Qg[w];if(!S)throw new Error(w+" units is invalid");return k/S}function eg(k){return k%(2*Math.PI)*180/Math.PI}function Vp(k){return k%360*Math.PI/180}function tg(k){return!isNaN(k)&&k!==null&&!Array.isArray(k)}function ty(k){return k!==null&&typeof k=="object"&&!Array.isArray(k)}function pm(k){if(!k)throw new Error("coord is required");if(!Array.isArray(k)){if(k.type==="Feature"&&k.geometry!==null&&k.geometry.type==="Point")return[...k.geometry.coordinates];if(k.type==="Point")return[...k.coordinates]}if(Array.isArray(k)&&k.length>=2&&!Array.isArray(k[0])&&!Array.isArray(k[1]))return[...k];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Of(k){if(Array.isArray(k))return k;if(k.type==="Feature"){if(k.geometry!==null)return k.geometry.coordinates}else if(k.coordinates)return k.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function __(k,w,S){if(!k)throw new Error("No featureCollection passed");if(!k||k.type!=="FeatureCollection")throw new Error("Invalid input to "+S+", FeatureCollection required");for(const E of k.features){if(!E||E.type!=="Feature"||!E.geometry)throw new Error("Invalid input to "+S+", Feature with geometry required");if(!E.geometry||E.geometry.type!==w)throw new Error("Invalid input to "+S+": must be a "+w+", given "+E.geometry.type)}}function v_(k){return k.type==="Feature"?k.geometry:k}function x_(k,w){return k.type==="FeatureCollection"?"FeatureCollection":k.type==="GeometryCollection"?"GeometryCollection":k.type==="Feature"&&k.geometry!==null?k.geometry.type:k.type}function w_(k,w,S,E={}){const T=pm(k),N=Vp(T[0]),L=Vp(T[1]),c=Vp(S),W=ey(w,E.units),ee=Math.asin(Math.sin(L)*Math.cos(W)+Math.cos(L)*Math.sin(W)*Math.cos(c)),Q=N+Math.atan2(Math.sin(c)*Math.sin(W)*Math.cos(L),Math.cos(W)-Math.sin(L)*Math.sin(ee)),F=eg(Q),q=eg(ee);return T[2]!==void 0?nh([F,q,T[2]],E.properties):nh([F,q],E.properties)}function ny(k,w,S){if(k!==null)for(var E,T,N,L,c,W,ee,Q=0,F=0,q,se=k.type,le=se==="FeatureCollection",fe=se==="Feature",Ie=le?k.features.length:1,Be=0;Be<Ie;Be++){ee=le?k.features[Be].geometry:fe?k.geometry:k,q=ee?ee.type==="GeometryCollection":!1,c=q?ee.geometries.length:1;for(var Ce=0;Ce<c;Ce++){var Ge=0,it=0;if(L=q?ee.geometries[Ce]:ee,L!==null){W=L.coordinates;var We=L.type;switch(Q=0,We){case null:break;case"Point":if(w(W,F,Be,Ge,it)===!1)return!1;F++,Ge++;break;case"LineString":case"MultiPoint":for(E=0;E<W.length;E++){if(w(W[E],F,Be,Ge,it)===!1)return!1;F++,We==="MultiPoint"&&Ge++}We==="LineString"&&Ge++;break;case"Polygon":case"MultiLineString":for(E=0;E<W.length;E++){for(T=0;T<W[E].length-Q;T++){if(w(W[E][T],F,Be,Ge,it)===!1)return!1;F++}We==="MultiLineString"&&Ge++,We==="Polygon"&&it++}We==="Polygon"&&Ge++;break;case"MultiPolygon":for(E=0;E<W.length;E++){for(it=0,T=0;T<W[E].length;T++){for(N=0;N<W[E][T].length-Q;N++){if(w(W[E][T][N],F,Be,Ge,it)===!1)return!1;F++}it++}Ge++}break;case"GeometryCollection":for(E=0;E<L.geometries.length;E++)if(ny(L.geometries[E],w)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ng(k,w){if(k.type==="Feature")w(k,0);else if(k.type==="FeatureCollection")for(var S=0;S<k.features.length&&w(k.features[S],S)!==!1;S++);}function ap(k,w){var S,E,T,N,L,c,W,ee,Q,F,q=0,se=k.type==="FeatureCollection",le=k.type==="Feature",fe=se?k.features.length:1;for(S=0;S<fe;S++){for(c=se?k.features[S].geometry:le?k.geometry:k,ee=se?k.features[S].properties:le?k.properties:{},Q=se?k.features[S].bbox:le?k.bbox:void 0,F=se?k.features[S].id:le?k.id:void 0,W=c?c.type==="GeometryCollection":!1,L=W?c.geometries.length:1,T=0;T<L;T++){if(N=W?c.geometries[T]:c,N===null){if(w(null,q,ee,Q,F)===!1)return!1;continue}switch(N.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(w(N,q,ee,Q,F)===!1)return!1;break}case"GeometryCollection":{for(E=0;E<N.geometries.length;E++)if(w(N.geometries[E],q,ee,Q,F)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}q++}}function b_(k,w,S){var E=S;return ap(k,function(T,N,L,c,W){E=w(E,T,N,L,c,W)}),E}function ig(k){return b_(k,(w,S)=>w+k_(S),0)}function k_(k){let w=0,S;switch(k.type){case"Polygon":return rg(k.coordinates);case"MultiPolygon":for(S=0;S<k.coordinates.length;S++)w+=rg(k.coordinates[S]);return w;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function rg(k){let w=0;if(k&&k.length>0){w+=Math.abs(sg(k[0]));for(let S=1;S<k.length;S++)w-=Math.abs(sg(k[S]))}return w}var S_=ra*ra/2,Up=Math.PI/180;function sg(k){const w=k.length-1;if(w<=2)return 0;let S=0,E=0;for(;E<w;){const T=k[E],N=k[E+1===w?0:E+1],L=k[E+2>=w?(E+2)%w:E+2],c=T[0]*Up,W=N[1]*Up,ee=L[0]*Up;S+=(ee-c)*Math.sin(W),E++}return S*S_}function oc(k,w={}){if(k.bbox!=null&&w.recompute!==!0)return k.bbox;const S=[1/0,1/0,-1/0,-1/0];return ny(k,E=>{S[0]>E[0]&&(S[0]=E[0]),S[1]>E[1]&&(S[1]=E[1]),S[2]<E[0]&&(S[2]=E[0]),S[3]<E[1]&&(S[3]=E[1])}),S}function iy(k,w={}){const S=Number(k[0]),E=Number(k[1]),T=Number(k[2]),N=Number(k[3]);if(k.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const L=[S,E];return dm([[L,[T,E],[T,N],[S,N],L]],w.properties,{bbox:k,id:w.id})}const Mu=11102230246251565e-32,na=134217729,E_=(3+8*Mu)*Mu;function qp(k,w,S,E,T){let N,L,c,W,ee=w[0],Q=E[0],F=0,q=0;Q>ee==Q>-ee?(N=ee,ee=w[++F]):(N=Q,Q=E[++q]);let se=0;if(F<k&&q<S)for(Q>ee==Q>-ee?(L=ee+N,c=N-(L-ee),ee=w[++F]):(L=Q+N,c=N-(L-Q),Q=E[++q]),N=L,c!==0&&(T[se++]=c);F<k&&q<S;)Q>ee==Q>-ee?(L=N+ee,W=L-N,c=N-(L-W)+(ee-W),ee=w[++F]):(L=N+Q,W=L-N,c=N-(L-W)+(Q-W),Q=E[++q]),N=L,c!==0&&(T[se++]=c);for(;F<k;)L=N+ee,W=L-N,c=N-(L-W)+(ee-W),ee=w[++F],N=L,c!==0&&(T[se++]=c);for(;q<S;)L=N+Q,W=L-N,c=N-(L-W)+(Q-W),Q=E[++q],N=L,c!==0&&(T[se++]=c);return(N!==0||se===0)&&(T[se++]=N),se}function I_(k,w){let S=w[0];for(let E=1;E<k;E++)S+=w[E];return S}function $f(k){return new Float64Array(k)}const T_=(3+16*Mu)*Mu,C_=(2+12*Mu)*Mu,P_=(9+64*Mu)*Mu*Mu,Vh=$f(4),ag=$f(8),og=$f(12),lg=$f(16),Ca=$f(4);function M_(k,w,S,E,T,N,L){let c,W,ee,Q,F,q,se,le,fe,Ie,Be,Ce,Ge,it,We,tt,at,ht;const ft=k-T,$t=S-T,wt=w-N,Zt=E-N;it=ft*Zt,q=na*ft,se=q-(q-ft),le=ft-se,q=na*Zt,fe=q-(q-Zt),Ie=Zt-fe,We=le*Ie-(it-se*fe-le*fe-se*Ie),tt=wt*$t,q=na*wt,se=q-(q-wt),le=wt-se,q=na*$t,fe=q-(q-$t),Ie=$t-fe,at=le*Ie-(tt-se*fe-le*fe-se*Ie),Be=We-at,F=We-Be,Vh[0]=We-(Be+F)+(F-at),Ce=it+Be,F=Ce-it,Ge=it-(Ce-F)+(Be-F),Be=Ge-tt,F=Ge-Be,Vh[1]=Ge-(Be+F)+(F-tt),ht=Ce+Be,F=ht-Ce,Vh[2]=Ce-(ht-F)+(Be-F),Vh[3]=ht;let Bt=I_(4,Vh),je=C_*L;if(Bt>=je||-Bt>=je||(F=k-ft,c=k-(ft+F)+(F-T),F=S-$t,ee=S-($t+F)+(F-T),F=w-wt,W=w-(wt+F)+(F-N),F=E-Zt,Q=E-(Zt+F)+(F-N),c===0&&W===0&&ee===0&&Q===0)||(je=P_*L+E_*Math.abs(Bt),Bt+=ft*Q+Zt*c-(wt*ee+$t*W),Bt>=je||-Bt>=je))return Bt;it=c*Zt,q=na*c,se=q-(q-c),le=c-se,q=na*Zt,fe=q-(q-Zt),Ie=Zt-fe,We=le*Ie-(it-se*fe-le*fe-se*Ie),tt=W*$t,q=na*W,se=q-(q-W),le=W-se,q=na*$t,fe=q-(q-$t),Ie=$t-fe,at=le*Ie-(tt-se*fe-le*fe-se*Ie),Be=We-at,F=We-Be,Ca[0]=We-(Be+F)+(F-at),Ce=it+Be,F=Ce-it,Ge=it-(Ce-F)+(Be-F),Be=Ge-tt,F=Ge-Be,Ca[1]=Ge-(Be+F)+(F-tt),ht=Ce+Be,F=ht-Ce,Ca[2]=Ce-(ht-F)+(Be-F),Ca[3]=ht;const zt=qp(4,Vh,4,Ca,ag);it=ft*Q,q=na*ft,se=q-(q-ft),le=ft-se,q=na*Q,fe=q-(q-Q),Ie=Q-fe,We=le*Ie-(it-se*fe-le*fe-se*Ie),tt=wt*ee,q=na*wt,se=q-(q-wt),le=wt-se,q=na*ee,fe=q-(q-ee),Ie=ee-fe,at=le*Ie-(tt-se*fe-le*fe-se*Ie),Be=We-at,F=We-Be,Ca[0]=We-(Be+F)+(F-at),Ce=it+Be,F=Ce-it,Ge=it-(Ce-F)+(Be-F),Be=Ge-tt,F=Ge-Be,Ca[1]=Ge-(Be+F)+(F-tt),ht=Ce+Be,F=ht-Ce,Ca[2]=Ce-(ht-F)+(Be-F),Ca[3]=ht;const an=qp(zt,ag,4,Ca,og);it=c*Q,q=na*c,se=q-(q-c),le=c-se,q=na*Q,fe=q-(q-Q),Ie=Q-fe,We=le*Ie-(it-se*fe-le*fe-se*Ie),tt=W*ee,q=na*W,se=q-(q-W),le=W-se,q=na*ee,fe=q-(q-ee),Ie=ee-fe,at=le*Ie-(tt-se*fe-le*fe-se*Ie),Be=We-at,F=We-Be,Ca[0]=We-(Be+F)+(F-at),Ce=it+Be,F=Ce-it,Ge=it-(Ce-F)+(Be-F),Be=Ge-tt,F=Ge-Be,Ca[1]=Ge-(Be+F)+(F-tt),ht=Ce+Be,F=ht-Ce,Ca[2]=Ce-(ht-F)+(Be-F),Ca[3]=ht;const rn=qp(an,og,4,Ca,lg);return lg[rn-1]}function A_(k,w,S,E,T,N){const L=(w-N)*(S-T),c=(k-T)*(E-N),W=L-c,ee=Math.abs(L+c);return Math.abs(W)>=T_*ee?W:-M_(k,w,S,E,T,N,ee)}function L_(k,w){var S,E,T=0,N,L,c,W,ee,Q,F,q=k[0],se=k[1],le=w.length;for(S=0;S<le;S++){E=0;var fe=w[S],Ie=fe.length-1;if(Q=fe[0],Q[0]!==fe[Ie][0]&&Q[1]!==fe[Ie][1])throw new Error("First and last coordinates in a ring must be the same");for(L=Q[0]-q,c=Q[1]-se,E;E<Ie;E++){if(F=fe[E+1],W=F[0]-q,ee=F[1]-se,c===0&&ee===0){if(W<=0&&L>=0||L<=0&&W>=0)return 0}else if(ee>=0&&c<=0||ee<=0&&c>=0){if(N=A_(L,W,c,ee,0,0),N===0)return 0;(N>0&&ee>0&&c<=0||N<0&&ee<=0&&c>0)&&T++}Q=F,c=ee,L=W}}return T%2!==0}function Wd(k,w,S={}){if(!k)throw new Error("point is required");if(!w)throw new Error("polygon is required");const E=pm(k),T=v_(w),N=T.type,L=w.bbox;let c=T.coordinates;if(L&&R_(E,L)===!1)return!1;N==="Polygon"&&(c=[c]);let W=!1;for(var ee=0;ee<c.length;++ee){const Q=L_(E,c[ee]);if(Q===0)return!S.ignoreBoundary;Q&&(W=!0)}return W}function R_(k,w){return w[0]<=k[0]&&w[1]<=k[1]&&w[2]>=k[0]&&w[3]>=k[1]}function ug(k,w,S={}){const E=pm(k),T=Of(w);for(let N=0;N<T.length-1;N++){let L=!1;if(S.ignoreEndVertices&&(N===0&&(L="start"),N===T.length-2&&(L="end"),N===0&&N+1===T.length-1&&(L="both")),N_(T[N],T[N+1],E,L,typeof S.epsilon>"u"?null:S.epsilon))return!0}return!1}function N_(k,w,S,E,T){const N=S[0],L=S[1],c=k[0],W=k[1],ee=w[0],Q=w[1],F=S[0]-c,q=S[1]-W,se=ee-c,le=Q-W,fe=F*le-q*se;if(T!==null){if(Math.abs(fe)>T)return!1}else if(fe!==0)return!1;if(Math.abs(se)===Math.abs(le)&&Math.abs(se)===0)return E?!1:S[0]===k[0]&&S[1]===k[1];if(E){if(E==="start")return Math.abs(se)>=Math.abs(le)?se>0?c<N&&N<=ee:ee<=N&&N<c:le>0?W<L&&L<=Q:Q<=L&&L<W;if(E==="end")return Math.abs(se)>=Math.abs(le)?se>0?c<=N&&N<ee:ee<N&&N<=c:le>0?W<=L&&L<Q:Q<L&&L<=W;if(E==="both")return Math.abs(se)>=Math.abs(le)?se>0?c<N&&N<ee:ee<N&&N<c:le>0?W<L&&L<Q:Q<L&&L<W}else return Math.abs(se)>=Math.abs(le)?se>0?c<=N&&N<=ee:ee<=N&&N<=c:le>0?W<=L&&L<=Q:Q<=L&&L<=W;return!1}function z_(k,w={}){var S=typeof w=="object"?w.mutate:w;if(!k)throw new Error("geojson is required");var E=x_(k),T=[];switch(E){case"LineString":T=Gp(k,E);break;case"MultiLineString":case"Polygon":Of(k).forEach(function(L){T.push(Gp(L,E))});break;case"MultiPolygon":Of(k).forEach(function(L){var c=[];L.forEach(function(W){c.push(Gp(W,E))}),T.push(c)});break;case"Point":return k;case"MultiPoint":var N={};Of(k).forEach(function(L){var c=L.join("-");Object.prototype.hasOwnProperty.call(N,c)||(T.push(L),N[c]=!0)});break;default:throw new Error(E+" geometry not supported")}return k.coordinates?S===!0?(k.coordinates=T,k):{type:E,coordinates:T}:S===!0?(k.geometry.coordinates=T,k):Gf({type:E,coordinates:T},k.properties,{bbox:k.bbox,id:k.id})}function Gp(k,w){const S=Of(k);if(S.length===2&&!cg(S[0],S[1]))return S;const E=[];let T=0,N=1,L=2;for(E.push(S[T]);L<S.length;)ug(S[N],Qm([S[T],S[L]]))?N=L:(E.push(S[N]),T=N,N++,L=N),L++;if(E.push(S[N]),w==="Polygon"||w==="MultiPolygon"){if(ug(E[0],Qm([E[1],E[E.length-2]]))&&(E.shift(),E.pop(),E.push(E[0])),E.length<4)throw new Error("invalid polygon, fewer than 4 points");if(!cg(E[0],E[E.length-1]))throw new Error("invalid polygon, first and last points not equal")}return E}function cg(k,w){return k[0]===w[0]&&k[1]===w[1]}function D_(k,w={}){const S=oc(k),E=(S[0]+S[2])/2,T=(S[1]+S[3])/2;return nh([E,T],w.properties,w)}var Gd={exports:{}},O_=Gd.exports,hg;function F_(){return hg||(hg=1,(function(k,w){(function(S,E){k.exports=E()})(O_,(function(){function S(f,i){(i==null||i>f.length)&&(i=f.length);for(var s=0,h=Array(i);s<i;s++)h[s]=f[s];return h}function E(f,i,s){return i=Q(i),(function(h,b){if(b&&(typeof b=="object"||typeof b=="function"))return b;if(b!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(R){if(R===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R})(h)})(f,q()?Reflect.construct(i,s||[],Q(f).constructor):i.apply(f,s))}function T(f,i){if(!(f instanceof i))throw new TypeError("Cannot call a class as a function")}function N(f,i,s){if(q())return Reflect.construct.apply(null,arguments);var h=[null];h.push.apply(h,i);var b=new(f.bind.apply(f,h));return s&&se(b,s.prototype),b}function L(f,i){for(var s=0;s<i.length;s++){var h=i[s];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(f,Ie(h.key),h)}}function c(f,i,s){return i&&L(f.prototype,i),s&&L(f,s),Object.defineProperty(f,"prototype",{writable:!1}),f}function W(f,i){var s=typeof Symbol<"u"&&f[Symbol.iterator]||f["@@iterator"];if(!s){if(Array.isArray(f)||(s=Be(f))||i){s&&(f=s);var h=0,b=function(){};return{s:b,n:function(){return h>=f.length?{done:!0}:{done:!1,value:f[h++]}},e:function(re){throw re},f:b}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var R,B=!0,H=!1;return{s:function(){s=s.call(f)},n:function(){var re=s.next();return B=re.done,re},e:function(re){H=!0,R=re},f:function(){try{B||s.return==null||s.return()}finally{if(H)throw R}}}}function ee(){return ee=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(f,i,s){var h=(function(R,B){for(;!{}.hasOwnProperty.call(R,B)&&(R=Q(R))!==null;);return R})(f,i);if(h){var b=Object.getOwnPropertyDescriptor(h,i);return b.get?b.get.call(arguments.length<3?f:s):b.value}},ee.apply(null,arguments)}function Q(f){return Q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Q(f)}function F(f,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");f.prototype=Object.create(i&&i.prototype,{constructor:{value:f,writable:!0,configurable:!0}}),Object.defineProperty(f,"prototype",{writable:!1}),i&&se(f,i)}function q(){try{var f=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(q=function(){return!!f})()}function se(f,i){return se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},se(f,i)}function le(f,i,s,h){var b=ee(Q(1&h?f.prototype:f),i,s);return 2&h&&typeof b=="function"?function(R){return b.apply(s,R)}:b}function fe(f){return(function(i){if(Array.isArray(i))return S(i)})(f)||(function(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)})(f)||Be(f)||(function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function Ie(f){var i=(function(s,h){if(typeof s!="object"||!s)return s;var b=s[Symbol.toPrimitive];if(b!==void 0){var R=b.call(s,h);if(typeof R!="object")return R;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(f,"string");return typeof i=="symbol"?i:i+""}function Be(f,i){if(f){if(typeof f=="string")return S(f,i);var s={}.toString.call(f).slice(8,-1);return s==="Object"&&f.constructor&&(s=f.constructor.name),s==="Map"||s==="Set"?Array.from(f):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?S(f,i):void 0}}function Ce(f){var i=typeof Map=="function"?new Map:void 0;return Ce=function(s){if(s===null||!(function(b){try{return Function.toString.call(b).indexOf("[native code]")!==-1}catch{return typeof b=="function"}})(s))return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(i!==void 0){if(i.has(s))return i.get(s);i.set(s,h)}function h(){return N(s,arguments,Q(this).constructor)}return h.prototype=Object.create(s.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),se(h,s)},Ce(f)}var Ge=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(i){this._quadrantSegments=i,this._quadrantSegments===0&&(this._joinStyle=f.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=f.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),i<=0&&(this._quadrantSegments=1),this._joinStyle!==f.JOIN_ROUND&&(this._quadrantSegments=f.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(i){this._joinStyle=i}},{key:"setSimplifyFactor",value:function(i){this._simplifyFactor=i<0?0:i}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(i){this._endCapStyle=i}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(i){this._mitreLimit=i}},{key:"setSingleSided",value:function(i){this._isSingleSided=i}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=f.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=f.CAP_ROUND,this._joinStyle=f.JOIN_ROUND,this._mitreLimit=f.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=f.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var i=arguments[0];this.setQuadrantSegments(i)}else if(arguments.length===2){var s=arguments[0],h=arguments[1];this.setQuadrantSegments(s),this.setEndCapStyle(h)}else if(arguments.length===4){var b=arguments[0],R=arguments[1],B=arguments[2],H=arguments[3];this.setQuadrantSegments(b),this.setEndCapStyle(R),this.setJoinStyle(B),this.setMitreLimit(H)}}}},{key:"bufferDistanceError",value:function(i){var s=Math.PI/2/i;return 1-Math.cos(s/2)}}])})();Ge.CAP_ROUND=1,Ge.CAP_FLAT=2,Ge.CAP_SQUARE=3,Ge.JOIN_ROUND=1,Ge.JOIN_MITRE=2,Ge.JOIN_BEVEL=3,Ge.DEFAULT_QUADRANT_SEGMENTS=8,Ge.DEFAULT_MITRE_LIMIT=5,Ge.DEFAULT_SIMPLIFY_FACTOR=.01;var it=(function(f){function i(s){var h;return T(this,i),(h=E(this,i,[s])).name=Object.keys({Exception:i})[0],h}return F(i,f),c(i,[{key:"toString",value:function(){return this.message}}])})(Ce(Error)),We=(function(f){function i(s){var h;return T(this,i),(h=E(this,i,[s])).name=Object.keys({IllegalArgumentException:i})[0],h}return F(i,f),c(i)})(it),tt=(function(){return c((function f(){T(this,f)}),[{key:"filter",value:function(f){}}])})();function at(){}function ht(){}function ft(){}var $t,wt,Zt,Bt,je,zt,an,rn,bt=(function(){return c((function f(){T(this,f)}),null,[{key:"equalsWithTolerance",value:function(f,i,s){return Math.abs(f-i)<=s}}])})(),jt=(function(){return c((function f(i,s){T(this,f),this.low=s||0,this.high=i||0}),null,[{key:"toBinaryString",value:function(f){var i,s="";for(i=2147483648;i>0;i>>>=1)s+=(f.high&i)===i?"1":"0";for(i=2147483648;i>0;i>>>=1)s+=(f.low&i)===i?"1":"0";return s}}])})();function nt(){}function Re(){}nt.NaN=NaN,nt.isNaN=function(f){return Number.isNaN(f)},nt.isInfinite=function(f){return!Number.isFinite(f)},nt.MAX_VALUE=Number.MAX_VALUE,nt.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,nt.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(zt=2146435072,an=new Float64Array(1),rn=new Int32Array(an.buffer),nt.doubleToLongBits=function(f){an[0]=f;var i=0|rn[0],s=0|rn[1];return(s&zt)===zt&&1048575&s&&i!==0&&(i=0,s=2146959360),new jt(s,i)},nt.longBitsToDouble=function(f){return rn[0]=f.low,rn[1]=f.high,an[0]}):($t=1023,wt=Math.log2,Zt=Math.floor,Bt=Math.pow,je=(function(){for(var f=53;f>0;f--){var i=Bt(2,f)-1;if(Zt(wt(i))+1===f)return i}return 0})(),nt.doubleToLongBits=function(f){var i,s,h,b,R,B,H,re,de;if(f<0||1/f===Number.NEGATIVE_INFINITY?(B=1<<31,f=-f):B=0,f===0)return new jt(re=B,de=0);if(f===1/0)return new jt(re=2146435072|B,de=0);if(f!=f)return new jt(re=2146959360,de=0);if(b=0,de=0,(i=Zt(f))>1)if(i<=je)(b=Zt(wt(i)))<=20?(de=0,re=i<<20-b&1048575):(de=i%(s=Bt(2,h=b-20))<<32-h,re=i/s&1048575);else for(h=i,de=0;(h=Zt(s=h/2))!==0;)b++,de>>>=1,de|=(1&re)<<31,re>>>=1,s!==h&&(re|=524288);if(H=b+$t,R=i===0,i=f-i,b<52&&i!==0)for(h=0;;){if((s=2*i)>=1?(i=s-1,R?(H--,R=!1):(h<<=1,h|=1,b++)):(i=s,R?--H==0&&(b++,R=!1):(h<<=1,b++)),b===20)re|=h,h=0;else if(b===52){de|=h;break}if(s===1){b<20?re|=h<<20-b:b<52&&(de|=h<<52-b);break}}return re|=H<<20,new jt(re|=B,de)},nt.longBitsToDouble=function(f){var i,s,h,b,R=f.high,B=f.low,H=R&1<<31?-1:1;for(h=((2146435072&R)>>20)-$t,b=0,s=1<<19,i=1;i<=20;i++)R&s&&(b+=Bt(2,-i)),s>>>=1;for(s=1<<31,i=21;i<=52;i++)B&s&&(b+=Bt(2,-i)),s>>>=1;if(h===-1023){if(b===0)return 0*H;h=-1022}else{if(h===1024)return b===0?H/0:NaN;b+=1}return H*b*Bt(2,h)});var rt=(function(f){function i(s){var h;return T(this,i),(h=E(this,i,[s])).name=Object.keys({RuntimeException:i})[0],h}return F(i,f),c(i)})(it),on=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,null,[{key:"constructor_",value:function(){if(arguments.length===0)rt.constructor_.call(this);else if(arguments.length===1){var s=arguments[0];rt.constructor_.call(this,s)}}}])})(rt),Pt=(function(){function f(){T(this,f)}return c(f,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)f.shouldNeverReachHere(null);else if(arguments.length===1){var i=arguments[0];throw new on("Should never reach here"+(i!==null?": "+i:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var i=arguments[0];f.isTrue(i,null)}else if(arguments.length===2){var s=arguments[1];if(!arguments[0])throw s===null?new on:new on(s)}}},{key:"equals",value:function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];f.equals(i,s,null)}else if(arguments.length===3){var h=arguments[0],b=arguments[1],R=arguments[2];if(!b.equals(h))throw new on("Expected "+h+" but encountered "+b+(R!==null?": "+R:""))}}}])})(),yn=new ArrayBuffer(8),Dn=new Float64Array(yn),Rn=new Int32Array(yn),Ne=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"getM",value:function(){return nt.NaN}},{key:"setOrdinate",value:function(i,s){switch(i){case f.X:this.x=s;break;case f.Y:this.y=s;break;case f.Z:this.setZ(s);break;default:throw new We("Invalid ordinate index: "+i)}}},{key:"equals2D",value:function(){if(arguments.length===1){var i=arguments[0];return this.x===i.x&&this.y===i.y}if(arguments.length===2){var s=arguments[0],h=arguments[1];return!!bt.equalsWithTolerance(this.x,s.x,h)&&!!bt.equalsWithTolerance(this.y,s.y,h)}}},{key:"setM",value:function(i){throw new We("Invalid ordinate index: "+f.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(i){switch(i){case f.X:return this.x;case f.Y:return this.y;case f.Z:return this.getZ()}throw new We("Invalid ordinate index: "+i)}},{key:"equals3D",value:function(i){return this.x===i.x&&this.y===i.y&&(this.getZ()===i.getZ()||nt.isNaN(this.getZ())&&nt.isNaN(i.getZ()))}},{key:"equals",value:function(i){return i instanceof f&&this.equals2D(i)}},{key:"equalInZ",value:function(i,s){return bt.equalsWithTolerance(this.getZ(),i.getZ(),s)}},{key:"setX",value:function(i){this.x=i}},{key:"compareTo",value:function(i){var s=i;return this.x<s.x?-1:this.x>s.x?1:this.y<s.y?-1:this.y>s.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(i){this.z=i}},{key:"clone",value:function(){try{return null}catch(i){if(i instanceof CloneNotSupportedException)return Pt.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw i}}},{key:"copy",value:function(){return new f(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(i){var s=this.x-i.x,h=this.y-i.y,b=this.getZ()-i.getZ();return Math.sqrt(s*s+h*h+b*b)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(i){this.y=i}},{key:"distance",value:function(i){var s=this.x-i.x,h=this.y-i.y;return Math.sqrt(s*s+h*h)}},{key:"hashCode",value:function(){var i=17;return i=37*(i=37*i+f.hashCode(this.x))+f.hashCode(this.y)}},{key:"setCoordinate",value:function(i){this.x=i.x,this.y=i.y,this.z=i.getZ()}},{key:"interfaces_",get:function(){return[at,ht,ft]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)f.constructor_.call(this,0,0);else if(arguments.length===1){var i=arguments[0];f.constructor_.call(this,i.x,i.y,i.getZ())}else if(arguments.length===2){var s=arguments[0],h=arguments[1];f.constructor_.call(this,s,h,f.NULL_ORDINATE)}else if(arguments.length===3){var b=arguments[0],R=arguments[1],B=arguments[2];this.x=b,this.y=R,this.z=B}}},{key:"hashCode",value:function(i){return Dn[0]=i,Rn[0]^Rn[1]}}])})(),ei=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"compare",value:function(i,s){var h=f.compare(i.x,s.x);if(h!==0)return h;var b=f.compare(i.y,s.y);return b!==0?b:this._dimensionsToTest<=2?0:f.compare(i.getZ(),s.getZ())}},{key:"interfaces_",get:function(){return[Re]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)f.constructor_.call(this,2);else if(arguments.length===1){var i=arguments[0];if(i!==2&&i!==3)throw new We("only 2 or 3 dimensions may be specified");this._dimensionsToTest=i}}},{key:"compare",value:function(i,s){return i<s?-1:i>s?1:nt.isNaN(i)?nt.isNaN(s)?0:-1:nt.isNaN(s)?1:0}}])})();Ne.DimensionalComparator=ei,Ne.NULL_ORDINATE=nt.NaN,Ne.X=0,Ne.Y=1,Ne.Z=2,Ne.M=3;var Cn=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(i){if(!(i instanceof f))return!1;var s=i;return this.isNull()?s.isNull():this._maxx===s.getMaxX()&&this._maxy===s.getMaxY()&&this._minx===s.getMinX()&&this._miny===s.getMinY()}},{key:"intersection",value:function(i){if(this.isNull()||i.isNull()||!this.intersects(i))return new f;var s=this._minx>i._minx?this._minx:i._minx,h=this._miny>i._miny?this._miny:i._miny;return new f(s,this._maxx<i._maxx?this._maxx:i._maxx,h,this._maxy<i._maxy?this._maxy:i._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof Ne){var i=arguments[0];return this.covers(i.x,i.y)}if(arguments[0]instanceof f){var s=arguments[0];return!this.isNull()&&!s.isNull()&&s.getMinX()>=this._minx&&s.getMaxX()<=this._maxx&&s.getMinY()>=this._miny&&s.getMaxY()<=this._maxy}}else if(arguments.length===2){var h=arguments[0],b=arguments[1];return!this.isNull()&&h>=this._minx&&h<=this._maxx&&b>=this._miny&&b<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof f){var i=arguments[0];return!this.isNull()&&!i.isNull()&&!(i._minx>this._maxx||i._maxx<this._minx||i._miny>this._maxy||i._maxy<this._miny)}if(arguments[0]instanceof Ne){var s=arguments[0];return this.intersects(s.x,s.y)}}else if(arguments.length===2){if(arguments[0]instanceof Ne&&arguments[1]instanceof Ne){var h=arguments[0],b=arguments[1];return!this.isNull()&&!((h.x<b.x?h.x:b.x)>this._maxx)&&!((h.x>b.x?h.x:b.x)<this._minx)&&!((h.y<b.y?h.y:b.y)>this._maxy)&&!((h.y>b.y?h.y:b.y)<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var R=arguments[0],B=arguments[1];return!this.isNull()&&!(R>this._maxx||R<this._minx||B>this._maxy||B<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var i=this.getWidth(),s=this.getHeight();return Math.sqrt(i*i+s*s)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof Ne){var i=arguments[0];this.expandToInclude(i.x,i.y)}else if(arguments[0]instanceof f){var s=arguments[0];if(s.isNull())return null;this.isNull()?(this._minx=s.getMinX(),this._maxx=s.getMaxX(),this._miny=s.getMinY(),this._maxy=s.getMaxY()):(s._minx<this._minx&&(this._minx=s._minx),s._maxx>this._maxx&&(this._maxx=s._maxx),s._miny<this._miny&&(this._miny=s._miny),s._maxy>this._maxy&&(this._maxy=s._maxy))}}else if(arguments.length===2){var h=arguments[0],b=arguments[1];this.isNull()?(this._minx=h,this._maxx=h,this._miny=b,this._maxy=b):(h<this._minx&&(this._minx=h),h>this._maxx&&(this._maxx=h),b<this._miny&&(this._miny=b),b>this._maxy&&(this._maxy=b))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var i=this.getWidth(),s=this.getHeight();return i<s?i:s}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(i){var s=i;return this.isNull()?s.isNull()?0:-1:s.isNull()?1:this._minx<s._minx?-1:this._minx>s._minx?1:this._miny<s._miny?-1:this._miny>s._miny?1:this._maxx<s._maxx?-1:this._maxx>s._maxx?1:this._maxy<s._maxy?-1:this._maxy>s._maxy?1:0}},{key:"translate",value:function(i,s){if(this.isNull())return null;this.init(this.getMinX()+i,this.getMaxX()+i,this.getMinY()+s,this.getMaxY()+s)}},{key:"copy",value:function(){return new f(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(i){return!(!this.isNull()&&!i.isNull())||i._minx>this._maxx||i._maxx<this._minx||i._miny>this._maxy||i._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var i=this.getWidth(),s=this.getHeight();return i>s?i:s}},{key:"expandBy",value:function(){if(arguments.length===1){var i=arguments[0];this.expandBy(i,i)}else if(arguments.length===2){var s=arguments[0],h=arguments[1];if(this.isNull())return null;this._minx-=s,this._maxx+=s,this._miny-=h,this._maxy+=h,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof f){var i=arguments[0];return this.covers(i)}if(arguments[0]instanceof Ne){var s=arguments[0];return this.covers(s)}}else if(arguments.length===2){var h=arguments[0],b=arguments[1];return this.covers(h,b)}}},{key:"centre",value:function(){return this.isNull()?null:new Ne((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Ne){var i=arguments[0];this.init(i.x,i.x,i.y,i.y)}else if(arguments[0]instanceof f){var s=arguments[0];this._minx=s._minx,this._maxx=s._maxx,this._miny=s._miny,this._maxy=s._maxy}}else if(arguments.length===2){var h=arguments[0],b=arguments[1];this.init(h.x,b.x,h.y,b.y)}else if(arguments.length===4){var R=arguments[0],B=arguments[1],H=arguments[2],re=arguments[3];R<B?(this._minx=R,this._maxx=B):(this._minx=B,this._maxx=R),H<re?(this._miny=H,this._maxy=re):(this._miny=re,this._maxy=H)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(i){if(this.intersects(i))return 0;var s=0;this._maxx<i._minx?s=i._minx-this._maxx:this._minx>i._maxx&&(s=this._minx-i._maxx);var h=0;return this._maxy<i._miny?h=i._miny-this._maxy:this._miny>i._maxy&&(h=this._miny-i._maxy),s===0?h:h===0?s:Math.sqrt(s*s+h*h)}},{key:"hashCode",value:function(){var i=17;return i=37*(i=37*(i=37*(i=37*i+Ne.hashCode(this._minx))+Ne.hashCode(this._maxx))+Ne.hashCode(this._miny))+Ne.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[at,ft]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Ne){var i=arguments[0];this.init(i.x,i.x,i.y,i.y)}else if(arguments[0]instanceof f){var s=arguments[0];this.init(s)}}else if(arguments.length===2){var h=arguments[0],b=arguments[1];this.init(h.x,b.x,h.y,b.y)}else if(arguments.length===4){var R=arguments[0],B=arguments[1],H=arguments[2],re=arguments[3];this.init(R,B,H,re)}}},{key:"intersects",value:function(){if(arguments.length===3){var i=arguments[0],s=arguments[1],h=arguments[2];return h.x>=(i.x<s.x?i.x:s.x)&&h.x<=(i.x>s.x?i.x:s.x)&&h.y>=(i.y<s.y?i.y:s.y)&&h.y<=(i.y>s.y?i.y:s.y)}if(arguments.length===4){var b=arguments[0],R=arguments[1],B=arguments[2],H=arguments[3],re=Math.min(B.x,H.x),de=Math.max(B.x,H.x),De=Math.min(b.x,R.x),$e=Math.max(b.x,R.x);return!(De>de)&&!($e<re)&&(re=Math.min(B.y,H.y),de=Math.max(B.y,H.y),De=Math.min(b.y,R.y),$e=Math.max(b.y,R.y),!(De>de)&&!($e<re))}}}])})(),Kt=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===f.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(i){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(i){return this===i||this.equalsExact(i,0)}},{key:"geometryChanged",value:function(){this.apply(f.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(i){return i!==null&&this.norm().equalsExact(i.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var i;if(arguments.length===1){var s=arguments[0];return i=s,this.getTypeCode()!==i.getTypeCode()?this.getTypeCode()-i.getTypeCode():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(s)}if(arguments.length===2){var h=arguments[0],b=arguments[1];return i=h,this.getTypeCode()!==i.getTypeCode()?this.getTypeCode()-i.getTypeCode():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(h,b)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(i){if(i.getTypeCode()===f.TYPECODE_GEOMETRYCOLLECTION)throw new We("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(i,s,h){return h===0?i.equals(s):i.distance(s)<=h}},{key:"norm",value:function(){var i=this.copy();return i.normalize(),i}},{key:"reverse",value:function(){var i=this.reverseInternal();return this.envelope!=null&&(i.envelope=this.envelope.copy()),i.setSRID(this.getSRID()),i}},{key:"copy",value:function(){var i=this.copyInternal();return i.envelope=this._envelope==null?null:this._envelope.copy(),i._SRID=this._SRID,i._userData=this._userData,i}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Cn(this._envelope)}},{key:"setSRID",value:function(i){this._SRID=i}},{key:"setUserData",value:function(i){this._userData=i}},{key:"compare",value:function(i,s){for(var h=i.iterator(),b=s.iterator();h.hasNext()&&b.hasNext();){var R=h.next(),B=b.next(),H=R.compareTo(B);if(H!==0)return H}return h.hasNext()?1:b.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(i){return this.getClass()===i.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===f.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===f.TYPECODE_MULTIPOINT||this.getTypeCode()===f.TYPECODE_MULTILINESTRING||this.getTypeCode()===f.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[ht,at,ft]}},{key:"getClass",value:function(){return f}}],[{key:"hasNonEmptyElements",value:function(i){for(var s=0;s<i.length;s++)if(!i[s].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(i){for(var s=0;s<i.length;s++)if(i[s]===null)return!0;return!1}}])})();Kt.constructor_=function(f){f&&(this._envelope=null,this._userData=null,this._factory=f,this._SRID=f.getSRID())},Kt.TYPECODE_POINT=0,Kt.TYPECODE_MULTIPOINT=1,Kt.TYPECODE_LINESTRING=2,Kt.TYPECODE_LINEARRING=3,Kt.TYPECODE_MULTILINESTRING=4,Kt.TYPECODE_POLYGON=5,Kt.TYPECODE_MULTIPOLYGON=6,Kt.TYPECODE_GEOMETRYCOLLECTION=7,Kt.TYPENAME_POINT="Point",Kt.TYPENAME_MULTIPOINT="MultiPoint",Kt.TYPENAME_LINESTRING="LineString",Kt.TYPENAME_LINEARRING="LinearRing",Kt.TYPENAME_MULTILINESTRING="MultiLineString",Kt.TYPENAME_POLYGON="Polygon",Kt.TYPENAME_MULTIPOLYGON="MultiPolygon",Kt.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",Kt.geometryChangedFilter={get interfaces_(){return[tt]},filter:function(f){f.geometryChangedAction()}};var we=(function(){function f(){T(this,f)}return c(f,null,[{key:"toLocationSymbol",value:function(i){switch(i){case f.EXTERIOR:return"e";case f.BOUNDARY:return"b";case f.INTERIOR:return"i";case f.NONE:return"-"}throw new We("Unknown location value: "+i)}}])})();we.INTERIOR=0,we.BOUNDARY=1,we.EXTERIOR=2,we.NONE=-1;var $i=(function(){return c((function f(){T(this,f)}),[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}])})(),Vr=(function(f){function i(s){var h;return T(this,i),(h=E(this,i,[s])).name=Object.keys({NoSuchElementException:i})[0],h}return F(i,f),c(i)})(it),Rr=(function(f){function i(s){var h;return T(this,i),(h=E(this,i,[s])).name=Object.keys({UnsupportedOperationException:i})[0],h}return F(i,f),c(i)})(it),Ye=(function(f){function i(){return T(this,i),E(this,i,arguments)}return F(i,f),c(i,[{key:"contains",value:function(){}}])})($i),ds=(function(f){function i(s){var h;return T(this,i),(h=E(this,i)).map=new Map,s instanceof $i&&h.addAll(s),h}return F(i,f),c(i,[{key:"contains",value:function(s){var h=s.hashCode?s.hashCode():s;return!!this.map.has(h)}},{key:"add",value:function(s){var h=s.hashCode?s.hashCode():s;return!this.map.has(h)&&!!this.map.set(h,s)}},{key:"addAll",value:function(s){var h,b=W(s);try{for(b.s();!(h=b.n()).done;){var R=h.value;this.add(R)}}catch(B){b.e(B)}finally{b.f()}return!0}},{key:"remove",value:function(){throw new Rr}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new Co(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])})(Ye),Co=(function(){return c((function f(i){T(this,f),this.iterator=i.values();var s=this.iterator.next(),h=s.done,b=s.value;this.done=h,this.value=b}),[{key:"next",value:function(){if(this.done)throw new Vr;var f=this.value,i=this.iterator.next(),s=i.done,h=i.value;return this.done=s,this.value=h,f}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new Rr}}])})(),lt=(function(){function f(){T(this,f)}return c(f,null,[{key:"opposite",value:function(i){return i===f.LEFT?f.RIGHT:i===f.RIGHT?f.LEFT:i}}])})();lt.ON=0,lt.LEFT=1,lt.RIGHT=2;var ai=(function(f){function i(s){var h;return T(this,i),(h=E(this,i,[s])).name=Object.keys({EmptyStackException:i})[0],h}return F(i,f),c(i)})(it),ps=(function(f){function i(s){var h;return T(this,i),(h=E(this,i,[s])).name=Object.keys({IndexOutOfBoundsException:i})[0],h}return F(i,f),c(i)})(it),pr=(function(f){function i(){return T(this,i),E(this,i,arguments)}return F(i,f),c(i,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])})($i),As=(function(f){function i(){var s;return T(this,i),(s=E(this,i)).array=[],s}return F(i,f),c(i,[{key:"add",value:function(s){return this.array.push(s),!0}},{key:"get",value:function(s){if(s<0||s>=this.size())throw new ps;return this.array[s]}},{key:"push",value:function(s){return this.array.push(s),s}},{key:"pop",value:function(){if(this.array.length===0)throw new ai;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new ai;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(s){return this.array.indexOf(s)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])})(pr);function vn(f,i){return f.interfaces_&&f.interfaces_.indexOf(i)>-1}var ir=(function(){return c((function f(i){T(this,f),this.str=i}),[{key:"append",value:function(f){this.str+=f}},{key:"setCharAt",value:function(f,i){this.str=this.str.substr(0,f)+i+this.str.substr(f+1)}},{key:"toString",value:function(){return this.str}}])})(),aa=(function(){function f(i){T(this,f),this.value=i}return c(f,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(i){return this.value<i?-1:this.value>i?1:0}}],[{key:"compare",value:function(i,s){return i<s?-1:i>s?1:0}},{key:"isNan",value:function(i){return Number.isNaN(i)}},{key:"valueOf",value:function(i){return new f(i)}}])})(),oa=(function(){return c((function f(){T(this,f)}),null,[{key:"isWhitespace",value:function(f){return f<=32&&f>=0||f===127}},{key:"toUpperCase",value:function(f){return f.toUpperCase()}}])})(),Qe=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"le",value:function(i){return this._hi<i._hi||this._hi===i._hi&&this._lo<=i._lo}},{key:"extractSignificantDigits",value:function(i,s){var h=this.abs(),b=f.magnitude(h._hi),R=f.TEN.pow(b);(h=h.divide(R)).gt(f.TEN)?(h=h.divide(f.TEN),b+=1):h.lt(f.ONE)&&(h=h.multiply(f.TEN),b-=1);for(var B=b+1,H=new ir,re=f.MAX_PRINT_DIGITS-1,de=0;de<=re;de++){i&&de===B&&H.append(".");var De=Math.trunc(h._hi);if(De<0)break;var $e=!1,ct=0;De>9?($e=!0,ct="9"):ct="0"+De,H.append(ct),h=h.subtract(f.valueOf(De)).multiply(f.TEN),$e&&h.selfAdd(f.TEN);var At=!0,Ht=f.magnitude(h._hi);if(Ht<0&&Math.abs(Ht)>=re-de&&(At=!1),!At)break}return s[0]=b,H.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof f){var i=arguments[0];return this.add(i.negate())}if(typeof arguments[0]=="number"){var s=arguments[0];return this.add(-s)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof f){var i=arguments[0];return this._hi===i._hi&&this._lo===i._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof f){var i=arguments[0];return this.isNaN()?this:this.selfAdd(-i._hi,-i._lo)}if(typeof arguments[0]=="number"){var s=arguments[0];return this.isNaN()?this:this.selfAdd(-s,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(i){return this.le(i)?this:i}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof f){var i=arguments[0];return this.selfDivide(i._hi,i._lo)}if(typeof arguments[0]=="number"){var s=arguments[0];return this.selfDivide(s,0)}}else if(arguments.length===2){var h,b,R,B,H=arguments[0],re=arguments[1],de=null,De=null,$e=null,ct=null;return R=this._hi/H,ct=(de=($e=f.SPLIT*R)-(de=$e-R))*(De=(ct=f.SPLIT*H)-(De=ct-H))-(B=R*H)+de*(b=H-De)+(h=R-de)*De+h*b,ct=R+($e=(this._hi-B-ct+this._lo-R*re)/H),this._hi=ct,this._lo=R-ct+$e,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof f){var i,s,h,b,R=arguments[0],B=null,H=null,re=null,de=null;return i=(h=this._hi/R._hi)-(B=(re=f.SPLIT*h)-(B=re-h)),de=B*(H=(de=f.SPLIT*R._hi)-(H=de-R._hi))-(b=h*R._hi)+B*(s=R._hi-H)+i*H+i*s,new f(de=h+(re=(this._hi-b-de+this._lo-h*R._lo)/R._hi),h-de+re)}if(typeof arguments[0]=="number"){var De=arguments[0];return nt.isNaN(De)?f.createNaN():f.copy(this).selfDivide(De,0)}}},{key:"ge",value:function(i){return this._hi>i._hi||this._hi===i._hi&&this._lo>=i._lo}},{key:"pow",value:function(i){if(i===0)return f.valueOf(1);var s=new f(this),h=f.valueOf(1),b=Math.abs(i);if(b>1)for(;b>0;)b%2==1&&h.selfMultiply(s),(b/=2)>0&&(s=s.sqr());else h=s;return i<0?h.reciprocal():h}},{key:"ceil",value:function(){if(this.isNaN())return f.NaN;var i=Math.ceil(this._hi),s=0;return i===this._hi&&(s=Math.ceil(this._lo)),new f(i,s)}},{key:"compareTo",value:function(i){var s=i;return this._hi<s._hi?-1:this._hi>s._hi?1:this._lo<s._lo?-1:this._lo>s._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof f){var i=arguments[0];return this.init(i),this}if(typeof arguments[0]=="number"){var s=arguments[0];return this.init(s),this}}},{key:"max",value:function(i){return this.ge(i)?this:i}},{key:"sqrt",value:function(){if(this.isZero())return f.valueOf(0);if(this.isNegative())return f.NaN;var i=1/Math.sqrt(this._hi),s=this._hi*i,h=f.valueOf(s),b=this.subtract(h.sqr())._hi*(.5*i);return h.add(b)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof f){var i=arguments[0];return this.selfAdd(i._hi,i._lo)}if(typeof arguments[0]=="number"){var s,h,b,R,B,H=arguments[0],re=null;return re=(b=this._hi+H)-(R=b-this._hi),h=(B=(re=H-R+(this._hi-re))+this._lo)+(b-(s=b+B)),this._hi=s+h,this._lo=h+(s-this._hi),this}}else if(arguments.length===2){var de,De,$e,ct,At=arguments[0],Ht=arguments[1],ln=null,Nn=null,An=null;$e=this._hi+At,De=this._lo+Ht,Nn=$e-(An=$e-this._hi),ln=De-(ct=De-this._lo);var Vn=(de=$e+(An=(Nn=At-An+(this._hi-Nn))+De))+(An=(ln=Ht-ct+(this._lo-ln))+(An+($e-de))),Ci=An+(de-Vn);return this._hi=Vn,this._lo=Ci,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof f){var i=arguments[0];return this.selfMultiply(i._hi,i._lo)}if(typeof arguments[0]=="number"){var s=arguments[0];return this.selfMultiply(s,0)}}else if(arguments.length===2){var h,b,R=arguments[0],B=arguments[1],H=null,re=null,de=null,De=null;H=(de=f.SPLIT*this._hi)-this._hi,De=f.SPLIT*R,H=de-H,h=this._hi-H,re=De-R;var $e=(de=this._hi*R)+(De=H*(re=De-re)-de+H*(b=R-re)+h*re+h*b+(this._hi*B+this._lo*R)),ct=De+(H=de-$e);return this._hi=$e,this._lo=ct,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return f.NaN;var i=Math.floor(this._hi),s=0;return i===this._hi&&(s=Math.floor(this._lo)),new f(i,s)}},{key:"negate",value:function(){return this.isNaN()?this:new f(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(i){if(i instanceof CloneNotSupportedException)return null;throw i}}},{key:"multiply",value:function(){if(arguments[0]instanceof f){var i=arguments[0];return i.isNaN()?f.createNaN():f.copy(this).selfMultiply(i)}if(typeof arguments[0]=="number"){var s=arguments[0];return nt.isNaN(s)?f.createNaN():f.copy(this).selfMultiply(s,0)}}},{key:"isNaN",value:function(){return nt.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var i=f.magnitude(this._hi);return i>=-3&&i<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var i=this.getSpecialNumberString();if(i!==null)return i;var s=new Array(1).fill(null),h=this.extractSignificantDigits(!0,s),b=s[0]+1,R=h;if(h.charAt(0)===".")R="0"+h;else if(b<0)R="0."+f.stringOfChar("0",-b)+h;else if(h.indexOf(".")===-1){var B=b-h.length;R=h+f.stringOfChar("0",B)+".0"}return this.isNegative()?"-"+R:R}},{key:"reciprocal",value:function(){var i,s,h,b,R=null,B=null,H=null,re=null;i=(h=1/this._hi)-(R=(H=f.SPLIT*h)-(R=H-h)),B=(re=f.SPLIT*this._hi)-this._hi;var de=h+(H=(1-(b=h*this._hi)-(re=R*(B=re-B)-b+R*(s=this._hi-B)+i*B+i*s)-h*this._lo)/this._hi);return new f(de,h-de+H)}},{key:"toSciNotation",value:function(){if(this.isZero())return f.SCI_NOT_ZERO;var i=this.getSpecialNumberString();if(i!==null)return i;var s=new Array(1).fill(null),h=this.extractSignificantDigits(!1,s),b=f.SCI_NOT_EXPONENT_CHAR+s[0];if(h.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+h);var R="";h.length>1&&(R=h.substring(1));var B=h.charAt(0)+"."+R;return this.isNegative()?"-"+B+b:B+b}},{key:"abs",value:function(){return this.isNaN()?f.NaN:this.isNegative()?this.negate():new f(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(i){return this._hi<i._hi||this._hi===i._hi&&this._lo<i._lo}},{key:"add",value:function(){if(arguments[0]instanceof f){var i=arguments[0];return f.copy(this).selfAdd(i)}if(typeof arguments[0]=="number"){var s=arguments[0];return f.copy(this).selfAdd(s)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var i=arguments[0];this._hi=i,this._lo=0}else if(arguments[0]instanceof f){var s=arguments[0];this._hi=s._hi,this._lo=s._lo}}else if(arguments.length===2){var h=arguments[0],b=arguments[1];this._hi=h,this._lo=b}}},{key:"gt",value:function(i){return this._hi>i._hi||this._hi===i._hi&&this._lo>i._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?f.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[ft,at,ht]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var i=arguments[0];this.init(i)}else if(arguments[0]instanceof f){var s=arguments[0];this.init(s)}else if(typeof arguments[0]=="string"){var h=arguments[0];f.constructor_.call(this,f.parse(h))}}else if(arguments.length===2){var b=arguments[0],R=arguments[1];this.init(b,R)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],s=arguments[1],h=arguments[2],b=arguments[3];return f.determinant(f.valueOf(i),f.valueOf(s),f.valueOf(h),f.valueOf(b))}if(arguments[3]instanceof f&&arguments[2]instanceof f&&arguments[0]instanceof f&&arguments[1]instanceof f){var R=arguments[1],B=arguments[2],H=arguments[3];return arguments[0].multiply(H).selfSubtract(R.multiply(B))}}},{key:"sqr",value:function(i){return f.valueOf(i).selfMultiply(i)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var i=arguments[0];return f.parse(i)}if(typeof arguments[0]=="number")return new f(arguments[0])}},{key:"sqrt",value:function(i){return f.valueOf(i).sqrt()}},{key:"parse",value:function(i){for(var s=0,h=i.length;oa.isWhitespace(i.charAt(s));)s++;var b=!1;if(s<h){var R=i.charAt(s);R!=="-"&&R!=="+"||(s++,R==="-"&&(b=!0))}for(var B=new f,H=0,re=0,de=0,De=!1;!(s>=h);){var $e=i.charAt(s);if(s++,oa.isDigit($e)){var ct=$e-"0";B.selfMultiply(f.TEN),B.selfAdd(ct),H++}else{if($e!=="."){if($e==="e"||$e==="E"){var At=i.substring(s);try{de=aa.parseInt(At)}catch(Vn){throw Vn instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+At+" in string "+i):Vn}break}throw new NumberFormatException("Unexpected character '"+$e+"' at position "+s+" in string "+i)}re=H,De=!0}}var Ht=B;De||(re=H);var ln=H-re-de;if(ln===0)Ht=B;else if(ln>0){var Nn=f.TEN.pow(ln);Ht=B.divide(Nn)}else if(ln<0){var An=f.TEN.pow(-ln);Ht=B.multiply(An)}return b?Ht.negate():Ht}},{key:"createNaN",value:function(){return new f(nt.NaN,nt.NaN)}},{key:"copy",value:function(i){return new f(i)}},{key:"magnitude",value:function(i){var s=Math.abs(i),h=Math.log(s)/Math.log(10),b=Math.trunc(Math.floor(h));return 10*Math.pow(10,b)<=s&&(b+=1),b}},{key:"stringOfChar",value:function(i,s){for(var h=new ir,b=0;b<s;b++)h.append(i);return h.toString()}}])})();Qe.PI=new Qe(3.141592653589793,12246467991473532e-32),Qe.TWO_PI=new Qe(6.283185307179586,24492935982947064e-32),Qe.PI_2=new Qe(1.5707963267948966,6123233995736766e-32),Qe.E=new Qe(2.718281828459045,14456468917292502e-32),Qe.NaN=new Qe(nt.NaN,nt.NaN),Qe.EPS=123259516440783e-46,Qe.SPLIT=134217729,Qe.MAX_PRINT_DIGITS=32,Qe.TEN=Qe.valueOf(10),Qe.ONE=Qe.valueOf(1),Qe.SCI_NOT_EXPONENT_CHAR="E",Qe.SCI_NOT_ZERO="0.0E0";var Ur=(function(){function f(){T(this,f)}return c(f,null,[{key:"orientationIndex",value:function(i,s,h){var b=f.orientationIndexFilter(i,s,h);if(b<=1)return b;var R=Qe.valueOf(s.x).selfAdd(-i.x),B=Qe.valueOf(s.y).selfAdd(-i.y),H=Qe.valueOf(h.x).selfAdd(-s.x),re=Qe.valueOf(h.y).selfAdd(-s.y);return R.selfMultiply(re).selfSubtract(B.selfMultiply(H)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof Qe&&arguments[2]instanceof Qe&&arguments[0]instanceof Qe&&arguments[1]instanceof Qe){var i=arguments[1],s=arguments[2],h=arguments[3];return arguments[0].multiply(h).selfSubtract(i.multiply(s)).signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var b=arguments[0],R=arguments[1],B=arguments[2],H=arguments[3],re=Qe.valueOf(b),de=Qe.valueOf(R),De=Qe.valueOf(B),$e=Qe.valueOf(H);return re.multiply($e).selfSubtract(de.multiply(De)).signum()}}},{key:"intersection",value:function(i,s,h,b){var R=new Qe(i.y).selfSubtract(s.y),B=new Qe(s.x).selfSubtract(i.x),H=new Qe(i.x).selfMultiply(s.y).selfSubtract(new Qe(s.x).selfMultiply(i.y)),re=new Qe(h.y).selfSubtract(b.y),de=new Qe(b.x).selfSubtract(h.x),De=new Qe(h.x).selfMultiply(b.y).selfSubtract(new Qe(b.x).selfMultiply(h.y)),$e=B.multiply(De).selfSubtract(de.multiply(H)),ct=re.multiply(H).selfSubtract(R.multiply(De)),At=R.multiply(de).selfSubtract(re.multiply(B)),Ht=$e.selfDivide(At).doubleValue(),ln=ct.selfDivide(At).doubleValue();return nt.isNaN(Ht)||nt.isInfinite(Ht)||nt.isNaN(ln)||nt.isInfinite(ln)?null:new Ne(Ht,ln)}},{key:"orientationIndexFilter",value:function(i,s,h){var b=null,R=(i.x-h.x)*(s.y-h.y),B=(i.y-h.y)*(s.x-h.x),H=R-B;if(R>0){if(B<=0)return f.signum(H);b=R+B}else{if(!(R<0)||B>=0)return f.signum(H);b=-R-B}var re=f.DP_SAFE_EPSILON*b;return H>=re||-H>=re?f.signum(H):2}},{key:"signum",value:function(i){return i>0?1:i<0?-1:0}}])})();Ur.DP_SAFE_EPSILON=1e-15;var dn=(function(){return c((function f(){T(this,f)}),[{key:"getM",value:function(f){if(this.hasM()){var i=this.getDimension()-this.getMeasures();return this.getOrdinate(f,i)}return nt.NaN}},{key:"setOrdinate",value:function(f,i,s){}},{key:"getZ",value:function(f){return this.hasZ()?this.getOrdinate(f,2):nt.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(f,i){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(f){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(f){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(f){}},{key:"copy",value:function(){}},{key:"getY",value:function(f){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[ht]}}])})();dn.X=0,dn.Y=1,dn.Z=2,dn.M=3;var tn=(function(){function f(){T(this,f)}return c(f,null,[{key:"index",value:function(i,s,h){return Ur.orientationIndex(i,s,h)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var i=arguments[0],s=i.length-1;if(s<3)throw new We("Ring has fewer than 4 points, so orientation cannot be determined");for(var h=i[0],b=0,R=1;R<=s;R++){var B=i[R];B.y>h.y&&(h=B,b=R)}var H=b;do(H-=1)<0&&(H=s);while(i[H].equals2D(h)&&H!==b);var re=b;do re=(re+1)%s;while(i[re].equals2D(h)&&re!==b);var de=i[H],De=i[re];if(de.equals2D(h)||De.equals2D(h)||de.equals2D(De))return!1;var $e=f.index(de,h,De);return $e===0?de.x>De.x:$e>0}if(vn(arguments[0],dn)){var ct=arguments[0],At=ct.size()-1;if(At<3)throw new We("Ring has fewer than 4 points, so orientation cannot be determined");for(var Ht=ct.getCoordinate(0),ln=0,Nn=1;Nn<=At;Nn++){var An=ct.getCoordinate(Nn);An.y>Ht.y&&(Ht=An,ln=Nn)}var Vn=null,Ci=ln;do(Ci-=1)<0&&(Ci=At),Vn=ct.getCoordinate(Ci);while(Vn.equals2D(Ht)&&Ci!==ln);var Kn=null,xr=ln;do xr=(xr+1)%At,Kn=ct.getCoordinate(xr);while(Kn.equals2D(Ht)&&xr!==ln);if(Vn.equals2D(Ht)||Kn.equals2D(Ht)||Vn.equals2D(Kn))return!1;var oo=f.index(Vn,Ht,Kn);return oo===0?Vn.x>Kn.x:oo>0}}}])})();tn.CLOCKWISE=-1,tn.RIGHT=tn.CLOCKWISE,tn.COUNTERCLOCKWISE=1,tn.LEFT=tn.COUNTERCLOCKWISE,tn.COLLINEAR=0,tn.STRAIGHT=tn.COLLINEAR;var Aa=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(f,i){var s=this.getRightmostSideOfSegment(f,i);return s<0&&(s=this.getRightmostSideOfSegment(f,i-1)),s<0&&(this._minCoord=null,this.checkForRightmostCoordinate(f)),s}},{key:"findRightmostEdgeAtVertex",value:function(){var f=this._minDe.getEdge().getCoordinates();Pt.isTrue(this._minIndex>0&&this._minIndex<f.length,"rightmost point expected to be interior vertex of edge");var i=f[this._minIndex-1],s=f[this._minIndex+1],h=tn.index(this._minCoord,s,i),b=!1;(i.y<this._minCoord.y&&s.y<this._minCoord.y&&h===tn.COUNTERCLOCKWISE||i.y>this._minCoord.y&&s.y>this._minCoord.y&&h===tn.CLOCKWISE)&&(b=!0),b&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(f,i){var s=f.getEdge().getCoordinates();if(i<0||i+1>=s.length||s[i].y===s[i+1].y)return-1;var h=lt.LEFT;return s[i].y<s[i+1].y&&(h=lt.RIGHT),h}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(f){for(var i=f.getEdge().getCoordinates(),s=0;s<i.length-1;s++)(this._minCoord===null||i[s].x>this._minCoord.x)&&(this._minDe=f,this._minIndex=s,this._minCoord=i[s])}},{key:"findRightmostEdgeAtNode",value:function(){var f=this._minDe.getNode().getEdges();this._minDe=f.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(f){for(var i=f.iterator();i.hasNext();){var s=i.next();s.isForward()&&this.checkForRightmostCoordinate(s)}Pt.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===lt.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}])})(),_t=(function(f){function i(s,h){var b;return T(this,i),(b=E(this,i,[h?s+" [ "+h+" ]":s])).pt=h?new Ne(h):void 0,b.name=Object.keys({TopologyException:i})[0],b}return F(i,f),c(i,[{key:"getCoordinate",value:function(){return this.pt}}])})(rt),In=(function(){return c((function f(){T(this,f),this.array=[]}),[{key:"addLast",value:function(f){this.array.push(f)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}])})(),pt=(function(f){function i(s){var h;return T(this,i),(h=E(this,i)).array=[],s instanceof $i&&h.addAll(s),h}return F(i,f),c(i,[{key:"interfaces_",get:function(){return[pr,$i]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(s){return arguments.length===1?this.array.push(s):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(s){var h,b=W(s);try{for(b.s();!(h=b.n()).done;){var R=h.value;this.array.push(R)}}catch(B){b.e(B)}finally{b.f()}}},{key:"set",value:function(s,h){var b=this.array[s];return this.array[s]=h,b}},{key:"iterator",value:function(){return new mr(this)}},{key:"get",value:function(s){if(s<0||s>=this.size())throw new ps;return this.array[s]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(s){s?this.array.sort((function(h,b){return s.compare(h,b)})):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(s){for(var h=0,b=this.array.length;h<b;h++)if(this.array[h]===s)return!!this.array.splice(h,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])})(pr),mr=(function(){return c((function f(i){T(this,f),this.arrayList=i,this.position=0}),[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Vr;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(f){return this.arrayList.set(this.position-1,f)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}])})(),qr=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"clearVisitedEdges",value:function(){for(var f=this._dirEdgeList.iterator();f.hasNext();)f.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(f){for(var i=null,s=f.getEdges().iterator();s.hasNext();){var h=s.next();if(h.isVisited()||h.getSym().isVisited()){i=h;break}}if(i===null)throw new _t("unable to find edge to compute depths at "+f.getCoordinate());f.getEdges().computeDepths(i);for(var b=f.getEdges().iterator();b.hasNext();){var R=b.next();R.setVisited(!0),this.copySymDepths(R)}}},{key:"computeDepth",value:function(f){this.clearVisitedEdges();var i=this._finder.getEdge();i.getNode(),i.getLabel(),i.setEdgeDepths(lt.RIGHT,f),this.copySymDepths(i),this.computeDepths(i)}},{key:"create",value:function(f){this.addReachable(f),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var f=this._dirEdgeList.iterator();f.hasNext();){var i=f.next();i.getDepth(lt.RIGHT)>=1&&i.getDepth(lt.LEFT)<=0&&!i.isInteriorAreaEdge()&&i.setInResult(!0)}}},{key:"computeDepths",value:function(f){var i=new ds,s=new In,h=f.getNode();for(s.addLast(h),i.add(h),f.setVisited(!0);!s.isEmpty();){var b=s.removeFirst();i.add(b),this.computeNodeDepth(b);for(var R=b.getEdges().iterator();R.hasNext();){var B=R.next().getSym();if(!B.isVisited()){var H=B.getNode();i.contains(H)||(s.addLast(H),i.add(H))}}}}},{key:"compareTo",value:function(f){var i=f;return this._rightMostCoord.x<i._rightMostCoord.x?-1:this._rightMostCoord.x>i._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var f=new Cn,i=this._dirEdgeList.iterator();i.hasNext();)for(var s=i.next().getEdge().getCoordinates(),h=0;h<s.length-1;h++)f.expandToInclude(s[h]);this._env=f}return this._env}},{key:"addReachable",value:function(f){var i=new As;for(i.add(f);!i.empty();){var s=i.pop();this.add(s,i)}}},{key:"copySymDepths",value:function(f){var i=f.getSym();i.setDepth(lt.LEFT,f.getDepth(lt.RIGHT)),i.setDepth(lt.RIGHT,f.getDepth(lt.LEFT))}},{key:"add",value:function(f,i){f.setVisited(!0),this._nodes.add(f);for(var s=f.getEdges().iterator();s.hasNext();){var h=s.next();this._dirEdgeList.add(h);var b=h.getSym().getNode();b.isVisited()||i.push(b)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[at]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new pt,this._nodes=new pt,this._rightMostCoord=null,this._env=null,this._finder=new Aa}}])})(),pn=(function(){return c((function f(){T(this,f)}),null,[{key:"intersection",value:function(f,i,s,h){var b=f.x<i.x?f.x:i.x,R=f.y<i.y?f.y:i.y,B=f.x>i.x?f.x:i.x,H=f.y>i.y?f.y:i.y,re=s.x<h.x?s.x:h.x,de=s.y<h.y?s.y:h.y,De=s.x>h.x?s.x:h.x,$e=s.y>h.y?s.y:h.y,ct=((b>re?b:re)+(B<De?B:De))/2,At=((R>de?R:de)+(H<$e?H:$e))/2,Ht=f.x-ct,ln=f.y-At,Nn=i.x-ct,An=i.y-At,Vn=s.x-ct,Ci=s.y-At,Kn=h.x-ct,xr=h.y-At,oo=ln-An,Ll=Nn-Ht,xi=Ht*An-Nn*ln,Hr=Ci-xr,Tr=Kn-Vn,lo=Vn*xr-Kn*Ci,xs=oo*Tr-Hr*Ll,Ba=(Ll*lo-Tr*xi)/xs,Vs=(Hr*xi-oo*lo)/xs;return nt.isNaN(Ba)||nt.isInfinite(Ba)||nt.isNaN(Vs)||nt.isInfinite(Vs)?null:new Ne(Ba+ct,Vs+At)}}])})(),Si=(function(){return c((function f(){T(this,f)}),null,[{key:"arraycopy",value:function(f,i,s,h,b){for(var R=0,B=i;B<i+b;B++)s[h+R]=f[B],R++}},{key:"getProperty",value:function(f){return{"line.separator":`
`}[f]}}])})(),Sr=(function(){function f(){T(this,f)}return c(f,null,[{key:"log10",value:function(i){var s=Math.log(i);return nt.isInfinite(s)||nt.isNaN(s)?s:s/f.LOG_10}},{key:"min",value:function(i,s,h,b){var R=i;return s<R&&(R=s),h<R&&(R=h),b<R&&(R=b),R}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],s=arguments[1],h=arguments[2];return i<s?s:i>h?h:i}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var b=arguments[0],R=arguments[1],B=arguments[2];return b<R?R:b>B?B:b}}},{key:"wrap",value:function(i,s){return i<0?s- -i%s:i%s}},{key:"max",value:function(){if(arguments.length===3){var i=arguments[1],s=arguments[2],h=arguments[0];return i>h&&(h=i),s>h&&(h=s),h}if(arguments.length===4){var b=arguments[1],R=arguments[2],B=arguments[3],H=arguments[0];return b>H&&(H=b),R>H&&(H=R),B>H&&(H=B),H}}},{key:"average",value:function(i,s){return(i+s)/2}}])})();Sr.LOG_10=Math.log(10);var Ai=(function(){function f(){T(this,f)}return c(f,null,[{key:"segmentToSegment",value:function(i,s,h,b){if(i.equals(s))return f.pointToSegment(i,h,b);if(h.equals(b))return f.pointToSegment(b,i,s);var R=!1;if(Cn.intersects(i,s,h,b)){var B=(s.x-i.x)*(b.y-h.y)-(s.y-i.y)*(b.x-h.x);if(B===0)R=!0;else{var H=(i.y-h.y)*(b.x-h.x)-(i.x-h.x)*(b.y-h.y),re=((i.y-h.y)*(s.x-i.x)-(i.x-h.x)*(s.y-i.y))/B,de=H/B;(de<0||de>1||re<0||re>1)&&(R=!0)}}else R=!0;return R?Sr.min(f.pointToSegment(i,h,b),f.pointToSegment(s,h,b),f.pointToSegment(h,i,s),f.pointToSegment(b,i,s)):0}},{key:"pointToSegment",value:function(i,s,h){if(s.x===h.x&&s.y===h.y)return i.distance(s);var b=(h.x-s.x)*(h.x-s.x)+(h.y-s.y)*(h.y-s.y),R=((i.x-s.x)*(h.x-s.x)+(i.y-s.y)*(h.y-s.y))/b;if(R<=0)return i.distance(s);if(R>=1)return i.distance(h);var B=((s.y-i.y)*(h.x-s.x)-(s.x-i.x)*(h.y-s.y))/b;return Math.abs(B)*Math.sqrt(b)}},{key:"pointToLinePerpendicular",value:function(i,s,h){var b=(h.x-s.x)*(h.x-s.x)+(h.y-s.y)*(h.y-s.y),R=((s.y-i.y)*(h.x-s.x)-(s.x-i.x)*(h.y-s.y))/b;return Math.abs(R)*Math.sqrt(b)}},{key:"pointToSegmentString",value:function(i,s){if(s.length===0)throw new We("Line array must contain at least one vertex");for(var h=i.distance(s[0]),b=0;b<s.length-1;b++){var R=f.pointToSegment(i,s[b],s[b+1]);R<h&&(h=R)}return h}}])})(),gr=(function(){return c((function f(){T(this,f)}),[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||vn(arguments[0],dn);else if(arguments.length!==2){if(arguments.length===3){var f=arguments[0],i=arguments[1];return this.create(f,i)}}}}])})(),_e=(function(){return c((function f(){T(this,f)}),[{key:"filter",value:function(f){}}])})(),K=(function(){return c((function f(){T(this,f)}),null,[{key:"ofLine",value:function(f){var i=f.size();if(i<=1)return 0;var s=0,h=new Ne;f.getCoordinate(0,h);for(var b=h.x,R=h.y,B=1;B<i;B++){f.getCoordinate(B,h);var H=h.x,re=h.y,de=H-b,De=re-R;s+=Math.sqrt(de*de+De*De),b=H,R=re}return s}}])})(),Y=c((function f(){T(this,f)})),oe=(function(){function f(){T(this,f)}return c(f,null,[{key:"copyCoord",value:function(i,s,h,b){for(var R=Math.min(i.getDimension(),h.getDimension()),B=0;B<R;B++)h.setOrdinate(b,B,i.getOrdinate(s,B))}},{key:"isRing",value:function(i){var s=i.size();return s===0||!(s<=3)&&i.getOrdinate(0,dn.X)===i.getOrdinate(s-1,dn.X)&&i.getOrdinate(0,dn.Y)===i.getOrdinate(s-1,dn.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(vn(arguments[0],dn)&&Number.isInteger(arguments[1])){var i=arguments[0],s=arguments[1];f.scroll(i,s,f.isRing(i))}else if(vn(arguments[0],dn)&&arguments[1]instanceof Ne){var h=arguments[0],b=arguments[1],R=f.indexOf(b,h);if(R<=0)return null;f.scroll(h,R)}}else if(arguments.length===3){var B=arguments[0],H=arguments[1],re=arguments[2];if(H<=0)return null;for(var de=B.copy(),De=re?B.size()-1:B.size(),$e=0;$e<De;$e++)for(var ct=0;ct<B.getDimension();ct++)B.setOrdinate($e,ct,de.getOrdinate((H+$e)%De,ct));if(re)for(var At=0;At<B.getDimension();At++)B.setOrdinate(De,At,B.getOrdinate(0,At))}}},{key:"isEqual",value:function(i,s){var h=i.size();if(h!==s.size())return!1;for(var b=Math.min(i.getDimension(),s.getDimension()),R=0;R<h;R++)for(var B=0;B<b;B++){var H=i.getOrdinate(R,B),re=s.getOrdinate(R,B);if(i.getOrdinate(R,B)!==s.getOrdinate(R,B)&&(!nt.isNaN(H)||!nt.isNaN(re)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var i=arguments[0];return f.minCoordinateIndex(i,0,i.size()-1)}if(arguments.length===3){for(var s=arguments[0],h=arguments[2],b=-1,R=null,B=arguments[1];B<=h;B++){var H=s.getCoordinate(B);(R===null||R.compareTo(H)>0)&&(R=H,b=B)}return b}}},{key:"extend",value:function(i,s,h){var b=i.create(h,s.getDimension()),R=s.size();if(f.copy(s,0,b,0,R),R>0)for(var B=R;B<h;B++)f.copy(s,R-1,b,B,1);return b}},{key:"reverse",value:function(i){for(var s=i.size()-1,h=Math.trunc(s/2),b=0;b<=h;b++)f.swap(i,b,s-b)}},{key:"swap",value:function(i,s,h){if(s===h)return null;for(var b=0;b<i.getDimension();b++){var R=i.getOrdinate(s,b);i.setOrdinate(s,b,i.getOrdinate(h,b)),i.setOrdinate(h,b,R)}}},{key:"copy",value:function(i,s,h,b,R){for(var B=0;B<R;B++)f.copyCoord(i,s+B,h,b+B)}},{key:"ensureValidRing",value:function(i,s){var h=s.size();return h===0?s:h<=3?f.createClosedRing(i,s,4):s.getOrdinate(0,dn.X)===s.getOrdinate(h-1,dn.X)&&s.getOrdinate(0,dn.Y)===s.getOrdinate(h-1,dn.Y)?s:f.createClosedRing(i,s,h+1)}},{key:"indexOf",value:function(i,s){for(var h=0;h<s.size();h++)if(i.x===s.getOrdinate(h,dn.X)&&i.y===s.getOrdinate(h,dn.Y))return h;return-1}},{key:"createClosedRing",value:function(i,s,h){var b=i.create(h,s.getDimension()),R=s.size();f.copy(s,0,b,0,R);for(var B=R;B<h;B++)f.copy(s,0,b,B,1);return b}},{key:"minCoordinate",value:function(i){for(var s=null,h=0;h<i.size();h++){var b=i.getCoordinate(h);(s===null||s.compareTo(b)>0)&&(s=b)}return s}}])})(),ae=(function(){function f(){T(this,f)}return c(f,null,[{key:"toDimensionSymbol",value:function(i){switch(i){case f.FALSE:return f.SYM_FALSE;case f.TRUE:return f.SYM_TRUE;case f.DONTCARE:return f.SYM_DONTCARE;case f.P:return f.SYM_P;case f.L:return f.SYM_L;case f.A:return f.SYM_A}throw new We("Unknown dimension value: "+i)}},{key:"toDimensionValue",value:function(i){switch(oa.toUpperCase(i)){case f.SYM_FALSE:return f.FALSE;case f.SYM_TRUE:return f.TRUE;case f.SYM_DONTCARE:return f.DONTCARE;case f.SYM_P:return f.P;case f.SYM_L:return f.L;case f.SYM_A:return f.A}throw new We("Unknown dimension symbol: "+i)}}])})();ae.P=0,ae.L=1,ae.A=2,ae.FALSE=-1,ae.TRUE=-2,ae.DONTCARE=-3,ae.SYM_FALSE="F",ae.SYM_TRUE="T",ae.SYM_DONTCARE="*",ae.SYM_P="0",ae.SYM_L="1",ae.SYM_A="2";var Ee=(function(){return c((function f(){T(this,f)}),[{key:"filter",value:function(f){}}])})(),Me=(function(){return c((function f(){T(this,f)}),[{key:"filter",value:function(f,i){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}])})(),Fe=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new Cn:this._points.expandEnvelope(new Cn)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new i(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Kt){var s=arguments[0],h=arguments[1];if(!this.isEquivalentClass(s))return!1;var b=s;if(this._points.size()!==b._points.size())return!1;for(var R=0;R<this._points.size();R++)if(!this.equal(this._points.getCoordinate(R),b._points.getCoordinate(R),h))return!1;return!0}return le(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var s=0;s<Math.trunc(this._points.size()/2);s++){var h=this._points.size()-1-s;if(!this._points.getCoordinate(s).equals(this._points.getCoordinate(h))){if(this._points.getCoordinate(s).compareTo(this._points.getCoordinate(h))>0){var b=this._points.copy();oe.reverse(b),this._points=b}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?ae.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var s=this._points.copy();return oe.reverse(s),this.getFactory().createLineString(s)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return Kt.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return K.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var s=arguments[0],h=0,b=0;h<this._points.size()&&b<s._points.size();){var R=this._points.getCoordinate(h).compareTo(s._points.getCoordinate(b));if(R!==0)return R;h++,b++}return h<this._points.size()?1:b<s._points.size()?-1:0}if(arguments.length===2){var B=arguments[0];return arguments[1].compare(this._points,B._points)}}},{key:"apply",value:function(){if(vn(arguments[0],_e))for(var s=arguments[0],h=0;h<this._points.size();h++)s.filter(this._points.getCoordinate(h));else if(vn(arguments[0],Me)){var b=arguments[0];if(this._points.size()===0)return null;for(var R=0;R<this._points.size()&&(b.filter(this._points,R),!b.isDone());R++);b.isGeometryChanged()&&this.geometryChanged()}else vn(arguments[0],Ee)?arguments[0].filter(this):vn(arguments[0],tt)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new Rr}},{key:"isEquivalentClass",value:function(s){return s instanceof i}},{key:"getCoordinateN",value:function(s){return this._points.getCoordinate(s)}},{key:"getGeometryType",value:function(){return Kt.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(s){if(s===null&&(s=this.getFactory().getCoordinateSequenceFactory().create([])),s.size()===1)throw new We("Invalid number of points in LineString (found "+s.size()+" - must be 0 or >= 2)");this._points=s}},{key:"isCoordinate",value:function(s){for(var h=0;h<this._points.size();h++)if(this._points.getCoordinate(h).equals(s))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(s){return this.getFactory().createPoint(this._points.getCoordinate(s))}},{key:"interfaces_",get:function(){return[Y]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var s=arguments[0],h=arguments[1];Kt.constructor_.call(this,h),this.init(s)}}}}])})(Kt),ke=c((function f(){T(this,f)})),Ke=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new Cn;var s=new Cn;return s.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),s}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new i(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Kt){var s=arguments[0],h=arguments[1];return!!this.isEquivalentClass(s)&&(!(!this.isEmpty()||!s.isEmpty())||this.isEmpty()===s.isEmpty()&&this.equal(s.getCoordinate(),this.getCoordinate(),h))}return le(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return ae.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return Kt.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var s=arguments[0];return this.getCoordinate().compareTo(s.getCoordinate())}if(arguments.length===2){var h=arguments[0];return arguments[1].compare(this._coordinates,h._coordinates)}}},{key:"apply",value:function(){if(vn(arguments[0],_e)){var s=arguments[0];if(this.isEmpty())return null;s.filter(this.getCoordinate())}else if(vn(arguments[0],Me)){var h=arguments[0];if(this.isEmpty())return null;h.filter(this._coordinates,0),h.isGeometryChanged()&&this.geometryChanged()}else vn(arguments[0],Ee)?arguments[0].filter(this):vn(arguments[0],tt)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Kt.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(s){s===null&&(s=this.getFactory().getCoordinateSequenceFactory().create([])),Pt.isTrue(s.size()<=1),this._coordinates=s}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[ke]}}],[{key:"constructor_",value:function(){this._coordinates=null;var s=arguments[0],h=arguments[1];Kt.constructor_.call(this,h),this.init(s)}}])})(Kt),ut=(function(){function f(){T(this,f)}return c(f,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var i=arguments[0];return Math.abs(f.ofRingSigned(i))}if(vn(arguments[0],dn)){var s=arguments[0];return Math.abs(f.ofRingSigned(s))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var i=arguments[0];if(i.length<3)return 0;for(var s=0,h=i[0].x,b=1;b<i.length-1;b++){var R=i[b].x-h,B=i[b+1].y;s+=R*(i[b-1].y-B)}return s/2}if(vn(arguments[0],dn)){var H=arguments[0],re=H.size();if(re<3)return 0;var de=new Ne,De=new Ne,$e=new Ne;H.getCoordinate(0,De),H.getCoordinate(1,$e);var ct=De.x;$e.x-=ct;for(var At=0,Ht=1;Ht<re-1;Ht++)de.y=De.y,De.x=$e.x,De.y=$e.y,H.getCoordinate(Ht+1,$e),$e.x-=ct,At+=De.x*(de.y-$e.y);return At/2}}}])})(),Ze=(function(){return c((function f(){T(this,f)}),null,[{key:"sort",value:function(){var f=arguments,i=arguments[0];if(arguments.length===1)i.sort((function(ct,At){return ct.compareTo(At)}));else if(arguments.length===2)i.sort((function(ct,At){return f[1].compare(ct,At)}));else if(arguments.length===3){var s=i.slice(arguments[1],arguments[2]);s.sort();var h=i.slice(0,arguments[1]).concat(s,i.slice(arguments[2],i.length));i.splice(0,i.length);var b,R=W(h);try{for(R.s();!(b=R.n()).done;){var B=b.value;i.push(B)}}catch(ct){R.e(ct)}finally{R.f()}}else if(arguments.length===4){var H=i.slice(arguments[1],arguments[2]);H.sort((function(ct,At){return f[3].compare(ct,At)}));var re=i.slice(0,arguments[1]).concat(H,i.slice(arguments[2],i.length));i.splice(0,i.length);var de,De=W(re);try{for(De.s();!(de=De.n()).done;){var $e=de.value;i.push($e)}}catch(ct){De.e(ct)}finally{De.f()}}}},{key:"asList",value:function(f){var i,s=new pt,h=W(f);try{for(h.s();!(i=h.n()).done;){var b=i.value;s.add(b)}}catch(R){h.e(R)}finally{h.f()}return s}},{key:"copyOf",value:function(f,i){return f.slice(0,i)}}])})(),vt=c((function f(){T(this,f)})),Ut=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var s=new Array(this.getNumPoints()).fill(null),h=-1,b=this._shell.getCoordinates(),R=0;R<b.length;R++)s[++h]=b[R];for(var B=0;B<this._holes.length;B++)for(var H=this._holes[B].getCoordinates(),re=0;re<H.length;re++)s[++h]=H[re];return s}},{key:"getArea",value:function(){var s=0;s+=ut.ofRing(this._shell.getCoordinateSequence());for(var h=0;h<this._holes.length;h++)s-=ut.ofRing(this._holes[h].getCoordinateSequence());return s}},{key:"copyInternal",value:function(){for(var s=this._shell.copy(),h=new Array(this._holes.length).fill(null),b=0;b<this._holes.length;b++)h[b]=this._holes[b].copy();return new i(s,h,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var s=this._shell.getCoordinateSequence(),h=this.getEnvelopeInternal(),b=0;b<5;b++){var R=s.getX(b);if(R!==h.getMinX()&&R!==h.getMaxX())return!1;var B=s.getY(b);if(B!==h.getMinY()&&B!==h.getMaxY())return!1}for(var H=s.getX(0),re=s.getY(0),de=1;de<=4;de++){var De=s.getX(de),$e=s.getY(de);if(De!==H==($e!==re))return!1;H=De,re=$e}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Kt){var s=arguments[0],h=arguments[1];if(!this.isEquivalentClass(s))return!1;var b=s,R=this._shell,B=b._shell;if(!R.equalsExact(B,h)||this._holes.length!==b._holes.length)return!1;for(var H=0;H<this._holes.length;H++)if(!this._holes[H].equalsExact(b._holes[H],h))return!1;return!0}return le(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var s=0;s<this._holes.length;s++)this._holes[s]=this.normalized(this._holes[s],!1);Ze.sort(this._holes)}else if(arguments.length===2){var h=arguments[0],b=arguments[1];if(h.isEmpty())return null;var R=h.getCoordinateSequence(),B=oe.minCoordinateIndex(R,0,R.size()-2);oe.scroll(R,B,!0),tn.isCCW(R)===b&&oe.reverse(R)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var s=this.getExteriorRing().reverse(),h=new Array(this.getNumInteriorRing()).fill(null),b=0;b<h.length;b++)h[b]=this.getInteriorRingN(b).reverse();return this.getFactory().createPolygon(s,h)}},{key:"getTypeCode",value:function(){return Kt.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var s=0;s+=this._shell.getLength();for(var h=0;h<this._holes.length;h++)s+=this._holes[h].getLength();return s}},{key:"getNumPoints",value:function(){for(var s=this._shell.getNumPoints(),h=0;h<this._holes.length;h++)s+=this._holes[h].getNumPoints();return s}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(s,h){var b=s.copy();return this.normalize(b,h),b}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var s=arguments[0],h=this._shell,b=s._shell;return h.compareToSameClass(b)}if(arguments.length===2){var R=arguments[1],B=arguments[0],H=this._shell,re=B._shell,de=H.compareToSameClass(re,R);if(de!==0)return de;for(var De=this.getNumInteriorRing(),$e=B.getNumInteriorRing(),ct=0;ct<De&&ct<$e;){var At=this.getInteriorRingN(ct),Ht=B.getInteriorRingN(ct),ln=At.compareToSameClass(Ht,R);if(ln!==0)return ln;ct++}return ct<De?1:ct<$e?-1:0}}},{key:"apply",value:function(){if(vn(arguments[0],_e)){var s=arguments[0];this._shell.apply(s);for(var h=0;h<this._holes.length;h++)this._holes[h].apply(s)}else if(vn(arguments[0],Me)){var b=arguments[0];if(this._shell.apply(b),!b.isDone())for(var R=0;R<this._holes.length&&(this._holes[R].apply(b),!b.isDone());R++);b.isGeometryChanged()&&this.geometryChanged()}else if(vn(arguments[0],Ee))arguments[0].filter(this);else if(vn(arguments[0],tt)){var B=arguments[0];B.filter(this),this._shell.apply(B);for(var H=0;H<this._holes.length;H++)this._holes[H].apply(B)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var s=new Array(this._holes.length+1).fill(null);s[0]=this._shell;for(var h=0;h<this._holes.length;h++)s[h+1]=this._holes[h];return s.length<=1?this.getFactory().createLinearRing(s[0].getCoordinateSequence()):this.getFactory().createMultiLineString(s)}},{key:"getGeometryType",value:function(){return Kt.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(s){return this._holes[s]}},{key:"interfaces_",get:function(){return[vt]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var s=arguments[0],h=arguments[1],b=arguments[2];if(Kt.constructor_.call(this,b),s===null&&(s=this.getFactory().createLinearRing()),h===null&&(h=[]),Kt.hasNullElements(h))throw new We("holes must not contain null elements");if(s.isEmpty()&&Kt.hasNonEmptyElements(h))throw new We("shell is empty but holes are not");this._shell=s,this._holes=h}}])})(Kt),Qt=(function(f){function i(){return T(this,i),E(this,i,arguments)}return F(i,f),c(i)})(Ye),Fn=(function(f){function i(s){var h;return T(this,i),(h=E(this,i)).array=[],s instanceof $i&&h.addAll(s),h}return F(i,f),c(i,[{key:"contains",value:function(s){var h,b=W(this.array);try{for(b.s();!(h=b.n()).done;)if(h.value.compareTo(s)===0)return!0}catch(R){b.e(R)}finally{b.f()}return!1}},{key:"add",value:function(s){if(this.contains(s))return!1;for(var h=0,b=this.array.length;h<b;h++)if(this.array[h].compareTo(s)===1)return!!this.array.splice(h,0,s);return this.array.push(s),!0}},{key:"addAll",value:function(s){var h,b=W(s);try{for(b.s();!(h=b.n()).done;){var R=h.value;this.add(R)}}catch(B){b.e(B)}finally{b.f()}return!0}},{key:"remove",value:function(){throw new Rr}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new bn(this.array)}}])})(Qt),bn=(function(){return c((function f(i){T(this,f),this.array=i,this.position=0}),[{key:"next",value:function(){if(this.position===this.array.length)throw new Vr;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new Rr}}])})(),kn=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"computeEnvelopeInternal",value:function(){for(var s=new Cn,h=0;h<this._geometries.length;h++)s.expandToInclude(this._geometries[h].getEnvelopeInternal());return s}},{key:"getGeometryN",value:function(s){return this._geometries[s]}},{key:"getCoordinates",value:function(){for(var s=new Array(this.getNumPoints()).fill(null),h=-1,b=0;b<this._geometries.length;b++)for(var R=this._geometries[b].getCoordinates(),B=0;B<R.length;B++)s[++h]=R[B];return s}},{key:"getArea",value:function(){for(var s=0,h=0;h<this._geometries.length;h++)s+=this._geometries[h].getArea();return s}},{key:"copyInternal",value:function(){for(var s=new Array(this._geometries.length).fill(null),h=0;h<s.length;h++)s[h]=this._geometries[h].copy();return new i(s,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Kt){var s=arguments[0],h=arguments[1];if(!this.isEquivalentClass(s))return!1;var b=s;if(this._geometries.length!==b._geometries.length)return!1;for(var R=0;R<this._geometries.length;R++)if(!this._geometries[R].equalsExact(b._geometries[R],h))return!1;return!0}return le(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var s=0;s<this._geometries.length;s++)this._geometries[s].normalize();Ze.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var s=ae.FALSE,h=0;h<this._geometries.length;h++)s=Math.max(s,this._geometries[h].getBoundaryDimension());return s}},{key:"reverseInternal",value:function(){for(var s=this._geometries.length,h=new pt(s),b=0;b<s;b++)h.add(this._geometries[b].reverse());return this.getFactory().buildGeometry(h)}},{key:"getTypeCode",value:function(){return Kt.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var s=ae.FALSE,h=0;h<this._geometries.length;h++)s=Math.max(s,this._geometries[h].getDimension());return s}},{key:"getLength",value:function(){for(var s=0,h=0;h<this._geometries.length;h++)s+=this._geometries[h].getLength();return s}},{key:"getNumPoints",value:function(){for(var s=0,h=0;h<this._geometries.length;h++)s+=this._geometries[h].getNumPoints();return s}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var s=arguments[0],h=new Fn(Ze.asList(this._geometries)),b=new Fn(Ze.asList(s._geometries));return this.compare(h,b)}if(arguments.length===2){for(var R=arguments[1],B=arguments[0],H=this.getNumGeometries(),re=B.getNumGeometries(),de=0;de<H&&de<re;){var De=this.getGeometryN(de),$e=B.getGeometryN(de),ct=De.compareToSameClass($e,R);if(ct!==0)return ct;de++}return de<H?1:de<re?-1:0}}},{key:"apply",value:function(){if(vn(arguments[0],_e))for(var s=arguments[0],h=0;h<this._geometries.length;h++)this._geometries[h].apply(s);else if(vn(arguments[0],Me)){var b=arguments[0];if(this._geometries.length===0)return null;for(var R=0;R<this._geometries.length&&(this._geometries[R].apply(b),!b.isDone());R++);b.isGeometryChanged()&&this.geometryChanged()}else if(vn(arguments[0],Ee)){var B=arguments[0];B.filter(this);for(var H=0;H<this._geometries.length;H++)this._geometries[H].apply(B)}else if(vn(arguments[0],tt)){var re=arguments[0];re.filter(this);for(var de=0;de<this._geometries.length;de++)this._geometries[de].apply(re)}}},{key:"getBoundary",value:function(){return Kt.checkNotGeometryCollection(this),Pt.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return Kt.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var s=0;s<this._geometries.length;s++)if(!this._geometries[s].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var s=arguments[0],h=arguments[1];if(Kt.constructor_.call(this,h),s===null&&(s=[]),Kt.hasNullElements(s))throw new We("geometries must not contain null elements");this._geometries=s}}}}])})(Kt),Sn=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"copyInternal",value:function(){for(var s=new Array(this._geometries.length).fill(null),h=0;h<s.length;h++)s[h]=this._geometries[h].copy();return new i(s,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Kt){var s=arguments[0],h=arguments[1];return!!this.isEquivalentClass(s)&&le(i,"equalsExact",this,1).call(this,s,h)}return le(i,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var s=arguments[0];return this._geometries[s].getCoordinate()}return le(i,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return ae.FALSE}},{key:"getTypeCode",value:function(){return Kt.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Kt.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[ke]}}],[{key:"constructor_",value:function(){var s=arguments[0],h=arguments[1];kn.constructor_.call(this,s,h)}}])})(kn),pi=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"copyInternal",value:function(){return new i(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return ae.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||le(i,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var s=this._points.copy();return oe.reverse(s),this.getFactory().createLinearRing(s)}},{key:"getTypeCode",value:function(){return Kt.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!le(i,"isClosed",this,1).call(this))throw new We("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<i.MINIMUM_VALID_SIZE)throw new We("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return Kt.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var s=arguments[0],h=arguments[1];Fe.constructor_.call(this,s,h),this.validateConstruction()}}])})(Fe);pi.MINIMUM_VALID_SIZE=4;var ti=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"setOrdinate",value:function(s,h){switch(s){case i.X:this.x=h;break;case i.Y:this.y=h;break;default:throw new We("Invalid ordinate index: "+s)}}},{key:"getZ",value:function(){return Ne.NULL_ORDINATE}},{key:"getOrdinate",value:function(s){switch(s){case i.X:return this.x;case i.Y:return this.y}throw new We("Invalid ordinate index: "+s)}},{key:"setZ",value:function(s){throw new We("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(s){this.x=s.x,this.y=s.y,this.z=s.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)Ne.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof i){var s=arguments[0];Ne.constructor_.call(this,s.x,s.y)}else if(arguments[0]instanceof Ne){var h=arguments[0];Ne.constructor_.call(this,h.x,h.y)}}else if(arguments.length===2){var b=arguments[0],R=arguments[1];Ne.constructor_.call(this,b,R,Ne.NULL_ORDINATE)}}}])})(Ne);ti.X=0,ti.Y=1,ti.Z=-1,ti.M=-1;var xn=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(s,h){switch(s){case i.X:this.x=h;break;case i.Y:this.y=h;break;case i.M:this._m=h;break;default:throw new We("Invalid ordinate index: "+s)}}},{key:"setM",value:function(s){this._m=s}},{key:"getZ",value:function(){return Ne.NULL_ORDINATE}},{key:"getOrdinate",value:function(s){switch(s){case i.X:return this.x;case i.Y:return this.y;case i.M:return this._m}throw new We("Invalid ordinate index: "+s)}},{key:"setZ",value:function(s){throw new We("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(s){this.x=s.x,this.y=s.y,this.z=s.getZ(),this._m=s.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Ne.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof i){var s=arguments[0];Ne.constructor_.call(this,s.x,s.y),this._m=s._m}else if(arguments[0]instanceof Ne){var h=arguments[0];Ne.constructor_.call(this,h.x,h.y),this._m=this.getM()}}else if(arguments.length===3){var b=arguments[0],R=arguments[1],B=arguments[2];Ne.constructor_.call(this,b,R,Ne.NULL_ORDINATE),this._m=B}}}])})(Ne);xn.X=0,xn.Y=1,xn.Z=-1,xn.M=2;var Hn=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(s,h){switch(s){case Ne.X:this.x=h;break;case Ne.Y:this.y=h;break;case Ne.Z:this.z=h;break;case Ne.M:this._m=h;break;default:throw new We("Invalid ordinate index: "+s)}}},{key:"setM",value:function(s){this._m=s}},{key:"getOrdinate",value:function(s){switch(s){case Ne.X:return this.x;case Ne.Y:return this.y;case Ne.Z:return this.getZ();case Ne.M:return this.getM()}throw new We("Invalid ordinate index: "+s)}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(s){this.x=s.x,this.y=s.y,this.z=s.getZ(),this._m=s.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Ne.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof i){var s=arguments[0];Ne.constructor_.call(this,s),this._m=s._m}else if(arguments[0]instanceof Ne){var h=arguments[0];Ne.constructor_.call(this,h),this._m=this.getM()}}else if(arguments.length===4){var b=arguments[0],R=arguments[1],B=arguments[2],H=arguments[3];Ne.constructor_.call(this,b,R,B),this._m=H}}}])})(Ne),ri=(function(){function f(){T(this,f)}return c(f,null,[{key:"measures",value:function(i){return i instanceof ti?0:i instanceof xn||i instanceof Hn?1:0}},{key:"dimension",value:function(i){return i instanceof ti?2:i instanceof xn?3:i instanceof Hn?4:3}},{key:"create",value:function(){if(arguments.length===1){var i=arguments[0];return f.create(i,0)}if(arguments.length===2){var s=arguments[0],h=arguments[1];return s===2?new ti:s===3&&h===0?new Ne:s===3&&h===1?new xn:s===4&&h===1?new Hn:new Ne}}}])})(),Ei=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"getCoordinate",value:function(s){return this.get(s)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&vn(arguments[0],$i)){for(var s=arguments[1],h=!1,b=arguments[0].iterator();b.hasNext();)this.add(b.next(),s),h=!0;return h}return le(i,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var s=le(i,"clone",this,1).call(this),h=0;h<this.size();h++)s.add(h,this.get(h).clone());return s}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(i.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(i.coordArrayType);for(var s=this.size(),h=new Array(s).fill(null),b=0;b<s;b++)h[b]=this.get(s-b-1);return h}}},{key:"add",value:function(){if(arguments.length===1){var s=arguments[0];return le(i,"add",this,1).call(this,s)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var h=arguments[0],b=arguments[1];return this.add(h,b,!0),!0}if(arguments[0]instanceof Ne&&typeof arguments[1]=="boolean"){var R=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(R))return null;le(i,"add",this,1).call(this,R)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var B=arguments[0],H=arguments[1];return this.add(B,H),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var re=arguments[0],de=arguments[1];if(arguments[2])for(var De=0;De<re.length;De++)this.add(re[De],de);else for(var $e=re.length-1;$e>=0;$e--)this.add(re[$e],de);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Ne){var ct=arguments[0],At=arguments[1];if(!arguments[2]){var Ht=this.size();if(Ht>0&&(ct>0&&this.get(ct-1).equals2D(At)||ct<Ht&&this.get(ct).equals2D(At)))return null}le(i,"add",this,1).call(this,ct,At)}}else if(arguments.length===4){var ln=arguments[0],Nn=arguments[1],An=arguments[2],Vn=arguments[3],Ci=1;An>Vn&&(Ci=-1);for(var Kn=An;Kn!==Vn;Kn+=Ci)this.add(ln[Kn],Nn);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var s=this.get(0).copy();this.add(s,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var s=arguments[0];this.ensureCapacity(s.length),this.add(s,!0)}else if(arguments.length===2){var h=arguments[0],b=arguments[1];this.ensureCapacity(h.length),this.add(h,b)}}}}])})(pt);Ei.coordArrayType=new Array(0).fill(null);var Bn=(function(){function f(){T(this,f)}return c(f,null,[{key:"isRing",value:function(i){return!(i.length<4)&&!!i[0].equals2D(i[i.length-1])}},{key:"ptNotInList",value:function(i,s){for(var h=0;h<i.length;h++){var b=i[h];if(f.indexOf(b,s)<0)return b}return null}},{key:"scroll",value:function(i,s){var h=f.indexOf(s,i);if(h<0)return null;var b=new Array(i.length).fill(null);Si.arraycopy(i,h,b,0,i.length-h),Si.arraycopy(i,0,b,i.length-h,h),Si.arraycopy(b,0,i,0,i.length)}},{key:"equals",value:function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];if(i===s)return!0;if(i===null||s===null||i.length!==s.length)return!1;for(var h=0;h<i.length;h++)if(!i[h].equals(s[h]))return!1;return!0}if(arguments.length===3){var b=arguments[0],R=arguments[1],B=arguments[2];if(b===R)return!0;if(b===null||R===null||b.length!==R.length)return!1;for(var H=0;H<b.length;H++)if(B.compare(b[H],R[H])!==0)return!1;return!0}}},{key:"intersection",value:function(i,s){for(var h=new Ei,b=0;b<i.length;b++)s.intersects(i[b])&&h.add(i[b],!0);return h.toCoordinateArray()}},{key:"measures",value:function(i){if(i===null||i.length===0)return 0;var s,h=0,b=W(i);try{for(b.s();!(s=b.n()).done;){var R=s.value;h=Math.max(h,ri.measures(R))}}catch(B){b.e(B)}finally{b.f()}return h}},{key:"hasRepeatedPoints",value:function(i){for(var s=1;s<i.length;s++)if(i[s-1].equals(i[s]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(i){return f.hasRepeatedPoints(i)?new Ei(i,!1).toCoordinateArray():i}},{key:"reverse",value:function(i){for(var s=i.length-1,h=Math.trunc(s/2),b=0;b<=h;b++){var R=i[b];i[b]=i[s-b],i[s-b]=R}}},{key:"removeNull",value:function(i){for(var s=0,h=0;h<i.length;h++)i[h]!==null&&s++;var b=new Array(s).fill(null);if(s===0)return b;for(var R=0,B=0;B<i.length;B++)i[B]!==null&&(b[R++]=i[B]);return b}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var i=arguments[0],s=new Array(i.length).fill(null),h=0;h<i.length;h++)s[h]=i[h].copy();return s}if(arguments.length===5)for(var b=arguments[0],R=arguments[1],B=arguments[2],H=arguments[3],re=arguments[4],de=0;de<re;de++)B[H+de]=b[R+de].copy()}},{key:"isEqualReversed",value:function(i,s){for(var h=0;h<i.length;h++){var b=i[h],R=s[i.length-h-1];if(b.compareTo(R)!==0)return!1}return!0}},{key:"envelope",value:function(i){for(var s=new Cn,h=0;h<i.length;h++)s.expandToInclude(i[h]);return s}},{key:"toCoordinateArray",value:function(i){return i.toArray(f.coordArrayType)}},{key:"dimension",value:function(i){if(i===null||i.length===0)return 3;var s,h=0,b=W(i);try{for(b.s();!(s=b.n()).done;){var R=s.value;h=Math.max(h,ri.dimension(R))}}catch(B){b.e(B)}finally{b.f()}return h}},{key:"atLeastNCoordinatesOrNothing",value:function(i,s){return s.length>=i?s:[]}},{key:"indexOf",value:function(i,s){for(var h=0;h<s.length;h++)if(i.equals(s[h]))return h;return-1}},{key:"increasingDirection",value:function(i){for(var s=0;s<Math.trunc(i.length/2);s++){var h=i.length-1-s,b=i[s].compareTo(i[h]);if(b!==0)return b}return 1}},{key:"compare",value:function(i,s){for(var h=0;h<i.length&&h<s.length;){var b=i[h].compareTo(s[h]);if(b!==0)return b;h++}return h<s.length?-1:h<i.length?1:0}},{key:"minCoordinate",value:function(i){for(var s=null,h=0;h<i.length;h++)(s===null||s.compareTo(i[h])>0)&&(s=i[h]);return s}},{key:"extract",value:function(i,s,h){s=Sr.clamp(s,0,i.length);var b=(h=Sr.clamp(h,-1,i.length))-s+1;h<0&&(b=0),s>=i.length&&(b=0),h<s&&(b=0);var R=new Array(b).fill(null);if(b===0)return R;for(var B=0,H=s;H<=h;H++)R[B++]=i[H];return R}}])})(),Er=(function(){return c((function f(){T(this,f)}),[{key:"compare",value:function(f,i){var s=f,h=i;return Bn.compare(s,h)}},{key:"interfaces_",get:function(){return[Re]}}])})(),Po=(function(){return c((function f(){T(this,f)}),[{key:"compare",value:function(f,i){var s=f,h=i;if(s.length<h.length)return-1;if(s.length>h.length)return 1;if(s.length===0)return 0;var b=Bn.compare(s,h);return Bn.isEqualReversed(s,h)?0:b}},{key:"OLDcompare",value:function(f,i){var s=f,h=i;if(s.length<h.length)return-1;if(s.length>h.length)return 1;if(s.length===0)return 0;for(var b=Bn.increasingDirection(s),R=Bn.increasingDirection(h),B=b>0?0:s.length-1,H=R>0?0:s.length-1,re=0;re<s.length;re++){var de=s[B].compareTo(h[H]);if(de!==0)return de;B+=b,H+=R}return 0}},{key:"interfaces_",get:function(){return[Re]}}])})();Bn.ForwardComparator=Er,Bn.BidirectionalComparator=Po,Bn.coordArrayType=new Array(0).fill(null);var fn=(function(){return c((function f(i){T(this,f),this.str=i}),[{key:"append",value:function(f){this.str+=f}},{key:"setCharAt",value:function(f,i){this.str=this.str.substr(0,f)+i+this.str.substr(f+1)}},{key:"toString",value:function(){return this.str}}])})(),Ha=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"getM",value:function(i){return this.hasM()?this._coordinates[i].getM():nt.NaN}},{key:"setOrdinate",value:function(i,s,h){switch(s){case dn.X:this._coordinates[i].x=h;break;case dn.Y:this._coordinates[i].y=h;break;default:this._coordinates[i].setOrdinate(s,h)}}},{key:"getZ",value:function(i){return this.hasZ()?this._coordinates[i].getZ():nt.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(i,s){switch(s){case dn.X:return this._coordinates[i].x;case dn.Y:return this._coordinates[i].y;default:return this._coordinates[i].getOrdinate(s)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var i=arguments[0];return this._coordinates[i]}if(arguments.length===2){var s=arguments[0];arguments[1].setCoordinate(this._coordinates[s])}}},{key:"getCoordinateCopy",value:function(i){var s=this.createCoordinate();return s.setCoordinate(this._coordinates[i]),s}},{key:"createCoordinate",value:function(){return ri.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(i){return this._coordinates[i].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(i){for(var s=0;s<this._coordinates.length;s++)i.expandToInclude(this._coordinates[s]);return i}},{key:"copy",value:function(){for(var i=new Array(this.size()).fill(null),s=0;s<this._coordinates.length;s++){var h=this.createCoordinate();h.setCoordinate(this._coordinates[s]),i[s]=h}return new f(i,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var i=new fn(17*this._coordinates.length);i.append("("),i.append(this._coordinates[0]);for(var s=1;s<this._coordinates.length;s++)i.append(", "),i.append(this._coordinates[s]);return i.append(")"),i.toString()}return"()"}},{key:"getY",value:function(i){return this._coordinates[i].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[dn,ft]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var i=arguments[0];f.constructor_.call(this,i,Bn.dimension(i),Bn.measures(i))}else if(Number.isInteger(arguments[0])){var s=arguments[0];this._coordinates=new Array(s).fill(null);for(var h=0;h<s;h++)this._coordinates[h]=new Ne}else if(vn(arguments[0],dn)){var b=arguments[0];if(b===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=b.getDimension(),this._measures=b.getMeasures(),this._coordinates=new Array(b.size()).fill(null);for(var R=0;R<this._coordinates.length;R++)this._coordinates[R]=b.getCoordinateCopy(R)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var B=arguments[0],H=arguments[1];f.constructor_.call(this,B,H,Bn.measures(B))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var re=arguments[0],de=arguments[1];this._coordinates=new Array(re).fill(null),this._dimension=de;for(var De=0;De<re;De++)this._coordinates[De]=ri.create(de)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var $e=arguments[0],ct=arguments[1],At=arguments[2];this._dimension=ct,this._measures=At,this._coordinates=$e===null?new Array(0).fill(null):$e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Ht=arguments[0],ln=arguments[1],Nn=arguments[2];this._coordinates=new Array(Ht).fill(null),this._dimension=ln,this._measures=Nn;for(var An=0;An<Ht;An++)this._coordinates[An]=this.createCoordinate()}}}}])})(),Xa=(function(){function f(){T(this,f)}return c(f,[{key:"readResolve",value:function(){return f.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array)return new Ha(arguments[0]);if(vn(arguments[0],dn))return new Ha(arguments[0])}else{if(arguments.length===2){var i=arguments[1];return i>3&&(i=3),i<2&&(i=2),new Ha(arguments[0],i)}if(arguments.length===3){var s=arguments[2],h=arguments[1]-s;return s>1&&(s=1),h>3&&(h=3),h<2&&(h=2),new Ha(arguments[0],h+s,s)}}}},{key:"interfaces_",get:function(){return[gr,ft]}}],[{key:"instance",value:function(){return f.instanceObject}}])})();Xa.instanceObject=new Xa;var yr=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"copyInternal",value:function(){for(var s=new Array(this._geometries.length).fill(null),h=0;h<s.length;h++)s[h]=this._geometries[h].copy();return new i(s,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Kt){var s=arguments[0],h=arguments[1];return!!this.isEquivalentClass(s)&&le(i,"equalsExact",this,1).call(this,s,h)}return le(i,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return Kt.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var s=new pt,h=0;h<this._geometries.length;h++)for(var b=this._geometries[h].getBoundary(),R=0;R<b.getNumGeometries();R++)s.add(b.getGeometryN(R));var B=new Array(s.size()).fill(null);return this.getFactory().createMultiLineString(s.toArray(B))}},{key:"getGeometryType",value:function(){return Kt.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[vt]}}],[{key:"constructor_",value:function(){var s=arguments[0],h=arguments[1];kn.constructor_.call(this,s,h)}}])})(kn),rr=(function(){return c((function f(){T(this,f)}),[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}])})(),hc=(function(f){function i(){var s;return T(this,i),(s=E(this,i)).map=new Map,s}return F(i,f),c(i,[{key:"get",value:function(s){return this.map.get(s)||null}},{key:"put",value:function(s,h){return this.map.set(s,h),h}},{key:"values",value:function(){for(var s=new pt,h=this.map.values(),b=h.next();!b.done;)s.add(b.value),b=h.next();return s}},{key:"entrySet",value:function(){var s=new ds;return this.map.entries().forEach((function(h){return s.add(h)})),s}},{key:"size",value:function(){return this.map.size()}}])})(rr),Ii=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"equals",value:function(i){if(!(i instanceof f))return!1;var s=i;return this._modelType===s._modelType&&this._scale===s._scale}},{key:"compareTo",value:function(i){var s=i,h=this.getMaximumSignificantDigits(),b=s.getMaximumSignificantDigits();return aa.compare(h,b)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===f.FLOATING||this._modelType===f.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var i="UNKNOWN";return this._modelType===f.FLOATING?i="Floating":this._modelType===f.FLOATING_SINGLE?i="Floating-Single":this._modelType===f.FIXED&&(i="Fixed (Scale="+this.getScale()+")"),i}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var i=arguments[0];return nt.isNaN(i)||this._modelType===f.FLOATING_SINGLE?i:this._modelType===f.FIXED?Math.round(i*this._scale)/this._scale:i}if(arguments[0]instanceof Ne){var s=arguments[0];if(this._modelType===f.FLOATING)return null;s.x=this.makePrecise(s.x),s.y=this.makePrecise(s.y)}}},{key:"getMaximumSignificantDigits",value:function(){var i=16;return this._modelType===f.FLOATING?i=16:this._modelType===f.FLOATING_SINGLE?i=6:this._modelType===f.FIXED&&(i=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),i}},{key:"setScale",value:function(i){this._scale=Math.abs(i)}},{key:"interfaces_",get:function(){return[ft,at]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=f.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Bi){var i=arguments[0];this._modelType=i,i===f.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var s=arguments[0];this._modelType=f.FIXED,this.setScale(s)}else if(arguments[0]instanceof f){var h=arguments[0];this._modelType=h._modelType,this._scale=h._scale}}}},{key:"mostPrecise",value:function(i,s){return i.compareTo(s)>=0?i:s}}])})(),Bi=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"readResolve",value:function(){return f.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[ft]}}],[{key:"constructor_",value:function(){this._name=null;var i=arguments[0];this._name=i,f.nameToTypeMap.put(i,this)}}])})();Bi.nameToTypeMap=new hc,Ii.Type=Bi,Ii.FIXED=new Bi("FIXED"),Ii.FLOATING=new Bi("FLOATING"),Ii.FLOATING_SINGLE=new Bi("FLOATING SINGLE"),Ii.maximumPreciseValue=9007199254740992;var sr=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"copyInternal",value:function(){for(var s=new Array(this._geometries.length).fill(null),h=0;h<s.length;h++)s[h]=this._geometries[h].copy();return new i(s,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Kt){var s=arguments[0],h=arguments[1];return!!this.isEquivalentClass(s)&&le(i,"equalsExact",this,1).call(this,s,h)}return le(i,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?ae.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var s=0;s<this._geometries.length;s++)if(!this._geometries[s].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return Kt.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new Rr}},{key:"getGeometryType",value:function(){return Kt.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[Y]}}],[{key:"constructor_",value:function(){var s=arguments[0],h=arguments[1];kn.constructor_.call(this,s,h)}}])})(kn),Qr=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"createEmpty",value:function(i){switch(i){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new We("Invalid dimension: "+i)}}},{key:"toGeometry",value:function(i){return i.isNull()?this.createPoint():i.getMinX()===i.getMaxX()&&i.getMinY()===i.getMaxY()?this.createPoint(new Ne(i.getMinX(),i.getMinY())):i.getMinX()===i.getMaxX()||i.getMinY()===i.getMaxY()?this.createLineString([new Ne(i.getMinX(),i.getMinY()),new Ne(i.getMaxX(),i.getMaxY())]):this.createPolygon(this.createLinearRing([new Ne(i.getMinX(),i.getMinY()),new Ne(i.getMinX(),i.getMaxY()),new Ne(i.getMaxX(),i.getMaxY()),new Ne(i.getMaxX(),i.getMinY()),new Ne(i.getMinX(),i.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var i=arguments[0];return this.createLineString(i!==null?this.getCoordinateSequenceFactory().create(i):null)}if(vn(arguments[0],dn))return new Fe(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return arguments.length===0?new sr(null,this):arguments.length===1?new sr(arguments[0],this):void 0}},{key:"buildGeometry",value:function(i){for(var s=null,h=!1,b=!1,R=i.iterator();R.hasNext();){var B=R.next(),H=B.getTypeCode();s===null&&(s=H),H!==s&&(h=!0),B instanceof kn&&(b=!0)}if(s===null)return this.createGeometryCollection();if(h||b)return this.createGeometryCollection(f.toGeometryArray(i));var re=i.iterator().next();if(i.size()>1){if(re instanceof Ut)return this.createMultiPolygon(f.toPolygonArray(i));if(re instanceof Fe)return this.createMultiLineString(f.toLineStringArray(i));if(re instanceof Ke)return this.createMultiPoint(f.toPointArray(i));Pt.shouldNeverReachHere("Unhandled geometry type: "+re.getGeometryType())}return re}},{key:"createMultiPointFromCoords",value:function(i){return this.createMultiPoint(i!==null?this.getCoordinateSequenceFactory().create(i):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Ne){var i=arguments[0];return this.createPoint(i!==null?this.getCoordinateSequenceFactory().create([i]):null)}if(vn(arguments[0],dn))return new Ke(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(vn(arguments[0],dn)){var i=arguments[0];return this.createPolygon(this.createLinearRing(i))}if(arguments[0]instanceof Array){var s=arguments[0];return this.createPolygon(this.createLinearRing(s))}if(arguments[0]instanceof pi){var h=arguments[0];return this.createPolygon(h,null)}}else if(arguments.length===2)return new Ut(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return arguments.length===0?new kn(null,this):arguments.length===1?new kn(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var i=arguments[0];return this.createLinearRing(i!==null?this.getCoordinateSequenceFactory().create(i):null)}if(vn(arguments[0],dn))return new pi(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return arguments.length===0?new yr(null,this):arguments.length===1?new yr(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new Sn(null,this);if(arguments.length===1){if(arguments[0]instanceof Array)return new Sn(arguments[0],this);if(vn(arguments[0],dn)){var i=arguments[0];if(i===null)return this.createMultiPoint(new Array(0).fill(null));for(var s=new Array(i.size()).fill(null),h=0;h<i.size();h++){var b=this.getCoordinateSequenceFactory().create(1,i.getDimension(),i.getMeasures());oe.copy(i,h,b,0,1),s[h]=this.createPoint(b)}return this.createMultiPoint(s)}}}},{key:"interfaces_",get:function(){return[ft]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)f.constructor_.call(this,new Ii,0);else if(arguments.length===1){if(vn(arguments[0],gr)){var i=arguments[0];f.constructor_.call(this,new Ii,0,i)}else if(arguments[0]instanceof Ii){var s=arguments[0];f.constructor_.call(this,s,0,f.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var h=arguments[0],b=arguments[1];f.constructor_.call(this,h,b,f.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var R=arguments[0],B=arguments[1],H=arguments[2];this._precisionModel=R,this._coordinateSequenceFactory=H,this._SRID=B}}},{key:"toMultiPolygonArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toGeometryArray",value:function(i){if(i===null)return null;var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return Xa.instance()}},{key:"toMultiLineStringArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toLineStringArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toMultiPointArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toLinearRingArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toPointArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toPolygonArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"createPointFromInternalCoord",value:function(i,s){return s.getPrecisionModel().makePrecise(i),s.getFactory().createPoint(i)}}])})(),Wn="XY",Xo="XYZ",ms="XYM",ji="XYZM",La={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},Ir="EMPTY",Ls=1,Li=2,Ra=3,Wo=4,Nr=5,la=6;for(var Un in La)La[Un].toUpperCase();var Wa=(function(){return c((function f(i){T(this,f),this.wkt=i,this.index_=-1}),[{key:"isAlpha_",value:function(f){return f>="a"&&f<="z"||f>="A"&&f<="Z"}},{key:"isNumeric_",value:function(f,i){return f>="0"&&f<="9"||f=="."&&!(i!==void 0&&i)}},{key:"isWhiteSpace_",value:function(f){return f==" "||f=="	"||f=="\r"||f==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var f,i=this.nextChar_(),s=this.index_,h=i;if(i=="(")f=Li;else if(i==",")f=Nr;else if(i==")")f=Ra;else if(this.isNumeric_(i)||i=="-")f=Wo,h=this.readNumber_();else if(this.isAlpha_(i))f=Ls,h=this.readText_();else{if(this.isWhiteSpace_(i))return this.nextToken();if(i!=="")throw new Error("Unexpected character: "+i);f=la}return{position:s,value:h,type:f}}},{key:"readNumber_",value:function(){var f,i=this.index_,s=!1,h=!1;do f=="."?s=!0:f!="e"&&f!="E"||(h=!0),f=this.nextChar_();while(this.isNumeric_(f,s)||!h&&(f=="e"||f=="E")||h&&(f=="-"||f=="+"));return parseFloat(this.wkt.substring(i,this.index_--))}},{key:"readText_",value:function(){var f,i=this.index_;do f=this.nextChar_();while(this.isAlpha_(f));return this.wkt.substring(i,this.index_--).toUpperCase()}}])})(),au=(function(){return c((function f(i,s){T(this,f),this.lexer_=i,this.token_,this.layout_=Wn,this.factory=s}),[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(f){return this.token_.type==f}},{key:"match",value:function(f){var i=this.isTokenType(f);return i&&this.consume_(),i}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var f=Wn,i=this.token_;if(this.isTokenType(Ls)){var s=i.value;s==="Z"?f=Xo:s==="M"?f=ms:s==="ZM"&&(f=ji),f!==Wn&&this.consume_()}return f}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(Li)){var f=[];do f.push(this.parseGeometry_());while(this.match(Nr));if(this.match(Ra))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(Li)){var f=this.parsePoint_();if(this.match(Ra))return f}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(Li)){var f=this.parsePointList_();if(this.match(Ra))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(Li)){var f=this.parseLineStringTextList_();if(this.match(Ra))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var f;if(this.match(Li)){if(f=this.token_.type==Li?this.parsePointTextList_():this.parsePointList_(),this.match(Ra))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(Li)){var f=this.parseLineStringTextList_();if(this.match(Ra))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(Li)){var f=this.parsePolygonTextList_();if(this.match(Ra))return f}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var f=[],i=this.layout_.length,s=0;s<i;++s){var h=this.token_;if(!this.match(Wo))break;f.push(h.value)}if(f.length==i)return f;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var f=[this.parsePoint_()];this.match(Nr);)f.push(this.parsePoint_());return f}},{key:"parsePointTextList_",value:function(){for(var f=[this.parsePointText_()];this.match(Nr);)f.push(this.parsePointText_());return f}},{key:"parseLineStringTextList_",value:function(){for(var f=[this.parseLineStringText_()];this.match(Nr);)f.push(this.parseLineStringText_());return f}},{key:"parsePolygonTextList_",value:function(){for(var f=[this.parsePolygonText_()];this.match(Nr);)f.push(this.parsePolygonText_());return f}},{key:"isEmptyGeometry_",value:function(){var f=this.isTokenType(Ls)&&this.token_.value==Ir;return f&&this.consume_(),f}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var f=this.factory,i=function(ln){return N(Ne,fe(ln))},s=function(ln){var Nn=ln.map((function(An){return f.createLinearRing(An.map(i))}));return Nn.length>1?f.createPolygon(Nn[0],Nn.slice(1)):f.createPolygon(Nn[0])},h=this.token_;if(this.match(Ls)){var b=h.value;if(this.layout_=this.parseGeometryLayout_(),b=="GEOMETRYCOLLECTION"){var R=this.parseGeometryCollectionText_();return f.createGeometryCollection(R)}switch(b){case"POINT":var B=this.parsePointText_();return B?f.createPoint(N(Ne,fe(B))):f.createPoint();case"LINESTRING":var H=this.parseLineStringText_().map(i);return f.createLineString(H);case"LINEARRING":var re=this.parseLineStringText_().map(i);return f.createLinearRing(re);case"POLYGON":var de=this.parsePolygonText_();return de&&de.length!==0?s(de):f.createPolygon();case"MULTIPOINT":var De=this.parseMultiPointText_();if(!De||De.length===0)return f.createMultiPoint();var $e=De.map(i).map((function(ln){return f.createPoint(ln)}));return f.createMultiPoint($e);case"MULTILINESTRING":var ct=this.parseMultiLineStringText_().map((function(ln){return f.createLineString(ln.map(i))}));return f.createMultiLineString(ct);case"MULTIPOLYGON":var At=this.parseMultiPolygonText_();if(!At||At.length===0)return f.createMultiPolygon();var Ht=At.map(s);return f.createMultiPolygon(Ht);default:throw new Error("Invalid geometry type: "+b)}}throw new Error(this.formatErrorMessage_())}}])})();function ua(f){if(f.isEmpty())return"";var i=f.getCoordinate(),s=[i.x,i.y];return i.z===void 0||Number.isNaN(i.z)||s.push(i.z),i.m===void 0||Number.isNaN(i.m)||s.push(i.m),s.join(" ")}function qn(f){for(var i=f.getCoordinates().map((function(R){var B=[R.x,R.y];return R.z===void 0||Number.isNaN(R.z)||B.push(R.z),R.m===void 0||Number.isNaN(R.m)||B.push(R.m),B})),s=[],h=0,b=i.length;h<b;++h)s.push(i[h].join(" "));return s.join(", ")}function Mo(f){var i=[];i.push("("+qn(f.getExteriorRing())+")");for(var s=0,h=f.getNumInteriorRing();s<h;++s)i.push("("+qn(f.getInteriorRingN(s))+")");return i.join(", ")}var Ao={Point:ua,LineString:qn,LinearRing:qn,Polygon:Mo,MultiPoint:function(f){for(var i=[],s=0,h=f.getNumGeometries();s<h;++s)i.push("("+ua(f.getGeometryN(s))+")");return i.join(", ")},MultiLineString:function(f){for(var i=[],s=0,h=f.getNumGeometries();s<h;++s)i.push("("+qn(f.getGeometryN(s))+")");return i.join(", ")},MultiPolygon:function(f){for(var i=[],s=0,h=f.getNumGeometries();s<h;++s)i.push("("+Mo(f.getGeometryN(s))+")");return i.join(", ")},GeometryCollection:function(f){for(var i=[],s=0,h=f.getNumGeometries();s<h;++s)i.push(Ya(f.getGeometryN(s)));return i.join(", ")}};function Ya(f){var i=f.getGeometryType(),s=Ao[i];i=i.toUpperCase();var h=(function(b){var R="";if(b.isEmpty())return R;var B=b.getCoordinate();return B.z===void 0||Number.isNaN(B.z)||(R+="Z"),B.m===void 0||Number.isNaN(B.m)||(R+="M"),R})(f);return h.length>0&&(i+=" "+h),f.isEmpty()?i+" "+Ir:i+" ("+s(f)+")"}var Ka=(function(){return c((function f(i){T(this,f),this.geometryFactory=i||new Qr,this.precisionModel=this.geometryFactory.getPrecisionModel()}),[{key:"read",value:function(f){var i=new Wa(f);return new au(i,this.geometryFactory).parse()}},{key:"write",value:function(f){return Ya(f)}}])})(),Yo=(function(){return c((function f(i){T(this,f),this.parser=new Ka(i)}),[{key:"write",value:function(f){return this.parser.write(f)}}],[{key:"toLineString",value:function(f,i){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+f.x+" "+f.y+", "+i.x+" "+i.y+" )"}}])})(),mi=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"getIndexAlongSegment",value:function(i,s){return this.computeIntLineIndex(),this._intLineIndex[i][s]}},{key:"getTopologySummary",value:function(){var i=new fn;return this.isEndPoint()&&i.append(" endpoint"),this._isProper&&i.append(" proper"),this.isCollinear()&&i.append(" collinear"),i.toString()}},{key:"computeIntersection",value:function(i,s,h,b){this._inputLines[0][0]=i,this._inputLines[0][1]=s,this._inputLines[1][0]=h,this._inputLines[1][1]=b,this._result=this.computeIntersect(i,s,h,b)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var i=arguments[0];this.getEdgeDistance(i,0)>this.getEdgeDistance(i,1)?(this._intLineIndex[i][0]=0,this._intLineIndex[i][1]=1):(this._intLineIndex[i][0]=1,this._intLineIndex[i][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(i){this._precisionModel=i}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var i=arguments[0],s=0;s<this._result;s++)if(!this._intPt[s].equals2D(this._inputLines[i][0])&&!this._intPt[s].equals2D(this._inputLines[i][1]))return!0;return!1}}},{key:"getIntersection",value:function(i){return this._intPt[i]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==f.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(i,s){return f.computeEdgeDistance(this._intPt[s],this._inputLines[i][0],this._inputLines[i][1])}},{key:"isCollinear",value:function(){return this._result===f.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return Yo.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Yo.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(i,s){return this._inputLines[i][s]}},{key:"isIntersection",value:function(i){for(var s=0;s<this._result;s++)if(this._intPt[s].equals2D(i))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(i,s){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[i][s]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Ne,this._intPt[1]=new Ne,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(i,s,h){var b=Math.abs(h.x-s.x),R=Math.abs(h.y-s.y),B=-1;if(i.equals(s))B=0;else if(i.equals(h))B=b>R?b:R;else{var H=Math.abs(i.x-s.x),re=Math.abs(i.y-s.y);(B=b>R?H:re)!==0||i.equals(s)||(B=Math.max(H,re))}return Pt.isTrue(!(B===0&&!i.equals(s)),"Bad distance calculation"),B}},{key:"nonRobustComputeEdgeDistance",value:function(i,s,h){var b=i.x-s.x,R=i.y-s.y,B=Math.sqrt(b*b+R*R);return Pt.isTrue(!(B===0&&!i.equals(s)),"Invalid distance calculation"),B}}])})();mi.DONT_INTERSECT=0,mi.DO_INTERSECT=1,mi.COLLINEAR=2,mi.NO_INTERSECTION=0,mi.POINT_INTERSECTION=1,mi.COLLINEAR_INTERSECTION=2;var Rs=(function(f){function i(){return T(this,i),E(this,i)}return F(i,f),c(i,[{key:"isInSegmentEnvelopes",value:function(s){var h=new Cn(this._inputLines[0][0],this._inputLines[0][1]),b=new Cn(this._inputLines[1][0],this._inputLines[1][1]);return h.contains(s)&&b.contains(s)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return le(i,"computeIntersection",this,1).apply(this,arguments);var s=arguments[0],h=arguments[1],b=arguments[2];if(this._isProper=!1,Cn.intersects(h,b,s)&&tn.index(h,b,s)===0&&tn.index(b,h,s)===0)return this._isProper=!0,(s.equals(h)||s.equals(b))&&(this._isProper=!1),this._result=mi.POINT_INTERSECTION,null;this._result=mi.NO_INTERSECTION}},{key:"intersection",value:function(s,h,b,R){var B=this.intersectionSafe(s,h,b,R);return this.isInSegmentEnvelopes(B)||(B=new Ne(i.nearestEndpoint(s,h,b,R))),this._precisionModel!==null&&this._precisionModel.makePrecise(B),B}},{key:"checkDD",value:function(s,h,b,R,B){var H=Ur.intersection(s,h,b,R),re=this.isInSegmentEnvelopes(H);Si.out.println("DD in env = "+re+"  --------------------- "+H),B.distance(H)>1e-4&&Si.out.println("Distance = "+B.distance(H))}},{key:"intersectionSafe",value:function(s,h,b,R){var B=pn.intersection(s,h,b,R);return B===null&&(B=i.nearestEndpoint(s,h,b,R)),B}},{key:"computeCollinearIntersection",value:function(s,h,b,R){var B=Cn.intersects(s,h,b),H=Cn.intersects(s,h,R),re=Cn.intersects(b,R,s),de=Cn.intersects(b,R,h);return B&&H?(this._intPt[0]=b,this._intPt[1]=R,mi.COLLINEAR_INTERSECTION):re&&de?(this._intPt[0]=s,this._intPt[1]=h,mi.COLLINEAR_INTERSECTION):B&&re?(this._intPt[0]=b,this._intPt[1]=s,!b.equals(s)||H||de?mi.COLLINEAR_INTERSECTION:mi.POINT_INTERSECTION):B&&de?(this._intPt[0]=b,this._intPt[1]=h,!b.equals(h)||H||re?mi.COLLINEAR_INTERSECTION:mi.POINT_INTERSECTION):H&&re?(this._intPt[0]=R,this._intPt[1]=s,!R.equals(s)||B||de?mi.COLLINEAR_INTERSECTION:mi.POINT_INTERSECTION):H&&de?(this._intPt[0]=R,this._intPt[1]=h,!R.equals(h)||B||re?mi.COLLINEAR_INTERSECTION:mi.POINT_INTERSECTION):mi.NO_INTERSECTION}},{key:"computeIntersect",value:function(s,h,b,R){if(this._isProper=!1,!Cn.intersects(s,h,b,R))return mi.NO_INTERSECTION;var B=tn.index(s,h,b),H=tn.index(s,h,R);if(B>0&&H>0||B<0&&H<0)return mi.NO_INTERSECTION;var re=tn.index(b,R,s),de=tn.index(b,R,h);return re>0&&de>0||re<0&&de<0?mi.NO_INTERSECTION:B===0&&H===0&&re===0&&de===0?this.computeCollinearIntersection(s,h,b,R):(B===0||H===0||re===0||de===0?(this._isProper=!1,s.equals2D(b)||s.equals2D(R)?this._intPt[0]=s:h.equals2D(b)||h.equals2D(R)?this._intPt[0]=h:B===0?this._intPt[0]=new Ne(b):H===0?this._intPt[0]=new Ne(R):re===0?this._intPt[0]=new Ne(s):de===0&&(this._intPt[0]=new Ne(h))):(this._isProper=!0,this._intPt[0]=this.intersection(s,h,b,R)),mi.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(s,h,b,R){var B=s,H=Ai.pointToSegment(s,b,R),re=Ai.pointToSegment(h,b,R);return re<H&&(H=re,B=h),(re=Ai.pointToSegment(b,s,h))<H&&(H=re,B=b),(re=Ai.pointToSegment(R,s,h))<H&&(H=re,B=R),B}}])})(mi),yl=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"countSegment",value:function(i,s){if(i.x<this._p.x&&s.x<this._p.x)return null;if(this._p.x===s.x&&this._p.y===s.y)return this._isPointOnSegment=!0,null;if(i.y===this._p.y&&s.y===this._p.y){var h=i.x,b=s.x;return h>b&&(h=s.x,b=i.x),this._p.x>=h&&this._p.x<=b&&(this._isPointOnSegment=!0),null}if(i.y>this._p.y&&s.y<=this._p.y||s.y>this._p.y&&i.y<=this._p.y){var R=tn.index(i,s,this._p);if(R===tn.COLLINEAR)return this._isPointOnSegment=!0,null;s.y<i.y&&(R=-R),R===tn.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==we.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?we.BOUNDARY:this._crossingCount%2==1?we.INTERIOR:we.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var i=arguments[0];this._p=i}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof Ne&&vn(arguments[1],dn)){for(var i=arguments[1],s=new f(arguments[0]),h=new Ne,b=new Ne,R=1;R<i.size();R++)if(i.getCoordinate(R,h),i.getCoordinate(R-1,b),s.countSegment(h,b),s.isOnSegment())return s.getLocation();return s.getLocation()}if(arguments[0]instanceof Ne&&arguments[1]instanceof Array){for(var B=arguments[1],H=new f(arguments[0]),re=1;re<B.length;re++){var de=B[re],De=B[re-1];if(H.countSegment(de,De),H.isOnSegment())return H.getLocation()}return H.getLocation()}}}])})(),_r=(function(){function f(){T(this,f)}return c(f,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof Ne&&vn(arguments[1],dn)){for(var i=arguments[0],s=arguments[1],h=new Rs,b=new Ne,R=new Ne,B=s.size(),H=1;H<B;H++)if(s.getCoordinate(H-1,b),s.getCoordinate(H,R),h.computeIntersection(i,b,R),h.hasIntersection())return!0;return!1}if(arguments[0]instanceof Ne&&arguments[1]instanceof Array){for(var re=arguments[0],de=arguments[1],De=new Rs,$e=1;$e<de.length;$e++){var ct=de[$e-1],At=de[$e];if(De.computeIntersection(re,ct,At),De.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(i,s){return yl.locatePointInRing(i,s)}},{key:"isInRing",value:function(i,s){return f.locateInRing(i,s)!==we.EXTERIOR}}])})(),Ti=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"setAllLocations",value:function(i){for(var s=0;s<this.location.length;s++)this.location[s]=i}},{key:"isNull",value:function(){for(var i=0;i<this.location.length;i++)if(this.location[i]!==we.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(i){for(var s=0;s<this.location.length;s++)this.location[s]===we.NONE&&(this.location[s]=i)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(i){if(i.location.length>this.location.length){var s=new Array(3).fill(null);s[lt.ON]=this.location[lt.ON],s[lt.LEFT]=we.NONE,s[lt.RIGHT]=we.NONE,this.location=s}for(var h=0;h<this.location.length;h++)this.location[h]===we.NONE&&h<i.location.length&&(this.location[h]=i.location[h])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var i=this.location[lt.LEFT];this.location[lt.LEFT]=this.location[lt.RIGHT],this.location[lt.RIGHT]=i}},{key:"toString",value:function(){var i=new ir;return this.location.length>1&&i.append(we.toLocationSymbol(this.location[lt.LEFT])),i.append(we.toLocationSymbol(this.location[lt.ON])),this.location.length>1&&i.append(we.toLocationSymbol(this.location[lt.RIGHT])),i.toString()}},{key:"setLocations",value:function(i,s,h){this.location[lt.ON]=i,this.location[lt.LEFT]=s,this.location[lt.RIGHT]=h}},{key:"get",value:function(i){return i<this.location.length?this.location[i]:we.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var i=0;i<this.location.length;i++)if(this.location[i]===we.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var i=arguments[0];this.setLocation(lt.ON,i)}else if(arguments.length===2){var s=arguments[0],h=arguments[1];this.location[s]=h}}},{key:"init",value:function(i){this.location=new Array(i).fill(null),this.setAllLocations(we.NONE)}},{key:"isEqualOnSide",value:function(i,s){return this.location[s]===i.location[s]}},{key:"allPositionsEqual",value:function(i){for(var s=0;s<this.location.length;s++)if(this.location[s]!==i)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var i=arguments[0];this.init(i.length)}else if(Number.isInteger(arguments[0])){var s=arguments[0];this.init(1),this.location[lt.ON]=s}else if(arguments[0]instanceof f){var h=arguments[0];if(this.init(h.location.length),h!==null)for(var b=0;b<this.location.length;b++)this.location[b]=h.location[b]}}else if(arguments.length===3){var R=arguments[0],B=arguments[1],H=arguments[2];this.init(3),this.location[lt.ON]=R,this.location[lt.LEFT]=B,this.location[lt.RIGHT]=H}}}])})(),Yn=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"getGeometryCount",value:function(){var i=0;return this.elt[0].isNull()||i++,this.elt[1].isNull()||i++,i}},{key:"setAllLocations",value:function(i,s){this.elt[i].setAllLocations(s)}},{key:"isNull",value:function(i){return this.elt[i].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var i=arguments[0];this.setAllLocationsIfNull(0,i),this.setAllLocationsIfNull(1,i)}else if(arguments.length===2){var s=arguments[0],h=arguments[1];this.elt[s].setAllLocationsIfNull(h)}}},{key:"isLine",value:function(i){return this.elt[i].isLine()}},{key:"merge",value:function(i){for(var s=0;s<2;s++)this.elt[s]===null&&i.elt[s]!==null?this.elt[s]=new Ti(i.elt[s]):this.elt[s].merge(i.elt[s])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var i=arguments[0];return this.elt[i].get(lt.ON)}if(arguments.length===2){var s=arguments[0],h=arguments[1];return this.elt[s].get(h)}}},{key:"toString",value:function(){var i=new ir;return this.elt[0]!==null&&(i.append("A:"),i.append(this.elt[0].toString())),this.elt[1]!==null&&(i.append(" B:"),i.append(this.elt[1].toString())),i.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var i=arguments[0];return this.elt[i].isArea()}}},{key:"isAnyNull",value:function(i){return this.elt[i].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];this.elt[i].setLocation(lt.ON,s)}else if(arguments.length===3){var h=arguments[0],b=arguments[1],R=arguments[2];this.elt[h].setLocation(b,R)}}},{key:"isEqualOnSide",value:function(i,s){return this.elt[0].isEqualOnSide(i.elt[0],s)&&this.elt[1].isEqualOnSide(i.elt[1],s)}},{key:"allPositionsEqual",value:function(i,s){return this.elt[i].allPositionsEqual(s)}},{key:"toLine",value:function(i){this.elt[i].isArea()&&(this.elt[i]=new Ti(this.elt[i].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var i=arguments[0];this.elt[0]=new Ti(i),this.elt[1]=new Ti(i)}else if(arguments[0]instanceof f){var s=arguments[0];this.elt[0]=new Ti(s.elt[0]),this.elt[1]=new Ti(s.elt[1])}}else if(arguments.length===2){var h=arguments[0],b=arguments[1];this.elt[0]=new Ti(we.NONE),this.elt[1]=new Ti(we.NONE),this.elt[h].setLocation(b)}else if(arguments.length===3){var R=arguments[0],B=arguments[1],H=arguments[2];this.elt[0]=new Ti(R,B,H),this.elt[1]=new Ti(R,B,H)}else if(arguments.length===4){var re=arguments[0],de=arguments[1],De=arguments[2],$e=arguments[3];this.elt[0]=new Ti(we.NONE,we.NONE,we.NONE),this.elt[1]=new Ti(we.NONE,we.NONE,we.NONE),this.elt[re].setLocations(de,De,$e)}}},{key:"toLineLabel",value:function(i){for(var s=new f(we.NONE),h=0;h<2;h++)s.setLocation(h,i.getLocation(h));return s}}])})(),Vi=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var f=new Array(this._pts.size()).fill(null),i=0;i<this._pts.size();i++)f[i]=this._pts.get(i);this._ring=this._geometryFactory.createLinearRing(f),this._isHole=tn.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(f){this._startDe=f;var i=f,s=!0;do{if(i===null)throw new _t("Found null DirectedEdge");if(i.getEdgeRing()===this)throw new _t("Directed Edge visited twice during ring-building at "+i.getCoordinate());this._edges.add(i);var h=i.getLabel();Pt.isTrue(h.isArea()),this.mergeLabel(h),this.addPoints(i.getEdge(),i.isForward(),s),s=!1,this.setEdgeRing(i,this),i=this.getNext(i)}while(i!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(f){return this._pts.get(f)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var f=this._startDe;do{var i=f.getNode().getEdges().getOutgoingDegree(this);i>this._maxNodeDegree&&(this._maxNodeDegree=i),f=this.getNext(f)}while(f!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(f,i,s){var h=f.getCoordinates();if(i){var b=1;s&&(b=0);for(var R=b;R<h.length;R++)this._pts.add(h[R])}else{var B=h.length-2;s&&(B=h.length-1);for(var H=B;H>=0;H--)this._pts.add(h[H])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var f=this._startDe;do f.getEdge().setInResult(!0),f=f.getNext();while(f!==this._startDe)}},{key:"containsPoint",value:function(f){var i=this.getLinearRing();if(!i.getEnvelopeInternal().contains(f)||!_r.isInRing(f,i.getCoordinates()))return!1;for(var s=this._holes.iterator();s.hasNext();)if(s.next().containsPoint(f))return!1;return!0}},{key:"addHole",value:function(f){this._holes.add(f)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var f=arguments[0];this.mergeLabel(f,0),this.mergeLabel(f,1)}else if(arguments.length===2){var i=arguments[1],s=arguments[0].getLocation(i,lt.RIGHT);if(s===we.NONE)return null;if(this._label.getLocation(i)===we.NONE)return this._label.setLocation(i,s),null}}},{key:"setShell",value:function(f){this._shell=f,f!==null&&f.addHole(this)}},{key:"toPolygon",value:function(f){for(var i=new Array(this._holes.size()).fill(null),s=0;s<this._holes.size();s++)i[s]=this._holes.get(s).getLinearRing();return f.createPolygon(this.getLinearRing(),i)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new pt,this._pts=new pt,this._label=new Yn(we.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new pt,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var f=arguments[0],i=arguments[1];this._geometryFactory=i,this.computePoints(f),this.computeRing()}}}}])})(),Na=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"setEdgeRing",value:function(s,h){s.setMinEdgeRing(h)}},{key:"getNext",value:function(s){return s.getNextMin()}}],[{key:"constructor_",value:function(){var s=arguments[0],h=arguments[1];Vi.constructor_.call(this,s,h)}}])})(Vi),gs=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"buildMinimalRings",value:function(){var s=new pt,h=this._startDe;do{if(h.getMinEdgeRing()===null){var b=new Na(h,this._geometryFactory);s.add(b)}h=h.getNext()}while(h!==this._startDe);return s}},{key:"setEdgeRing",value:function(s,h){s.setEdgeRing(h)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var s=this._startDe;do s.getNode().getEdges().linkMinimalDirectedEdges(this),s=s.getNext();while(s!==this._startDe)}},{key:"getNext",value:function(s){return s.getNext()}}],[{key:"constructor_",value:function(){var s=arguments[0],h=arguments[1];Vi.constructor_.call(this,s,h)}}])})(Vi),Ko=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"setVisited",value:function(f){this._isVisited=f}},{key:"setInResult",value:function(f){this._isInResult=f}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(f){this._label=f}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(f){this._isCovered=f,this._isCoveredSet=!0}},{key:"updateIM",value:function(f){Pt.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(f)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var f=arguments[0];this._label=f}}}}])})(),Lo=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"isIncidentEdgeInResult",value:function(){for(var s=this.getEdges().getEdges().iterator();s.hasNext();)if(s.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(s){s.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(s){}},{key:"computeMergedLocation",value:function(s,h){var b=we.NONE;if(b=this._label.getLocation(h),!s.isNull(h)){var R=s.getLocation(h);b!==we.BOUNDARY&&(b=R)}return b}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return le(i,"setLabel",this,1).apply(this,arguments);var s=arguments[0],h=arguments[1];this._label===null?this._label=new Yn(s,h):this._label.setLocation(s,h)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof i){var s=arguments[0];this.mergeLabel(s._label)}else if(arguments[0]instanceof Yn)for(var h=arguments[0],b=0;b<2;b++){var R=this.computeMergedLocation(h,b);this._label.getLocation(b)===we.NONE&&this._label.setLocation(b,R)}}},{key:"add",value:function(s){this._edges.insert(s),s.setNode(this)}},{key:"setLabelBoundary",value:function(s){if(this._label===null)return null;var h=we.NONE;this._label!==null&&(h=this._label.getLocation(s));var b=null;switch(h){case we.BOUNDARY:b=we.INTERIOR;break;case we.INTERIOR:default:b=we.BOUNDARY}this._label.setLocation(s,b)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var s=arguments[0],h=arguments[1];this._coord=s,this._edges=h,this._label=new Yn(0,we.NONE)}}])})(Ko),Ns=(function(f){function i(){return T(this,i),E(this,i,arguments)}return F(i,f),c(i)})(rr);function Lu(f){return f==null?0:f.color}function Xn(f){return f==null?null:f.parent}function zr(f,i){f!==null&&(f.color=i)}function _l(f){return f==null?null:f.left}function Ru(f){return f==null?null:f.right}var zs=(function(f){function i(){var s;return T(this,i),(s=E(this,i)).root_=null,s.size_=0,s}return F(i,f),c(i,[{key:"get",value:function(s){for(var h=this.root_;h!==null;){var b=s.compareTo(h.key);if(b<0)h=h.left;else{if(!(b>0))return h.value;h=h.right}}return null}},{key:"put",value:function(s,h){if(this.root_===null)return this.root_={key:s,value:h,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var b,R,B=this.root_;do if(b=B,(R=s.compareTo(B.key))<0)B=B.left;else{if(!(R>0)){var H=B.value;return B.value=h,H}B=B.right}while(B!==null);var re={key:s,left:null,right:null,value:h,parent:b,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return R<0?b.left=re:b.right=re,this.fixAfterInsertion(re),this.size_++,null}},{key:"fixAfterInsertion",value:function(s){var h;for(s.color=1;s!=null&&s!==this.root_&&s.parent.color===1;)Xn(s)===_l(Xn(Xn(s)))?Lu(h=Ru(Xn(Xn(s))))===1?(zr(Xn(s),0),zr(h,0),zr(Xn(Xn(s)),1),s=Xn(Xn(s))):(s===Ru(Xn(s))&&(s=Xn(s),this.rotateLeft(s)),zr(Xn(s),0),zr(Xn(Xn(s)),1),this.rotateRight(Xn(Xn(s)))):Lu(h=_l(Xn(Xn(s))))===1?(zr(Xn(s),0),zr(h,0),zr(Xn(Xn(s)),1),s=Xn(Xn(s))):(s===_l(Xn(s))&&(s=Xn(s),this.rotateRight(s)),zr(Xn(s),0),zr(Xn(Xn(s)),1),this.rotateLeft(Xn(Xn(s))));this.root_.color=0}},{key:"values",value:function(){var s=new pt,h=this.getFirstEntry();if(h!==null)for(s.add(h.value);(h=i.successor(h))!==null;)s.add(h.value);return s}},{key:"entrySet",value:function(){var s=new ds,h=this.getFirstEntry();if(h!==null)for(s.add(h);(h=i.successor(h))!==null;)s.add(h);return s}},{key:"rotateLeft",value:function(s){if(s!=null){var h=s.right;s.right=h.left,h.left!=null&&(h.left.parent=s),h.parent=s.parent,s.parent==null?this.root_=h:s.parent.left===s?s.parent.left=h:s.parent.right=h,h.left=s,s.parent=h}}},{key:"rotateRight",value:function(s){if(s!=null){var h=s.left;s.left=h.right,h.right!=null&&(h.right.parent=s),h.parent=s.parent,s.parent==null?this.root_=h:s.parent.right===s?s.parent.right=h:s.parent.left=h,h.right=s,s.parent=h}}},{key:"getFirstEntry",value:function(){var s=this.root_;if(s!=null)for(;s.left!=null;)s=s.left;return s}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(s){for(var h=this.root_;h!==null;){var b=s.compareTo(h.key);if(b<0)h=h.left;else{if(!(b>0))return!0;h=h.right}}return!1}}],[{key:"successor",value:function(s){var h;if(s===null)return null;if(s.right!==null){for(h=s.right;h.left!==null;)h=h.left;return h}h=s.parent;for(var b=s;h!==null&&b===h.right;)b=h,h=h.parent;return h}}])})(Ns),Ds=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"find",value:function(f){return this.nodeMap.get(f)}},{key:"addNode",value:function(){if(arguments[0]instanceof Ne){var f=arguments[0],i=this.nodeMap.get(f);return i===null&&(i=this.nodeFact.createNode(f),this.nodeMap.put(f,i)),i}if(arguments[0]instanceof Lo){var s=arguments[0],h=this.nodeMap.get(s.getCoordinate());return h===null?(this.nodeMap.put(s.getCoordinate(),s),s):(h.mergeLabel(s),h)}}},{key:"print",value:function(f){for(var i=this.iterator();i.hasNext();)i.next().print(f)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(f){for(var i=new pt,s=this.iterator();s.hasNext();){var h=s.next();h.getLabel().getLocation(f)===we.BOUNDARY&&i.add(h)}return i}},{key:"add",value:function(f){var i=f.getCoordinate();this.addNode(i).add(f)}}],[{key:"constructor_",value:function(){this.nodeMap=new zs,this.nodeFact=null;var f=arguments[0];this.nodeFact=f}}])})(),Ri=(function(){function f(){T(this,f)}return c(f,null,[{key:"isNorthern",value:function(i){return i===f.NE||i===f.NW}},{key:"isOpposite",value:function(i,s){return i!==s&&(i-s+4)%4===2}},{key:"commonHalfPlane",value:function(i,s){if(i===s)return i;if((i-s+4)%4===2)return-1;var h=i<s?i:s;return h===0&&(i>s?i:s)===3?3:h}},{key:"isInHalfPlane",value:function(i,s){return s===f.SE?i===f.SE||i===f.SW:i===s||i===s+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],s=arguments[1];if(i===0&&s===0)throw new We("Cannot compute the quadrant for point ( "+i+", "+s+" )");return i>=0?s>=0?f.NE:f.SE:s>=0?f.NW:f.SW}if(arguments[0]instanceof Ne&&arguments[1]instanceof Ne){var h=arguments[0],b=arguments[1];if(b.x===h.x&&b.y===h.y)throw new We("Cannot compute the quadrant for two identical points "+h);return b.x>=h.x?b.y>=h.y?f.NE:f.SE:b.y>=h.y?f.NW:f.SW}}}])})();Ri.NE=0,Ri.NW=1,Ri.SW=2,Ri.SE=3;var za=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"compareDirection",value:function(i){return this._dx===i._dx&&this._dy===i._dy?0:this._quadrant>i._quadrant?1:this._quadrant<i._quadrant?-1:tn.index(i._p0,i._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(i){this._node=i}},{key:"print",value:function(i){var s=Math.atan2(this._dy,this._dx),h=this.getClass().getName(),b=h.lastIndexOf("."),R=h.substring(b+1);i.print("  "+R+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+s+"   "+this._label)}},{key:"compareTo",value:function(i){var s=i;return this.compareDirection(s)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var i=Math.atan2(this._dy,this._dx),s=this.getClass().getName(),h=s.lastIndexOf(".");return"  "+s.substring(h+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+i+"   "+this._label}},{key:"computeLabel",value:function(i){}},{key:"init",value:function(i,s){this._p0=i,this._p1=s,this._dx=s.x-i.x,this._dy=s.y-i.y,this._quadrant=Ri.quadrant(this._dx,this._dy),Pt.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[at]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var i=arguments[0];this._edge=i}else if(arguments.length===3){var s=arguments[0],h=arguments[1],b=arguments[2];f.constructor_.call(this,s,h,b,null)}else if(arguments.length===4){var R=arguments[0],B=arguments[1],H=arguments[2],re=arguments[3];f.constructor_.call(this,R),this.init(B,H),this._label=re}}}])})(),Jo=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(s){return this._depth[s]}},{key:"setVisited",value:function(s){this._isVisited=s}},{key:"computeDirectedLabel",value:function(){this._label=new Yn(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(s,h){if(this._depth[s]!==-999&&this._depth[s]!==h)throw new _t("assigned depths do not match",this.getCoordinate());this._depth[s]=h}},{key:"isInteriorAreaEdge",value:function(){for(var s=!0,h=0;h<2;h++)this._label.isArea(h)&&this._label.getLocation(h,lt.LEFT)===we.INTERIOR&&this._label.getLocation(h,lt.RIGHT)===we.INTERIOR||(s=!1);return s}},{key:"setNextMin",value:function(s){this._nextMin=s}},{key:"print",value:function(s){le(i,"print",this,1).call(this,s),s.print(" "+this._depth[lt.LEFT]+"/"+this._depth[lt.RIGHT]),s.print(" ("+this.getDepthDelta()+")"),this._isInResult&&s.print(" inResult")}},{key:"setMinEdgeRing",value:function(s){this._minEdgeRing=s}},{key:"isLineEdge",value:function(){var s=this._label.isLine(0)||this._label.isLine(1),h=!this._label.isArea(0)||this._label.allPositionsEqual(0,we.EXTERIOR),b=!this._label.isArea(1)||this._label.allPositionsEqual(1,we.EXTERIOR);return s&&h&&b}},{key:"setEdgeRing",value:function(s){this._edgeRing=s}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var s=this._edge.getDepthDelta();return this._isForward||(s=-s),s}},{key:"setInResult",value:function(s){this._isInResult=s}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(s){this.print(s),s.print(" "),this._isForward?this._edge.print(s):this._edge.printReverse(s)}},{key:"setSym",value:function(s){this._sym=s}},{key:"setVisitedEdge",value:function(s){this.setVisited(s),this._sym.setVisited(s)}},{key:"setEdgeDepths",value:function(s,h){var b=this.getEdge().getDepthDelta();this._isForward||(b=-b);var R=1;s===lt.LEFT&&(R=-1);var B=lt.opposite(s),H=h+b*R;this.setDepth(s,h),this.setDepth(B,H)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(s){this._next=s}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var s=arguments[0],h=arguments[1];if(za.constructor_.call(this,s),this._isForward=h,h)this.init(s.getCoordinate(0),s.getCoordinate(1));else{var b=s.getNumPoints()-1;this.init(s.getCoordinate(b),s.getCoordinate(b-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(s,h){return s===we.EXTERIOR&&h===we.INTERIOR?1:s===we.INTERIOR&&h===we.EXTERIOR?-1:0}}])})(za),vl=(function(){return c((function f(){T(this,f)}),[{key:"createNode",value:function(f){return new Lo(f,null)}}])})(),Gr=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"printEdges",value:function(f){f.println("Edges:");for(var i=0;i<this._edges.size();i++){f.println("edge "+i+":");var s=this._edges.get(i);s.print(f),s.eiList.print(f)}}},{key:"find",value:function(f){return this._nodes.find(f)}},{key:"addNode",value:function(){if(arguments[0]instanceof Lo){var f=arguments[0];return this._nodes.addNode(f)}if(arguments[0]instanceof Ne){var i=arguments[0];return this._nodes.addNode(i)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var f=this._nodes.iterator();f.hasNext();)f.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(f){Si.out.println(f)}},{key:"isBoundaryNode",value:function(f,i){var s=this._nodes.find(i);if(s===null)return!1;var h=s.getLabel();return h!==null&&h.getLocation(f)===we.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var f=this._nodes.iterator();f.hasNext();)f.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(f,i,s,h){return!!f.equals(s)&&tn.index(f,i,h)===tn.COLLINEAR&&Ri.quadrant(f,i)===Ri.quadrant(s,h)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(f){Si.out.print(f)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(f,i){for(var s=0;s<this._edges.size();s++){var h=this._edges.get(s),b=h.getCoordinates();if(this.matchInSameDirection(f,i,b[0],b[1])||this.matchInSameDirection(f,i,b[b.length-1],b[b.length-2]))return h}return null}},{key:"insertEdge",value:function(f){this._edges.add(f)}},{key:"findEdgeEnd",value:function(f){for(var i=this.getEdgeEnds().iterator();i.hasNext();){var s=i.next();if(s.getEdge()===f)return s}return null}},{key:"addEdges",value:function(f){for(var i=f.iterator();i.hasNext();){var s=i.next();this._edges.add(s);var h=new Jo(s,!0),b=new Jo(s,!1);h.setSym(b),b.setSym(h),this.add(h),this.add(b)}}},{key:"add",value:function(f){this._nodes.add(f),this._edgeEndList.add(f)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(f,i){for(var s=0;s<this._edges.size();s++){var h=this._edges.get(s),b=h.getCoordinates();if(f.equals(b[0])&&i.equals(b[1]))return h}return null}}],[{key:"constructor_",value:function(){if(this._edges=new pt,this._nodes=null,this._edgeEndList=new pt,arguments.length===0)this._nodes=new Ds(new vl);else if(arguments.length===1){var f=arguments[0];this._nodes=new Ds(f)}}},{key:"linkResultDirectedEdges",value:function(f){for(var i=f.iterator();i.hasNext();)i.next().getEdges().linkResultDirectedEdges()}}])})(),xl=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"sortShellsAndHoles",value:function(i,s,h){for(var b=i.iterator();b.hasNext();){var R=b.next();R.isHole()?h.add(R):s.add(R)}}},{key:"computePolygons",value:function(i){for(var s=new pt,h=i.iterator();h.hasNext();){var b=h.next().toPolygon(this._geometryFactory);s.add(b)}return s}},{key:"placeFreeHoles",value:function(i,s){for(var h=s.iterator();h.hasNext();){var b=h.next();if(b.getShell()===null){var R=f.findEdgeRingContaining(b,i);if(R===null)throw new _t("unable to assign hole to a shell",b.getCoordinate(0));b.setShell(R)}}}},{key:"buildMinimalEdgeRings",value:function(i,s,h){for(var b=new pt,R=i.iterator();R.hasNext();){var B=R.next();if(B.getMaxNodeDegree()>2){B.linkDirectedEdgesForMinimalEdgeRings();var H=B.buildMinimalRings(),re=this.findShell(H);re!==null?(this.placePolygonHoles(re,H),s.add(re)):h.addAll(H)}else b.add(B)}return b}},{key:"buildMaximalEdgeRings",value:function(i){for(var s=new pt,h=i.iterator();h.hasNext();){var b=h.next();if(b.isInResult()&&b.getLabel().isArea()&&b.getEdgeRing()===null){var R=new gs(b,this._geometryFactory);s.add(R),R.setInResult()}}return s}},{key:"placePolygonHoles",value:function(i,s){for(var h=s.iterator();h.hasNext();){var b=h.next();b.isHole()&&b.setShell(i)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(i){for(var s=0,h=null,b=i.iterator();b.hasNext();){var R=b.next();R.isHole()||(h=R,s++)}return Pt.isTrue(s<=1,"found two shells in MinimalEdgeRing list"),h}},{key:"add",value:function(){if(arguments.length===1){var i=arguments[0];this.add(i.getEdgeEnds(),i.getNodes())}else if(arguments.length===2){var s=arguments[0],h=arguments[1];Gr.linkResultDirectedEdges(h);var b=this.buildMaximalEdgeRings(s),R=new pt,B=this.buildMinimalEdgeRings(b,this._shellList,R);this.sortShellsAndHoles(B,this._shellList,R),this.placeFreeHoles(this._shellList,R)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new pt;var i=arguments[0];this._geometryFactory=i}},{key:"findEdgeRingContaining",value:function(i,s){for(var h=i.getLinearRing(),b=h.getEnvelopeInternal(),R=h.getCoordinateN(0),B=null,H=null,re=s.iterator();re.hasNext();){var de=re.next(),De=de.getLinearRing(),$e=De.getEnvelopeInternal();if(!$e.equals(b)&&$e.contains(b)){R=Bn.ptNotInList(h.getCoordinates(),De.getCoordinates());var ct=!1;_r.isInRing(R,De.getCoordinates())&&(ct=!0),ct&&(B===null||H.contains($e))&&(H=(B=de).getLinearRing().getEnvelopeInternal())}}return B}}])})(),Ro=(function(){return c((function f(){T(this,f)}),[{key:"getBounds",value:function(){}}])})(),vr=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[Ro,ft]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var f=arguments[0],i=arguments[1];this._bounds=f,this._item=i}}])})(),Ji=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"poll",value:function(){if(this.isEmpty())return null;var f=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),f}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(f){for(var i=null,s=this._items.get(f);2*f<=this._size&&((i=2*f)!==this._size&&this._items.get(i+1).compareTo(this._items.get(i))<0&&i++,this._items.get(i).compareTo(s)<0);f=i)this._items.set(f,this._items.get(i));this._items.set(f,s)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(f){this._items.add(null),this._size+=1;var i=this._size;for(this._items.set(0,f);f.compareTo(this._items.get(Math.trunc(i/2)))<0;i/=2)this._items.set(i,this._items.get(Math.trunc(i/2)));this._items.set(i,f)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new pt,this._items.add(null)}}])})(),Gn=(function(){return c((function f(){T(this,f)}),[{key:"insert",value:function(f,i){}},{key:"remove",value:function(f,i){}},{key:"query",value:function(){}}])})(),Qi=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(f){Pt.isTrue(this._bounds===null),this._childBoundables.add(f)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[Ro,ft]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new pt,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var f=arguments[0];this._level=f}}}}])})(),Ja={reverseOrder:function(){return{compare:function(f,i){return i.compareTo(f)}}},min:function(f){return Ja.sort(f),f.get(0)},sort:function(f,i){var s=f.toArray();i?Ze.sort(s,i):Ze.sort(s);for(var h=f.iterator(),b=0,R=s.length;b<R;b++)h.next(),h.set(s[b])},singletonList:function(f){var i=new pt;return i.add(f),i}},ca=(function(){function f(){T(this,f)}return c(f,null,[{key:"maxDistance",value:function(i,s,h,b,R,B,H,re){var de=f.distance(i,s,R,B);return de=Math.max(de,f.distance(i,s,H,re)),de=Math.max(de,f.distance(h,b,R,B)),de=Math.max(de,f.distance(h,b,H,re))}},{key:"distance",value:function(i,s,h,b){var R=h-i,B=b-s;return Math.sqrt(R*R+B*B)}},{key:"maximumDistance",value:function(i,s){var h=Math.min(i.getMinX(),s.getMinX()),b=Math.min(i.getMinY(),s.getMinY()),R=Math.max(i.getMaxX(),s.getMaxX()),B=Math.max(i.getMaxY(),s.getMaxY());return f.distance(h,b,R,B)}},{key:"minMaxDistance",value:function(i,s){var h=i.getMinX(),b=i.getMinY(),R=i.getMaxX(),B=i.getMaxY(),H=s.getMinX(),re=s.getMinY(),de=s.getMaxX(),De=s.getMaxY(),$e=f.maxDistance(h,b,h,B,H,re,H,De);return $e=Math.min($e,f.maxDistance(h,b,h,B,H,re,de,re)),$e=Math.min($e,f.maxDistance(h,b,h,B,de,De,H,De)),$e=Math.min($e,f.maxDistance(h,b,h,B,de,De,de,re)),$e=Math.min($e,f.maxDistance(h,b,R,b,H,re,H,De)),$e=Math.min($e,f.maxDistance(h,b,R,b,H,re,de,re)),$e=Math.min($e,f.maxDistance(h,b,R,b,de,De,H,De)),$e=Math.min($e,f.maxDistance(h,b,R,b,de,De,de,re)),$e=Math.min($e,f.maxDistance(R,B,h,B,H,re,H,De)),$e=Math.min($e,f.maxDistance(R,B,h,B,H,re,de,re)),$e=Math.min($e,f.maxDistance(R,B,h,B,de,De,H,De)),$e=Math.min($e,f.maxDistance(R,B,h,B,de,De,de,re)),$e=Math.min($e,f.maxDistance(R,B,R,b,H,re,H,De)),$e=Math.min($e,f.maxDistance(R,B,R,b,H,re,de,re)),$e=Math.min($e,f.maxDistance(R,B,R,b,de,De,H,De)),$e=Math.min($e,f.maxDistance(R,B,R,b,de,De,de,re))}}])})(),ha=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"maximumDistance",value:function(){return ca.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(i,s){var h=f.isComposite(this._boundable1),b=f.isComposite(this._boundable2);if(h&&b)return f.area(this._boundable1)>f.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,i,s),null):(this.expand(this._boundable2,this._boundable1,!0,i,s),null);if(h)return this.expand(this._boundable1,this._boundable2,!1,i,s),null;if(b)return this.expand(this._boundable2,this._boundable1,!0,i,s),null;throw new We("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(f.isComposite(this._boundable1)||f.isComposite(this._boundable2))}},{key:"compareTo",value:function(i){var s=i;return this._distance<s._distance?-1:this._distance>s._distance?1:0}},{key:"expand",value:function(i,s,h,b,R){for(var B=i.getChildBoundables().iterator();B.hasNext();){var H=B.next(),re=null;(re=h?new f(s,H,this._itemDistance):new f(H,s,this._itemDistance)).getDistance()<R&&b.add(re)}}},{key:"getBoundable",value:function(i){return i===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[at]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var i=arguments[0],s=arguments[1],h=arguments[2];this._boundable1=i,this._boundable2=s,this._itemDistance=h,this._distance=this.distance()}},{key:"area",value:function(i){return i.getBounds().getArea()}},{key:"isComposite",value:function(i){return i instanceof Qi}}])})(),wl=(function(){return c((function f(){T(this,f)}),[{key:"visitItem",value:function(f){}}])})(),er=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"queryInternal",value:function(){if(vn(arguments[2],wl)&&arguments[0]instanceof Object&&arguments[1]instanceof Qi)for(var i=arguments[0],s=arguments[2],h=arguments[1].getChildBoundables(),b=0;b<h.size();b++){var R=h.get(b);this.getIntersectsOp().intersects(R.getBounds(),i)&&(R instanceof Qi?this.queryInternal(i,R,s):R instanceof vr?s.visitItem(R.getItem()):Pt.shouldNeverReachHere())}else if(vn(arguments[2],pr)&&arguments[0]instanceof Object&&arguments[1]instanceof Qi)for(var B=arguments[0],H=arguments[2],re=arguments[1].getChildBoundables(),de=0;de<re.size();de++){var De=re.get(de);this.getIntersectsOp().intersects(De.getBounds(),B)&&(De instanceof Qi?this.queryInternal(B,De,H):De instanceof vr?H.add(De.getItem()):Pt.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(i){return i.get(i.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var i=0,s=arguments[0].getChildBoundables().iterator();s.hasNext();){var h=s.next();h instanceof Qi?i+=this.size(h):h instanceof vr&&(i+=1)}return i}}},{key:"removeItem",value:function(i,s){for(var h=null,b=i.getChildBoundables().iterator();b.hasNext();){var R=b.next();R instanceof vr&&R.getItem()===s&&(h=R)}return h!==null&&(i.getChildBoundables().remove(h),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var i=this.itemsTree(this._root);return i===null?new pt:i}if(arguments.length===1){for(var s=arguments[0],h=new pt,b=s.getChildBoundables().iterator();b.hasNext();){var R=b.next();if(R instanceof Qi){var B=this.itemsTree(R);B!==null&&h.add(B)}else R instanceof vr?h.add(R.getItem()):Pt.shouldNeverReachHere()}return h.size()<=0?null:h}}},{key:"insert",value:function(i,s){Pt.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new vr(i,s))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var i=arguments[0],s=new pt;return this.boundablesAtLevel(i,this._root,s),s}if(arguments.length===3){var h=arguments[0],b=arguments[1],R=arguments[2];if(Pt.isTrue(h>-2),b.getLevel()===h)return R.add(b),null;for(var B=b.getChildBoundables().iterator();B.hasNext();){var H=B.next();H instanceof Qi?this.boundablesAtLevel(h,H,R):(Pt.isTrue(H instanceof vr),h===-1&&R.add(H))}return null}}},{key:"query",value:function(){if(arguments.length===1){var i=arguments[0];this.build();var s=new pt;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.queryInternal(i,this._root,s),s}if(arguments.length===2){var h=arguments[0],b=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),h)&&this.queryInternal(h,this._root,b)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.remove(i,this._root,s)}if(arguments.length===3){var h=arguments[0],b=arguments[1],R=arguments[2],B=this.removeItem(b,R);if(B)return!0;for(var H=null,re=b.getChildBoundables().iterator();re.hasNext();){var de=re.next();if(this.getIntersectsOp().intersects(de.getBounds(),h)&&de instanceof Qi&&(B=this.remove(h,de,R))){H=de;break}}return H!==null&&H.getChildBoundables().isEmpty()&&b.getChildBoundables().remove(H),B}}},{key:"createHigherLevels",value:function(i,s){Pt.isTrue(!i.isEmpty());var h=this.createParentBoundables(i,s+1);return h.size()===1?h.get(0):this.createHigherLevels(h,s+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var i=0,s=arguments[0].getChildBoundables().iterator();s.hasNext();){var h=s.next();if(h instanceof Qi){var b=this.depth(h);b>i&&(i=b)}}return i+1}}},{key:"createParentBoundables",value:function(i,s){Pt.isTrue(!i.isEmpty());var h=new pt;h.add(this.createNode(s));var b=new pt(i);Ja.sort(b,this.getComparator());for(var R=b.iterator();R.hasNext();){var B=R.next();this.lastNode(h).getChildBoundables().size()===this.getNodeCapacity()&&h.add(this.createNode(s)),this.lastNode(h).addChildBoundable(B)}return h}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[ft]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new pt,this._nodeCapacity=null,arguments.length===0)f.constructor_.call(this,f.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var i=arguments[0];Pt.isTrue(i>1,"Node capacity must be greater than 1"),this._nodeCapacity=i}}},{key:"compareDoubles",value:function(i,s){return i>s?1:i<s?-1:0}}])})();er.IntersectsOp=function(){},er.DEFAULT_NODE_CAPACITY=10;var Qa=(function(){return c((function f(){T(this,f)}),[{key:"distance",value:function(f,i){}}])})(),Dr=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"createParentBoundablesFromVerticalSlices",value:function(s,h){Pt.isTrue(s.length>0);for(var b=new pt,R=0;R<s.length;R++)b.addAll(this.createParentBoundablesFromVerticalSlice(s[R],h));return b}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var s=arguments[0],h=arguments[1];return this.nearestNeighbourK(s,nt.POSITIVE_INFINITY,h)}if(arguments.length===3){var b=arguments[0],R=arguments[2],B=arguments[1],H=new Ji;H.add(b);for(var re=new Ji;!H.isEmpty()&&B>=0;){var de=H.poll(),De=de.getDistance();if(De>=B)break;de.isLeaves()?re.size()<R?re.add(de):(re.peek().getDistance()>De&&(re.poll(),re.add(de)),B=re.peek().getDistance()):de.expandToQueue(H,B)}return i.getItems(re)}}},{key:"createNode",value:function(s){return new eo(s)}},{key:"size",value:function(){return arguments.length===0?le(i,"size",this,1).call(this):le(i,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Cn))return le(i,"insert",this,1).apply(this,arguments);var s=arguments[0],h=arguments[1];if(s.isNull())return null;le(i,"insert",this,1).call(this,s,h)}},{key:"getIntersectsOp",value:function(){return i.intersectsOp}},{key:"verticalSlices",value:function(s,h){for(var b=Math.trunc(Math.ceil(s.size()/h)),R=new Array(h).fill(null),B=s.iterator(),H=0;H<h;H++){R[H]=new pt;for(var re=0;B.hasNext()&&re<b;){var de=B.next();R[H].add(de),re++}}return R}},{key:"query",value:function(){if(arguments.length===1){var s=arguments[0];return le(i,"query",this,1).call(this,s)}if(arguments.length===2){var h=arguments[0],b=arguments[1];le(i,"query",this,1).call(this,h,b)}}},{key:"getComparator",value:function(){return i.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(s,h){return le(i,"createParentBoundables",this,1).call(this,s,h)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Cn){var s=arguments[0],h=arguments[1];return le(i,"remove",this,1).call(this,s,h)}return le(i,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?le(i,"depth",this,1).call(this):le(i,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(s,h){Pt.isTrue(!s.isEmpty());var b=Math.trunc(Math.ceil(s.size()/this.getNodeCapacity())),R=new pt(s);Ja.sort(R,i.xComparator);var B=this.verticalSlices(R,Math.trunc(Math.ceil(Math.sqrt(b))));return this.createParentBoundablesFromVerticalSlices(B,h)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(vn(arguments[0],Qa)){var s=arguments[0];if(this.isEmpty())return null;var h=new ha(this.getRoot(),this.getRoot(),s);return this.nearestNeighbour(h)}if(arguments[0]instanceof ha){var b=arguments[0],R=nt.POSITIVE_INFINITY,B=null,H=new Ji;for(H.add(b);!H.isEmpty()&&R>0;){var re=H.poll(),de=re.getDistance();if(de>=R)break;re.isLeaves()?(R=de,B=re):re.expandToQueue(H,R)}return B===null?null:[B.getBoundable(0).getItem(),B.getBoundable(1).getItem()]}}else{if(arguments.length===2){var De=arguments[0],$e=arguments[1];if(this.isEmpty()||De.isEmpty())return null;var ct=new ha(this.getRoot(),De.getRoot(),$e);return this.nearestNeighbour(ct)}if(arguments.length===3){var At=arguments[2],Ht=new vr(arguments[0],arguments[1]),ln=new ha(this.getRoot(),Ht,At);return this.nearestNeighbour(ln)[0]}if(arguments.length===4){var Nn=arguments[2],An=arguments[3],Vn=new vr(arguments[0],arguments[1]),Ci=new ha(this.getRoot(),Vn,Nn);return this.nearestNeighbourK(Ci,An)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var s=arguments[0],h=arguments[1],b=nt.POSITIVE_INFINITY,R=new Ji;for(R.add(s);!R.isEmpty();){var B=R.poll(),H=B.getDistance();if(H>h)return!1;if(B.maximumDistance()<=h)return!0;if(B.isLeaves()){if((b=H)<=h)return!0}else B.expandToQueue(R,b)}return!1}if(arguments.length===3){var re=arguments[0],de=arguments[1],De=arguments[2],$e=new ha(this.getRoot(),re.getRoot(),de);return this.isWithinDistance($e,De)}}},{key:"interfaces_",get:function(){return[Gn,ft]}}],[{key:"constructor_",value:function(){if(arguments.length===0)i.constructor_.call(this,i.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var s=arguments[0];er.constructor_.call(this,s)}}},{key:"centreX",value:function(s){return i.avg(s.getMinX(),s.getMaxX())}},{key:"avg",value:function(s,h){return(s+h)/2}},{key:"getItems",value:function(s){for(var h=new Array(s.size()).fill(null),b=0;!s.isEmpty();){var R=s.poll();h[b]=R.getBoundable(0).getItem(),b++}return h}},{key:"centreY",value:function(s){return i.avg(s.getMinY(),s.getMaxY())}}])})(er),eo=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"computeBounds",value:function(){for(var s=null,h=this.getChildBoundables().iterator();h.hasNext();){var b=h.next();s===null?s=new Cn(b.getBounds()):s.expandToInclude(b.getBounds())}return s}}],[{key:"constructor_",value:function(){var s=arguments[0];Qi.constructor_.call(this,s)}}])})(Qi);Dr.STRtreeNode=eo,Dr.xComparator=new((function(){return c((function f(){T(this,f)}),[{key:"interfaces_",get:function(){return[Re]}},{key:"compare",value:function(f,i){return er.compareDoubles(Dr.centreX(f.getBounds()),Dr.centreX(i.getBounds()))}}])})()),Dr.yComparator=new((function(){return c((function f(){T(this,f)}),[{key:"interfaces_",get:function(){return[Re]}},{key:"compare",value:function(f,i){return er.compareDoubles(Dr.centreY(f.getBounds()),Dr.centreY(i.getBounds()))}}])})()),Dr.intersectsOp=new((function(){return c((function f(){T(this,f)}),[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(f,i){return f.intersects(i)}}])})()),Dr.DEFAULT_NODE_CAPACITY=10;var Nu=(function(){function f(){T(this,f)}return c(f,null,[{key:"relativeSign",value:function(i,s){return i<s?-1:i>s?1:0}},{key:"compare",value:function(i,s,h){if(s.equals2D(h))return 0;var b=f.relativeSign(s.x,h.x),R=f.relativeSign(s.y,h.y);switch(i){case 0:return f.compareValue(b,R);case 1:return f.compareValue(R,b);case 2:return f.compareValue(R,-b);case 3:return f.compareValue(-b,R);case 4:return f.compareValue(-b,-R);case 5:return f.compareValue(-R,-b);case 6:return f.compareValue(-R,b);case 7:return f.compareValue(b,-R)}return Pt.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(i,s){return i<0?-1:i>0?1:s<0?-1:s>0?1:0}}])})(),bl=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(f){f.print(this.coord),f.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(f){var i=f;return this.segmentIndex<i.segmentIndex?-1:this.segmentIndex>i.segmentIndex?1:this.coord.equals2D(i.coord)?0:this._isInterior?i._isInterior?Nu.compare(this._segmentOctant,this.coord,i.coord):1:-1}},{key:"isEndPoint",value:function(f){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===f}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[at]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var f=arguments[0],i=arguments[1],s=arguments[2],h=arguments[3];this._segString=f,this.coord=new Ne(i),this.segmentIndex=s,this._segmentOctant=h,this._isInterior=!i.equals2D(f.getCoordinate(s))}}])})(),kl=(function(){return c((function f(){T(this,f)}),[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}])})(),ys=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"getSplitCoordinates",value:function(){var f=new Ei;this.addEndpoints();for(var i=this.iterator(),s=i.next();i.hasNext();){var h=i.next();this.addEdgeCoordinates(s,h,f),s=h}return f.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var f=new pt;this.findCollapsesFromInsertedNodes(f),this.findCollapsesFromExistingVertices(f);for(var i=f.iterator();i.hasNext();){var s=i.next().intValue();this.add(this._edge.getCoordinate(s),s)}}},{key:"createSplitEdgePts",value:function(f,i){var s=i.segmentIndex-f.segmentIndex+2;if(s===2)return[new Ne(f.coord),new Ne(i.coord)];var h=this._edge.getCoordinate(i.segmentIndex),b=i.isInterior()||!i.coord.equals2D(h);b||s--;var R=new Array(s).fill(null),B=0;R[B++]=new Ne(f.coord);for(var H=f.segmentIndex+1;H<=i.segmentIndex;H++)R[B++]=this._edge.getCoordinate(H);return b&&(R[B]=new Ne(i.coord)),R}},{key:"print",value:function(f){f.println("Intersections:");for(var i=this.iterator();i.hasNext();)i.next().print(f)}},{key:"findCollapsesFromExistingVertices",value:function(f){for(var i=0;i<this._edge.size()-2;i++){var s=this._edge.getCoordinate(i);this._edge.getCoordinate(i+1);var h=this._edge.getCoordinate(i+2);s.equals2D(h)&&f.add(aa.valueOf(i+1))}}},{key:"addEdgeCoordinates",value:function(f,i,s){var h=this.createSplitEdgePts(f,i);s.add(h,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(f){this.addEndpoints(),this.addCollapsedNodes();for(var i=this.iterator(),s=i.next();i.hasNext();){var h=i.next(),b=this.createSplitEdge(s,h);f.add(b),s=h}}},{key:"findCollapseIndex",value:function(f,i,s){if(!f.coord.equals2D(i.coord))return!1;var h=i.segmentIndex-f.segmentIndex;return i.isInterior()||h--,h===1&&(s[0]=f.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(f){for(var i=new Array(1).fill(null),s=this.iterator(),h=s.next();s.hasNext();){var b=s.next();this.findCollapseIndex(h,b,i)&&f.add(aa.valueOf(i[0])),h=b}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var f=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(f),f)}},{key:"createSplitEdge",value:function(f,i){var s=this.createSplitEdgePts(f,i);return new _s(s,this._edge.getData())}},{key:"add",value:function(f,i){var s=new bl(this._edge,f,i,this._edge.getSegmentOctant(i)),h=this._nodeMap.get(s);return h!==null?(Pt.isTrue(h.coord.equals2D(f),"Found equal nodes with different coordinates"),h):(this._nodeMap.put(s,s),s)}},{key:"checkSplitEdgesCorrectness",value:function(f){var i=this._edge.getCoordinates(),s=f.get(0).getCoordinate(0);if(!s.equals2D(i[0]))throw new rt("bad split edge start point at "+s);var h=f.get(f.size()-1).getCoordinates(),b=h[h.length-1];if(!b.equals2D(i[i.length-1]))throw new rt("bad split edge end point at "+b)}}],[{key:"constructor_",value:function(){this._nodeMap=new zs,this._edge=null;var f=arguments[0];this._edge=f}}])})(),Qo=(function(){function f(){T(this,f)}return c(f,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],s=arguments[1];if(i===0&&s===0)throw new We("Cannot compute the octant for point ( "+i+", "+s+" )");var h=Math.abs(i),b=Math.abs(s);return i>=0?s>=0?h>=b?0:1:h>=b?7:6:s>=0?h>=b?3:2:h>=b?4:5}if(arguments[0]instanceof Ne&&arguments[1]instanceof Ne){var R=arguments[0],B=arguments[1],H=B.x-R.x,re=B.y-R.y;if(H===0&&re===0)throw new We("Cannot compute the octant for two identical points "+R);return f.octant(H,re)}}}])})(),zu=(function(){return c((function f(){T(this,f)}),[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(f){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(f){}},{key:"getData",value:function(){}}])})(),Du=(function(){return c((function f(){T(this,f)}),[{key:"addIntersection",value:function(f,i){}},{key:"interfaces_",get:function(){return[zu]}}])})(),_s=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(i){return this._pts[i]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(i){return i===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(i),this.getCoordinate(i+1))}},{key:"setData",value:function(i){this._data=i}},{key:"safeOctant",value:function(i,s){return i.equals2D(s)?0:Qo.octant(i,s)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];this.addIntersectionNode(i,s)}else if(arguments.length===4){var h=arguments[1],b=arguments[3],R=new Ne(arguments[0].getIntersection(b));this.addIntersection(R,h)}}},{key:"toString",value:function(){return Yo.toLineString(new Ha(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(i,s){var h=s,b=h+1;if(b<this._pts.length){var R=this._pts[b];i.equals2D(R)&&(h=b)}return this._nodeList.add(i,h)}},{key:"addIntersections",value:function(i,s,h){for(var b=0;b<i.getIntersectionNum();b++)this.addIntersection(i,s,h,b)}},{key:"interfaces_",get:function(){return[Du]}}],[{key:"constructor_",value:function(){this._nodeList=new ys(this),this._pts=null,this._data=null;var i=arguments[0],s=arguments[1];this._pts=i,this._data=s}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var i=arguments[0],s=new pt;return f.getNodedSubstrings(i,s),s}if(arguments.length===2)for(var h=arguments[1],b=arguments[0].iterator();b.hasNext();)b.next().getNodeList().addSplitEdges(h)}}])})(),$r=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof f){var i=arguments[0],s=tn.index(this.p0,this.p1,i.p0),h=tn.index(this.p0,this.p1,i.p1);return s>=0&&h>=0||s<=0&&h<=0?Math.max(s,h):0}if(arguments[0]instanceof Ne){var b=arguments[0];return tn.index(this.p0,this.p1,b)}}},{key:"toGeometry",value:function(i){return i.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(i){if(!(i instanceof f))return!1;var s=i;return this.p0.equals(s.p0)&&this.p1.equals(s.p1)}},{key:"intersection",value:function(i){var s=new Rs;return s.computeIntersection(this.p0,this.p1,i.p0,i.p1),s.hasIntersection()?s.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof Ne){var i=arguments[0];if(i.equals(this.p0)||i.equals(this.p1))return new Ne(i);var s=this.projectionFactor(i),h=new Ne;return h.x=this.p0.x+s*(this.p1.x-this.p0.x),h.y=this.p0.y+s*(this.p1.y-this.p0.y),h}if(arguments[0]instanceof f){var b=arguments[0],R=this.projectionFactor(b.p0),B=this.projectionFactor(b.p1);if(R>=1&&B>=1||R<=0&&B<=0)return null;var H=this.project(b.p0);R<0&&(H=this.p0),R>1&&(H=this.p1);var re=this.project(b.p1);return B<0&&(re=this.p0),B>1&&(re=this.p1),new f(H,re)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(i){return i===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(i){return Ai.pointToLinePerpendicular(i,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return f.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(i){if(i.equals(this.p0))return 0;if(i.equals(this.p1))return 1;var s=this.p1.x-this.p0.x,h=this.p1.y-this.p0.y,b=s*s+h*h;return b<=0?nt.NaN:((i.x-this.p0.x)*s+(i.y-this.p0.y)*h)/b}},{key:"closestPoints",value:function(i){var s=this.intersection(i);if(s!==null)return[s,s];var h=new Array(2).fill(null),b=nt.MAX_VALUE,R=null,B=this.closestPoint(i.p0);b=B.distance(i.p0),h[0]=B,h[1]=i.p0;var H=this.closestPoint(i.p1);(R=H.distance(i.p1))<b&&(b=R,h[0]=H,h[1]=i.p1);var re=i.closestPoint(this.p0);(R=re.distance(this.p0))<b&&(b=R,h[0]=this.p0,h[1]=re);var de=i.closestPoint(this.p1);return(R=de.distance(this.p1))<b&&(b=R,h[0]=this.p1,h[1]=de),h}},{key:"closestPoint",value:function(i){var s=this.projectionFactor(i);return s>0&&s<1?this.project(i):this.p0.distance(i)<this.p1.distance(i)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(i){var s=i,h=this.p0.compareTo(s.p0);return h!==0?h:this.p1.compareTo(s.p1)}},{key:"reverse",value:function(){var i=this.p0;this.p0=this.p1,this.p1=i}},{key:"equalsTopo",value:function(i){return this.p0.equals(i.p0)&&this.p1.equals(i.p1)||this.p0.equals(i.p1)&&this.p1.equals(i.p0)}},{key:"lineIntersection",value:function(i){return pn.intersection(this.p0,this.p1,i.p0,i.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(i,s){var h=this.p0.x+i*(this.p1.x-this.p0.x),b=this.p0.y+i*(this.p1.y-this.p0.y),R=this.p1.x-this.p0.x,B=this.p1.y-this.p0.y,H=Math.sqrt(R*R+B*B),re=0,de=0;if(s!==0){if(H<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");re=s*R/H,de=s*B/H}return new Ne(h-de,b+re)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var i=arguments[0];this.setCoordinates(i.p0,i.p1)}else if(arguments.length===2){var s=arguments[0],h=arguments[1];this.p0.x=s.x,this.p0.y=s.y,this.p1.x=h.x,this.p1.y=h.y}}},{key:"segmentFraction",value:function(i){var s=this.projectionFactor(i);return s<0?s=0:(s>1||nt.isNaN(s))&&(s=1),s}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(i){var s=this.p1.getY()-this.p0.getY(),h=this.p0.getX()-this.p1.getX(),b=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),R=s*s+h*h,B=s*s-h*h,H=i.getX(),re=i.getY();return new Ne((-B*H-2*s*h*re-2*s*b)/R,(B*re-2*s*h*H-2*h*b)/R)}},{key:"distance",value:function(){if(arguments[0]instanceof f){var i=arguments[0];return Ai.segmentToSegment(this.p0,this.p1,i.p0,i.p1)}if(arguments[0]instanceof Ne){var s=arguments[0];return Ai.pointToSegment(s,this.p0,this.p1)}}},{key:"pointAlong",value:function(i){var s=new Ne;return s.x=this.p0.x+i*(this.p1.x-this.p0.x),s.y=this.p0.y+i*(this.p1.y-this.p0.y),s}},{key:"hashCode",value:function(){var i=nt.doubleToLongBits(this.p0.x);i^=31*nt.doubleToLongBits(this.p0.y);var s=Math.trunc(i)^Math.trunc(i>>32),h=nt.doubleToLongBits(this.p1.x);return h^=31*nt.doubleToLongBits(this.p1.y),s^(Math.trunc(h)^Math.trunc(h>>32))}},{key:"interfaces_",get:function(){return[at,ft]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)f.constructor_.call(this,new Ne,new Ne);else if(arguments.length===1){var i=arguments[0];f.constructor_.call(this,i.p0,i.p1)}else if(arguments.length===2){var s=arguments[0],h=arguments[1];this.p0=s,this.p1=h}else if(arguments.length===4){var b=arguments[0],R=arguments[1],B=arguments[2],H=arguments[3];f.constructor_.call(this,new Ne(b,R),new Ne(B,H))}}},{key:"midPoint",value:function(i,s){return new Ne((i.x+s.x)/2,(i.y+s.y)/2)}}])})(),No=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var f=arguments[1],i=arguments[2],s=arguments[3];arguments[0].getLineSegment(f,this._overlapSeg1),i.getLineSegment(s,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new $r,this._overlapSeg2=new $r}}])})(),Ou=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"getLineSegment",value:function(f,i){i.p0=this._pts[f],i.p1=this._pts[f+1]}},{key:"computeSelect",value:function(f,i,s,h){var b=this._pts[i],R=this._pts[s];if(s-i==1)return h.select(this,i),null;if(!f.intersects(b,R))return null;var B=Math.trunc((i+s)/2);i<B&&this.computeSelect(f,i,B,h),B<s&&this.computeSelect(f,B,s,h)}},{key:"getCoordinates",value:function(){for(var f=new Array(this._end-this._start+1).fill(null),i=0,s=this._start;s<=this._end;s++)f[i++]=this._pts[s];return f}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var f=arguments[0],i=arguments[1];this.computeOverlaps(this._start,this._end,f,f._start,f._end,i)}else if(arguments.length===6){var s=arguments[0],h=arguments[1],b=arguments[2],R=arguments[3],B=arguments[4],H=arguments[5];if(h-s==1&&B-R==1)return H.overlap(this,s,b,R),null;if(!this.overlaps(s,h,b,R,B))return null;var re=Math.trunc((s+h)/2),de=Math.trunc((R+B)/2);s<re&&(R<de&&this.computeOverlaps(s,re,b,R,de,H),de<B&&this.computeOverlaps(s,re,b,de,B,H)),re<h&&(R<de&&this.computeOverlaps(re,h,b,R,de,H),de<B&&this.computeOverlaps(re,h,b,de,B,H))}}},{key:"setId",value:function(f){this._id=f}},{key:"select",value:function(f,i){this.computeSelect(f,this._start,this._end,i)}},{key:"getEnvelope",value:function(){if(this._env===null){var f=this._pts[this._start],i=this._pts[this._end];this._env=new Cn(f,i)}return this._env}},{key:"overlaps",value:function(f,i,s,h,b){return Cn.intersects(this._pts[f],this._pts[i],s._pts[h],s._pts[b])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var f=arguments[0],i=arguments[1],s=arguments[2],h=arguments[3];this._pts=f,this._start=i,this._end=s,this._context=h}}])})(),fc=(function(){function f(){T(this,f)}return c(f,null,[{key:"findChainEnd",value:function(i,s){for(var h=s;h<i.length-1&&i[h].equals2D(i[h+1]);)h++;if(h>=i.length-1)return i.length-1;for(var b=Ri.quadrant(i[h],i[h+1]),R=s+1;R<i.length&&!(!i[R-1].equals2D(i[R])&&Ri.quadrant(i[R-1],i[R])!==b);)R++;return R-1}},{key:"getChains",value:function(){if(arguments.length===1){var i=arguments[0];return f.getChains(i,null)}if(arguments.length===2){var s=arguments[0],h=arguments[1],b=new pt,R=0;do{var B=f.findChainEnd(s,R),H=new Ou(s,R,B,h);b.add(H),R=B}while(R<s.length-1);return b}}}])})(),Sl=(function(){return c((function f(){T(this,f)}),[{key:"computeNodes",value:function(f){}},{key:"getNodedSubstrings",value:function(){}}])})(),ou=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"setSegmentIntersector",value:function(f){this._segInt=f}},{key:"interfaces_",get:function(){return[Sl]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var f=arguments[0];this.setSegmentIntersector(f)}}}}])})(),El=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return _s.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(s){for(var h=fc.getChains(s.getCoordinates(),s).iterator();h.hasNext();){var b=h.next();b.setId(this._idCounter++),this._index.insert(b.getEnvelope(),b),this._monoChains.add(b)}}},{key:"computeNodes",value:function(s){this._nodedSegStrings=s;for(var h=s.iterator();h.hasNext();)this.add(h.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var s=new el(this._segInt),h=this._monoChains.iterator();h.hasNext();)for(var b=h.next(),R=this._index.query(b.getEnvelope()).iterator();R.hasNext();){var B=R.next();if(B.getId()>b.getId()&&(b.computeOverlaps(B,s),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new pt,this._index=new Dr,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var s=arguments[0];ou.constructor_.call(this,s)}}}}])})(ou),el=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"overlap",value:function(){if(arguments.length!==4)return le(i,"overlap",this,1).apply(this,arguments);var s=arguments[1],h=arguments[2],b=arguments[3],R=arguments[0].getContext(),B=h.getContext();this._si.processIntersections(R,s,B,b)}}],[{key:"constructor_",value:function(){this._si=null;var s=arguments[0];this._si=s}}])})(No);El.SegmentOverlapAction=el;var es=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"isDeletable",value:function(i,s,h,b){var R=this._inputLine[i],B=this._inputLine[s],H=this._inputLine[h];return!!this.isConcave(R,B,H)&&!!this.isShallow(R,B,H,b)&&this.isShallowSampled(R,B,i,h,b)}},{key:"deleteShallowConcavities",value:function(){for(var i=1,s=this.findNextNonDeletedIndex(i),h=this.findNextNonDeletedIndex(s),b=!1;h<this._inputLine.length;){var R=!1;this.isDeletable(i,s,h,this._distanceTol)&&(this._isDeleted[s]=f.DELETE,R=!0,b=!0),i=R?h:s,s=this.findNextNonDeletedIndex(i),h=this.findNextNonDeletedIndex(s)}return b}},{key:"isShallowConcavity",value:function(i,s,h,b){return tn.index(i,s,h)===this._angleOrientation&&Ai.pointToSegment(s,i,h)<b}},{key:"isShallowSampled",value:function(i,s,h,b,R){var B=Math.trunc((b-h)/f.NUM_PTS_TO_CHECK);B<=0&&(B=1);for(var H=h;H<b;H+=B)if(!this.isShallow(i,s,this._inputLine[H],R))return!1;return!0}},{key:"isConcave",value:function(i,s,h){var b=tn.index(i,s,h)===this._angleOrientation;return b}},{key:"simplify",value:function(i){this._distanceTol=Math.abs(i),i<0&&(this._angleOrientation=tn.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var s=!1;do s=this.deleteShallowConcavities();while(s);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(i){for(var s=i+1;s<this._inputLine.length&&this._isDeleted[s]===f.DELETE;)s++;return s}},{key:"isShallow",value:function(i,s,h,b){return Ai.pointToSegment(s,i,h)<b}},{key:"collapseLine",value:function(){for(var i=new Ei,s=0;s<this._inputLine.length;s++)this._isDeleted[s]!==f.DELETE&&i.add(this._inputLine[s]);return i.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=tn.COUNTERCLOCKWISE;var i=arguments[0];this._inputLine=i}},{key:"simplify",value:function(i,s){return new f(i).simplify(s)}}])})();es.INIT=0,es.DELETE=1,es.KEEP=1,es.NUM_PTS_TO_CHECK=10;var tl=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"getCoordinates",value:function(){return this._ptList.toArray(f.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(i){this._precisionModel=i}},{key:"addPt",value:function(i){var s=new Ne(i);if(this._precisionModel.makePrecise(s),this.isRedundant(s))return null;this._ptList.add(s)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(i,s){if(s)for(var h=0;h<i.length;h++)this.addPt(i[h]);else for(var b=i.length-1;b>=0;b--)this.addPt(i[b])}},{key:"isRedundant",value:function(i){if(this._ptList.size()<1)return!1;var s=this._ptList.get(this._ptList.size()-1);return i.distance(s)<this._minimimVertexDistance}},{key:"toString",value:function(){return new Qr().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var i=new Ne(this._ptList.get(0)),s=this._ptList.get(this._ptList.size()-1);if(i.equals(s))return null;this._ptList.add(i)}},{key:"setMinimumVertexDistance",value:function(i){this._minimimVertexDistance=i}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new pt}}])})();tl.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Ui=(function(){function f(){T(this,f)}return c(f,null,[{key:"toDegrees",value:function(i){return 180*i/Math.PI}},{key:"normalize",value:function(i){for(;i>Math.PI;)i-=f.PI_TIMES_2;for(;i<=-Math.PI;)i+=f.PI_TIMES_2;return i}},{key:"angle",value:function(){if(arguments.length===1){var i=arguments[0];return Math.atan2(i.y,i.x)}if(arguments.length===2){var s=arguments[0],h=arguments[1],b=h.x-s.x,R=h.y-s.y;return Math.atan2(R,b)}}},{key:"isAcute",value:function(i,s,h){var b=i.x-s.x,R=i.y-s.y;return b*(h.x-s.x)+R*(h.y-s.y)>0}},{key:"isObtuse",value:function(i,s,h){var b=i.x-s.x,R=i.y-s.y;return b*(h.x-s.x)+R*(h.y-s.y)<0}},{key:"interiorAngle",value:function(i,s,h){var b=f.angle(s,i),R=f.angle(s,h);return Math.abs(R-b)}},{key:"normalizePositive",value:function(i){if(i<0){for(;i<0;)i+=f.PI_TIMES_2;i>=f.PI_TIMES_2&&(i=0)}else{for(;i>=f.PI_TIMES_2;)i-=f.PI_TIMES_2;i<0&&(i=0)}return i}},{key:"angleBetween",value:function(i,s,h){var b=f.angle(s,i),R=f.angle(s,h);return f.diff(b,R)}},{key:"diff",value:function(i,s){var h=null;return(h=i<s?s-i:i-s)>Math.PI&&(h=2*Math.PI-h),h}},{key:"toRadians",value:function(i){return i*Math.PI/180}},{key:"getTurn",value:function(i,s){var h=Math.sin(s-i);return h>0?f.COUNTERCLOCKWISE:h<0?f.CLOCKWISE:f.NONE}},{key:"angleBetweenOriented",value:function(i,s,h){var b=f.angle(s,i),R=f.angle(s,h)-b;return R<=-Math.PI?R+f.PI_TIMES_2:R>Math.PI?R-f.PI_TIMES_2:R}}])})();Ui.PI_TIMES_2=2*Math.PI,Ui.PI_OVER_2=Math.PI/2,Ui.PI_OVER_4=Math.PI/4,Ui.COUNTERCLOCKWISE=tn.COUNTERCLOCKWISE,Ui.CLOCKWISE=tn.CLOCKWISE,Ui.NONE=tn.COLLINEAR;var to=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"addNextSegment",value:function(i,s){if(this._s0=this._s1,this._s1=this._s2,this._s2=i,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var h=tn.index(this._s0,this._s1,this._s2),b=h===tn.CLOCKWISE&&this._side===lt.LEFT||h===tn.COUNTERCLOCKWISE&&this._side===lt.RIGHT;h===0?this.addCollinear(s):b?this.addOutsideTurn(h,s):this.addInsideTurn(h,s)}},{key:"addLineEndCap",value:function(i,s){var h=new $r(i,s),b=new $r;this.computeOffsetSegment(h,lt.LEFT,this._distance,b);var R=new $r;this.computeOffsetSegment(h,lt.RIGHT,this._distance,R);var B=s.x-i.x,H=s.y-i.y,re=Math.atan2(H,B);switch(this._bufParams.getEndCapStyle()){case Ge.CAP_ROUND:this._segList.addPt(b.p1),this.addDirectedFillet(s,re+Math.PI/2,re-Math.PI/2,tn.CLOCKWISE,this._distance),this._segList.addPt(R.p1);break;case Ge.CAP_FLAT:this._segList.addPt(b.p1),this._segList.addPt(R.p1);break;case Ge.CAP_SQUARE:var de=new Ne;de.x=Math.abs(this._distance)*Math.cos(re),de.y=Math.abs(this._distance)*Math.sin(re);var De=new Ne(b.p1.x+de.x,b.p1.y+de.y),$e=new Ne(R.p1.x+de.x,R.p1.y+de.y);this._segList.addPt(De),this._segList.addPt($e)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(i,s,h,b){var R=pn.intersection(s.p0,s.p1,h.p0,h.p1);if(R!==null&&(b<=0?1:R.distance(i)/Math.abs(b))<=this._bufParams.getMitreLimit())return this._segList.addPt(R),null;this.addLimitedMitreJoin(s,h,b,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(i,s){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*f.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Ge.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Ge.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(s&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,i,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(i){this._segList.addPt(new Ne(i.x+this._distance,i.y+this._distance)),this._segList.addPt(new Ne(i.x+this._distance,i.y-this._distance)),this._segList.addPt(new Ne(i.x-this._distance,i.y-this._distance)),this._segList.addPt(new Ne(i.x-this._distance,i.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(i,s){this._segList.addPts(i,s)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(i,s,h,b,R){var B=s.x-i.x,H=s.y-i.y,re=Math.atan2(H,B),de=h.x-i.x,De=h.y-i.y,$e=Math.atan2(De,de);b===tn.CLOCKWISE?re<=$e&&(re+=2*Math.PI):re>=$e&&(re-=2*Math.PI),this._segList.addPt(s),this.addDirectedFillet(i,re,$e,b,R),this._segList.addPt(h)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(i,s,h){this._s1=i,this._s2=s,this._side=h,this._seg1.setCoordinates(i,s),this.computeOffsetSegment(this._seg1,h,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(i,s,h,b){var R=this._seg0.p1,B=Ui.angle(R,this._seg0.p0),H=Ui.angleBetweenOriented(this._seg0.p0,R,this._seg1.p1)/2,re=Ui.normalize(B+H),de=Ui.normalize(re+Math.PI),De=b*h,$e=h-De*Math.abs(Math.sin(H)),ct=R.x+De*Math.cos(de),At=R.y+De*Math.sin(de),Ht=new Ne(ct,At),ln=new $r(R,Ht),Nn=ln.pointAlongOffset(1,$e),An=ln.pointAlongOffset(1,-$e);this._side===lt.LEFT?(this._segList.addPt(Nn),this._segList.addPt(An)):(this._segList.addPt(An),this._segList.addPt(Nn))}},{key:"addDirectedFillet",value:function(i,s,h,b,R){var B=b===tn.CLOCKWISE?-1:1,H=Math.abs(s-h),re=Math.trunc(H/this._filletAngleQuantum+.5);if(re<1)return null;for(var de=H/re,De=new Ne,$e=0;$e<re;$e++){var ct=s+B*$e*de;De.x=i.x+R*Math.cos(ct),De.y=i.y+R*Math.sin(ct),this._segList.addPt(De)}}},{key:"computeOffsetSegment",value:function(i,s,h,b){var R=s===lt.LEFT?1:-1,B=i.p1.x-i.p0.x,H=i.p1.y-i.p0.y,re=Math.sqrt(B*B+H*H),de=R*h*B/re,De=R*h*H/re;b.p0.x=i.p0.x-De,b.p0.y=i.p0.y+de,b.p1.x=i.p1.x-De,b.p1.y=i.p1.y+de}},{key:"addInsideTurn",value:function(i,s){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*f.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var h=new Ne((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(h);var b=new Ne((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(b)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(i){var s=new Ne(i.x+this._distance,i.y);this._segList.addPt(s),this.addDirectedFillet(i,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(i,s){this._segList.addPt(i.p1),this._segList.addPt(s.p0)}},{key:"init",value:function(i){this._distance=i,this._maxCurveSegmentError=i*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new tl,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(i*f.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(i){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Ge.JOIN_BEVEL||this._bufParams.getJoinStyle()===Ge.JOIN_MITRE?(i&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,tn.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new $r,this._seg1=new $r,this._offset0=new $r,this._offset1=new $r,this._side=0,this._hasNarrowConcaveAngle=!1;var i=arguments[0],s=arguments[1],h=arguments[2];this._precisionModel=i,this._bufParams=s,this._li=new Rs,this._filletAngleQuantum=Math.PI/2/s.getQuadrantSegments(),s.getQuadrantSegments()>=8&&s.getJoinStyle()===Ge.JOIN_ROUND&&(this._closingSegLengthFactor=f.MAX_CLOSING_SEG_LEN_FACTOR),this.init(h)}}])})();to.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,to.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,to.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,to.MAX_CLOSING_SEG_LEN_FACTOR=80;var nl=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"getOffsetCurve",value:function(i,s){if(this._distance=s,s===0)return null;var h=s<0,b=Math.abs(s),R=this.getSegGen(b);i.length<=1?this.computePointCurve(i[0],R):this.computeOffsetCurve(i,h,R);var B=R.getCoordinates();return h&&Bn.reverse(B),B}},{key:"computeSingleSidedBufferCurve",value:function(i,s,h){var b=this.simplifyTolerance(this._distance);if(s){h.addSegments(i,!0);var R=es.simplify(i,-b),B=R.length-1;h.initSideSegments(R[B],R[B-1],lt.LEFT),h.addFirstSegment();for(var H=B-2;H>=0;H--)h.addNextSegment(R[H],!0)}else{h.addSegments(i,!1);var re=es.simplify(i,b),de=re.length-1;h.initSideSegments(re[0],re[1],lt.LEFT),h.addFirstSegment();for(var De=2;De<=de;De++)h.addNextSegment(re[De],!0)}h.addLastSegment(),h.closeRing()}},{key:"computeRingBufferCurve",value:function(i,s,h){var b=this.simplifyTolerance(this._distance);s===lt.RIGHT&&(b=-b);var R=es.simplify(i,b),B=R.length-1;h.initSideSegments(R[B-1],R[0],s);for(var H=1;H<=B;H++){var re=H!==1;h.addNextSegment(R[H],re)}h.closeRing()}},{key:"computeLineBufferCurve",value:function(i,s){var h=this.simplifyTolerance(this._distance),b=es.simplify(i,h),R=b.length-1;s.initSideSegments(b[0],b[1],lt.LEFT);for(var B=2;B<=R;B++)s.addNextSegment(b[B],!0);s.addLastSegment(),s.addLineEndCap(b[R-1],b[R]);var H=es.simplify(i,-h),re=H.length-1;s.initSideSegments(H[re],H[re-1],lt.LEFT);for(var de=re-2;de>=0;de--)s.addNextSegment(H[de],!0);s.addLastSegment(),s.addLineEndCap(H[1],H[0]),s.closeRing()}},{key:"computePointCurve",value:function(i,s){switch(this._bufParams.getEndCapStyle()){case Ge.CAP_ROUND:s.createCircle(i);break;case Ge.CAP_SQUARE:s.createSquare(i)}}},{key:"getLineCurve",value:function(i,s){if(this._distance=s,this.isLineOffsetEmpty(s))return null;var h=Math.abs(s),b=this.getSegGen(h);if(i.length<=1)this.computePointCurve(i[0],b);else if(this._bufParams.isSingleSided()){var R=s<0;this.computeSingleSidedBufferCurve(i,R,b)}else this.computeLineBufferCurve(i,b);return b.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(i){return i*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(i,s,h){if(this._distance=h,i.length<=2)return this.getLineCurve(i,h);if(h===0)return f.copyCoordinates(i);var b=this.getSegGen(h);return this.computeRingBufferCurve(i,s,b),b.getCoordinates()}},{key:"computeOffsetCurve",value:function(i,s,h){var b=this.simplifyTolerance(this._distance);if(s){var R=es.simplify(i,-b),B=R.length-1;h.initSideSegments(R[B],R[B-1],lt.LEFT),h.addFirstSegment();for(var H=B-2;H>=0;H--)h.addNextSegment(R[H],!0)}else{var re=es.simplify(i,b),de=re.length-1;h.initSideSegments(re[0],re[1],lt.LEFT),h.addFirstSegment();for(var De=2;De<=de;De++)h.addNextSegment(re[De],!0)}h.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(i){return i===0||i<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(i){return new to(this._precisionModel,this._bufParams,i)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var i=arguments[0],s=arguments[1];this._precisionModel=i,this._bufParams=s}},{key:"copyCoordinates",value:function(i){for(var s=new Array(i.length).fill(null),h=0;h<s.length;h++)s[h]=new Ne(i[h]);return s}}])})(),Il=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var f=arguments[0],i=new pt,s=this._subgraphs.iterator();s.hasNext();){var h=s.next(),b=h.getEnvelope();f.y<b.getMinY()||f.y>b.getMaxY()||this.findStabbedSegments(f,h.getDirectedEdges(),i)}return i}if(arguments.length===3){if(vn(arguments[2],pr)&&arguments[0]instanceof Ne&&arguments[1]instanceof Jo){for(var R=arguments[0],B=arguments[1],H=arguments[2],re=B.getEdge().getCoordinates(),de=0;de<re.length-1;de++)if(this._seg.p0=re[de],this._seg.p1=re[de+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<R.x||this._seg.isHorizontal()||R.y<this._seg.p0.y||R.y>this._seg.p1.y||tn.index(this._seg.p0,this._seg.p1,R)===tn.RIGHT)){var De=B.getDepth(lt.LEFT);this._seg.p0.equals(re[de])||(De=B.getDepth(lt.RIGHT));var $e=new il(this._seg,De);H.add($e)}}else if(vn(arguments[2],pr)&&arguments[0]instanceof Ne&&vn(arguments[1],pr))for(var ct=arguments[0],At=arguments[2],Ht=arguments[1].iterator();Ht.hasNext();){var ln=Ht.next();ln.isForward()&&this.findStabbedSegments(ct,ln,At)}}}},{key:"getDepth",value:function(f){var i=this.findStabbedSegments(f);return i.size()===0?0:Ja.min(i)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new $r;var f=arguments[0];this._subgraphs=f}}])})(),il=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"compareTo",value:function(f){var i=f;if(this._upwardSeg.minX()>=i._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=i._upwardSeg.minX())return-1;var s=this._upwardSeg.orientationIndex(i._upwardSeg);return s!==0||(s=-1*i._upwardSeg.orientationIndex(this._upwardSeg))!==0?s:this._upwardSeg.compareTo(i._upwardSeg)}},{key:"compareX",value:function(f,i){var s=f.p0.compareTo(i.p0);return s!==0?s:f.p1.compareTo(i.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[at]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var f=arguments[0],i=arguments[1];this._upwardSeg=new $r(f),this._leftDepth=i}}])})();Il.DepthSegment=il;var Tl=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,null,[{key:"constructor_",value:function(){it.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])})(it),Os=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"getY",value:function(){var i=this.y/this.w;if(nt.isNaN(i)||nt.isInfinite(i))throw new Tl;return i}},{key:"getX",value:function(){var i=this.x/this.w;if(nt.isNaN(i)||nt.isInfinite(i))throw new Tl;return i}},{key:"getCoordinate",value:function(){var i=new Ne;return i.x=this.getX(),i.y=this.getY(),i}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var i=arguments[0];this.x=i.x,this.y=i.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],h=arguments[1];this.x=s,this.y=h,this.w=1}else if(arguments[0]instanceof f&&arguments[1]instanceof f){var b=arguments[0],R=arguments[1];this.x=b.y*R.w-R.y*b.w,this.y=R.x*b.w-b.x*R.w,this.w=b.x*R.y-R.x*b.y}else if(arguments[0]instanceof Ne&&arguments[1]instanceof Ne){var B=arguments[0],H=arguments[1];this.x=B.y-H.y,this.y=H.x-B.x,this.w=B.x*H.y-H.x*B.y}}else if(arguments.length===3){var re=arguments[0],de=arguments[1],De=arguments[2];this.x=re,this.y=de,this.w=De}else if(arguments.length===4){var $e=arguments[0],ct=arguments[1],At=arguments[2],Ht=arguments[3],ln=$e.y-ct.y,Nn=ct.x-$e.x,An=$e.x*ct.y-ct.x*$e.y,Vn=At.y-Ht.y,Ci=Ht.x-At.x,Kn=At.x*Ht.y-Ht.x*At.y;this.x=Nn*Kn-Ci*An,this.y=Vn*An-ln*Kn,this.w=ln*Ci-Vn*Nn}}}])})(),lu=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"area",value:function(){return f.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return f.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(i){if(i===null)throw new We("Supplied point is null.");return f.interpolateZ(i,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return f.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return f.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return f.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return f.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return f.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return f.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var i=arguments[0],s=arguments[1],h=arguments[2];this.p0=i,this.p1=s,this.p2=h}},{key:"area",value:function(i,s,h){return Math.abs(((h.x-i.x)*(s.y-i.y)-(s.x-i.x)*(h.y-i.y))/2)}},{key:"signedArea",value:function(i,s,h){return((h.x-i.x)*(s.y-i.y)-(s.x-i.x)*(h.y-i.y))/2}},{key:"det",value:function(i,s,h,b){return i*b-s*h}},{key:"interpolateZ",value:function(i,s,h,b){var R=s.x,B=s.y,H=h.x-R,re=b.x-R,de=h.y-B,De=b.y-B,$e=H*De-re*de,ct=i.x-R,At=i.y-B,Ht=(De*ct-re*At)/$e,ln=(-de*ct+H*At)/$e;return s.getZ()+Ht*(h.getZ()-s.getZ())+ln*(b.getZ()-s.getZ())}},{key:"longestSideLength",value:function(i,s,h){var b=i.distance(s),R=s.distance(h),B=h.distance(i),H=b;return R>H&&(H=R),B>H&&(H=B),H}},{key:"circumcentreDD",value:function(i,s,h){var b=Qe.valueOf(i.x).subtract(h.x),R=Qe.valueOf(i.y).subtract(h.y),B=Qe.valueOf(s.x).subtract(h.x),H=Qe.valueOf(s.y).subtract(h.y),re=Qe.determinant(b,R,B,H).multiply(2),de=b.sqr().add(R.sqr()),De=B.sqr().add(H.sqr()),$e=Qe.determinant(R,de,H,De),ct=Qe.determinant(b,de,B,De),At=Qe.valueOf(h.x).subtract($e.divide(re)).doubleValue(),Ht=Qe.valueOf(h.y).add(ct.divide(re)).doubleValue();return new Ne(At,Ht)}},{key:"isAcute",value:function(i,s,h){return!!Ui.isAcute(i,s,h)&&!!Ui.isAcute(s,h,i)&&!!Ui.isAcute(h,i,s)}},{key:"circumcentre",value:function(i,s,h){var b=h.x,R=h.y,B=i.x-b,H=i.y-R,re=s.x-b,de=s.y-R,De=2*f.det(B,H,re,de),$e=f.det(H,B*B+H*H,de,re*re+de*de),ct=f.det(B,B*B+H*H,re,re*re+de*de);return new Ne(b-$e/De,R+ct/De)}},{key:"perpendicularBisector",value:function(i,s){var h=s.x-i.x,b=s.y-i.y,R=new Os(i.x+h/2,i.y+b/2,1),B=new Os(i.x-b+h/2,i.y+h+b/2,1);return new Os(R,B)}},{key:"angleBisector",value:function(i,s,h){var b=s.distance(i),R=b/(b+s.distance(h)),B=h.x-i.x,H=h.y-i.y;return new Ne(i.x+R*B,i.y+R*H)}},{key:"area3D",value:function(i,s,h){var b=s.x-i.x,R=s.y-i.y,B=s.getZ()-i.getZ(),H=h.x-i.x,re=h.y-i.y,de=h.getZ()-i.getZ(),De=R*de-B*re,$e=B*H-b*de,ct=b*re-R*H,At=De*De+$e*$e+ct*ct,Ht=Math.sqrt(At)/2;return Ht}},{key:"centroid",value:function(i,s,h){var b=(i.x+s.x+h.x)/3,R=(i.y+s.y+h.y)/3;return new Ne(b,R)}},{key:"inCentre",value:function(i,s,h){var b=s.distance(h),R=i.distance(h),B=i.distance(s),H=b+R+B,re=(b*i.x+R*s.x+B*h.x)/H,de=(b*i.y+R*s.y+B*h.y)/H;return new Ne(re,de)}}])})(),dc=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"addRingSide",value:function(f,i,s,h,b){if(i===0&&f.length<pi.MINIMUM_VALID_SIZE)return null;var R=h,B=b;f.length>=pi.MINIMUM_VALID_SIZE&&tn.isCCW(f)&&(R=b,B=h,s=lt.opposite(s));var H=this._curveBuilder.getRingCurve(f,s,i);this.addCurve(H,R,B)}},{key:"addRingBothSides",value:function(f,i){this.addRingSide(f,i,lt.LEFT,we.EXTERIOR,we.INTERIOR),this.addRingSide(f,i,lt.RIGHT,we.INTERIOR,we.EXTERIOR)}},{key:"addPoint",value:function(f){if(this._distance<=0)return null;var i=f.getCoordinates(),s=this._curveBuilder.getLineCurve(i,this._distance);this.addCurve(s,we.EXTERIOR,we.INTERIOR)}},{key:"addPolygon",value:function(f){var i=this._distance,s=lt.LEFT;this._distance<0&&(i=-this._distance,s=lt.RIGHT);var h=f.getExteriorRing(),b=Bn.removeRepeatedPoints(h.getCoordinates());if(this._distance<0&&this.isErodedCompletely(h,this._distance)||this._distance<=0&&b.length<3)return null;this.addRingSide(b,i,s,we.EXTERIOR,we.INTERIOR);for(var R=0;R<f.getNumInteriorRing();R++){var B=f.getInteriorRingN(R),H=Bn.removeRepeatedPoints(B.getCoordinates());this._distance>0&&this.isErodedCompletely(B,-this._distance)||this.addRingSide(H,i,lt.opposite(s),we.INTERIOR,we.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(f,i){var s=new lu(f[0],f[1],f[2]),h=s.inCentre();return Ai.pointToSegment(h,s.p0,s.p1)<Math.abs(i)}},{key:"addLineString",value:function(f){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var i=Bn.removeRepeatedPoints(f.getCoordinates());if(Bn.isRing(i)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(i,this._distance);else{var s=this._curveBuilder.getLineCurve(i,this._distance);this.addCurve(s,we.EXTERIOR,we.INTERIOR)}}},{key:"addCurve",value:function(f,i,s){if(f===null||f.length<2)return null;var h=new _s(f,new Yn(0,we.BOUNDARY,i,s));this._curveList.add(h)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(f){if(f.isEmpty())return null;if(f instanceof Ut)this.addPolygon(f);else if(f instanceof Fe)this.addLineString(f);else if(f instanceof Ke)this.addPoint(f);else if(f instanceof Sn)this.addCollection(f);else if(f instanceof sr)this.addCollection(f);else if(f instanceof yr)this.addCollection(f);else{if(!(f instanceof kn))throw new Rr(f.getGeometryType());this.addCollection(f)}}},{key:"isErodedCompletely",value:function(f,i){var s=f.getCoordinates();if(s.length<4)return i<0;if(s.length===4)return this.isTriangleErodedCompletely(s,i);var h=f.getEnvelopeInternal(),b=Math.min(h.getHeight(),h.getWidth());return i<0&&2*Math.abs(i)>b}},{key:"addCollection",value:function(f){for(var i=0;i<f.getNumGeometries();i++){var s=f.getGeometryN(i);this.add(s)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new pt;var f=arguments[0],i=arguments[1],s=arguments[2];this._inputGeom=f,this._distance=i,this._curveBuilder=s}}])})(),Ni=(function(){return c((function f(){T(this,f)}),[{key:"locate",value:function(f){}}])})(),pc=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,f.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Vr;var i=this._parent.getGeometryN(this._index++);return i instanceof kn?(this._subcollectionIterator=new f(i),this._subcollectionIterator.next()):i}},{key:"remove",value:function(){throw new Rr(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[kl]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var i=arguments[0];this._parent=i,this._atStart=!0,this._index=0,this._max=i.getNumGeometries()}},{key:"isAtomic",value:function(i){return!(i instanceof kn)}}])})(),Mn=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"locate",value:function(i){return f.locate(i,this._geom)}},{key:"interfaces_",get:function(){return[Ni]}}],[{key:"constructor_",value:function(){this._geom=null;var i=arguments[0];this._geom=i}},{key:"locatePointInPolygon",value:function(i,s){if(s.isEmpty())return we.EXTERIOR;var h=s.getExteriorRing(),b=f.locatePointInRing(i,h);if(b!==we.INTERIOR)return b;for(var R=0;R<s.getNumInteriorRing();R++){var B=s.getInteriorRingN(R),H=f.locatePointInRing(i,B);if(H===we.BOUNDARY)return we.BOUNDARY;if(H===we.INTERIOR)return we.EXTERIOR}return we.INTERIOR}},{key:"locatePointInRing",value:function(i,s){return s.getEnvelopeInternal().intersects(i)?_r.locateInRing(i,s.getCoordinates()):we.EXTERIOR}},{key:"containsPointInPolygon",value:function(i,s){return we.EXTERIOR!==f.locatePointInPolygon(i,s)}},{key:"locateInGeometry",value:function(i,s){if(s instanceof Ut)return f.locatePointInPolygon(i,s);if(s instanceof kn)for(var h=new pc(s);h.hasNext();){var b=h.next();if(b!==s){var R=f.locateInGeometry(i,b);if(R!==we.EXTERIOR)return R}}return we.EXTERIOR}},{key:"isContained",value:function(i,s){return we.EXTERIOR!==f.locate(i,s)}},{key:"locate",value:function(i,s){return s.isEmpty()?we.EXTERIOR:s.getEnvelopeInternal().intersects(i)?f.locateInGeometry(i,s):we.EXTERIOR}}])})(),Cl=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"getNextCW",value:function(f){this.getEdges();var i=this._edgeList.indexOf(f),s=i-1;return i===0&&(s=this._edgeList.size()-1),this._edgeList.get(s)}},{key:"propagateSideLabels",value:function(f){for(var i=we.NONE,s=this.iterator();s.hasNext();){var h=s.next().getLabel();h.isArea(f)&&h.getLocation(f,lt.LEFT)!==we.NONE&&(i=h.getLocation(f,lt.LEFT))}if(i===we.NONE)return null;for(var b=i,R=this.iterator();R.hasNext();){var B=R.next(),H=B.getLabel();if(H.getLocation(f,lt.ON)===we.NONE&&H.setLocation(f,lt.ON,b),H.isArea(f)){var re=H.getLocation(f,lt.LEFT),de=H.getLocation(f,lt.RIGHT);if(de!==we.NONE){if(de!==b)throw new _t("side location conflict",B.getCoordinate());re===we.NONE&&Pt.shouldNeverReachHere("found single null side (at "+B.getCoordinate()+")"),b=re}else Pt.isTrue(H.getLocation(f,lt.LEFT)===we.NONE,"found single null side"),H.setLocation(f,lt.RIGHT,b),H.setLocation(f,lt.LEFT,b)}}}},{key:"getCoordinate",value:function(){var f=this.iterator();return f.hasNext()?f.next().getCoordinate():null}},{key:"print",value:function(f){Si.out.println("EdgeEndStar:   "+this.getCoordinate());for(var i=this.iterator();i.hasNext();)i.next().print(f)}},{key:"isAreaLabelsConsistent",value:function(f){return this.computeEdgeEndLabels(f.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(f){var i=this.getEdges();if(i.size()<=0)return!0;var s=i.size()-1,h=i.get(s).getLabel().getLocation(f,lt.LEFT);Pt.isTrue(h!==we.NONE,"Found unlabelled area edge");for(var b=h,R=this.iterator();R.hasNext();){var B=R.next().getLabel();Pt.isTrue(B.isArea(f),"Found non-area edge");var H=B.getLocation(f,lt.LEFT),re=B.getLocation(f,lt.RIGHT);if(H===re||re!==b)return!1;b=H}return!0}},{key:"findIndex",value:function(f){this.iterator();for(var i=0;i<this._edgeList.size();i++)if(this._edgeList.get(i)===f)return i;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new pt(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(f,i,s){return this._ptInAreaLocation[f]===we.NONE&&(this._ptInAreaLocation[f]=Mn.locate(i,s[f].getGeometry())),this._ptInAreaLocation[f]}},{key:"toString",value:function(){var f=new ir;f.append("EdgeEndStar:   "+this.getCoordinate()),f.append(`
`);for(var i=this.iterator();i.hasNext();){var s=i.next();f.append(s),f.append(`
`)}return f.toString()}},{key:"computeEdgeEndLabels",value:function(f){for(var i=this.iterator();i.hasNext();)i.next().computeLabel(f)}},{key:"computeLabelling",value:function(f){this.computeEdgeEndLabels(f[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var i=[!1,!1],s=this.iterator();s.hasNext();)for(var h=s.next().getLabel(),b=0;b<2;b++)h.isLine(b)&&h.getLocation(b)===we.BOUNDARY&&(i[b]=!0);for(var R=this.iterator();R.hasNext();)for(var B=R.next(),H=B.getLabel(),re=0;re<2;re++)if(H.isAnyNull(re)){var de=we.NONE;if(i[re])de=we.EXTERIOR;else{var De=B.getCoordinate();de=this.getLocation(re,De,f)}H.setAllLocationsIfNull(re,de)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(f,i){this._edgeMap.put(f,i),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new zs,this._edgeList=null,this._ptInAreaLocation=[we.NONE,we.NONE]}}])})(),oi=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var s=null,h=null,b=this._SCANNING_FOR_INCOMING,R=0;R<this._resultAreaEdgeList.size();R++){var B=this._resultAreaEdgeList.get(R),H=B.getSym();if(B.getLabel().isArea())switch(s===null&&B.isInResult()&&(s=B),b){case this._SCANNING_FOR_INCOMING:if(!H.isInResult())continue;h=H,b=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!B.isInResult())continue;h.setNext(B),b=this._SCANNING_FOR_INCOMING}}if(b===this._LINKING_TO_OUTGOING){if(s===null)throw new _t("no outgoing dirEdge found",this.getCoordinate());Pt.isTrue(s.isInResult(),"unable to link last incoming dirEdge"),h.setNext(s)}}},{key:"insert",value:function(s){var h=s;this.insertEdgeEnd(h,h)}},{key:"getRightmostEdge",value:function(){var s=this.getEdges(),h=s.size();if(h<1)return null;var b=s.get(0);if(h===1)return b;var R=s.get(h-1),B=b.getQuadrant(),H=R.getQuadrant();return Ri.isNorthern(B)&&Ri.isNorthern(H)?b:Ri.isNorthern(B)||Ri.isNorthern(H)?b.getDy()!==0?b:R.getDy()!==0?R:(Pt.shouldNeverReachHere("found two horizontal edges incident on node"),null):R}},{key:"print",value:function(s){Si.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var h=this.iterator();h.hasNext();){var b=h.next();s.print("out "),b.print(s),s.println(),s.print("in "),b.getSym().print(s),s.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new pt;for(var s=this.iterator();s.hasNext();){var h=s.next();(h.isInResult()||h.getSym().isInResult())&&this._resultAreaEdgeList.add(h)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(s){for(var h=this.iterator();h.hasNext();){var b=h.next().getLabel();b.setAllLocationsIfNull(0,s.getLocation(0)),b.setAllLocationsIfNull(1,s.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var s=null,h=null,b=this._edgeList.size()-1;b>=0;b--){var R=this._edgeList.get(b),B=R.getSym();h===null&&(h=B),s!==null&&B.setNext(s),s=R}h.setNext(s)}},{key:"computeDepths",value:function(){if(arguments.length===1){var s=arguments[0],h=this.findIndex(s),b=s.getDepth(lt.LEFT),R=s.getDepth(lt.RIGHT),B=this.computeDepths(h+1,this._edgeList.size(),b);if(this.computeDepths(0,h,B)!==R)throw new _t("depth mismatch at "+s.getCoordinate())}else if(arguments.length===3){for(var H=arguments[1],re=arguments[2],de=arguments[0];de<H;de++){var De=this._edgeList.get(de);De.setEdgeDepths(lt.RIGHT,re),re=De.getDepth(lt.LEFT)}return re}}},{key:"mergeSymLabels",value:function(){for(var s=this.iterator();s.hasNext();){var h=s.next();h.getLabel().merge(h.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(s){for(var h=null,b=null,R=this._SCANNING_FOR_INCOMING,B=this._resultAreaEdgeList.size()-1;B>=0;B--){var H=this._resultAreaEdgeList.get(B),re=H.getSym();switch(h===null&&H.getEdgeRing()===s&&(h=H),R){case this._SCANNING_FOR_INCOMING:if(re.getEdgeRing()!==s)continue;b=re,R=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(H.getEdgeRing()!==s)continue;b.setNextMin(H),R=this._SCANNING_FOR_INCOMING}}R===this._LINKING_TO_OUTGOING&&(Pt.isTrue(h!==null,"found null for first outgoing dirEdge"),Pt.isTrue(h.getEdgeRing()===s,"unable to link last incoming dirEdge"),b.setNextMin(h))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var s=0,h=this.iterator();h.hasNext();)h.next().isInResult()&&s++;return s}if(arguments.length===1){for(var b=arguments[0],R=0,B=this.iterator();B.hasNext();)B.next().getEdgeRing()===b&&R++;return R}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var s=we.NONE,h=this.iterator();h.hasNext();){var b=h.next(),R=b.getSym();if(!b.isLineEdge()){if(b.isInResult()){s=we.INTERIOR;break}if(R.isInResult()){s=we.EXTERIOR;break}}}if(s===we.NONE)return null;for(var B=s,H=this.iterator();H.hasNext();){var re=H.next(),de=re.getSym();re.isLineEdge()?re.getEdge().setCovered(B===we.INTERIOR):(re.isInResult()&&(B=we.EXTERIOR),de.isInResult()&&(B=we.INTERIOR))}}},{key:"computeLabelling",value:function(s){le(i,"computeLabelling",this,1).call(this,s),this._label=new Yn(we.NONE);for(var h=this.iterator();h.hasNext();)for(var b=h.next().getEdge().getLabel(),R=0;R<2;R++){var B=b.getLocation(R);B!==we.INTERIOR&&B!==we.BOUNDARY||this._label.setLocation(R,we.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])})(Cl),Qn=(function(f){function i(){return T(this,i),E(this,i)}return F(i,f),c(i,[{key:"createNode",value:function(s){return new Lo(s,new oi)}}])})(vl),ts=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"compareTo",value:function(i){var s=i;return f.compareOriented(this._pts,this._orientation,s._pts,s._orientation)}},{key:"interfaces_",get:function(){return[at]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var i=arguments[0];this._pts=i,this._orientation=f.orientation(i)}},{key:"orientation",value:function(i){return Bn.increasingDirection(i)===1}},{key:"compareOriented",value:function(i,s,h,b){for(var R=s?1:-1,B=b?1:-1,H=s?i.length:-1,re=b?h.length:-1,de=s?0:i.length-1,De=b?0:h.length-1;;){var $e=i[de].compareTo(h[De]);if($e!==0)return $e;var ct=(de+=R)===H,At=(De+=B)===re;if(ct&&!At)return-1;if(!ct&&At)return 1;if(ct&&At)return 0}}}])})(),rl=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"print",value:function(f){f.print("MULTILINESTRING ( ");for(var i=0;i<this._edges.size();i++){var s=this._edges.get(i);i>0&&f.print(","),f.print("(");for(var h=s.getCoordinates(),b=0;b<h.length;b++)b>0&&f.print(","),f.print(h[b].x+" "+h[b].y);f.println(")")}f.print(")  ")}},{key:"addAll",value:function(f){for(var i=f.iterator();i.hasNext();)this.add(i.next())}},{key:"findEdgeIndex",value:function(f){for(var i=0;i<this._edges.size();i++)if(this._edges.get(i).equals(f))return i;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(f){return this._edges.get(f)}},{key:"findEqualEdge",value:function(f){var i=new ts(f.getCoordinates());return this._ocaMap.get(i)}},{key:"add",value:function(f){this._edges.add(f);var i=new ts(f.getCoordinates());this._ocaMap.put(i,f)}}],[{key:"constructor_",value:function(){this._edges=new pt,this._ocaMap=new zs}}])})(),no=(function(){return c((function f(){T(this,f)}),[{key:"processIntersections",value:function(f,i,s,h){}},{key:"isDone",value:function(){}}])})(),Pl=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"isTrivialIntersection",value:function(i,s,h,b){if(i===h&&this._li.getIntersectionNum()===1){if(f.isAdjacentSegments(s,b))return!0;if(i.isClosed()){var R=i.size()-1;if(s===0&&b===R||b===0&&s===R)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(i,s,h,b){if(i===h&&s===b)return null;this.numTests++;var R=i.getCoordinates()[s],B=i.getCoordinates()[s+1],H=h.getCoordinates()[b],re=h.getCoordinates()[b+1];this._li.computeIntersection(R,B,H,re),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(i,s,h,b)||(this._hasIntersection=!0,i.addIntersections(this._li,s,0),h.addIntersections(this._li,b,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[no]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var i=arguments[0];this._li=i}},{key:"isAdjacentSegments",value:function(i,s){return Math.abs(i-s)===1}}])})(),Da=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(f){f.print(this.coord),f.print(" seg # = "+this.segmentIndex),f.println(" dist = "+this.dist)}},{key:"compareTo",value:function(f){var i=f;return this.compare(i.segmentIndex,i.dist)}},{key:"isEndPoint",value:function(f){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===f}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(f,i){return this.segmentIndex<f?-1:this.segmentIndex>f?1:this.dist<i?-1:this.dist>i?1:0}},{key:"interfaces_",get:function(){return[at]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var f=arguments[0],i=arguments[1],s=arguments[2];this.coord=new Ne(f),this.segmentIndex=i,this.dist=s}}])})(),io=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"print",value:function(f){f.println("Intersections:");for(var i=this.iterator();i.hasNext();)i.next().print(f)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(f){this.addEndpoints();for(var i=this.iterator(),s=i.next();i.hasNext();){var h=i.next(),b=this.createSplitEdge(s,h);f.add(b),s=h}}},{key:"addEndpoints",value:function(){var f=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[f],f,0)}},{key:"createSplitEdge",value:function(f,i){var s=i.segmentIndex-f.segmentIndex+2,h=this.edge.pts[i.segmentIndex],b=i.dist>0||!i.coord.equals2D(h);b||s--;var R=new Array(s).fill(null),B=0;R[B++]=new Ne(f.coord);for(var H=f.segmentIndex+1;H<=i.segmentIndex;H++)R[B++]=this.edge.pts[H];return b&&(R[B]=i.coord),new ro(R,new Yn(this.edge._label))}},{key:"add",value:function(f,i,s){var h=new Da(f,i,s),b=this._nodeMap.get(h);return b!==null?b:(this._nodeMap.put(h,h),h)}},{key:"isIntersection",value:function(f){for(var i=this.iterator();i.hasNext();)if(i.next().coord.equals(f))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new zs,this.edge=null;var f=arguments[0];this.edge=f}}])})(),Zr=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])||f.isTrue(this._matrix[we.INTERIOR][we.BOUNDARY])||f.isTrue(this._matrix[we.BOUNDARY][we.INTERIOR])||f.isTrue(this._matrix[we.BOUNDARY][we.BOUNDARY]))&&this._matrix[we.EXTERIOR][we.INTERIOR]===ae.FALSE&&this._matrix[we.EXTERIOR][we.BOUNDARY]===ae.FALSE}},{key:"isCoveredBy",value:function(){return(f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])||f.isTrue(this._matrix[we.INTERIOR][we.BOUNDARY])||f.isTrue(this._matrix[we.BOUNDARY][we.INTERIOR])||f.isTrue(this._matrix[we.BOUNDARY][we.BOUNDARY]))&&this._matrix[we.INTERIOR][we.EXTERIOR]===ae.FALSE&&this._matrix[we.BOUNDARY][we.EXTERIOR]===ae.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var i=arguments[0],s=0;s<i.length;s++){var h=Math.trunc(s/3),b=s%3;this._matrix[h][b]=ae.toDimensionValue(i.charAt(s))}else if(arguments.length===3){var R=arguments[0],B=arguments[1],H=arguments[2];this._matrix[R][B]=H}}},{key:"isContains",value:function(){return f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])&&this._matrix[we.EXTERIOR][we.INTERIOR]===ae.FALSE&&this._matrix[we.EXTERIOR][we.BOUNDARY]===ae.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var i=arguments[0],s=0;s<i.length;s++){var h=Math.trunc(s/3),b=s%3;this.setAtLeast(h,b,ae.toDimensionValue(i.charAt(s)))}else if(arguments.length===3){var R=arguments[0],B=arguments[1],H=arguments[2];this._matrix[R][B]<H&&(this._matrix[R][B]=H)}}},{key:"setAtLeastIfValid",value:function(i,s,h){i>=0&&s>=0&&this.setAtLeast(i,s,h)}},{key:"isWithin",value:function(){return f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])&&this._matrix[we.INTERIOR][we.EXTERIOR]===ae.FALSE&&this._matrix[we.BOUNDARY][we.EXTERIOR]===ae.FALSE}},{key:"isTouches",value:function(i,s){return i>s?this.isTouches(s,i):(i===ae.A&&s===ae.A||i===ae.L&&s===ae.L||i===ae.L&&s===ae.A||i===ae.P&&s===ae.A||i===ae.P&&s===ae.L)&&this._matrix[we.INTERIOR][we.INTERIOR]===ae.FALSE&&(f.isTrue(this._matrix[we.INTERIOR][we.BOUNDARY])||f.isTrue(this._matrix[we.BOUNDARY][we.INTERIOR])||f.isTrue(this._matrix[we.BOUNDARY][we.BOUNDARY]))}},{key:"isOverlaps",value:function(i,s){return i===ae.P&&s===ae.P||i===ae.A&&s===ae.A?f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])&&f.isTrue(this._matrix[we.INTERIOR][we.EXTERIOR])&&f.isTrue(this._matrix[we.EXTERIOR][we.INTERIOR]):i===ae.L&&s===ae.L&&this._matrix[we.INTERIOR][we.INTERIOR]===1&&f.isTrue(this._matrix[we.INTERIOR][we.EXTERIOR])&&f.isTrue(this._matrix[we.EXTERIOR][we.INTERIOR])}},{key:"isEquals",value:function(i,s){return i===s&&f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])&&this._matrix[we.INTERIOR][we.EXTERIOR]===ae.FALSE&&this._matrix[we.BOUNDARY][we.EXTERIOR]===ae.FALSE&&this._matrix[we.EXTERIOR][we.INTERIOR]===ae.FALSE&&this._matrix[we.EXTERIOR][we.BOUNDARY]===ae.FALSE}},{key:"toString",value:function(){for(var i=new fn("123456789"),s=0;s<3;s++)for(var h=0;h<3;h++)i.setCharAt(3*s+h,ae.toDimensionSymbol(this._matrix[s][h]));return i.toString()}},{key:"setAll",value:function(i){for(var s=0;s<3;s++)for(var h=0;h<3;h++)this._matrix[s][h]=i}},{key:"get",value:function(i,s){return this._matrix[i][s]}},{key:"transpose",value:function(){var i=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=i,i=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=i,i=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=i,this}},{key:"matches",value:function(i){if(i.length!==9)throw new We("Should be length 9: "+i);for(var s=0;s<3;s++)for(var h=0;h<3;h++)if(!f.matches(this._matrix[s][h],i.charAt(3*s+h)))return!1;return!0}},{key:"add",value:function(i){for(var s=0;s<3;s++)for(var h=0;h<3;h++)this.setAtLeast(s,h,i.get(s,h))}},{key:"isDisjoint",value:function(){return this._matrix[we.INTERIOR][we.INTERIOR]===ae.FALSE&&this._matrix[we.INTERIOR][we.BOUNDARY]===ae.FALSE&&this._matrix[we.BOUNDARY][we.INTERIOR]===ae.FALSE&&this._matrix[we.BOUNDARY][we.BOUNDARY]===ae.FALSE}},{key:"isCrosses",value:function(i,s){return i===ae.P&&s===ae.L||i===ae.P&&s===ae.A||i===ae.L&&s===ae.A?f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])&&f.isTrue(this._matrix[we.INTERIOR][we.EXTERIOR]):i===ae.L&&s===ae.P||i===ae.A&&s===ae.P||i===ae.A&&s===ae.L?f.isTrue(this._matrix[we.INTERIOR][we.INTERIOR])&&f.isTrue(this._matrix[we.EXTERIOR][we.INTERIOR]):i===ae.L&&s===ae.L&&this._matrix[we.INTERIOR][we.INTERIOR]===0}},{key:"interfaces_",get:function(){return[ht]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map((function(){return Array(3)})),this.setAll(ae.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var i=arguments[0];f.constructor_.call(this),this.set(i)}else if(arguments[0]instanceof f){var s=arguments[0];f.constructor_.call(this),this._matrix[we.INTERIOR][we.INTERIOR]=s._matrix[we.INTERIOR][we.INTERIOR],this._matrix[we.INTERIOR][we.BOUNDARY]=s._matrix[we.INTERIOR][we.BOUNDARY],this._matrix[we.INTERIOR][we.EXTERIOR]=s._matrix[we.INTERIOR][we.EXTERIOR],this._matrix[we.BOUNDARY][we.INTERIOR]=s._matrix[we.BOUNDARY][we.INTERIOR],this._matrix[we.BOUNDARY][we.BOUNDARY]=s._matrix[we.BOUNDARY][we.BOUNDARY],this._matrix[we.BOUNDARY][we.EXTERIOR]=s._matrix[we.BOUNDARY][we.EXTERIOR],this._matrix[we.EXTERIOR][we.INTERIOR]=s._matrix[we.EXTERIOR][we.INTERIOR],this._matrix[we.EXTERIOR][we.BOUNDARY]=s._matrix[we.EXTERIOR][we.BOUNDARY],this._matrix[we.EXTERIOR][we.EXTERIOR]=s._matrix[we.EXTERIOR][we.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var i=arguments[0],s=arguments[1];return s===ae.SYM_DONTCARE||s===ae.SYM_TRUE&&(i>=0||i===ae.TRUE)||s===ae.SYM_FALSE&&i===ae.FALSE||s===ae.SYM_P&&i===ae.P||s===ae.SYM_L&&i===ae.L||s===ae.SYM_A&&i===ae.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var h=arguments[1];return new f(arguments[0]).matches(h)}}},{key:"isTrue",value:function(i){return i>=0||i===ae.TRUE}}])})(),Oa=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(i){return i===null||i.length===0?null:(this.ensureCapacity(this._size+i.length),Si.arraycopy(i,0,this._data,this._size,i.length),void(this._size+=i.length))}},{key:"ensureCapacity",value:function(i){if(i<=this._data.length)return null;var s=Math.max(i,2*this._data.length);this._data=Ze.copyOf(this._data,s)}},{key:"toArray",value:function(){var i=new Array(this._size).fill(null);return Si.arraycopy(this._data,0,i,0,this._size),i}},{key:"add",value:function(i){this.ensureCapacity(this._size+1),this._data[this._size]=i,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)f.constructor_.call(this,10);else if(arguments.length===1){var i=arguments[0];this._data=new Array(i).fill(null)}}}])})(),uu=(function(){function f(){T(this,f)}return c(f,[{key:"getChainStartIndices",value:function(i){var s=0,h=new Oa(Math.trunc(i.length/2));h.add(s);do{var b=this.findChainEnd(i,s);h.add(b),s=b}while(s<i.length-1);return h.toArray()}},{key:"findChainEnd",value:function(i,s){for(var h=Ri.quadrant(i[s],i[s+1]),b=s+1;b<i.length&&Ri.quadrant(i[b-1],i[b])===h;)b++;return b-1}},{key:"OLDgetChainStartIndices",value:function(i){var s=0,h=new pt;h.add(s);do{var b=this.findChainEnd(i,s);h.add(b),s=b}while(s<i.length-1);return f.toIntArray(h)}}],[{key:"toIntArray",value:function(i){for(var s=new Array(i.size()).fill(null),h=0;h<s.length;h++)s[h]=i.get(h).intValue();return s}}])})(),cu=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(f){var i=this.pts[this.startIndex[f]].x,s=this.pts[this.startIndex[f+1]].x;return i>s?i:s}},{key:"getMinX",value:function(f){var i=this.pts[this.startIndex[f]].x,s=this.pts[this.startIndex[f+1]].x;return i<s?i:s}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var f=arguments[0],i=arguments[1],s=arguments[2],h=arguments[3];this.computeIntersectsForChain(this.startIndex[f],this.startIndex[f+1],i,i.startIndex[s],i.startIndex[s+1],h)}else if(arguments.length===6){var b=arguments[0],R=arguments[1],B=arguments[2],H=arguments[3],re=arguments[4],de=arguments[5];if(R-b==1&&re-H==1)return de.addIntersections(this.e,b,B.e,H),null;if(!this.overlaps(b,R,B,H,re))return null;var De=Math.trunc((b+R)/2),$e=Math.trunc((H+re)/2);b<De&&(H<$e&&this.computeIntersectsForChain(b,De,B,H,$e,de),$e<re&&this.computeIntersectsForChain(b,De,B,$e,re,de)),De<R&&(H<$e&&this.computeIntersectsForChain(De,R,B,H,$e,de),$e<re&&this.computeIntersectsForChain(De,R,B,$e,re,de))}}},{key:"overlaps",value:function(f,i,s,h,b){return Cn.intersects(this.pts[f],this.pts[i],s.pts[h],s.pts[b])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(f,i){for(var s=0;s<this.startIndex.length-1;s++)for(var h=0;h<f.startIndex.length-1;h++)this.computeIntersectsForChain(s,f,h,i)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var f=arguments[0];this.e=f,this.pts=f.getCoordinates();var i=new uu;this.startIndex=i.getChainStartIndices(this.pts)}}])})(),Fa=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"getDepth",value:function(i,s){return this._depth[i][s]}},{key:"setDepth",value:function(i,s,h){this._depth[i][s]=h}},{key:"isNull",value:function(){if(arguments.length===0){for(var i=0;i<2;i++)for(var s=0;s<3;s++)if(this._depth[i][s]!==f.NULL_VALUE)return!1;return!0}if(arguments.length===1){var h=arguments[0];return this._depth[h][1]===f.NULL_VALUE}if(arguments.length===2){var b=arguments[0],R=arguments[1];return this._depth[b][R]===f.NULL_VALUE}}},{key:"normalize",value:function(){for(var i=0;i<2;i++)if(!this.isNull(i)){var s=this._depth[i][1];this._depth[i][2]<s&&(s=this._depth[i][2]),s<0&&(s=0);for(var h=1;h<3;h++){var b=0;this._depth[i][h]>s&&(b=1),this._depth[i][h]=b}}}},{key:"getDelta",value:function(i){return this._depth[i][lt.RIGHT]-this._depth[i][lt.LEFT]}},{key:"getLocation",value:function(i,s){return this._depth[i][s]<=0?we.EXTERIOR:we.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var i=arguments[0],s=0;s<2;s++)for(var h=1;h<3;h++){var b=i.getLocation(s,h);b!==we.EXTERIOR&&b!==we.INTERIOR||(this.isNull(s,h)?this._depth[s][h]=f.depthAtLocation(b):this._depth[s][h]+=f.depthAtLocation(b))}else if(arguments.length===3){var R=arguments[0],B=arguments[1];arguments[2]===we.INTERIOR&&this._depth[R][B]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var i=0;i<2;i++)for(var s=0;s<3;s++)this._depth[i][s]=f.NULL_VALUE}},{key:"depthAtLocation",value:function(i){return i===we.EXTERIOR?0:i===we.INTERIOR?1:f.NULL_VALUE}}])})();Fa.NULL_VALUE=-1;var ro=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var s=new Array(2).fill(null);return s[0]=this.pts[0],s[1]=this.pts[1],new i(s,Yn.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(s){this._isIsolated=s}},{key:"setName",value:function(s){this._name=s}},{key:"equals",value:function(s){if(!(s instanceof i))return!1;var h=s;if(this.pts.length!==h.pts.length)return!1;for(var b=!0,R=!0,B=this.pts.length,H=0;H<this.pts.length;H++)if(this.pts[H].equals2D(h.pts[H])||(b=!1),this.pts[H].equals2D(h.pts[--B])||(R=!1),!b&&!R)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var s=arguments[0];return this.pts[s]}}},{key:"print",value:function(s){s.print("edge "+this._name+": "),s.print("LINESTRING (");for(var h=0;h<this.pts.length;h++)h>0&&s.print(","),s.print(this.pts[h].x+" "+this.pts[h].y);s.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(s){i.updateIM(this._label,s)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(s){s.print("edge "+this._name+": ");for(var h=this.pts.length-1;h>=0;h--)s.print(this.pts[h]+" ");s.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new cu(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new Cn;for(var s=0;s<this.pts.length;s++)this._env.expandToInclude(this.pts[s])}return this._env}},{key:"addIntersection",value:function(s,h,b,R){var B=new Ne(s.getIntersection(R)),H=h,re=s.getEdgeDistance(b,R),de=H+1;if(de<this.pts.length){var De=this.pts[de];B.equals2D(De)&&(H=de,re=0)}this.eiList.add(B,H,re)}},{key:"toString",value:function(){var s=new fn;s.append("edge "+this._name+": "),s.append("LINESTRING (");for(var h=0;h<this.pts.length;h++)h>0&&s.append(","),s.append(this.pts[h].x+" "+this.pts[h].y);return s.append(")  "+this._label+" "+this._depthDelta),s.toString()}},{key:"isPointwiseEqual",value:function(s){if(this.pts.length!==s.pts.length)return!1;for(var h=0;h<this.pts.length;h++)if(!this.pts[h].equals2D(s.pts[h]))return!1;return!0}},{key:"setDepthDelta",value:function(s){this._depthDelta=s}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(s,h,b){for(var R=0;R<s.getIntersectionNum();R++)this.addIntersection(s,h,b,R)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new io(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Fa,this._depthDelta=0,arguments.length===1){var s=arguments[0];i.constructor_.call(this,s,null)}else if(arguments.length===2){var h=arguments[0],b=arguments[1];this.pts=h,this._label=b}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Zr&&arguments[0]instanceof Yn))return le(i,"updateIM",this).apply(this,arguments);var s=arguments[0],h=arguments[1];h.setAtLeastIfValid(s.getLocation(0,lt.ON),s.getLocation(1,lt.ON),1),s.isArea()&&(h.setAtLeastIfValid(s.getLocation(0,lt.LEFT),s.getLocation(1,lt.LEFT),2),h.setAtLeastIfValid(s.getLocation(0,lt.RIGHT),s.getLocation(1,lt.RIGHT),2))}}])})(Ko),so=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"setWorkingPrecisionModel",value:function(i){this._workingPrecisionModel=i}},{key:"insertUniqueEdge",value:function(i){var s=this._edgeList.findEqualEdge(i);if(s!==null){var h=s.getLabel(),b=i.getLabel();s.isPointwiseEqual(i)||(b=new Yn(i.getLabel())).flip(),h.merge(b);var R=f.depthDelta(b),B=s.getDepthDelta()+R;s.setDepthDelta(B)}else this._edgeList.add(i),i.setDepthDelta(f.depthDelta(i.getLabel()))}},{key:"buildSubgraphs",value:function(i,s){for(var h=new pt,b=i.iterator();b.hasNext();){var R=b.next(),B=R.getRightmostCoordinate(),H=new Il(h).getDepth(B);R.computeDepth(H),R.findResultEdges(),h.add(R),s.add(R.getDirectedEdges(),R.getNodes())}}},{key:"createSubgraphs",value:function(i){for(var s=new pt,h=i.getNodes().iterator();h.hasNext();){var b=h.next();if(!b.isVisited()){var R=new qr;R.create(b),s.add(R)}}return Ja.sort(s,Ja.reverseOrder()),s}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(i){if(this._workingNoder!==null)return this._workingNoder;var s=new El,h=new Rs;return h.setPrecisionModel(i),s.setSegmentIntersector(new Pl(h)),s}},{key:"buffer",value:function(i,s){var h=this._workingPrecisionModel;h===null&&(h=i.getPrecisionModel()),this._geomFact=i.getFactory();var b=new nl(h,this._bufParams),R=new dc(i,s,b).getCurves();if(R.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(R,h),this._graph=new Gr(new Qn),this._graph.addEdges(this._edgeList.getEdges());var B=this.createSubgraphs(this._graph),H=new xl(this._geomFact);this.buildSubgraphs(B,H);var re=H.getPolygons();return re.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(re)}},{key:"computeNodedEdges",value:function(i,s){var h=this.getNoder(s);h.computeNodes(i);for(var b=h.getNodedSubstrings().iterator();b.hasNext();){var R=b.next(),B=R.getCoordinates();if(B.length!==2||!B[0].equals2D(B[1])){var H=R.getData(),re=new ro(R.getCoordinates(),new Yn(H));this.insertUniqueEdge(re)}}}},{key:"setNoder",value:function(i){this._workingNoder=i}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new rl;var i=arguments[0];this._bufParams=i}},{key:"depthDelta",value:function(i){var s=i.getLocation(0,lt.LEFT),h=i.getLocation(0,lt.RIGHT);return s===we.INTERIOR&&h===we.EXTERIOR?1:s===we.EXTERIOR&&h===we.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(i){for(var s=new Qr,h=new pt;i.hasNext();){var b=i.next(),R=s.createLineString(b.getCoordinates());h.add(R)}return s.buildGeometry(h)}}])})(),Fs=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"rescale",value:function(){if(vn(arguments[0],$i))for(var i=arguments[0].iterator();i.hasNext();){var s=i.next();this.rescale(s.getCoordinates())}else if(arguments[0]instanceof Array){for(var h=arguments[0],b=0;b<h.length;b++)h[b].x=h[b].x/this._scaleFactor+this._offsetX,h[b].y=h[b].y/this._scaleFactor+this._offsetY;h.length===2&&h[0].equals2D(h[1])&&Si.out.println(h)}}},{key:"scale",value:function(){if(vn(arguments[0],$i)){for(var i=arguments[0],s=new pt(i.size()),h=i.iterator();h.hasNext();){var b=h.next();s.add(new _s(this.scale(b.getCoordinates()),b.getData()))}return s}if(arguments[0]instanceof Array){for(var R=arguments[0],B=new Array(R.length).fill(null),H=0;H<R.length;H++)B[H]=new Ne(Math.round((R[H].x-this._offsetX)*this._scaleFactor),Math.round((R[H].y-this._offsetY)*this._scaleFactor),R[H].getZ());return Bn.removeRepeatedPoints(B)}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var i=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(i),i}},{key:"computeNodes",value:function(i){var s=i;this._isScaled&&(s=this.scale(i)),this._noder.computeNodes(s)}},{key:"interfaces_",get:function(){return[Sl]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var i=arguments[0],s=arguments[1];f.constructor_.call(this,i,s,0,0)}else if(arguments.length===4){var h=arguments[0],b=arguments[1];this._noder=h,this._scaleFactor=b,this._isScaled=!this.isIntegerPrecision()}}}])})(),Bs=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var i=this._segStrings.iterator();i.hasNext();){var s=i.next().getCoordinates();this.checkEndPtVertexIntersections(s[0],this._segStrings),this.checkEndPtVertexIntersections(s[s.length-1],this._segStrings)}else if(arguments.length===2){for(var h=arguments[0],b=arguments[1].iterator();b.hasNext();)for(var R=b.next().getCoordinates(),B=1;B<R.length-1;B++)if(R[B].equals(h))throw new rt("found endpt/interior pt intersection at index "+B+" :pt "+h)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var i=this._segStrings.iterator();i.hasNext();)for(var s=i.next(),h=this._segStrings.iterator();h.hasNext();){var b=h.next();this.checkInteriorIntersections(s,b)}else if(arguments.length===2)for(var R=arguments[0],B=arguments[1],H=R.getCoordinates(),re=B.getCoordinates(),de=0;de<H.length-1;de++)for(var De=0;De<re.length-1;De++)this.checkInteriorIntersections(R,de,B,De);else if(arguments.length===4){var $e=arguments[0],ct=arguments[1],At=arguments[2],Ht=arguments[3];if($e===At&&ct===Ht)return null;var ln=$e.getCoordinates()[ct],Nn=$e.getCoordinates()[ct+1],An=At.getCoordinates()[Ht],Vn=At.getCoordinates()[Ht+1];if(this._li.computeIntersection(ln,Nn,An,Vn),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,ln,Nn)||this.hasInteriorIntersection(this._li,An,Vn)))throw new rt("found non-noded intersection at "+ln+"-"+Nn+" and "+An+"-"+Vn)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var i=this._segStrings.iterator();i.hasNext();){var s=i.next();this.checkCollapses(s)}else if(arguments.length===1)for(var h=arguments[0].getCoordinates(),b=0;b<h.length-2;b++)this.checkCollapse(h[b],h[b+1],h[b+2])}},{key:"hasInteriorIntersection",value:function(i,s,h){for(var b=0;b<i.getIntersectionNum();b++){var R=i.getIntersection(b);if(!R.equals(s)&&!R.equals(h))return!0}return!1}},{key:"checkCollapse",value:function(i,s,h){if(i.equals(h))throw new rt("found non-noded collapse at "+f.fact.createLineString([i,s,h]))}}],[{key:"constructor_",value:function(){this._li=new Rs,this._segStrings=null;var i=arguments[0];this._segStrings=i}}])})();Bs.fact=new Qr;var zo=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"intersectsScaled",value:function(i,s){var h=Math.min(i.x,s.x),b=Math.max(i.x,s.x),R=Math.min(i.y,s.y),B=Math.max(i.y,s.y),H=this._maxx<h||this._minx>b||this._maxy<R||this._miny>B;if(H)return!1;var re=this.intersectsToleranceSquare(i,s);return Pt.isTrue(!(H&&re),"Found bad envelope test"),re}},{key:"initCorners",value:function(i){var s=.5;this._minx=i.x-s,this._maxx=i.x+s,this._miny=i.y-s,this._maxy=i.y+s,this._corner[0]=new Ne(this._maxx,this._maxy),this._corner[1]=new Ne(this._minx,this._maxy),this._corner[2]=new Ne(this._minx,this._miny),this._corner[3]=new Ne(this._maxx,this._miny)}},{key:"intersects",value:function(i,s){return this._scaleFactor===1?this.intersectsScaled(i,s):(this.copyScaled(i,this._p0Scaled),this.copyScaled(s,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(i){return Math.round(i*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(i,s){s.x=this.scale(i.x),s.y=this.scale(i.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var i=f.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Cn(this._originalPt.x-i,this._originalPt.x+i,this._originalPt.y-i,this._originalPt.y+i)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(i,s){return this._li.computeIntersection(i,s,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(i,s,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(i,s,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(i,s,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(i,s){var h=!1,b=!1;return this._li.computeIntersection(i,s,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(i,s,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(h=!0),this._li.computeIntersection(i,s,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(b=!0),this._li.computeIntersection(i,s,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!h||!b)||!!i.equals(this._pt)||!!s.equals(this._pt))))}},{key:"addSnappedNode",value:function(i,s){var h=i.getCoordinate(s),b=i.getCoordinate(s+1);return!!this.intersects(h,b)&&(i.addIntersection(this.getCoordinate(),s),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var i=arguments[0],s=arguments[1],h=arguments[2];if(this._originalPt=i,this._pt=i,this._scaleFactor=s,this._li=h,s<=0)throw new We("Scale factor must be non-zero");s!==1&&(this._pt=new Ne(this.scale(i.x),this.scale(i.y)),this._p0Scaled=new Ne,this._p1Scaled=new Ne),this.initCorners(this._pt)}}])})();zo.SAFE_ENV_EXPANSION_FACTOR=.75;var fa=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var f=arguments[1];arguments[0].getLineSegment(f,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new $r}}])})(),ao=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"snap",value:function(){if(arguments.length===1){var f=arguments[0];return this.snap(f,null,-1)}if(arguments.length===3){var i=arguments[0],s=arguments[1],h=arguments[2],b=i.getSafeEnvelope(),R=new Ml(i,s,h);return this._index.query(b,new((function(){return c((function B(){T(this,B)}),[{key:"interfaces_",get:function(){return[wl]}},{key:"visitItem",value:function(B){B.select(b,R)}}])})())),R.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var f=arguments[0];this._index=f}}])})(),Ml=(function(f){function i(){var s;return T(this,i),s=E(this,i),i.constructor_.apply(s,arguments),s}return F(i,f),c(i,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof Ou))return le(i,"select",this,1).apply(this,arguments);var s=arguments[1],h=arguments[0].getContext();if(this._parentEdge===h&&(s===this._hotPixelVertexIndex||s+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(h,s)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var s=arguments[0],h=arguments[1],b=arguments[2];this._hotPixel=s,this._parentEdge=h,this._hotPixelVertexIndex=b}}])})(fa);ao.HotPixelSnapAction=Ml;var sl=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"processIntersections",value:function(f,i,s,h){if(f===s&&i===h)return null;var b=f.getCoordinates()[i],R=f.getCoordinates()[i+1],B=s.getCoordinates()[h],H=s.getCoordinates()[h+1];if(this._li.computeIntersection(b,R,B,H),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var re=0;re<this._li.getIntersectionNum();re++)this._interiorIntersections.add(this._li.getIntersection(re));f.addIntersections(this._li,i,0),s.addIntersections(this._li,h,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[no]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var f=arguments[0];this._li=f,this._interiorIntersections=new pt}}])})(),jn=(function(){return c((function f(){T(this,f),f.constructor_.apply(this,arguments)}),[{key:"checkCorrectness",value:function(f){var i=_s.getNodedSubstrings(f),s=new Bs(i);try{s.checkValid()}catch(h){if(!(h instanceof it))throw h;h.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return _s.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(f,i){var s=this.findInteriorIntersections(f,i);this.computeIntersectionSnaps(s),this.computeVertexSnaps(f)}},{key:"findInteriorIntersections",value:function(f,i){var s=new sl(i);return this._noder.setSegmentIntersector(s),this._noder.computeNodes(f),s.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(vn(arguments[0],$i))for(var f=arguments[0].iterator();f.hasNext();){var i=f.next();this.computeVertexSnaps(i)}else if(arguments[0]instanceof _s)for(var s=arguments[0],h=s.getCoordinates(),b=0;b<h.length;b++){var R=new zo(h[b],this._scaleFactor,this._li);this._pointSnapper.snap(R,s,b)&&s.addIntersection(h[b],b)}}},{key:"computeNodes",value:function(f){this._nodedSegStrings=f,this._noder=new El,this._pointSnapper=new ao(this._noder.getIndex()),this.snapRound(f,this._li)}},{key:"computeIntersectionSnaps",value:function(f){for(var i=f.iterator();i.hasNext();){var s=i.next(),h=new zo(s,this._scaleFactor,this._li);this._pointSnapper.snap(h)}}},{key:"interfaces_",get:function(){return[Sl]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var f=arguments[0];this._pm=f,this._li=new Rs,this._li.setPrecisionModel(f),this._scaleFactor=f.getScale()}}])})(),js=(function(){function f(){T(this,f),f.constructor_.apply(this,arguments)}return c(f,[{key:"bufferFixedPrecision",value:function(i){var s=new Fs(new jn(new Ii(1)),i.getScale()),h=new so(this._bufParams);h.setWorkingPrecisionModel(i),h.setNoder(s),this._resultGeometry=h.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var i=f.MAX_PRECISION_DIGITS;i>=0;i--){try{this.bufferReducedPrecision(i)}catch(R){if(!(R instanceof _t))throw R;this._saveException=R}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var s=arguments[0],h=f.precisionScaleFactor(this._argGeom,this._distance,s),b=new Ii(h);this.bufferFixedPrecision(b)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var i=this._argGeom.getFactory().getPrecisionModel();i.getType()===Ii.FIXED?this.bufferFixedPrecision(i):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(i){this._bufParams.setQuadrantSegments(i)}},{key:"bufferOriginalPrecision",value:function(){try{var i=new so(this._bufParams);this._resultGeometry=i.buffer(this._argGeom,this._distance)}catch(s){if(!(s instanceof rt))throw s;this._saveException=s}}},{key:"getResultGeometry",value:function(i){return this._distance=i,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(i){this._bufParams.setEndCapStyle(i)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Ge,this._resultGeometry=null,this._saveException=null,arguments.length===1){var i=arguments[0];this._argGeom=i}else if(arguments.length===2){var s=arguments[0],h=arguments[1];this._argGeom=s,this._bufParams=h}}},{key:"bufferOp",value:function(){if(arguments.length===2){var i=arguments[1];return new f(arguments[0]).getResultGeometry(i)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Kt&&typeof arguments[1]=="number"){var s=arguments[1],h=arguments[2],b=new f(arguments[0]);return b.setQuadrantSegments(h),b.getResultGeometry(s)}if(arguments[2]instanceof Ge&&arguments[0]instanceof Kt&&typeof arguments[1]=="number"){var R=arguments[1];return new f(arguments[0],arguments[2]).getResultGeometry(R)}}else if(arguments.length===4){var B=arguments[1],H=arguments[2],re=arguments[3],de=new f(arguments[0]);return de.setQuadrantSegments(H),de.setEndCapStyle(re),de.getResultGeometry(B)}}},{key:"precisionScaleFactor",value:function(i,s,h){var b=i.getEnvelopeInternal(),R=Sr.max(Math.abs(b.getMaxX()),Math.abs(b.getMaxY()),Math.abs(b.getMinX()),Math.abs(b.getMinY()))+2*(s>0?s:0),B=h-Math.trunc(Math.log(R)/Math.log(10)+1);return Math.pow(10,B)}}])})();js.CAP_ROUND=Ge.CAP_ROUND,js.CAP_BUTT=Ge.CAP_FLAT,js.CAP_FLAT=Ge.CAP_FLAT,js.CAP_SQUARE=Ge.CAP_SQUARE,js.MAX_PRECISION_DIGITS=12;var Fu=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Al=(function(){return c((function f(i){T(this,f),this.geometryFactory=i||new Qr}),[{key:"read",value:function(f){var i,s=(i=typeof f=="string"?JSON.parse(f):f).type;if(!ar[s])throw new Error("Unknown GeoJSON type: "+i.type);return Fu.indexOf(s)!==-1?ar[s].call(this,i.coordinates):s==="GeometryCollection"?ar[s].call(this,i.geometries):ar[s].call(this,i)}},{key:"write",value:function(f){var i=f.getGeometryType();if(!vs[i])throw new Error("Geometry is not supported");return vs[i].call(this,f)}}])})(),ar={Feature:function(f){var i={};for(var s in f)i[s]=f[s];if(f.geometry){var h=f.geometry.type;if(!ar[h])throw new Error("Unknown GeoJSON type: "+f.type);i.geometry=this.read(f.geometry)}return f.bbox&&(i.bbox=ar.bbox.call(this,f.bbox)),i},FeatureCollection:function(f){var i={};if(f.features){i.features=[];for(var s=0;s<f.features.length;++s)i.features.push(this.read(f.features[s]))}return f.bbox&&(i.bbox=this.parse.bbox.call(this,f.bbox)),i},coordinates:function(f){for(var i=[],s=0;s<f.length;++s){var h=f[s];i.push(N(Ne,fe(h)))}return i},bbox:function(f){return this.geometryFactory.createLinearRing([new Ne(f[0],f[1]),new Ne(f[2],f[1]),new Ne(f[2],f[3]),new Ne(f[0],f[3]),new Ne(f[0],f[1])])},Point:function(f){var i=N(Ne,fe(f));return this.geometryFactory.createPoint(i)},MultiPoint:function(f){for(var i=[],s=0;s<f.length;++s)i.push(ar.Point.call(this,f[s]));return this.geometryFactory.createMultiPoint(i)},LineString:function(f){var i=ar.coordinates.call(this,f);return this.geometryFactory.createLineString(i)},MultiLineString:function(f){for(var i=[],s=0;s<f.length;++s)i.push(ar.LineString.call(this,f[s]));return this.geometryFactory.createMultiLineString(i)},Polygon:function(f){for(var i=ar.coordinates.call(this,f[0]),s=this.geometryFactory.createLinearRing(i),h=[],b=1;b<f.length;++b){var R=f[b],B=ar.coordinates.call(this,R),H=this.geometryFactory.createLinearRing(B);h.push(H)}return this.geometryFactory.createPolygon(s,h)},MultiPolygon:function(f){for(var i=[],s=0;s<f.length;++s){var h=f[s];i.push(ar.Polygon.call(this,h))}return this.geometryFactory.createMultiPolygon(i)},GeometryCollection:function(f){for(var i=[],s=0;s<f.length;++s){var h=f[s];i.push(this.read(h))}return this.geometryFactory.createGeometryCollection(i)}},vs={coordinate:function(f){var i=[f.x,f.y];return f.z&&i.push(f.z),f.m&&i.push(f.m),i},Point:function(f){return{type:"Point",coordinates:vs.coordinate.call(this,f.getCoordinate())}},MultiPoint:function(f){for(var i=[],s=0;s<f._geometries.length;++s){var h=f._geometries[s],b=vs.Point.call(this,h);i.push(b.coordinates)}return{type:"MultiPoint",coordinates:i}},LineString:function(f){for(var i=[],s=f.getCoordinates(),h=0;h<s.length;++h){var b=s[h];i.push(vs.coordinate.call(this,b))}return{type:"LineString",coordinates:i}},MultiLineString:function(f){for(var i=[],s=0;s<f._geometries.length;++s){var h=f._geometries[s],b=vs.LineString.call(this,h);i.push(b.coordinates)}return{type:"MultiLineString",coordinates:i}},Polygon:function(f){var i=[],s=vs.LineString.call(this,f._shell);i.push(s.coordinates);for(var h=0;h<f._holes.length;++h){var b=f._holes[h],R=vs.LineString.call(this,b);i.push(R.coordinates)}return{type:"Polygon",coordinates:i}},MultiPolygon:function(f){for(var i=[],s=0;s<f._geometries.length;++s){var h=f._geometries[s],b=vs.Polygon.call(this,h);i.push(b.coordinates)}return{type:"MultiPolygon",coordinates:i}},GeometryCollection:function(f){for(var i=[],s=0;s<f._geometries.length;++s){var h=f._geometries[s],b=h.getGeometryType();i.push(vs[b].call(this,h))}return{type:"GeometryCollection",geometries:i}}};return{BufferOp:js,GeoJSONReader:(function(){return c((function f(i){T(this,f),this.parser=new Al(i||new Qr)}),[{key:"read",value:function(f){return this.parser.read(f)}}])})(),GeoJSONWriter:(function(){return c((function f(){T(this,f),this.parser=new Al(this.geometryFactory)}),[{key:"write",value:function(f){return this.parser.write(f)}}])})()}}))})(Gd)),Gd.exports}var B_=F_();const j_=Uf(B_);function cc(){return new Yd}function Yd(){this.reset()}Yd.prototype={constructor:Yd,reset:function(){this.s=this.t=0},add:function(k){fg(Bd,k,this.t),fg(this,Bd.s,this.s),this.s?this.t+=Bd.t:this.s=Bd.t},valueOf:function(){return this.s}};var Bd=new Yd;function fg(k,w,S){var E=k.s=w+S,T=E-w,N=E-T;k.t=w-N+(S-T)}var Xi=1e-6,di=Math.PI,ru=di/2,dg=di/4,su=di*2,rc=180/di,Zo=di/180,fs=Math.abs,V_=Math.atan,Zh=Math.atan2,fr=Math.cos,dr=Math.sin,Yh=Math.sqrt;function ry(k){return k>1?0:k<-1?di:Math.acos(k)}function ih(k){return k>1?ru:k<-1?-ru:Math.asin(k)}function Nf(){}function Kd(k,w){k&&mg.hasOwnProperty(k.type)&&mg[k.type](k,w)}var pg={Feature:function(k,w){Kd(k.geometry,w)},FeatureCollection:function(k,w){for(var S=k.features,E=-1,T=S.length;++E<T;)Kd(S[E].geometry,w)}},mg={Sphere:function(k,w){w.sphere()},Point:function(k,w){k=k.coordinates,w.point(k[0],k[1],k[2])},MultiPoint:function(k,w){for(var S=k.coordinates,E=-1,T=S.length;++E<T;)k=S[E],w.point(k[0],k[1],k[2])},LineString:function(k,w){em(k.coordinates,w,0)},MultiLineString:function(k,w){for(var S=k.coordinates,E=-1,T=S.length;++E<T;)em(S[E],w,0)},Polygon:function(k,w){gg(k.coordinates,w)},MultiPolygon:function(k,w){for(var S=k.coordinates,E=-1,T=S.length;++E<T;)gg(S[E],w)},GeometryCollection:function(k,w){for(var S=k.geometries,E=-1,T=S.length;++E<T;)Kd(S[E],w)}};function em(k,w,S){var E=-1,T=k.length-S,N;for(w.lineStart();++E<T;)N=k[E],w.point(N[0],N[1],N[2]);w.lineEnd()}function gg(k,w){var S=-1,E=k.length;for(w.polygonStart();++S<E;)em(k[S],w,1);w.polygonEnd()}function U_(k,w){k&&pg.hasOwnProperty(k.type)?pg[k.type](k,w):Kd(k,w)}cc();cc();function tm(k){return[Zh(k[1],k[0]),ih(k[2])]}function Hh(k){var w=k[0],S=k[1],E=fr(S);return[E*fr(w),E*dr(w),dr(S)]}function jd(k,w){return k[0]*w[0]+k[1]*w[1]+k[2]*w[2]}function Jd(k,w){return[k[1]*w[2]-k[2]*w[1],k[2]*w[0]-k[0]*w[2],k[0]*w[1]-k[1]*w[0]]}function $p(k,w){k[0]+=w[0],k[1]+=w[1],k[2]+=w[2]}function Vd(k,w){return[k[0]*w,k[1]*w,k[2]*w]}function nm(k){var w=Yh(k[0]*k[0]+k[1]*k[1]+k[2]*k[2]);k[0]/=w,k[1]/=w,k[2]/=w}cc();function sy(k,w){function S(E,T){return E=k(E,T),w(E[0],E[1])}return k.invert&&w.invert&&(S.invert=function(E,T){return E=w.invert(E,T),E&&k.invert(E[0],E[1])}),S}function im(k,w){return[k>di?k-su:k<-di?k+su:k,w]}im.invert=im;function q_(k,w,S){return(k%=su)?w||S?sy(_g(k),vg(w,S)):_g(k):w||S?vg(w,S):im}function yg(k){return function(w,S){return w+=k,[w>di?w-su:w<-di?w+su:w,S]}}function _g(k){var w=yg(k);return w.invert=yg(-k),w}function vg(k,w){var S=fr(k),E=dr(k),T=fr(w),N=dr(w);function L(c,W){var ee=fr(W),Q=fr(c)*ee,F=dr(c)*ee,q=dr(W),se=q*S+Q*E;return[Zh(F*T-se*N,Q*S-q*E),ih(se*T+F*N)]}return L.invert=function(c,W){var ee=fr(W),Q=fr(c)*ee,F=dr(c)*ee,q=dr(W),se=q*T-F*N;return[Zh(F*T+q*N,Q*S+se*E),ih(se*S-Q*E)]},L}function G_(k,w,S,E,T,N){if(S){var L=fr(w),c=dr(w),W=E*S;T==null?(T=w+E*su,N=w-W/2):(T=xg(L,T),N=xg(L,N),(E>0?T<N:T>N)&&(T+=E*su));for(var ee,Q=T;E>0?Q>N:Q<N;Q-=W)ee=tm([L,-c*fr(Q),-c*dr(Q)]),k.point(ee[0],ee[1])}}function xg(k,w){w=Hh(w),w[0]-=k,nm(w);var S=ry(-w[1]);return((-w[2]<0?-S:S)+su-Xi)%su}function ay(){var k=[],w;return{point:function(S,E){w.push([S,E])},lineStart:function(){k.push(w=[])},lineEnd:Nf,rejoin:function(){k.length>1&&k.push(k.pop().concat(k.shift()))},result:function(){var S=k;return k=[],w=null,S}}}function $_(k,w,S,E,T,N){var L=k[0],c=k[1],W=w[0],ee=w[1],Q=0,F=1,q=W-L,se=ee-c,le;if(le=S-L,!(!q&&le>0)){if(le/=q,q<0){if(le<Q)return;le<F&&(F=le)}else if(q>0){if(le>F)return;le>Q&&(Q=le)}if(le=T-L,!(!q&&le<0)){if(le/=q,q<0){if(le>F)return;le>Q&&(Q=le)}else if(q>0){if(le<Q)return;le<F&&(F=le)}if(le=E-c,!(!se&&le>0)){if(le/=se,se<0){if(le<Q)return;le<F&&(F=le)}else if(se>0){if(le>F)return;le>Q&&(Q=le)}if(le=N-c,!(!se&&le<0)){if(le/=se,se<0){if(le>F)return;le>Q&&(Q=le)}else if(se>0){if(le<Q)return;le<F&&(F=le)}return Q>0&&(k[0]=L+Q*q,k[1]=c+Q*se),F<1&&(w[0]=L+F*q,w[1]=c+F*se),!0}}}}}function $d(k,w){return fs(k[0]-w[0])<Xi&&fs(k[1]-w[1])<Xi}function Ud(k,w,S,E){this.x=k,this.z=w,this.o=S,this.e=E,this.v=!1,this.n=this.p=null}function oy(k,w,S,E,T){var N=[],L=[],c,W;if(k.forEach(function(le){if(!((fe=le.length-1)<=0)){var fe,Ie=le[0],Be=le[fe],Ce;if($d(Ie,Be)){for(T.lineStart(),c=0;c<fe;++c)T.point((Ie=le[c])[0],Ie[1]);T.lineEnd();return}N.push(Ce=new Ud(Ie,le,null,!0)),L.push(Ce.o=new Ud(Ie,null,Ce,!1)),N.push(Ce=new Ud(Be,le,null,!1)),L.push(Ce.o=new Ud(Be,null,Ce,!0))}}),!!N.length){for(L.sort(w),wg(N),wg(L),c=0,W=L.length;c<W;++c)L[c].e=S=!S;for(var ee=N[0],Q,F;;){for(var q=ee,se=!0;q.v;)if((q=q.n)===ee)return;Q=q.z,T.lineStart();do{if(q.v=q.o.v=!0,q.e){if(se)for(c=0,W=Q.length;c<W;++c)T.point((F=Q[c])[0],F[1]);else E(q.x,q.n.x,1,T);q=q.n}else{if(se)for(Q=q.p.z,c=Q.length-1;c>=0;--c)T.point((F=Q[c])[0],F[1]);else E(q.x,q.p.x,-1,T);q=q.p}q=q.o,Q=q.z,se=!se}while(!q.v);T.lineEnd()}}}function wg(k){if(w=k.length){for(var w,S=0,E=k[0],T;++S<w;)E.n=T=k[S],T.p=E,E=T;E.n=T=k[0],T.p=E}}function ly(k,w){return k<w?-1:k>w?1:k>=w?0:NaN}function Z_(k){return k.length===1&&(k=H_(k)),{left:function(w,S,E,T){for(E==null&&(E=0),T==null&&(T=w.length);E<T;){var N=E+T>>>1;k(w[N],S)<0?E=N+1:T=N}return E},right:function(w,S,E,T){for(E==null&&(E=0),T==null&&(T=w.length);E<T;){var N=E+T>>>1;k(w[N],S)>0?T=N:E=N+1}return E}}}function H_(k){return function(w,S){return ly(k(w),S)}}Z_(ly);function uy(k){for(var w=k.length,S,E=-1,T=0,N,L;++E<w;)T+=k[E].length;for(N=new Array(T);--w>=0;)for(L=k[w],S=L.length;--S>=0;)N[--T]=L[S];return N}var zf=1e9,qd=-zf;function X_(k,w,S,E){function T(ee,Q){return k<=ee&&ee<=S&&w<=Q&&Q<=E}function N(ee,Q,F,q){var se=0,le=0;if(ee==null||(se=L(ee,F))!==(le=L(Q,F))||W(ee,Q)<0^F>0)do q.point(se===0||se===3?k:S,se>1?E:w);while((se=(se+F+4)%4)!==le);else q.point(Q[0],Q[1])}function L(ee,Q){return fs(ee[0]-k)<Xi?Q>0?0:3:fs(ee[0]-S)<Xi?Q>0?2:1:fs(ee[1]-w)<Xi?Q>0?1:0:Q>0?3:2}function c(ee,Q){return W(ee.x,Q.x)}function W(ee,Q){var F=L(ee,1),q=L(Q,1);return F!==q?F-q:F===0?Q[1]-ee[1]:F===1?ee[0]-Q[0]:F===2?ee[1]-Q[1]:Q[0]-ee[0]}return function(ee){var Q=ee,F=ay(),q,se,le,fe,Ie,Be,Ce,Ge,it,We,tt,at={point:ht,lineStart:Zt,lineEnd:Bt,polygonStart:$t,polygonEnd:wt};function ht(zt,an){T(zt,an)&&Q.point(zt,an)}function ft(){for(var zt=0,an=0,rn=se.length;an<rn;++an)for(var bt=se[an],jt=1,nt=bt.length,Re=bt[0],rt,on,Pt=Re[0],yn=Re[1];jt<nt;++jt)rt=Pt,on=yn,Re=bt[jt],Pt=Re[0],yn=Re[1],on<=E?yn>E&&(Pt-rt)*(E-on)>(yn-on)*(k-rt)&&++zt:yn<=E&&(Pt-rt)*(E-on)<(yn-on)*(k-rt)&&--zt;return zt}function $t(){Q=F,q=[],se=[],tt=!0}function wt(){var zt=ft(),an=tt&&zt,rn=(q=uy(q)).length;(an||rn)&&(ee.polygonStart(),an&&(ee.lineStart(),N(null,null,1,ee),ee.lineEnd()),rn&&oy(q,c,zt,N,ee),ee.polygonEnd()),Q=ee,q=se=le=null}function Zt(){at.point=je,se&&se.push(le=[]),We=!0,it=!1,Ce=Ge=NaN}function Bt(){q&&(je(fe,Ie),Be&&it&&F.rejoin(),q.push(F.result())),at.point=ht,it&&Q.lineEnd()}function je(zt,an){var rn=T(zt,an);if(se&&le.push([zt,an]),We)fe=zt,Ie=an,Be=rn,We=!1,rn&&(Q.lineStart(),Q.point(zt,an));else if(rn&&it)Q.point(zt,an);else{var bt=[Ce=Math.max(qd,Math.min(zf,Ce)),Ge=Math.max(qd,Math.min(zf,Ge))],jt=[zt=Math.max(qd,Math.min(zf,zt)),an=Math.max(qd,Math.min(zf,an))];$_(bt,jt,k,w,S,E)?(it||(Q.lineStart(),Q.point(bt[0],bt[1])),Q.point(jt[0],jt[1]),rn||Q.lineEnd(),tt=!1):rn&&(Q.lineStart(),Q.point(zt,an),tt=!1)}Ce=zt,Ge=an,it=rn}return at}}var Zp=cc();function W_(k,w){var S=w[0],E=w[1],T=[dr(S),-fr(S),0],N=0,L=0;Zp.reset();for(var c=0,W=k.length;c<W;++c)if(Q=(ee=k[c]).length)for(var ee,Q,F=ee[Q-1],q=F[0],se=F[1]/2+dg,le=dr(se),fe=fr(se),Ie=0;Ie<Q;++Ie,q=Ce,le=it,fe=We,F=Be){var Be=ee[Ie],Ce=Be[0],Ge=Be[1]/2+dg,it=dr(Ge),We=fr(Ge),tt=Ce-q,at=tt>=0?1:-1,ht=at*tt,ft=ht>di,$t=le*it;if(Zp.add(Zh($t*at*dr(ht),fe*We+$t*fr(ht))),N+=ft?tt+at*su:tt,ft^q>=S^Ce>=S){var wt=Jd(Hh(F),Hh(Be));nm(wt);var Zt=Jd(T,wt);nm(Zt);var Bt=(ft^tt>=0?-1:1)*ih(Zt[2]);(E>Bt||E===Bt&&(wt[0]||wt[1]))&&(L+=ft^tt>=0?1:-1)}}return(N<-Xi||N<Xi&&Zp<-Xi)^L&1}cc();function bg(k){return k}cc();cc();var Xh=1/0,Qd=Xh,Bf=-Xh,ep=Bf,kg={point:Y_,lineStart:Nf,lineEnd:Nf,polygonStart:Nf,polygonEnd:Nf,result:function(){var k=[[Xh,Qd],[Bf,ep]];return Bf=ep=-(Qd=Xh=1/0),k}};function Y_(k,w){k<Xh&&(Xh=k),k>Bf&&(Bf=k),w<Qd&&(Qd=w),w>ep&&(ep=w)}cc();function cy(k,w,S,E){return function(T,N){var L=w(N),c=T.invert(E[0],E[1]),W=ay(),ee=w(W),Q=!1,F,q,se,le={point:fe,lineStart:Be,lineEnd:Ce,polygonStart:function(){le.point=Ge,le.lineStart=it,le.lineEnd=We,q=[],F=[]},polygonEnd:function(){le.point=fe,le.lineStart=Be,le.lineEnd=Ce,q=uy(q);var tt=W_(F,c);q.length?(Q||(N.polygonStart(),Q=!0),oy(q,J_,tt,S,N)):tt&&(Q||(N.polygonStart(),Q=!0),N.lineStart(),S(null,null,1,N),N.lineEnd()),Q&&(N.polygonEnd(),Q=!1),q=F=null},sphere:function(){N.polygonStart(),N.lineStart(),S(null,null,1,N),N.lineEnd(),N.polygonEnd()}};function fe(tt,at){var ht=T(tt,at);k(tt=ht[0],at=ht[1])&&N.point(tt,at)}function Ie(tt,at){var ht=T(tt,at);L.point(ht[0],ht[1])}function Be(){le.point=Ie,L.lineStart()}function Ce(){le.point=fe,L.lineEnd()}function Ge(tt,at){se.push([tt,at]);var ht=T(tt,at);ee.point(ht[0],ht[1])}function it(){ee.lineStart(),se=[]}function We(){Ge(se[0][0],se[0][1]),ee.lineEnd();var tt=ee.clean(),at=W.result(),ht,ft=at.length,$t,wt,Zt;if(se.pop(),F.push(se),se=null,!!ft){if(tt&1){if(wt=at[0],($t=wt.length-1)>0){for(Q||(N.polygonStart(),Q=!0),N.lineStart(),ht=0;ht<$t;++ht)N.point((Zt=wt[ht])[0],Zt[1]);N.lineEnd()}return}ft>1&&tt&2&&at.push(at.pop().concat(at.shift())),q.push(at.filter(K_))}}return le}}function K_(k){return k.length>1}function J_(k,w){return((k=k.x)[0]<0?k[1]-ru-Xi:ru-k[1])-((w=w.x)[0]<0?w[1]-ru-Xi:ru-w[1])}const Sg=cy(function(){return!0},Q_,tv,[-di,-ru]);function Q_(k){var w=NaN,S=NaN,E=NaN,T;return{lineStart:function(){k.lineStart(),T=1},point:function(N,L){var c=N>0?di:-di,W=fs(N-w);fs(W-di)<Xi?(k.point(w,S=(S+L)/2>0?ru:-ru),k.point(E,S),k.lineEnd(),k.lineStart(),k.point(c,S),k.point(N,S),T=0):E!==c&&W>=di&&(fs(w-E)<Xi&&(w-=E*Xi),fs(N-c)<Xi&&(N-=c*Xi),S=ev(w,S,N,L),k.point(E,S),k.lineEnd(),k.lineStart(),k.point(c,S),T=0),k.point(w=N,S=L),E=c},lineEnd:function(){k.lineEnd(),w=S=NaN},clean:function(){return 2-T}}}function ev(k,w,S,E){var T,N,L=dr(k-S);return fs(L)>Xi?V_((dr(w)*(N=fr(E))*dr(S)-dr(E)*(T=fr(w))*dr(k))/(T*N*L)):(w+E)/2}function tv(k,w,S,E){var T;if(k==null)T=S*ru,E.point(-di,T),E.point(0,T),E.point(di,T),E.point(di,0),E.point(di,-T),E.point(0,-T),E.point(-di,-T),E.point(-di,0),E.point(-di,T);else if(fs(k[0]-w[0])>Xi){var N=k[0]<w[0]?di:-di;T=S*N/2,E.point(-N,T),E.point(0,T),E.point(N,T)}else E.point(w[0],w[1])}function nv(k,w){var S=fr(k),E=S>0,T=fs(S)>Xi;function N(Q,F,q,se){G_(se,k,w,q,Q,F)}function L(Q,F){return fr(Q)*fr(F)>S}function c(Q){var F,q,se,le,fe;return{lineStart:function(){le=se=!1,fe=1},point:function(Ie,Be){var Ce=[Ie,Be],Ge,it=L(Ie,Be),We=E?it?0:ee(Ie,Be):it?ee(Ie+(Ie<0?di:-di),Be):0;if(!F&&(le=se=it)&&Q.lineStart(),it!==se&&(Ge=W(F,Ce),(!Ge||$d(F,Ge)||$d(Ce,Ge))&&(Ce[0]+=Xi,Ce[1]+=Xi,it=L(Ce[0],Ce[1]))),it!==se)fe=0,it?(Q.lineStart(),Ge=W(Ce,F),Q.point(Ge[0],Ge[1])):(Ge=W(F,Ce),Q.point(Ge[0],Ge[1]),Q.lineEnd()),F=Ge;else if(T&&F&&E^it){var tt;!(We&q)&&(tt=W(Ce,F,!0))&&(fe=0,E?(Q.lineStart(),Q.point(tt[0][0],tt[0][1]),Q.point(tt[1][0],tt[1][1]),Q.lineEnd()):(Q.point(tt[1][0],tt[1][1]),Q.lineEnd(),Q.lineStart(),Q.point(tt[0][0],tt[0][1])))}it&&(!F||!$d(F,Ce))&&Q.point(Ce[0],Ce[1]),F=Ce,se=it,q=We},lineEnd:function(){se&&Q.lineEnd(),F=null},clean:function(){return fe|(le&&se)<<1}}}function W(Q,F,q){var se=Hh(Q),le=Hh(F),fe=[1,0,0],Ie=Jd(se,le),Be=jd(Ie,Ie),Ce=Ie[0],Ge=Be-Ce*Ce;if(!Ge)return!q&&Q;var it=S*Be/Ge,We=-S*Ce/Ge,tt=Jd(fe,Ie),at=Vd(fe,it),ht=Vd(Ie,We);$p(at,ht);var ft=tt,$t=jd(at,ft),wt=jd(ft,ft),Zt=$t*$t-wt*(jd(at,at)-1);if(!(Zt<0)){var Bt=Yh(Zt),je=Vd(ft,(-$t-Bt)/wt);if($p(je,at),je=tm(je),!q)return je;var zt=Q[0],an=F[0],rn=Q[1],bt=F[1],jt;an<zt&&(jt=zt,zt=an,an=jt);var nt=an-zt,Re=fs(nt-di)<Xi,rt=Re||nt<Xi;if(!Re&&bt<rn&&(jt=rn,rn=bt,bt=jt),rt?Re?rn+bt>0^je[1]<(fs(je[0]-zt)<Xi?rn:bt):rn<=je[1]&&je[1]<=bt:nt>di^(zt<=je[0]&&je[0]<=an)){var on=Vd(ft,(-$t+Bt)/wt);return $p(on,at),[je,tm(on)]}}}function ee(Q,F){var q=E?k:di-k,se=0;return Q<-q?se|=1:Q>q&&(se|=2),F<-q?se|=4:F>q&&(se|=8),se}return cy(L,c,N,E?[0,-k]:[-di,k-di])}function hy(k){return function(w){var S=new rm;for(var E in k)S[E]=k[E];return S.stream=w,S}}function rm(){}rm.prototype={constructor:rm,point:function(k,w){this.stream.point(k,w)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function fy(k,w,S){var E=w[1][0]-w[0][0],T=w[1][1]-w[0][1],N=k.clipExtent&&k.clipExtent();k.scale(150).translate([0,0]),N!=null&&k.clipExtent(null),U_(S,k.stream(kg));var L=kg.result(),c=Math.min(E/(L[1][0]-L[0][0]),T/(L[1][1]-L[0][1])),W=+w[0][0]+(E-c*(L[1][0]+L[0][0]))/2,ee=+w[0][1]+(T-c*(L[1][1]+L[0][1]))/2;return N!=null&&k.clipExtent(N),k.scale(c*150).translate([W,ee])}function iv(k,w,S){return fy(k,[[0,0],w],S)}var Eg=16,rv=fr(30*Zo);function Ig(k,w){return+w?av(k,w):sv(k)}function sv(k){return hy({point:function(w,S){w=k(w,S),this.stream.point(w[0],w[1])}})}function av(k,w){function S(E,T,N,L,c,W,ee,Q,F,q,se,le,fe,Ie){var Be=ee-E,Ce=Q-T,Ge=Be*Be+Ce*Ce;if(Ge>4*w&&fe--){var it=L+q,We=c+se,tt=W+le,at=Yh(it*it+We*We+tt*tt),ht=ih(tt/=at),ft=fs(fs(tt)-1)<Xi||fs(N-F)<Xi?(N+F)/2:Zh(We,it),$t=k(ft,ht),wt=$t[0],Zt=$t[1],Bt=wt-E,je=Zt-T,zt=Ce*Bt-Be*je;(zt*zt/Ge>w||fs((Be*Bt+Ce*je)/Ge-.5)>.3||L*q+c*se+W*le<rv)&&(S(E,T,N,L,c,W,wt,Zt,ft,it/=at,We/=at,tt,fe,Ie),Ie.point(wt,Zt),S(wt,Zt,ft,it,We,tt,ee,Q,F,q,se,le,fe,Ie))}}return function(E){var T,N,L,c,W,ee,Q,F,q,se,le,fe,Ie={point:Be,lineStart:Ce,lineEnd:it,polygonStart:function(){E.polygonStart(),Ie.lineStart=We},polygonEnd:function(){E.polygonEnd(),Ie.lineStart=Ce}};function Be(ht,ft){ht=k(ht,ft),E.point(ht[0],ht[1])}function Ce(){F=NaN,Ie.point=Ge,E.lineStart()}function Ge(ht,ft){var $t=Hh([ht,ft]),wt=k(ht,ft);S(F,q,Q,se,le,fe,F=wt[0],q=wt[1],Q=ht,se=$t[0],le=$t[1],fe=$t[2],Eg,E),E.point(F,q)}function it(){Ie.point=Be,E.lineEnd()}function We(){Ce(),Ie.point=tt,Ie.lineEnd=at}function tt(ht,ft){Ge(T=ht,ft),N=F,L=q,c=se,W=le,ee=fe,Ie.point=Ge}function at(){S(F,q,Q,se,le,fe,N,L,T,c,W,ee,Eg,E),Ie.lineEnd=it,it()}return Ie}}var ov=hy({point:function(k,w){this.stream.point(k*Zo,w*Zo)}});function lv(k){return uv(function(){return k})()}function uv(k){var w,S=150,E=480,T=250,N,L,c=0,W=0,ee=0,Q=0,F=0,q,se,le=null,fe=Sg,Ie=null,Be,Ce,Ge,it=bg,We=.5,tt=Ig(wt,We),at,ht;function ft(je){return je=se(je[0]*Zo,je[1]*Zo),[je[0]*S+N,L-je[1]*S]}function $t(je){return je=se.invert((je[0]-N)/S,(L-je[1])/S),je&&[je[0]*rc,je[1]*rc]}function wt(je,zt){return je=w(je,zt),[je[0]*S+N,L-je[1]*S]}ft.stream=function(je){return at&&ht===je?at:at=ov(fe(q,tt(it(ht=je))))},ft.clipAngle=function(je){return arguments.length?(fe=+je?nv(le=je*Zo,6*Zo):(le=null,Sg),Bt()):le*rc},ft.clipExtent=function(je){return arguments.length?(it=je==null?(Ie=Be=Ce=Ge=null,bg):X_(Ie=+je[0][0],Be=+je[0][1],Ce=+je[1][0],Ge=+je[1][1]),Bt()):Ie==null?null:[[Ie,Be],[Ce,Ge]]},ft.scale=function(je){return arguments.length?(S=+je,Zt()):S},ft.translate=function(je){return arguments.length?(E=+je[0],T=+je[1],Zt()):[E,T]},ft.center=function(je){return arguments.length?(c=je[0]%360*Zo,W=je[1]%360*Zo,Zt()):[c*rc,W*rc]},ft.rotate=function(je){return arguments.length?(ee=je[0]%360*Zo,Q=je[1]%360*Zo,F=je.length>2?je[2]%360*Zo:0,Zt()):[ee*rc,Q*rc,F*rc]},ft.precision=function(je){return arguments.length?(tt=Ig(wt,We=je*je),Bt()):Yh(We)},ft.fitExtent=function(je,zt){return fy(ft,je,zt)},ft.fitSize=function(je,zt){return iv(ft,je,zt)};function Zt(){se=sy(q=q_(ee,Q,F),w);var je=w(c,W);return N=E-je[0]*S,L=T+je[1]*S,Bt()}function Bt(){return at=ht=null,ft}return function(){return w=k.apply(this,arguments),ft.invert=w.invert&&$t,Zt()}}function dy(k){return function(w,S){var E=fr(w),T=fr(S),N=k(E*T);return[N*T*dr(w),N*dr(S)]}}function py(k){return function(w,S){var E=Yh(w*w+S*S),T=k(E),N=dr(T),L=fr(T);return[Zh(w*N,E*L),ih(E&&S*N/E)]}}var cv=dy(function(k){return Yh(2/(1+k))});cv.invert=py(function(k){return 2*ih(k/2)});var my=dy(function(k){return(k=ry(k))&&k/dr(k)});my.invert=py(function(k){return k});function hv(){return lv(my).scale(79.4188).clipAngle(180-.001)}function Tg(k,w){return[k,w]}Tg.invert=Tg;var{BufferOp:fv,GeoJSONReader:dv,GeoJSONWriter:pv}=j_;function mv(k,w,S){S=S||{};var E=S.units||"kilometers",T=S.steps||8;if(!k)throw new Error("geojson is required");if(typeof S!="object")throw new Error("options must be an object");if(typeof T!="number")throw new Error("steps must be an number");if(w===void 0)throw new Error("radius is required");if(T<=0)throw new Error("steps must be greater than 0");var N=[];switch(k.type){case"GeometryCollection":return ap(k,function(L){var c=Zd(L,w,E,T);c&&N.push(c)}),Ff(N);case"FeatureCollection":return ng(k,function(L){var c=Zd(L,w,E,T);c&&ng(c,function(W){W&&N.push(W)})}),Ff(N)}return Zd(k,w,E,T)}function Zd(k,w,S,E){var T=k.properties||{},N=k.type==="Feature"?k.geometry:k;if(N.type==="GeometryCollection"){var L=[];return ap(k,function(fe){var Ie=Zd(fe,w,S,E);Ie&&L.push(Ie)}),Ff(L)}var c=gv(N),W={type:N.type,coordinates:yy(N.coordinates,c)},ee=new dv,Q=ee.read(W),F=y_(ey(w,S),"meters"),q=fv.bufferOp(Q,F,E),se=new pv;if(q=se.write(q),!gy(q.coordinates)){var le={type:q.type,coordinates:_y(q.coordinates,c)};return Gf(le,T)}}function gy(k){return Array.isArray(k[0])?gy(k[0]):isNaN(k[0])}function yy(k,w){return typeof k[0]!="object"?w(k):k.map(function(S){return yy(S,w)})}function _y(k,w){return typeof k[0]!="object"?w.invert(k):k.map(function(S){return _y(S,w)})}function gv(k){var w=D_(k).geometry.coordinates,S=[-w[0],-w[1]];return hv().rotate(S).scale(ra)}function yv(k,w,S={}){const E=S.steps||64,T=S.properties?S.properties:!Array.isArray(k)&&k.type==="Feature"&&k.properties?k.properties:{},N=[];for(let L=0;L<E;L++)N.push(w_(k,w,L*-360/E,S).geometry.coordinates);return N.push(N[0]),dm([N],T)}function _v(k){if(!k)throw new Error("geojson is required");switch(k.type){case"Feature":return vy(k);case"FeatureCollection":return vv(k);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return gm(k);default:throw new Error("unknown GeoJSON type")}}function vy(k){const w={type:"Feature"};return Object.keys(k).forEach(S=>{switch(S){case"type":case"properties":case"geometry":return;default:w[S]=k[S]}}),w.properties=mm(k.properties),k.geometry==null?w.geometry=null:w.geometry=gm(k.geometry),w}function mm(k){const w={};return k&&Object.keys(k).forEach(S=>{const E=k[S];typeof E=="object"?E===null?w[S]=null:Array.isArray(E)?w[S]=E.map(T=>T):w[S]=mm(E):w[S]=E}),w}function vv(k){const w={type:"FeatureCollection"};return Object.keys(k).forEach(S=>{switch(S){case"type":case"features":return;default:w[S]=k[S]}}),w.features=k.features.map(S=>vy(S)),w}function gm(k){const w={type:k.type};return k.bbox&&(w.bbox=k.bbox),k.type==="GeometryCollection"?(w.geometries=k.geometries.map(S=>gm(S)),w):(w.coordinates=xy(k.coordinates),w)}function xy(k){const w=k;return typeof w[0]!="object"?w.slice():w.map(S=>xy(S))}function xv(k,w){var S=k[0]-w[0],E=k[1]-w[1];return S*S+E*E}function wv(k,w,S){var E=w[0],T=w[1],N=S[0]-E,L=S[1]-T;if(N!==0||L!==0){var c=((k[0]-E)*N+(k[1]-T)*L)/(N*N+L*L);c>1?(E=S[0],T=S[1]):c>0&&(E+=N*c,T+=L*c)}return N=k[0]-E,L=k[1]-T,N*N+L*L}function bv(k,w){for(var S=k[0],E=[S],T,N=1,L=k.length;N<L;N++)T=k[N],xv(T,S)>w&&(E.push(T),S=T);return S!==T&&E.push(T),E}function sm(k,w,S,E,T){for(var N=E,L,c=w+1;c<S;c++){var W=wv(k[c],k[w],k[S]);W>N&&(L=c,N=W)}N>E&&(L-w>1&&sm(k,w,L,E,T),T.push(k[L]),S-L>1&&sm(k,L,S,E,T))}function kv(k,w){var S=k.length-1,E=[k[0]];return sm(k,0,S,w,E),E.push(k[S]),E}function tp(k,w,S){if(k.length<=2)return k;var E=w!==void 0?w*w:1;return k=S?k:bv(k,E),k=kv(k,E),k}function Sv(k,w={}){var S,E,T;if(w=w??{},!ty(w))throw new Error("options is invalid");const N=(S=w.tolerance)!=null?S:1,L=(E=w.highQuality)!=null?E:!1,c=(T=w.mutate)!=null?T:!1;if(!k)throw new Error("geojson is required");if(N&&N<0)throw new Error("invalid tolerance");return c!==!0&&(k=_v(k)),ap(k,function(W){Ev(W,N,L)}),k}function Ev(k,w,S){const E=k.type;if(E==="Point"||E==="MultiPoint")return k;if(z_(k,{mutate:!0}),E!=="GeometryCollection")switch(E){case"LineString":k.coordinates=tp(k.coordinates,w,S);break;case"MultiLineString":k.coordinates=k.coordinates.map(T=>tp(T,w,S));break;case"Polygon":k.coordinates=Cg(k.coordinates,w,S);break;case"MultiPolygon":k.coordinates=k.coordinates.map(T=>Cg(T,w,S))}return k}function Cg(k,w,S){return k.map(function(E){if(E.length<4)throw new Error("invalid polygon");let T=w,N=tp(E,T,S);for(;!Pg(N)&&T>=Number.EPSILON;)T-=T*.01,N=tp(E,T,S);return Pg(N)?((N[N.length-1][0]!==N[0][0]||N[N.length-1][1]!==N[0][1])&&N.push(N[0]),N):E})}function Pg(k){return k.length<3?!1:!(k.length===3&&k[2][0]===k[0][0]&&k[2][1]===k[0][1])}function Mg(k){return function(){return k}}function Iv(k){return k[0]}function Tv(k){return k[1]}function np(){this._=null}function op(k){k.U=k.C=k.L=k.R=k.P=k.N=null}np.prototype={constructor:np,insert:function(k,w){var S,E,T;if(k){if(w.P=k,w.N=k.N,k.N&&(k.N.P=w),k.N=w,k.R){for(k=k.R;k.L;)k=k.L;k.L=w}else k.R=w;S=k}else this._?(k=Ag(this._),w.P=null,w.N=k,k.P=k.L=w,S=k):(w.P=w.N=null,this._=w,S=null);for(w.L=w.R=null,w.U=S,w.C=!0,k=w;S&&S.C;)E=S.U,S===E.L?(T=E.R,T&&T.C?(S.C=T.C=!1,E.C=!0,k=E):(k===S.R&&(Pf(this,S),k=S,S=k.U),S.C=!1,E.C=!0,Mf(this,E))):(T=E.L,T&&T.C?(S.C=T.C=!1,E.C=!0,k=E):(k===S.L&&(Mf(this,S),k=S,S=k.U),S.C=!1,E.C=!0,Pf(this,E))),S=k.U;this._.C=!1},remove:function(k){k.N&&(k.N.P=k.P),k.P&&(k.P.N=k.N),k.N=k.P=null;var w=k.U,S,E=k.L,T=k.R,N,L;if(E?T?N=Ag(T):N=E:N=T,w?w.L===k?w.L=N:w.R=N:this._=N,E&&T?(L=N.C,N.C=k.C,N.L=E,E.U=N,N!==T?(w=N.U,N.U=k.U,k=N.R,w.L=k,N.R=T,T.U=N):(N.U=w,w=N,k=N.R)):(L=k.C,k=N),k&&(k.U=w),!L){if(k&&k.C){k.C=!1;return}do{if(k===this._)break;if(k===w.L){if(S=w.R,S.C&&(S.C=!1,w.C=!0,Pf(this,w),S=w.R),S.L&&S.L.C||S.R&&S.R.C){(!S.R||!S.R.C)&&(S.L.C=!1,S.C=!0,Mf(this,S),S=w.R),S.C=w.C,w.C=S.R.C=!1,Pf(this,w),k=this._;break}}else if(S=w.L,S.C&&(S.C=!1,w.C=!0,Mf(this,w),S=w.L),S.L&&S.L.C||S.R&&S.R.C){(!S.L||!S.L.C)&&(S.R.C=!1,S.C=!0,Pf(this,S),S=w.L),S.C=w.C,w.C=S.L.C=!1,Mf(this,w),k=this._;break}S.C=!0,k=w,w=w.U}while(!k.C);k&&(k.C=!1)}}};function Pf(k,w){var S=w,E=w.R,T=S.U;T?T.L===S?T.L=E:T.R=E:k._=E,E.U=T,S.U=E,S.R=E.L,S.R&&(S.R.U=S),E.L=S}function Mf(k,w){var S=w,E=w.L,T=S.U;T?T.L===S?T.L=E:T.R=E:k._=E,E.U=T,S.U=E,S.L=E.R,S.L&&(S.L.U=S),E.R=S}function Ag(k){for(;k.L;)k=k.L;return k}function Df(k,w,S,E){var T=[null,null],N=sa.push(T)-1;return T.left=k,T.right=w,S&&ip(T,k,w,S),E&&ip(T,w,k,E),To[k.index].halfedges.push(N),To[w.index].halfedges.push(N),T}function Af(k,w,S){var E=[w,S];return E.left=k,E}function ip(k,w,S,E){!k[0]&&!k[1]?(k[0]=E,k.left=w,k.right=S):k.left===S?k[1]=E:k[0]=E}function Cv(k,w,S,E,T){var N=k[0],L=k[1],c=N[0],W=N[1],ee=L[0],Q=L[1],F=0,q=1,se=ee-c,le=Q-W,fe;if(fe=w-c,!(!se&&fe>0)){if(fe/=se,se<0){if(fe<F)return;fe<q&&(q=fe)}else if(se>0){if(fe>q)return;fe>F&&(F=fe)}if(fe=E-c,!(!se&&fe<0)){if(fe/=se,se<0){if(fe>q)return;fe>F&&(F=fe)}else if(se>0){if(fe<F)return;fe<q&&(q=fe)}if(fe=S-W,!(!le&&fe>0)){if(fe/=le,le<0){if(fe<F)return;fe<q&&(q=fe)}else if(le>0){if(fe>q)return;fe>F&&(F=fe)}if(fe=T-W,!(!le&&fe<0)){if(fe/=le,le<0){if(fe>q)return;fe>F&&(F=fe)}else if(le>0){if(fe<F)return;fe<q&&(q=fe)}return!(F>0)&&!(q<1)||(F>0&&(k[0]=[c+F*se,W+F*le]),q<1&&(k[1]=[c+q*se,W+q*le])),!0}}}}}function Pv(k,w,S,E,T){var N=k[1];if(N)return!0;var L=k[0],c=k.left,W=k.right,ee=c[0],Q=c[1],F=W[0],q=W[1],se=(ee+F)/2,le=(Q+q)/2,fe,Ie;if(q===Q){if(se<w||se>=E)return;if(ee>F){if(!L)L=[se,S];else if(L[1]>=T)return;N=[se,T]}else{if(!L)L=[se,T];else if(L[1]<S)return;N=[se,S]}}else if(fe=(ee-F)/(q-Q),Ie=le-fe*se,fe<-1||fe>1)if(ee>F){if(!L)L=[(S-Ie)/fe,S];else if(L[1]>=T)return;N=[(T-Ie)/fe,T]}else{if(!L)L=[(T-Ie)/fe,T];else if(L[1]<S)return;N=[(S-Ie)/fe,S]}else if(Q<q){if(!L)L=[w,fe*w+Ie];else if(L[0]>=E)return;N=[E,fe*E+Ie]}else{if(!L)L=[E,fe*E+Ie];else if(L[0]<w)return;N=[w,fe*w+Ie]}return k[0]=L,k[1]=N,!0}function Mv(k,w,S,E){for(var T=sa.length,N;T--;)(!Pv(N=sa[T],k,w,S,E)||!Cv(N,k,w,S,E)||!(Math.abs(N[0][0]-N[1][0])>Fi||Math.abs(N[0][1]-N[1][1])>Fi))&&delete sa[T]}function Av(k){return To[k.index]={site:k,halfedges:[]}}function Lv(k,w){var S=k.site,E=w.left,T=w.right;return S===T&&(T=E,E=S),T?Math.atan2(T[1]-E[1],T[0]-E[0]):(S===E?(E=w[1],T=w[0]):(E=w[0],T=w[1]),Math.atan2(E[0]-T[0],T[1]-E[1]))}function wy(k,w){return w[+(w.left!==k.site)]}function Rv(k,w){return w[+(w.left===k.site)]}function Nv(){for(var k=0,w=To.length,S,E,T,N;k<w;++k)if((S=To[k])&&(N=(E=S.halfedges).length)){var L=new Array(N),c=new Array(N);for(T=0;T<N;++T)L[T]=T,c[T]=Lv(S,sa[E[T]]);for(L.sort(function(W,ee){return c[ee]-c[W]}),T=0;T<N;++T)c[T]=E[L[T]];for(T=0;T<N;++T)E[T]=c[T]}}function zv(k,w,S,E){var T=To.length,N,L,c,W,ee,Q,F,q,se,le,fe,Ie,Be=!0;for(N=0;N<T;++N)if(L=To[N]){for(c=L.site,ee=L.halfedges,W=ee.length;W--;)sa[ee[W]]||ee.splice(W,1);for(W=0,Q=ee.length;W<Q;)le=Rv(L,sa[ee[W]]),fe=le[0],Ie=le[1],F=wy(L,sa[ee[++W%Q]]),q=F[0],se=F[1],(Math.abs(fe-q)>Fi||Math.abs(Ie-se)>Fi)&&(ee.splice(W,0,sa.push(Af(c,le,Math.abs(fe-k)<Fi&&E-Ie>Fi?[k,Math.abs(q-k)<Fi?se:E]:Math.abs(Ie-E)<Fi&&S-fe>Fi?[Math.abs(se-E)<Fi?q:S,E]:Math.abs(fe-S)<Fi&&Ie-w>Fi?[S,Math.abs(q-S)<Fi?se:w]:Math.abs(Ie-w)<Fi&&fe-k>Fi?[Math.abs(se-w)<Fi?q:k,w]:null))-1),++Q);Q&&(Be=!1)}if(Be){var Ce,Ge,it,We=1/0;for(N=0,Be=null;N<T;++N)(L=To[N])&&(c=L.site,Ce=c[0]-k,Ge=c[1]-w,it=Ce*Ce+Ge*Ge,it<We&&(We=it,Be=L));if(Be){var tt=[k,w],at=[k,E],ht=[S,E],ft=[S,w];Be.halfedges.push(sa.push(Af(c=Be.site,tt,at))-1,sa.push(Af(c,at,ht))-1,sa.push(Af(c,ht,ft))-1,sa.push(Af(c,ft,tt))-1)}}for(N=0;N<T;++N)(L=To[N])&&(L.halfedges.length||delete To[N])}var by=[],ym;function Dv(){op(this),this.x=this.y=this.arc=this.site=this.cy=null}function qh(k){var w=k.P,S=k.N;if(!(!w||!S)){var E=w.site,T=k.site,N=S.site;if(E!==N){var L=T[0],c=T[1],W=E[0]-L,ee=E[1]-c,Q=N[0]-L,F=N[1]-c,q=2*(W*F-ee*Q);if(!(q>=-1e-12)){var se=W*W+ee*ee,le=Q*Q+F*F,fe=(F*se-ee*le)/q,Ie=(W*le-Q*se)/q,Be=by.pop()||new Dv;Be.arc=k,Be.site=T,Be.x=fe+L,Be.y=(Be.cy=Ie+c)+Math.sqrt(fe*fe+Ie*Ie),k.circle=Be;for(var Ce=null,Ge=jf._;Ge;)if(Be.y<Ge.y||Be.y===Ge.y&&Be.x<=Ge.x)if(Ge.L)Ge=Ge.L;else{Ce=Ge.P;break}else if(Ge.R)Ge=Ge.R;else{Ce=Ge;break}jf.insert(Ce,Be),Ce||(ym=Be)}}}}function Gh(k){var w=k.circle;w&&(w.P||(ym=w.N),jf.remove(w),by.push(w),op(w),k.circle=null)}var ky=[];function Ov(){op(this),this.edge=this.site=this.circle=null}function Lg(k){var w=ky.pop()||new Ov;return w.site=k,w}function Hp(k){Gh(k),$h.remove(k),ky.push(k),op(k)}function Fv(k){var w=k.circle,S=w.x,E=w.cy,T=[S,E],N=k.P,L=k.N,c=[k];Hp(k);for(var W=N;W.circle&&Math.abs(S-W.circle.x)<Fi&&Math.abs(E-W.circle.cy)<Fi;)N=W.P,c.unshift(W),Hp(W),W=N;c.unshift(W),Gh(W);for(var ee=L;ee.circle&&Math.abs(S-ee.circle.x)<Fi&&Math.abs(E-ee.circle.cy)<Fi;)L=ee.N,c.push(ee),Hp(ee),ee=L;c.push(ee),Gh(ee);var Q=c.length,F;for(F=1;F<Q;++F)ee=c[F],W=c[F-1],ip(ee.edge,W.site,ee.site,T);W=c[0],ee=c[Q-1],ee.edge=Df(W.site,ee.site,null,T),qh(W),qh(ee)}function Bv(k){for(var w=k[0],S=k[1],E,T,N,L,c=$h._;c;)if(N=Sy(c,S)-w,N>Fi)c=c.L;else if(L=w-jv(c,S),L>Fi){if(!c.R){E=c;break}c=c.R}else{N>-Fi?(E=c.P,T=c):L>-Fi?(E=c,T=c.N):E=T=c;break}Av(k);var W=Lg(k);if($h.insert(E,W),!(!E&&!T)){if(E===T){Gh(E),T=Lg(E.site),$h.insert(W,T),W.edge=T.edge=Df(E.site,W.site),qh(E),qh(T);return}if(!T){W.edge=Df(E.site,W.site);return}Gh(E),Gh(T);var ee=E.site,Q=ee[0],F=ee[1],q=k[0]-Q,se=k[1]-F,le=T.site,fe=le[0]-Q,Ie=le[1]-F,Be=2*(q*Ie-se*fe),Ce=q*q+se*se,Ge=fe*fe+Ie*Ie,it=[(Ie*Ce-se*Ge)/Be+Q,(q*Ge-fe*Ce)/Be+F];ip(T.edge,ee,le,it),W.edge=Df(ee,k,null,it),T.edge=Df(k,le,null,it),qh(E),qh(T)}}function Sy(k,w){var S=k.site,E=S[0],T=S[1],N=T-w;if(!N)return E;var L=k.P;if(!L)return-1/0;S=L.site;var c=S[0],W=S[1],ee=W-w;if(!ee)return c;var Q=c-E,F=1/N-1/ee,q=Q/ee;return F?(-q+Math.sqrt(q*q-2*F*(Q*Q/(-2*ee)-W+ee/2+T-N/2)))/F+E:(E+c)/2}function jv(k,w){var S=k.N;if(S)return Sy(S,w);var E=k.site;return E[1]===w?E[0]:1/0}var Fi=1e-6,$h,To,jf,sa;function Vv(k,w,S){return(k[0]-S[0])*(w[1]-k[1])-(k[0]-w[0])*(S[1]-k[1])}function Uv(k,w){return w[1]-k[1]||w[0]-k[0]}function am(k,w){var S=k.sort(Uv).pop(),E,T,N;for(sa=[],To=new Array(k.length),$h=new np,jf=new np;;)if(N=ym,S&&(!N||S[1]<N.y||S[1]===N.y&&S[0]<N.x))(S[0]!==E||S[1]!==T)&&(Bv(S),E=S[0],T=S[1]),S=k.pop();else if(N)Fv(N.arc);else break;if(Nv(),w){var L=+w[0][0],c=+w[0][1],W=+w[1][0],ee=+w[1][1];Mv(L,c,W,ee),zv(L,c,W,ee)}this.edges=sa,this.cells=To,$h=jf=sa=To=null}am.prototype={constructor:am,polygons:function(){var k=this.edges;return this.cells.map(function(w){var S=w.halfedges.map(function(E){return wy(w,k[E])});return S.data=w.site.data,S})},triangles:function(){var k=[],w=this.edges;return this.cells.forEach(function(S,E){if(c=(N=S.halfedges).length)for(var T=S.site,N,L=-1,c,W,ee=w[N[c-1]],Q=ee.left===T?ee.right:ee.left;++L<c;)W=Q,ee=w[N[L]],Q=ee.left===T?ee.right:ee.left,W&&Q&&E<W.index&&E<Q.index&&Vv(T,W,Q)<0&&k.push([T.data,W.data,Q.data])}),k},links:function(){return this.edges.filter(function(k){return k.right}).map(function(k){return{source:k.left.data,target:k.right.data}})},find:function(k,w,S){for(var E=this,T,N=E._found||0,L=E.cells.length,c;!(c=E.cells[N]);)if(++N>=L)return null;var W=k-c.site[0],ee=w-c.site[1],Q=W*W+ee*ee;do c=E.cells[T=N],N=null,c.halfedges.forEach(function(F){var q=E.edges[F],se=q.left;if(!((se===c.site||!se)&&!(se=q.right))){var le=k-se[0],fe=w-se[1],Ie=le*le+fe*fe;Ie<Q&&(Q=Ie,N=se.index)}});while(N!==null);return E._found=T,S==null||Q<=S*S?c.site:null}};function qv(){var k=Iv,w=Tv,S=null;function E(T){return new am(T.map(function(N,L){var c=[Math.round(k(N,L,T)/Fi)*Fi,Math.round(w(N,L,T)/Fi)*Fi];return c.index=L,c.data=N,c}),S)}return E.polygons=function(T){return E(T).polygons()},E.links=function(T){return E(T).links()},E.triangles=function(T){return E(T).triangles()},E.x=function(T){return arguments.length?(k=typeof T=="function"?T:Mg(+T),E):k},E.y=function(T){return arguments.length?(w=typeof T=="function"?T:Mg(+T),E):w},E.extent=function(T){return arguments.length?(S=T==null?null:[[+T[0][0],+T[0][1]],[+T[1][0],+T[1][1]]],E):S&&[[S[0][0],S[0][1]],[S[1][0],S[1][1]]]},E.size=function(T){return arguments.length?(S=T==null?null:[[0,0],[+T[0],+T[1]]],E):S&&[S[1][0]-S[0][0],S[1][1]-S[0][1]]},E}function Gv(k){return k=k.slice(),k.push(k[0]),dm([k])}function Ey(k,w){if(w=w||{},!ty(w))throw new Error("options is invalid");const S=w.bbox||[-180,-85,180,85];if(!k)throw new Error("points is required");if(!Array.isArray(S))throw new Error("bbox is invalid");return __(k,"Point","points"),Ff(qv().x(E=>E.geometry.coordinates[0]).y(E=>E.geometry.coordinates[1]).extent([[S[0],S[1]],[S[2],S[3]]]).polygons(k.features).map(function(E,T){return Object.assign(Gv(E),{properties:mm(k.features[T].properties)})}))}const $v={features:[{type:"Feature",properties:{name:"United Kingdom",iso_a2:"GB"},geometry:{type:"MultiPolygon",coordinates:[[[[-7.57,49.96],[-6,50],[-5.2,50.2],[-4.4,50.3],[-3.4,50.6],[-2,50.8],[-1.1,50.9],[.4,51],[1.6,52],[1.8,53],[1.4,54.2],[.2,55.1],[-1.3,55.8],[-3.2,56.4],[-4.6,57.4],[-5.5,58.2],[-6,58.6],[-6.8,58.2],[-7.2,57],[-7,55],[-7.5,53],[-7,51.5],[-7.57,49.96]]]]}},{type:"Feature",properties:{name:"United States",iso_a2:"US"},geometry:{type:"Polygon",coordinates:[[[-124.8,24.4],[-66.9,24.4],[-66.9,49.4],[-124.8,49.4],[-124.8,24.4]]]}}]};class uc{constructor(w,S){this.next=null,this.key=w,this.data=S,this.left=null,this.right=null}}function Zv(k,w){return k>w?1:k<w?-1:0}function sc(k,w,S){const E=new uc(null,null);let T=E,N=E;for(;;){const L=S(k,w.key);if(L<0){if(w.left===null)break;if(S(k,w.left.key)<0){const c=w.left;if(w.left=c.right,c.right=w,w=c,w.left===null)break}N.left=w,N=w,w=w.left}else if(L>0){if(w.right===null)break;if(S(k,w.right.key)>0){const c=w.right;if(w.right=c.left,c.left=w,w=c,w.right===null)break}T.right=w,T=w,w=w.right}else break}return T.right=w.left,N.left=w.right,w.left=E.right,w.right=E.left,w}function Xp(k,w,S,E){const T=new uc(k,w);if(S===null)return T.left=T.right=null,T;S=sc(k,S,E);const N=E(k,S.key);return N<0?(T.left=S.left,T.right=S,S.left=null):N>=0&&(T.right=S.right,T.left=S,S.right=null),T}function Rg(k,w,S){let E=null,T=null;if(w){w=sc(k,w,S);const N=S(w.key,k);N===0?(E=w.left,T=w.right):N<0?(T=w.right,w.right=null,E=w):(E=w.left,w.left=null,T=w)}return{left:E,right:T}}function Hv(k,w,S){return w===null?k:(k===null||(w=sc(k.key,w,S),w.left=k),w)}function om(k,w,S,E,T){if(k){E(`${w}${S?" ":" "}${T(k)}
`);const N=w+(S?"    ":"   ");k.left&&om(k.left,N,!1,E,T),k.right&&om(k.right,N,!0,E,T)}}class _m{constructor(w=Zv){this._root=null,this._size=0,this._comparator=w}insert(w,S){return this._size++,this._root=Xp(w,S,this._root,this._comparator)}add(w,S){const E=new uc(w,S);this._root===null&&(E.left=E.right=null,this._size++,this._root=E);const T=this._comparator,N=sc(w,this._root,T),L=T(w,N.key);return L===0?this._root=N:(L<0?(E.left=N.left,E.right=N,N.left=null):L>0&&(E.right=N.right,E.left=N,N.right=null),this._size++,this._root=E),this._root}remove(w){this._root=this._remove(w,this._root,this._comparator)}_remove(w,S,E){let T;return S===null?null:(S=sc(w,S,E),E(w,S.key)===0?(S.left===null?T=S.right:(T=sc(w,S.left,E),T.right=S.right),this._size--,T):S)}pop(){let w=this._root;if(w){for(;w.left;)w=w.left;return this._root=sc(w.key,this._root,this._comparator),this._root=this._remove(w.key,this._root,this._comparator),{key:w.key,data:w.data}}return null}findStatic(w){let S=this._root;const E=this._comparator;for(;S;){const T=E(w,S.key);if(T===0)return S;T<0?S=S.left:S=S.right}return null}find(w){return this._root&&(this._root=sc(w,this._root,this._comparator),this._comparator(w,this._root.key)!==0)?null:this._root}contains(w){let S=this._root;const E=this._comparator;for(;S;){const T=E(w,S.key);if(T===0)return!0;T<0?S=S.left:S=S.right}return!1}forEach(w,S){let E=this._root;const T=[];let N=!1;for(;!N;)E!==null?(T.push(E),E=E.left):T.length!==0?(E=T.pop(),w.call(S,E),E=E.right):N=!0;return this}range(w,S,E,T){const N=[],L=this._comparator;let c=this._root,W;for(;N.length!==0||c;)if(c)N.push(c),c=c.left;else{if(c=N.pop(),W=L(c.key,S),W>0)break;if(L(c.key,w)>=0&&E.call(T,c))return this;c=c.right}return this}keys(){const w=[];return this.forEach(({key:S})=>{w.push(S)}),w}values(){const w=[];return this.forEach(({data:S})=>{w.push(S)}),w}min(){return this._root?this.minNode(this._root).key:null}max(){return this._root?this.maxNode(this._root).key:null}minNode(w=this._root){if(w)for(;w.left;)w=w.left;return w}maxNode(w=this._root){if(w)for(;w.right;)w=w.right;return w}at(w){let S=this._root,E=!1,T=0;const N=[];for(;!E;)if(S)N.push(S),S=S.left;else if(N.length>0){if(S=N.pop(),T===w)return S;T++,S=S.right}else E=!0;return null}next(w){let S=this._root,E=null;if(w.right){for(E=w.right;E.left;)E=E.left;return E}const T=this._comparator;for(;S;){const N=T(w.key,S.key);if(N===0)break;N<0?(E=S,S=S.left):S=S.right}return E}prev(w){let S=this._root,E=null;if(w.left!==null){for(E=w.left;E.right;)E=E.right;return E}const T=this._comparator;for(;S;){const N=T(w.key,S.key);if(N===0)break;N<0?S=S.left:(E=S,S=S.right)}return E}clear(){return this._root=null,this._size=0,this}toList(){return Wv(this._root)}load(w,S=[],E=!1){let T=w.length;const N=this._comparator;if(E&&cm(w,S,0,T-1,N),this._root===null)this._root=lm(w,S,0,T),this._size=T;else{const L=Yv(this.toList(),Xv(w,S),N);T=this._size+T,this._root=um({head:L},0,T)}return this}isEmpty(){return this._root===null}get size(){return this._size}get root(){return this._root}toString(w=S=>String(S.key)){const S=[];return om(this._root,"",!0,E=>S.push(E),w),S.join("")}update(w,S,E){const T=this._comparator;let{left:N,right:L}=Rg(w,this._root,T);T(w,S)<0?L=Xp(S,E,L,T):N=Xp(S,E,N,T),this._root=Hv(N,L,T)}split(w){return Rg(w,this._root,this._comparator)}*[Symbol.iterator](){let w=this._root;const S=[];let E=!1;for(;!E;)w!==null?(S.push(w),w=w.left):S.length!==0?(w=S.pop(),yield w,w=w.right):E=!0}}function lm(k,w,S,E){const T=E-S;if(T>0){const N=S+Math.floor(T/2),L=k[N],c=w[N],W=new uc(L,c);return W.left=lm(k,w,S,N),W.right=lm(k,w,N+1,E),W}return null}function Xv(k,w){const S=new uc(null,null);let E=S;for(let T=0;T<k.length;T++)E=E.next=new uc(k[T],w[T]);return E.next=null,S.next}function Wv(k){let w=k;const S=[];let E=!1;const T=new uc(null,null);let N=T;for(;!E;)w?(S.push(w),w=w.left):S.length>0?(w=N=N.next=S.pop(),w=w.right):E=!0;return N.next=null,T.next}function um(k,w,S){const E=S-w;if(E>0){const T=w+Math.floor(E/2),N=um(k,w,T),L=k.head;return L.left=N,k.head=k.head.next,L.right=um(k,T+1,S),L}return null}function Yv(k,w,S){const E=new uc(null,null);let T=E,N=k,L=w;for(;N!==null&&L!==null;)S(N.key,L.key)<0?(T.next=N,N=N.next):(T.next=L,L=L.next),T=T.next;return N!==null?T.next=N:L!==null&&(T.next=L),E.next}function cm(k,w,S,E,T){if(S>=E)return;const N=k[S+E>>1];let L=S-1,c=E+1;for(;;){do L++;while(T(k[L],N)<0);do c--;while(T(k[c],N)>0);if(L>=c)break;let W=k[L];k[L]=k[c],k[c]=W,W=w[L],w[L]=w[c],w[c]=W}cm(k,w,S,c,T),cm(k,w,c+1,E,T)}const Au=11102230246251565e-32,ia=134217729,Kv=(3+8*Au)*Au;function Wp(k,w,S,E,T){let N,L,c,W,ee=w[0],Q=E[0],F=0,q=0;Q>ee==Q>-ee?(N=ee,ee=w[++F]):(N=Q,Q=E[++q]);let se=0;if(F<k&&q<S)for(Q>ee==Q>-ee?(L=ee+N,c=N-(L-ee),ee=w[++F]):(L=Q+N,c=N-(L-Q),Q=E[++q]),N=L,c!==0&&(T[se++]=c);F<k&&q<S;)Q>ee==Q>-ee?(L=N+ee,W=L-N,c=N-(L-W)+(ee-W),ee=w[++F]):(L=N+Q,W=L-N,c=N-(L-W)+(Q-W),Q=E[++q]),N=L,c!==0&&(T[se++]=c);for(;F<k;)L=N+ee,W=L-N,c=N-(L-W)+(ee-W),ee=w[++F],N=L,c!==0&&(T[se++]=c);for(;q<S;)L=N+Q,W=L-N,c=N-(L-W)+(Q-W),Q=E[++q],N=L,c!==0&&(T[se++]=c);return(N!==0||se===0)&&(T[se++]=N),se}function Jv(k,w){let S=w[0];for(let E=1;E<k;E++)S+=w[E];return S}function Zf(k){return new Float64Array(k)}const Qv=(3+16*Au)*Au,e0=(2+12*Au)*Au,t0=(9+64*Au)*Au*Au,Uh=Zf(4),Ng=Zf(8),zg=Zf(12),Dg=Zf(16),Pa=Zf(4);function n0(k,w,S,E,T,N,L){let c,W,ee,Q,F,q,se,le,fe,Ie,Be,Ce,Ge,it,We,tt,at,ht;const ft=k-T,$t=S-T,wt=w-N,Zt=E-N;it=ft*Zt,q=ia*ft,se=q-(q-ft),le=ft-se,q=ia*Zt,fe=q-(q-Zt),Ie=Zt-fe,We=le*Ie-(it-se*fe-le*fe-se*Ie),tt=wt*$t,q=ia*wt,se=q-(q-wt),le=wt-se,q=ia*$t,fe=q-(q-$t),Ie=$t-fe,at=le*Ie-(tt-se*fe-le*fe-se*Ie),Be=We-at,F=We-Be,Uh[0]=We-(Be+F)+(F-at),Ce=it+Be,F=Ce-it,Ge=it-(Ce-F)+(Be-F),Be=Ge-tt,F=Ge-Be,Uh[1]=Ge-(Be+F)+(F-tt),ht=Ce+Be,F=ht-Ce,Uh[2]=Ce-(ht-F)+(Be-F),Uh[3]=ht;let Bt=Jv(4,Uh),je=e0*L;if(Bt>=je||-Bt>=je||(F=k-ft,c=k-(ft+F)+(F-T),F=S-$t,ee=S-($t+F)+(F-T),F=w-wt,W=w-(wt+F)+(F-N),F=E-Zt,Q=E-(Zt+F)+(F-N),c===0&&W===0&&ee===0&&Q===0)||(je=t0*L+Kv*Math.abs(Bt),Bt+=ft*Q+Zt*c-(wt*ee+$t*W),Bt>=je||-Bt>=je))return Bt;it=c*Zt,q=ia*c,se=q-(q-c),le=c-se,q=ia*Zt,fe=q-(q-Zt),Ie=Zt-fe,We=le*Ie-(it-se*fe-le*fe-se*Ie),tt=W*$t,q=ia*W,se=q-(q-W),le=W-se,q=ia*$t,fe=q-(q-$t),Ie=$t-fe,at=le*Ie-(tt-se*fe-le*fe-se*Ie),Be=We-at,F=We-Be,Pa[0]=We-(Be+F)+(F-at),Ce=it+Be,F=Ce-it,Ge=it-(Ce-F)+(Be-F),Be=Ge-tt,F=Ge-Be,Pa[1]=Ge-(Be+F)+(F-tt),ht=Ce+Be,F=ht-Ce,Pa[2]=Ce-(ht-F)+(Be-F),Pa[3]=ht;const zt=Wp(4,Uh,4,Pa,Ng);it=ft*Q,q=ia*ft,se=q-(q-ft),le=ft-se,q=ia*Q,fe=q-(q-Q),Ie=Q-fe,We=le*Ie-(it-se*fe-le*fe-se*Ie),tt=wt*ee,q=ia*wt,se=q-(q-wt),le=wt-se,q=ia*ee,fe=q-(q-ee),Ie=ee-fe,at=le*Ie-(tt-se*fe-le*fe-se*Ie),Be=We-at,F=We-Be,Pa[0]=We-(Be+F)+(F-at),Ce=it+Be,F=Ce-it,Ge=it-(Ce-F)+(Be-F),Be=Ge-tt,F=Ge-Be,Pa[1]=Ge-(Be+F)+(F-tt),ht=Ce+Be,F=ht-Ce,Pa[2]=Ce-(ht-F)+(Be-F),Pa[3]=ht;const an=Wp(zt,Ng,4,Pa,zg);it=c*Q,q=ia*c,se=q-(q-c),le=c-se,q=ia*Q,fe=q-(q-Q),Ie=Q-fe,We=le*Ie-(it-se*fe-le*fe-se*Ie),tt=W*ee,q=ia*W,se=q-(q-W),le=W-se,q=ia*ee,fe=q-(q-ee),Ie=ee-fe,at=le*Ie-(tt-se*fe-le*fe-se*Ie),Be=We-at,F=We-Be,Pa[0]=We-(Be+F)+(F-at),Ce=it+Be,F=Ce-it,Ge=it-(Ce-F)+(Be-F),Be=Ge-tt,F=Ge-Be,Pa[1]=Ge-(Be+F)+(F-tt),ht=Ce+Be,F=ht-Ce,Pa[2]=Ce-(ht-F)+(Be-F),Pa[3]=ht;const rn=Wp(an,zg,4,Pa,Dg);return Dg[rn-1]}function i0(k,w,S,E,T,N){const L=(w-N)*(S-T),c=(k-T)*(E-N),W=L-c,ee=Math.abs(L+c);return Math.abs(W)>=Qv*ee?W:-n0(k,w,S,E,T,N,ee)}var Iy={};const Lf=(k,w)=>k.ll.x<=w.x&&w.x<=k.ur.x&&k.ll.y<=w.y&&w.y<=k.ur.y,hm=(k,w)=>{if(w.ur.x<k.ll.x||k.ur.x<w.ll.x||w.ur.y<k.ll.y||k.ur.y<w.ll.y)return null;const S=k.ll.x<w.ll.x?w.ll.x:k.ll.x,E=k.ur.x<w.ur.x?k.ur.x:w.ur.x,T=k.ll.y<w.ll.y?w.ll.y:k.ll.y,N=k.ur.y<w.ur.y?k.ur.y:w.ur.y;return{ll:{x:S,y:T},ur:{x:E,y:N}}};let ac=Number.EPSILON;ac===void 0&&(ac=Math.pow(2,-52));const r0=ac*ac,Og=(k,w)=>{if(-ac<k&&k<ac&&-ac<w&&w<ac)return 0;const S=k-w;return S*S<r0*k*w?0:k<w?-1:1};class s0{constructor(){this.reset()}reset(){this.xRounder=new Fg,this.yRounder=new Fg}round(w,S){return{x:this.xRounder.round(w),y:this.yRounder.round(S)}}}class Fg{constructor(){this.tree=new _m,this.round(0)}round(w){const S=this.tree.add(w),E=this.tree.prev(S);if(E!==null&&Og(S.key,E.key)===0)return this.tree.remove(w),E.key;const T=this.tree.next(S);return T!==null&&Og(S.key,T.key)===0?(this.tree.remove(w),T.key):w}}const Vf=new s0,Hd=(k,w)=>k.x*w.y-k.y*w.x,Ty=(k,w)=>k.x*w.x+k.y*w.y,Bg=(k,w,S)=>{const E=i0(k.x,k.y,w.x,w.y,S.x,S.y);return E>0?-1:E<0?1:0},rp=k=>Math.sqrt(Ty(k,k)),a0=(k,w,S)=>{const E={x:w.x-k.x,y:w.y-k.y},T={x:S.x-k.x,y:S.y-k.y};return Hd(T,E)/rp(T)/rp(E)},o0=(k,w,S)=>{const E={x:w.x-k.x,y:w.y-k.y},T={x:S.x-k.x,y:S.y-k.y};return Ty(T,E)/rp(T)/rp(E)},jg=(k,w,S)=>w.y===0?null:{x:k.x+w.x/w.y*(S-k.y),y:S},Vg=(k,w,S)=>w.x===0?null:{x:S,y:k.y+w.y/w.x*(S-k.x)},l0=(k,w,S,E)=>{if(w.x===0)return Vg(S,E,k.x);if(E.x===0)return Vg(k,w,S.x);if(w.y===0)return jg(S,E,k.y);if(E.y===0)return jg(k,w,S.y);const T=Hd(w,E);if(T==0)return null;const N={x:S.x-k.x,y:S.y-k.y},L=Hd(N,w)/T,c=Hd(N,E)/T,W=k.x+c*w.x,ee=S.x+L*E.x,Q=k.y+c*w.y,F=S.y+L*E.y,q=(W+ee)/2,se=(Q+F)/2;return{x:q,y:se}};class Ho{static compare(w,S){const E=Ho.comparePoints(w.point,S.point);return E!==0?E:(w.point!==S.point&&w.link(S),w.isLeft!==S.isLeft?w.isLeft?1:-1:lc.compare(w.segment,S.segment))}static comparePoints(w,S){return w.x<S.x?-1:w.x>S.x?1:w.y<S.y?-1:w.y>S.y?1:0}constructor(w,S){w.events===void 0?w.events=[this]:w.events.push(this),this.point=w,this.isLeft=S}link(w){if(w.point===this.point)throw new Error("Tried to link already linked events");const S=w.point.events;for(let E=0,T=S.length;E<T;E++){const N=S[E];this.point.events.push(N),N.point=this.point}this.checkForConsuming()}checkForConsuming(){const w=this.point.events.length;for(let S=0;S<w;S++){const E=this.point.events[S];if(E.segment.consumedBy===void 0)for(let T=S+1;T<w;T++){const N=this.point.events[T];N.consumedBy===void 0&&E.otherSE.point.events===N.otherSE.point.events&&E.segment.consume(N.segment)}}}getAvailableLinkedEvents(){const w=[];for(let S=0,E=this.point.events.length;S<E;S++){const T=this.point.events[S];T!==this&&!T.segment.ringOut&&T.segment.isInResult()&&w.push(T)}return w}getLeftmostComparator(w){const S=new Map,E=T=>{const N=T.otherSE;S.set(T,{sine:a0(this.point,w.point,N.point),cosine:o0(this.point,w.point,N.point)})};return(T,N)=>{S.has(T)||E(T),S.has(N)||E(N);const{sine:L,cosine:c}=S.get(T),{sine:W,cosine:ee}=S.get(N);return L>=0&&W>=0?c<ee?1:c>ee?-1:0:L<0&&W<0?c<ee?-1:c>ee?1:0:W<L?-1:W>L?1:0}}}let u0=0;class lc{static compare(w,S){const E=w.leftSE.point.x,T=S.leftSE.point.x,N=w.rightSE.point.x,L=S.rightSE.point.x;if(L<E)return 1;if(N<T)return-1;const c=w.leftSE.point.y,W=S.leftSE.point.y,ee=w.rightSE.point.y,Q=S.rightSE.point.y;if(E<T){if(W<c&&W<ee)return 1;if(W>c&&W>ee)return-1;const F=w.comparePoint(S.leftSE.point);if(F<0)return 1;if(F>0)return-1;const q=S.comparePoint(w.rightSE.point);return q!==0?q:-1}if(E>T){if(c<W&&c<Q)return-1;if(c>W&&c>Q)return 1;const F=S.comparePoint(w.leftSE.point);if(F!==0)return F;const q=w.comparePoint(S.rightSE.point);return q<0?1:q>0?-1:1}if(c<W)return-1;if(c>W)return 1;if(N<L){const F=S.comparePoint(w.rightSE.point);if(F!==0)return F}if(N>L){const F=w.comparePoint(S.rightSE.point);if(F<0)return 1;if(F>0)return-1}if(N!==L){const F=ee-c,q=N-E,se=Q-W,le=L-T;if(F>q&&se<le)return 1;if(F<q&&se>le)return-1}return N>L?1:N<L||ee<Q?-1:ee>Q?1:w.id<S.id?-1:w.id>S.id?1:0}constructor(w,S,E,T){this.id=++u0,this.leftSE=w,w.segment=this,w.otherSE=S,this.rightSE=S,S.segment=this,S.otherSE=w,this.rings=E,this.windings=T}static fromRing(w,S,E){let T,N,L;const c=Ho.comparePoints(w,S);if(c<0)T=w,N=S,L=1;else if(c>0)T=S,N=w,L=-1;else throw new Error(`Tried to create degenerate segment at [${w.x}, ${w.y}]`);const W=new Ho(T,!0),ee=new Ho(N,!1);return new lc(W,ee,[E],[L])}replaceRightSE(w){this.rightSE=w,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const w=this.leftSE.point.y,S=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:w<S?w:S},ur:{x:this.rightSE.point.x,y:w>S?w:S}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(w){return w.x===this.leftSE.point.x&&w.y===this.leftSE.point.y||w.x===this.rightSE.point.x&&w.y===this.rightSE.point.y}comparePoint(w){if(this.isAnEndpoint(w))return 0;const S=this.leftSE.point,E=this.rightSE.point,T=this.vector();if(S.x===E.x)return w.x===S.x?0:w.x<S.x?1:-1;const N=(w.y-S.y)/T.y,L=S.x+N*T.x;if(w.x===L)return 0;const c=(w.x-S.x)/T.x,W=S.y+c*T.y;return w.y===W?0:w.y<W?-1:1}getIntersection(w){const S=this.bbox(),E=w.bbox(),T=hm(S,E);if(T===null)return null;const N=this.leftSE.point,L=this.rightSE.point,c=w.leftSE.point,W=w.rightSE.point,ee=Lf(S,c)&&this.comparePoint(c)===0,Q=Lf(E,N)&&w.comparePoint(N)===0,F=Lf(S,W)&&this.comparePoint(W)===0,q=Lf(E,L)&&w.comparePoint(L)===0;if(Q&&ee)return q&&!F?L:!q&&F?W:null;if(Q)return F&&N.x===W.x&&N.y===W.y?null:N;if(ee)return q&&L.x===c.x&&L.y===c.y?null:c;if(q&&F)return null;if(q)return L;if(F)return W;const se=l0(N,this.vector(),c,w.vector());return se===null||!Lf(T,se)?null:Vf.round(se.x,se.y)}split(w){const S=[],E=w.events!==void 0,T=new Ho(w,!0),N=new Ho(w,!1),L=this.rightSE;this.replaceRightSE(N),S.push(N),S.push(T);const c=new lc(T,L,this.rings.slice(),this.windings.slice());return Ho.comparePoints(c.leftSE.point,c.rightSE.point)>0&&c.swapEvents(),Ho.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),E&&(T.checkForConsuming(),N.checkForConsuming()),S}swapEvents(){const w=this.rightSE;this.rightSE=this.leftSE,this.leftSE=w,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let S=0,E=this.windings.length;S<E;S++)this.windings[S]*=-1}consume(w){let S=this,E=w;for(;S.consumedBy;)S=S.consumedBy;for(;E.consumedBy;)E=E.consumedBy;const T=lc.compare(S,E);if(T!==0){if(T>0){const N=S;S=E,E=N}if(S.prev===E){const N=S;S=E,E=N}for(let N=0,L=E.rings.length;N<L;N++){const c=E.rings[N],W=E.windings[N],ee=S.rings.indexOf(c);ee===-1?(S.rings.push(c),S.windings.push(W)):S.windings[ee]+=W}E.rings=null,E.windings=null,E.consumedBy=S,E.leftSE.consumedBy=S.leftSE,E.rightSE.consumedBy=S.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const w=this.prev.consumedBy||this.prev;this._beforeState=w.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const w=this.beforeState();this._afterState={rings:w.rings.slice(0),windings:w.windings.slice(0),multiPolys:[]};const S=this._afterState.rings,E=this._afterState.windings,T=this._afterState.multiPolys;for(let c=0,W=this.rings.length;c<W;c++){const ee=this.rings[c],Q=this.windings[c],F=S.indexOf(ee);F===-1?(S.push(ee),E.push(Q)):E[F]+=Q}const N=[],L=[];for(let c=0,W=S.length;c<W;c++){if(E[c]===0)continue;const ee=S[c],Q=ee.poly;if(L.indexOf(Q)===-1)if(ee.isExterior)N.push(Q);else{L.indexOf(Q)===-1&&L.push(Q);const F=N.indexOf(ee.poly);F!==-1&&N.splice(F,1)}}for(let c=0,W=N.length;c<W;c++){const ee=N[c].multiPoly;T.indexOf(ee)===-1&&T.push(ee)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const w=this.beforeState().multiPolys,S=this.afterState().multiPolys;switch(gl.type){case"union":{const E=w.length===0,T=S.length===0;this._isInResult=E!==T;break}case"intersection":{let E,T;w.length<S.length?(E=w.length,T=S.length):(E=S.length,T=w.length),this._isInResult=T===gl.numMultiPolys&&E<T;break}case"xor":{const E=Math.abs(w.length-S.length);this._isInResult=E%2===1;break}case"difference":{const E=T=>T.length===1&&T[0].isSubject;this._isInResult=E(w)!==E(S);break}default:throw new Error(`Unrecognized operation type found ${gl.type}`)}return this._isInResult}}class Ug{constructor(w,S,E){if(!Array.isArray(w)||w.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=S,this.isExterior=E,this.segments=[],typeof w[0][0]!="number"||typeof w[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const T=Vf.round(w[0][0],w[0][1]);this.bbox={ll:{x:T.x,y:T.y},ur:{x:T.x,y:T.y}};let N=T;for(let L=1,c=w.length;L<c;L++){if(typeof w[L][0]!="number"||typeof w[L][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let W=Vf.round(w[L][0],w[L][1]);W.x===N.x&&W.y===N.y||(this.segments.push(lc.fromRing(N,W,this)),W.x<this.bbox.ll.x&&(this.bbox.ll.x=W.x),W.y<this.bbox.ll.y&&(this.bbox.ll.y=W.y),W.x>this.bbox.ur.x&&(this.bbox.ur.x=W.x),W.y>this.bbox.ur.y&&(this.bbox.ur.y=W.y),N=W)}(T.x!==N.x||T.y!==N.y)&&this.segments.push(lc.fromRing(N,T,this))}getSweepEvents(){const w=[];for(let S=0,E=this.segments.length;S<E;S++){const T=this.segments[S];w.push(T.leftSE),w.push(T.rightSE)}return w}}class c0{constructor(w,S){if(!Array.isArray(w))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ug(w[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let E=1,T=w.length;E<T;E++){const N=new Ug(w[E],this,!1);N.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=N.bbox.ll.x),N.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=N.bbox.ll.y),N.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=N.bbox.ur.x),N.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=N.bbox.ur.y),this.interiorRings.push(N)}this.multiPoly=S}getSweepEvents(){const w=this.exteriorRing.getSweepEvents();for(let S=0,E=this.interiorRings.length;S<E;S++){const T=this.interiorRings[S].getSweepEvents();for(let N=0,L=T.length;N<L;N++)w.push(T[N])}return w}}class qg{constructor(w,S){if(!Array.isArray(w))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof w[0][0][0]=="number"&&(w=[w])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let E=0,T=w.length;E<T;E++){const N=new c0(w[E],this);N.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=N.bbox.ll.x),N.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=N.bbox.ll.y),N.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=N.bbox.ur.x),N.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=N.bbox.ur.y),this.polys.push(N)}this.isSubject=S}getSweepEvents(){const w=[];for(let S=0,E=this.polys.length;S<E;S++){const T=this.polys[S].getSweepEvents();for(let N=0,L=T.length;N<L;N++)w.push(T[N])}return w}}class sp{static factory(w){const S=[];for(let E=0,T=w.length;E<T;E++){const N=w[E];if(!N.isInResult()||N.ringOut)continue;let L=null,c=N.leftSE,W=N.rightSE;const ee=[c],Q=c.point,F=[];for(;L=c,c=W,ee.push(c),c.point!==Q;)for(;;){const q=c.getAvailableLinkedEvents();if(q.length===0){const fe=ee[0].point,Ie=ee[ee.length-1].point;throw new Error(`Unable to complete output ring starting at [${fe.x}, ${fe.y}]. Last matching segment found ends at [${Ie.x}, ${Ie.y}].`)}if(q.length===1){W=q[0].otherSE;break}let se=null;for(let fe=0,Ie=F.length;fe<Ie;fe++)if(F[fe].point===c.point){se=fe;break}if(se!==null){const fe=F.splice(se)[0],Ie=ee.splice(fe.index);Ie.unshift(Ie[0].otherSE),S.push(new sp(Ie.reverse()));continue}F.push({index:ee.length,point:c.point});const le=c.getLeftmostComparator(L);W=q.sort(le)[0].otherSE;break}S.push(new sp(ee))}return S}constructor(w){this.events=w;for(let S=0,E=w.length;S<E;S++)w[S].segment.ringOut=this;this.poly=null}getGeom(){let w=this.events[0].point;const S=[w];for(let ee=1,Q=this.events.length-1;ee<Q;ee++){const F=this.events[ee].point,q=this.events[ee+1].point;Bg(F,w,q)!==0&&(S.push(F),w=F)}if(S.length===1)return null;const E=S[0],T=S[1];Bg(E,w,T)===0&&S.shift(),S.push(S[0]);const N=this.isExteriorRing()?1:-1,L=this.isExteriorRing()?0:S.length-1,c=this.isExteriorRing()?S.length:-1,W=[];for(let ee=L;ee!=c;ee+=N)W.push([S[ee].x,S[ee].y]);return W}isExteriorRing(){if(this._isExteriorRing===void 0){const w=this.enclosingRing();this._isExteriorRing=w?!w.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let w=this.events[0];for(let T=1,N=this.events.length;T<N;T++){const L=this.events[T];Ho.compare(w,L)>0&&(w=L)}let S=w.segment.prevInResult(),E=S?S.prevInResult():null;for(;;){if(!S)return null;if(!E)return S.ringOut;if(E.ringOut!==S.ringOut)return E.ringOut.enclosingRing()!==S.ringOut?S.ringOut:S.ringOut.enclosingRing();S=E.prevInResult(),E=S?S.prevInResult():null}}}class Gg{constructor(w){this.exteriorRing=w,w.poly=this,this.interiorRings=[]}addInterior(w){this.interiorRings.push(w),w.poly=this}getGeom(){const w=[this.exteriorRing.getGeom()];if(w[0]===null)return null;for(let S=0,E=this.interiorRings.length;S<E;S++){const T=this.interiorRings[S].getGeom();T!==null&&w.push(T)}return w}}class h0{constructor(w){this.rings=w,this.polys=this._composePolys(w)}getGeom(){const w=[];for(let S=0,E=this.polys.length;S<E;S++){const T=this.polys[S].getGeom();T!==null&&w.push(T)}return w}_composePolys(w){const S=[];for(let E=0,T=w.length;E<T;E++){const N=w[E];if(!N.poly)if(N.isExteriorRing())S.push(new Gg(N));else{const L=N.enclosingRing();L.poly||S.push(new Gg(L)),L.poly.addInterior(N)}}return S}}class f0{constructor(w){let S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:lc.compare;this.queue=w,this.tree=new _m(S),this.segments=[]}process(w){const S=w.segment,E=[];if(w.consumedBy)return w.isLeft?this.queue.remove(w.otherSE):this.tree.remove(S),E;const T=w.isLeft?this.tree.add(S):this.tree.find(S);if(!T)throw new Error(`Unable to find segment #${S.id} [${S.leftSE.point.x}, ${S.leftSE.point.y}] -> [${S.rightSE.point.x}, ${S.rightSE.point.y}] in SweepLine tree.`);let N=T,L=T,c,W;for(;c===void 0;)N=this.tree.prev(N),N===null?c=null:N.key.consumedBy===void 0&&(c=N.key);for(;W===void 0;)L=this.tree.next(L),L===null?W=null:L.key.consumedBy===void 0&&(W=L.key);if(w.isLeft){let ee=null;if(c){const F=c.getIntersection(S);if(F!==null&&(S.isAnEndpoint(F)||(ee=F),!c.isAnEndpoint(F))){const q=this._splitSafely(c,F);for(let se=0,le=q.length;se<le;se++)E.push(q[se])}}let Q=null;if(W){const F=W.getIntersection(S);if(F!==null&&(S.isAnEndpoint(F)||(Q=F),!W.isAnEndpoint(F))){const q=this._splitSafely(W,F);for(let se=0,le=q.length;se<le;se++)E.push(q[se])}}if(ee!==null||Q!==null){let F=null;ee===null?F=Q:Q===null?F=ee:F=Ho.comparePoints(ee,Q)<=0?ee:Q,this.queue.remove(S.rightSE),E.push(S.rightSE);const q=S.split(F);for(let se=0,le=q.length;se<le;se++)E.push(q[se])}E.length>0?(this.tree.remove(S),E.push(w)):(this.segments.push(S),S.prev=c)}else{if(c&&W){const ee=c.getIntersection(W);if(ee!==null){if(!c.isAnEndpoint(ee)){const Q=this._splitSafely(c,ee);for(let F=0,q=Q.length;F<q;F++)E.push(Q[F])}if(!W.isAnEndpoint(ee)){const Q=this._splitSafely(W,ee);for(let F=0,q=Q.length;F<q;F++)E.push(Q[F])}}}this.tree.remove(S)}return E}_splitSafely(w,S){this.tree.remove(w);const E=w.rightSE;this.queue.remove(E);const T=w.split(S);return T.push(E),w.consumedBy===void 0&&this.tree.add(w),T}}const $g=typeof process<"u"&&Iy.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,d0=typeof process<"u"&&Iy.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class p0{run(w,S,E){gl.type=w,Vf.reset();const T=[new qg(S,!0)];for(let F=0,q=E.length;F<q;F++)T.push(new qg(E[F],!1));if(gl.numMultiPolys=T.length,gl.type==="difference"){const F=T[0];let q=1;for(;q<T.length;)hm(T[q].bbox,F.bbox)!==null?q++:T.splice(q,1)}if(gl.type==="intersection")for(let F=0,q=T.length;F<q;F++){const se=T[F];for(let le=F+1,fe=T.length;le<fe;le++)if(hm(se.bbox,T[le].bbox)===null)return[]}const N=new _m(Ho.compare);for(let F=0,q=T.length;F<q;F++){const se=T[F].getSweepEvents();for(let le=0,fe=se.length;le<fe;le++)if(N.insert(se[le]),N.size>$g)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const L=new f0(N);let c=N.size,W=N.pop();for(;W;){const F=W.key;if(N.size===c){const se=F.segment;throw new Error(`Unable to pop() ${F.isLeft?"left":"right"} SweepEvent [${F.point.x}, ${F.point.y}] from segment #${se.id} [${se.leftSE.point.x}, ${se.leftSE.point.y}] -> [${se.rightSE.point.x}, ${se.rightSE.point.y}] from queue.`)}if(N.size>$g)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(L.segments.length>d0)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const q=L.process(F);for(let se=0,le=q.length;se<le;se++){const fe=q[se];fe.consumedBy===void 0&&N.insert(fe)}c=N.size,W=N.pop()}Vf.reset();const ee=sp.factory(L.segments);return new h0(ee).getGeom()}}const gl=new p0,m0=function(k){for(var w=arguments.length,S=new Array(w>1?w-1:0),E=1;E<w;E++)S[E-1]=arguments[E];return gl.run("union",k,S)},g0=function(k){for(var w=arguments.length,S=new Array(w>1?w-1:0),E=1;E<w;E++)S[E-1]=arguments[E];return gl.run("intersection",k,S)},y0=function(k){for(var w=arguments.length,S=new Array(w>1?w-1:0),E=1;E<w;E++)S[E-1]=arguments[E];return gl.run("xor",k,S)},_0=function(k){for(var w=arguments.length,S=new Array(w>1?w-1:0),E=1;E<w;E++)S[E-1]=arguments[E];return gl.run("difference",k,S)};var vm={union:m0,intersection:g0,xor:y0,difference:_0};function Wh(k){return k.type==="Polygon"?[k.coordinates]:k.coordinates}function xm(k){return!k||k.length===0?null:k.length===1?{type:"Polygon",coordinates:k[0]}:{type:"MultiPolygon",coordinates:k}}function Hf(k,w){const S=vm.intersection(Wh(k),Wh(w));return xm(S)}function wm(k,w){const S=vm.difference(Wh(k),Wh(w));return xm(S)}function Zg(k,w){const S=vm.union(Wh(k),Wh(w));return xm(S)}function v0(k,w=.5){const S=oc(k),E=[S[0]-w,S[1]-w,S[2]+w,S[3]+w];return iy(E)}function x0(k,w,S,E){const T=nh(w),L=yv(T,S,{units:"miles",steps:96}).geometry;return E?Hf(k,L):wm(k,L)}function w0(k,w,S,E){const T=nh(w,{id:"A"}),N=nh(S,{id:"B"}),L=Ff([T,N]),c=v0(k,1),W=oc(c),ee=Ey(L,{bbox:W});if(!ee)return null;let Q=null,F=null;for(const se of ee.features){if(!se?.geometry)continue;const le=se.geometry;Wd(T,le)&&(Q=le),Wd(N,le)&&(F=le)}const q=E?F:Q;return q?Hf(k,q):null}function b0(k){for(const w of k.geometries)if(w.type==="Polygon"||w.type==="MultiPolygon")return w;return null}function k0(k){if(k.geojson){if(k.geojson.type==="Polygon"||k.geojson.type==="MultiPolygon")return k.geojson;if(k.geojson.type==="GeometryCollection"){const c=b0(k.geojson);if(c)return c}}const[w,S,E,T]=k.boundingbox.map(parseFloat);return iy([E,w,T,S]).geometry}async function S0(k){const w=`/.netlify/functions/geocode?q=${encodeURIComponent(k)}`,S=await fetch(w);if(!S.ok){const T=await S.json().catch(()=>({})),N=T.provider?` (${T.provider})`:"",L=T.error||S.statusText||"Unknown error";throw new Error(`Geocoding failed${N}: ${S.status} ${L}`)}return await S.json()}async function Hg(k,w){const S=`/.netlify/functions/geocode?lat=${encodeURIComponent(k)}&lon=${encodeURIComponent(w)}`,E=await fetch(S);if(!E.ok){const T=await E.json().catch(()=>({})),N=T.provider?` (${T.provider})`:"",L=T.error||E.statusText||"Unknown error";throw new Error(`Reverse geocoding failed${N}: ${E.status} ${L}`)}return await E.json()}const fm=new Map,E0=900*1e3;function I0(k){const w=fm.get(k);return w?Date.now()>w.expires?(fm.delete(k),null):w.data:null}function T0(k,w){fm.set(k,{data:w,expires:Date.now()+E0})}function C0(k,w,S,E){return`${k.toFixed(2)},${w.toFixed(2)},${S.toFixed(2)},${E.toFixed(2)}`}async function Yp(k,w,S=800){const[E,T,N,L]=w,c=`${k}:${C0(E,T,N,L)}:${S}`,W=I0(c);if(W)return W.points;const ee=`/.netlify/functions/overpass?kind=${encodeURIComponent(k)}&south=${E}&west=${T}&north=${N}&east=${L}&limit=${S}`,Q=await fetch(ee);if(!Q.ok){const se=(await Q.json().catch(()=>({}))).error||Q.statusText||"Unknown error";throw new Error(`POI fetch failed: ${Q.status} ${se}`)}const F=await Q.json();return T0(c,F),F.points}function Kp(k,w){const[S,E,T,N]=k,L=(S+T)/2,c=w/110.574,W=w/(111.32*Math.cos(L*Math.PI/180));return[S-c,E-W,T+c,N+W]}function Jp(k,w){if(k.length===0)throw new Error("No points provided");const S=[];for(const N of k){const L={type:"Feature",geometry:{type:"Point",coordinates:[N.lon,N.lat]},properties:{}},c=mv(L,w,{units:"kilometers"});c&&c.geometry.type==="Polygon"&&S.push(c)}if(S.length===0)throw new Error("No valid buffers created");const E=25;let T=S[0].geometry;for(let N=1;N<S.length;N+=E){const L=S.slice(N,Math.min(N+E,S.length));let c=L[0].geometry;for(let W=1;W<L.length;W++)try{const ee=Zg(c,L[W].geometry);ee&&(c=ee)}catch(ee){console.warn("Union failed, skipping:",ee);continue}try{const W=Zg(T,c);W&&(T=W)}catch(W){console.warn("Final union failed:",W);continue}}return{type:"Feature",geometry:T,properties:{}}}function Xg(k,w,S){try{if(S){const E=Hf(k.geometry,w.geometry);return E?{type:"Feature",geometry:E,properties:{}}:null}else{const E=wm(k.geometry,w.geometry);return E?{type:"Feature",geometry:E,properties:{}}:null}}catch(E){return console.error("POI within operation failed:",E),null}}function P0(k,w){const[S,E]=k,[T,N]=w,L=6371e3,c=le=>le*Math.PI/180,W=c(N-E),ee=c(T-S),Q=Math.sin(W/2),F=Math.sin(ee/2),q=Q*Q+Math.cos(c(E))*Math.cos(c(N))*F*F,se=2*Math.atan2(Math.sqrt(q),Math.sqrt(1-q));return L*se}function Cy(k,w){if(w.length===0)return null;let S=null;for(const E of w){const T=P0(k,[E.lon,E.lat]);(!S||T<S.meters)&&(S={id:E.id,key:E.key??String(E.id),lon:E.lon,lat:E.lat,meters:T,name:E.name})}return S}function M0(k){const w=new Set,S=[];for(const E of k){const T=E.key??`${E.osmType??"x"}/${E.id}`,N=`${Math.round(E.lat*1e6)}/${Math.round(E.lon*1e6)}`,L=`${T}|${N}`;w.has(L)||(w.add(L),S.push(E))}return S}function A0({candidate:k,seekerLngLat:w,pois:S,answerYes:E,bbox:T}){const N=ig({type:"Feature",properties:{},geometry:k}),L=M0(S),c=L.length,W=Cy(w,L);if(!W)return{next:null,featureCount:c,seekerNearestKey:null,areaBefore:N,areaAfter:0,percentRemaining:0};if(c===1)return E?{next:k,featureCount:c,seekerNearestKey:W.key,areaBefore:N,areaAfter:N,percentRemaining:100}:{next:null,featureCount:c,seekerNearestKey:W.key,areaBefore:N,areaAfter:0,percentRemaining:0};const ee={type:"FeatureCollection",features:L.map(Ie=>({type:"Feature",geometry:{type:"Point",coordinates:[Ie.lon,Ie.lat]},properties:{key:Ie.key??`${Ie.osmType??"x"}/${Ie.id}`}}))},Q=Ey(ee,{bbox:T});if(!Q||!Q.features||Q.features.length===0)return{next:null,featureCount:c,seekerNearestKey:W.key,areaBefore:N,areaAfter:0,percentRemaining:0};const F=nh([W.lon,W.lat]);let q=null;for(const Ie of Q.features)if(Ie?.geometry&&Wd(F,Ie)){q=Ie.geometry;break}if(!q)return E?{next:k,featureCount:c,seekerNearestKey:W.key,areaBefore:N,areaAfter:N,percentRemaining:100}:{next:null,featureCount:c,seekerNearestKey:W.key,areaBefore:N,areaAfter:0,percentRemaining:0};const se=E?Hf(k,q):wm(k,q),le=se?ig({type:"Feature",properties:{},geometry:se}):0,fe=N>0?le/N*100:0;return{next:se,featureCount:c,seekerNearestKey:W.key,areaBefore:N,areaAfter:le,percentRemaining:fe}}function L0(k){return k/110.574}function R0(k,w){return k/(111.32*Math.cos(w*Math.PI/180))}function N0(k,w){const S=w?.maxPoints,E=w?.minStepKm,T=oc(k),[N,L,c,W]=T,ee=(L+W)/2,Q=Math.max(1,(c-N)*111.32*Math.cos(ee*Math.PI/180)),F=Math.max(1,(W-L)*110.574),q=Q*F,se=Math.max(E,Math.sqrt(q/Math.max(1,S))),le={type:"Feature",geometry:k,properties:{}},fe=[];for(let Ie=L;Ie<=W;Ie+=L0(se)){const Be=R0(se,Ie);for(let Ce=N;Ce<=c;Ce+=Be)if(Wd({type:"Feature",geometry:{type:"Point",coordinates:[Ce,Ie]},properties:{}},le)&&fe.push([Ce,Ie]),fe.length>=S)return{points:fe,stepKm:se}}return{points:fe,stepKm:se}}function Ma(){return Math.random().toString(16).slice(2)+"-"+Date.now().toString(16)}function z0(){return $v.features??[]}function D0(k,w){const S=w.trim().toUpperCase();return k.find(E=>(E.properties?.iso_a2??"").toUpperCase()===S)??null}const Zn=g_((k,w)=>({countries:z0(),selectedIsoA2:"",candidate:null,isBusy:!1,busyMessage:"Loading",seekerLngLat:null,seekerAccuracyM:null,seekerLastUpdatedMs:null,gpsWatchId:null,isTrackingGPS:!1,thermoStart:null,thermoEnd:null,history:[],undoStack:[],redoStack:[],searchQuery:"",searchResults:[],selectedAreaLabel:null,lastToast:null,setCountry:E=>{const T=D0(w().countries,E);if(!T)return;const N=(T.properties?.iso_a2??E).toUpperCase();k({selectedIsoA2:N,candidate:T.geometry,undoStack:[],redoStack:[],thermoStart:null,thermoEnd:null,history:[...w().history,{id:Ma(),ts:Date.now(),type:"SET_COUNTRY",isoA2:N,name:T.properties?.name}]})},updateSeekerFromGPS:async()=>{if(!navigator.geolocation)throw new Error("Geolocation not supported");const E=await new Promise((c,W)=>{navigator.geolocation.getCurrentPosition(c,ee=>{const Q=ee.code===1?"PERMISSION_DENIED":ee.code===2?"POSITION_UNAVAILABLE":ee.code===3?"TIMEOUT":`ERROR_${ee.code}`;W(new Error(`GPS error (${Q}): ${ee.message||"Unknown error"}`))},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),T=E.coords.longitude,N=E.coords.latitude,L=Date.now();k({seekerLngLat:[T,N],seekerAccuracyM:E.coords.accuracy??null,seekerLastUpdatedMs:L})},startGPSTracking:()=>{const E=w();if(E.isTrackingGPS||E.gpsWatchId!==null)return;if(!navigator.geolocation)throw new Error("Geolocation not supported");const T=navigator.geolocation.watchPosition(N=>{const L=N.coords.longitude,c=N.coords.latitude,W=Date.now();k({seekerLngLat:[L,c],seekerAccuracyM:N.coords.accuracy??null,seekerLastUpdatedMs:W})},N=>{console.error("GPS tracking error:",N),w().stopGPSTracking()},{enableHighAccuracy:!0,maximumAge:0});k({gpsWatchId:T,isTrackingGPS:!0})},stopGPSTracking:()=>{const E=w();E.gpsWatchId!==null&&navigator.geolocation.clearWatch(E.gpsWatchId),k({gpsWatchId:null,isTrackingGPS:!1})},setThermoStartNow:()=>{const E=w().seekerLngLat;E&&k({thermoStart:E})},setThermoEndNow:()=>{const E=w().seekerLngLat;E&&k({thermoEnd:E})},applyRadarNow:(E,T)=>{const N=w().candidate,L=w().seekerLngLat;if(!N||!L)return;const c=x0(N,L,E,T);c&&k({candidate:c,undoStack:[...w().undoStack,N],redoStack:[],history:[...w().history,{id:Ma(),ts:Date.now(),type:"RADAR",radiusMiles:E,hit:T,seeker:L}]})},applyThermo:E=>{const T=w().candidate,N=w().thermoStart,L=w().thermoEnd;if(!T||!N||!L)return;const c=w0(T,N,L,E);c&&k({candidate:c,undoStack:[...w().undoStack,T],redoStack:[],history:[...w().history,{id:Ma(),ts:Date.now(),type:"THERMOMETER",hotter:E,start:N,end:L}]})},applyMatching:async(E,T)=>{const N=w().candidate,L=w().seekerLngLat;if(!N||!L){k({lastToast:"Requires seeker GPS and a selected area."});return}try{w().setBusy(!0,"Loading");const W=oc({type:"Feature",geometry:N,properties:{}}),ee=Kp([W[1],W[0],W[3],W[2]],220),Q=await Yp(E,ee,2e3);if(Q.length===0){k({lastToast:`Need POI data for ${E} (0 found). Try a smaller area or different kind.`});return}const F=[ee[1],ee[0],ee[3],ee[2]],{next:q,featureCount:se,seekerNearestKey:le,areaBefore:fe,areaAfter:Ie,percentRemaining:Be}=A0({candidate:N,seekerLngLat:L,pois:Q,answerYes:T==="YES",bbox:F});if(console.log("[MATCHING]",{kind:E,featureCount:se,seekerNearest:le,areaBefore:fe,areaAfter:Ie,percentRemaining:Be}),!le||se===0){k({lastToast:`Need POI data for ${E}.`});return}if(!q){k({candidate:null,lastToast:"No possible area remains.",undoStack:[...w().undoStack,N],redoStack:[],history:[...w().history,{id:Ma(),ts:Date.now(),type:"MATCHING",kind:E,answer:T,poiCount:Q.length,sampleCount:0,keptCount:0}]});return}k({candidate:q,lastToast:`Matching ${E} ${T}: ${Be.toFixed(1)}% remains (${Q.length} POIs)`,undoStack:[...w().undoStack,N],redoStack:[],history:[...w().history,{id:Ma(),ts:Date.now(),type:"MATCHING",kind:E,answer:T,poiCount:Q.length,sampleCount:0,keptCount:0}]})}catch(c){console.error("Matching error:",c),k({lastToast:c instanceof Error?c.message:"Matching operation failed"})}finally{w().setBusy(!1)}},applyMatchingAdmin:async(E,T)=>{const N=w().candidate,L=w().seekerLngLat;if(!N||!L){k({lastToast:"Requires seeker GPS and a selected area."});return}const c=Q=>Q.trim().toLowerCase().replace(/\s+/g," "),W=(Q,F)=>`${F.toFixed(2)},${Q.toFixed(2)}`,ee=new Map;try{w().setBusy(!0,"Loading");const F=(await Hg(L[1],L[0])).address??{},q=We=>E===1?We.state||We.region||We.province||"":E===2?We.county||We.state_district||We.district||"":E===3?We.city||We.town||We.municipality||We.village||"":We.borough||We.ward||We.suburb||We.city_district||We.quarter||We.neighbourhood||"",se=q(F),le=se?c(se):"";if(!le){k({lastToast:`Could not determine admin level ${E} for seeker.`});return}const{points:fe,stepKm:Ie}=N0(N,{maxPoints:28,minStepKm:80});if(fe.length===0){k({lastToast:"No candidate samples to evaluate."});return}const Be=[];for(const[We,tt]of fe){const at=W(We,tt);let ht=ee.get(at);if(ht===void 0){const Zt=(await Hg(tt,We)).address??{},Bt=q(Zt);ht=Bt?c(Bt):null,ee.set(at,ht)}const ft=ht?ht===le:!1;(T==="YES"?ft:!ft)&&Be.push({lat:tt,lon:We})}if(Be.length===0){k({candidate:null,lastToast:"No possible area remains.",undoStack:[...w().undoStack,N],redoStack:[],history:[...w().history,{id:Ma(),ts:Date.now(),type:"MATCHING",kind:`admin${E}`,answer:T,poiCount:0,sampleCount:fe.length,keptCount:0}]});return}const Ce=Math.max(10,Ie*.9),Ge=Jp(Be,Ce),it=Hf(N,Ge.geometry);if(!it){k({candidate:null,lastToast:"No possible area remains.",undoStack:[...w().undoStack,N],redoStack:[],history:[...w().history,{id:Ma(),ts:Date.now(),type:"MATCHING",kind:`admin${E}`,answer:T,poiCount:0,sampleCount:fe.length,keptCount:Be.length}]});return}k({candidate:it,lastToast:`Matching admin${E} ${T}: kept ${Be.length}/${fe.length}`,undoStack:[...w().undoStack,N],redoStack:[],history:[...w().history,{id:Ma(),ts:Date.now(),type:"MATCHING",kind:`admin${E}`,answer:T,poiCount:0,sampleCount:fe.length,keptCount:Be.length}]})}catch(Q){console.error("Matching admin error:",Q),k({lastToast:Q instanceof Error?Q.message:"Admin matching failed"})}finally{w().setBusy(!1)}},applyMeasuring:async(E,T)=>{const N=w().candidate,L=w().seekerLngLat;if(!N||!L){k({lastToast:"Requires seeker GPS and a selected area."});return}try{w().setBusy(!0,"Loading");const c={type:"Feature",geometry:N,properties:{}},W=oc(c),ee=Kp([W[1],W[0],W[3],W[2]],75),Q=await Yp(E,ee,800);if(Q.length===0){k({lastToast:`No ${E} POIs found nearby. Try a larger area.`});return}const F=Cy(L,Q);if(!F){k({lastToast:`No ${E} POIs found near seeker.`});return}const q=25,se=T==="CLOSER"?F.meters-q:F.meters+q,le=Math.max(0,se)/1e3,fe=Jp(Q,le),Ie=Xg(c,fe,T==="CLOSER");if(!Ie){k({candidate:null,lastToast:"No possible area remains.",undoStack:[...w().undoStack,N],redoStack:[],history:[...w().history,{id:Ma(),ts:Date.now(),type:"MEASURING",kind:E,answer:T,poiCount:Q.length,sampleCount:0,keptCount:0}]});return}k({candidate:Ie.geometry,lastToast:`Measuring ${E} ${T}: threshold ~${Math.round(se)}m (${le.toFixed(2)}km), ${Q.length} POIs`,undoStack:[...w().undoStack,N],redoStack:[],history:[...w().history,{id:Ma(),ts:Date.now(),type:"MEASURING",kind:E,answer:T,poiCount:Q.length,sampleCount:0,keptCount:0}]})}catch(c){console.error("Measuring error:",c),k({lastToast:c instanceof Error?c.message:"Measuring operation failed"})}finally{w().setBusy(!1)}},undo:()=>{const E=w().undoStack;if(E.length===0)return;const T=E[E.length-1],N=w().candidate;k({candidate:T,undoStack:E.slice(0,-1),redoStack:N?[...w().redoStack,N]:w().redoStack})},redo:()=>{const E=w().redoStack;if(E.length===0)return;const T=E[E.length-1],N=w().candidate;k({candidate:T,redoStack:E.slice(0,-1),undoStack:N?[...w().undoStack,N]:w().undoStack})},resetCandidateToCountry:()=>{w().stopGPSTracking(),k({candidate:null,undoStack:[],redoStack:[],thermoStart:null,thermoEnd:null})},setSearchQuery:E=>{k({searchQuery:E})},setLastToast:E=>{k({lastToast:E})},setBusy:(E,T="Loading")=>{k({isBusy:E,busyMessage:T})},runSearch:async()=>{const E=w().searchQuery.trim();if(!E){k({searchResults:[]});return}try{const T=await S0(E);k({searchResults:T})}catch(T){throw console.error("Search error:",T),k({searchResults:[]}),T}},selectSearchResult:E=>{const T=k0(E);k({candidate:T,undoStack:[],redoStack:[],thermoStart:null,thermoEnd:null,selectedAreaLabel:E.display_name,history:[...w().history,{id:Ma(),ts:Date.now(),type:"SET_AREA",label:E.display_name}]})},applyPoiWithin:async(E,T,N)=>{const L=w().candidate;if(!L){k({lastToast:"No area selected. Select an area first."});return}const c=T*1.60934;try{w().setBusy(!0,"Loading");const W={type:"Feature",geometry:L,properties:{}},ee=oc(W),Q=Kp([ee[1],ee[0],ee[3],ee[2]],c),F=await Yp(E,Q);if(F.length===0){k(N==="YES"?{candidate:null,lastToast:`No ${E}s found. YES makes area impossible.`,undoStack:[...w().undoStack,L],redoStack:[],history:[...w().history,{id:Ma(),ts:Date.now(),type:"POI_WITHIN",kind:E,radiusMiles:T,answer:N,poiCount:0}]}:{lastToast:`No ${E}s found. Area unchanged.`,history:[...w().history,{id:Ma(),ts:Date.now(),type:"POI_WITHIN",kind:E,radiusMiles:T,answer:N,poiCount:0}]});return}const q=Jp(F,c),se=Xg(W,q,N==="YES");k(se?{candidate:se.geometry,lastToast:`${E}: ${F.length} found in search area`,undoStack:[...w().undoStack,L],redoStack:[],history:[...w().history,{id:Ma(),ts:Date.now(),type:"POI_WITHIN",kind:E,radiusMiles:T,answer:N,poiCount:F.length}]}:{candidate:null,lastToast:"No possible area remains.",undoStack:[...w().undoStack,L],redoStack:[],history:[...w().history,{id:Ma(),ts:Date.now(),type:"POI_WITHIN",kind:E,radiusMiles:T,answer:N,poiCount:F.length}]})}catch(W){console.error("POI within error:",W),k({lastToast:W instanceof Error?W.message:"POI operation failed"})}finally{w().setBusy(!1)}}}));var Xd={exports:{}};var O0=Xd.exports,Wg;function F0(){return Wg||(Wg=1,(function(k,w){(function(S,E){k.exports=E()})(O0,(function(){var S={},E={};function T(L,c,W){if(E[L]=W,L==="index"){var ee="var sharedModule = {}; ("+E.shared+")(sharedModule); ("+E.worker+")(sharedModule);",Q={};return E.shared(Q),E.index(S,Q),typeof window<"u"&&S.setWorkerUrl(window.URL.createObjectURL(new Blob([ee],{type:"text/javascript"}))),S}}T("shared",["exports"],(function(L){function c(n,t,r,u){return new(r||(r=Promise))((function(m,v){function x(O){try{M(u.next(O))}catch(U){v(U)}}function C(O){try{M(u.throw(O))}catch(U){v(U)}}function M(O){var U;O.done?m(O.value):(U=O.value,U instanceof r?U:new r((function(G){G(U)}))).then(x,C)}M((u=u.apply(n,t||[])).next())}))}function W(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}typeof SuppressedError=="function"&&SuppressedError;var ee=Q;function Q(n,t){this.x=n,this.y=t}Q.prototype={clone:function(){return new Q(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,r=n.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),r=Math.sin(n),u=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=u,this},_rotateAround:function(n,t){var r=Math.cos(n),u=Math.sin(n),m=t.y+u*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-u*(this.y-t.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Q.convert=function(n){return n instanceof Q?n:Array.isArray(n)?new Q(n[0],n[1]):n};var F=W(ee),q=se;function se(n,t,r,u){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(u-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=r,this.p2y=u}se.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,u=0;u<8;u++){var m=this.sampleCurveX(r)-n;if(Math.abs(m)<t)return r;var v=this.sampleCurveDerivativeX(r);if(Math.abs(v)<1e-6)break;r-=m/v}var x=0,C=1;for(r=n,u=0;u<20&&(m=this.sampleCurveX(r),!(Math.abs(m-n)<t));u++)n>m?x=r:C=r,r=.5*(C-x)+x;return r},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var le=W(q);let fe,Ie;function Be(){return fe==null&&(fe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),fe}function Ce(){if(Ie==null&&(Ie=!1,Be())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let u=0;u<25;u++){const m=4*u;t.fillStyle=`rgb(${m},${m+1},${m+2})`,t.fillRect(u%5,Math.floor(u/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let u=0;u<100;u++)if(u%4!=3&&r[u]!==u){Ie=!0;break}}}return Ie||!1}function Ge(n,t,r,u){const m=new le(n,t,r,u);return v=>m.solve(v)}const it=Ge(.25,.1,.25,1);function We(n,t,r){return Math.min(r,Math.max(t,n))}function tt(n,t,r){const u=r-t,m=((n-t)%u+u)%u+t;return m===t?r:m}function at(n,...t){for(const r of t)for(const u in r)n[u]=r[u];return n}let ht=1;function ft(n,t,r){const u={};for(const m in n)u[m]=t.call(this,n[m],m,n);return u}function $t(n,t,r){const u={};for(const m in n)t.call(this,n[m],m,n)&&(u[m]=n[m]);return u}function wt(n){return Array.isArray(n)?n.map(wt):typeof n=="object"&&n?ft(n,wt):n}const Zt={};function Bt(n){Zt[n]||(typeof console<"u"&&console.warn(n),Zt[n]=!0)}function je(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function zt(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let an=null;function rn(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const bt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function jt(n,t,r,u,m){return c(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(n,{timestamp:0});try{const x=v?.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const C=x.startsWith("BGR"),M=new Uint8ClampedArray(u*m*4);if(yield v.copyTo(M,(function(O,U,G,X,J){const ie=4*Math.max(-U,0),ce=(Math.max(0,G)-G)*X*4+ie,ye=4*X,be=Math.max(0,U),Ue=Math.max(0,G);return{rect:{x:be,y:Ue,width:Math.min(O.width,U+X)-be,height:Math.min(O.height,G+J)-Ue},layout:[{offset:ce,stride:ye}]}})(n,t,r,u,m)),C)for(let O=0;O<M.length;O+=4){const U=M[O];M[O]=M[O+2],M[O+2]=U}return M}finally{v.close()}}))}let nt,Re;const rt="AbortError";function on(){return new Error(rt)}const Pt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function yn(n){return Pt.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const Dn="global-dispatcher";class Rn extends Error{constructor(t,r,u,m){super(`AJAXError: ${r} (${t}): ${u}`),this.status=t,this.statusText=r,this.url=u,this.body=m}}const Ne=()=>zt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ei=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const u=yn(n.url);if(u)return u(n,t);if(zt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:Dn},t)}if(!(/^file:/.test(r=n.url)||/^file:/.test(Ne())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(u,m){return c(this,void 0,void 0,(function*(){const v=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,cache:u.cache,referrer:Ne(),signal:m.signal});u.type!=="json"||v.headers.has("Accept")||v.headers.set("Accept","application/json");const x=yield fetch(v);if(!x.ok){const O=yield x.blob();throw new Rn(x.status,x.statusText,u.url,O)}let C;C=u.type==="arrayBuffer"||u.type==="image"?x.arrayBuffer():u.type==="json"?x.json():x.text();const M=yield C;if(m.signal.aborted)throw on();return{data:M,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}}))})(n,t);if(zt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:Dn},t)}var r;return(function(u,m){return new Promise(((v,x)=>{var C;const M=new XMLHttpRequest;M.open(u.method||"GET",u.url,!0),u.type!=="arrayBuffer"&&u.type!=="image"||(M.responseType="arraybuffer");for(const O in u.headers)M.setRequestHeader(O,u.headers[O]);u.type==="json"&&(M.responseType="text",!((C=u.headers)===null||C===void 0)&&C.Accept||M.setRequestHeader("Accept","application/json")),M.withCredentials=u.credentials==="include",M.onerror=()=>{x(new Error(M.statusText))},M.onload=()=>{if(!m.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let O=M.response;if(u.type==="json")try{O=JSON.parse(M.response)}catch(U){return void x(U)}v({data:O,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const O=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});x(new Rn(M.status,M.statusText,u.url,O))}},m.signal.addEventListener("abort",(()=>{M.abort(),x(on())})),M.send(u.body)}))})(n,t)};function Cn(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function Kt(n,t,r){r[n]&&r[n].indexOf(t)!==-1||(r[n]=r[n]||[],r[n].push(t))}function we(n,t,r){if(r&&r[n]){const u=r[n].indexOf(t);u!==-1&&r[n].splice(u,1)}}class $i{constructor(t,r={}){at(this,r),this.type=t}}class Vr extends $i{constructor(t,r={}){super("error",at({error:t},r))}}class Rr{on(t,r){return this._listeners=this._listeners||{},Kt(t,r,this._listeners),this}off(t,r){return we(t,r,this._listeners),we(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Kt(t,r,this._oneTimeListeners),this):new Promise((u=>this.once(t,u)))}fire(t,r){typeof t=="string"&&(t=new $i(t,r||{}));const u=t.type;if(this.listens(u)){t.target=this;const m=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const C of m)C.call(this,t);const v=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const C of v)we(u,C,this._oneTimeListeners),C.call(this,t);const x=this._eventedParent;x&&(at(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(t))}else t instanceof Vr&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var Ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ds=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Co(n,t){const r={};for(const u in n)u!=="ref"&&(r[u]=n[u]);return ds.forEach((u=>{u in t&&(r[u]=t[u])})),r}function lt(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!lt(n[r],t[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const r in n)if(!lt(n[r],t[r]))return!1;return!0}return n===t}function ai(n,t){n.push(t)}function ps(n,t,r){ai(r,{command:"addSource",args:[n,t[n]]})}function pr(n,t,r){ai(t,{command:"removeSource",args:[n]}),r[n]=!0}function As(n,t,r,u){pr(n,r,u),ps(n,t,r)}function vn(n,t,r){let u;for(u in n[r])if(Object.prototype.hasOwnProperty.call(n[r],u)&&u!=="data"&&!lt(n[r][u],t[r][u]))return!1;for(u in t[r])if(Object.prototype.hasOwnProperty.call(t[r],u)&&u!=="data"&&!lt(n[r][u],t[r][u]))return!1;return!0}function ir(n,t,r,u,m,v){n=n||{},t=t||{};for(const x in n)Object.prototype.hasOwnProperty.call(n,x)&&(lt(n[x],t[x])||r.push({command:v,args:[u,x,t[x],m]}));for(const x in t)Object.prototype.hasOwnProperty.call(t,x)&&!Object.prototype.hasOwnProperty.call(n,x)&&(lt(n[x],t[x])||r.push({command:v,args:[u,x,t[x],m]}))}function aa(n){return n.id}function oa(n,t){return n[t.id]=t,n}class Qe{constructor(t,r,u,m){this.message=(t?`${t}: `:"")+u,m&&(this.identifier=m),r!=null&&r.__line__&&(this.line=r.__line__)}}function Ur(n,...t){for(const r of t)for(const u in r)n[u]=r[u];return n}class dn extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class tn{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[u,m]of r)this.bindings[u]=m}concat(t){return new tn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Aa={kind:"null"},_t={kind:"number"},In={kind:"string"},pt={kind:"boolean"},mr={kind:"color"},qr={kind:"object"},pn={kind:"value"},Si={kind:"collator"},Sr={kind:"formatted"},Ai={kind:"padding"},gr={kind:"resolvedImage"},_e={kind:"variableAnchorOffsetCollection"};function K(n,t){return{kind:"array",itemType:n,N:t}}function Y(n){if(n.kind==="array"){const t=Y(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const oe=[Aa,_t,In,pt,mr,Sr,qr,K(pn),Ai,gr,_e];function ae(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ae(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const r of oe)if(!ae(r,t))return null}}return`Expected ${Y(n)} but found ${Y(t)} instead.`}function Ee(n,t){return t.some((r=>r.kind===n.kind))}function Me(n,t){return t.some((r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n))}function Fe(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const ke=.96422,Ke=.82521,ut=4/29,Ze=6/29,vt=3*Ze*Ze,Ut=Ze*Ze*Ze,Qt=Math.PI/180,Fn=180/Math.PI;function bn(n){return(n%=360)<0&&(n+=360),n}function kn([n,t,r,u]){let m,v;const x=pi((.2225045*(n=Sn(n))+.7168786*(t=Sn(t))+.0606169*(r=Sn(r)))/1);n===t&&t===r?m=v=x:(m=pi((.4360747*n+.3850649*t+.1430804*r)/ke),v=pi((.0139322*n+.0971045*t+.7141733*r)/Ke));const C=116*x-16;return[C<0?0:C,500*(m-x),200*(x-v),u]}function Sn(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function pi(n){return n>Ut?Math.pow(n,1/3):n/vt+ut}function ti([n,t,r,u]){let m=(n+16)/116,v=isNaN(t)?m:m+t/500,x=isNaN(r)?m:m-r/200;return m=1*Hn(m),v=ke*Hn(v),x=Ke*Hn(x),[xn(3.1338561*v-1.6168667*m-.4906146*x),xn(-.9787684*v+1.9161415*m+.033454*x),xn(.0719453*v-.2289914*m+1.4052427*x),u]}function xn(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Hn(n){return n>Ze?n*n*n:vt*(n-ut)}function ri(n){return parseInt(n.padEnd(2,n),16)/255}function Ei(n,t){return Bn(t?n/100:n,0,1)}function Bn(n,t,r){return Math.min(Math.max(t,n),r)}function Er(n){return!n.some(Number.isNaN)}const Po={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class fn{constructor(t,r,u,m=1,v=!0){this.r=t,this.g=r,this.b=u,this.a=m,v||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[t,r,u,m]))}static parse(t){if(t instanceof fn)return t;if(typeof t!="string")return;const r=(function(u){if((u=u.toLowerCase().trim())==="transparent")return[0,0,0,0];const m=Po[u];if(m){const[x,C,M]=m;return[x/255,C/255,M/255,1]}if(u.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(u)){const x=u.length<6?1:2;let C=1;return[ri(u.slice(C,C+=x)),ri(u.slice(C,C+=x)),ri(u.slice(C,C+=x)),ri(u.slice(C,C+x)||"ff")]}if(u.startsWith("rgb")){const x=u.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[C,M,O,U,G,X,J,ie,ce,ye,be,Ue]=x,Te=[U||" ",J||" ",ye].join("");if(Te==="  "||Te==="  /"||Te===",,"||Te===",,,"){const Ve=[O,X,ce].join(""),et=Ve==="%%%"?100:Ve===""?255:0;if(et){const dt=[Bn(+M/et,0,1),Bn(+G/et,0,1),Bn(+ie/et,0,1),be?Ei(+be,Ue):1];if(Er(dt))return dt}}return}}const v=u.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,C,M,O,U,G,X,J,ie]=v,ce=[M||" ",U||" ",X].join("");if(ce==="  "||ce==="  /"||ce===",,"||ce===",,,"){const ye=[+C,Bn(+O,0,100),Bn(+G,0,100),J?Ei(+J,ie):1];if(Er(ye))return(function([be,Ue,Te,Ve]){function et(dt){const Dt=(dt+be/30)%12,hn=Ue*Math.min(Te,1-Te);return Te-hn*Math.max(-1,Math.min(Dt-3,9-Dt,1))}return be=bn(be),Ue/=100,Te/=100,[et(0),et(8),et(4),Ve]})(ye)}}})(t);return r?new fn(...r,!1):void 0}get rgb(){const{r:t,g:r,b:u,a:m}=this,v=m||1/0;return this.overwriteGetter("rgb",[t/v,r/v,u/v,m])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[r,u,m,v]=kn(t),x=Math.sqrt(u*u+m*m);return[Math.round(1e4*x)?bn(Math.atan2(m,u)*Fn):NaN,x,r,v]})(this.rgb))}get lab(){return this.overwriteGetter("lab",kn(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,u,m]=this.rgb;return`rgba(${[t,r,u].map((v=>Math.round(255*v))).join(",")},${m})`}}fn.black=new fn(0,0,0,1),fn.white=new fn(1,1,1,1),fn.transparent=new fn(0,0,0,0),fn.red=new fn(1,0,0,1);class Ha{constructor(t,r,u){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Xa{constructor(t,r,u,m,v){this.text=t,this.image=r,this.scale=u,this.fontStack=m,this.textColor=v}}class yr{constructor(t){this.sections=t}static fromString(t){return new yr([new Xa(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof yr?t:yr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class rr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof rr)return t;if(typeof t=="number")return new rr([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new rr(t)}}toString(){return JSON.stringify(this.values)}}const hc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ii{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ii)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const u=t[r],m=t[r+1];if(typeof u!="string"||!hc.has(u)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new Ii(t)}}toString(){return JSON.stringify(this.values)}}class Bi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Bi({name:t,available:!1}):null}}function sr(n,t,r,u){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[n,t,r,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[n,t,r,u]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qr(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof fn||n instanceof Ha||n instanceof yr||n instanceof rr||n instanceof Ii||n instanceof Bi)return!0;if(Array.isArray(n)){for(const t of n)if(!Qr(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!Qr(n[t]))return!1;return!0}return!1}function Wn(n){if(n===null)return Aa;if(typeof n=="string")return In;if(typeof n=="boolean")return pt;if(typeof n=="number")return _t;if(n instanceof fn)return mr;if(n instanceof Ha)return Si;if(n instanceof yr)return Sr;if(n instanceof rr)return Ai;if(n instanceof Ii)return _e;if(n instanceof Bi)return gr;if(Array.isArray(n)){const t=n.length;let r;for(const u of n){const m=Wn(u);if(r){if(r===m)continue;r=pn;break}r=m}return K(r||pn,t)}return qr}function Xo(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof fn||n instanceof yr||n instanceof rr||n instanceof Ii||n instanceof Bi?n.toString():JSON.stringify(n)}class ms{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Qr(t[1]))return r.error("invalid value");const u=t[1];let m=Wn(u);const v=r.expectedType;return m.kind!=="array"||m.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(m=v),new ms(m,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ji{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const La={string:In,number:_t,boolean:pt,object:qr};class Ir{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let u,m=1;const v=t[0];if(v==="array"){let C,M;if(t.length>2){const O=t[1];if(typeof O!="string"||!(O in La)||O==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);C=La[O],m++}else C=pn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);M=t[2],m++}u=K(C,M)}else{if(!La[v])throw new Error(`Types doesn't contain name = ${v}`);u=La[v]}const x=[];for(;m<t.length;m++){const C=r.parse(t[m],m,pn);if(!C)return null;x.push(C)}return new Ir(u,x)}evaluate(t){for(let r=0;r<this.args.length;r++){const u=this.args[r].evaluate(t);if(!ae(this.type,Wn(u)))return u;if(r===this.args.length-1)throw new ji(`Expected value to be of type ${Y(this.type)}, but found ${Y(Wn(u))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Ls={"to-boolean":pt,"to-color":mr,"to-number":_t,"to-string":In};class Li{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const u=t[0];if(!Ls[u])throw new Error(`Can't parse ${u} as it is not part of the known types`);if((u==="to-boolean"||u==="to-string")&&t.length!==2)return r.error("Expected one argument.");const m=Ls[u],v=[];for(let x=1;x<t.length;x++){const C=r.parse(t[x],x,pn);if(!C)return null;v.push(C)}return new Li(m,v)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,u;for(const m of this.args){if(r=m.evaluate(t),u=null,r instanceof fn)return r;if(typeof r=="string"){const v=t.parseColor(r);if(v)return v}else if(Array.isArray(r)&&(u=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:sr(r[0],r[1],r[2],r[3]),!u))return new fn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new ji(u||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const u of this.args){r=u.evaluate(t);const m=rr.parse(r);if(m)return m}throw new ji(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const u of this.args){r=u.evaluate(t);const m=Ii.parse(r);if(m)return m}throw new ji(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const u of this.args){if(r=u.evaluate(t),r===null)return 0;const m=Number(r);if(!isNaN(m))return m}throw new ji(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return yr.fromString(Xo(this.args[0].evaluate(t)));case"resolvedImage":return Bi.fromString(Xo(this.args[0].evaluate(t)));default:return Xo(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Ra=["Unknown","Point","LineString","Polygon"];class Wo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ra[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=fn.parse(t)),r}}class Nr{constructor(t,r,u=[],m,v=new tn,x=[]){this.registry=t,this.path=u,this.key=u.map((C=>`[${C}]`)).join(""),this.scope=v,this.errors=x,this.expectedType=m,this._isConstant=r}parse(t,r,u,m,v={}){return r?this.concat(r,u,m)._parse(t,v):this._parse(t,v)}_parse(t,r){function u(m,v,x){return x==="assert"?new Ir(v,[m]):x==="coerce"?new Li(v,[m]):m}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=t[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[m];if(v){let x=v.parse(t,this);if(!x)return null;if(this.expectedType){const C=this.expectedType,M=x.type;if(C.kind!=="string"&&C.kind!=="number"&&C.kind!=="boolean"&&C.kind!=="object"&&C.kind!=="array"||M.kind!=="value")if(C.kind!=="color"&&C.kind!=="formatted"&&C.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string")if(C.kind!=="padding"||M.kind!=="value"&&M.kind!=="number"&&M.kind!=="array")if(C.kind!=="variableAnchorOffsetCollection"||M.kind!=="value"&&M.kind!=="array"){if(this.checkSubtype(C,M))return null}else x=u(x,C,r.typeAnnotation||"coerce");else x=u(x,C,r.typeAnnotation||"coerce");else x=u(x,C,r.typeAnnotation||"coerce");else x=u(x,C,r.typeAnnotation||"assert")}if(!(x instanceof ms)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const C=new Wo;try{x=new ms(x.type,x.evaluate(C))}catch(M){return this.error(M.message),null}}return x}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,u){const m=typeof t=="number"?this.path.concat(t):this.path,v=u?this.scope.concat(u):this.scope;return new Nr(this.registry,this._isConstant,m,r||null,v,this.errors)}error(t,...r){const u=`${this.key}${r.map((m=>`[${m}]`)).join("")}`;this.errors.push(new dn(u,t))}checkSubtype(t,r){const u=ae(t,r);return u&&this.error(u),u}}class la{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const u=[];for(let v=1;v<t.length-1;v+=2){const x=t[v];if(typeof x!="string")return r.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return r.error("Variable names must contain only alphanumeric characters or '_'.",v);const C=r.parse(t[v+1],v+1);if(!C)return null;u.push([x,C])}const m=r.parse(t[t.length-1],t.length-1,r.expectedType,u);return m?new la(u,m):null}outputDefined(){return this.result.outputDefined()}}class Un{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const u=t[1];return r.scope.has(u)?new Un(u,r.scope.get(u)):r.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Wa{constructor(t,r,u){this.type=t,this.index=r,this.input=u}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=r.parse(t[1],1,_t),m=r.parse(t[2],2,K(r.expectedType||pn));return u&&m?new Wa(m.type.itemType,u,m):null}evaluate(t){const r=this.index.evaluate(t),u=this.input.evaluate(t);if(r<0)throw new ji(`Array index out of bounds: ${r} < 0.`);if(r>=u.length)throw new ji(`Array index out of bounds: ${r} > ${u.length-1}.`);if(r!==Math.floor(r))throw new ji(`Array index must be an integer, but found ${r} instead.`);return u[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class au{constructor(t,r){this.type=pt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=r.parse(t[1],1,pn),m=r.parse(t[2],2,pn);return u&&m?Ee(u.type,[pt,In,_t,Aa,pn])?new au(u,m):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Y(u.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!Me(r,["boolean","string","number","null"]))throw new ji(`Expected first argument to be of type boolean, string, number or null, but found ${Y(Wn(r))} instead.`);if(!Me(u,["string","array"]))throw new ji(`Expected second argument to be of type array or string, but found ${Y(Wn(u))} instead.`);return u.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ua{constructor(t,r,u){this.type=_t,this.needle=t,this.haystack=r,this.fromIndex=u}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=r.parse(t[1],1,pn),m=r.parse(t[2],2,pn);if(!u||!m)return null;if(!Ee(u.type,[pt,In,_t,Aa,pn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Y(u.type)} instead`);if(t.length===4){const v=r.parse(t[3],3,_t);return v?new ua(u,m,v):null}return new ua(u,m)}evaluate(t){const r=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Me(r,["boolean","string","number","null"]))throw new ji(`Expected first argument to be of type boolean, string, number or null, but found ${Y(Wn(r))} instead.`);let m;if(this.fromIndex&&(m=this.fromIndex.evaluate(t)),Me(u,["string"])){const v=u.indexOf(r,m);return v===-1?-1:[...u.slice(0,v)].length}if(Me(u,["array"]))return u.indexOf(r,m);throw new ji(`Expected second argument to be of type array or string, but found ${Y(Wn(u))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class qn{constructor(t,r,u,m,v,x){this.inputType=t,this.type=r,this.input=u,this.cases=m,this.outputs=v,this.otherwise=x}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let u,m;r.expectedType&&r.expectedType.kind!=="value"&&(m=r.expectedType);const v={},x=[];for(let O=2;O<t.length-1;O+=2){let U=t[O];const G=t[O+1];Array.isArray(U)||(U=[U]);const X=r.concat(O);if(U.length===0)return X.error("Expected at least one branch label.");for(const ie of U){if(typeof ie!="number"&&typeof ie!="string")return X.error("Branch labels must be numbers or strings.");if(typeof ie=="number"&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return X.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ie=="number"&&Math.floor(ie)!==ie)return X.error("Numeric branch labels must be integer values.");if(u){if(X.checkSubtype(u,Wn(ie)))return null}else u=Wn(ie);if(v[String(ie)]!==void 0)return X.error("Branch labels must be unique.");v[String(ie)]=x.length}const J=r.parse(G,O,m);if(!J)return null;m=m||J.type,x.push(J)}const C=r.parse(t[1],1,pn);if(!C)return null;const M=r.parse(t[t.length-1],t.length-1,m);return M?C.type.kind!=="value"&&r.concat(1).checkSubtype(u,C.type)?null:new qn(u,m,C,v,x,M):null}evaluate(t){const r=this.input.evaluate(t);return(Wn(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class Mo{constructor(t,r,u){this.type=t,this.branches=r,this.otherwise=u}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const m=[];for(let x=1;x<t.length-1;x+=2){const C=r.parse(t[x],x,pt);if(!C)return null;const M=r.parse(t[x+1],x+1,u);if(!M)return null;m.push([C,M]),u=u||M.type}const v=r.parse(t[t.length-1],t.length-1,u);if(!v)return null;if(!u)throw new Error("Can't infer output type");return new Mo(u,m,v)}evaluate(t){for(const[r,u]of this.branches)if(r.evaluate(t))return u.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,u]of this.branches)t(r),t(u);t(this.otherwise)}outputDefined(){return this.branches.every((([t,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}}class Ao{constructor(t,r,u,m){this.type=t,this.input=r,this.beginIndex=u,this.endIndex=m}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=r.parse(t[1],1,pn),m=r.parse(t[2],2,_t);if(!u||!m)return null;if(!Ee(u.type,[K(pn),In,pn]))return r.error(`Expected first argument to be of type array or string, but found ${Y(u.type)} instead`);if(t.length===4){const v=r.parse(t[3],3,_t);return v?new Ao(u.type,u,m,v):null}return new Ao(u.type,u,m)}evaluate(t){const r=this.input.evaluate(t),u=this.beginIndex.evaluate(t);let m;if(this.endIndex&&(m=this.endIndex.evaluate(t)),Me(r,["string"]))return[...r].slice(u,m).join("");if(Me(r,["array"]))return r.slice(u,m);throw new ji(`Expected first argument to be of type array or string, but found ${Y(Wn(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ya(n,t){const r=n.length-1;let u,m,v=0,x=r,C=0;for(;v<=x;)if(C=Math.floor((v+x)/2),u=n[C],m=n[C+1],u<=t){if(C===r||t<m)return C;v=C+1}else{if(!(u>t))throw new ji("Input is not a number.");x=C-1}return 0}class Ka{constructor(t,r,u){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[m,v]of u)this.labels.push(m),this.outputs.push(v)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const u=r.parse(t[1],1,_t);if(!u)return null;const m=[];let v=null;r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType);for(let x=1;x<t.length;x+=2){const C=x===1?-1/0:t[x],M=t[x+1],O=x,U=x+1;if(typeof C!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(m.length&&m[m.length-1][0]>=C)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const G=r.parse(M,U,v);if(!G)return null;v=v||G.type,m.push([C,G])}return new Ka(v,u,m)}evaluate(t){const r=this.labels,u=this.outputs;if(r.length===1)return u[0].evaluate(t);const m=this.input.evaluate(t);if(m<=r[0])return u[0].evaluate(t);const v=r.length;return m>=r[v-1]?u[v-1].evaluate(t):u[Ya(r,m)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Yo(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var mi=Rs;function Rs(n,t,r,u){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(u-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=r,this.p2y=u}Rs.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,u=0;u<8;u++){var m=this.sampleCurveX(r)-n;if(Math.abs(m)<t)return r;var v=this.sampleCurveDerivativeX(r);if(Math.abs(v)<1e-6)break;r-=m/v}var x=0,C=1;for(r=n,u=0;u<20&&(m=this.sampleCurveX(r),!(Math.abs(m-n)<t));u++)n>m?x=r:C=r,r=.5*(C-x)+x;return r},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var yl=Yo(mi);function _r(n,t,r){return n+r*(t-n)}function Ti(n,t,r){return n.map(((u,m)=>_r(u,t[m],r)))}const Yn={number:_r,color:function(n,t,r,u="rgb"){switch(u){case"rgb":{const[m,v,x,C]=Ti(n.rgb,t.rgb,r);return new fn(m,v,x,C,!1)}case"hcl":{const[m,v,x,C]=n.hcl,[M,O,U,G]=t.hcl;let X,J;if(isNaN(m)||isNaN(M))isNaN(m)?isNaN(M)?X=NaN:(X=M,x!==1&&x!==0||(J=O)):(X=m,U!==1&&U!==0||(J=v));else{let Ue=M-m;M>m&&Ue>180?Ue-=360:M<m&&m-M>180&&(Ue+=360),X=m+r*Ue}const[ie,ce,ye,be]=(function([Ue,Te,Ve,et]){return Ue=isNaN(Ue)?0:Ue*Qt,ti([Ve,Math.cos(Ue)*Te,Math.sin(Ue)*Te,et])})([X,J??_r(v,O,r),_r(x,U,r),_r(C,G,r)]);return new fn(ie,ce,ye,be,!1)}case"lab":{const[m,v,x,C]=ti(Ti(n.lab,t.lab,r));return new fn(m,v,x,C,!1)}}},array:Ti,padding:function(n,t,r){return new rr(Ti(n.values,t.values,r))},variableAnchorOffsetCollection:function(n,t,r){const u=n.values,m=t.values;if(u.length!==m.length)throw new ji(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${t.toString()}`);const v=[];for(let x=0;x<u.length;x+=2){if(u[x]!==m[x])throw new ji(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${u[x]}, to[${x}]: ${m[x]}`);v.push(u[x]);const[C,M]=u[x+1],[O,U]=m[x+1];v.push([_r(C,O,r),_r(M,U,r)])}return new Ii(v)}};class Vi{constructor(t,r,u,m,v){this.type=t,this.operator=r,this.interpolation=u,this.input=m,this.labels=[],this.outputs=[];for(const[x,C]of v)this.labels.push(x),this.outputs.push(C)}static interpolationFactor(t,r,u,m){let v=0;if(t.name==="exponential")v=Na(r,t.base,u,m);else if(t.name==="linear")v=Na(r,1,u,m);else if(t.name==="cubic-bezier"){const x=t.controlPoints;v=new yl(x[0],x[1],x[2],x[3]).solve(Na(r,1,u,m))}return v}static parse(t,r){let[u,m,v,...x]=t;if(!Array.isArray(m)||m.length===0)return r.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const O=m[1];if(typeof O!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:O}}else{if(m[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const O=m.slice(1);if(O.length!==4||O.some((U=>typeof U!="number"||U<0||U>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:O}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(v=r.parse(v,2,_t),!v)return null;const C=[];let M=null;u==="interpolate-hcl"||u==="interpolate-lab"?M=mr:r.expectedType&&r.expectedType.kind!=="value"&&(M=r.expectedType);for(let O=0;O<x.length;O+=2){const U=x[O],G=x[O+1],X=O+3,J=O+4;if(typeof U!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',X);if(C.length&&C[C.length-1][0]>=U)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',X);const ie=r.parse(G,J,M);if(!ie)return null;M=M||ie.type,C.push([U,ie])}return Fe(M,_t)||Fe(M,mr)||Fe(M,Ai)||Fe(M,_e)||Fe(M,K(_t))?new Vi(M,u,m,v,C):r.error(`Type ${Y(M)} is not interpolatable.`)}evaluate(t){const r=this.labels,u=this.outputs;if(r.length===1)return u[0].evaluate(t);const m=this.input.evaluate(t);if(m<=r[0])return u[0].evaluate(t);const v=r.length;if(m>=r[v-1])return u[v-1].evaluate(t);const x=Ya(r,m),C=Vi.interpolationFactor(this.interpolation,m,r[x],r[x+1]),M=u[x].evaluate(t),O=u[x+1].evaluate(t);switch(this.operator){case"interpolate":return Yn[this.type.kind](M,O,C);case"interpolate-hcl":return Yn.color(M,O,C,"hcl");case"interpolate-lab":return Yn.color(M,O,C,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Na(n,t,r,u){const m=u-r,v=n-r;return m===0?0:t===1?v/m:(Math.pow(t,v)-1)/(Math.pow(t,m)-1)}class gs{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let u=null;const m=r.expectedType;m&&m.kind!=="value"&&(u=m);const v=[];for(const C of t.slice(1)){const M=r.parse(C,1+v.length,u,void 0,{typeAnnotation:"omit"});if(!M)return null;u=u||M.type,v.push(M)}if(!u)throw new Error("No output type");const x=m&&v.some((C=>ae(m,C.type)));return new gs(x?pn:u,v)}evaluate(t){let r,u=null,m=0;for(const v of this.args)if(m++,u=v.evaluate(t),u&&u instanceof Bi&&!u.available&&(r||(r=u.name),u=null,m===this.args.length&&(u=r)),u!==null)break;return u}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Ko(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Lo(n,t,r,u){return u.compare(t,r)===0}function Ns(n,t,r){const u=n!=="=="&&n!=="!=";return class Py{constructor(v,x,C){this.type=pt,this.lhs=v,this.rhs=x,this.collator=C,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const C=v[0];let M=x.parse(v[1],1,pn);if(!M)return null;if(!Ko(C,M.type))return x.concat(1).error(`"${C}" comparisons are not supported for type '${Y(M.type)}'.`);let O=x.parse(v[2],2,pn);if(!O)return null;if(!Ko(C,O.type))return x.concat(2).error(`"${C}" comparisons are not supported for type '${Y(O.type)}'.`);if(M.type.kind!==O.type.kind&&M.type.kind!=="value"&&O.type.kind!=="value")return x.error(`Cannot compare types '${Y(M.type)}' and '${Y(O.type)}'.`);u&&(M.type.kind==="value"&&O.type.kind!=="value"?M=new Ir(O.type,[M]):M.type.kind!=="value"&&O.type.kind==="value"&&(O=new Ir(M.type,[O])));let U=null;if(v.length===4){if(M.type.kind!=="string"&&O.type.kind!=="string"&&M.type.kind!=="value"&&O.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(U=x.parse(v[3],3,Si),!U)return null}return new Py(M,O,U)}evaluate(v){const x=this.lhs.evaluate(v),C=this.rhs.evaluate(v);if(u&&this.hasUntypedArgument){const M=Wn(x),O=Wn(C);if(M.kind!==O.kind||M.kind!=="string"&&M.kind!=="number")throw new ji(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${M.kind}, ${O.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const M=Wn(x),O=Wn(C);if(M.kind!=="string"||O.kind!=="string")return t(v,x,C)}return this.collator?r(v,x,C,this.collator.evaluate(v)):t(v,x,C)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const Lu=Ns("==",(function(n,t,r){return t===r}),Lo),Xn=Ns("!=",(function(n,t,r){return t!==r}),(function(n,t,r,u){return!Lo(0,t,r,u)})),zr=Ns("<",(function(n,t,r){return t<r}),(function(n,t,r,u){return u.compare(t,r)<0})),_l=Ns(">",(function(n,t,r){return t>r}),(function(n,t,r,u){return u.compare(t,r)>0})),Ru=Ns("<=",(function(n,t,r){return t<=r}),(function(n,t,r,u){return u.compare(t,r)<=0})),zs=Ns(">=",(function(n,t,r){return t>=r}),(function(n,t,r,u){return u.compare(t,r)>=0}));class Ds{constructor(t,r,u){this.type=Si,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const u=t[1];if(typeof u!="object"||Array.isArray(u))return r.error("Collator options argument must be an object.");const m=r.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,pt);if(!m)return null;const v=r.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,pt);if(!v)return null;let x=null;return u.locale&&(x=r.parse(u.locale,1,In),!x)?null:new Ds(m,v,x)}evaluate(t){return new Ha(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Ri{constructor(t,r,u,m,v){this.type=In,this.number=t,this.locale=r,this.currency=u,this.minFractionDigits=m,this.maxFractionDigits=v}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const u=r.parse(t[1],1,_t);if(!u)return null;const m=t[2];if(typeof m!="object"||Array.isArray(m))return r.error("NumberFormat options argument must be an object.");let v=null;if(m.locale&&(v=r.parse(m.locale,1,In),!v))return null;let x=null;if(m.currency&&(x=r.parse(m.currency,1,In),!x))return null;let C=null;if(m["min-fraction-digits"]&&(C=r.parse(m["min-fraction-digits"],1,_t),!C))return null;let M=null;return m["max-fraction-digits"]&&(M=r.parse(m["max-fraction-digits"],1,_t),!M)?null:new Ri(u,v,x,C,M)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class za{constructor(t){this.type=Sr,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const u=t[1];if(!Array.isArray(u)&&typeof u=="object")return r.error("First argument must be an image or text section.");const m=[];let v=!1;for(let x=1;x<=t.length-1;++x){const C=t[x];if(v&&typeof C=="object"&&!Array.isArray(C)){v=!1;let M=null;if(C["font-scale"]&&(M=r.parse(C["font-scale"],1,_t),!M))return null;let O=null;if(C["text-font"]&&(O=r.parse(C["text-font"],1,K(In)),!O))return null;let U=null;if(C["text-color"]&&(U=r.parse(C["text-color"],1,mr),!U))return null;const G=m[m.length-1];G.scale=M,G.font=O,G.textColor=U}else{const M=r.parse(t[x],1,pn);if(!M)return null;const O=M.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,m.push({content:M,scale:null,font:null,textColor:null})}}return new za(m)}evaluate(t){return new yr(this.sections.map((r=>{const u=r.content.evaluate(t);return Wn(u)===gr?new Xa("",u,null,null,null):new Xa(Xo(u),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)})))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class Jo{constructor(t){this.type=gr,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const u=r.parse(t[1],1,In);return u?new Jo(u):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),u=Bi.fromString(r);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(r)>-1),u}eachChild(t){t(this.input)}outputDefined(){return!1}}class vl{constructor(t){this.type=_t,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const u=r.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Y(u.type)} instead.`):new vl(u):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new ji(`Expected value to be of type string or array, but found ${Y(Wn(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Gr=8192;function xl(n,t){const r=(180+n[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,m=Math.pow(2,t.z);return[Math.round(r*m*Gr),Math.round(u*m*Gr)]}function Ro(n,t){const r=Math.pow(2,t.z);return[(m=(n[0]/Gr+t.x)/r,360*m-180),(u=(n[1]/Gr+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90)];var u,m}function vr(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function Ji(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Gn(n,t,r){const u=n[0]-t[0],m=n[1]-t[1],v=n[0]-r[0],x=n[1]-r[1];return u*x-v*m==0&&u*v<=0&&m*x<=0}function Qi(n,t,r,u){return(m=[u[0]-r[0],u[1]-r[1]])[0]*(v=[t[0]-n[0],t[1]-n[1]])[1]-m[1]*v[0]!=0&&!(!Qa(n,t,r,u)||!Qa(r,u,n,t));var m,v}function Ja(n,t,r){for(const u of r)for(let m=0;m<u.length-1;++m)if(Qi(n,t,u[m],u[m+1]))return!0;return!1}function ca(n,t,r=!1){let u=!1;for(const C of t)for(let M=0;M<C.length-1;M++){if(Gn(n,C[M],C[M+1]))return r;(v=C[M])[1]>(m=n)[1]!=(x=C[M+1])[1]>m[1]&&m[0]<(x[0]-v[0])*(m[1]-v[1])/(x[1]-v[1])+v[0]&&(u=!u)}var m,v,x;return u}function ha(n,t){for(const r of t)if(ca(n,r))return!0;return!1}function wl(n,t){for(const r of n)if(!ca(r,t))return!1;for(let r=0;r<n.length-1;++r)if(Ja(n[r],n[r+1],t))return!1;return!0}function er(n,t){for(const r of t)if(wl(n,r))return!0;return!1}function Qa(n,t,r,u){const m=u[0]-r[0],v=u[1]-r[1],x=(n[0]-r[0])*v-m*(n[1]-r[1]),C=(t[0]-r[0])*v-m*(t[1]-r[1]);return x>0&&C<0||x<0&&C>0}function Dr(n,t,r){const u=[];for(let m=0;m<n.length;m++){const v=[];for(let x=0;x<n[m].length;x++){const C=xl(n[m][x],r);vr(t,C),v.push(C)}u.push(v)}return u}function eo(n,t,r){const u=[];for(let m=0;m<n.length;m++){const v=Dr(n[m],t,r);u.push(v)}return u}function Nu(n,t,r,u){if(n[0]<r[0]||n[0]>r[2]){const m=.5*u;let v=n[0]-r[0]>m?-u:r[0]-n[0]>m?u:0;v===0&&(v=n[0]-r[2]>m?-u:r[2]-n[0]>m?u:0),n[0]+=v}vr(t,n)}function bl(n,t,r,u){const m=Math.pow(2,u.z)*Gr,v=[u.x*Gr,u.y*Gr],x=[];for(const C of n)for(const M of C){const O=[M.x+v[0],M.y+v[1]];Nu(O,t,r,m),x.push(O)}return x}function kl(n,t,r,u){const m=Math.pow(2,u.z)*Gr,v=[u.x*Gr,u.y*Gr],x=[];for(const M of n){const O=[];for(const U of M){const G=[U.x+v[0],U.y+v[1]];vr(t,G),O.push(G)}x.push(O)}if(t[2]-t[0]<=m/2){(C=t)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const M of x)for(const O of M)Nu(O,t,r,m)}var C;return x}class ys{constructor(t,r){this.type=pt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Qr(t[1])){const u=t[1];if(u.type==="FeatureCollection"){const m=[];for(const v of u.features){const{type:x,coordinates:C}=v.geometry;x==="Polygon"&&m.push(C),x==="MultiPolygon"&&m.push(...C)}if(m.length)return new ys(u,{type:"MultiPolygon",coordinates:m})}else if(u.type==="Feature"){const m=u.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new ys(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new ys(u,u)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,u){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=r.canonicalID();if(u.type==="Polygon"){const C=Dr(u.coordinates,v,x),M=bl(r.geometry(),m,v,x);if(!Ji(m,v))return!1;for(const O of M)if(!ca(O,C))return!1}if(u.type==="MultiPolygon"){const C=eo(u.coordinates,v,x),M=bl(r.geometry(),m,v,x);if(!Ji(m,v))return!1;for(const O of M)if(!ha(O,C))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,u){const m=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=r.canonicalID();if(u.type==="Polygon"){const C=Dr(u.coordinates,v,x),M=kl(r.geometry(),m,v,x);if(!Ji(m,v))return!1;for(const O of M)if(!wl(O,C))return!1}if(u.type==="MultiPolygon"){const C=eo(u.coordinates,v,x),M=kl(r.geometry(),m,v,x);if(!Ji(m,v))return!1;for(const O of M)if(!er(O,C))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Qo=class{constructor(n=[],t=((r,u)=>r<u?-1:r>u?1:0)){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:r}=this,u=t[n];for(;n>0;){const m=n-1>>1,v=t[m];if(r(u,v)>=0)break;t[n]=v,n=m}t[n]=u}_down(n){const{data:t,compare:r}=this,u=this.length>>1,m=t[n];for(;n<u;){let v=1+(n<<1);const x=v+1;if(x<this.length&&r(t[x],t[v])<0&&(v=x),r(t[v],m)>=0)break;t[n]=t[v],n=v}t[n]=m}};function zu(n,t,r,u,m){Du(n,t,r,u||n.length-1,m||$r)}function Du(n,t,r,u,m){for(;u>r;){if(u-r>600){var v=u-r+1,x=t-r+1,C=Math.log(v),M=.5*Math.exp(2*C/3),O=.5*Math.sqrt(C*M*(v-M)/v)*(x-v/2<0?-1:1);Du(n,t,Math.max(r,Math.floor(t-x*M/v+O)),Math.min(u,Math.floor(t+(v-x)*M/v+O)),m)}var U=n[t],G=r,X=u;for(_s(n,r,t),m(n[u],U)>0&&_s(n,r,u);G<X;){for(_s(n,G,X),G++,X--;m(n[G],U)<0;)G++;for(;m(n[X],U)>0;)X--}m(n[r],U)===0?_s(n,r,X):_s(n,++X,u),X<=t&&(r=X+1),t<=X&&(u=X-1)}}function _s(n,t,r){var u=n[t];n[t]=n[r],n[r]=u}function $r(n,t){return n<t?-1:n>t?1:0}function No(n,t){if(n.length<=1)return[n];const r=[];let u,m;for(const v of n){const x=fc(v);x!==0&&(v.area=Math.abs(x),m===void 0&&(m=x<0),m===x<0?(u&&r.push(u),u=[v]):u.push(v))}if(u&&r.push(u),t>1)for(let v=0;v<r.length;v++)r[v].length<=t||(zu(r[v],t,1,r[v].length-1,Ou),r[v]=r[v].slice(0,t));return r}function Ou(n,t){return t.area-n.area}function fc(n){let t=0;for(let r,u,m=0,v=n.length,x=v-1;m<v;x=m++)r=n[m],u=n[x],t+=(u.x-r.x)*(r.y+u.y);return t}const Sl=1/298.257223563,ou=Sl*(2-Sl),El=Math.PI/180;class el{constructor(t){const r=6378.137*El*1e3,u=Math.cos(t*El),m=1/(1-ou*(1-u*u)),v=Math.sqrt(m);this.kx=r*v*u,this.ky=r*v*m*(1-ou)}distance(t,r){const u=this.wrap(t[0]-r[0])*this.kx,m=(t[1]-r[1])*this.ky;return Math.sqrt(u*u+m*m)}pointOnLine(t,r){let u,m,v,x,C=1/0;for(let M=0;M<t.length-1;M++){let O=t[M][0],U=t[M][1],G=this.wrap(t[M+1][0]-O)*this.kx,X=(t[M+1][1]-U)*this.ky,J=0;G===0&&X===0||(J=(this.wrap(r[0]-O)*this.kx*G+(r[1]-U)*this.ky*X)/(G*G+X*X),J>1?(O=t[M+1][0],U=t[M+1][1]):J>0&&(O+=G/this.kx*J,U+=X/this.ky*J)),G=this.wrap(r[0]-O)*this.kx,X=(r[1]-U)*this.ky;const ie=G*G+X*X;ie<C&&(C=ie,u=O,m=U,v=M,x=J)}return{point:[u,m],index:v,t:Math.max(0,Math.min(1,x))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function es(n,t){return t[0]-n[0]}function tl(n){return n[1]-n[0]+1}function Ui(n,t){return n[1]>=n[0]&&n[1]<t}function to(n,t){if(n[0]>n[1])return[null,null];const r=tl(n);if(t){if(r===2)return[n,null];const m=Math.floor(r/2);return[[n[0],n[0]+m],[n[0]+m,n[1]]]}if(r===1)return[n,null];const u=Math.floor(r/2)-1;return[[n[0],n[0]+u],[n[0]+u+1,n[1]]]}function nl(n,t){if(!Ui(t,n.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let u=t[0];u<=t[1];++u)vr(r,n[u]);return r}function Il(n){const t=[1/0,1/0,-1/0,-1/0];for(const r of n)for(const u of r)vr(t,u);return t}function il(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Tl(n,t,r){if(!il(n)||!il(t))return NaN;let u=0,m=0;return n[2]<t[0]&&(u=t[0]-n[2]),n[0]>t[2]&&(u=n[0]-t[2]),n[1]>t[3]&&(m=n[1]-t[3]),n[3]<t[1]&&(m=t[1]-n[3]),r.distance([0,0],[u,m])}function Os(n,t,r){const u=r.pointOnLine(t,n);return r.distance(n,u.point)}function lu(n,t,r,u,m){const v=Math.min(Os(n,[r,u],m),Os(t,[r,u],m)),x=Math.min(Os(r,[n,t],m),Os(u,[n,t],m));return Math.min(v,x)}function dc(n,t,r,u,m){if(!Ui(t,n.length)||!Ui(u,r.length))return 1/0;let v=1/0;for(let x=t[0];x<t[1];++x){const C=n[x],M=n[x+1];for(let O=u[0];O<u[1];++O){const U=r[O],G=r[O+1];if(Qi(C,M,U,G))return 0;v=Math.min(v,lu(C,M,U,G,m))}}return v}function Ni(n,t,r,u,m){if(!Ui(t,n.length)||!Ui(u,r.length))return NaN;let v=1/0;for(let x=t[0];x<=t[1];++x)for(let C=u[0];C<=u[1];++C)if(v=Math.min(v,m.distance(n[x],r[C])),v===0)return v;return v}function pc(n,t,r){if(ca(n,t,!0))return 0;let u=1/0;for(const m of t){const v=m[0],x=m[m.length-1];if(v!==x&&(u=Math.min(u,Os(n,[x,v],r)),u===0))return u;const C=r.pointOnLine(m,n);if(u=Math.min(u,r.distance(n,C.point)),u===0)return u}return u}function Mn(n,t,r,u){if(!Ui(t,n.length))return NaN;for(let v=t[0];v<=t[1];++v)if(ca(n[v],r,!0))return 0;let m=1/0;for(let v=t[0];v<t[1];++v){const x=n[v],C=n[v+1];for(const M of r)for(let O=0,U=M.length,G=U-1;O<U;G=O++){const X=M[G],J=M[O];if(Qi(x,C,X,J))return 0;m=Math.min(m,lu(x,C,X,J,u))}}return m}function Cl(n,t){for(const r of n)for(const u of r)if(ca(u,t,!0))return!0;return!1}function oi(n,t,r,u=1/0){const m=Il(n),v=Il(t);if(u!==1/0&&Tl(m,v,r)>=u)return u;if(Ji(m,v)){if(Cl(n,t))return 0}else if(Cl(t,n))return 0;let x=1/0;for(const C of n)for(let M=0,O=C.length,U=O-1;M<O;U=M++){const G=C[U],X=C[M];for(const J of t)for(let ie=0,ce=J.length,ye=ce-1;ie<ce;ye=ie++){const be=J[ye],Ue=J[ie];if(Qi(G,X,be,Ue))return 0;x=Math.min(x,lu(G,X,be,Ue,r))}}return x}function Qn(n,t,r,u,m,v){if(!v)return;const x=Tl(nl(u,v),m,r);x<t&&n.push([x,v,[0,0]])}function ts(n,t,r,u,m,v,x){if(!v||!x)return;const C=Tl(nl(u,v),nl(m,x),r);C<t&&n.push([C,v,x])}function rl(n,t,r,u,m=1/0){let v=Math.min(u.distance(n[0],r[0][0]),m);if(v===0)return v;const x=new Qo([[0,[0,n.length-1],[0,0]]],es),C=Il(r);for(;x.length>0;){const M=x.pop();if(M[0]>=v)continue;const O=M[1],U=t?50:100;if(tl(O)<=U){if(!Ui(O,n.length))return NaN;if(t){const G=Mn(n,O,r,u);if(isNaN(G)||G===0)return G;v=Math.min(v,G)}else for(let G=O[0];G<=O[1];++G){const X=pc(n[G],r,u);if(v=Math.min(v,X),v===0)return 0}}else{const G=to(O,t);Qn(x,v,u,n,C,G[0]),Qn(x,v,u,n,C,G[1])}}return v}function no(n,t,r,u,m,v=1/0){let x=Math.min(v,m.distance(n[0],r[0]));if(x===0)return x;const C=new Qo([[0,[0,n.length-1],[0,r.length-1]]],es);for(;C.length>0;){const M=C.pop();if(M[0]>=x)continue;const O=M[1],U=M[2],G=t?50:100,X=u?50:100;if(tl(O)<=G&&tl(U)<=X){if(!Ui(O,n.length)&&Ui(U,r.length))return NaN;let J;if(t&&u)J=dc(n,O,r,U,m),x=Math.min(x,J);else if(t&&!u){const ie=n.slice(O[0],O[1]+1);for(let ce=U[0];ce<=U[1];++ce)if(J=Os(r[ce],ie,m),x=Math.min(x,J),x===0)return x}else if(!t&&u){const ie=r.slice(U[0],U[1]+1);for(let ce=O[0];ce<=O[1];++ce)if(J=Os(n[ce],ie,m),x=Math.min(x,J),x===0)return x}else J=Ni(n,O,r,U,m),x=Math.min(x,J)}else{const J=to(O,t),ie=to(U,u);ts(C,x,m,n,r,J[0],ie[0]),ts(C,x,m,n,r,J[0],ie[1]),ts(C,x,m,n,r,J[1],ie[0]),ts(C,x,m,n,r,J[1],ie[1])}}return x}function Pl(n){return n.type==="MultiPolygon"?n.coordinates.map((t=>({type:"Polygon",coordinates:t}))):n.type==="MultiLineString"?n.coordinates.map((t=>({type:"LineString",coordinates:t}))):n.type==="MultiPoint"?n.coordinates.map((t=>({type:"Point",coordinates:t}))):[n]}class Da{constructor(t,r){this.type=_t,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Qr(t[1])){const u=t[1];if(u.type==="FeatureCollection")return new Da(u,u.features.map((m=>Pl(m.geometry))).flat());if(u.type==="Feature")return new Da(u,Pl(u.geometry));if("type"in u&&"coordinates"in u)return new Da(u,Pl(u))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,u){const m=r.geometry(),v=m.flat().map((M=>Ro([M.x,M.y],r.canonical)));if(m.length===0)return NaN;const x=new el(v[0][1]);let C=1/0;for(const M of u){switch(M.type){case"Point":C=Math.min(C,no(v,!1,[M.coordinates],!1,x,C));break;case"LineString":C=Math.min(C,no(v,!1,M.coordinates,!0,x,C));break;case"Polygon":C=Math.min(C,rl(v,!1,M.coordinates,x,C))}if(C===0)return C}return C})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,u){const m=r.geometry(),v=m.flat().map((M=>Ro([M.x,M.y],r.canonical)));if(m.length===0)return NaN;const x=new el(v[0][1]);let C=1/0;for(const M of u){switch(M.type){case"Point":C=Math.min(C,no(v,!0,[M.coordinates],!1,x,C));break;case"LineString":C=Math.min(C,no(v,!0,M.coordinates,!0,x,C));break;case"Polygon":C=Math.min(C,rl(v,!0,M.coordinates,x,C))}if(C===0)return C}return C})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(r,u){const m=r.geometry();if(m.length===0||m[0].length===0)return NaN;const v=No(m,0).map((M=>M.map((O=>O.map((U=>Ro([U.x,U.y],r.canonical))))))),x=new el(v[0][0][0][1]);let C=1/0;for(const M of u)for(const O of v){switch(M.type){case"Point":C=Math.min(C,rl([M.coordinates],!1,O,x,C));break;case"LineString":C=Math.min(C,rl(M.coordinates,!0,O,x,C));break;case"Polygon":C=Math.min(C,oi(O,M.coordinates,x,C))}if(C===0)return C}return C})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const io={"==":Lu,"!=":Xn,">":_l,"<":zr,">=":zs,"<=":Ru,array:Ir,at:Wa,boolean:Ir,case:Mo,coalesce:gs,collator:Ds,format:za,image:Jo,in:au,"index-of":ua,interpolate:Vi,"interpolate-hcl":Vi,"interpolate-lab":Vi,length:vl,let:la,literal:ms,match:qn,number:Ir,"number-format":Ri,object:Ir,slice:Ao,step:Ka,string:Ir,"to-boolean":Li,"to-color":Li,"to-number":Li,"to-string":Li,var:Un,within:ys,distance:Da};class Zr{constructor(t,r,u,m){this.name=t,this.type=r,this._evaluate=u,this.args=m}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const u=t[0],m=Zr.definitions[u];if(!m)return r.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(m)?m[0]:m.type,x=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,C=x.filter((([O])=>!Array.isArray(O)||O.length===t.length-1));let M=null;for(const[O,U]of C){M=new Nr(r.registry,ro,r.path,null,r.scope);const G=[];let X=!1;for(let J=1;J<t.length;J++){const ie=t[J],ce=Array.isArray(O)?O[J-1]:O.type,ye=M.parse(ie,1+G.length,ce);if(!ye){X=!0;break}G.push(ye)}if(!X)if(Array.isArray(O)&&O.length!==G.length)M.error(`Expected ${O.length} arguments, but found ${G.length} instead.`);else{for(let J=0;J<G.length;J++){const ie=Array.isArray(O)?O[J]:O.type,ce=G[J];M.concat(J+1).checkSubtype(ie,ce.type)}if(M.errors.length===0)return new Zr(u,v,U,G)}}if(C.length===1)r.errors.push(...M.errors);else{const O=(C.length?C:x).map((([G])=>{return X=G,Array.isArray(X)?`(${X.map(Y).join(", ")})`:`(${Y(X.type)}...)`;var X})).join(" | "),U=[];for(let G=1;G<t.length;G++){const X=r.parse(t[G],1+U.length);if(!X)return null;U.push(Y(X.type))}r.error(`Expected arguments of type ${O}, but found (${U.join(", ")}) instead.`)}return null}static register(t,r){Zr.definitions=r;for(const u in r)t[u]=Zr}}function Oa(n,[t,r,u,m]){t=t.evaluate(n),r=r.evaluate(n),u=u.evaluate(n);const v=m?m.evaluate(n):1,x=sr(t,r,u,v);if(x)throw new ji(x);return new fn(t/255,r/255,u/255,v,!1)}function uu(n,t){return n in t}function cu(n,t){const r=t[n];return r===void 0?null:r}function Fa(n){return{type:n}}function ro(n){if(n instanceof Un)return ro(n.boundExpression);if(n instanceof Zr&&n.name==="error"||n instanceof Ds||n instanceof ys||n instanceof Da)return!1;const t=n instanceof Li||n instanceof Ir;let r=!0;return n.eachChild((u=>{r=t?r&&ro(u):r&&u instanceof ms})),!!r&&so(n)&&Bs(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function so(n){if(n instanceof Zr&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof ys||n instanceof Da)return!1;let t=!0;return n.eachChild((r=>{t&&!so(r)&&(t=!1)})),t}function Fs(n){if(n instanceof Zr&&n.name==="feature-state")return!1;let t=!0;return n.eachChild((r=>{t&&!Fs(r)&&(t=!1)})),t}function Bs(n,t){if(n instanceof Zr&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild((u=>{r&&!Bs(u,t)&&(r=!1)})),r}function zo(n){return{result:"success",value:n}}function fa(n){return{result:"error",value:n}}function ao(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Ml(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function sl(n){return!!n.expression&&n.expression.interpolated}function jn(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function js(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Fu(n){return n}function Al(n,t){const r=t.type==="color",u=n.stops&&typeof n.stops[0][0]=="object",m=u||!(u||n.property!==void 0),v=n.type||(sl(t)?"exponential":"interval");if(r||t.type==="padding"){const U=r?fn.parse:rr.parse;(n=Ur({},n)).stops&&(n.stops=n.stops.map((G=>[G[0],U(G[1])]))),n.default=U(n.default?n.default:t.default)}if(n.colorSpace&&(x=n.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var x;let C,M,O;if(v==="exponential")C=i;else if(v==="interval")C=f;else if(v==="categorical"){C=vs,M=Object.create(null);for(const U of n.stops)M[U[0]]=U[1];O=typeof n.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);C=s}if(u){const U={},G=[];for(let ie=0;ie<n.stops.length;ie++){const ce=n.stops[ie],ye=ce[0].zoom;U[ye]===void 0&&(U[ye]={zoom:ye,type:n.type,property:n.property,default:n.default,stops:[]},G.push(ye)),U[ye].stops.push([ce[0].value,ce[1]])}const X=[];for(const ie of G)X.push([U[ie].zoom,Al(U[ie],t)]);const J={name:"linear"};return{kind:"composite",interpolationType:J,interpolationFactor:Vi.interpolationFactor.bind(void 0,J),zoomStops:X.map((ie=>ie[0])),evaluate:({zoom:ie},ce)=>i({stops:X,base:n.base},t,ie).evaluate(ie,ce)}}if(m){const U=v==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:U,interpolationFactor:Vi.interpolationFactor.bind(void 0,U),zoomStops:n.stops.map((G=>G[0])),evaluate:({zoom:G})=>C(n,t,G,M,O)}}return{kind:"source",evaluate(U,G){const X=G&&G.properties?G.properties[n.property]:void 0;return X===void 0?ar(n.default,t.default):C(n,t,X,M,O)}}}function ar(n,t,r){return n!==void 0?n:t!==void 0?t:r!==void 0?r:void 0}function vs(n,t,r,u,m){return ar(typeof r===m?u[r]:void 0,n.default,t.default)}function f(n,t,r){if(jn(r)!=="number")return ar(n.default,t.default);const u=n.stops.length;if(u===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[u-1][0])return n.stops[u-1][1];const m=Ya(n.stops.map((v=>v[0])),r);return n.stops[m][1]}function i(n,t,r){const u=n.base!==void 0?n.base:1;if(jn(r)!=="number")return ar(n.default,t.default);const m=n.stops.length;if(m===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[m-1][0])return n.stops[m-1][1];const v=Ya(n.stops.map((U=>U[0])),r),x=(function(U,G,X,J){const ie=J-X,ce=U-X;return ie===0?0:G===1?ce/ie:(Math.pow(G,ce)-1)/(Math.pow(G,ie)-1)})(r,u,n.stops[v][0],n.stops[v+1][0]),C=n.stops[v][1],M=n.stops[v+1][1],O=Yn[t.type]||Fu;return typeof C.evaluate=="function"?{evaluate(...U){const G=C.evaluate.apply(void 0,U),X=M.evaluate.apply(void 0,U);if(G!==void 0&&X!==void 0)return O(G,X,x,n.colorSpace)}}:O(C,M,x,n.colorSpace)}function s(n,t,r){switch(t.type){case"color":r=fn.parse(r);break;case"formatted":r=yr.fromString(r.toString());break;case"resolvedImage":r=Bi.fromString(r.toString());break;case"padding":r=rr.parse(r);break;default:jn(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return ar(r,n.default,t.default)}Zr.register(io,{error:[{kind:"error"},[In],(n,[t])=>{throw new ji(t.evaluate(n))}],typeof:[In,[pn],(n,[t])=>Y(Wn(t.evaluate(n)))],"to-rgba":[K(_t,4),[mr],(n,[t])=>{const[r,u,m,v]=t.evaluate(n).rgb;return[255*r,255*u,255*m,v]}],rgb:[mr,[_t,_t,_t],Oa],rgba:[mr,[_t,_t,_t,_t],Oa],has:{type:pt,overloads:[[[In],(n,[t])=>uu(t.evaluate(n),n.properties())],[[In,qr],(n,[t,r])=>uu(t.evaluate(n),r.evaluate(n))]]},get:{type:pn,overloads:[[[In],(n,[t])=>cu(t.evaluate(n),n.properties())],[[In,qr],(n,[t,r])=>cu(t.evaluate(n),r.evaluate(n))]]},"feature-state":[pn,[In],(n,[t])=>cu(t.evaluate(n),n.featureState||{})],properties:[qr,[],n=>n.properties()],"geometry-type":[In,[],n=>n.geometryType()],id:[pn,[],n=>n.id()],zoom:[_t,[],n=>n.globals.zoom],"heatmap-density":[_t,[],n=>n.globals.heatmapDensity||0],"line-progress":[_t,[],n=>n.globals.lineProgress||0],accumulated:[pn,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[_t,Fa(_t),(n,t)=>{let r=0;for(const u of t)r+=u.evaluate(n);return r}],"*":[_t,Fa(_t),(n,t)=>{let r=1;for(const u of t)r*=u.evaluate(n);return r}],"-":{type:_t,overloads:[[[_t,_t],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[_t],(n,[t])=>-t.evaluate(n)]]},"/":[_t,[_t,_t],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[_t,[_t,_t],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[_t,[],()=>Math.LN2],pi:[_t,[],()=>Math.PI],e:[_t,[],()=>Math.E],"^":[_t,[_t,_t],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[_t,[_t],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[_t,[_t],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[_t,[_t],(n,[t])=>Math.log(t.evaluate(n))],log2:[_t,[_t],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[_t,[_t],(n,[t])=>Math.sin(t.evaluate(n))],cos:[_t,[_t],(n,[t])=>Math.cos(t.evaluate(n))],tan:[_t,[_t],(n,[t])=>Math.tan(t.evaluate(n))],asin:[_t,[_t],(n,[t])=>Math.asin(t.evaluate(n))],acos:[_t,[_t],(n,[t])=>Math.acos(t.evaluate(n))],atan:[_t,[_t],(n,[t])=>Math.atan(t.evaluate(n))],min:[_t,Fa(_t),(n,t)=>Math.min(...t.map((r=>r.evaluate(n))))],max:[_t,Fa(_t),(n,t)=>Math.max(...t.map((r=>r.evaluate(n))))],abs:[_t,[_t],(n,[t])=>Math.abs(t.evaluate(n))],round:[_t,[_t],(n,[t])=>{const r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[_t,[_t],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[_t,[_t],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[pt,[In,pn],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[pt,[pn],(n,[t])=>n.id()===t.value],"filter-type-==":[pt,[In],(n,[t])=>n.geometryType()===t.value],"filter-<":[pt,[In,pn],(n,[t,r])=>{const u=n.properties()[t.value],m=r.value;return typeof u==typeof m&&u<m}],"filter-id-<":[pt,[pn],(n,[t])=>{const r=n.id(),u=t.value;return typeof r==typeof u&&r<u}],"filter->":[pt,[In,pn],(n,[t,r])=>{const u=n.properties()[t.value],m=r.value;return typeof u==typeof m&&u>m}],"filter-id->":[pt,[pn],(n,[t])=>{const r=n.id(),u=t.value;return typeof r==typeof u&&r>u}],"filter-<=":[pt,[In,pn],(n,[t,r])=>{const u=n.properties()[t.value],m=r.value;return typeof u==typeof m&&u<=m}],"filter-id-<=":[pt,[pn],(n,[t])=>{const r=n.id(),u=t.value;return typeof r==typeof u&&r<=u}],"filter->=":[pt,[In,pn],(n,[t,r])=>{const u=n.properties()[t.value],m=r.value;return typeof u==typeof m&&u>=m}],"filter-id->=":[pt,[pn],(n,[t])=>{const r=n.id(),u=t.value;return typeof r==typeof u&&r>=u}],"filter-has":[pt,[pn],(n,[t])=>t.value in n.properties()],"filter-has-id":[pt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[pt,[K(In)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[pt,[K(pn)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[pt,[In,K(pn)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[pt,[In,K(pn)],(n,[t,r])=>(function(u,m,v,x){for(;v<=x;){const C=v+x>>1;if(m[C]===u)return!0;m[C]>u?x=C-1:v=C+1}return!1})(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:pt,overloads:[[[pt,pt],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[Fa(pt),(n,t)=>{for(const r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:pt,overloads:[[[pt,pt],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[Fa(pt),(n,t)=>{for(const r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[pt,[pt],(n,[t])=>!t.evaluate(n)],"is-supported-script":[pt,[In],(n,[t])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[In,[In],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[In,[In],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[In,Fa(pn),(n,t)=>t.map((r=>Xo(r.evaluate(n)))).join("")],"resolved-locale":[In,[Si],(n,[t])=>t.evaluate(n).resolvedLocale()]});class h{constructor(t,r){var u;this.expression=t,this._warningHistory={},this._evaluator=new Wo,this._defaultValue=r?(u=r).type==="color"&&js(u.default)?new fn(0,0,0,0):u.type==="color"?fn.parse(u.default)||null:u.type==="padding"?rr.parse(u.default)||null:u.type==="variableAnchorOffsetCollection"?Ii.parse(u.default)||null:u.default===void 0?null:u.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,u,m,v,x){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=u,this._evaluator.canonical=m,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(t,r,u,m,v,x){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=u||null,this._evaluator.canonical=m,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new ji(`Expected value to be one of ${Object.keys(this._enumValues).map((M=>JSON.stringify(M))).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(C.message)),this._defaultValue}}}function b(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in io}function R(n,t){const r=new Nr(io,ro,[],t?(function(m){const v={color:mr,string:In,number:_t,enum:In,boolean:pt,formatted:Sr,padding:Ai,resolvedImage:gr,variableAnchorOffsetCollection:_e};return m.type==="array"?K(v[m.value]||pn,m.length):v[m.type]})(t):void 0),u=r.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?zo(new h(u,t)):fa(r.errors)}class B{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!Fs(r.expression)}evaluateWithoutErrorHandling(t,r,u,m,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,r,u,m,v,x)}evaluate(t,r,u,m,v,x){return this._styleExpression.evaluate(t,r,u,m,v,x)}}class H{constructor(t,r,u,m){this.kind=t,this.zoomStops=u,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Fs(r.expression),this.interpolationType=m}evaluateWithoutErrorHandling(t,r,u,m,v,x){return this._styleExpression.evaluateWithoutErrorHandling(t,r,u,m,v,x)}evaluate(t,r,u,m,v,x){return this._styleExpression.evaluate(t,r,u,m,v,x)}interpolationFactor(t,r,u){return this.interpolationType?Vi.interpolationFactor(this.interpolationType,t,r,u):0}}function re(n,t){const r=R(n,t);if(r.result==="error")return r;const u=r.value.expression,m=so(u);if(!m&&!ao(t))return fa([new dn("","data expressions not supported")]);const v=Bs(u,["zoom"]);if(!v&&!Ml(t))return fa([new dn("","zoom expressions not supported")]);const x=De(u);return x||v?x instanceof dn?fa([x]):x instanceof Vi&&!sl(t)?fa([new dn("",'"interpolate" expressions cannot be used with this property')]):zo(x?new H(m?"camera":"composite",r.value,x.labels,x instanceof Vi?x.interpolation:void 0):new B(m?"constant":"source",r.value)):fa([new dn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class de{constructor(t,r){this._parameters=t,this._specification=r,Ur(this,Al(this._parameters,this._specification))}static deserialize(t){return new de(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function De(n){let t=null;if(n instanceof la)t=De(n.result);else if(n instanceof gs){for(const r of n.args)if(t=De(r),t)break}else(n instanceof Ka||n instanceof Vi)&&n.input instanceof Zr&&n.input.name==="zoom"&&(t=n);return t instanceof dn||n.eachChild((r=>{const u=De(r);u instanceof dn?t=u:!t&&u?t=new dn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&u&&t!==u&&(t=new dn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function $e(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!$e(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const ct={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function At(n){if(n==null)return{filter:()=>!0,needGeometry:!1};$e(n)||(n=Nn(n));const t=R(n,ct);if(t.result==="error")throw new Error(t.value.map((r=>`${r.key}: ${r.message}`)).join(", "));return{filter:(r,u,m)=>t.value.evaluate(r,u,{},m),needGeometry:ln(n)}}function Ht(n,t){return n<t?-1:n>t?1:0}function ln(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(ln(n[t]))return!0;return!1}function Nn(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?An(n[1],n[2],"=="):t==="!="?Kn(An(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?An(n[1],n[2],t):t==="any"?(r=n.slice(1),["any"].concat(r.map(Nn))):t==="all"?["all"].concat(n.slice(1).map(Nn)):t==="none"?["all"].concat(n.slice(1).map(Nn).map(Kn)):t==="in"?Vn(n[1],n.slice(2)):t==="!in"?Kn(Vn(n[1],n.slice(2))):t==="has"?Ci(n[1]):t!=="!has"||Kn(Ci(n[1]));var r}function An(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function Vn(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((r=>typeof r!=typeof t[0]))?["filter-in-large",n,["literal",t.sort(Ht)]]:["filter-in-small",n,["literal",t]]}}function Ci(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Kn(n){return["!",n]}function xr(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let m="[";for(const v of n)m+=`${xr(v)},`;return`${m}]`}const r=Object.keys(n).sort();let u="{";for(let m=0;m<r.length;m++)u+=`${JSON.stringify(r[m])}:${xr(n[r[m]])},`;return`${u}}`}function oo(n){let t="";for(const r of ds)t+=`/${xr(n[r])}`;return t}function Ll(n){const t=n.value;return t?[new Qe(n.key,t,"constants have been deprecated as of v8")]:[]}function xi(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Hr(n){if(Array.isArray(n))return n.map(Hr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const r in n)t[r]=Hr(n[r]);return t}return xi(n)}function Tr(n){const t=n.key,r=n.value,u=n.valueSpec||{},m=n.objectElementValidators||{},v=n.style,x=n.styleSpec,C=n.validateSpec;let M=[];const O=jn(r);if(O!=="object")return[new Qe(t,r,`object expected, ${O} found`)];for(const U in r){const G=U.split(".")[0],X=u[G]||u["*"];let J;if(m[G])J=m[G];else if(u[G])J=C;else if(m["*"])J=m["*"];else{if(!u["*"]){M.push(new Qe(t,r[U],`unknown property "${U}"`));continue}J=C}M=M.concat(J({key:(t&&`${t}.`)+U,value:r[U],valueSpec:X,style:v,styleSpec:x,object:r,objectKey:U,validateSpec:C},r))}for(const U in u)m[U]||u[U].required&&u[U].default===void 0&&r[U]===void 0&&M.push(new Qe(t,r,`missing required property "${U}"`));return M}function lo(n){const t=n.value,r=n.valueSpec,u=n.style,m=n.styleSpec,v=n.key,x=n.arrayElementValidator||n.validateSpec;if(jn(t)!=="array")return[new Qe(v,t,`array expected, ${jn(t)} found`)];if(r.length&&t.length!==r.length)return[new Qe(v,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Qe(v,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let C={type:r.value,values:r.values};m.$version<7&&(C.function=r.function),jn(r.value)==="object"&&(C=r.value);let M=[];for(let O=0;O<t.length;O++)M=M.concat(x({array:t,arrayIndex:O,value:t[O],valueSpec:C,validateSpec:n.validateSpec,style:u,styleSpec:m,key:`${v}[${O}]`}));return M}function xs(n){const t=n.key,r=n.value,u=n.valueSpec;let m=jn(r);return m==="number"&&r!=r&&(m="NaN"),m!=="number"?[new Qe(t,r,`number expected, ${m} found`)]:"minimum"in u&&r<u.minimum?[new Qe(t,r,`${r} is less than the minimum value ${u.minimum}`)]:"maximum"in u&&r>u.maximum?[new Qe(t,r,`${r} is greater than the maximum value ${u.maximum}`)]:[]}function Ba(n){const t=n.valueSpec,r=xi(n.value.type);let u,m,v,x={};const C=r!=="categorical"&&n.value.property===void 0,M=!C,O=jn(n.value.stops)==="array"&&jn(n.value.stops[0])==="array"&&jn(n.value.stops[0][0])==="object",U=Tr({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(J){if(r==="identity")return[new Qe(J.key,J.value,'identity function may not have a "stops" property')];let ie=[];const ce=J.value;return ie=ie.concat(lo({key:J.key,value:ce,valueSpec:J.valueSpec,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:G})),jn(ce)==="array"&&ce.length===0&&ie.push(new Qe(J.key,ce,"array must have at least one stop")),ie},default:function(J){return J.validateSpec({key:J.key,value:J.value,valueSpec:t,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec})}}});return r==="identity"&&C&&U.push(new Qe(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||U.push(new Qe(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!sl(n.valueSpec)&&U.push(new Qe(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(M&&!ao(n.valueSpec)?U.push(new Qe(n.key,n.value,"property functions not supported")):C&&!Ml(n.valueSpec)&&U.push(new Qe(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!O||n.value.property!==void 0||U.push(new Qe(n.key,n.value,'"property" property is required')),U;function G(J){let ie=[];const ce=J.value,ye=J.key;if(jn(ce)!=="array")return[new Qe(ye,ce,`array expected, ${jn(ce)} found`)];if(ce.length!==2)return[new Qe(ye,ce,`array length 2 expected, length ${ce.length} found`)];if(O){if(jn(ce[0])!=="object")return[new Qe(ye,ce,`object expected, ${jn(ce[0])} found`)];if(ce[0].zoom===void 0)return[new Qe(ye,ce,"object stop key must have zoom")];if(ce[0].value===void 0)return[new Qe(ye,ce,"object stop key must have value")];if(v&&v>xi(ce[0].zoom))return[new Qe(ye,ce[0].zoom,"stop zoom values must appear in ascending order")];xi(ce[0].zoom)!==v&&(v=xi(ce[0].zoom),m=void 0,x={}),ie=ie.concat(Tr({key:`${ye}[0]`,value:ce[0],valueSpec:{zoom:{}},validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:xs,value:X}}))}else ie=ie.concat(X({key:`${ye}[0]`,value:ce[0],validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec},ce));return b(Hr(ce[1]))?ie.concat([new Qe(`${ye}[1]`,ce[1],"expressions are not allowed in function stops.")]):ie.concat(J.validateSpec({key:`${ye}[1]`,value:ce[1],valueSpec:t,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec}))}function X(J,ie){const ce=jn(J.value),ye=xi(J.value),be=J.value!==null?J.value:ie;if(u){if(ce!==u)return[new Qe(J.key,be,`${ce} stop domain type must match previous stop domain type ${u}`)]}else u=ce;if(ce!=="number"&&ce!=="string"&&ce!=="boolean")return[new Qe(J.key,be,"stop domain value must be a number, string, or boolean")];if(ce!=="number"&&r!=="categorical"){let Ue=`number expected, ${ce} found`;return ao(t)&&r===void 0&&(Ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Qe(J.key,be,Ue)]}return r!=="categorical"||ce!=="number"||isFinite(ye)&&Math.floor(ye)===ye?r!=="categorical"&&ce==="number"&&m!==void 0&&ye<m?[new Qe(J.key,be,"stop domain values must appear in ascending order")]:(m=ye,r==="categorical"&&ye in x?[new Qe(J.key,be,"stop domain values must be unique")]:(x[ye]=!0,[])):[new Qe(J.key,be,`integer expected, found ${ye}`)]}}function Vs(n){const t=(n.expressionContext==="property"?re:R)(Hr(n.value),n.valueSpec);if(t.result==="error")return t.value.map((u=>new Qe(`${n.key}${u.key}`,n.value,u.message)));const r=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new Qe(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Fs(r))return[new Qe(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Fs(r))return[new Qe(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Bs(r,["zoom","feature-state"]))return[new Qe(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!so(r))return[new Qe(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function uo(n){const t=n.key,r=n.value,u=n.valueSpec,m=[];return Array.isArray(u.values)?u.values.indexOf(xi(r))===-1&&m.push(new Qe(t,r,`expected one of [${u.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(u.values).indexOf(xi(r))===-1&&m.push(new Qe(t,r,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(r)} found`)),m}function mc(n){return $e(Hr(n.value))?Vs(Ur({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Do(n)}function Do(n){const t=n.value,r=n.key;if(jn(t)!=="array")return[new Qe(r,t,`array expected, ${jn(t)} found`)];const u=n.styleSpec;let m,v=[];if(t.length<1)return[new Qe(r,t,"filter array must have at least 1 element")];switch(v=v.concat(uo({key:`${r}[0]`,value:t[0],valueSpec:u.filter_operator,style:n.style,styleSpec:n.styleSpec})),xi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&xi(t[1])==="$type"&&v.push(new Qe(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&v.push(new Qe(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(m=jn(t[1]),m!=="string"&&v.push(new Qe(`${r}[1]`,t[1],`string expected, ${m} found`)));for(let x=2;x<t.length;x++)m=jn(t[x]),xi(t[1])==="$type"?v=v.concat(uo({key:`${r}[${x}]`,value:t[x],valueSpec:u.geometry_type,style:n.style,styleSpec:n.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&v.push(new Qe(`${r}[${x}]`,t[x],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)v=v.concat(Do({key:`${r}[${x}]`,value:t[x],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":m=jn(t[1]),t.length!==2?v.push(new Qe(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):m!=="string"&&v.push(new Qe(`${r}[1]`,t[1],`string expected, ${m} found`))}return v}function gc(n,t){const r=n.key,u=n.validateSpec,m=n.style,v=n.styleSpec,x=n.value,C=n.objectKey,M=v[`${t}_${n.layerType}`];if(!M)return[];const O=C.match(/^(.*)-transition$/);if(t==="paint"&&O&&M[O[1]]&&M[O[1]].transition)return u({key:r,value:x,valueSpec:v.transition,style:m,styleSpec:v});const U=n.valueSpec||M[C];if(!U)return[new Qe(r,x,`unknown property "${C}"`)];let G;if(jn(x)==="string"&&ao(U)&&!U.tokens&&(G=/^{([^}]+)}$/.exec(x)))return[new Qe(r,x,`"${C}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(G[1])} }\`.`)];const X=[];return n.layerType==="symbol"&&(C==="text-field"&&m&&!m.glyphs&&X.push(new Qe(r,x,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&js(Hr(x))&&xi(x.type)==="identity"&&X.push(new Qe(r,x,'"text-font" does not support identity functions'))),X.concat(u({key:n.key,value:x,valueSpec:U,style:m,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:C}))}function hu(n){return gc(n,"paint")}function Bu(n){return gc(n,"layout")}function gi(n){let t=[];const r=n.value,u=n.key,m=n.style,v=n.styleSpec;r.type||r.ref||t.push(new Qe(u,r,'either "type" or "ref" is required'));let x=xi(r.type);const C=xi(r.ref);if(r.id){const M=xi(r.id);for(let O=0;O<n.arrayIndex;O++){const U=m.layers[O];xi(U.id)===M&&t.push(new Qe(u,r.id,`duplicate layer id "${r.id}", previously used at line ${U.id.__line__}`))}}if("ref"in r){let M;["type","source","source-layer","filter","layout"].forEach((O=>{O in r&&t.push(new Qe(u,r[O],`"${O}" is prohibited for ref layers`))})),m.layers.forEach((O=>{xi(O.id)===C&&(M=O)})),M?M.ref?t.push(new Qe(u,r.ref,"ref cannot reference another ref layer")):x=xi(M.type):t.push(new Qe(u,r.ref,`ref layer "${C}" not found`))}else if(x!=="background")if(r.source){const M=m.sources&&m.sources[r.source],O=M&&xi(M.type);M?O==="vector"&&x==="raster"?t.push(new Qe(u,r.source,`layer "${r.id}" requires a raster source`)):O!=="raster-dem"&&x==="hillshade"?t.push(new Qe(u,r.source,`layer "${r.id}" requires a raster-dem source`)):O==="raster"&&x!=="raster"?t.push(new Qe(u,r.source,`layer "${r.id}" requires a vector source`)):O!=="vector"||r["source-layer"]?O==="raster-dem"&&x!=="hillshade"?t.push(new Qe(u,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!r.paint||!r.paint["line-gradient"]||O==="geojson"&&M.lineMetrics||t.push(new Qe(u,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Qe(u,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Qe(u,r.source,`source "${r.source}" not found`))}else t.push(new Qe(u,r,'missing required property "source"'));return t=t.concat(Tr({key:u,value:r,valueSpec:v.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${u}.type`,value:r.type,valueSpec:v.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:mc,layout:M=>Tr({layer:r,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":O=>Bu(Ur({layerType:x},O))}}),paint:M=>Tr({layer:r,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,validateSpec:M.validateSpec,objectElementValidators:{"*":O=>hu(Ur({layerType:x},O))}})}})),t}function co(n){const t=n.value,r=n.key,u=jn(t);return u!=="string"?[new Qe(r,t,`string expected, ${u} found`)]:[]}const al={promoteId:function({key:n,value:t}){if(jn(t)==="string")return co({key:n,value:t});{const r=[];for(const u in t)r.push(...co({key:`${n}.${u}`,value:t[u]}));return r}}};function ho(n){const t=n.value,r=n.key,u=n.styleSpec,m=n.style,v=n.validateSpec;if(!t.type)return[new Qe(r,t,'"type" is required')];const x=xi(t.type);let C;switch(x){case"vector":case"raster":return C=Tr({key:r,value:t,valueSpec:u[`source_${x.replace("-","_")}`],style:n.style,styleSpec:u,objectElementValidators:al,validateSpec:v}),C;case"raster-dem":return C=(function(M){var O;const U=(O=M.sourceName)!==null&&O!==void 0?O:"",G=M.value,X=M.styleSpec,J=X.source_raster_dem,ie=M.style;let ce=[];const ye=jn(G);if(G===void 0)return ce;if(ye!=="object")return ce.push(new Qe("source_raster_dem",G,`object expected, ${ye} found`)),ce;const be=xi(G.encoding)==="custom",Ue=["redFactor","greenFactor","blueFactor","baseShift"],Te=M.value.encoding?`"${M.value.encoding}"`:"Default";for(const Ve in G)!be&&Ue.includes(Ve)?ce.push(new Qe(Ve,G[Ve],`In "${U}": "${Ve}" is only valid when "encoding" is set to "custom". ${Te} encoding found`)):J[Ve]?ce=ce.concat(M.validateSpec({key:Ve,value:G[Ve],valueSpec:J[Ve],validateSpec:M.validateSpec,style:ie,styleSpec:X})):ce.push(new Qe(Ve,G[Ve],`unknown property "${Ve}"`));return ce})({sourceName:r,value:t,style:n.style,styleSpec:u,validateSpec:v}),C;case"geojson":if(C=Tr({key:r,value:t,valueSpec:u.source_geojson,style:m,styleSpec:u,validateSpec:v,objectElementValidators:al}),t.cluster)for(const M in t.clusterProperties){const[O,U]=t.clusterProperties[M],G=typeof O=="string"?[O,["accumulated"],["get",M]]:O;C.push(...Vs({key:`${r}.${M}.map`,value:U,expressionContext:"cluster-map"})),C.push(...Vs({key:`${r}.${M}.reduce`,value:G,expressionContext:"cluster-reduce"}))}return C;case"video":return Tr({key:r,value:t,valueSpec:u.source_video,style:m,validateSpec:v,styleSpec:u});case"image":return Tr({key:r,value:t,valueSpec:u.source_image,style:m,validateSpec:v,styleSpec:u});case"canvas":return[new Qe(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return uo({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ju(n){const t=n.value,r=n.styleSpec,u=r.light,m=n.style;let v=[];const x=jn(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new Qe("light",t,`object expected, ${x} found`)]),v;for(const C in t){const M=C.match(/^(.*)-transition$/);v=v.concat(M&&u[M[1]]&&u[M[1]].transition?n.validateSpec({key:C,value:t[C],valueSpec:r.transition,validateSpec:n.validateSpec,style:m,styleSpec:r}):u[C]?n.validateSpec({key:C,value:t[C],valueSpec:u[C],validateSpec:n.validateSpec,style:m,styleSpec:r}):[new Qe(C,t[C],`unknown property "${C}"`)])}return v}function fu(n){const t=n.value,r=n.styleSpec,u=r.sky,m=n.style,v=jn(t);if(t===void 0)return[];if(v!=="object")return[new Qe("sky",t,`object expected, ${v} found`)];let x=[];for(const C in t)x=x.concat(u[C]?n.validateSpec({key:C,value:t[C],valueSpec:u[C],style:m,styleSpec:r}):[new Qe(C,t[C],`unknown property "${C}"`)]);return x}function ol(n){const t=n.value,r=n.styleSpec,u=r.terrain,m=n.style;let v=[];const x=jn(t);if(t===void 0)return v;if(x!=="object")return v=v.concat([new Qe("terrain",t,`object expected, ${x} found`)]),v;for(const C in t)v=v.concat(u[C]?n.validateSpec({key:C,value:t[C],valueSpec:u[C],validateSpec:n.validateSpec,style:m,styleSpec:r}):[new Qe(C,t[C],`unknown property "${C}"`)]);return v}function Rl(n){let t=[];const r=n.value,u=n.key;if(Array.isArray(r)){const m=[],v=[];for(const x in r)r[x].id&&m.includes(r[x].id)&&t.push(new Qe(u,r,`all the sprites' ids must be unique, but ${r[x].id} is duplicated`)),m.push(r[x].id),r[x].url&&v.includes(r[x].url)&&t.push(new Qe(u,r,`all the sprites' URLs must be unique, but ${r[x].url} is duplicated`)),v.push(r[x].url),t=t.concat(Tr({key:`${u}[${x}]`,value:r[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return co({key:u,value:r})}const fo={"*":()=>[],array:lo,boolean:function(n){const t=n.value,r=n.key,u=jn(t);return u!=="boolean"?[new Qe(r,t,`boolean expected, ${u} found`)]:[]},number:xs,color:function(n){const t=n.key,r=n.value,u=jn(r);return u!=="string"?[new Qe(t,r,`color expected, ${u} found`)]:fn.parse(String(r))?[]:[new Qe(t,r,`color expected, "${r}" found`)]},constants:Ll,enum:uo,filter:mc,function:Ba,layer:gi,object:Tr,source:ho,light:ju,sky:fu,terrain:ol,projection:function(n){const t=n.value,r=n.styleSpec,u=r.projection,m=n.style,v=jn(t);if(t===void 0)return[];if(v!=="object")return[new Qe("projection",t,`object expected, ${v} found`)];let x=[];for(const C in t)x=x.concat(u[C]?n.validateSpec({key:C,value:t[C],valueSpec:u[C],style:m,styleSpec:r}):[new Qe(C,t[C],`unknown property "${C}"`)]);return x},string:co,formatted:function(n){return co(n).length===0?[]:Vs(n)},resolvedImage:function(n){return co(n).length===0?[]:Vs(n)},padding:function(n){const t=n.key,r=n.value;if(jn(r)==="array"){if(r.length<1||r.length>4)return[new Qe(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const u={type:"number"};let m=[];for(let v=0;v<r.length;v++)m=m.concat(n.validateSpec({key:`${t}[${v}]`,value:r[v],validateSpec:n.validateSpec,valueSpec:u}));return m}return xs({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,r=n.value,u=jn(r),m=n.styleSpec;if(u!=="array"||r.length<1||r.length%2!=0)return[new Qe(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<r.length;x+=2)v=v.concat(uo({key:`${t}[${x}]`,value:r[x],valueSpec:m.layout_symbol["text-anchor"]})),v=v.concat(lo({key:`${t}[${x+1}]`,value:r[x+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:m}));return v},sprite:Rl};function Nl(n){const t=n.value,r=n.valueSpec,u=n.styleSpec;return n.validateSpec=Nl,r.expression&&js(xi(t))?Ba(n):r.expression&&b(Hr(t))?Vs(n):r.type&&fo[r.type]?fo[r.type](n):Tr(Ur({},n,{valueSpec:r.type?u[r.type]:r}))}function rh(n){const t=n.value,r=n.key,u=co(n);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new Qe(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new Qe(r,t,'"glyphs" url must include a "{range}" token'))),u}function Us(n,t=Ye){let r=[];return r=r.concat(Nl({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:Nl,objectElementValidators:{glyphs:rh,"*":()=>[]}})),n.constants&&(r=r.concat(Ll({key:"constants",value:n.constants}))),zl(r)}function da(n){return function(t){return n({...t,validateSpec:Nl})}}function zl(n){return[].concat(n).sort(((t,r)=>t.line-r.line))}function ns(n){return function(...t){return zl(n.apply(this,t))}}Us.source=ns(da(ho)),Us.sprite=ns(da(Rl)),Us.glyphs=ns(da(rh)),Us.light=ns(da(ju)),Us.sky=ns(da(fu)),Us.terrain=ns(da(ol)),Us.layer=ns(da(gi)),Us.filter=ns(da(mc)),Us.paintProperty=ns(da(hu)),Us.layoutProperty=ns(da(Bu));const po=Us,yc=po.light,_c=po.sky,Vu=po.paintProperty,sh=po.layoutProperty;function Uu(n,t){let r=!1;if(t&&t.length)for(const u of t)n.fire(new Vr(new Error(u.message))),r=!0;return r}class Dl{constructor(t,r,u){const m=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const x=new Int32Array(this.arrayBuffer);t=x[0],this.d=(r=x[1])+2*(u=x[2]);for(let M=0;M<this.d*this.d;M++){const O=x[3+M],U=x[3+M+1];m.push(O===U?null:x.subarray(O,U))}const C=x[3+m.length+1];this.keys=x.subarray(x[3+m.length],C),this.bboxes=x.subarray(C),this.insert=this._insertReadonly}else{this.d=r+2*u;for(let x=0;x<this.d*this.d;x++)m.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=u,this.scale=r/t,this.uid=0;const v=u/r*t;this.min=-v,this.max=t+v}insert(t,r,u,m,v){this._forEachCell(r,u,m,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,u,m,v,x){this.cells[v].push(x)}query(t,r,u,m,v){const x=this.min,C=this.max;if(t<=x&&r<=x&&C<=u&&C<=m&&!v)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(t,r,u,m,this._queryCell,M,{},v),M}}_queryCell(t,r,u,m,v,x,C,M){const O=this.cells[v];if(O!==null){const U=this.keys,G=this.bboxes;for(let X=0;X<O.length;X++){const J=O[X];if(C[J]===void 0){const ie=4*J;(M?M(G[ie+0],G[ie+1],G[ie+2],G[ie+3]):t<=G[ie+2]&&r<=G[ie+3]&&u>=G[ie+0]&&m>=G[ie+1])?(C[J]=!0,x.push(U[J])):C[J]=!1}}}}_forEachCell(t,r,u,m,v,x,C,M){const O=this._convertToCellCoord(t),U=this._convertToCellCoord(r),G=this._convertToCellCoord(u),X=this._convertToCellCoord(m);for(let J=O;J<=G;J++)for(let ie=U;ie<=X;ie++){const ce=this.d*ie+J;if((!M||M(this._convertFromCellCoord(J),this._convertFromCellCoord(ie),this._convertFromCellCoord(J+1),this._convertFromCellCoord(ie+1)))&&v.call(this,t,r,u,m,ce,x,C,M))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let u=0;for(let x=0;x<this.cells.length;x++)u+=this.cells[x].length;const m=new Int32Array(r+u+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let v=r;for(let x=0;x<t.length;x++){const C=t[x];m[3+x]=v,m.set(C,v),v+=C.length}return m[3+t.length]=v,m.set(this.keys,v),v+=this.keys.length,m[3+t.length+1]=v,m.set(this.bboxes,v),v+=this.bboxes.length,m.buffer}static serialize(t,r){const u=t.toArrayBuffer();return r&&r.push(u),{buffer:u}}static deserialize(t){return new Dl(t.buffer)}}const qs={};function Ot(n,t,r={}){if(qs[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),qs[n]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}Ot("Object",Object),Ot("TransferableGridIndex",Dl),Ot("Color",fn),Ot("Error",Error),Ot("AJAXError",Rn),Ot("ResolvedImage",Bi),Ot("StylePropertyFunction",de),Ot("StyleExpression",h,{omit:["_evaluator"]}),Ot("ZoomDependentExpression",H),Ot("ZoomConstantExpression",B),Ot("CompoundExpression",Zr,{omit:["_evaluate"]});for(const n in io)io[n]._classRegistryKey||Ot(`Expression_${n}`,io[n]);function pa(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function qu(n){return n.$name||n.constructor._classRegistryKey}function ll(n){return!(function(t){if(t===null||typeof t!="object")return!1;const r=qu(t);return!(!r||r==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||pa(n)||rn(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Xr(n,t){if(ll(n))return(pa(n)||rn(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const v=[];for(const x of n)v.push(Xr(x,t));return v}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const r=qu(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!qs[r])throw new Error(`${r} is not registered.`);const{klass:u}=qs[r],m=u.serialize?u.serialize(n,t):{};if(u.serialize){if(t&&m===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in n){if(!n.hasOwnProperty(v)||qs[r].omit.indexOf(v)>=0)continue;const x=n[v];m[v]=qs[r].shallow.indexOf(v)>=0?x:Xr(x,t)}n instanceof Error&&(m.message=n.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(m.$name=r),m}function ja(n){if(ll(n))return n;if(Array.isArray(n))return n.map(ja);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=qu(n)||"Object";if(!qs[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=qs[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);const u=Object.create(r.prototype);for(const m of Object.keys(n)){if(m==="$name")continue;const v=n[m];u[m]=qs[t].shallow.indexOf(m)>=0?v:ja(v)}return u}class ma{constructor(){this.first=!0}update(t,r){const u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))}}const zn={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function vc(n){for(const t of n)if(mu(t.charCodeAt(0)))return!0;return!1}function Kh(n){for(const t of n)if(!ga(t.charCodeAt(0)))return!1;return!0}function mo(n){const t=n.map((r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}})).filter((r=>r));return new RegExp(t.join("|"),"u")}const du=mo(["Arab","Dupl","Mong","Ougr","Syrc"]);function ga(n){return!du.test(String.fromCodePoint(n))}const pu=mo(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function mu(n){return!(n!==746&&n!==747&&(n<4352||!(zn["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||zn["CJK Compatibility"](n)||zn["CJK Strokes"](n)||!(!zn["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||zn["Enclosed CJK Letters and Months"](n)||zn["Ideographic Description Characters"](n)||zn.Kanbun(n)||zn.Katakana(n)&&n!==12540||!(!zn["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!zn["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||zn["Vertical Forms"](n)||zn["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||pu.test(String.fromCodePoint(n)))))}function ul(n){return!(mu(n)||(function(t){return!!(zn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||zn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||zn["Letterlike Symbols"](t)||zn["Number Forms"](t)||zn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||zn["Control Pictures"](t)&&t!==9251||zn["Optical Character Recognition"](t)||zn["Enclosed Alphanumerics"](t)||zn["Geometric Shapes"](t)||zn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||zn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||zn["CJK Symbols and Punctuation"](t)||zn.Katakana(t)||zn["Private Use Area"](t)||zn["CJK Compatibility Forms"](t)||zn["Small Form Variants"](t)||zn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(n))}const Oo=mo(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function yi(n){return Oo.test(String.fromCodePoint(n))}function wi(n,t){return!(!t&&yi(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||zn.Khmer(n))}function Fo(n){for(const t of n)if(yi(t.charCodeAt(0)))return!0;return!1}const ui=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class On{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ma,this.transition={})}isSupportedScript(t){return(function(r,u){for(const m of r)if(!wi(m.charCodeAt(0),u))return!1;return!0})(t,ui.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*r}}}class Gs{constructor(t,r){this.property=t,this.value=r,this.expression=(function(u,m){if(js(u))return new de(u,m);if(b(u)){const v=re(u,m);if(v.result==="error")throw new Error(v.value.map((x=>`${x.key}: ${x.message}`)).join(", "));return v.value}{let v=u;return m.type==="color"&&typeof u=="string"?v=fn.parse(u):m.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(u)&&(v=Ii.parse(u)):v=rr.parse(u),{kind:"constant",evaluate:()=>v}}})(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,u){return this.property.possiblyEvaluate(this,t,r,u)}}class go{constructor(t){this.property=t,this.value=new Gs(t,void 0)}transitioned(t,r){return new gu(this.property,this.value,r,at({},t.transition,this.transition),t.now)}untransitioned(){return new gu(this.property,this.value,null,{},0)}}class Cr{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return wt(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new go(this._values[t].property)),this._values[t].value=new Gs(this._values[t].property,r===null?void 0:wt(r))}getTransition(t){return wt(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new go(this._values[t].property)),this._values[t].transition=wt(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const u=this.getValue(r);u!==void 0&&(t[r]=u);const m=this.getTransition(r);m!==void 0&&(t[`${r}-transition`]=m)}return t}transitioned(t,r){const u=new Ol(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].transitioned(t,r._values[m]);return u}untransitioned(){const t=new Ol(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class gu{constructor(t,r,u,m,v){this.property=t,this.value=r,this.begin=v+m.delay||0,this.end=this.begin+m.duration||0,t.specification.transition&&(m.delay||m.duration)&&(this.prior=u)}possiblyEvaluate(t,r,u){const m=t.now||0,v=this.value.possiblyEvaluate(t,r,u),x=this.prior;if(x){if(m>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(m<this.begin)return x.possiblyEvaluate(t,r,u);{const C=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,r,u),v,(function(M){if(M<=0)return 0;if(M>=1)return 1;const O=M*M,U=O*M;return 4*(M<.5?U:3*(M-O)+U-.75)})(C))}}return v}}class Ol{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,u){const m=new Bl(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(t,r,u);return m}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Fl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return wt(this._values[t].value)}setValue(t,r){this._values[t]=new Gs(this._values[t].property,r===null?void 0:wt(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const u=this.getValue(r);u!==void 0&&(t[r]=u)}return t}possiblyEvaluate(t,r,u){const m=new Bl(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].possiblyEvaluate(t,r,u);return m}}class ws{constructor(t,r,u){this.property=t,this.value=r,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,u,m){return this.property.evaluate(this.value,this.parameters,t,r,u,m)}}class Bl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ft{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,u){const m=Yn[this.specification.type];return m?m(t,r,u):t}}class sn{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,u,m){return new ws(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},u,m)}:t.expression,r)}interpolate(t,r,u){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new ws(this,{kind:"constant",value:void 0},t.parameters);const m=Yn[this.specification.type];if(m){const v=m(t.value.value,r.value.value,u);return new ws(this,{kind:"constant",value:v},t.parameters)}return t}evaluate(t,r,u,m,v,x){return t.kind==="constant"?t.value:t.evaluate(r,u,m,v,x)}}class jl extends sn{possiblyEvaluate(t,r,u,m){if(t.value===void 0)return new ws(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const v=t.expression.evaluate(r,null,{},u,m),x=t.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,C=this._calculate(x,x,x,r);return new ws(this,{kind:"constant",value:C},r)}if(t.expression.kind==="camera"){const v=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new ws(this,{kind:"constant",value:v},r)}return new ws(this,t.expression,r)}evaluate(t,r,u,m,v,x){if(t.kind==="source"){const C=t.evaluate(r,u,m,v,x);return this._calculate(C,C,C,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},u,m),t.evaluate({zoom:Math.floor(r.zoom)},u,m),t.evaluate({zoom:Math.floor(r.zoom)+1},u,m),r):t.value}_calculate(t,r,u,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:u,to:r}}interpolate(t){return t}}class yu{constructor(t){this.specification=t}possiblyEvaluate(t,r,u,m){if(t.value!==void 0){if(t.expression.kind==="constant"){const v=t.expression.evaluate(r,null,{},u,m);return this._calculate(v,v,v,r)}return this._calculate(t.expression.evaluate(new On(Math.floor(r.zoom-1),r)),t.expression.evaluate(new On(Math.floor(r.zoom),r)),t.expression.evaluate(new On(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,u,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:u,to:r}}interpolate(t){return t}}class xc{constructor(t){this.specification=t}possiblyEvaluate(t,r,u,m){return!!t.expression.evaluate(r,null,{},u,m)}interpolate(){return!1}}class _{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const u=t[r];u.specification.overridable&&this.overridableProperties.push(r);const m=this.defaultPropertyValues[r]=new Gs(u,void 0),v=this.defaultTransitionablePropertyValues[r]=new go(u);this.defaultTransitioningPropertyValues[r]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=m.possiblyEvaluate({})}}}Ot("DataDrivenProperty",sn),Ot("DataConstantProperty",Ft),Ot("CrossFadedDataDrivenProperty",jl),Ot("CrossFadedProperty",yu),Ot("ColorRampProperty",xc);const e="-transition";class o extends Rr{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new Fl(r.layout)),r.paint)){this._transitionablePaint=new Cr(r.paint);for(const u in t.paint)this.setPaintProperty(u,t.paint[u],{validate:!1});for(const u in t.layout)this.setLayoutProperty(u,t.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Bl(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,u={}){r!=null&&this._validate(sh,`layers.${this.id}.layout.${t}`,t,r,u)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,u={}){if(r!=null&&this._validate(Vu,`layers.${this.id}.paint.${t}`,t,r,u))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const m=this._transitionablePaint._values[t],v=m.property.specification["property-type"]==="cross-faded-data-driven",x=m.value.isDataDriven(),C=m.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const M=this._transitionablePaint._values[t].value;return M.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(t,C,M)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,u){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),$t(t,((r,u)=>!(r===void 0||u==="layout"&&!Object.keys(r).length||u==="paint"&&!Object.keys(r).length)))}_validate(t,r,u,m,v={}){return(!v||v.validate!==!1)&&Uu(this,t.call(po,{key:r,layerType:this.type,objectKey:u,value:m,styleSpec:Ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof ws&&ao(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const d={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class p{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class y{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function P(n,t=1){let r=0,u=0;return{members:n.map((m=>{const v=d[m.type].BYTES_PER_ELEMENT,x=r=A(r,Math.max(t,v)),C=m.components||1;return u=Math.max(u,v),r+=v*C,{name:m.name,type:m.type,components:C,offset:x}})),size:A(r,Math.max(u,t)),alignment:t}}function A(n,t){return Math.ceil(n/t)*t}class D extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const u=this.length;return this.resize(u+1),this.emplace(u,t,r)}emplace(t,r,u){const m=2*t;return this.int16[m+0]=r,this.int16[m+1]=u,t}}D.prototype.bytesPerElement=4,Ot("StructArrayLayout2i4",D);class V extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,u)}emplace(t,r,u,m){const v=3*t;return this.int16[v+0]=r,this.int16[v+1]=u,this.int16[v+2]=m,t}}V.prototype.bytesPerElement=6,Ot("StructArrayLayout3i6",V);class $ extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,u,m)}emplace(t,r,u,m,v){const x=4*t;return this.int16[x+0]=r,this.int16[x+1]=u,this.int16[x+2]=m,this.int16[x+3]=v,t}}$.prototype.bytesPerElement=8,Ot("StructArrayLayout4i8",$);class Z extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x){const C=this.length;return this.resize(C+1),this.emplace(C,t,r,u,m,v,x)}emplace(t,r,u,m,v,x,C){const M=6*t;return this.int16[M+0]=r,this.int16[M+1]=u,this.int16[M+2]=m,this.int16[M+3]=v,this.int16[M+4]=x,this.int16[M+5]=C,t}}Z.prototype.bytesPerElement=12,Ot("StructArrayLayout2i4i12",Z);class te extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x){const C=this.length;return this.resize(C+1),this.emplace(C,t,r,u,m,v,x)}emplace(t,r,u,m,v,x,C){const M=4*t,O=8*t;return this.int16[M+0]=r,this.int16[M+1]=u,this.uint8[O+4]=m,this.uint8[O+5]=v,this.uint8[O+6]=x,this.uint8[O+7]=C,t}}te.prototype.bytesPerElement=8,Ot("StructArrayLayout2i4ub8",te);class ue extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const u=this.length;return this.resize(u+1),this.emplace(u,t,r)}emplace(t,r,u){const m=2*t;return this.float32[m+0]=r,this.float32[m+1]=u,t}}ue.prototype.bytesPerElement=8,Ot("StructArrayLayout2f8",ue);class he extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x,C,M,O,U){const G=this.length;return this.resize(G+1),this.emplace(G,t,r,u,m,v,x,C,M,O,U)}emplace(t,r,u,m,v,x,C,M,O,U,G){const X=10*t;return this.uint16[X+0]=r,this.uint16[X+1]=u,this.uint16[X+2]=m,this.uint16[X+3]=v,this.uint16[X+4]=x,this.uint16[X+5]=C,this.uint16[X+6]=M,this.uint16[X+7]=O,this.uint16[X+8]=U,this.uint16[X+9]=G,t}}he.prototype.bytesPerElement=20,Ot("StructArrayLayout10ui20",he);class pe extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x,C,M,O,U,G,X){const J=this.length;return this.resize(J+1),this.emplace(J,t,r,u,m,v,x,C,M,O,U,G,X)}emplace(t,r,u,m,v,x,C,M,O,U,G,X,J){const ie=12*t;return this.int16[ie+0]=r,this.int16[ie+1]=u,this.int16[ie+2]=m,this.int16[ie+3]=v,this.uint16[ie+4]=x,this.uint16[ie+5]=C,this.uint16[ie+6]=M,this.uint16[ie+7]=O,this.int16[ie+8]=U,this.int16[ie+9]=G,this.int16[ie+10]=X,this.int16[ie+11]=J,t}}pe.prototype.bytesPerElement=24,Ot("StructArrayLayout4i4ui4i24",pe);class ge extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,u)}emplace(t,r,u,m){const v=3*t;return this.float32[v+0]=r,this.float32[v+1]=u,this.float32[v+2]=m,t}}ge.prototype.bytesPerElement=12,Ot("StructArrayLayout3f12",ge);class ve extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}ve.prototype.bytesPerElement=4,Ot("StructArrayLayout1ul4",ve);class Se extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x,C,M,O){const U=this.length;return this.resize(U+1),this.emplace(U,t,r,u,m,v,x,C,M,O)}emplace(t,r,u,m,v,x,C,M,O,U){const G=10*t,X=5*t;return this.int16[G+0]=r,this.int16[G+1]=u,this.int16[G+2]=m,this.int16[G+3]=v,this.int16[G+4]=x,this.int16[G+5]=C,this.uint32[X+3]=M,this.uint16[G+8]=O,this.uint16[G+9]=U,t}}Se.prototype.bytesPerElement=20,Ot("StructArrayLayout6i1ul2ui20",Se);class me extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x){const C=this.length;return this.resize(C+1),this.emplace(C,t,r,u,m,v,x)}emplace(t,r,u,m,v,x,C){const M=6*t;return this.int16[M+0]=r,this.int16[M+1]=u,this.int16[M+2]=m,this.int16[M+3]=v,this.int16[M+4]=x,this.int16[M+5]=C,t}}me.prototype.bytesPerElement=12,Ot("StructArrayLayout2i2i2i12",me);class Ae extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,r,u,m,v)}emplace(t,r,u,m,v,x){const C=4*t,M=8*t;return this.float32[C+0]=r,this.float32[C+1]=u,this.float32[C+2]=m,this.int16[M+6]=v,this.int16[M+7]=x,t}}Ae.prototype.bytesPerElement=16,Ot("StructArrayLayout2f1f2i16",Ae);class Oe extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x){const C=this.length;return this.resize(C+1),this.emplace(C,t,r,u,m,v,x)}emplace(t,r,u,m,v,x,C){const M=16*t,O=4*t,U=8*t;return this.uint8[M+0]=r,this.uint8[M+1]=u,this.float32[O+1]=m,this.float32[O+2]=v,this.int16[U+6]=x,this.int16[U+7]=C,t}}Oe.prototype.bytesPerElement=16,Ot("StructArrayLayout2ub2f2i16",Oe);class qe extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,u)}emplace(t,r,u,m){const v=3*t;return this.uint16[v+0]=r,this.uint16[v+1]=u,this.uint16[v+2]=m,t}}qe.prototype.bytesPerElement=6,Ot("StructArrayLayout3ui6",qe);class ot extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x,C,M,O,U,G,X,J,ie,ce,ye,be){const Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,t,r,u,m,v,x,C,M,O,U,G,X,J,ie,ce,ye,be)}emplace(t,r,u,m,v,x,C,M,O,U,G,X,J,ie,ce,ye,be,Ue){const Te=24*t,Ve=12*t,et=48*t;return this.int16[Te+0]=r,this.int16[Te+1]=u,this.uint16[Te+2]=m,this.uint16[Te+3]=v,this.uint32[Ve+2]=x,this.uint32[Ve+3]=C,this.uint32[Ve+4]=M,this.uint16[Te+10]=O,this.uint16[Te+11]=U,this.uint16[Te+12]=G,this.float32[Ve+7]=X,this.float32[Ve+8]=J,this.uint8[et+36]=ie,this.uint8[et+37]=ce,this.uint8[et+38]=ye,this.uint32[Ve+10]=be,this.int16[Te+22]=Ue,t}}ot.prototype.bytesPerElement=48,Ot("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ot);class yt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u,m,v,x,C,M,O,U,G,X,J,ie,ce,ye,be,Ue,Te,Ve,et,dt,Dt,hn,Nt,Mt,Yt,Gt){const Vt=this.length;return this.resize(Vt+1),this.emplace(Vt,t,r,u,m,v,x,C,M,O,U,G,X,J,ie,ce,ye,be,Ue,Te,Ve,et,dt,Dt,hn,Nt,Mt,Yt,Gt)}emplace(t,r,u,m,v,x,C,M,O,U,G,X,J,ie,ce,ye,be,Ue,Te,Ve,et,dt,Dt,hn,Nt,Mt,Yt,Gt,Vt){const st=32*t,en=16*t;return this.int16[st+0]=r,this.int16[st+1]=u,this.int16[st+2]=m,this.int16[st+3]=v,this.int16[st+4]=x,this.int16[st+5]=C,this.int16[st+6]=M,this.int16[st+7]=O,this.uint16[st+8]=U,this.uint16[st+9]=G,this.uint16[st+10]=X,this.uint16[st+11]=J,this.uint16[st+12]=ie,this.uint16[st+13]=ce,this.uint16[st+14]=ye,this.uint16[st+15]=be,this.uint16[st+16]=Ue,this.uint16[st+17]=Te,this.uint16[st+18]=Ve,this.uint16[st+19]=et,this.uint16[st+20]=dt,this.uint16[st+21]=Dt,this.uint16[st+22]=hn,this.uint32[en+12]=Nt,this.float32[en+13]=Mt,this.float32[en+14]=Yt,this.uint16[st+30]=Gt,this.uint16[st+31]=Vt,t}}yt.prototype.bytesPerElement=64,Ot("StructArrayLayout8i15ui1ul2f2ui64",yt);class St extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}St.prototype.bytesPerElement=4,Ot("StructArrayLayout1f4",St);class Lt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,u)}emplace(t,r,u,m){const v=3*t;return this.uint16[6*t+0]=r,this.float32[v+1]=u,this.float32[v+2]=m,t}}Lt.prototype.bytesPerElement=12,Ot("StructArrayLayout1ui2f12",Lt);class Et extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,u){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,u)}emplace(t,r,u,m){const v=4*t;return this.uint32[2*t+0]=r,this.uint16[v+2]=u,this.uint16[v+3]=m,t}}Et.prototype.bytesPerElement=8,Ot("StructArrayLayout1ul2ui8",Et);class kt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const u=this.length;return this.resize(u+1),this.emplace(u,t,r)}emplace(t,r,u){const m=2*t;return this.uint16[m+0]=r,this.uint16[m+1]=u,t}}kt.prototype.bytesPerElement=4,Ot("StructArrayLayout2ui4",kt);class qt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}qt.prototype.bytesPerElement=2,Ot("StructArrayLayout1ui2",qt);class gn extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,u,m){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,u,m)}emplace(t,r,u,m,v){const x=4*t;return this.float32[x+0]=r,this.float32[x+1]=u,this.float32[x+2]=m,this.float32[x+3]=v,t}}gn.prototype.bytesPerElement=16,Ot("StructArrayLayout4f16",gn);class It extends p{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new F(this.anchorPointX,this.anchorPointY)}}It.prototype.size=20;class Ct extends Se{get(t){return new It(this,t)}}Ot("CollisionBoxArray",Ct);class mn extends p{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}mn.prototype.size=48;class li extends ot{get(t){return new mn(this,t)}}Ot("PlacedSymbolArray",li);class En extends p{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}En.prototype.size=64;class Pn extends yt{get(t){return new En(this,t)}}Ot("SymbolInstanceArray",Pn);class ci extends St{getoffsetX(t){return this.float32[1*t+0]}}Ot("GlyphOffsetArray",ci);class wr extends V{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ot("SymbolLineVertexArray",wr);class bs extends p{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}bs.prototype.size=12;class hi extends Lt{get(t){return new bs(this,t)}}Ot("TextAnchorOffsetArray",hi);class or extends p{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}or.prototype.size=8;class bi extends Et{get(t){return new or(this,t)}}Ot("FeatureIndexArray",bi);class Zi extends D{}class Pr extends D{}class ya extends D{}class is extends Z{}class _a extends te{}class Bo extends ue{}class ks extends he{}class $s extends pe{}class Va extends ge{}class Wr extends ve{}class Ss extends me{}class va extends Oe{}class Zs extends qe{}class Wi extends kt{}const Pi=P([{name:"a_pos",components:2,type:"Int16"}],4),{members:Mr}=Pi;class Ln{constructor(t=[]){this.segments=t}prepareSegment(t,r,u,m){let v=this.segments[this.segments.length-1];return t>Ln.MAX_VERTEX_ARRAY_LENGTH&&Bt(`Max vertices per segment is ${Ln.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!v||v.vertexLength+t>Ln.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==m)&&(v={vertexOffset:r.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},m!==void 0&&(v.sortKey=m),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,u,m){return new Ln([{vertexOffset:t,primitiveOffset:r,vertexLength:u,primitiveLength:m,vaos:{},sortKey:0}])}}function Es(n,t){return 256*(n=We(Math.floor(n),0,255))+We(Math.floor(t),0,255)}Ln.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ot("SegmentVector",Ln);const jo=P([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var xa={exports:{}},wc={exports:{}};wc.exports=function(n,t){var r,u,m,v,x,C,M,O;for(u=n.length-(r=3&n.length),m=t,x=3432918353,C=461845907,O=0;O<u;)M=255&n.charCodeAt(O)|(255&n.charCodeAt(++O))<<8|(255&n.charCodeAt(++O))<<16|(255&n.charCodeAt(++O))<<24,++O,m=27492+(65535&(v=5*(65535&(m=(m^=M=(65535&(M=(M=(65535&M)*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*C+(((M>>>16)*C&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(M=0,r){case 3:M^=(255&n.charCodeAt(O+2))<<16;case 2:M^=(255&n.charCodeAt(O+1))<<8;case 1:m^=M=(65535&(M=(M=(65535&(M^=255&n.charCodeAt(O)))*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*C+(((M>>>16)*C&65535)<<16)&4294967295}return m^=n.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0};var bc=wc.exports,zi={exports:{}};zi.exports=function(n,t){for(var r,u=n.length,m=t^u,v=0;u>=4;)r=1540483477*(65535&(r=255&n.charCodeAt(v)|(255&n.charCodeAt(++v))<<8|(255&n.charCodeAt(++v))<<16|(255&n.charCodeAt(++v))<<24))+((1540483477*(r>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),u-=4,++v;switch(u){case 3:m^=(255&n.charCodeAt(v+2))<<16;case 2:m^=(255&n.charCodeAt(v+1))<<8;case 1:m=1540483477*(65535&(m^=255&n.charCodeAt(v)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};var wa=bc,Gu=zi.exports;xa.exports=wa,xa.exports.murmur3=wa,xa.exports.murmur2=Gu;var Vl=W(xa.exports);class Vo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,u,m){this.ids.push(Ul(t)),this.positions.push(r,u,m)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Ul(t);let u=0,m=this.ids.length-1;for(;u<m;){const x=u+m>>1;this.ids[x]>=r?m=x:u=x+1}const v=[];for(;this.ids[u]===r;)v.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return v}static serialize(t,r){const u=new Float64Array(t.ids),m=new Uint32Array(t.positions);return Ua(u,m,0,u.length-1),r&&r.push(u.buffer,m.buffer),{ids:u,positions:m}}static deserialize(t){const r=new Vo;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Ul(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Vl(String(n))}function Ua(n,t,r,u){for(;r<u;){const m=n[r+u>>1];let v=r-1,x=u+1;for(;;){do v++;while(n[v]<m);do x--;while(n[x]>m);if(v>=x)break;fi(n,v,x),fi(t,3*v,3*x),fi(t,3*v+1,3*x+1),fi(t,3*v+2,3*x+2)}x-r<u-x?(Ua(n,t,r,x),r=x+1):(Ua(n,t,x+1,u),u=x)}}function fi(n,t,r){const u=n[t];n[t]=n[r],n[r]=u}Ot("FeaturePositionMap",Vo);class qi{constructor(t,r){this.gl=t.gl,this.location=r}}class lr extends qi{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class kc extends qi{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class $u extends qi{constructor(t,r){super(t,r),this.current=fn.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Sc=new Float32Array(16);function Jh(n){return[Es(255*n.r,255*n.g),Es(255*n.b,255*n.a)]}class br{constructor(t,r,u){this.value=t,this.uniformNames=r.map((m=>`u_${m}`)),this.type=u}setUniform(t,r,u){t.set(u.constantOr(this.value))}getBinding(t,r,u){return this.type==="color"?new $u(t,r):new lr(t,r)}}class ql{constructor(t,r){this.uniformNames=r.map((u=>`u_${u}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,u,m){const v=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&t.set(v)}getBinding(t,r,u){return u.substr(0,9)==="u_pattern"?new kc(t,r):new lr(t,r)}}class yo{constructor(t,r,u,m){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=r.map((v=>({name:`a_${v}`,type:"Float32",components:u==="color"?2:1,offset:0}))),this.paintVertexArray=new m}populatePaintArray(t,r,u,m,v){const x=this.paintVertexArray.length,C=this.expression.evaluate(new On(0),r,{},m,[],v);this.paintVertexArray.resize(t),this._setPaintValue(x,t,C)}updatePaintArray(t,r,u,m){const v=this.expression.evaluate({zoom:0},u,m);this._setPaintValue(t,r,v)}_setPaintValue(t,r,u){if(this.type==="color"){const m=Jh(u);for(let v=t;v<r;v++)this.paintVertexArray.emplace(v,m[0],m[1])}else{for(let m=t;m<r;m++)this.paintVertexArray.emplace(m,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ba{constructor(t,r,u,m,v,x){this.expression=t,this.uniformNames=r.map((C=>`u_${C}_t`)),this.type=u,this.useIntegerZoom=m,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=r.map((C=>({name:`a_${C}`,type:"Float32",components:u==="color"?4:2,offset:0}))),this.paintVertexArray=new x}populatePaintArray(t,r,u,m,v){const x=this.expression.evaluate(new On(this.zoom),r,{},m,[],v),C=this.expression.evaluate(new On(this.zoom+1),r,{},m,[],v),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,x,C)}updatePaintArray(t,r,u,m){const v=this.expression.evaluate({zoom:this.zoom},u,m),x=this.expression.evaluate({zoom:this.zoom+1},u,m);this._setPaintValue(t,r,v,x)}_setPaintValue(t,r,u,m){if(this.type==="color"){const v=Jh(u),x=Jh(m);for(let C=t;C<r;C++)this.paintVertexArray.emplace(C,v[0],v[1],x[0],x[1])}else{for(let v=t;v<r;v++)this.paintVertexArray.emplace(v,u,m);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(m))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const u=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,m=We(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(m)}getBinding(t,r,u){return new lr(t,r)}}class Yr{constructor(t,r,u,m,v,x){this.expression=t,this.type=r,this.useIntegerZoom=u,this.zoom=m,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(t,r,u){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(m,t,r.patterns&&r.patterns[this.layerId],u)}updatePaintArray(t,r,u,m,v){this._setPaintValues(t,r,u.patterns&&u.patterns[this.layerId],v)}_setPaintValues(t,r,u,m){if(!m||!u)return;const{min:v,mid:x,max:C}=u,M=m[v],O=m[x],U=m[C];if(M&&O&&U)for(let G=t;G<r;G++)this.zoomInPaintVertexArray.emplace(G,O.tl[0],O.tl[1],O.br[0],O.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],O.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(G,O.tl[0],O.tl[1],O.br[0],O.br[1],U.tl[0],U.tl[1],U.br[0],U.br[1],O.pixelRatio,U.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,jo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,jo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ka{constructor(t,r,u){this.binders={},this._buffers=[];const m=[];for(const v in t.paint._values){if(!u(v))continue;const x=t.paint.get(v);if(!(x instanceof ws&&ao(x.property.specification)))continue;const C=Qh(v,t.type),M=x.value,O=x.property.specification.type,U=x.property.useIntegerZoom,G=x.property.specification["property-type"],X=G==="cross-faded"||G==="cross-faded-data-driven";if(M.kind==="constant")this.binders[v]=X?new ql(M.value,C):new br(M.value,C,O),m.push(`/u_${v}`);else if(M.kind==="source"||X){const J=ah(v,O,"source");this.binders[v]=X?new Yr(M,O,U,r,J,t.id):new yo(M,C,O,J),m.push(`/a_${v}`)}else{const J=ah(v,O,"composite");this.binders[v]=new ba(M,C,O,U,r,J),m.push(`/z_${v}`)}}this.cacheKey=m.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof yo||r instanceof ba?r.maxValue:0}populatePaintArrays(t,r,u,m,v){for(const x in this.binders){const C=this.binders[x];(C instanceof yo||C instanceof ba||C instanceof Yr)&&C.populatePaintArray(t,r,u,m,v)}}setConstantPatternPositions(t,r){for(const u in this.binders){const m=this.binders[u];m instanceof ql&&m.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,u,m,v){let x=!1;for(const C in t){const M=r.getPositions(C);for(const O of M){const U=u.feature(O.index);for(const G in this.binders){const X=this.binders[G];if((X instanceof yo||X instanceof ba||X instanceof Yr)&&X.expression.isStateDependent===!0){const J=m.paint.get(G);X.expression=J.value,X.updatePaintArray(O.start,O.end,U,t[C],v),x=!0}}}}return x}defines(){const t=[];for(const r in this.binders){const u=this.binders[r];(u instanceof br||u instanceof ql)&&t.push(...u.uniformNames.map((m=>`#define HAS_UNIFORM_${m}`)))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const u=this.binders[r];if(u instanceof yo||u instanceof ba)for(let m=0;m<u.paintVertexAttributes.length;m++)t.push(u.paintVertexAttributes[m].name);else if(u instanceof Yr)for(let m=0;m<jo.members.length;m++)t.push(jo.members[m].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const u=this.binders[r];if(u instanceof br||u instanceof ql||u instanceof ba)for(const m of u.uniformNames)t.push(m)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const u=[];for(const m in this.binders){const v=this.binders[m];if(v instanceof br||v instanceof ql||v instanceof ba){for(const x of v.uniformNames)if(r[x]){const C=v.getBinding(t,r[x],x);u.push({name:x,property:m,binding:C})}}}return u}setUniforms(t,r,u,m){for(const{name:v,property:x,binding:C}of r)this.binders[x].setUniform(C,m,u.get(x),v)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const u=this.binders[r];if(t&&u instanceof Yr){const m=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(u instanceof yo||u instanceof ba)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(t){for(const r in this.binders){const u=this.binders[r];(u instanceof yo||u instanceof ba||u instanceof Yr)&&u.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof yo||r instanceof ba||r instanceof Yr)&&r.destroy()}}}class _o{constructor(t,r,u=(()=>!0)){this.programConfigurations={};for(const m of t)this.programConfigurations[m.id]=new ka(m,r,u);this.needsUpload=!1,this._featureMap=new Vo,this._bufferOffset=0}populatePaintArrays(t,r,u,m,v,x){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(t,r,m,v,x);r.id!==void 0&&this._featureMap.add(r.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,u,m){for(const v of u)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(t,this._featureMap,r,v,m)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Qh(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function ah(n,t,r){const u={color:{source:ue,composite:gn},number:{source:St,composite:ue}},m=(function(v){return{"line-pattern":{source:ks,composite:ks},"fill-pattern":{source:ks,composite:ks},"fill-extrusion-pattern":{source:ks,composite:ks}}[v]})(n);return m&&m[r]||u[t][r]}Ot("ConstantBinder",br),Ot("CrossFadedConstantBinder",ql),Ot("SourceExpressionBinder",yo),Ot("CrossFadedCompositeBinder",Yr),Ot("CompositeExpressionBinder",ba),Ot("ProgramConfiguration",ka,{omit:["_buffers"]}),Ot("ProgramConfigurationSet",_o);const Yi=8192,oh=Math.pow(2,14)-1,ef=-oh-1;function Gl(n){const t=Yi/n.extent,r=n.loadGeometry();for(let u=0;u<r.length;u++){const m=r[u];for(let v=0;v<m.length;v++){const x=m[v],C=Math.round(x.x*t),M=Math.round(x.y*t);x.x=We(C,ef,oh),x.y=We(M,ef,oh),(C<x.x||C>x.x+1||M<x.y||M>x.y+1)&&Bt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function $l(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?Gl(n):[]}}function Ec(n,t,r,u,m){n.emplaceBack(2*t+(u+1)/2,2*r+(m+1)/2)}class lh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Pr,this.indexArray=new Zs,this.segments=new Ln,this.programConfigurations=new _o(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,u){const m=this.layers[0],v=[];let x=null,C=!1;m.type==="circle"&&(x=m.layout.get("circle-sort-key"),C=!x.isConstant());for(const{feature:M,id:O,index:U,sourceLayerIndex:G}of t){const X=this.layers[0]._featureFilter.needGeometry,J=$l(M,X);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),J,u))continue;const ie=C?x.evaluate(J,{},u):void 0,ce={id:O,properties:M.properties,type:M.type,sourceLayerIndex:G,index:U,geometry:X?J.geometry:Gl(M),patterns:{},sortKey:ie};v.push(ce)}C&&v.sort(((M,O)=>M.sortKey-O.sortKey));for(const M of v){const{geometry:O,index:U,sourceLayerIndex:G}=M,X=t[U].feature;this.addFeature(M,O,U,u),r.featureIndex.insert(X,O,U,G,this.index)}}update(t,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Mr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,u,m){for(const v of r)for(const x of v){const C=x.x,M=x.y;if(C<0||C>=Yi||M<0||M>=Yi)continue;const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),U=O.vertexLength;Ec(this.layoutVertexArray,C,M,-1,-1),Ec(this.layoutVertexArray,C,M,1,-1),Ec(this.layoutVertexArray,C,M,1,1),Ec(this.layoutVertexArray,C,M,-1,1),this.indexArray.emplaceBack(U,U+1,U+2),this.indexArray.emplaceBack(U,U+3,U+2),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},m)}}function tf(n,t){for(let r=0;r<n.length;r++)if(_u(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(_u(n,t[r]))return!0;return!!Zu(n,t)}function Ic(n,t,r){return!!_u(n,t)||!!Tc(t,n,r)}function nf(n,t){if(n.length===1)return sf(t,n[0]);for(let r=0;r<t.length;r++){const u=t[r];for(let m=0;m<u.length;m++)if(_u(n,u[m]))return!0}for(let r=0;r<n.length;r++)if(sf(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(Zu(n,t[r]))return!0;return!1}function uh(n,t,r){if(n.length>1){if(Zu(n,t))return!0;for(let u=0;u<t.length;u++)if(Tc(t[u],n,r))return!0}for(let u=0;u<n.length;u++)if(Tc(n[u],t,r))return!0;return!1}function Zu(n,t){if(n.length===0||t.length===0)return!1;for(let r=0;r<n.length-1;r++){const u=n[r],m=n[r+1];for(let v=0;v<t.length-1;v++)if(Xf(u,m,t[v],t[v+1]))return!0}return!1}function Xf(n,t,r,u){return je(n,r,u)!==je(t,r,u)&&je(n,t,r)!==je(n,t,u)}function Tc(n,t,r){const u=r*r;if(t.length===1)return n.distSqr(t[0])<u;for(let m=1;m<t.length;m++)if(rf(n,t[m-1],t[m])<u)return!0;return!1}function rf(n,t,r){const u=t.distSqr(r);if(u===0)return n.distSqr(t);const m=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/u;return n.distSqr(m<0?t:m>1?r:r.sub(t)._mult(m)._add(t))}function sf(n,t){let r,u,m,v=!1;for(let x=0;x<n.length;x++){r=n[x];for(let C=0,M=r.length-1;C<r.length;M=C++)u=r[C],m=r[M],u.y>t.y!=m.y>t.y&&t.x<(m.x-u.x)*(t.y-u.y)/(m.y-u.y)+u.x&&(v=!v)}return v}function _u(n,t){let r=!1;for(let u=0,m=n.length-1;u<n.length;m=u++){const v=n[u],x=n[m];v.y>t.y!=x.y>t.y&&t.x<(x.x-v.x)*(t.y-v.y)/(x.y-v.y)+v.x&&(r=!r)}return r}function Wf(n,t,r){const u=r[0],m=r[2];if(n.x<u.x&&t.x<u.x||n.x>m.x&&t.x>m.x||n.y<u.y&&t.y<u.y||n.y>m.y&&t.y>m.y)return!1;const v=je(n,t,r[0]);return v!==je(n,t,r[1])||v!==je(n,t,r[2])||v!==je(n,t,r[3])}function vu(n,t,r){const u=t.paint.get(n).value;return u.kind==="constant"?u.value:r.programConfigurations.get(t.id).getMaxValue(n)}function Cc(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Pc(n,t,r,u,m){if(!t[0]&&!t[1])return n;const v=F.convert(t)._mult(m);r==="viewport"&&v._rotate(-u);const x=[];for(let C=0;C<n.length;C++)x.push(n[C].sub(v));return x}let af,Yf;Ot("CircleBucket",lh,{omit:["layers"]});var Kf={get paint(){return Yf=Yf||new _({"circle-radius":new sn(Ye.paint_circle["circle-radius"]),"circle-color":new sn(Ye.paint_circle["circle-color"]),"circle-blur":new sn(Ye.paint_circle["circle-blur"]),"circle-opacity":new sn(Ye.paint_circle["circle-opacity"]),"circle-translate":new Ft(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Ft(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ft(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ft(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new sn(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new sn(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new sn(Ye.paint_circle["circle-stroke-opacity"])})},get layout(){return af=af||new _({"circle-sort-key":new sn(Ye.layout_circle["circle-sort-key"])})}},rs=1e-6,Hu=typeof Float32Array<"u"?Float32Array:Array;function ch(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function of(n,t,r){var u=t[0],m=t[1],v=t[2],x=t[3],C=t[4],M=t[5],O=t[6],U=t[7],G=t[8],X=t[9],J=t[10],ie=t[11],ce=t[12],ye=t[13],be=t[14],Ue=t[15],Te=r[0],Ve=r[1],et=r[2],dt=r[3];return n[0]=Te*u+Ve*C+et*G+dt*ce,n[1]=Te*m+Ve*M+et*X+dt*ye,n[2]=Te*v+Ve*O+et*J+dt*be,n[3]=Te*x+Ve*U+et*ie+dt*Ue,n[4]=(Te=r[4])*u+(Ve=r[5])*C+(et=r[6])*G+(dt=r[7])*ce,n[5]=Te*m+Ve*M+et*X+dt*ye,n[6]=Te*v+Ve*O+et*J+dt*be,n[7]=Te*x+Ve*U+et*ie+dt*Ue,n[8]=(Te=r[8])*u+(Ve=r[9])*C+(et=r[10])*G+(dt=r[11])*ce,n[9]=Te*m+Ve*M+et*X+dt*ye,n[10]=Te*v+Ve*O+et*J+dt*be,n[11]=Te*x+Ve*U+et*ie+dt*Ue,n[12]=(Te=r[12])*u+(Ve=r[13])*C+(et=r[14])*G+(dt=r[15])*ce,n[13]=Te*m+Ve*M+et*X+dt*ye,n[14]=Te*v+Ve*O+et*J+dt*be,n[15]=Te*x+Ve*U+et*ie+dt*Ue,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Xu,hh=of;function fh(n,t,r){var u=t[0],m=t[1],v=t[2],x=t[3];return n[0]=r[0]*u+r[4]*m+r[8]*v+r[12]*x,n[1]=r[1]*u+r[5]*m+r[9]*v+r[13]*x,n[2]=r[2]*u+r[6]*m+r[10]*v+r[14]*x,n[3]=r[3]*u+r[7]*m+r[11]*v+r[15]*x,n}Xu=new Hu(4),Hu!=Float32Array&&(Xu[0]=0,Xu[1]=0,Xu[2]=0,Xu[3]=0);class lp extends o{constructor(t){super(t,Kf)}createBucket(t){return new lh(t)}queryRadius(t){const r=t;return vu("circle-radius",this,r)+vu("circle-stroke-width",this,r)+Cc(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,u,m,v,x,C,M){const O=Pc(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,C),U=this.paint.get("circle-radius").evaluate(r,u)+this.paint.get("circle-stroke-width").evaluate(r,u),G=this.paint.get("circle-pitch-alignment")==="map",X=G?O:(function(ie,ce){return ie.map((ye=>Jf(ye,ce)))})(O,M),J=G?U*C:U;for(const ie of m)for(const ce of ie){const ye=G?ce:Jf(ce,M);let be=J;const Ue=fh([],[ce.x,ce.y,0,1],M);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?be*=Ue[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(be*=x.cameraToCenterDistance/Ue[3]),Ic(X,ye,be))return!0}return!1}}function Jf(n,t){const r=fh([],[n.x,n.y,0,1],t);return new F(r[0]/r[3],r[1]/r[3])}class qa extends lh{}let dh;Ot("HeatmapBucket",qa,{omit:["layers"]});var ph={get paint(){return dh=dh||new _({"heatmap-radius":new sn(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new sn(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ft(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xc(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ft(Ye.paint_heatmap["heatmap-opacity"])})}};function mh(n,{width:t,height:r},u,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==t*r*u)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${t*r*u}`)}else m=new Uint8Array(t*r*u);return n.width=t,n.height=r,n.data=m,n}function lf(n,{width:t,height:r},u){if(t===n.width&&r===n.height)return;const m=mh({},{width:t,height:r},u);gh(n,m,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,r)},u),n.width=t,n.height=r,n.data=m.data}function gh(n,t,r,u,m,v){if(m.width===0||m.height===0)return t;if(m.width>n.width||m.height>n.height||r.x>n.width-m.width||r.y>n.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>t.width||m.height>t.height||u.x>t.width-m.width||u.y>t.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const x=n.data,C=t.data;if(x===C)throw new Error("srcData equals dstData, so image is already copied");for(let M=0;M<m.height;M++){const O=((r.y+M)*n.width+r.x)*v,U=((u.y+M)*t.width+u.x)*v;for(let G=0;G<m.width*v;G++)C[U+G]=x[O+G]}return t}class xu{constructor(t,r){mh(this,t,1,r)}resize(t){lf(this,t,1)}clone(){return new xu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,u,m,v){gh(t,r,u,m,v,1)}}class Or{constructor(t,r){mh(this,t,4,r)}resize(t){lf(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Or({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,u,m,v){gh(t,r,u,m,v,4)}}function yh(n){const t={},r=n.resolution||256,u=n.clips?n.clips.length:1,m=n.image||new Or({width:r,height:u});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const v=(x,C,M)=>{t[n.evaluationKey]=M;const O=n.expression.evaluate(t);m.data[x+C+0]=Math.floor(255*O.r/O.a),m.data[x+C+1]=Math.floor(255*O.g/O.a),m.data[x+C+2]=Math.floor(255*O.b/O.a),m.data[x+C+3]=Math.floor(255*O.a)};if(n.clips)for(let x=0,C=0;x<u;++x,C+=4*r)for(let M=0,O=0;M<r;M++,O+=4){const U=M/(r-1),{start:G,end:X}=n.clips[x];v(C,O,G*(1-U)+X*U)}else for(let x=0,C=0;x<r;x++,C+=4)v(0,C,x/(r-1));return m}Ot("AlphaImage",xu),Ot("RGBAImage",Or);const Mc="big-fb";class up extends o{createBucket(t){return new qa(t)}constructor(t){super(t,ph),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=yh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Mc)&&this.heatmapFbos.delete(Mc)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let uf;var Qf={get paint(){return uf=uf||new _({"hillshade-illumination-direction":new Ft(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ft(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ft(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ft(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ft(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ft(Ye.paint_hillshade["hillshade-accent-color"])})}};class ed extends o{constructor(t){super(t,Qf)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const td=P([{name:"a_pos",components:2,type:"Int16"}],4),{members:nd}=td;function id(n,t,r=2){const u=t&&t.length,m=u?t[0]*r:n.length;let v=Is(n,0,m,r,!0);const x=[];if(!v||v.next===v.prev)return x;let C,M,O;if(u&&(v=(function(U,G,X,J){const ie=[];for(let ce=0,ye=G.length;ce<ye;ce++){const be=Is(U,G[ce]*J,ce<ye-1?G[ce+1]*J:U.length,J,!1);be===be.next&&(be.steiner=!0),ie.push(ud(be))}ie.sort(cf);for(let ce=0;ce<ie.length;ce++)X=ld(ie[ce],X);return X})(n,t,v,r)),n.length>80*r){C=1/0,M=1/0;let U=-1/0,G=-1/0;for(let X=r;X<m;X+=r){const J=n[X],ie=n[X+1];J<C&&(C=J),ie<M&&(M=ie),J>U&&(U=J),ie>G&&(G=ie)}O=Math.max(U-C,G-M),O=O!==0?32767/O:0}return Wu(v,x,r,C,M,O,0),x}function Is(n,t,r,u,m){let v;if(m===(function(x,C,M,O){let U=0;for(let G=C,X=M-O;G<M;G+=O)U+=(x[X]-x[G])*(x[G+1]+x[X+1]),X=G;return U})(n,t,r,u)>0)for(let x=t;x<r;x+=u)v=Rc(x/u|0,n[x],n[x+1],v);else for(let x=r-u;x>=t;x-=u)v=Rc(x/u|0,n[x],n[x+1],v);return v&&Yu(v,v.next)&&(Sa(v),v=v.next),v}function ur(n,t){if(!n)return n;t||(t=n);let r,u=n;do if(r=!1,u.steiner||!Yu(u,u.next)&&Hi(u.prev,u,u.next)!==0)u=u.next;else{if(Sa(u),u=t=u.prev,u===u.next)break;r=!0}while(r||u!==t);return t}function Wu(n,t,r,u,m,v,x){if(!n)return;!x&&v&&(function(M,O,U,G){let X=M;do X.z===0&&(X.z=_h(X.x,X.y,O,U,G)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==M);X.prevZ.nextZ=null,X.prevZ=null,(function(J){let ie,ce=1;do{let ye,be=J;J=null;let Ue=null;for(ie=0;be;){ie++;let Te=be,Ve=0;for(let dt=0;dt<ce&&(Ve++,Te=Te.nextZ,Te);dt++);let et=ce;for(;Ve>0||et>0&&Te;)Ve!==0&&(et===0||!Te||be.z<=Te.z)?(ye=be,be=be.nextZ,Ve--):(ye=Te,Te=Te.nextZ,et--),Ue?Ue.nextZ=ye:J=ye,ye.prevZ=Ue,Ue=ye;be=Te}Ue.nextZ=null,ce*=2}while(ie>1)})(X)})(n,u,m,v);let C=n;for(;n.prev!==n.next;){const M=n.prev,O=n.next;if(v?sd(n,u,m,v):rd(n))t.push(M.i,n.i,O.i),Sa(n),n=O.next,C=O.next;else if((n=O)===C){x?x===1?Wu(n=ad(ur(n),t),t,r,u,m,v,2):x===2&&od(n,t,r,u,m,v):Wu(ur(n),t,r,u,m,v,1);break}}}function rd(n){const t=n.prev,r=n,u=n.next;if(Hi(t,r,u)>=0)return!1;const m=t.x,v=r.x,x=u.x,C=t.y,M=r.y,O=u.y,U=m<v?m<x?m:x:v<x?v:x,G=C<M?C<O?C:O:M<O?M:O,X=m>v?m>x?m:x:v>x?v:x,J=C>M?C>O?C:O:M>O?M:O;let ie=u.next;for(;ie!==t;){if(ie.x>=U&&ie.x<=X&&ie.y>=G&&ie.y<=J&&Zl(m,C,v,M,x,O,ie.x,ie.y)&&Hi(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function sd(n,t,r,u){const m=n.prev,v=n,x=n.next;if(Hi(m,v,x)>=0)return!1;const C=m.x,M=v.x,O=x.x,U=m.y,G=v.y,X=x.y,J=C<M?C<O?C:O:M<O?M:O,ie=U<G?U<X?U:X:G<X?G:X,ce=C>M?C>O?C:O:M>O?M:O,ye=U>G?U>X?U:X:G>X?G:X,be=_h(J,ie,t,r,u),Ue=_h(ce,ye,t,r,u);let Te=n.prevZ,Ve=n.nextZ;for(;Te&&Te.z>=be&&Ve&&Ve.z<=Ue;){if(Te.x>=J&&Te.x<=ce&&Te.y>=ie&&Te.y<=ye&&Te!==m&&Te!==x&&Zl(C,U,M,G,O,X,Te.x,Te.y)&&Hi(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,Ve.x>=J&&Ve.x<=ce&&Ve.y>=ie&&Ve.y<=ye&&Ve!==m&&Ve!==x&&Zl(C,U,M,G,O,X,Ve.x,Ve.y)&&Hi(Ve.prev,Ve,Ve.next)>=0))return!1;Ve=Ve.nextZ}for(;Te&&Te.z>=be;){if(Te.x>=J&&Te.x<=ce&&Te.y>=ie&&Te.y<=ye&&Te!==m&&Te!==x&&Zl(C,U,M,G,O,X,Te.x,Te.y)&&Hi(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;Ve&&Ve.z<=Ue;){if(Ve.x>=J&&Ve.x<=ce&&Ve.y>=ie&&Ve.y<=ye&&Ve!==m&&Ve!==x&&Zl(C,U,M,G,O,X,Ve.x,Ve.y)&&Hi(Ve.prev,Ve,Ve.next)>=0)return!1;Ve=Ve.nextZ}return!0}function ad(n,t){let r=n;do{const u=r.prev,m=r.next.next;!Yu(u,m)&&Ac(u,r,r.next,m)&&wu(u,m)&&wu(m,u)&&(t.push(u.i,r.i,m.i),Sa(r),Sa(r.next),r=n=m),r=r.next}while(r!==n);return ur(r)}function od(n,t,r,u,m,v){let x=n;do{let C=x.next.next;for(;C!==x.prev;){if(x.i!==C.i&&ff(x,C)){let M=df(x,C);return x=ur(x,x.next),M=ur(M,M.next),Wu(x,t,r,u,m,v,0),void Wu(M,t,r,u,m,v,0)}C=C.next}x=x.next}while(x!==n)}function cf(n,t){return n.x-t.x}function ld(n,t){const r=(function(m,v){let x=v;const C=m.x,M=m.y;let O,U=-1/0;do{if(M<=x.y&&M>=x.next.y&&x.next.y!==x.y){const ce=x.x+(M-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(ce<=C&&ce>U&&(U=ce,O=x.x<x.next.x?x:x.next,ce===C))return O}x=x.next}while(x!==v);if(!O)return null;const G=O,X=O.x,J=O.y;let ie=1/0;x=O;do{if(C>=x.x&&x.x>=X&&C!==x.x&&Zl(M<J?C:U,M,X,J,M<J?U:C,M,x.x,x.y)){const ce=Math.abs(M-x.y)/(C-x.x);wu(x,m)&&(ce<ie||ce===ie&&(x.x>O.x||x.x===O.x&&hf(O,x)))&&(O=x,ie=ce)}x=x.next}while(x!==G);return O})(n,t);if(!r)return t;const u=df(r,n);return ur(u,u.next),ur(r,r.next)}function hf(n,t){return Hi(n.prev,n,t.prev)<0&&Hi(t.next,n,n.next)<0}function _h(n,t,r,u,m){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*m|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-u)*m|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ud(n){let t=n,r=n;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==n);return r}function Zl(n,t,r,u,m,v,x,C){return(m-x)*(t-C)>=(n-x)*(v-C)&&(n-x)*(u-C)>=(r-x)*(t-C)&&(r-x)*(v-C)>=(m-x)*(u-C)}function ff(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!(function(r,u){let m=r;do{if(m.i!==r.i&&m.next.i!==r.i&&m.i!==u.i&&m.next.i!==u.i&&Ac(m,m.next,r,u))return!0;m=m.next}while(m!==r);return!1})(n,t)&&(wu(n,t)&&wu(t,n)&&(function(r,u){let m=r,v=!1;const x=(r.x+u.x)/2,C=(r.y+u.y)/2;do m.y>C!=m.next.y>C&&m.next.y!==m.y&&x<(m.next.x-m.x)*(C-m.y)/(m.next.y-m.y)+m.x&&(v=!v),m=m.next;while(m!==r);return v})(n,t)&&(Hi(n.prev,n,t.prev)||Hi(n,t.prev,t))||Yu(n,t)&&Hi(n.prev,n,n.next)>0&&Hi(t.prev,t,t.next)>0)}function Hi(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function Yu(n,t){return n.x===t.x&&n.y===t.y}function Ac(n,t,r,u){const m=Lc(Hi(n,t,r)),v=Lc(Hi(n,t,u)),x=Lc(Hi(r,u,n)),C=Lc(Hi(r,u,t));return m!==v&&x!==C||!(m!==0||!vh(n,r,t))||!(v!==0||!vh(n,u,t))||!(x!==0||!vh(r,n,u))||!(C!==0||!vh(r,t,u))}function vh(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function Lc(n){return n>0?1:n<0?-1:0}function wu(n,t){return Hi(n.prev,n,n.next)<0?Hi(n,t,n.next)>=0&&Hi(n,n.prev,t)>=0:Hi(n,t,n.prev)<0||Hi(n,n.next,t)<0}function df(n,t){const r=pf(n.i,n.x,n.y),u=pf(t.i,t.x,t.y),m=n.next,v=t.prev;return n.next=t,t.prev=n,r.next=m,m.prev=r,u.next=r,r.prev=u,v.next=u,u.prev=v,u}function Rc(n,t,r,u){const m=pf(n,t,r);return u?(m.next=u.next,m.prev=u,u.next.prev=m,u.next=m):(m.prev=m,m.next=m),m}function Sa(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function pf(n,t,r){return{i:n,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function xh(n,t,r){const u=r.patternDependencies;let m=!1;for(const v of t){const x=v.paint.get(`${n}-pattern`);x.isConstant()||(m=!0);const C=x.constantOr(null);C&&(m=!0,u[C.to]=!0,u[C.from]=!0)}return m}function Nc(n,t,r,u,m){const v=m.patternDependencies;for(const x of t){const C=x.paint.get(`${n}-pattern`).value;if(C.kind!=="constant"){let M=C.evaluate({zoom:u-1},r,{},m.availableImages),O=C.evaluate({zoom:u},r,{},m.availableImages),U=C.evaluate({zoom:u+1},r,{},m.availableImages);M=M&&M.name?M.name:M,O=O&&O.name?O.name:O,U=U&&U.name?U.name:U,v[M]=!0,v[O]=!0,v[U]=!0,r.patterns[x.id]={min:M,mid:O,max:U}}}return r}class wh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ya,this.indexArray=new Zs,this.indexArray2=new Wi,this.programConfigurations=new _o(t.layers,t.zoom),this.segments=new Ln,this.segments2=new Ln,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,u){this.hasPattern=xh("fill",this.layers,r);const m=this.layers[0].layout.get("fill-sort-key"),v=!m.isConstant(),x=[];for(const{feature:C,id:M,index:O,sourceLayerIndex:U}of t){const G=this.layers[0]._featureFilter.needGeometry,X=$l(C,G);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),X,u))continue;const J=v?m.evaluate(X,{},u,r.availableImages):void 0,ie={id:M,properties:C.properties,type:C.type,sourceLayerIndex:U,index:O,geometry:G?X.geometry:Gl(C),patterns:{},sortKey:J};x.push(ie)}v&&x.sort(((C,M)=>C.sortKey-M.sortKey));for(const C of x){const{geometry:M,index:O,sourceLayerIndex:U}=C;if(this.hasPattern){const G=Nc("fill",this.layers,C,this.zoom,r);this.patternFeatures.push(G)}else this.addFeature(C,M,O,u,{});r.featureIndex.insert(t[O].feature,M,O,U,this.index)}}update(t,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u)}addFeatures(t,r,u){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,nd),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,u,m,v){for(const x of No(r,500)){let C=0;for(const J of x)C+=J.length;const M=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray),O=M.vertexLength,U=[],G=[];for(const J of x){if(J.length===0)continue;J!==x[0]&&G.push(U.length/2);const ie=this.segments2.prepareSegment(J.length,this.layoutVertexArray,this.indexArray2),ce=ie.vertexLength;this.layoutVertexArray.emplaceBack(J[0].x,J[0].y),this.indexArray2.emplaceBack(ce+J.length-1,ce),U.push(J[0].x),U.push(J[0].y);for(let ye=1;ye<J.length;ye++)this.layoutVertexArray.emplaceBack(J[ye].x,J[ye].y),this.indexArray2.emplaceBack(ce+ye-1,ce+ye),U.push(J[ye].x),U.push(J[ye].y);ie.vertexLength+=J.length,ie.primitiveLength+=J.length}const X=id(U,G);for(let J=0;J<X.length;J+=3)this.indexArray.emplaceBack(O+X[J],O+X[J+1],O+X[J+2]);M.vertexLength+=C,M.primitiveLength+=X.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,v,m)}}let mf,Ku;Ot("FillBucket",wh,{omit:["layers","patternFeatures"]});var ss={get paint(){return Ku=Ku||new _({"fill-antialias":new Ft(Ye.paint_fill["fill-antialias"]),"fill-opacity":new sn(Ye.paint_fill["fill-opacity"]),"fill-color":new sn(Ye.paint_fill["fill-color"]),"fill-outline-color":new sn(Ye.paint_fill["fill-outline-color"]),"fill-translate":new Ft(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Ft(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new jl(Ye.paint_fill["fill-pattern"])})},get layout(){return mf=mf||new _({"fill-sort-key":new sn(Ye.layout_fill["fill-sort-key"])})}};class cp extends o{constructor(t){super(t,ss)}recalculate(t,r){super.recalculate(t,r);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new wh(t)}queryRadius(){return Cc(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,u,m,v,x,C){return nf(Pc(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,C),m)}isTileClipped(){return!0}}const hp=P([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),bh=P([{name:"a_centroid",components:2,type:"Int16"}],4),{members:as}=hp;var Hl={},Jt=ee,bu=Xl;function Xl(n,t,r,u,m){this.properties={},this.extent=r,this.type=0,this._pbf=n,this._geometry=-1,this._keys=u,this._values=m,n.readFields(cd,this,t)}function cd(n,t,r){n==1?t.id=r.readVarint():n==2?(function(u,m){for(var v=u.readVarint()+u.pos;u.pos<v;){var x=m._keys[u.readVarint()],C=m._values[u.readVarint()];m.properties[x]=C}})(r,t):n==3?t.type=r.readVarint():n==4&&(t._geometry=r.pos)}function fp(n){for(var t,r,u=0,m=0,v=n.length,x=v-1;m<v;x=m++)u+=((r=n[x]).x-(t=n[m]).x)*(t.y+r.y);return u}Xl.types=["Unknown","Point","LineString","Polygon"],Xl.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,r=n.readVarint()+n.pos,u=1,m=0,v=0,x=0,C=[];n.pos<r;){if(m<=0){var M=n.readVarint();u=7&M,m=M>>3}if(m--,u===1||u===2)v+=n.readSVarint(),x+=n.readSVarint(),u===1&&(t&&C.push(t),t=[]),t.push(new Jt(v,x));else{if(u!==7)throw new Error("unknown command "+u);t&&t.push(t[0].clone())}}return t&&C.push(t),C},Xl.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,r=1,u=0,m=0,v=0,x=1/0,C=-1/0,M=1/0,O=-1/0;n.pos<t;){if(u<=0){var U=n.readVarint();r=7&U,u=U>>3}if(u--,r===1||r===2)(m+=n.readSVarint())<x&&(x=m),m>C&&(C=m),(v+=n.readSVarint())<M&&(M=v),v>O&&(O=v);else if(r!==7)throw new Error("unknown command "+r)}return[x,M,C,O]},Xl.prototype.toGeoJSON=function(n,t,r){var u,m,v=this.extent*Math.pow(2,r),x=this.extent*n,C=this.extent*t,M=this.loadGeometry(),O=Xl.types[this.type];function U(J){for(var ie=0;ie<J.length;ie++){var ce=J[ie];J[ie]=[360*(ce.x+x)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(ce.y+C)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(u=0;u<M.length;u++)G[u]=M[u][0];U(M=G);break;case 2:for(u=0;u<M.length;u++)U(M[u]);break;case 3:for(M=(function(J){var ie=J.length;if(ie<=1)return[J];for(var ce,ye,be=[],Ue=0;Ue<ie;Ue++){var Te=fp(J[Ue]);Te!==0&&(ye===void 0&&(ye=Te<0),ye===Te<0?(ce&&be.push(ce),ce=[J[Ue]]):ce.push(J[Ue]))}return ce&&be.push(ce),be})(M),u=0;u<M.length;u++)for(m=0;m<M[u].length;m++)U(M[u][m])}M.length===1?M=M[0]:O="Multi"+O;var X={type:"Feature",geometry:{type:O,coordinates:M},properties:this.properties};return"id"in this&&(X.id=this.id),X};var zc=bu,Dc=kh;function kh(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(hd,this,t),this.length=this._features.length}function hd(n,t,r){n===15?t.version=r.readVarint():n===1?t.name=r.readString():n===5?t.extent=r.readVarint():n===2?t._features.push(r.pos):n===3?t._keys.push(r.readString()):n===4&&t._values.push((function(u){for(var m=null,v=u.readVarint()+u.pos;u.pos<v;){var x=u.readVarint()>>3;m=x===1?u.readString():x===2?u.readFloat():x===3?u.readDouble():x===4?u.readVarint64():x===5?u.readVarint():x===6?u.readSVarint():x===7?u.readBoolean():null}return m})(r))}kh.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new zc(this._pbf,t,this.extent,this._keys,this._values)};var fd=Dc;function dd(n,t,r){if(n===3){var u=new fd(r,r.readVarint()+r.pos);u.length&&(t[u.name]=u)}}Hl.VectorTile=function(n,t){this.layers=n.readFields(dd,{},t)},Hl.VectorTileFeature=bu,Hl.VectorTileLayer=Dc;const gf=Hl.VectorTileFeature.types,Oc=Math.pow(2,13);function cr(n,t,r,u,m,v,x,C){n.emplaceBack(t,r,2*Math.floor(u*Oc)+x,m*Oc*2,v*Oc*2,Math.round(C))}class Ea{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new is,this.centroidVertexArray=new Zi,this.indexArray=new Zs,this.programConfigurations=new _o(t.layers,t.zoom),this.segments=new Ln,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,u){this.features=[],this.hasPattern=xh("fill-extrusion",this.layers,r);for(const{feature:m,id:v,index:x,sourceLayerIndex:C}of t){const M=this.layers[0]._featureFilter.needGeometry,O=$l(m,M);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),O,u))continue;const U={id:v,sourceLayerIndex:C,index:x,geometry:M?O.geometry:Gl(m),properties:m.properties,type:m.type,patterns:{}};this.hasPattern?this.features.push(Nc("fill-extrusion",this.layers,U,this.zoom,r)):this.addFeature(U,U.geometry,x,u,{}),r.featureIndex.insert(m,U.geometry,x,C,this.index,!0)}}addFeatures(t,r,u){for(const m of this.features){const{geometry:v}=m;this.addFeature(m,v,m.index,r,u)}}update(t,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,as),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,bh.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,u,m,v){for(const x of No(r,500)){const C={x:0,y:0,vertexCount:0};let M=0;for(const ie of x)M+=ie.length;let O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ie of x){if(ie.length===0||pd(ie))continue;let ce=0;for(let ye=0;ye<ie.length;ye++){const be=ie[ye];if(ye>=1){const Ue=ie[ye-1];if(!Wl(be,Ue)){O.vertexLength+4>Ln.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Te=be.sub(Ue)._perp()._unit(),Ve=Ue.dist(be);ce+Ve>32768&&(ce=0),cr(this.layoutVertexArray,be.x,be.y,Te.x,Te.y,0,0,ce),cr(this.layoutVertexArray,be.x,be.y,Te.x,Te.y,0,1,ce),C.x+=2*be.x,C.y+=2*be.y,C.vertexCount+=2,ce+=Ve,cr(this.layoutVertexArray,Ue.x,Ue.y,Te.x,Te.y,0,0,ce),cr(this.layoutVertexArray,Ue.x,Ue.y,Te.x,Te.y,0,1,ce),C.x+=2*Ue.x,C.y+=2*Ue.y,C.vertexCount+=2;const et=O.vertexLength;this.indexArray.emplaceBack(et,et+2,et+1),this.indexArray.emplaceBack(et+1,et+2,et+3),O.vertexLength+=4,O.primitiveLength+=2}}}}if(O.vertexLength+M>Ln.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),gf[t.type]!=="Polygon")continue;const U=[],G=[],X=O.vertexLength;for(const ie of x)if(ie.length!==0){ie!==x[0]&&G.push(U.length/2);for(let ce=0;ce<ie.length;ce++){const ye=ie[ce];cr(this.layoutVertexArray,ye.x,ye.y,0,0,1,1,0),C.x+=ye.x,C.y+=ye.y,C.vertexCount+=1,U.push(ye.x),U.push(ye.y)}}const J=id(U,G);for(let ie=0;ie<J.length;ie+=3)this.indexArray.emplaceBack(X+J[ie],X+J[ie+2],X+J[ie+1]);O.primitiveLength+=J.length/3,O.vertexLength+=M;for(let ie=0;ie<C.vertexCount;ie++){const ce=Math.floor(C.x/C.vertexCount),ye=Math.floor(C.y/C.vertexCount);this.centroidVertexArray.emplaceBack(ce,ye)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,v,m)}}function Wl(n,t){return n.x===t.x&&(n.x<0||n.x>Yi)||n.y===t.y&&(n.y<0||n.y>Yi)}function pd(n){return n.every((t=>t.x<0))||n.every((t=>t.x>Yi))||n.every((t=>t.y<0))||n.every((t=>t.y>Yi))}let yf;Ot("FillExtrusionBucket",Ea,{omit:["layers","features"]});var vo={get paint(){return yf=yf||new _({"fill-extrusion-opacity":new Ft(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new sn(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ft(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ft(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new jl(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new sn(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new sn(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ft(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class md extends o{constructor(t){super(t,vo)}createBucket(t){return new Ea(t)}queryRadius(){return Cc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,u,m,v,x,C,M){const O=Pc(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,C),U=this.paint.get("fill-extrusion-height").evaluate(r,u),G=this.paint.get("fill-extrusion-base").evaluate(r,u),X=(function(ie,ce,ye,be){const Ue=[];for(const Te of ie){const Ve=[Te.x,Te.y,0,1];fh(Ve,Ve,ce),Ue.push(new F(Ve[0]/Ve[3],Ve[1]/Ve[3]))}return Ue})(O,M),J=(function(ie,ce,ye,be){const Ue=[],Te=[],Ve=be[8]*ce,et=be[9]*ce,dt=be[10]*ce,Dt=be[11]*ce,hn=be[8]*ye,Nt=be[9]*ye,Mt=be[10]*ye,Yt=be[11]*ye;for(const Gt of ie){const Vt=[],st=[];for(const en of Gt){const Wt=en.x,wn=en.y,ki=be[0]*Wt+be[4]*wn+be[12],_i=be[1]*Wt+be[5]*wn+be[13],Fr=be[2]*Wt+be[6]*wn+be[14],Go=be[3]*Wt+be[7]*wn+be[15],us=Fr+dt,Br=Go+Dt,Js=ki+hn,Qs=_i+Nt,ea=Fr+Mt,nr=Go+Yt,jr=new F((ki+Ve)/Br,(_i+et)/Br);jr.z=us/Br,Vt.push(jr);const Ps=new F(Js/nr,Qs/nr);Ps.z=ea/nr,st.push(Ps)}Ue.push(Vt),Te.push(st)}return[Ue,Te]})(m,G,U,M);return(function(ie,ce,ye){let be=1/0;nf(ye,ce)&&(be=gd(ye,ce[0]));for(let Ue=0;Ue<ce.length;Ue++){const Te=ce[Ue],Ve=ie[Ue];for(let et=0;et<Te.length-1;et++){const dt=Te[et],Dt=[dt,Te[et+1],Ve[et+1],Ve[et],dt];tf(ye,Dt)&&(be=Math.min(be,gd(ye,Dt)))}}return be!==1/0&&be})(J[0],J[1],X)}}function Hs(n,t){return n.x*t.x+n.y*t.y}function gd(n,t){if(n.length===1){let r=0;const u=t[r++];let m;for(;!m||u.equals(m);)if(m=t[r++],!m)return 1/0;for(;r<t.length;r++){const v=t[r],x=n[0],C=m.sub(u),M=v.sub(u),O=x.sub(u),U=Hs(C,C),G=Hs(C,M),X=Hs(M,M),J=Hs(O,C),ie=Hs(O,M),ce=U*X-G*G,ye=(X*J-G*ie)/ce,be=(U*ie-G*J)/ce,Ue=u.z*(1-ye-be)+m.z*ye+v.z*be;if(isFinite(Ue))return Ue}return 1/0}{let r=1/0;for(const u of t)r=Math.min(r,u.z);return r}}const yd=P([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:_d}=yd,vd=P([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:xd}=vd,dp=Hl.VectorTileFeature.types,Sh=Math.cos(Math.PI/180*37.5),Eh=Math.pow(2,14)/.5;class Xs{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new _a,this.layoutVertexArray2=new Bo,this.indexArray=new Zs,this.programConfigurations=new _o(t.layers,t.zoom),this.segments=new Ln,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,u){this.hasPattern=xh("line",this.layers,r);const m=this.layers[0].layout.get("line-sort-key"),v=!m.isConstant(),x=[];for(const{feature:C,id:M,index:O,sourceLayerIndex:U}of t){const G=this.layers[0]._featureFilter.needGeometry,X=$l(C,G);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),X,u))continue;const J=v?m.evaluate(X,{},u):void 0,ie={id:M,properties:C.properties,type:C.type,sourceLayerIndex:U,index:O,geometry:G?X.geometry:Gl(C),patterns:{},sortKey:J};x.push(ie)}v&&x.sort(((C,M)=>C.sortKey-M.sortKey));for(const C of x){const{geometry:M,index:O,sourceLayerIndex:U}=C;if(this.hasPattern){const G=Nc("line",this.layers,C,this.zoom,r);this.patternFeatures.push(G)}else this.addFeature(C,M,O,u,{});r.featureIndex.insert(t[O].feature,M,O,U,this.index)}}update(t,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,u)}addFeatures(t,r,u){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,xd)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_d),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,u,m,v){const x=this.layers[0].layout,C=x.get("line-join").evaluate(t,{}),M=x.get("line-cap"),O=x.get("line-miter-limit"),U=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const G of r)this.addLine(G,t,C,M,O,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,v,m)}addLine(t,r,u,m,v,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<t.length-1;be++)this.totalDistance+=t[be].dist(t[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C=dp[r.type]==="Polygon";let M=t.length;for(;M>=2&&t[M-1].equals(t[M-2]);)M--;let O=0;for(;O<M-1&&t[O].equals(t[O+1]);)O++;if(M<(C?3:2))return;u==="bevel"&&(v=1.05);const U=this.overscaling<=16?15*Yi/(512*this.overscaling):0,G=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let X,J,ie,ce,ye;this.e1=this.e2=-1,C&&(X=t[M-2],ye=t[O].sub(X)._unit()._perp());for(let be=O;be<M;be++){if(ie=be===M-1?C?t[O+1]:void 0:t[be+1],ie&&t[be].equals(ie))continue;ye&&(ce=ye),X&&(J=X),X=t[be],ye=ie?ie.sub(X)._unit()._perp():ce,ce=ce||ye;let Ue=ce.add(ye);Ue.x===0&&Ue.y===0||Ue._unit();const Te=ce.x*ye.x+ce.y*ye.y,Ve=Ue.x*ye.x+Ue.y*ye.y,et=Ve!==0?1/Ve:1/0,dt=2*Math.sqrt(2-2*Ve),Dt=Ve<Sh&&J&&ie,hn=ce.x*ye.y-ce.y*ye.x>0;if(Dt&&be>O){const Yt=X.dist(J);if(Yt>2*U){const Gt=X.sub(X.sub(J)._mult(U/Yt)._round());this.updateDistance(J,Gt),this.addCurrentVertex(Gt,ce,0,0,G),J=Gt}}const Nt=J&&ie;let Mt=Nt?u:C?"butt":m;if(Nt&&Mt==="round"&&(et<x?Mt="miter":et<=2&&(Mt="fakeround")),Mt==="miter"&&et>v&&(Mt="bevel"),Mt==="bevel"&&(et>2&&(Mt="flipbevel"),et<v&&(Mt="miter")),J&&this.updateDistance(J,X),Mt==="miter")Ue._mult(et),this.addCurrentVertex(X,Ue,0,0,G);else if(Mt==="flipbevel"){if(et>100)Ue=ye.mult(-1);else{const Yt=et*ce.add(ye).mag()/ce.sub(ye).mag();Ue._perp()._mult(Yt*(hn?-1:1))}this.addCurrentVertex(X,Ue,0,0,G),this.addCurrentVertex(X,Ue.mult(-1),0,0,G)}else if(Mt==="bevel"||Mt==="fakeround"){const Yt=-Math.sqrt(et*et-1),Gt=hn?Yt:0,Vt=hn?0:Yt;if(J&&this.addCurrentVertex(X,ce,Gt,Vt,G),Mt==="fakeround"){const st=Math.round(180*dt/Math.PI/20);for(let en=1;en<st;en++){let Wt=en/st;if(Wt!==.5){const ki=Wt-.5;Wt+=Wt*ki*(Wt-1)*((1.0904+Te*(Te*(3.55645-1.43519*Te)-3.2452))*ki*ki+(.848013+Te*(.215638*Te-1.06021)))}const wn=ye.sub(ce)._mult(Wt)._add(ce)._unit()._mult(hn?-1:1);this.addHalfVertex(X,wn.x,wn.y,!1,hn,0,G)}}ie&&this.addCurrentVertex(X,ye,-Gt,-Vt,G)}else if(Mt==="butt")this.addCurrentVertex(X,Ue,0,0,G);else if(Mt==="square"){const Yt=J?1:-1;this.addCurrentVertex(X,Ue,Yt,Yt,G)}else Mt==="round"&&(J&&(this.addCurrentVertex(X,ce,0,0,G),this.addCurrentVertex(X,ce,1,1,G,!0)),ie&&(this.addCurrentVertex(X,ye,-1,-1,G,!0),this.addCurrentVertex(X,ye,0,0,G)));if(Dt&&be<M-1){const Yt=X.dist(ie);if(Yt>2*U){const Gt=X.add(ie.sub(X)._mult(U/Yt)._round());this.updateDistance(X,Gt),this.addCurrentVertex(Gt,ye,0,0,G),X=Gt}}}}addCurrentVertex(t,r,u,m,v,x=!1){const C=r.y*m-r.x,M=-r.y-r.x*m;this.addHalfVertex(t,r.x+r.y*u,r.y-r.x*u,x,!1,u,v),this.addHalfVertex(t,C,M,x,!0,-m,v),this.distance>Eh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,u,m,v,x))}addHalfVertex({x:t,y:r},u,m,v,x,C,M){const O=.5*(this.lineClips?this.scaledDistance*(Eh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(v?1:0),(r<<1)+(x?1:0),Math.round(63*u)+128,Math.round(63*m)+128,1+(C===0?0:C<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const U=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,U),M.primitiveLength++),x?this.e2=U:this.e1=U}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let ni,Ar;Ot("LineBucket",Xs,{omit:["layers","patternFeatures"]});var hr={get paint(){return Ar=Ar||new _({"line-opacity":new sn(Ye.paint_line["line-opacity"]),"line-color":new sn(Ye.paint_line["line-color"]),"line-translate":new Ft(Ye.paint_line["line-translate"]),"line-translate-anchor":new Ft(Ye.paint_line["line-translate-anchor"]),"line-width":new sn(Ye.paint_line["line-width"]),"line-gap-width":new sn(Ye.paint_line["line-gap-width"]),"line-offset":new sn(Ye.paint_line["line-offset"]),"line-blur":new sn(Ye.paint_line["line-blur"]),"line-dasharray":new yu(Ye.paint_line["line-dasharray"]),"line-pattern":new jl(Ye.paint_line["line-pattern"]),"line-gradient":new xc(Ye.paint_line["line-gradient"])})},get layout(){return ni=ni||new _({"line-cap":new Ft(Ye.layout_line["line-cap"]),"line-join":new sn(Ye.layout_line["line-join"]),"line-miter-limit":new Ft(Ye.layout_line["line-miter-limit"]),"line-round-limit":new Ft(Ye.layout_line["line-round-limit"]),"line-sort-key":new sn(Ye.layout_line["line-sort-key"])})}};class Kr extends sn{possiblyEvaluate(t,r){return r=new On(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,u,m){return r=at({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,u,m)}}let os;class Ju extends o{constructor(t){super(t,hr),this.gradientVersion=0,os||(os=new Kr(hr.paint.properties["line-width"].specification),os.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!(function(u){return u._styleExpression!==void 0})(r)&&r._styleExpression.expression instanceof Ka,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=os.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Xs(t)}queryRadius(t){const r=t,u=kr(vu("line-width",this,r),vu("line-gap-width",this,r)),m=vu("line-offset",this,r);return u/2+Math.abs(m)+Cc(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,u,m,v,x,C){const M=Pc(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,C),O=C/2*kr(this.paint.get("line-width").evaluate(r,u),this.paint.get("line-gap-width").evaluate(r,u)),U=this.paint.get("line-offset").evaluate(r,u);return U&&(m=(function(G,X){const J=[];for(let ie=0;ie<G.length;ie++){const ce=G[ie],ye=[];for(let be=0;be<ce.length;be++){const Ue=ce[be-1],Te=ce[be],Ve=ce[be+1],et=be===0?new F(0,0):Te.sub(Ue)._unit()._perp(),dt=be===ce.length-1?new F(0,0):Ve.sub(Te)._unit()._perp(),Dt=et._add(dt)._unit(),hn=Dt.x*dt.x+Dt.y*dt.y;hn!==0&&Dt._mult(1/hn),ye.push(Dt._mult(X)._add(Te))}J.push(ye)}return J})(m,U*C)),(function(G,X,J){for(let ie=0;ie<X.length;ie++){const ce=X[ie];if(G.length>=3){for(let ye=0;ye<ce.length;ye++)if(_u(G,ce[ye]))return!0}if(uh(G,ce,J))return!0}return!1})(M,m,O)}isTileClipped(){return!0}}function kr(n,t){return t>0?t+2*n:n}const Fc=P([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ku=P([{name:"a_projected_pos",components:3,type:"Float32"}],4);P([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ih=P([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);P([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Th=P([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Bc=P([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ws(n,t,r){return n.sections.forEach((u=>{u.text=(function(m,v,x){const C=v.layout.get("text-transform").evaluate(x,{});return C==="uppercase"?m=m.toLocaleUpperCase():C==="lowercase"&&(m=m.toLocaleLowerCase()),ui.applyArabicShaping&&(m=ui.applyArabicShaping(m)),m})(u.text,t,r)})),n}P([{name:"triangle",components:3,type:"Uint16"}]),P([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),P([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),P([{type:"Float32",name:"offsetX"}]),P([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),P([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Su={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Di=24,Uo=$n,jc=function(n,t,r,u,m){var v,x,C=8*m-u-1,M=(1<<C)-1,O=M>>1,U=-7,G=m-1,X=-1,J=n[t+G];for(G+=X,v=J&(1<<-U)-1,J>>=-U,U+=C;U>0;v=256*v+n[t+G],G+=X,U-=8);for(x=v&(1<<-U)-1,v>>=-U,U+=u;U>0;x=256*x+n[t+G],G+=X,U-=8);if(v===0)v=1-O;else{if(v===M)return x?NaN:1/0*(J?-1:1);x+=Math.pow(2,u),v-=O}return(J?-1:1)*x*Math.pow(2,v-u)},Ch=function(n,t,r,u,m,v){var x,C,M,O=8*v-m-1,U=(1<<O)-1,G=U>>1,X=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,J=0,ie=1,ce=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(C=isNaN(t)?1:0,x=U):(x=Math.floor(Math.log(t)/Math.LN2),t*(M=Math.pow(2,-x))<1&&(x--,M*=2),(t+=x+G>=1?X/M:X*Math.pow(2,1-G))*M>=2&&(x++,M/=2),x+G>=U?(C=0,x=U):x+G>=1?(C=(t*M-1)*Math.pow(2,m),x+=G):(C=t*Math.pow(2,G-1)*Math.pow(2,m),x=0));m>=8;n[r+J]=255&C,J+=ie,C/=256,m-=8);for(x=x<<m|C,O+=m;O>0;n[r+J]=255&x,J+=ie,x/=256,O-=8);n[r+J-ie]|=128*ce};function $n(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}$n.Varint=0,$n.Fixed64=1,$n.Bytes=2,$n.Fixed32=5;var Qu=4294967296,cl=1/Qu,Vc=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ia(n){return n.type===$n.Bytes?n.readVarint()+n.pos:n.pos+1}function Yl(n,t,r){return r?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function Uc(n,t,r){var u=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(u);for(var m=r.pos-1;m>=n;m--)r.buf[m+u]=r.buf[m]}function Ph(n,t){for(var r=0;r<n.length;r++)t.writeVarint(n[r])}function Ts(n,t){for(var r=0;r<n.length;r++)t.writeSVarint(n[r])}function Kl(n,t){for(var r=0;r<n.length;r++)t.writeFloat(n[r])}function xo(n,t){for(var r=0;r<n.length;r++)t.writeDouble(n[r])}function Ys(n,t){for(var r=0;r<n.length;r++)t.writeBoolean(n[r])}function wd(n,t){for(var r=0;r<n.length;r++)t.writeFixed32(n[r])}function _f(n,t){for(var r=0;r<n.length;r++)t.writeSFixed32(n[r])}function vf(n,t){for(var r=0;r<n.length;r++)t.writeFixed64(n[r])}function pp(n,t){for(var r=0;r<n.length;r++)t.writeSFixed64(n[r])}function wo(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function Eu(n,t,r){n[r]=t,n[r+1]=t>>>8,n[r+2]=t>>>16,n[r+3]=t>>>24}function Mh(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}$n.prototype={destroy:function(){this.buf=null},readFields:function(n,t,r){for(r=r||this.length;this.pos<r;){var u=this.readVarint(),m=u>>3,v=this.pos;this.type=7&u,n(m,t,this),this.pos===v&&this.skip(u)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=wo(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Mh(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=wo(this.buf,this.pos)+wo(this.buf,this.pos+4)*Qu;return this.pos+=8,n},readSFixed64:function(){var n=wo(this.buf,this.pos)+Mh(this.buf,this.pos+4)*Qu;return this.pos+=8,n},readFloat:function(){var n=jc(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=jc(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,r,u=this.buf;return t=127&(r=u[this.pos++]),r<128?t:(t|=(127&(r=u[this.pos++]))<<7,r<128?t:(t|=(127&(r=u[this.pos++]))<<14,r<128?t:(t|=(127&(r=u[this.pos++]))<<21,r<128?t:(function(m,v,x){var C,M,O=x.buf;if(C=(112&(M=O[x.pos++]))>>4,M<128||(C|=(127&(M=O[x.pos++]))<<3,M<128)||(C|=(127&(M=O[x.pos++]))<<10,M<128)||(C|=(127&(M=O[x.pos++]))<<17,M<128)||(C|=(127&(M=O[x.pos++]))<<24,M<128)||(C|=(1&(M=O[x.pos++]))<<31,M<128))return Yl(m,C,v);throw new Error("Expected varint not more than 10 bytes")})(t|=(15&(r=u[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&Vc?(function(r,u,m){return Vc.decode(r.subarray(u,m))})(this.buf,t,n):(function(r,u,m){for(var v="",x=u;x<m;){var C,M,O,U=r[x],G=null,X=U>239?4:U>223?3:U>191?2:1;if(x+X>m)break;X===1?U<128&&(G=U):X===2?(192&(C=r[x+1]))==128&&(G=(31&U)<<6|63&C)<=127&&(G=null):X===3?(M=r[x+2],(192&(C=r[x+1]))==128&&(192&M)==128&&((G=(15&U)<<12|(63&C)<<6|63&M)<=2047||G>=55296&&G<=57343)&&(G=null)):X===4&&(M=r[x+2],O=r[x+3],(192&(C=r[x+1]))==128&&(192&M)==128&&(192&O)==128&&((G=(15&U)<<18|(63&C)<<12|(63&M)<<6|63&O)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,X=1):G>65535&&(G-=65536,v+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),v+=String.fromCharCode(G),x+=X}return v})(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==$n.Bytes)return n.push(this.readVarint(t));var r=Ia(this);for(n=n||[];this.pos<r;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==$n.Bytes)return n.push(this.readSVarint());var t=Ia(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==$n.Bytes)return n.push(this.readBoolean());var t=Ia(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==$n.Bytes)return n.push(this.readFloat());var t=Ia(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==$n.Bytes)return n.push(this.readDouble());var t=Ia(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==$n.Bytes)return n.push(this.readFixed32());var t=Ia(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==$n.Bytes)return n.push(this.readSFixed32());var t=Ia(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==$n.Bytes)return n.push(this.readFixed64());var t=Ia(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==$n.Bytes)return n.push(this.readSFixed64());var t=Ia(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===$n.Varint)for(;this.buf[this.pos++]>127;);else if(t===$n.Bytes)this.pos=this.readVarint()+this.pos;else if(t===$n.Fixed32)this.pos+=4;else{if(t!==$n.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Eu(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Eu(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Eu(this.buf,-1&n,this.pos),Eu(this.buf,Math.floor(n*cl),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Eu(this.buf,-1&n,this.pos),Eu(this.buf,Math.floor(n*cl),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?(function(t,r){var u,m;if(t>=0?(u=t%4294967296|0,m=t/4294967296|0):(m=~(-t/4294967296),4294967295^(u=~(-t%4294967296))?u=u+1|0:(u=0,m=m+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),(function(v,x,C){C.buf[C.pos++]=127&v|128,v>>>=7,C.buf[C.pos++]=127&v|128,v>>>=7,C.buf[C.pos++]=127&v|128,v>>>=7,C.buf[C.pos++]=127&v|128,C.buf[C.pos]=127&(v>>>=7)})(u,0,r),(function(v,x){var C=(7&v)<<4;x.buf[x.pos++]|=C|((v>>>=3)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v)))))})(m,r)})(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=(function(u,m,v){for(var x,C,M=0;M<m.length;M++){if((x=m.charCodeAt(M))>55295&&x<57344){if(!C){x>56319||M+1===m.length?(u[v++]=239,u[v++]=191,u[v++]=189):C=x;continue}if(x<56320){u[v++]=239,u[v++]=191,u[v++]=189,C=x;continue}x=C-55296<<10|x-56320|65536,C=null}else C&&(u[v++]=239,u[v++]=191,u[v++]=189,C=null);x<128?u[v++]=x:(x<2048?u[v++]=x>>6|192:(x<65536?u[v++]=x>>12|224:(u[v++]=x>>18|240,u[v++]=x>>12&63|128),u[v++]=x>>6&63|128),u[v++]=63&x|128)}return v})(this.buf,n,this.pos);var r=this.pos-t;r>=128&&Uc(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(n){this.realloc(4),Ch(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Ch(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=n[r]},writeRawMessage:function(n,t){this.pos++;var r=this.pos;n(t,this);var u=this.pos-r;u>=128&&Uc(r,u,this),this.pos=r-1,this.writeVarint(u),this.pos+=u},writeMessage:function(n,t,r){this.writeTag(n,$n.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,Ph,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,Ts,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,Ys,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,Kl,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,xo,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,wd,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,_f,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,vf,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,pp,t)},writeBytesField:function(n,t){this.writeTag(n,$n.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,$n.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,$n.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,$n.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,$n.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,$n.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,$n.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,$n.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,$n.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,$n.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var hl=W(Uo);const qc=3;function Iu(n,t,r){n===1&&r.readMessage(bd,t)}function bd(n,t,r){if(n===3){const{id:u,bitmap:m,width:v,height:x,left:C,top:M,advance:O}=r.readMessage(kd,{});t.push({id:u,bitmap:new xu({width:v+2*qc,height:x+2*qc},m),metrics:{width:v,height:x,left:C,top:M,advance:O}})}}function kd(n,t,r){n===1?t.id=r.readVarint():n===2?t.bitmap=r.readBytes():n===3?t.width=r.readVarint():n===4?t.height=r.readVarint():n===5?t.left=r.readSVarint():n===6?t.top=r.readSVarint():n===7&&(t.advance=r.readVarint())}const Ah=qc;function Gc(n){let t=0,r=0;for(const x of n)t+=x.w*x.h,r=Math.max(r,x.w);n.sort(((x,C)=>C.h-x.h));const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let m=0,v=0;for(const x of n)for(let C=u.length-1;C>=0;C--){const M=u[C];if(!(x.w>M.w||x.h>M.h)){if(x.x=M.x,x.y=M.y,v=Math.max(v,x.y+x.h),m=Math.max(m,x.x+x.w),x.w===M.w&&x.h===M.h){const O=u.pop();C<u.length&&(u[C]=O)}else x.h===M.h?(M.x+=x.w,M.w-=x.w):x.w===M.w?(M.y+=x.h,M.h-=x.h):(u.push({x:M.x+x.w,y:M.y,w:M.w-x.w,h:x.h}),M.y+=x.h,M.h-=x.h);break}}return{w:m,h:v,fill:t/(m*v)||0}}const Cs=1;class xf{constructor(t,{pixelRatio:r,version:u,stretchX:m,stretchY:v,content:x,textFitWidth:C,textFitHeight:M}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=m,this.stretchY=v,this.content=x,this.version=u,this.textFitWidth=C,this.textFitHeight=M}get tl(){return[this.paddedRect.x+Cs,this.paddedRect.y+Cs]}get br(){return[this.paddedRect.x+this.paddedRect.w-Cs,this.paddedRect.y+this.paddedRect.h-Cs]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Cs)/this.pixelRatio,(this.paddedRect.h-2*Cs)/this.pixelRatio]}}class wf{constructor(t,r){const u={},m={};this.haveRenderCallbacks=[];const v=[];this.addImages(t,u,v),this.addImages(r,m,v);const{w:x,h:C}=Gc(v),M=new Or({width:x||1,height:C||1});for(const O in t){const U=t[O],G=u[O].paddedRect;Or.copy(U.data,M,{x:0,y:0},{x:G.x+Cs,y:G.y+Cs},U.data)}for(const O in r){const U=r[O],G=m[O].paddedRect,X=G.x+Cs,J=G.y+Cs,ie=U.data.width,ce=U.data.height;Or.copy(U.data,M,{x:0,y:0},{x:X,y:J},U.data),Or.copy(U.data,M,{x:0,y:ce-1},{x:X,y:J-1},{width:ie,height:1}),Or.copy(U.data,M,{x:0,y:0},{x:X,y:J+ce},{width:ie,height:1}),Or.copy(U.data,M,{x:ie-1,y:0},{x:X-1,y:J},{width:1,height:ce}),Or.copy(U.data,M,{x:0,y:0},{x:X+ie,y:J},{width:1,height:ce})}this.image=M,this.iconPositions=u,this.patternPositions=m}addImages(t,r,u){for(const m in t){const v=t[m],x={x:0,y:0,w:v.data.width+2*Cs,h:v.data.height+2*Cs};u.push(x),r[m]=new xf(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),r),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),r)}patchUpdatedImage(t,r,u){if(!t||!r||t.version===r.version)return;t.version=r.version;const[m,v]=t.tl;u.update(r.data,void 0,{x:m,y:v})}}var fl;Ot("ImagePosition",xf),Ot("ImageAtlas",wf),L.ah=void 0,(fl=L.ah||(L.ah={}))[fl.none=0]="none",fl[fl.horizontal=1]="horizontal",fl[fl.vertical=2]="vertical",fl[fl.horizontalOnly=3]="horizontalOnly";const bo=-17;class $c{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const u=new $c;return u.scale=t||1,u.fontStack=r,u}static forImage(t){const r=new $c;return r.imageName=t,r}}class ko{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const u=new ko;for(let m=0;m<t.sections.length;m++){const v=t.sections[m];v.image?u.addImageSection(v):u.addTextSection(v,r)}return u}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let r="";for(let u=0;u<t.length;u++){const m=t.charCodeAt(u+1)||null,v=t.charCodeAt(u-1)||null;r+=m&&ul(m)&&!Su[t[u+1]]||v&&ul(v)&&!Su[t[u-1]]||!Su[t[u]]?t[u]:Su[t[u]]}return r})(this.text)}trim(){let t=0;for(let u=0;u<this.text.length&&Gi[this.text.charCodeAt(u)];u++)t++;let r=this.text.length;for(let u=this.text.length-1;u>=0&&u>=t&&Gi[this.text.charCodeAt(u)];u--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const u=new ko;return u.text=this.text.substring(t,r),u.sectionIndex=this.sectionIndex.slice(t,r),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,r)=>Math.max(t,this.sections[r].scale)),0)}addTextSection(t,r){this.text+=t.text,this.sections.push($c.forText(t.scale,t.fontStack||r));const u=this.sections.length-1;for(let m=0;m<t.text.length;++m)this.sectionIndex.push(u)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Bt("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push($c.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Bt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zc(n,t,r,u,m,v,x,C,M,O,U,G,X,J,ie){const ce=ko.fromFeature(n,m);let ye;G===L.ah.vertical&&ce.verticalizePunctuation();const{processBidirectionalText:be,processStyledBidirectionalText:Ue}=ui;if(be&&ce.sections.length===1){ye=[];const et=be(ce.toString(),Ks(ce,O,v,t,u,J));for(const dt of et){const Dt=new ko;Dt.text=dt,Dt.sections=ce.sections;for(let hn=0;hn<dt.length;hn++)Dt.sectionIndex.push(0);ye.push(Dt)}}else if(Ue){ye=[];const et=Ue(ce.text,ce.sectionIndex,Ks(ce,O,v,t,u,J));for(const dt of et){const Dt=new ko;Dt.text=dt[0],Dt.sectionIndex=dt[1],Dt.sections=ce.sections,ye.push(Dt)}}else ye=(function(et,dt){const Dt=[],hn=et.text;let Nt=0;for(const Mt of dt)Dt.push(et.substring(Nt,Mt)),Nt=Mt;return Nt<hn.length&&Dt.push(et.substring(Nt,hn.length)),Dt})(ce,Ks(ce,O,v,t,u,J));const Te=[],Ve={positionedLines:Te,text:ce.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:G,iconsInText:!1,verticalizable:!1};return(function(et,dt,Dt,hn,Nt,Mt,Yt,Gt,Vt,st,en,Wt){let wn=0,ki=bo,_i=0,Fr=0;const Go=Gt==="right"?1:Gt==="left"?0:.5;let us=0;for(const nr of Nt){nr.trim();const jr=nr.getMaxScale(),Ps=(jr-1)*Di,cs={positionedGlyphs:[],lineOffset:0};et.positionedLines[us]=cs;const ta=cs.positionedGlyphs;let hs=0;if(!nr.length()){ki+=Mt,++us;continue}for(let Ta=0;Ta<nr.length();Ta++){const ii=nr.getSection(Ta),Mi=nr.getSectionIndex(Ta),Oi=nr.getCharCode(Ta);let $a=0,Ki=null,jh=null,tu=null,nu=Di;const $o=!(Vt===L.ah.horizontal||!en&&!mu(Oi)||en&&(Gi[Oi]||(Br=Oi,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Br)))));if(ii.imageName){const Eo=hn[ii.imageName];if(!Eo)continue;tu=ii.imageName,et.iconsInText=et.iconsInText||!0,jh=Eo.paddedRect;const Jr=Eo.displaySize;ii.scale=ii.scale*Di/Wt,Ki={width:Jr[0],height:Jr[1],left:Cs,top:-Ah,advance:$o?Jr[1]:Jr[0]},$a=Ps+(Di-Jr[1]*ii.scale),nu=Ki.advance;const Cu=$o?Jr[0]*ii.scale-Di*jr:Jr[1]*ii.scale-Di*jr;Cu>0&&Cu>hs&&(hs=Cu)}else{const Eo=Dt[ii.fontStack],Jr=Eo&&Eo[Oi];if(Jr&&Jr.rect)jh=Jr.rect,Ki=Jr.metrics;else{const Cu=dt[ii.fontStack],Tf=Cu&&Cu[Oi];if(!Tf)continue;Ki=Tf.metrics}$a=(jr-ii.scale)*Di}$o?(et.verticalizable=!0,ta.push({glyph:Oi,imageName:tu,x:wn,y:ki+$a,vertical:$o,scale:ii.scale,fontStack:ii.fontStack,sectionIndex:Mi,metrics:Ki,rect:jh}),wn+=nu*ii.scale+st):(ta.push({glyph:Oi,imageName:tu,x:wn,y:ki+$a,vertical:$o,scale:ii.scale,fontStack:ii.fontStack,sectionIndex:Mi,metrics:Ki,rect:jh}),wn+=Ki.advance*ii.scale+st)}ta.length!==0&&(_i=Math.max(wn-st,_i),gp(ta,0,ta.length-1,Go,hs)),wn=0;const So=Mt*jr+hs;cs.lineOffset=Math.max(hs,Ps),ki+=So,Fr=Math.max(So,Fr),++us}var Br;const Js=ki-bo,{horizontalAlign:Qs,verticalAlign:ea}=Hc(Yt);(function(nr,jr,Ps,cs,ta,hs,So,Ta,ii){const Mi=(jr-Ps)*ta;let Oi=0;Oi=hs!==So?-Ta*cs-bo:(-cs*ii+.5)*So;for(const $a of nr)for(const Ki of $a.positionedGlyphs)Ki.x+=Mi,Ki.y+=Oi})(et.positionedLines,Go,Qs,ea,_i,Fr,Mt,Js,Nt.length),et.top+=-ea*Js,et.bottom=et.top+Js,et.left+=-Qs*_i,et.right=et.left+_i})(Ve,t,r,u,ye,x,C,M,G,O,X,ie),!(function(et){for(const dt of et)if(dt.positionedGlyphs.length!==0)return!1;return!0})(Te)&&Ve}const Gi={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mp={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Sd={40:!0};function Ed(n,t,r,u,m,v){if(t.imageName){const x=u[t.imageName];return x?x.displaySize[0]*t.scale*Di/v+m:0}{const x=r[t.fontStack],C=x&&x[n];return C?C.metrics.advance*t.scale+m:0}}function Id(n,t,r,u){const m=Math.pow(n-t,2);return u?n<t?m/2:2*m:m+Math.abs(r)*r}function Td(n,t,r){let u=0;return n===10&&(u-=1e4),r&&(u+=150),n!==40&&n!==65288||(u+=50),t!==41&&t!==65289||(u+=50),u}function bf(n,t,r,u,m,v){let x=null,C=Id(t,r,m,v);for(const M of u){const O=Id(t-M.x,r,m,v)+M.badness;O<=C&&(x=M,C=O)}return{index:n,x:t,priorBreak:x,badness:C}}function Cd(n){return n?Cd(n.priorBreak).concat(n.index):[]}function Ks(n,t,r,u,m,v){if(!n)return[];const x=[],C=(function(G,X,J,ie,ce,ye){let be=0;for(let Ue=0;Ue<G.length();Ue++){const Te=G.getSection(Ue);be+=Ed(G.getCharCode(Ue),Te,ie,ce,X,ye)}return be/Math.max(1,Math.ceil(be/J))})(n,t,r,u,m,v),M=n.text.indexOf("")>=0;let O=0;for(let G=0;G<n.length();G++){const X=n.getSection(G),J=n.getCharCode(G);if(Gi[J]||(O+=Ed(J,X,u,m,t,v)),G<n.length()-1){const ie=!((U=J)<11904)&&(!!zn["CJK Compatibility Forms"](U)||!!zn["CJK Compatibility"](U)||!!zn["CJK Strokes"](U)||!!zn["CJK Symbols and Punctuation"](U)||!!zn["Enclosed CJK Letters and Months"](U)||!!zn["Halfwidth and Fullwidth Forms"](U)||!!zn["Ideographic Description Characters"](U)||!!zn["Vertical Forms"](U)||pu.test(String.fromCodePoint(U)));(mp[J]||ie||X.imageName||G!==n.length()-2&&Sd[n.getCharCode(G+1)])&&x.push(bf(G+1,O,C,x,Td(J,n.getCharCode(G+1),ie&&M),!1))}}var U;return Cd(bf(n.length(),O,C,x,0,!0))}function Hc(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function gp(n,t,r,u,m){if(!u&&!m)return;const v=n[r],x=(n[r].x+v.metrics.advance*v.scale)*u;for(let C=t;C<=r;C++)n[C].x-=x,n[C].y+=m}function Jl(n,t,r){const{horizontalAlign:u,verticalAlign:m}=Hc(r),v=t[0]-n.displaySize[0]*u,x=t[1]-n.displaySize[1]*m;return{image:n,top:x,bottom:x+n.displaySize[1],left:v,right:v+n.displaySize[0]}}function Xc(n){var t,r;let u=n.left,m=n.top,v=n.right-u,x=n.bottom-m;const C=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",M=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",O=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(M==="proportional"){if(C==="stretchOnly"&&v/x<O||C==="proportional"){const U=Math.ceil(x*O);u*=U/v,v=U}}else if(C==="proportional"&&M==="stretchOnly"&&O!==0&&v/x>O){const U=Math.ceil(v/O);m*=U/x,x=U}return{x1:u,y1:m,x2:u+v,y2:m+x}}function Ql(n,t,r,u,m,v){const x=n.image;let C;if(x.content){const ye=x.content,be=x.pixelRatio||1;C=[ye[0]/be,ye[1]/be,x.displaySize[0]-ye[2]/be,x.displaySize[1]-ye[3]/be]}const M=t.left*v,O=t.right*v;let U,G,X,J;r==="width"||r==="both"?(J=m[0]+M-u[3],G=m[0]+O+u[1]):(J=m[0]+(M+O-x.displaySize[0])/2,G=J+x.displaySize[0]);const ie=t.top*v,ce=t.bottom*v;return r==="height"||r==="both"?(U=m[1]+ie-u[0],X=m[1]+ce+u[2]):(U=m[1]+(ie+ce-x.displaySize[1])/2,X=U+x.displaySize[1]),{image:x,top:U,right:G,bottom:X,left:J,collisionPadding:C}}const eu=255,Ga=128,qo=eu*Ga;function Pd(n,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new On(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:m}=r;let v=0;for(;v<u.length&&u[v]<=n;)v++;v=Math.max(0,v-1);let x=v;for(;x<u.length&&u[x]<n+1;)x++;x=Math.min(u.length-1,x);const C=u[v],M=u[x];return r.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:M,interpolationType:m}:{kind:"camera",minZoom:C,maxZoom:M,minSize:r.evaluate(new On(C)),maxSize:r.evaluate(new On(M)),interpolationType:m}}}function Wc(n,t,r){let u="never";const m=n.get(t);return m?u=m:n.get(r)&&(u="always"),u}const yp=Hl.VectorTileFeature.types,Md=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Yc(n,t,r,u,m,v,x,C,M,O,U,G,X){const J=C?Math.min(qo,Math.round(C[0])):0,ie=C?Math.min(qo,Math.round(C[1])):0;n.emplaceBack(t,r,Math.round(32*u),Math.round(32*m),v,x,(J<<1)+(M?1:0),ie,16*O,16*U,256*G,256*X)}function ec(n,t,r){n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r)}function Lh(n){for(const t of n.sections)if(Fo(t.text))return!0;return!1}class Rh{constructor(t){this.layoutVertexArray=new $s,this.indexArray=new Zs,this.programConfigurations=t,this.segments=new Ln,this.dynamicLayoutVertexArray=new Va,this.opacityVertexArray=new Wr,this.hasVisibleVertices=!1,this.placedSymbolArray=new li}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,u,m){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ku.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Md,!0),this.opacityVertexBuffer.itemSize=1),(u||m)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ot("SymbolBuffers",Rh);class Kc{constructor(t,r,u){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new u,this.segments=new Ln,this.collisionVertexArray=new va}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ih.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ot("CollisionBuffers",Kc);class tc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((x=>x.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ch([]),this.placementViewportMatrix=ch([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Pd(this.zoom,r["text-size"]),this.iconSizeData=Pd(this.zoom,r["icon-size"]);const u=this.layers[0].layout,m=u.get("symbol-sort-key"),v=u.get("symbol-z-order");this.canOverlap=Wc(u,"text-overlap","text-allow-overlap")!=="never"||Wc(u,"icon-overlap","icon-allow-overlap")!=="never"||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!m.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map((x=>L.ah[x]))),this.stateDependentLayerIds=this.layers.filter((x=>x.isStateDependent())).map((x=>x.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Rh(new _o(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Rh(new _o(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new ci,this.lineVertexArray=new wr,this.symbolInstances=new Pn,this.textAnchorOffsets=new hi}calculateGlyphDependencies(t,r,u,m,v){for(let x=0;x<t.length;x++)if(r[t.charCodeAt(x)]=!0,(u||m)&&v){const C=Su[t.charAt(x)];C&&(r[C.charCodeAt(0)]=!0)}}populate(t,r,u){const m=this.layers[0],v=m.layout,x=v.get("text-font"),C=v.get("text-field"),M=v.get("icon-image"),O=(C.value.kind!=="constant"||C.value.value instanceof yr&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),U=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,G=v.get("symbol-sort-key");if(this.features=[],!O&&!U)return;const X=r.iconDependencies,J=r.glyphDependencies,ie=r.availableImages,ce=new On(this.zoom);for(const{feature:ye,id:be,index:Ue,sourceLayerIndex:Te}of t){const Ve=m._featureFilter.needGeometry,et=$l(ye,Ve);if(!m._featureFilter.filter(ce,et,u))continue;let dt,Dt;if(Ve||(et.geometry=Gl(ye)),O){const Nt=m.getValueAndResolveTokens("text-field",et,u,ie),Mt=yr.factory(Nt),Yt=this.hasRTLText=this.hasRTLText||Lh(Mt);(!Yt||ui.getRTLTextPluginStatus()==="unavailable"||Yt&&ui.isParsed())&&(dt=Ws(Mt,m,et))}if(U){const Nt=m.getValueAndResolveTokens("icon-image",et,u,ie);Dt=Nt instanceof Bi?Nt:Bi.fromString(Nt)}if(!dt&&!Dt)continue;const hn=this.sortFeaturesByKey?G.evaluate(et,{},u):void 0;if(this.features.push({id:be,text:dt,icon:Dt,index:Ue,sourceLayerIndex:Te,geometry:et.geometry,properties:ye.properties,type:yp[ye.type],sortKey:hn}),Dt&&(X[Dt.name]=!0),dt){const Nt=x.evaluate(et,{},u).join(","),Mt=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(L.ah.vertical)>=0;for(const Yt of dt.sections)if(Yt.image)X[Yt.image.name]=!0;else{const Gt=vc(dt.toString()),Vt=Yt.fontStack||Nt,st=J[Vt]=J[Vt]||{};this.calculateGlyphDependencies(Yt.text,st,Mt,this.allowVerticalPlacement,Gt)}}}v.get("symbol-placement")==="line"&&(this.features=(function(ye){const be={},Ue={},Te=[];let Ve=0;function et(Nt){Te.push(ye[Nt]),Ve++}function dt(Nt,Mt,Yt){const Gt=Ue[Nt];return delete Ue[Nt],Ue[Mt]=Gt,Te[Gt].geometry[0].pop(),Te[Gt].geometry[0]=Te[Gt].geometry[0].concat(Yt[0]),Gt}function Dt(Nt,Mt,Yt){const Gt=be[Mt];return delete be[Mt],be[Nt]=Gt,Te[Gt].geometry[0].shift(),Te[Gt].geometry[0]=Yt[0].concat(Te[Gt].geometry[0]),Gt}function hn(Nt,Mt,Yt){const Gt=Yt?Mt[0][Mt[0].length-1]:Mt[0][0];return`${Nt}:${Gt.x}:${Gt.y}`}for(let Nt=0;Nt<ye.length;Nt++){const Mt=ye[Nt],Yt=Mt.geometry,Gt=Mt.text?Mt.text.toString():null;if(!Gt){et(Nt);continue}const Vt=hn(Gt,Yt),st=hn(Gt,Yt,!0);if(Vt in Ue&&st in be&&Ue[Vt]!==be[st]){const en=Dt(Vt,st,Yt),Wt=dt(Vt,st,Te[en].geometry);delete be[Vt],delete Ue[st],Ue[hn(Gt,Te[Wt].geometry,!0)]=Wt,Te[en].geometry=null}else Vt in Ue?dt(Vt,st,Yt):st in be?Dt(Vt,st,Yt):(et(Nt),be[Vt]=Ve-1,Ue[st]=Ve-1)}return Te.filter((Nt=>Nt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((ye,be)=>ye.sortKey-be.sortKey))}update(t,r,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const u=this.lineVertexArray.length;if(t.segment!==void 0){let m=t.dist(r[t.segment+1]),v=t.dist(r[t.segment]);const x={};for(let C=t.segment+1;C<r.length;C++)x[C]={x:r[C].x,y:r[C].y,tileUnitDistanceFromAnchor:m},C<r.length-1&&(m+=r[C+1].dist(r[C]));for(let C=t.segment||0;C>=0;C--)x[C]={x:r[C].x,y:r[C].y,tileUnitDistanceFromAnchor:v},C>0&&(v+=r[C-1].dist(r[C]));for(let C=0;C<r.length;C++){const M=x[C];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(t,r,u,m,v,x,C,M,O,U,G,X){const J=t.indexArray,ie=t.layoutVertexArray,ce=t.segments.prepareSegment(4*r.length,ie,J,this.canOverlap?x.sortKey:void 0),ye=this.glyphOffsetArray.length,be=ce.vertexLength,Ue=this.allowVerticalPlacement&&C===L.ah.vertical?Math.PI/2:0,Te=x.text&&x.text.sections;for(let Ve=0;Ve<r.length;Ve++){const{tl:et,tr:dt,bl:Dt,br:hn,tex:Nt,pixelOffsetTL:Mt,pixelOffsetBR:Yt,minFontScaleX:Gt,minFontScaleY:Vt,glyphOffset:st,isSDF:en,sectionIndex:Wt}=r[Ve],wn=ce.vertexLength,ki=st[1];Yc(ie,M.x,M.y,et.x,ki+et.y,Nt.x,Nt.y,u,en,Mt.x,Mt.y,Gt,Vt),Yc(ie,M.x,M.y,dt.x,ki+dt.y,Nt.x+Nt.w,Nt.y,u,en,Yt.x,Mt.y,Gt,Vt),Yc(ie,M.x,M.y,Dt.x,ki+Dt.y,Nt.x,Nt.y+Nt.h,u,en,Mt.x,Yt.y,Gt,Vt),Yc(ie,M.x,M.y,hn.x,ki+hn.y,Nt.x+Nt.w,Nt.y+Nt.h,u,en,Yt.x,Yt.y,Gt,Vt),ec(t.dynamicLayoutVertexArray,M,Ue),J.emplaceBack(wn,wn+1,wn+2),J.emplaceBack(wn+1,wn+2,wn+3),ce.vertexLength+=4,ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(st[0]),Ve!==r.length-1&&Wt===r[Ve+1].sectionIndex||t.programConfigurations.populatePaintArrays(ie.length,x,x.index,{},X,Te&&Te[Wt])}t.placedSymbolArray.emplaceBack(M.x,M.y,ye,this.glyphOffsetArray.length-ye,be,O,U,M.segment,u?u[0]:0,u?u[1]:0,m[0],m[1],C,0,!1,0,G)}_addCollisionDebugVertex(t,r,u,m,v,x){return r.emplaceBack(0,0),t.emplaceBack(u.x,u.y,m,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(t,r,u,m,v,x,C){const M=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),O=M.vertexLength,U=v.layoutVertexArray,G=v.collisionVertexArray,X=C.anchorX,J=C.anchorY;this._addCollisionDebugVertex(U,G,x,X,J,new F(t,r)),this._addCollisionDebugVertex(U,G,x,X,J,new F(u,r)),this._addCollisionDebugVertex(U,G,x,X,J,new F(u,m)),this._addCollisionDebugVertex(U,G,x,X,J,new F(t,m)),M.vertexLength+=4;const ie=v.indexArray;ie.emplaceBack(O,O+1),ie.emplaceBack(O+1,O+2),ie.emplaceBack(O+2,O+3),ie.emplaceBack(O+3,O),M.primitiveLength+=4}addDebugCollisionBoxes(t,r,u,m){for(let v=t;v<r;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,m?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,u)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Kc(Ss,Th.members,Wi),this.iconCollisionBox=new Kc(Ss,Th.members,Wi);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,u,m,v,x,C,M,O){const U={};for(let G=r;G<u;G++){const X=t.get(G);U.textBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},U.textFeatureIndex=X.featureIndex;break}for(let G=m;G<v;G++){const X=t.get(G);U.verticalTextBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},U.verticalTextFeatureIndex=X.featureIndex;break}for(let G=x;G<C;G++){const X=t.get(G);U.iconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},U.iconFeatureIndex=X.featureIndex;break}for(let G=M;G<O;G++){const X=t.get(G);U.verticalIconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},U.verticalIconFeatureIndex=X.featureIndex;break}return U}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const u=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const u=t.placedSymbolArray.get(r),m=u.vertexStartIndex+4*u.numGlyphs;for(let v=u.vertexStartIndex;v<m;v+=4)t.indexArray.emplaceBack(v,v+1,v+2),t.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),u=Math.cos(t),m=[],v=[],x=[];for(let C=0;C<this.symbolInstances.length;++C){x.push(C);const M=this.symbolInstances.get(C);m.push(0|Math.round(r*M.anchorX+u*M.anchorY)),v.push(M.featureIndex)}return x.sort(((C,M)=>m[C]-m[M]||v[M]-v[C])),x}addToSortKeyRanges(t,r){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===r?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const u=this.symbolInstances.get(r);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach(((m,v,x)=>{m>=0&&x.indexOf(m)===v&&this.addIndicesForPlacedSymbol(this.text,m)})),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let kf,Nh;Ot("SymbolBucket",tc,{omit:["layers","collisionBoxArray","features","compareText"]}),tc.MAX_GLYPHS=65535,tc.addDynamicAttributes=ec;var nc={get paint(){return Nh=Nh||new _({"icon-opacity":new sn(Ye.paint_symbol["icon-opacity"]),"icon-color":new sn(Ye.paint_symbol["icon-color"]),"icon-halo-color":new sn(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new sn(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new sn(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Ft(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ft(Ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new sn(Ye.paint_symbol["text-opacity"]),"text-color":new sn(Ye.paint_symbol["text-color"],{runtimeType:mr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new sn(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new sn(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new sn(Ye.paint_symbol["text-halo-blur"]),"text-translate":new Ft(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new Ft(Ye.paint_symbol["text-translate-anchor"])})},get layout(){return kf=kf||new _({"symbol-placement":new Ft(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Ft(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ft(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new sn(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ft(Ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ft(Ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ft(Ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ft(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ft(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ft(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new sn(Ye.layout_symbol["icon-size"]),"icon-text-fit":new Ft(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ft(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new sn(Ye.layout_symbol["icon-image"]),"icon-rotate":new sn(Ye.layout_symbol["icon-rotate"]),"icon-padding":new sn(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Ft(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new sn(Ye.layout_symbol["icon-offset"]),"icon-anchor":new sn(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ft(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ft(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ft(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new sn(Ye.layout_symbol["text-field"]),"text-font":new sn(Ye.layout_symbol["text-font"]),"text-size":new sn(Ye.layout_symbol["text-size"]),"text-max-width":new sn(Ye.layout_symbol["text-max-width"]),"text-line-height":new Ft(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new sn(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new sn(Ye.layout_symbol["text-justify"]),"text-radial-offset":new sn(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ft(Ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new sn(Ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new sn(Ye.layout_symbol["text-anchor"]),"text-max-angle":new Ft(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Ft(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new sn(Ye.layout_symbol["text-rotate"]),"text-padding":new Ft(Ye.layout_symbol["text-padding"]),"text-keep-upright":new Ft(Ye.layout_symbol["text-keep-upright"]),"text-transform":new sn(Ye.layout_symbol["text-transform"]),"text-offset":new sn(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new Ft(Ye.layout_symbol["text-allow-overlap"]),"text-overlap":new Ft(Ye.layout_symbol["text-overlap"]),"text-ignore-placement":new Ft(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new Ft(Ye.layout_symbol["text-optional"])})}};class zh{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Aa,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ot("FormatSectionOverride",zh,{omit:["defaultValue"]});class Tu extends o{constructor(t){super(t,nc)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const u=this.layout.get("text-writing-mode");if(u){const m=[];for(const v of u)m.indexOf(v)<0&&m.push(v);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,u,m){const v=this.layout.get(t).evaluate(r,{},u,m),x=this._unevaluatedLayout._values[t];return x.isDataDriven()||b(x.value)||!v?v:(function(C,M){return M.replace(/{([^{}]+)}/g,((O,U)=>C&&U in C?String(C[U]):""))})(r.properties,v)}createBucket(t){return new tc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of nc.paint.overridableProperties){if(!Tu.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),u=new zh(r),m=new h(u,r.property.specification);let v=null;v=r.value.kind==="constant"||r.value.kind==="source"?new B("source",m):new H("composite",m,r.value.zoomStops),this.paint._values[t]=new ws(r.property,v,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,u){return!(!this.layout||r.isDataDriven()||u.isDataDriven())&&Tu.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const u=t.get("text-field"),m=nc.paint.properties[r];let v=!1;const x=C=>{for(const M of C)if(m.overrides&&m.overrides.hasOverride(M))return void(v=!0)};if(u.value.kind==="constant"&&u.value.value instanceof yr)x(u.value.value.sections);else if(u.value.kind==="source"){const C=O=>{v||(O instanceof ms&&Wn(O.value)===Sr?x(O.value.sections):O instanceof za?x(O.sections):O.eachChild(C))},M=u.value;M._styleExpression&&C(M._styleExpression.expression)}return v}}let Sf;var _p={get paint(){return Sf=Sf||new _({"background-color":new Ft(Ye.paint_background["background-color"]),"background-pattern":new yu(Ye.paint_background["background-pattern"]),"background-opacity":new Ft(Ye.paint_background["background-opacity"])})}};class Dh extends o{constructor(t){super(t,_p)}}let Ad;var Jc={get paint(){return Ad=Ad||new _({"raster-opacity":new Ft(Ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ft(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ft(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ft(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Ft(Ye.paint_raster["raster-saturation"]),"raster-contrast":new Ft(Ye.paint_raster["raster-contrast"]),"raster-resampling":new Ft(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Ft(Ye.paint_raster["raster-fade-duration"])})}};class vp extends o{constructor(t){super(t,Jc)}}class Oh extends o{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class a{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const l=63710088e-1;class g{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new g(tt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,u=this.lat*r,m=t.lat*r,v=Math.sin(u)*Math.sin(m)+Math.cos(u)*Math.cos(m)*Math.cos((t.lng-this.lng)*r);return l*Math.acos(Math.min(v,1))}static convert(t){if(t instanceof g)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new g(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new g(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const I=2*Math.PI*l;function z(n){return I*Math.cos(n*Math.PI/180)}function j(n){return(180+n)/360}function ne(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function xe(n,t){return n/z(t)}function Pe(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class Je{constructor(t,r,u=0){this.x=+t,this.y=+r,this.z=+u}static fromLngLat(t,r=0){const u=g.convert(t);return new Je(j(u.lng),ne(u.lat),xe(r,u.lat))}toLngLat(){return new g(360*this.x-180,Pe(this.y))}toAltitude(){return this.z*z(Pe(this.y))}meterInMercatorCoordinateUnits(){return 1/I*(t=Pe(this.y),1/Math.cos(t*Math.PI/180));var t}}function gt(n,t,r){var u=2*Math.PI*6378137/256/Math.pow(2,r);return[n*u-2*Math.PI*6378137/2,t*u-2*Math.PI*6378137/2]}class xt{constructor(t,r,u){if(!(function(m,v,x){return!(m<0||m>25||x<0||x>=Math.pow(2,m)||v<0||v>=Math.pow(2,m))})(t,r,u))throw new Error(`x=${r}, y=${u}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=u,this.key=Xt(0,t,t,r,u)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,u){const m=(x=this.y,C=this.z,M=gt(256*(v=this.x),256*(x=Math.pow(2,C)-x-1),C),O=gt(256*(v+1),256*(x+1),C),M[0]+","+M[1]+","+O[0]+","+O[1]);var v,x,C,M,O;const U=(function(G,X,J){let ie,ce="";for(let ye=G;ye>0;ye--)ie=1<<ye-1,ce+=(X&ie?1:0)+(J&ie?2:0);return ce})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,U).replace(/{bbox-epsg-3857}/g,m)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new F((t.x*r-this.x)*Yi,(t.y*r-this.y)*Yi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class mt{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Xt(t,r.z,r.z,r.x,r.y)}}class Rt{constructor(t,r,u,m,v){if(t<u)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${u}`);this.overscaledZ=t,this.wrap=r,this.canonical=new xt(u,+m,+v),this.key=Xt(r,t,u,m,v)}clone(){return new Rt(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new Rt(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rt(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-t;return t>this.canonical.z?Xt(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Xt(this.wrap*+r,t,t,this.canonical.x>>u,this.canonical.y>>u)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Rt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,u=2*this.canonical.x,m=2*this.canonical.y;return[new Rt(r,this.wrap,r,u,m),new Rt(r,this.wrap,r,u+1,m),new Rt(r,this.wrap,r,u,m+1),new Rt(r,this.wrap,r,u+1,m+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Rt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Rt(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new mt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Je(t.x-this.wrap,t.y))}}function Xt(n,t,r,u,m){(n*=2)<0&&(n=-1*n-1);const v=1<<r;return(v*v*n+v*m+u).toString(36)+r.toString(36)+t.toString(36)}Ot("CanonicalTileID",xt),Ot("OverscaledTileID",Rt,{omit:["posMatrix"]});class nn{constructor(t,r,u,m=1,v=1,x=1,C=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(u&&!["mapbox","terrarium","custom"].includes(u))return void Bt(`"${u}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const M=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),u){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=m,this.greenFactor=v,this.blueFactor=x,this.baseShift=C;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let O=0;O<M;O++)this.data[this._idx(-1,O)]=this.data[this._idx(0,O)],this.data[this._idx(M,O)]=this.data[this._idx(M-1,O)],this.data[this._idx(O,-1)]=this.data[this._idx(O,0)],this.data[this._idx(O,M)]=this.data[this._idx(O,M-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(M,-1)]=this.data[this._idx(M-1,0)],this.data[this._idx(-1,M)]=this.data[this._idx(0,M-1)],this.data[this._idx(M,M)]=this.data[this._idx(M-1,M-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let O=0;O<M;O++)for(let U=0;U<M;U++){const G=this.get(O,U);G>this.max&&(this.max=G),G<this.min&&(this.min=G)}}get(t,r){const u=new Uint8Array(this.data.buffer),m=4*this._idx(t,r);return this.unpack(u[m],u[m+1],u[m+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,u){return t*this.redFactor+r*this.greenFactor+u*this.blueFactor-this.baseShift}getPixels(){return new Or({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let m=r*this.dim,v=r*this.dim+this.dim,x=u*this.dim,C=u*this.dim+this.dim;switch(r){case-1:m=v-1;break;case 1:v=m+1}switch(u){case-1:x=C-1;break;case 1:C=x+1}const M=-r*this.dim,O=-u*this.dim;for(let U=x;U<C;U++)for(let G=m;G<v;G++)this.data[this._idx(G,U)]=t.data[this._idx(G+M,U+O)]}}Ot("DEMData",nn);class tr{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const u=t[r];this._stringToNumber[u]=r,this._numberToString[r]=u}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class He{constructor(t,r,u,m,v){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=u,t._y=m,this.properties=t.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class ze{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Dl(Yi,16,0),this.grid3D=new Dl(Yi,16,0),this.featureIndexArray=new bi,this.promoteId=r}insert(t,r,u,m,v,x){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,m,v);const M=x?this.grid3D:this.grid;for(let O=0;O<r.length;O++){const U=r[O],G=[1/0,1/0,-1/0,-1/0];for(let X=0;X<U.length;X++){const J=U[X];G[0]=Math.min(G[0],J.x),G[1]=Math.min(G[1],J.y),G[2]=Math.max(G[2],J.x),G[3]=Math.max(G[3],J.y)}G[0]<Yi&&G[1]<Yi&&G[2]>=0&&G[3]>=0&&M.insert(C,G[0],G[1],G[2],G[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Hl.VectorTile(new hl(this.rawTileData)).layers,this.sourceLayerCoder=new tr(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,u,m){this.loadVTLayers();const v=t.params||{},x=Yi/t.tileSize/t.scale,C=At(v.filter),M=t.queryGeometry,O=t.queryPadding*x,U=Tt(M),G=this.grid.query(U.minX-O,U.minY-O,U.maxX+O,U.maxY+O),X=Tt(t.cameraQueryGeometry),J=this.grid3D.query(X.minX-O,X.minY-O,X.maxX+O,X.maxY+O,((ye,be,Ue,Te)=>(function(Ve,et,dt,Dt,hn){for(const Mt of Ve)if(et<=Mt.x&&dt<=Mt.y&&Dt>=Mt.x&&hn>=Mt.y)return!0;const Nt=[new F(et,dt),new F(et,hn),new F(Dt,hn),new F(Dt,dt)];if(Ve.length>2){for(const Mt of Nt)if(_u(Ve,Mt))return!0}for(let Mt=0;Mt<Ve.length-1;Mt++)if(Wf(Ve[Mt],Ve[Mt+1],Nt))return!0;return!1})(t.cameraQueryGeometry,ye-O,be-O,Ue+O,Te+O)));for(const ye of J)G.push(ye);G.sort(un);const ie={};let ce;for(let ye=0;ye<G.length;ye++){const be=G[ye];if(be===ce)continue;ce=be;const Ue=this.featureIndexArray.get(be);let Te=null;this.loadMatchingFeature(ie,Ue.bucketIndex,Ue.sourceLayerIndex,Ue.featureIndex,C,v.layers,v.availableImages,r,u,m,((Ve,et,dt)=>(Te||(Te=Gl(Ve)),et.queryIntersectsFeature(M,Ve,dt,Te,this.z,t.transform,x,t.pixelPosMatrix))))}return ie}loadMatchingFeature(t,r,u,m,v,x,C,M,O,U,G){const X=this.bucketLayerIDs[r];if(x&&!(function(ye,be){for(let Ue=0;Ue<ye.length;Ue++)if(be.indexOf(ye[Ue])>=0)return!0;return!1})(x,X))return;const J=this.sourceLayerCoder.decode(u),ie=this.vtLayers[J].feature(m);if(v.needGeometry){const ye=$l(ie,!0);if(!v.filter(new On(this.tileID.overscaledZ),ye,this.tileID.canonical))return}else if(!v.filter(new On(this.tileID.overscaledZ),ie))return;const ce=this.getId(ie,J);for(let ye=0;ye<X.length;ye++){const be=X[ye];if(x&&x.indexOf(be)<0)continue;const Ue=M[be];if(!Ue)continue;let Te={};ce&&U&&(Te=U.getState(Ue.sourceLayer||"_geojsonTileLayer",ce));const Ve=at({},O[be]);Ve.paint=Xe(Ve.paint,Ue.paint,ie,Te,C),Ve.layout=Xe(Ve.layout,Ue.layout,ie,Te,C);const et=!G||G(ie,Ue,Te);if(!et)continue;const dt=new He(ie,this.z,this.x,this.y,ce);dt.layer=Ve;let Dt=t[be];Dt===void 0&&(Dt=t[be]=[]),Dt.push({featureIndex:m,feature:dt,intersectionZ:et})}}lookupSymbolFeatures(t,r,u,m,v,x,C,M){const O={};this.loadVTLayers();const U=At(v);for(const G of t)this.loadMatchingFeature(O,u,m,G,U,x,C,M,r);return O}hasLayer(t){for(const r of this.bucketLayerIDs)for(const u of r)if(t===u)return!0;return!1}getId(t,r){let u=t.id;return this.promoteId&&(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof u=="boolean"&&(u=Number(u))),u}}function Xe(n,t,r,u,m){return ft(n,((v,x)=>{const C=t instanceof Bl?t.get(x):null;return C&&C.evaluate?C.evaluate(r,u,m):C}))}function Tt(n){let t=1/0,r=1/0,u=-1/0,m=-1/0;for(const v of n)t=Math.min(t,v.x),r=Math.min(r,v.y),u=Math.max(u,v.x),m=Math.max(m,v.y);return{minX:t,minY:r,maxX:u,maxY:m}}function un(n,t){return t-n}function _n(n,t,r,u,m){const v=[];for(let x=0;x<n.length;x++){const C=n[x];let M;for(let O=0;O<C.length-1;O++){let U=C[O],G=C[O+1];U.x<t&&G.x<t||(U.x<t?U=new F(t,U.y+(t-U.x)/(G.x-U.x)*(G.y-U.y))._round():G.x<t&&(G=new F(t,U.y+(t-U.x)/(G.x-U.x)*(G.y-U.y))._round()),U.y<r&&G.y<r||(U.y<r?U=new F(U.x+(r-U.y)/(G.y-U.y)*(G.x-U.x),r)._round():G.y<r&&(G=new F(U.x+(r-U.y)/(G.y-U.y)*(G.x-U.x),r)._round()),U.x>=u&&G.x>=u||(U.x>=u?U=new F(u,U.y+(u-U.x)/(G.x-U.x)*(G.y-U.y))._round():G.x>=u&&(G=new F(u,U.y+(u-U.x)/(G.x-U.x)*(G.y-U.y))._round()),U.y>=m&&G.y>=m||(U.y>=m?U=new F(U.x+(m-U.y)/(G.y-U.y)*(G.x-U.x),m)._round():G.y>=m&&(G=new F(U.x+(m-U.y)/(G.y-U.y)*(G.x-U.x),m)._round()),M&&U.equals(M[M.length-1])||(M=[U],v.push(M)),M.push(G)))))}}return v}Ot("FeatureIndex",ze,{omit:["rawTileData","sourceLayerCoder"]});class cn extends F{constructor(t,r,u,m){super(t,r),this.angle=u,m!==void 0&&(this.segment=m)}clone(){return new cn(this.x,this.y,this.angle,this.segment)}}function Tn(n,t,r,u,m){if(t.segment===void 0||r===0)return!0;let v=t,x=t.segment+1,C=0;for(;C>-r/2;){if(x--,x<0)return!1;C-=n[x].dist(v),v=n[x]}C+=n[x].dist(n[x+1]),x++;const M=[];let O=0;for(;C<r/2;){const U=n[x],G=n[x+1];if(!G)return!1;let X=n[x-1].angleTo(U)-U.angleTo(G);for(X=Math.abs((X+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:C,angleDelta:X}),O+=X;C-M[0].distance>u;)O-=M.shift().angleDelta;if(O>m)return!1;x++,C+=U.dist(G)}return!0}function Lr(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function si(n,t,r){return n?.6*t*r:0}function dl(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function xp(n,t,r,u,m,v){const x=si(r,m,v),C=dl(r,u)*v;let M=0;const O=Lr(n)/2;for(let U=0;U<n.length-1;U++){const G=n[U],X=n[U+1],J=G.dist(X);if(M+J>O){const ie=(O-M)/J,ce=Yn.number(G.x,X.x,ie),ye=Yn.number(G.y,X.y,ie),be=new cn(ce,ye,X.angleTo(G),U);return be._round(),!x||Tn(n,be,C,x,t)?be:void 0}M+=J}}function My(n,t,r,u,m,v,x,C,M){const O=si(u,v,x),U=dl(u,m),G=U*x,X=n[0].x===0||n[0].x===M||n[0].y===0||n[0].y===M;return t-G<t/4&&(t=G+t/4),bm(n,X?t/2*C%t:(U/2+2*v)*x*C%t,t,O,r,G,X,!1,M)}function bm(n,t,r,u,m,v,x,C,M){const O=v/2,U=Lr(n);let G=0,X=t-r,J=[];for(let ie=0;ie<n.length-1;ie++){const ce=n[ie],ye=n[ie+1],be=ce.dist(ye),Ue=ye.angleTo(ce);for(;X+r<G+be;){X+=r;const Te=(X-G)/be,Ve=Yn.number(ce.x,ye.x,Te),et=Yn.number(ce.y,ye.y,Te);if(Ve>=0&&Ve<M&&et>=0&&et<M&&X-O>=0&&X+O<=U){const dt=new cn(Ve,et,Ue,ie);dt._round(),u&&!Tn(n,dt,v,u,m)||J.push(dt)}}G+=be}return C||J.length||x||(J=bm(n,G/2,r,u,m,v,x,!0,M)),J}Ot("Anchor",cn);const Fh=Cs;function km(n,t,r,u){const m=[],v=n.image,x=v.pixelRatio,C=v.paddedRect.w-2*Fh,M=v.paddedRect.h-2*Fh;let O={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const U=v.stretchX||[[0,C]],G=v.stretchY||[[0,M]],X=(st,en)=>st+en[1]-en[0],J=U.reduce(X,0),ie=G.reduce(X,0),ce=C-J,ye=M-ie;let be=0,Ue=J,Te=0,Ve=ie,et=0,dt=ce,Dt=0,hn=ye;if(v.content&&u){const st=v.content,en=st[2]-st[0],Wt=st[3]-st[1];(v.textFitWidth||v.textFitHeight)&&(O=Xc(n)),be=Ld(U,0,st[0]),Te=Ld(G,0,st[1]),Ue=Ld(U,st[0],st[2]),Ve=Ld(G,st[1],st[3]),et=st[0]-be,Dt=st[1]-Te,dt=en-Ue,hn=Wt-Ve}const Nt=O.x1,Mt=O.y1,Yt=O.x2-Nt,Gt=O.y2-Mt,Vt=(st,en,Wt,wn)=>{const ki=Rd(st.stretch-be,Ue,Yt,Nt),_i=Nd(st.fixed-et,dt,st.stretch,J),Fr=Rd(en.stretch-Te,Ve,Gt,Mt),Go=Nd(en.fixed-Dt,hn,en.stretch,ie),us=Rd(Wt.stretch-be,Ue,Yt,Nt),Br=Nd(Wt.fixed-et,dt,Wt.stretch,J),Js=Rd(wn.stretch-Te,Ve,Gt,Mt),Qs=Nd(wn.fixed-Dt,hn,wn.stretch,ie),ea=new F(ki,Fr),nr=new F(us,Fr),jr=new F(us,Js),Ps=new F(ki,Js),cs=new F(_i/x,Go/x),ta=new F(Br/x,Qs/x),hs=t*Math.PI/180;if(hs){const ii=Math.sin(hs),Mi=Math.cos(hs),Oi=[Mi,-ii,ii,Mi];ea._matMult(Oi),nr._matMult(Oi),Ps._matMult(Oi),jr._matMult(Oi)}const So=st.stretch+st.fixed,Ta=en.stretch+en.fixed;return{tl:ea,tr:nr,bl:Ps,br:jr,tex:{x:v.paddedRect.x+Fh+So,y:v.paddedRect.y+Fh+Ta,w:Wt.stretch+Wt.fixed-So,h:wn.stretch+wn.fixed-Ta},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cs,pixelOffsetBR:ta,minFontScaleX:dt/x/Yt,minFontScaleY:hn/x/Gt,isSDF:r}};if(u&&(v.stretchX||v.stretchY)){const st=Sm(U,ce,J),en=Sm(G,ye,ie);for(let Wt=0;Wt<st.length-1;Wt++){const wn=st[Wt],ki=st[Wt+1];for(let _i=0;_i<en.length-1;_i++)m.push(Vt(wn,en[_i],ki,en[_i+1]))}}else m.push(Vt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:M+1}));return m}function Ld(n,t,r){let u=0;for(const m of n)u+=Math.max(t,Math.min(r,m[1]))-Math.max(t,Math.min(r,m[0]));return u}function Sm(n,t,r){const u=[{fixed:-Fh,stretch:0}];for(const[m,v]of n){const x=u[u.length-1];u.push({fixed:m-x.stretch,stretch:x.stretch}),u.push({fixed:m-x.stretch,stretch:x.stretch+(v-m)})}return u.push({fixed:t+Fh,stretch:r}),u}function Rd(n,t,r,u){return n/t*r+u}function Nd(n,t,r,u){return n-t*r/u}class zd{constructor(t,r,u,m,v,x,C,M,O,U){var G;if(this.boxStartIndex=t.length,O){let X=x.top,J=x.bottom;const ie=x.collisionPadding;ie&&(X-=ie[1],J+=ie[3]);let ce=J-X;ce>0&&(ce=Math.max(10,ce),this.circleDiameter=ce)}else{const X=!((G=x.image)===null||G===void 0)&&G.content&&(x.image.textFitWidth||x.image.textFitHeight)?Xc(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};X.y1=X.y1*C-M[0],X.y2=X.y2*C+M[2],X.x1=X.x1*C-M[3],X.x2=X.x2*C+M[1];const J=x.collisionPadding;if(J&&(X.x1-=J[0]*C,X.y1-=J[1]*C,X.x2+=J[2]*C,X.y2+=J[3]*C),U){const ie=new F(X.x1,X.y1),ce=new F(X.x2,X.y1),ye=new F(X.x1,X.y2),be=new F(X.x2,X.y2),Ue=U*Math.PI/180;ie._rotate(Ue),ce._rotate(Ue),ye._rotate(Ue),be._rotate(Ue),X.x1=Math.min(ie.x,ce.x,ye.x,be.x),X.x2=Math.max(ie.x,ce.x,ye.x,be.x),X.y1=Math.min(ie.y,ce.y,ye.y,be.y),X.y2=Math.max(ie.y,ce.y,ye.y,be.y)}t.emplaceBack(r.x,r.y,X.x1,X.y1,X.x2,X.y2,u,m,v)}this.boxEndIndex=t.length}}class Ay{constructor(t=[],r=((u,m)=>u<m?-1:u>m?1:0)){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:u}=this,m=r[t];for(;t>0;){const v=t-1>>1,x=r[v];if(u(m,x)>=0)break;r[t]=x,t=v}r[t]=m}_down(t){const{data:r,compare:u}=this,m=this.length>>1,v=r[t];for(;t<m;){let x=1+(t<<1);const C=x+1;if(C<this.length&&u(r[C],r[x])<0&&(x=C),u(r[x],v)>=0)break;r[t]=r[x],t=x}r[t]=v}}function Ly(n,t=1,r=!1){let u=1/0,m=1/0,v=-1/0,x=-1/0;const C=n[0];for(let J=0;J<C.length;J++){const ie=C[J];(!J||ie.x<u)&&(u=ie.x),(!J||ie.y<m)&&(m=ie.y),(!J||ie.x>v)&&(v=ie.x),(!J||ie.y>x)&&(x=ie.y)}const M=Math.min(v-u,x-m);let O=M/2;const U=new Ay([],Ry);if(M===0)return new F(u,m);for(let J=u;J<v;J+=M)for(let ie=m;ie<x;ie+=M)U.push(new Bh(J+O,ie+O,O,n));let G=(function(J){let ie=0,ce=0,ye=0;const be=J[0];for(let Ue=0,Te=be.length,Ve=Te-1;Ue<Te;Ve=Ue++){const et=be[Ue],dt=be[Ve],Dt=et.x*dt.y-dt.x*et.y;ce+=(et.x+dt.x)*Dt,ye+=(et.y+dt.y)*Dt,ie+=3*Dt}return new Bh(ce/ie,ye/ie,0,J)})(n),X=U.length;for(;U.length;){const J=U.pop();(J.d>G.d||!G.d)&&(G=J,r&&console.log("found best %d after %d probes",Math.round(1e4*J.d)/1e4,X)),J.max-G.d<=t||(O=J.h/2,U.push(new Bh(J.p.x-O,J.p.y-O,O,n)),U.push(new Bh(J.p.x+O,J.p.y-O,O,n)),U.push(new Bh(J.p.x-O,J.p.y+O,O,n)),U.push(new Bh(J.p.x+O,J.p.y+O,O,n)),X+=4)}return r&&(console.log(`num probes: ${X}`),console.log(`best distance: ${G.d}`)),G.p}function Ry(n,t){return t.max-n.max}function Bh(n,t,r,u){this.p=new F(n,t),this.h=r,this.d=(function(m,v){let x=!1,C=1/0;for(let M=0;M<v.length;M++){const O=v[M];for(let U=0,G=O.length,X=G-1;U<G;X=U++){const J=O[U],ie=O[X];J.y>m.y!=ie.y>m.y&&m.x<(ie.x-J.x)*(m.y-J.y)/(ie.y-J.y)+J.x&&(x=!x),C=Math.min(C,rf(m,J,ie))}}return(x?1:-1)*Math.sqrt(C)})(this.p,u),this.max=this.d+this.h*Math.SQRT2}var ls;L.aq=void 0,(ls=L.aq||(L.aq={}))[ls.center=1]="center",ls[ls.left=2]="left",ls[ls.right=3]="right",ls[ls.top=4]="top",ls[ls.bottom=5]="bottom",ls[ls["top-left"]=6]="top-left",ls[ls["top-right"]=7]="top-right",ls[ls["bottom-left"]=8]="bottom-left",ls[ls["bottom-right"]=9]="bottom-right";const ic=7,wp=Number.POSITIVE_INFINITY;function Em(n,t){return t[1]!==wp?(function(r,u,m){let v=0,x=0;switch(u=Math.abs(u),m=Math.abs(m),r){case"top-right":case"top-left":case"top":x=m-ic;break;case"bottom-right":case"bottom-left":case"bottom":x=-m+ic}switch(r){case"top-right":case"bottom-right":case"right":v=-u;break;case"top-left":case"bottom-left":case"left":v=u}return[v,x]})(n,t[0],t[1]):(function(r,u){let m=0,v=0;u<0&&(u=0);const x=u/Math.SQRT2;switch(r){case"top-right":case"top-left":v=x-ic;break;case"bottom-right":case"bottom-left":v=-x+ic;break;case"bottom":v=-u+ic;break;case"top":v=u-ic}switch(r){case"top-right":case"bottom-right":m=-x;break;case"top-left":case"bottom-left":m=x;break;case"left":m=u;break;case"right":m=-u}return[m,v]})(n,t[0])}function Im(n,t,r){var u;const m=n.layout,v=(u=m.get("text-variable-anchor-offset"))===null||u===void 0?void 0:u.evaluate(t,{},r);if(v){const C=v.values,M=[];for(let O=0;O<C.length;O+=2){const U=M[O]=C[O],G=C[O+1].map((X=>X*Di));U.startsWith("top")?G[1]-=ic:U.startsWith("bottom")&&(G[1]+=ic),M[O+1]=G}return new Ii(M)}const x=m.get("text-variable-anchor");if(x){let C;C=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(t,{},r)*Di,wp]:m.get("text-offset").evaluate(t,{},r).map((O=>O*Di));const M=[];for(const O of x)M.push(O,Em(O,C));return new Ii(M)}return null}function bp(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ny(n,t,r,u,m,v,x,C,M,O,U){let G=v.textMaxSize.evaluate(t,{});G===void 0&&(G=x);const X=n.layers[0].layout,J=X.get("icon-offset").evaluate(t,{},U),ie=Cm(r.horizontal),ce=x/24,ye=n.tilePixelRatio*ce,be=n.tilePixelRatio*G/24,Ue=n.tilePixelRatio*C,Te=n.tilePixelRatio*X.get("symbol-spacing"),Ve=X.get("text-padding")*n.tilePixelRatio,et=(function(st,en,Wt,wn=1){const ki=st.get("icon-padding").evaluate(en,{},Wt),_i=ki&&ki.values;return[_i[0]*wn,_i[1]*wn,_i[2]*wn,_i[3]*wn]})(X,t,U,n.tilePixelRatio),dt=X.get("text-max-angle")/180*Math.PI,Dt=X.get("text-rotation-alignment")!=="viewport"&&X.get("symbol-placement")!=="point",hn=X.get("icon-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",Nt=X.get("symbol-placement"),Mt=Te/2,Yt=X.get("icon-text-fit");let Gt;u&&Yt!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(Gt=Ql(u,r.vertical,Yt,X.get("icon-text-fit-padding"),J,ce)),ie&&(u=Ql(u,ie,Yt,X.get("icon-text-fit-padding"),J,ce)));const Vt=(st,en)=>{en.x<0||en.x>=Yi||en.y<0||en.y>=Yi||(function(Wt,wn,ki,_i,Fr,Go,us,Br,Js,Qs,ea,nr,jr,Ps,cs,ta,hs,So,Ta,ii,Mi,Oi,$a,Ki,jh){const tu=Wt.addToLineVertexArray(wn,ki);let nu,$o,Eo,Jr,Cu=0,Tf=0,Lm=0,Rm=0,Mp=-1,Ap=-1;const Pu={};let Nm=Vl("");if(Wt.allowVerticalPlacement&&_i.vertical){const Ms=Br.layout.get("text-rotate").evaluate(Mi,{},Ki)+90;Eo=new zd(Js,wn,Qs,ea,nr,_i.vertical,jr,Ps,cs,Ms),us&&(Jr=new zd(Js,wn,Qs,ea,nr,us,hs,So,cs,Ms))}if(Fr){const Ms=Br.layout.get("icon-rotate").evaluate(Mi,{}),Io=Br.layout.get("icon-text-fit")!=="none",Qc=km(Fr,Ms,$a,Io),ml=us?km(us,Ms,$a,Io):void 0;$o=new zd(Js,wn,Qs,ea,nr,Fr,hs,So,!1,Ms),Cu=4*Qc.length;const eh=Wt.iconSizeData;let iu=null;eh.kind==="source"?(iu=[Ga*Br.layout.get("icon-size").evaluate(Mi,{})],iu[0]>qo&&Bt(`${Wt.layerIds[0]}: Value for "icon-size" is >= ${eu}. Reduce your "icon-size".`)):eh.kind==="composite"&&(iu=[Ga*Oi.compositeIconSizes[0].evaluate(Mi,{},Ki),Ga*Oi.compositeIconSizes[1].evaluate(Mi,{},Ki)],(iu[0]>qo||iu[1]>qo)&&Bt(`${Wt.layerIds[0]}: Value for "icon-size" is >= ${eu}. Reduce your "icon-size".`)),Wt.addSymbols(Wt.icon,Qc,iu,ii,Ta,Mi,L.ah.none,wn,tu.lineStartIndex,tu.lineLength,-1,Ki),Mp=Wt.icon.placedSymbolArray.length-1,ml&&(Tf=4*ml.length,Wt.addSymbols(Wt.icon,ml,iu,ii,Ta,Mi,L.ah.vertical,wn,tu.lineStartIndex,tu.lineLength,-1,Ki),Ap=Wt.icon.placedSymbolArray.length-1)}const zm=Object.keys(_i.horizontal);for(const Ms of zm){const Io=_i.horizontal[Ms];if(!nu){Nm=Vl(Io.text);const ml=Br.layout.get("text-rotate").evaluate(Mi,{},Ki);nu=new zd(Js,wn,Qs,ea,nr,Io,jr,Ps,cs,ml)}const Qc=Io.positionedLines.length===1;if(Lm+=Tm(Wt,wn,Io,Go,Br,cs,Mi,ta,tu,_i.vertical?L.ah.horizontal:L.ah.horizontalOnly,Qc?zm:[Ms],Pu,Mp,Oi,Ki),Qc)break}_i.vertical&&(Rm+=Tm(Wt,wn,_i.vertical,Go,Br,cs,Mi,ta,tu,L.ah.vertical,["vertical"],Pu,Ap,Oi,Ki));const Oy=nu?nu.boxStartIndex:Wt.collisionBoxArray.length,Fy=nu?nu.boxEndIndex:Wt.collisionBoxArray.length,By=Eo?Eo.boxStartIndex:Wt.collisionBoxArray.length,jy=Eo?Eo.boxEndIndex:Wt.collisionBoxArray.length,Vy=$o?$o.boxStartIndex:Wt.collisionBoxArray.length,Uy=$o?$o.boxEndIndex:Wt.collisionBoxArray.length,qy=Jr?Jr.boxStartIndex:Wt.collisionBoxArray.length,Gy=Jr?Jr.boxEndIndex:Wt.collisionBoxArray.length;let pl=-1;const Od=(Ms,Io)=>Ms&&Ms.circleDiameter?Math.max(Ms.circleDiameter,Io):Io;pl=Od(nu,pl),pl=Od(Eo,pl),pl=Od($o,pl),pl=Od(Jr,pl);const Dm=pl>-1?1:0;Dm&&(pl*=jh/Di),Wt.glyphOffsetArray.length>=tc.MAX_GLYPHS&&Bt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mi.sortKey!==void 0&&Wt.addToSortKeyRanges(Wt.symbolInstances.length,Mi.sortKey);const $y=Im(Br,Mi,Ki),[Zy,Hy]=(function(Ms,Io){const Qc=Ms.length,ml=Io?.values;if(ml?.length>0)for(let eh=0;eh<ml.length;eh+=2){const iu=ml[eh+1];Ms.emplaceBack(L.aq[ml[eh]],iu[0],iu[1])}return[Qc,Ms.length]})(Wt.textAnchorOffsets,$y);Wt.symbolInstances.emplaceBack(wn.x,wn.y,Pu.right>=0?Pu.right:-1,Pu.center>=0?Pu.center:-1,Pu.left>=0?Pu.left:-1,Pu.vertical||-1,Mp,Ap,Nm,Oy,Fy,By,jy,Vy,Uy,qy,Gy,Qs,Lm,Rm,Cu,Tf,Dm,0,jr,pl,Zy,Hy)})(n,en,st,r,u,m,Gt,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,ye,[Ve,Ve,Ve,Ve],Dt,M,Ue,et,hn,J,t,v,O,U,x)};if(Nt==="line")for(const st of _n(t.geometry,0,0,Yi,Yi)){const en=My(st,Te,dt,r.vertical||ie,u,24,be,n.overscaling,Yi);for(const Wt of en)ie&&zy(n,ie.text,Mt,Wt)||Vt(st,Wt)}else if(Nt==="line-center"){for(const st of t.geometry)if(st.length>1){const en=xp(st,dt,r.vertical||ie,u,24,be);en&&Vt(st,en)}}else if(t.type==="Polygon")for(const st of No(t.geometry,0)){const en=Ly(st,16);Vt(st[0],new cn(en.x,en.y,0))}else if(t.type==="LineString")for(const st of t.geometry)Vt(st,new cn(st[0].x,st[0].y,0));else if(t.type==="Point")for(const st of t.geometry)for(const en of st)Vt([en],new cn(en.x,en.y,0))}function Tm(n,t,r,u,m,v,x,C,M,O,U,G,X,J,ie){const ce=(function(Ue,Te,Ve,et,dt,Dt,hn,Nt){const Mt=et.layout.get("text-rotate").evaluate(Dt,{})*Math.PI/180,Yt=[];for(const Gt of Te.positionedLines)for(const Vt of Gt.positionedGlyphs){if(!Vt.rect)continue;const st=Vt.rect||{};let en=Ah+1,Wt=!0,wn=1,ki=0;const _i=(dt||Nt)&&Vt.vertical,Fr=Vt.metrics.advance*Vt.scale/2;if(Nt&&Te.verticalizable&&(ki=Gt.lineOffset/2-(Vt.imageName?-(Di-Vt.metrics.width*Vt.scale)/2:(Vt.scale-1)*Di)),Vt.imageName){const ii=hn[Vt.imageName];Wt=ii.sdf,wn=ii.pixelRatio,en=Cs/wn}const Go=dt?[Vt.x+Fr,Vt.y]:[0,0];let us=dt?[0,0]:[Vt.x+Fr+Ve[0],Vt.y+Ve[1]-ki],Br=[0,0];_i&&(Br=us,us=[0,0]);const Js=Vt.metrics.isDoubleResolution?2:1,Qs=(Vt.metrics.left-en)*Vt.scale-Fr+us[0],ea=(-Vt.metrics.top-en)*Vt.scale+us[1],nr=Qs+st.w/Js*Vt.scale/wn,jr=ea+st.h/Js*Vt.scale/wn,Ps=new F(Qs,ea),cs=new F(nr,ea),ta=new F(Qs,jr),hs=new F(nr,jr);if(_i){const ii=new F(-Fr,Fr-bo),Mi=-Math.PI/2,Oi=Di/2-Fr,$a=new F(5-bo-Oi,-(Vt.imageName?Oi:0)),Ki=new F(...Br);Ps._rotateAround(Mi,ii)._add($a)._add(Ki),cs._rotateAround(Mi,ii)._add($a)._add(Ki),ta._rotateAround(Mi,ii)._add($a)._add(Ki),hs._rotateAround(Mi,ii)._add($a)._add(Ki)}if(Mt){const ii=Math.sin(Mt),Mi=Math.cos(Mt),Oi=[Mi,-ii,ii,Mi];Ps._matMult(Oi),cs._matMult(Oi),ta._matMult(Oi),hs._matMult(Oi)}const So=new F(0,0),Ta=new F(0,0);Yt.push({tl:Ps,tr:cs,bl:ta,br:hs,tex:st,writingMode:Te.writingMode,glyphOffset:Go,sectionIndex:Vt.sectionIndex,isSDF:Wt,pixelOffsetTL:So,pixelOffsetBR:Ta,minFontScaleX:0,minFontScaleY:0})}return Yt})(0,r,C,m,v,x,u,n.allowVerticalPlacement),ye=n.textSizeData;let be=null;ye.kind==="source"?(be=[Ga*m.layout.get("text-size").evaluate(x,{})],be[0]>qo&&Bt(`${n.layerIds[0]}: Value for "text-size" is >= ${eu}. Reduce your "text-size".`)):ye.kind==="composite"&&(be=[Ga*J.compositeTextSizes[0].evaluate(x,{},ie),Ga*J.compositeTextSizes[1].evaluate(x,{},ie)],(be[0]>qo||be[1]>qo)&&Bt(`${n.layerIds[0]}: Value for "text-size" is >= ${eu}. Reduce your "text-size".`)),n.addSymbols(n.text,ce,be,C,v,x,O,t,M.lineStartIndex,M.lineLength,X,ie);for(const Ue of U)G[Ue]=n.text.placedSymbolArray.length-1;return 4*ce.length}function Cm(n){for(const t in n)return n[t];return null}function zy(n,t,r,u){const m=n.compareText;if(t in m){const v=m[t];for(let x=v.length-1;x>=0;x--)if(u.dist(v[x])<r)return!0}else m[t]=[];return m[t].push(u),!1}const Pm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class kp{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,u]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=u>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const v=Pm[15&u];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(t,2,1),[C]=new Uint32Array(t,4,1);return new kp(C,x,v,t)}constructor(t,r=64,u=Float64Array,m){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=u,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const v=Pm.indexOf(this.ArrayType),x=2*t*this.ArrayType.BYTES_PER_ELEMENT,C=t*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-C%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${u}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+C+M,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+x+C+M),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+C+M,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=t,this.coords[this._pos++]=r,u}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Sp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,u,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:C}=this,M=[0,v.length-1,0],O=[];for(;M.length;){const U=M.pop()||0,G=M.pop()||0,X=M.pop()||0;if(G-X<=C){for(let ye=X;ye<=G;ye++){const be=x[2*ye],Ue=x[2*ye+1];be>=t&&be<=u&&Ue>=r&&Ue<=m&&O.push(v[ye])}continue}const J=X+G>>1,ie=x[2*J],ce=x[2*J+1];ie>=t&&ie<=u&&ce>=r&&ce<=m&&O.push(v[J]),(U===0?t<=ie:r<=ce)&&(M.push(X),M.push(J-1),M.push(1-U)),(U===0?u>=ie:m>=ce)&&(M.push(J+1),M.push(G),M.push(1-U))}return O}within(t,r,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:v,nodeSize:x}=this,C=[0,m.length-1,0],M=[],O=u*u;for(;C.length;){const U=C.pop()||0,G=C.pop()||0,X=C.pop()||0;if(G-X<=x){for(let ye=X;ye<=G;ye++)Am(v[2*ye],v[2*ye+1],t,r)<=O&&M.push(m[ye]);continue}const J=X+G>>1,ie=v[2*J],ce=v[2*J+1];Am(ie,ce,t,r)<=O&&M.push(m[J]),(U===0?t-u<=ie:r-u<=ce)&&(C.push(X),C.push(J-1),C.push(1-U)),(U===0?t+u>=ie:r+u>=ce)&&(C.push(J+1),C.push(G),C.push(1-U))}return M}}function Sp(n,t,r,u,m,v){if(m-u<=r)return;const x=u+m>>1;Mm(n,t,x,u,m,v),Sp(n,t,r,u,x-1,1-v),Sp(n,t,r,x+1,m,1-v)}function Mm(n,t,r,u,m,v){for(;m>u;){if(m-u>600){const O=m-u+1,U=r-u+1,G=Math.log(O),X=.5*Math.exp(2*G/3),J=.5*Math.sqrt(G*X*(O-X)/O)*(U-O/2<0?-1:1);Mm(n,t,r,Math.max(u,Math.floor(r-U*X/O+J)),Math.min(m,Math.floor(r+(O-U)*X/O+J)),v)}const x=t[2*r+v];let C=u,M=m;for(Ef(n,t,u,r),t[2*m+v]>x&&Ef(n,t,u,m);C<M;){for(Ef(n,t,C,M),C++,M--;t[2*C+v]<x;)C++;for(;t[2*M+v]>x;)M--}t[2*u+v]===x?Ef(n,t,u,M):(M++,Ef(n,t,M,m)),M<=r&&(u=M+1),r<=M&&(m=M-1)}}function Ef(n,t,r,u){Ep(n,r,u),Ep(t,2*r,2*u),Ep(t,2*r+1,2*u+1)}function Ep(n,t,r){const u=n[t];n[t]=n[r],n[r]=u}function Am(n,t,r,u){const m=n-r,v=t-u;return m*m+v*v}var Ip;L.bg=void 0,(Ip=L.bg||(L.bg={})).create="create",Ip.load="load",Ip.fullLoad="fullLoad";let Dd=null,If=[];const Tp=1e3/60,Cp="loadTime",Pp="fullLoadTime",Dy={mark(n){performance.mark(n)},frame(n){const t=n;Dd!=null&&If.push(t-Dd),Dd=t},clearMetrics(){Dd=null,If=[],performance.clearMeasures(Cp),performance.clearMeasures(Pp);for(const n in L.bg)performance.clearMarks(L.bg[n])},getPerformanceMetrics(){performance.measure(Cp,L.bg.create,L.bg.load),performance.measure(Pp,L.bg.create,L.bg.fullLoad);const n=performance.getEntriesByName(Cp)[0].duration,t=performance.getEntriesByName(Pp)[0].duration,r=If.length,u=1/(If.reduce(((v,x)=>v+x),0)/r/1e3),m=If.filter((v=>v>Tp)).reduce(((v,x)=>v+(x-Tp)/Tp),0);return{loadTime:n,fullLoadTime:t,fps:u,percentDroppedFrames:m/(r+m)*100,totalFrames:r}}};L.$=class extends ${},L.A=Hu,L.B=_c,L.C=function(n){if(an==null){const t=n.navigator?n.navigator.userAgent:null;an=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return an},L.D=Ft,L.E=Rr,L.F=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new a((()=>this.process())),this.subscription=(function(r,u,m,v){return r.addEventListener(u,m,!1),{unsubscribe:()=>{r.removeEventListener(u,m,!1)}}})(this.target,"message",(r=>this.receive(r))),this.globalScope=zt(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise(((r,u)=>{const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[m]={resolve:r,reject:u},t&&t.signal.addEventListener("abort",(()=>{delete this.resolveRejects[m];const C={id:m,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(C)}),{once:!0});const v=[],x=Object.assign(Object.assign({},n),{id:m,sourceMapId:this.mapId,origin:location.origin,data:Xr(n.data,v)});this.target.postMessage(x,{transfer:v})}))}receive(n){const t=n.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const u=this.abortControllers[r];return delete this.abortControllers[r],void(u&&u.abort())}if(zt(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return c(this,void 0,void 0,(function*(){if(t.type==="<response>"){const m=this.resolveRejects[n];return delete this.resolveRejects[n],m?void(t.error?m.reject(ja(t.error)):m.resolve(ja(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=ja(t.data),u=new AbortController;this.abortControllers[n]=u;try{const m=yield this.messageHandlers[t.type](t.sourceMapId,r,u);this.completeTask(n,null,m)}catch(m){this.completeTask(n,m)}}))}completeTask(n,t,r){const u=[];delete this.abortControllers[n];const m={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Xr(t):null,data:Xr(r,u)};this.target.postMessage(m,{transfer:u})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},L.G=Dn,L.H=function(){var n=new Hu(16);return Hu!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},L.I=xf,L.J=function(n,t,r){var u,m,v,x,C,M,O,U,G,X,J,ie,ce=r[0],ye=r[1],be=r[2];return t===n?(n[12]=t[0]*ce+t[4]*ye+t[8]*be+t[12],n[13]=t[1]*ce+t[5]*ye+t[9]*be+t[13],n[14]=t[2]*ce+t[6]*ye+t[10]*be+t[14],n[15]=t[3]*ce+t[7]*ye+t[11]*be+t[15]):(m=t[1],v=t[2],x=t[3],C=t[4],M=t[5],O=t[6],U=t[7],G=t[8],X=t[9],J=t[10],ie=t[11],n[0]=u=t[0],n[1]=m,n[2]=v,n[3]=x,n[4]=C,n[5]=M,n[6]=O,n[7]=U,n[8]=G,n[9]=X,n[10]=J,n[11]=ie,n[12]=u*ce+C*ye+G*be+t[12],n[13]=m*ce+M*ye+X*be+t[13],n[14]=v*ce+O*ye+J*be+t[14],n[15]=x*ce+U*ye+ie*be+t[15]),n},L.K=function(n,t,r){var u=r[0],m=r[1],v=r[2];return n[0]=t[0]*u,n[1]=t[1]*u,n[2]=t[2]*u,n[3]=t[3]*u,n[4]=t[4]*m,n[5]=t[5]*m,n[6]=t[6]*m,n[7]=t[7]*m,n[8]=t[8]*v,n[9]=t[9]*v,n[10]=t[10]*v,n[11]=t[11]*v,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},L.L=of,L.M=function(n,t){const r={};for(let u=0;u<t.length;u++){const m=t[u];m in n&&(r[m]=n[m])}return r},L.N=g,L.O=j,L.P=F,L.Q=ne,L.R=Or,L.S=Rt,L.T=Cr,L.U=Be,L.V=Ce,L.W=jt,L.X=Yi,L.Y=P,L.Z=Je,L._=c,L.a=Pt,L.a$=function(n,t){var r=n[0],u=n[1],m=n[2],v=n[3],x=n[4],C=n[5],M=n[6],O=n[7],U=n[8],G=n[9],X=n[10],J=n[11],ie=n[12],ce=n[13],ye=n[14],be=n[15],Ue=t[0],Te=t[1],Ve=t[2],et=t[3],dt=t[4],Dt=t[5],hn=t[6],Nt=t[7],Mt=t[8],Yt=t[9],Gt=t[10],Vt=t[11],st=t[12],en=t[13],Wt=t[14],wn=t[15];return Math.abs(r-Ue)<=rs*Math.max(1,Math.abs(r),Math.abs(Ue))&&Math.abs(u-Te)<=rs*Math.max(1,Math.abs(u),Math.abs(Te))&&Math.abs(m-Ve)<=rs*Math.max(1,Math.abs(m),Math.abs(Ve))&&Math.abs(v-et)<=rs*Math.max(1,Math.abs(v),Math.abs(et))&&Math.abs(x-dt)<=rs*Math.max(1,Math.abs(x),Math.abs(dt))&&Math.abs(C-Dt)<=rs*Math.max(1,Math.abs(C),Math.abs(Dt))&&Math.abs(M-hn)<=rs*Math.max(1,Math.abs(M),Math.abs(hn))&&Math.abs(O-Nt)<=rs*Math.max(1,Math.abs(O),Math.abs(Nt))&&Math.abs(U-Mt)<=rs*Math.max(1,Math.abs(U),Math.abs(Mt))&&Math.abs(G-Yt)<=rs*Math.max(1,Math.abs(G),Math.abs(Yt))&&Math.abs(X-Gt)<=rs*Math.max(1,Math.abs(X),Math.abs(Gt))&&Math.abs(J-Vt)<=rs*Math.max(1,Math.abs(J),Math.abs(Vt))&&Math.abs(ie-st)<=rs*Math.max(1,Math.abs(ie),Math.abs(st))&&Math.abs(ce-en)<=rs*Math.max(1,Math.abs(ce),Math.abs(en))&&Math.abs(ye-Wt)<=rs*Math.max(1,Math.abs(ye),Math.abs(Wt))&&Math.abs(be-wn)<=rs*Math.max(1,Math.abs(be),Math.abs(wn))},L.a0=Ln,L.a1=xt,L.a2=Qe,L.a3=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((r=>{t.onloadstart=()=>{r(t)};for(const u of n){const m=window.document.createElement("source");Cn(u)||(t.crossOrigin="Anonymous"),m.src=u,t.appendChild(m)}}))},L.a4=function(){return ht++},L.a5=Ct,L.a6=tc,L.a7=At,L.a8=$l,L.a9=He,L.aA=function(n){if(n.type==="custom")return new Oh(n);switch(n.type){case"background":return new Dh(n);case"circle":return new lp(n);case"fill":return new cp(n);case"fill-extrusion":return new md(n);case"heatmap":return new up(n);case"hillshade":return new ed(n);case"line":return new Ju(n);case"raster":return new vp(n);case"symbol":return new Tu(n)}},L.aB=wt,L.aC=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let r=[];try{if(!lt(n.version,t.version))return[{command:"setStyle",args:[t]}];lt(n.center,t.center)||r.push({command:"setCenter",args:[t.center]}),lt(n.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),lt(n.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),lt(n.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),lt(n.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),lt(n.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),lt(n.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),lt(n.light,t.light)||r.push({command:"setLight",args:[t.light]}),lt(n.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),lt(n.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),lt(n.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const u={},m=[];(function(x,C,M,O){let U;for(U in C=C||{},x=x||{})Object.prototype.hasOwnProperty.call(x,U)&&(Object.prototype.hasOwnProperty.call(C,U)||pr(U,M,O));for(U in C)Object.prototype.hasOwnProperty.call(C,U)&&(Object.prototype.hasOwnProperty.call(x,U)?lt(x[U],C[U])||(x[U].type==="geojson"&&C[U].type==="geojson"&&vn(x,C,U)?ai(M,{command:"setGeoJSONSourceData",args:[U,C[U].data]}):As(U,C,M,O)):ps(U,C,M))})(n.sources,t.sources,m,u);const v=[];n.layers&&n.layers.forEach((x=>{"source"in x&&u[x.source]?r.push({command:"removeLayer",args:[x.id]}):v.push(x)})),r=r.concat(m),(function(x,C,M){C=C||[];const O=(x=x||[]).map(aa),U=C.map(aa),G=x.reduce(oa,{}),X=C.reduce(oa,{}),J=O.slice(),ie=Object.create(null);let ce,ye,be,Ue,Te;for(let Ve=0,et=0;Ve<O.length;Ve++)ce=O[Ve],Object.prototype.hasOwnProperty.call(X,ce)?et++:(ai(M,{command:"removeLayer",args:[ce]}),J.splice(J.indexOf(ce,et),1));for(let Ve=0,et=0;Ve<U.length;Ve++)ce=U[U.length-1-Ve],J[J.length-1-Ve]!==ce&&(Object.prototype.hasOwnProperty.call(G,ce)?(ai(M,{command:"removeLayer",args:[ce]}),J.splice(J.lastIndexOf(ce,J.length-et),1)):et++,Ue=J[J.length-Ve],ai(M,{command:"addLayer",args:[X[ce],Ue]}),J.splice(J.length-Ve,0,ce),ie[ce]=!0);for(let Ve=0;Ve<U.length;Ve++)if(ce=U[Ve],ye=G[ce],be=X[ce],!ie[ce]&&!lt(ye,be))if(lt(ye.source,be.source)&&lt(ye["source-layer"],be["source-layer"])&&lt(ye.type,be.type)){for(Te in ir(ye.layout,be.layout,M,ce,null,"setLayoutProperty"),ir(ye.paint,be.paint,M,ce,null,"setPaintProperty"),lt(ye.filter,be.filter)||ai(M,{command:"setFilter",args:[ce,be.filter]}),lt(ye.minzoom,be.minzoom)&&lt(ye.maxzoom,be.maxzoom)||ai(M,{command:"setLayerZoomRange",args:[ce,be.minzoom,be.maxzoom]}),ye)Object.prototype.hasOwnProperty.call(ye,Te)&&Te!=="layout"&&Te!=="paint"&&Te!=="filter"&&Te!=="metadata"&&Te!=="minzoom"&&Te!=="maxzoom"&&(Te.indexOf("paint.")===0?ir(ye[Te],be[Te],M,ce,Te.slice(6),"setPaintProperty"):lt(ye[Te],be[Te])||ai(M,{command:"setLayerProperty",args:[ce,Te,be[Te]]}));for(Te in be)Object.prototype.hasOwnProperty.call(be,Te)&&!Object.prototype.hasOwnProperty.call(ye,Te)&&Te!=="layout"&&Te!=="paint"&&Te!=="filter"&&Te!=="metadata"&&Te!=="minzoom"&&Te!=="maxzoom"&&(Te.indexOf("paint.")===0?ir(ye[Te],be[Te],M,ce,Te.slice(6),"setPaintProperty"):lt(ye[Te],be[Te])||ai(M,{command:"setLayerProperty",args:[ce,Te,be[Te]]}))}else ai(M,{command:"removeLayer",args:[ce]}),Ue=J[J.lastIndexOf(ce)+1],ai(M,{command:"addLayer",args:[be,Ue]})})(v,t.layers,r)}catch(u){console.warn("Unable to compute style diff:",u),r=[{command:"setStyle",args:[t]}]}return r},L.aD=function(n){const t=[],r=n.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},L.aE=function n(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let u=0;u<t.length;u++)if(!n(t[u],r[u]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const u in t)if(!n(t[u],r[u]))return!1;return!0}return t===r},L.aF=ft,L.aG=$t,L.aH=class extends qi{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},L.aI=lr,L.aJ=class extends qi{constructor(n,t){super(n,t),this.current=Sc}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},L.aK=kc,L.aL=$u,L.aM=fn,L.aN=class extends qi{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},L.aO=class extends qi{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},L.aP=function(n,t,r,u,m,v,x){var C=1/(t-r),M=1/(u-m),O=1/(v-x);return n[0]=-2*C,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*M,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*O,n[11]=0,n[12]=(t+r)*C,n[13]=(m+u)*M,n[14]=(x+v)*O,n[15]=1,n},L.aQ=hh,L.aR=class extends Ae{},L.aS=Bc,L.aT=class extends qe{},L.aU=Mc,L.aV=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},L.aW=yh,L.aX=Zi,L.aY=Zs,L.aZ=class extends qt{},L.a_=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},L.aa=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,u,m,v)=>{const x=m||v;return t[u]=!x||x.toLowerCase(),""})),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},L.ab=function(n,t){const r=[];for(const u in n)u in t||r.push(u);return r},L.ac=We,L.ad=function(n,t,r){var u=Math.sin(r),m=Math.cos(r),v=t[0],x=t[1],C=t[2],M=t[3],O=t[4],U=t[5],G=t[6],X=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=v*m+O*u,n[1]=x*m+U*u,n[2]=C*m+G*u,n[3]=M*m+X*u,n[4]=O*m-v*u,n[5]=U*m-x*u,n[6]=G*m-C*u,n[7]=X*m-M*u,n},L.ae=function(n){var t=new Hu(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},L.af=fh,L.ag=function(n,t){let r=0,u=0;if(n.kind==="constant")u=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:m,minZoom:v,maxZoom:x}=n,C=m?We(Vi.interpolationFactor(m,t,v,x),0,1):0;n.kind==="camera"?u=Yn.number(n.minSize,n.maxSize,C):r=C}return{uSizeT:r,uSize:u}},L.ai=function(n,{uSize:t,uSizeT:r},{lowerSize:u,upperSize:m}){return n.kind==="source"?u/Ga:n.kind==="composite"?Yn.number(u/Ga,m/Ga,r):t},L.aj=ec,L.ak=function(n,t,r,u){const m=t.y-n.y,v=t.x-n.x,x=u.y-r.y,C=u.x-r.x,M=x*v-C*m;if(M===0)return null;const O=(C*(n.y-r.y)-x*(n.x-r.x))/M;return new F(n.x+O*v,n.y+O*m)},L.al=_n,L.am=tf,L.an=ch,L.ao=function(n){let t=1/0,r=1/0,u=-1/0,m=-1/0;for(const v of n)t=Math.min(t,v.x),r=Math.min(r,v.y),u=Math.max(u,v.x),m=Math.max(m,v.y);return[t,r,u,m]},L.ap=Di,L.ar=Wc,L.as=function(n,t){var r=t[0],u=t[1],m=t[2],v=t[3],x=t[4],C=t[5],M=t[6],O=t[7],U=t[8],G=t[9],X=t[10],J=t[11],ie=t[12],ce=t[13],ye=t[14],be=t[15],Ue=r*C-u*x,Te=r*M-m*x,Ve=r*O-v*x,et=u*M-m*C,dt=u*O-v*C,Dt=m*O-v*M,hn=U*ce-G*ie,Nt=U*ye-X*ie,Mt=U*be-J*ie,Yt=G*ye-X*ce,Gt=G*be-J*ce,Vt=X*be-J*ye,st=Ue*Vt-Te*Gt+Ve*Yt+et*Mt-dt*Nt+Dt*hn;return st?(n[0]=(C*Vt-M*Gt+O*Yt)*(st=1/st),n[1]=(m*Gt-u*Vt-v*Yt)*st,n[2]=(ce*Dt-ye*dt+be*et)*st,n[3]=(X*dt-G*Dt-J*et)*st,n[4]=(M*Mt-x*Vt-O*Nt)*st,n[5]=(r*Vt-m*Mt+v*Nt)*st,n[6]=(ye*Ve-ie*Dt-be*Te)*st,n[7]=(U*Dt-X*Ve+J*Te)*st,n[8]=(x*Gt-C*Mt+O*hn)*st,n[9]=(u*Mt-r*Gt-v*hn)*st,n[10]=(ie*dt-ce*Ve+be*Ue)*st,n[11]=(G*Ve-U*dt-J*Ue)*st,n[12]=(C*Nt-x*Yt-M*hn)*st,n[13]=(r*Yt-u*Nt+m*hn)*st,n[14]=(ce*Te-ie*et-ye*Ue)*st,n[15]=(U*et-G*Te+X*Ue)*st,n):null},L.at=bp,L.au=Hc,L.av=kp,L.aw=function(){const n={},t=Ye.$version;for(const r in Ye.$root){const u=Ye.$root[r];if(u.required){let m=null;m=r==="version"?t:u.type==="array"?[]:{},m!=null&&(n[r]=m)}}return n},L.ax=ma,L.ay=Ne,L.az=function(n){n=n.slice();const t=Object.create(null);for(let r=0;r<n.length;r++)t[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=Co(n[r],t[n[r].ref]));return n},L.b=rn,L.b0=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},L.b1=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},L.b2=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},L.b3=tt,L.b4=mt,L.b5=xe,L.b6=function(n,t,r,u,m){var v,x=1/Math.tan(t/2);return n[0]=x/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,m!=null&&m!==1/0?(n[10]=(m+u)*(v=1/(u-m)),n[14]=2*m*u*v):(n[10]=-1,n[14]=-2*u),n},L.b7=function(n,t,r){var u=Math.sin(r),m=Math.cos(r),v=t[4],x=t[5],C=t[6],M=t[7],O=t[8],U=t[9],G=t[10],X=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=v*m+O*u,n[5]=x*m+U*u,n[6]=C*m+G*u,n[7]=M*m+X*u,n[8]=O*m-v*u,n[9]=U*m-x*u,n[10]=G*m-C*u,n[11]=X*m-M*u,n},L.b8=Ge,L.b9=it,L.bA=Uo,L.bB=function(n){return n.message===rt},L.bC=R,L.bD=ui,L.ba=function(n){return n*Math.PI/180},L.bb=function(n,t){const{x:r,y:u}=Je.fromLngLat(t);return!(n<0||n>25||u<0||u>=1||r<0||r>=1)},L.bc=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},L.bd=class extends V{},L.be=l,L.bf=Dy,L.bh=Rn,L.bi=function(n,t){Pt.REGISTERED_PROTOCOLS[n]=t},L.bj=function(n){delete Pt.REGISTERED_PROTOCOLS[n]},L.bk=function(n,t){const r={};for(let m=0;m<n.length;m++){const v=t&&t[n[m].id]||oo(n[m]);t&&(t[n[m].id]=v);let x=r[v];x||(x=r[v]=[]),x.push(n[m])}const u=[];for(const m in r)u.push(r[m]);return u},L.bl=Ot,L.bm=tr,L.bn=ze,L.bo=wf,L.bp=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Yi/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],r=t.layout,u=t._unevaluatedLayout._values,m={layoutIconSize:u["icon-size"].possiblyEvaluate(new On(n.bucket.zoom+1),n.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new On(n.bucket.zoom+1),n.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new On(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:U}=n.bucket.textSizeData;m.compositeTextSizes=[u["text-size"].possiblyEvaluate(new On(O),n.canonical),u["text-size"].possiblyEvaluate(new On(U),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:U}=n.bucket.iconSizeData;m.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new On(O),n.canonical),u["icon-size"].possiblyEvaluate(new On(U),n.canonical)]}const v=r.get("text-line-height")*Di,x=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",C=r.get("text-keep-upright"),M=r.get("text-size");for(const O of n.bucket.features){const U=r.get("text-font").evaluate(O,{},n.canonical).join(","),G=M.evaluate(O,{},n.canonical),X=m.layoutTextSize.evaluate(O,{},n.canonical),J=m.layoutIconSize.evaluate(O,{},n.canonical),ie={horizontal:{},vertical:void 0},ce=O.text;let ye,be=[0,0];if(ce){const Ve=ce.toString(),et=r.get("text-letter-spacing").evaluate(O,{},n.canonical)*Di,dt=Kh(Ve)?et:0,Dt=r.get("text-anchor").evaluate(O,{},n.canonical),hn=Im(t,O,n.canonical);if(!hn){const Gt=r.get("text-radial-offset").evaluate(O,{},n.canonical);be=Gt?Em(Dt,[Gt*Di,wp]):r.get("text-offset").evaluate(O,{},n.canonical).map((Vt=>Vt*Di))}let Nt=x?"center":r.get("text-justify").evaluate(O,{},n.canonical);const Mt=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(O,{},n.canonical)*Di:1/0,Yt=()=>{n.bucket.allowVerticalPlacement&&vc(Ve)&&(ie.vertical=Zc(ce,n.glyphMap,n.glyphPositions,n.imagePositions,U,Mt,v,Dt,"left",dt,be,L.ah.vertical,!0,X,G))};if(!x&&hn){const Gt=new Set;if(Nt==="auto")for(let st=0;st<hn.values.length;st+=2)Gt.add(bp(hn.values[st]));else Gt.add(Nt);let Vt=!1;for(const st of Gt)if(!ie.horizontal[st])if(Vt)ie.horizontal[st]=ie.horizontal[0];else{const en=Zc(ce,n.glyphMap,n.glyphPositions,n.imagePositions,U,Mt,v,"center",st,dt,be,L.ah.horizontal,!1,X,G);en&&(ie.horizontal[st]=en,Vt=en.positionedLines.length===1)}Yt()}else{Nt==="auto"&&(Nt=bp(Dt));const Gt=Zc(ce,n.glyphMap,n.glyphPositions,n.imagePositions,U,Mt,v,Dt,Nt,dt,be,L.ah.horizontal,!1,X,G);Gt&&(ie.horizontal[Nt]=Gt),Yt(),vc(Ve)&&x&&C&&(ie.vertical=Zc(ce,n.glyphMap,n.glyphPositions,n.imagePositions,U,Mt,v,Dt,Nt,dt,be,L.ah.vertical,!1,X,G))}}let Ue=!1;if(O.icon&&O.icon.name){const Ve=n.imageMap[O.icon.name];Ve&&(ye=Jl(n.imagePositions[O.icon.name],r.get("icon-offset").evaluate(O,{},n.canonical),r.get("icon-anchor").evaluate(O,{},n.canonical)),Ue=!!Ve.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=Ue:n.bucket.sdfIcons!==Ue&&Bt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ve.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const Te=Cm(ie.horizontal)||ie.vertical;n.bucket.iconsInText=!!Te&&Te.iconsInText,(Te||ye)&&Ny(n.bucket,O,ie,ye,n.imageMap,m,X,J,be,Ue,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},L.bq=Xs,L.br=wh,L.bs=Ea,L.bt=Hl,L.bu=hl,L.bv=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},L.bw=function(n,t,r,u,m){return c(this,void 0,void 0,(function*(){if(Ce())try{return yield jt(n,t,r,u,m)}catch{}return(function(v,x,C,M,O){const U=v.width,G=v.height;nt&&Re||(nt=new OffscreenCanvas(U,G),Re=nt.getContext("2d",{willReadFrequently:!0})),nt.width=U,nt.height=G,Re.drawImage(v,0,0,U,G);const X=Re.getImageData(x,C,M,O);return Re.clearRect(0,0,U,G),X.data})(n,t,r,u,m)}))},L.bx=nn,L.by=W,L.bz=ee,L.c=on,L.d=n=>c(void 0,void 0,void 0,(function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),L.e=at,L.f=n=>new Promise(((t,r)=>{const u=new Image;u.onload=()=>{t(u),URL.revokeObjectURL(u.src),u.onload=null,window.requestAnimationFrame((()=>{u.src=bt}))},u.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const m=new Blob([new Uint8Array(n)],{type:"image/png"});u.src=n.byteLength?URL.createObjectURL(m):bt})),L.g=yn,L.h=(n,t)=>ei(at(n,{type:"json"}),t),L.i=zt,L.j=Vr,L.k=$i,L.l=(n,t)=>ei(at(n,{type:"arrayBuffer"}),t),L.m=ei,L.n=function(n){return new hl(n).readFields(Iu,[])},L.o=xu,L.p=Gc,L.q=_,L.r=yc,L.s=Cn,L.t=Uu,L.u=po,L.v=Ye,L.w=Bt,L.x=function([n,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(r),y:n*Math.sin(t)*Math.sin(r),z:n*Math.cos(r)}},L.y=Yn,L.z=On})),T("worker",["./shared"],(function(L){class c{constructor(K){this.keyCache={},K&&this.replace(K)}replace(K){this._layerConfigs={},this._layers={},this.update(K,[])}update(K,Y){for(const ae of K){this._layerConfigs[ae.id]=ae;const Ee=this._layers[ae.id]=L.aA(ae);Ee._featureFilter=L.a7(Ee.filter),this.keyCache[ae.id]&&delete this.keyCache[ae.id]}for(const ae of Y)delete this.keyCache[ae],delete this._layerConfigs[ae],delete this._layers[ae];this.familiesBySource={};const oe=L.bk(Object.values(this._layerConfigs),this.keyCache);for(const ae of oe){const Ee=ae.map((Ze=>this._layers[Ze.id])),Me=Ee[0];if(Me.visibility==="none")continue;const Fe=Me.source||"";let ke=this.familiesBySource[Fe];ke||(ke=this.familiesBySource[Fe]={});const Ke=Me.sourceLayer||"_geojsonTileLayer";let ut=ke[Ke];ut||(ut=ke[Ke]=[]),ut.push(Ee)}}}class W{constructor(K){const Y={},oe=[];for(const Fe in K){const ke=K[Fe],Ke=Y[Fe]={};for(const ut in ke){const Ze=ke[+ut];if(!Ze||Ze.bitmap.width===0||Ze.bitmap.height===0)continue;const vt={x:0,y:0,w:Ze.bitmap.width+2,h:Ze.bitmap.height+2};oe.push(vt),Ke[ut]={rect:vt,metrics:Ze.metrics}}}const{w:ae,h:Ee}=L.p(oe),Me=new L.o({width:ae||1,height:Ee||1});for(const Fe in K){const ke=K[Fe];for(const Ke in ke){const ut=ke[+Ke];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;const Ze=Y[Fe][Ke].rect;L.o.copy(ut.bitmap,Me,{x:0,y:0},{x:Ze.x+1,y:Ze.y+1},ut.bitmap)}}this.image=Me,this.positions=Y}}L.bl("GlyphAtlas",W);class ee{constructor(K){this.tileID=new L.S(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.uid=K.uid,this.zoom=K.zoom,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=K.showCollisionBoxes,this.collectResourceTiming=!!K.collectResourceTiming,this.returnDependencies=!!K.returnDependencies,this.promoteId=K.promoteId,this.inFlightDependencies=[]}parse(K,Y,oe,ae){return L._(this,void 0,void 0,(function*(){this.status="parsing",this.data=K,this.collisionBoxArray=new L.a5;const Ee=new L.bm(Object.keys(K.layers).sort()),Me=new L.bn(this.tileID,this.promoteId);Me.bucketLayerIDs=[];const Fe={},ke={featureIndex:Me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:oe},Ke=Y.familiesBySource[this.source];for(const xn in Ke){const Hn=K.layers[xn];if(!Hn)continue;Hn.version===1&&L.w(`Vector tile source "${this.source}" layer "${xn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ri=Ee.encode(xn),Ei=[];for(let Bn=0;Bn<Hn.length;Bn++){const Er=Hn.feature(Bn),Po=Me.getId(Er,xn);Ei.push({feature:Er,id:Po,index:Bn,sourceLayerIndex:ri})}for(const Bn of Ke[xn]){const Er=Bn[0];Er.source!==this.source&&L.w(`layer.source = ${Er.source} does not equal this.source = ${this.source}`),Er.minzoom&&this.zoom<Math.floor(Er.minzoom)||Er.maxzoom&&this.zoom>=Er.maxzoom||Er.visibility!=="none"&&(Q(Bn,this.zoom,oe),(Fe[Er.id]=Er.createBucket({index:Me.bucketLayerIDs.length,layers:Bn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ri,sourceID:this.source})).populate(Ei,ke,this.tileID.canonical),Me.bucketLayerIDs.push(Bn.map((Po=>Po.id))))}}const ut=L.aF(ke.glyphDependencies,(xn=>Object.keys(xn).map(Number)));this.inFlightDependencies.forEach((xn=>xn?.abort())),this.inFlightDependencies=[];let Ze=Promise.resolve({});if(Object.keys(ut).length){const xn=new AbortController;this.inFlightDependencies.push(xn),Ze=ae.sendAsync({type:"GG",data:{stacks:ut,source:this.source,tileID:this.tileID,type:"glyphs"}},xn)}const vt=Object.keys(ke.iconDependencies);let Ut=Promise.resolve({});if(vt.length){const xn=new AbortController;this.inFlightDependencies.push(xn),Ut=ae.sendAsync({type:"GI",data:{icons:vt,source:this.source,tileID:this.tileID,type:"icons"}},xn)}const Qt=Object.keys(ke.patternDependencies);let Fn=Promise.resolve({});if(Qt.length){const xn=new AbortController;this.inFlightDependencies.push(xn),Fn=ae.sendAsync({type:"GI",data:{icons:Qt,source:this.source,tileID:this.tileID,type:"patterns"}},xn)}const[bn,kn,Sn]=yield Promise.all([Ze,Ut,Fn]),pi=new W(bn),ti=new L.bo(kn,Sn);for(const xn in Fe){const Hn=Fe[xn];Hn instanceof L.a6?(Q(Hn.layers,this.zoom,oe),L.bp({bucket:Hn,glyphMap:bn,glyphPositions:pi.positions,imageMap:kn,imagePositions:ti.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Hn.hasPattern&&(Hn instanceof L.bq||Hn instanceof L.br||Hn instanceof L.bs)&&(Q(Hn.layers,this.zoom,oe),Hn.addFeatures(ke,this.tileID.canonical,ti.patternPositions))}return this.status="done",{buckets:Object.values(Fe).filter((xn=>!xn.isEmpty())),featureIndex:Me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pi.image,imageAtlas:ti,glyphMap:this.returnDependencies?bn:null,iconMap:this.returnDependencies?kn:null,glyphPositions:this.returnDependencies?pi.positions:null}}))}}function Q(_e,K,Y){const oe=new L.z(K);for(const ae of _e)ae.recalculate(oe,Y)}class F{constructor(K,Y,oe){this.actor=K,this.layerIndex=Y,this.availableImages=oe,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(K,Y){return L._(this,void 0,void 0,(function*(){const oe=yield L.l(K.request,Y);try{return{vectorTile:new L.bt.VectorTile(new L.bu(oe.data)),rawData:oe.data,cacheControl:oe.cacheControl,expires:oe.expires}}catch(ae){const Ee=new Uint8Array(oe.data);let Me=`Unable to parse the tile at ${K.request.url}, `;throw Me+=Ee[0]===31&&Ee[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ae.message}`,new Error(Me)}}))}loadTile(K){return L._(this,void 0,void 0,(function*(){const Y=K.uid,oe=!!(K&&K.request&&K.request.collectResourceTiming)&&new L.bv(K.request),ae=new ee(K);this.loading[Y]=ae;const Ee=new AbortController;ae.abort=Ee;try{const Me=yield this.loadVectorTile(K,Ee);if(delete this.loading[Y],!Me)return null;const Fe=Me.rawData,ke={};Me.expires&&(ke.expires=Me.expires),Me.cacheControl&&(ke.cacheControl=Me.cacheControl);const Ke={};if(oe){const Ze=oe.finish();Ze&&(Ke.resourceTiming=JSON.parse(JSON.stringify(Ze)))}ae.vectorTile=Me.vectorTile;const ut=ae.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[Y]=ae,this.fetching[Y]={rawTileData:Fe,cacheControl:ke,resourceTiming:Ke};try{const Ze=yield ut;return L.e({rawTileData:Fe.slice(0)},Ze,ke,Ke)}finally{delete this.fetching[Y]}}catch(Me){throw delete this.loading[Y],ae.status="done",this.loaded[Y]=ae,Me}}))}reloadTile(K){return L._(this,void 0,void 0,(function*(){const Y=K.uid;if(!this.loaded||!this.loaded[Y])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const oe=this.loaded[Y];if(oe.showCollisionBoxes=K.showCollisionBoxes,oe.status==="parsing"){const ae=yield oe.parse(oe.vectorTile,this.layerIndex,this.availableImages,this.actor);let Ee;if(this.fetching[Y]){const{rawTileData:Me,cacheControl:Fe,resourceTiming:ke}=this.fetching[Y];delete this.fetching[Y],Ee=L.e({rawTileData:Me.slice(0)},ae,Fe,ke)}else Ee=ae;return Ee}if(oe.status==="done"&&oe.vectorTile)return oe.parse(oe.vectorTile,this.layerIndex,this.availableImages,this.actor)}))}abortTile(K){return L._(this,void 0,void 0,(function*(){const Y=this.loading,oe=K.uid;Y&&Y[oe]&&Y[oe].abort&&(Y[oe].abort.abort(),delete Y[oe])}))}removeTile(K){return L._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[K.uid]&&delete this.loaded[K.uid]}))}}class q{constructor(){this.loaded={}}loadTile(K){return L._(this,void 0,void 0,(function*(){const{uid:Y,encoding:oe,rawImageData:ae,redFactor:Ee,greenFactor:Me,blueFactor:Fe,baseShift:ke}=K,Ke=ae.width+2,ut=ae.height+2,Ze=L.b(ae)?new L.R({width:Ke,height:ut},yield L.bw(ae,-1,-1,Ke,ut)):ae,vt=new L.bx(Y,Ze,oe,Ee,Me,Fe,ke);return this.loaded=this.loaded||{},this.loaded[Y]=vt,vt}))}removeTile(K){const Y=this.loaded,oe=K.uid;Y&&Y[oe]&&delete Y[oe]}}function se(_e,K){if(_e.length!==0){le(_e[0],K);for(var Y=1;Y<_e.length;Y++)le(_e[Y],!K)}}function le(_e,K){for(var Y=0,oe=0,ae=0,Ee=_e.length,Me=Ee-1;ae<Ee;Me=ae++){var Fe=(_e[ae][0]-_e[Me][0])*(_e[Me][1]+_e[ae][1]),ke=Y+Fe;oe+=Math.abs(Y)>=Math.abs(Fe)?Y-ke+Fe:Fe-ke+Y,Y=ke}Y+oe>=0!=!!K&&_e.reverse()}var fe=L.by((function _e(K,Y){var oe,ae=K&&K.type;if(ae==="FeatureCollection")for(oe=0;oe<K.features.length;oe++)_e(K.features[oe],Y);else if(ae==="GeometryCollection")for(oe=0;oe<K.geometries.length;oe++)_e(K.geometries[oe],Y);else if(ae==="Feature")_e(K.geometry,Y);else if(ae==="Polygon")se(K.coordinates,Y);else if(ae==="MultiPolygon")for(oe=0;oe<K.coordinates.length;oe++)se(K.coordinates[oe],Y);return K}));const Ie=L.bt.VectorTileFeature.prototype.toGeoJSON;var Be={exports:{}},Ce=L.bz,Ge=L.bt.VectorTileFeature,it=We;function We(_e,K){this.options=K||{},this.features=_e,this.length=_e.length}function tt(_e,K){this.id=typeof _e.id=="number"?_e.id:void 0,this.type=_e.type,this.rawGeometry=_e.type===1?[_e.geometry]:_e.geometry,this.properties=_e.tags,this.extent=K||4096}We.prototype.feature=function(_e){return new tt(this.features[_e],this.options.extent)},tt.prototype.loadGeometry=function(){var _e=this.rawGeometry;this.geometry=[];for(var K=0;K<_e.length;K++){for(var Y=_e[K],oe=[],ae=0;ae<Y.length;ae++)oe.push(new Ce(Y[ae][0],Y[ae][1]));this.geometry.push(oe)}return this.geometry},tt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var _e=this.geometry,K=1/0,Y=-1/0,oe=1/0,ae=-1/0,Ee=0;Ee<_e.length;Ee++)for(var Me=_e[Ee],Fe=0;Fe<Me.length;Fe++){var ke=Me[Fe];K=Math.min(K,ke.x),Y=Math.max(Y,ke.x),oe=Math.min(oe,ke.y),ae=Math.max(ae,ke.y)}return[K,oe,Y,ae]},tt.prototype.toGeoJSON=Ge.prototype.toGeoJSON;var at=L.bA,ht=it;function ft(_e){var K=new at;return(function(Y,oe){for(var ae in Y.layers)oe.writeMessage(3,$t,Y.layers[ae])})(_e,K),K.finish()}function $t(_e,K){var Y;K.writeVarintField(15,_e.version||1),K.writeStringField(1,_e.name||""),K.writeVarintField(5,_e.extent||4096);var oe={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<_e.length;Y++)oe.feature=_e.feature(Y),K.writeMessage(2,wt,oe);var ae=oe.keys;for(Y=0;Y<ae.length;Y++)K.writeStringField(3,ae[Y]);var Ee=oe.values;for(Y=0;Y<Ee.length;Y++)K.writeMessage(4,an,Ee[Y])}function wt(_e,K){var Y=_e.feature;Y.id!==void 0&&K.writeVarintField(1,Y.id),K.writeMessage(2,Zt,_e),K.writeVarintField(3,Y.type),K.writeMessage(4,zt,Y)}function Zt(_e,K){var Y=_e.feature,oe=_e.keys,ae=_e.values,Ee=_e.keycache,Me=_e.valuecache;for(var Fe in Y.properties){var ke=Y.properties[Fe],Ke=Ee[Fe];if(ke!==null){Ke===void 0&&(oe.push(Fe),Ee[Fe]=Ke=oe.length-1),K.writeVarint(Ke);var ut=typeof ke;ut!=="string"&&ut!=="boolean"&&ut!=="number"&&(ke=JSON.stringify(ke));var Ze=ut+":"+ke,vt=Me[Ze];vt===void 0&&(ae.push(ke),Me[Ze]=vt=ae.length-1),K.writeVarint(vt)}}}function Bt(_e,K){return(K<<3)+(7&_e)}function je(_e){return _e<<1^_e>>31}function zt(_e,K){for(var Y=_e.loadGeometry(),oe=_e.type,ae=0,Ee=0,Me=Y.length,Fe=0;Fe<Me;Fe++){var ke=Y[Fe],Ke=1;oe===1&&(Ke=ke.length),K.writeVarint(Bt(1,Ke));for(var ut=oe===3?ke.length-1:ke.length,Ze=0;Ze<ut;Ze++){Ze===1&&oe!==1&&K.writeVarint(Bt(2,ut-1));var vt=ke[Ze].x-ae,Ut=ke[Ze].y-Ee;K.writeVarint(je(vt)),K.writeVarint(je(Ut)),ae+=vt,Ee+=Ut}oe===3&&K.writeVarint(Bt(7,1))}}function an(_e,K){var Y=typeof _e;Y==="string"?K.writeStringField(1,_e):Y==="boolean"?K.writeBooleanField(7,_e):Y==="number"&&(_e%1!=0?K.writeDoubleField(3,_e):_e<0?K.writeSVarintField(6,_e):K.writeVarintField(5,_e))}Be.exports=ft,Be.exports.fromVectorTileJs=ft,Be.exports.fromGeojsonVt=function(_e,K){K=K||{};var Y={};for(var oe in _e)Y[oe]=new ht(_e[oe].features,K),Y[oe].name=oe,Y[oe].version=K.version,Y[oe].extent=K.extent;return ft({layers:Y})},Be.exports.GeoJSONWrapper=ht;var rn=L.by(Be.exports);const bt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:_e=>_e},jt=Math.fround||(nt=new Float32Array(1),_e=>(nt[0]=+_e,nt[0]));var nt;const Re=3,rt=5,on=6;class Pt{constructor(K){this.options=Object.assign(Object.create(bt),K),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(K){const{log:Y,minZoom:oe,maxZoom:ae}=this.options;Y&&console.time("total time");const Ee=`prepare ${K.length} points`;Y&&console.time(Ee),this.points=K;const Me=[];for(let ke=0;ke<K.length;ke++){const Ke=K[ke];if(!Ke.geometry)continue;const[ut,Ze]=Ke.geometry.coordinates,vt=jt(Rn(ut)),Ut=jt(Ne(Ze));Me.push(vt,Ut,1/0,ke,-1,1),this.options.reduce&&Me.push(0)}let Fe=this.trees[ae+1]=this._createTree(Me);Y&&console.timeEnd(Ee);for(let ke=ae;ke>=oe;ke--){const Ke=+Date.now();Fe=this.trees[ke]=this._createTree(this._cluster(Fe,ke)),Y&&console.log("z%d: %d clusters in %dms",ke,Fe.numItems,+Date.now()-Ke)}return Y&&console.timeEnd("total time"),this}getClusters(K,Y){let oe=((K[0]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,K[1]));let Ee=K[2]===180?180:((K[2]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)oe=-180,Ee=180;else if(oe>Ee){const Ze=this.getClusters([oe,ae,180,Me],Y),vt=this.getClusters([-180,ae,Ee,Me],Y);return Ze.concat(vt)}const Fe=this.trees[this._limitZoom(Y)],ke=Fe.range(Rn(oe),Ne(Me),Rn(Ee),Ne(ae)),Ke=Fe.data,ut=[];for(const Ze of ke){const vt=this.stride*Ze;ut.push(Ke[vt+rt]>1?yn(Ke,vt,this.clusterProps):this.points[Ke[vt+Re]])}return ut}getChildren(K){const Y=this._getOriginId(K),oe=this._getOriginZoom(K),ae="No cluster with the specified id.",Ee=this.trees[oe];if(!Ee)throw new Error(ae);const Me=Ee.data;if(Y*this.stride>=Me.length)throw new Error(ae);const Fe=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),ke=Ee.within(Me[Y*this.stride],Me[Y*this.stride+1],Fe),Ke=[];for(const ut of ke){const Ze=ut*this.stride;Me[Ze+4]===K&&Ke.push(Me[Ze+rt]>1?yn(Me,Ze,this.clusterProps):this.points[Me[Ze+Re]])}if(Ke.length===0)throw new Error(ae);return Ke}getLeaves(K,Y,oe){const ae=[];return this._appendLeaves(ae,K,Y=Y||10,oe=oe||0,0),ae}getTile(K,Y,oe){const ae=this.trees[this._limitZoom(K)],Ee=Math.pow(2,K),{extent:Me,radius:Fe}=this.options,ke=Fe/Me,Ke=(oe-ke)/Ee,ut=(oe+1+ke)/Ee,Ze={features:[]};return this._addTileFeatures(ae.range((Y-ke)/Ee,Ke,(Y+1+ke)/Ee,ut),ae.data,Y,oe,Ee,Ze),Y===0&&this._addTileFeatures(ae.range(1-ke/Ee,Ke,1,ut),ae.data,Ee,oe,Ee,Ze),Y===Ee-1&&this._addTileFeatures(ae.range(0,Ke,ke/Ee,ut),ae.data,-1,oe,Ee,Ze),Ze.features.length?Ze:null}getClusterExpansionZoom(K){let Y=this._getOriginZoom(K)-1;for(;Y<=this.options.maxZoom;){const oe=this.getChildren(K);if(Y++,oe.length!==1)break;K=oe[0].properties.cluster_id}return Y}_appendLeaves(K,Y,oe,ae,Ee){const Me=this.getChildren(Y);for(const Fe of Me){const ke=Fe.properties;if(ke&&ke.cluster?Ee+ke.point_count<=ae?Ee+=ke.point_count:Ee=this._appendLeaves(K,ke.cluster_id,oe,ae,Ee):Ee<ae?Ee++:K.push(Fe),K.length===oe)break}return Ee}_createTree(K){const Y=new L.av(K.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<K.length;oe+=this.stride)Y.add(K[oe],K[oe+1]);return Y.finish(),Y.data=K,Y}_addTileFeatures(K,Y,oe,ae,Ee,Me){for(const Fe of K){const ke=Fe*this.stride,Ke=Y[ke+rt]>1;let ut,Ze,vt;if(Ke)ut=Dn(Y,ke,this.clusterProps),Ze=Y[ke],vt=Y[ke+1];else{const Fn=this.points[Y[ke+Re]];ut=Fn.properties;const[bn,kn]=Fn.geometry.coordinates;Ze=Rn(bn),vt=Ne(kn)}const Ut={type:1,geometry:[[Math.round(this.options.extent*(Ze*Ee-oe)),Math.round(this.options.extent*(vt*Ee-ae))]],tags:ut};let Qt;Qt=Ke||this.options.generateId?Y[ke+Re]:this.points[Y[ke+Re]].id,Qt!==void 0&&(Ut.id=Qt),Me.features.push(Ut)}}_limitZoom(K){return Math.max(this.options.minZoom,Math.min(Math.floor(+K),this.options.maxZoom+1))}_cluster(K,Y){const{radius:oe,extent:ae,reduce:Ee,minPoints:Me}=this.options,Fe=oe/(ae*Math.pow(2,Y)),ke=K.data,Ke=[],ut=this.stride;for(let Ze=0;Ze<ke.length;Ze+=ut){if(ke[Ze+2]<=Y)continue;ke[Ze+2]=Y;const vt=ke[Ze],Ut=ke[Ze+1],Qt=K.within(ke[Ze],ke[Ze+1],Fe),Fn=ke[Ze+rt];let bn=Fn;for(const kn of Qt){const Sn=kn*ut;ke[Sn+2]>Y&&(bn+=ke[Sn+rt])}if(bn>Fn&&bn>=Me){let kn,Sn=vt*Fn,pi=Ut*Fn,ti=-1;const xn=((Ze/ut|0)<<5)+(Y+1)+this.points.length;for(const Hn of Qt){const ri=Hn*ut;if(ke[ri+2]<=Y)continue;ke[ri+2]=Y;const Ei=ke[ri+rt];Sn+=ke[ri]*Ei,pi+=ke[ri+1]*Ei,ke[ri+4]=xn,Ee&&(kn||(kn=this._map(ke,Ze,!0),ti=this.clusterProps.length,this.clusterProps.push(kn)),Ee(kn,this._map(ke,ri)))}ke[Ze+4]=xn,Ke.push(Sn/bn,pi/bn,1/0,xn,-1,bn),Ee&&Ke.push(ti)}else{for(let kn=0;kn<ut;kn++)Ke.push(ke[Ze+kn]);if(bn>1)for(const kn of Qt){const Sn=kn*ut;if(!(ke[Sn+2]<=Y)){ke[Sn+2]=Y;for(let pi=0;pi<ut;pi++)Ke.push(ke[Sn+pi])}}}}return Ke}_getOriginId(K){return K-this.points.length>>5}_getOriginZoom(K){return(K-this.points.length)%32}_map(K,Y,oe){if(K[Y+rt]>1){const Me=this.clusterProps[K[Y+on]];return oe?Object.assign({},Me):Me}const ae=this.points[K[Y+Re]].properties,Ee=this.options.map(ae);return oe&&Ee===ae?Object.assign({},Ee):Ee}}function yn(_e,K,Y){return{type:"Feature",id:_e[K+Re],properties:Dn(_e,K,Y),geometry:{type:"Point",coordinates:[(oe=_e[K],360*(oe-.5)),ei(_e[K+1])]}};var oe}function Dn(_e,K,Y){const oe=_e[K+rt],ae=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,Ee=_e[K+on],Me=Ee===-1?{}:Object.assign({},Y[Ee]);return Object.assign(Me,{cluster:!0,cluster_id:_e[K+Re],point_count:oe,point_count_abbreviated:ae})}function Rn(_e){return _e/360+.5}function Ne(_e){const K=Math.sin(_e*Math.PI/180),Y=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return Y<0?0:Y>1?1:Y}function ei(_e){const K=(180-360*_e)*Math.PI/180;return 360*Math.atan(Math.exp(K))/Math.PI-90}function Cn(_e,K,Y,oe){let ae=oe;const Ee=K+(Y-K>>1);let Me,Fe=Y-K;const ke=_e[K],Ke=_e[K+1],ut=_e[Y],Ze=_e[Y+1];for(let vt=K+3;vt<Y;vt+=3){const Ut=Kt(_e[vt],_e[vt+1],ke,Ke,ut,Ze);if(Ut>ae)Me=vt,ae=Ut;else if(Ut===ae){const Qt=Math.abs(vt-Ee);Qt<Fe&&(Me=vt,Fe=Qt)}}ae>oe&&(Me-K>3&&Cn(_e,K,Me,oe),_e[Me+2]=ae,Y-Me>3&&Cn(_e,Me,Y,oe))}function Kt(_e,K,Y,oe,ae,Ee){let Me=ae-Y,Fe=Ee-oe;if(Me!==0||Fe!==0){const ke=((_e-Y)*Me+(K-oe)*Fe)/(Me*Me+Fe*Fe);ke>1?(Y=ae,oe=Ee):ke>0&&(Y+=Me*ke,oe+=Fe*ke)}return Me=_e-Y,Fe=K-oe,Me*Me+Fe*Fe}function we(_e,K,Y,oe){const ae={id:_e??null,type:K,geometry:Y,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(K==="Point"||K==="MultiPoint"||K==="LineString")$i(ae,Y);else if(K==="Polygon")$i(ae,Y[0]);else if(K==="MultiLineString")for(const Ee of Y)$i(ae,Ee);else if(K==="MultiPolygon")for(const Ee of Y)$i(ae,Ee[0]);return ae}function $i(_e,K){for(let Y=0;Y<K.length;Y+=3)_e.minX=Math.min(_e.minX,K[Y]),_e.minY=Math.min(_e.minY,K[Y+1]),_e.maxX=Math.max(_e.maxX,K[Y]),_e.maxY=Math.max(_e.maxY,K[Y+1])}function Vr(_e,K,Y,oe){if(!K.geometry)return;const ae=K.geometry.coordinates;if(ae&&ae.length===0)return;const Ee=K.geometry.type,Me=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2);let Fe=[],ke=K.id;if(Y.promoteId?ke=K.properties[Y.promoteId]:Y.generateId&&(ke=oe||0),Ee==="Point")Rr(ae,Fe);else if(Ee==="MultiPoint")for(const Ke of ae)Rr(Ke,Fe);else if(Ee==="LineString")Ye(ae,Fe,Me,!1);else if(Ee==="MultiLineString"){if(Y.lineMetrics){for(const Ke of ae)Fe=[],Ye(Ke,Fe,Me,!1),_e.push(we(ke,"LineString",Fe,K.properties));return}ds(ae,Fe,Me,!1)}else if(Ee==="Polygon")ds(ae,Fe,Me,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(const Ke of K.geometry.geometries)Vr(_e,{id:ke,geometry:Ke,properties:K.properties},Y,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ke of ae){const ut=[];ds(Ke,ut,Me,!0),Fe.push(ut)}}_e.push(we(ke,Ee,Fe,K.properties))}function Rr(_e,K){K.push(Co(_e[0]),lt(_e[1]),0)}function Ye(_e,K,Y,oe){let ae,Ee,Me=0;for(let ke=0;ke<_e.length;ke++){const Ke=Co(_e[ke][0]),ut=lt(_e[ke][1]);K.push(Ke,ut,0),ke>0&&(Me+=oe?(ae*ut-Ke*Ee)/2:Math.sqrt(Math.pow(Ke-ae,2)+Math.pow(ut-Ee,2))),ae=Ke,Ee=ut}const Fe=K.length-3;K[2]=1,Cn(K,0,Fe,Y),K[Fe+2]=1,K.size=Math.abs(Me),K.start=0,K.end=K.size}function ds(_e,K,Y,oe){for(let ae=0;ae<_e.length;ae++){const Ee=[];Ye(_e[ae],Ee,Y,oe),K.push(Ee)}}function Co(_e){return _e/360+.5}function lt(_e){const K=Math.sin(_e*Math.PI/180),Y=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return Y<0?0:Y>1?1:Y}function ai(_e,K,Y,oe,ae,Ee,Me,Fe){if(oe/=K,Ee>=(Y/=K)&&Me<oe)return _e;if(Me<Y||Ee>=oe)return null;const ke=[];for(const Ke of _e){const ut=Ke.geometry;let Ze=Ke.type;const vt=ae===0?Ke.minX:Ke.minY,Ut=ae===0?Ke.maxX:Ke.maxY;if(vt>=Y&&Ut<oe){ke.push(Ke);continue}if(Ut<Y||vt>=oe)continue;let Qt=[];if(Ze==="Point"||Ze==="MultiPoint")ps(ut,Qt,Y,oe,ae);else if(Ze==="LineString")pr(ut,Qt,Y,oe,ae,!1,Fe.lineMetrics);else if(Ze==="MultiLineString")vn(ut,Qt,Y,oe,ae,!1);else if(Ze==="Polygon")vn(ut,Qt,Y,oe,ae,!0);else if(Ze==="MultiPolygon")for(const Fn of ut){const bn=[];vn(Fn,bn,Y,oe,ae,!0),bn.length&&Qt.push(bn)}if(Qt.length){if(Fe.lineMetrics&&Ze==="LineString"){for(const Fn of Qt)ke.push(we(Ke.id,Ze,Fn,Ke.tags));continue}Ze!=="LineString"&&Ze!=="MultiLineString"||(Qt.length===1?(Ze="LineString",Qt=Qt[0]):Ze="MultiLineString"),Ze!=="Point"&&Ze!=="MultiPoint"||(Ze=Qt.length===3?"Point":"MultiPoint"),ke.push(we(Ke.id,Ze,Qt,Ke.tags))}}return ke.length?ke:null}function ps(_e,K,Y,oe,ae){for(let Ee=0;Ee<_e.length;Ee+=3){const Me=_e[Ee+ae];Me>=Y&&Me<=oe&&ir(K,_e[Ee],_e[Ee+1],_e[Ee+2])}}function pr(_e,K,Y,oe,ae,Ee,Me){let Fe=As(_e);const ke=ae===0?aa:oa;let Ke,ut,Ze=_e.start;for(let bn=0;bn<_e.length-3;bn+=3){const kn=_e[bn],Sn=_e[bn+1],pi=_e[bn+2],ti=_e[bn+3],xn=_e[bn+4],Hn=ae===0?kn:Sn,ri=ae===0?ti:xn;let Ei=!1;Me&&(Ke=Math.sqrt(Math.pow(kn-ti,2)+Math.pow(Sn-xn,2))),Hn<Y?ri>Y&&(ut=ke(Fe,kn,Sn,ti,xn,Y),Me&&(Fe.start=Ze+Ke*ut)):Hn>oe?ri<oe&&(ut=ke(Fe,kn,Sn,ti,xn,oe),Me&&(Fe.start=Ze+Ke*ut)):ir(Fe,kn,Sn,pi),ri<Y&&Hn>=Y&&(ut=ke(Fe,kn,Sn,ti,xn,Y),Ei=!0),ri>oe&&Hn<=oe&&(ut=ke(Fe,kn,Sn,ti,xn,oe),Ei=!0),!Ee&&Ei&&(Me&&(Fe.end=Ze+Ke*ut),K.push(Fe),Fe=As(_e)),Me&&(Ze+=Ke)}let vt=_e.length-3;const Ut=_e[vt],Qt=_e[vt+1],Fn=ae===0?Ut:Qt;Fn>=Y&&Fn<=oe&&ir(Fe,Ut,Qt,_e[vt+2]),vt=Fe.length-3,Ee&&vt>=3&&(Fe[vt]!==Fe[0]||Fe[vt+1]!==Fe[1])&&ir(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&K.push(Fe)}function As(_e){const K=[];return K.size=_e.size,K.start=_e.start,K.end=_e.end,K}function vn(_e,K,Y,oe,ae,Ee){for(const Me of _e)pr(Me,K,Y,oe,ae,Ee,!1)}function ir(_e,K,Y,oe){_e.push(K,Y,oe)}function aa(_e,K,Y,oe,ae,Ee){const Me=(Ee-K)/(oe-K);return ir(_e,Ee,Y+(ae-Y)*Me,1),Me}function oa(_e,K,Y,oe,ae,Ee){const Me=(Ee-Y)/(ae-Y);return ir(_e,K+(oe-K)*Me,Ee,1),Me}function Qe(_e,K){const Y=[];for(let oe=0;oe<_e.length;oe++){const ae=_e[oe],Ee=ae.type;let Me;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")Me=Ur(ae.geometry,K);else if(Ee==="MultiLineString"||Ee==="Polygon"){Me=[];for(const Fe of ae.geometry)Me.push(Ur(Fe,K))}else if(Ee==="MultiPolygon"){Me=[];for(const Fe of ae.geometry){const ke=[];for(const Ke of Fe)ke.push(Ur(Ke,K));Me.push(ke)}}Y.push(we(ae.id,Ee,Me,ae.tags))}return Y}function Ur(_e,K){const Y=[];Y.size=_e.size,_e.start!==void 0&&(Y.start=_e.start,Y.end=_e.end);for(let oe=0;oe<_e.length;oe+=3)Y.push(_e[oe]+K,_e[oe+1],_e[oe+2]);return Y}function dn(_e,K){if(_e.transformed)return _e;const Y=1<<_e.z,oe=_e.x,ae=_e.y;for(const Ee of _e.features){const Me=Ee.geometry,Fe=Ee.type;if(Ee.geometry=[],Fe===1)for(let ke=0;ke<Me.length;ke+=2)Ee.geometry.push(tn(Me[ke],Me[ke+1],K,Y,oe,ae));else for(let ke=0;ke<Me.length;ke++){const Ke=[];for(let ut=0;ut<Me[ke].length;ut+=2)Ke.push(tn(Me[ke][ut],Me[ke][ut+1],K,Y,oe,ae));Ee.geometry.push(Ke)}}return _e.transformed=!0,_e}function tn(_e,K,Y,oe,ae,Ee){return[Math.round(Y*(_e*oe-ae)),Math.round(Y*(K*oe-Ee))]}function Aa(_e,K,Y,oe,ae){const Ee=K===ae.maxZoom?0:ae.tolerance/((1<<K)*ae.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:_e.length,source:null,x:Y,y:oe,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Fe of _e)_t(Me,Fe,Ee,ae);return Me}function _t(_e,K,Y,oe){const ae=K.geometry,Ee=K.type,Me=[];if(_e.minX=Math.min(_e.minX,K.minX),_e.minY=Math.min(_e.minY,K.minY),_e.maxX=Math.max(_e.maxX,K.maxX),_e.maxY=Math.max(_e.maxY,K.maxY),Ee==="Point"||Ee==="MultiPoint")for(let Fe=0;Fe<ae.length;Fe+=3)Me.push(ae[Fe],ae[Fe+1]),_e.numPoints++,_e.numSimplified++;else if(Ee==="LineString")In(Me,ae,_e,Y,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(let Fe=0;Fe<ae.length;Fe++)In(Me,ae[Fe],_e,Y,Ee==="Polygon",Fe===0);else if(Ee==="MultiPolygon")for(let Fe=0;Fe<ae.length;Fe++){const ke=ae[Fe];for(let Ke=0;Ke<ke.length;Ke++)In(Me,ke[Ke],_e,Y,!0,Ke===0)}if(Me.length){let Fe=K.tags||null;if(Ee==="LineString"&&oe.lineMetrics){Fe={};for(const Ke in K.tags)Fe[Ke]=K.tags[Ke];Fe.mapbox_clip_start=ae.start/ae.size,Fe.mapbox_clip_end=ae.end/ae.size}const ke={geometry:Me,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:Fe};K.id!==null&&(ke.id=K.id),_e.features.push(ke)}}function In(_e,K,Y,oe,ae,Ee){const Me=oe*oe;if(oe>0&&K.size<(ae?Me:oe))return void(Y.numPoints+=K.length/3);const Fe=[];for(let ke=0;ke<K.length;ke+=3)(oe===0||K[ke+2]>Me)&&(Y.numSimplified++,Fe.push(K[ke],K[ke+1])),Y.numPoints++;ae&&(function(ke,Ke){let ut=0;for(let Ze=0,vt=ke.length,Ut=vt-2;Ze<vt;Ut=Ze,Ze+=2)ut+=(ke[Ze]-ke[Ut])*(ke[Ze+1]+ke[Ut+1]);if(ut>0===Ke)for(let Ze=0,vt=ke.length;Ze<vt/2;Ze+=2){const Ut=ke[Ze],Qt=ke[Ze+1];ke[Ze]=ke[vt-2-Ze],ke[Ze+1]=ke[vt-1-Ze],ke[vt-2-Ze]=Ut,ke[vt-1-Ze]=Qt}})(Fe,Ee),_e.push(Fe)}const pt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class mr{constructor(K,Y){const oe=(Y=this.options=(function(Ee,Me){for(const Fe in Me)Ee[Fe]=Me[Fe];return Ee})(Object.create(pt),Y)).debug;if(oe&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");let ae=(function(Ee,Me){const Fe=[];if(Ee.type==="FeatureCollection")for(let ke=0;ke<Ee.features.length;ke++)Vr(Fe,Ee.features[ke],Me,ke);else Vr(Fe,Ee.type==="Feature"?Ee:{geometry:Ee},Me);return Fe})(K,Y);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ae=(function(Ee,Me){const Fe=Me.buffer/Me.extent;let ke=Ee;const Ke=ai(Ee,1,-1-Fe,Fe,0,-1,2,Me),ut=ai(Ee,1,1-Fe,2+Fe,0,-1,2,Me);return(Ke||ut)&&(ke=ai(Ee,1,-Fe,1+Fe,0,-1,2,Me)||[],Ke&&(ke=Qe(Ke,1).concat(ke)),ut&&(ke=ke.concat(Qe(ut,-1)))),ke})(ae,Y),ae.length&&this.splitTile(ae,0,0,0),oe&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(K,Y,oe,ae,Ee,Me,Fe){const ke=[K,Y,oe,ae],Ke=this.options,ut=Ke.debug;for(;ke.length;){ae=ke.pop(),oe=ke.pop(),Y=ke.pop(),K=ke.pop();const Ze=1<<Y,vt=qr(Y,oe,ae);let Ut=this.tiles[vt];if(!Ut&&(ut>1&&console.time("creation"),Ut=this.tiles[vt]=Aa(K,Y,oe,ae,Ke),this.tileCoords.push({z:Y,x:oe,y:ae}),ut)){ut>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,oe,ae,Ut.numFeatures,Ut.numPoints,Ut.numSimplified),console.timeEnd("creation"));const Ei=`z${Y}`;this.stats[Ei]=(this.stats[Ei]||0)+1,this.total++}if(Ut.source=K,Ee==null){if(Y===Ke.indexMaxZoom||Ut.numPoints<=Ke.indexMaxPoints)continue}else{if(Y===Ke.maxZoom||Y===Ee)continue;if(Ee!=null){const Ei=Ee-Y;if(oe!==Me>>Ei||ae!==Fe>>Ei)continue}}if(Ut.source=null,K.length===0)continue;ut>1&&console.time("clipping");const Qt=.5*Ke.buffer/Ke.extent,Fn=.5-Qt,bn=.5+Qt,kn=1+Qt;let Sn=null,pi=null,ti=null,xn=null,Hn=ai(K,Ze,oe-Qt,oe+bn,0,Ut.minX,Ut.maxX,Ke),ri=ai(K,Ze,oe+Fn,oe+kn,0,Ut.minX,Ut.maxX,Ke);K=null,Hn&&(Sn=ai(Hn,Ze,ae-Qt,ae+bn,1,Ut.minY,Ut.maxY,Ke),pi=ai(Hn,Ze,ae+Fn,ae+kn,1,Ut.minY,Ut.maxY,Ke),Hn=null),ri&&(ti=ai(ri,Ze,ae-Qt,ae+bn,1,Ut.minY,Ut.maxY,Ke),xn=ai(ri,Ze,ae+Fn,ae+kn,1,Ut.minY,Ut.maxY,Ke),ri=null),ut>1&&console.timeEnd("clipping"),ke.push(Sn||[],Y+1,2*oe,2*ae),ke.push(pi||[],Y+1,2*oe,2*ae+1),ke.push(ti||[],Y+1,2*oe+1,2*ae),ke.push(xn||[],Y+1,2*oe+1,2*ae+1)}}getTile(K,Y,oe){K=+K,Y=+Y,oe=+oe;const ae=this.options,{extent:Ee,debug:Me}=ae;if(K<0||K>24)return null;const Fe=1<<K,ke=qr(K,Y=Y+Fe&Fe-1,oe);if(this.tiles[ke])return dn(this.tiles[ke],Ee);Me>1&&console.log("drilling down to z%d-%d-%d",K,Y,oe);let Ke,ut=K,Ze=Y,vt=oe;for(;!Ke&&ut>0;)ut--,Ze>>=1,vt>>=1,Ke=this.tiles[qr(ut,Ze,vt)];return Ke&&Ke.source?(Me>1&&(console.log("found parent tile z%d-%d-%d",ut,Ze,vt),console.time("drilling down")),this.splitTile(Ke.source,ut,Ze,vt,K,Y,oe),Me>1&&console.timeEnd("drilling down"),this.tiles[ke]?dn(this.tiles[ke],Ee):null):null}}function qr(_e,K,Y){return 32*((1<<_e)*Y+K)+_e}function pn(_e,K){return K?_e.properties[K]:_e.id}function Si(_e,K){if(_e==null)return!0;if(_e.type==="Feature")return pn(_e,K)!=null;if(_e.type==="FeatureCollection"){const Y=new Set;for(const oe of _e.features){const ae=pn(oe,K);if(ae==null||Y.has(ae))return!1;Y.add(ae)}return!0}return!1}function Sr(_e,K){const Y=new Map;if(_e!=null)if(_e.type==="Feature")Y.set(pn(_e,K),_e);else for(const oe of _e.features)Y.set(pn(oe,K),oe);return Y}class Ai extends F{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(K,Y){return L._(this,void 0,void 0,(function*(){const oe=K.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ae=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!ae)return null;const Ee=new class{constructor(Fe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=L.X,this.length=Fe.length,this._features=Fe}feature(Fe){return new class{constructor(ke){this._feature=ke,this.extent=L.X,this.type=ke.type,this.properties=ke.tags,"id"in ke&&!isNaN(ke.id)&&(this.id=parseInt(ke.id,10))}loadGeometry(){if(this._feature.type===1){const ke=[];for(const Ke of this._feature.geometry)ke.push([new L.P(Ke[0],Ke[1])]);return ke}{const ke=[];for(const Ke of this._feature.geometry){const ut=[];for(const Ze of Ke)ut.push(new L.P(Ze[0],Ze[1]));ke.push(ut)}return ke}}toGeoJSON(ke,Ke,ut){return Ie.call(this,ke,Ke,ut)}}(this._features[Fe])}}(ae.features);let Me=rn(Ee);return Me.byteOffset===0&&Me.byteLength===Me.buffer.byteLength||(Me=new Uint8Array(Me)),{vectorTile:Ee,rawData:Me.buffer}}))}loadData(K){return L._(this,void 0,void 0,(function*(){var Y;(Y=this._pendingRequest)===null||Y===void 0||Y.abort();const oe=!!(K&&K.request&&K.request.collectResourceTiming)&&new L.bv(K.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(K,this._pendingRequest),this._geoJSONIndex=K.cluster?new Pt((function({superclusterOptions:Me,clusterProperties:Fe}){if(!Fe||!Me)return Me;const ke={},Ke={},ut={accumulated:null,zoom:0},Ze={properties:null},vt=Object.keys(Fe);for(const Ut of vt){const[Qt,Fn]=Fe[Ut],bn=L.bC(Fn),kn=L.bC(typeof Qt=="string"?[Qt,["accumulated"],["get",Ut]]:Qt);ke[Ut]=bn.value,Ke[Ut]=kn.value}return Me.map=Ut=>{Ze.properties=Ut;const Qt={};for(const Fn of vt)Qt[Fn]=ke[Fn].evaluate(ut,Ze);return Qt},Me.reduce=(Ut,Qt)=>{Ze.properties=Qt;for(const Fn of vt)ut.accumulated=Ut[Fn],Ut[Fn]=Ke[Fn].evaluate(ut,Ze)},Me})(K)).load((yield this._pendingData).features):(ae=yield this._pendingData,new mr(ae,K.geojsonVtOptions)),this.loaded={};const Ee={};if(oe){const Me=oe.finish();Me&&(Ee.resourceTiming={},Ee.resourceTiming[K.source]=JSON.parse(JSON.stringify(Me)))}return Ee}catch(Ee){if(delete this._pendingRequest,L.bB(Ee))return{abandoned:!0};throw Ee}var ae}))}getData(){return L._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(K){const Y=this.loaded;return Y&&Y[K.uid]?super.reloadTile(K):this.loadTile(K)}loadAndProcessGeoJSON(K,Y){return L._(this,void 0,void 0,(function*(){let oe=yield this.loadGeoJSON(K,Y);if(delete this._pendingRequest,typeof oe!="object")throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`);if(fe(oe,!0),K.filter){const ae=L.bC(K.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ae.result==="error")throw new Error(ae.value.map((Me=>`${Me.key}: ${Me.message}`)).join(", "));oe={type:"FeatureCollection",features:oe.features.filter((Me=>ae.value.evaluate({zoom:0},Me)))}}return oe}))}loadGeoJSON(K,Y){return L._(this,void 0,void 0,(function*(){const{promoteId:oe}=K;if(K.request){const ae=yield L.h(K.request,Y);return this._dataUpdateable=Si(ae.data,oe)?Sr(ae.data,oe):void 0,ae.data}if(typeof K.data=="string")try{const ae=JSON.parse(K.data);return this._dataUpdateable=Si(ae,oe)?Sr(ae,oe):void 0,ae}catch{throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`)}if(!K.dataDiff)throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${K.source}`);return(function(ae,Ee,Me){var Fe,ke,Ke,ut;if(Ee.removeAll&&ae.clear(),Ee.remove)for(const Ze of Ee.remove)ae.delete(Ze);if(Ee.add)for(const Ze of Ee.add){const vt=pn(Ze,Me);vt!=null&&ae.set(vt,Ze)}if(Ee.update)for(const Ze of Ee.update){let vt=ae.get(Ze.id);if(vt==null)continue;const Ut=!Ze.removeAllProperties&&(((Fe=Ze.removeProperties)===null||Fe===void 0?void 0:Fe.length)>0||((ke=Ze.addOrUpdateProperties)===null||ke===void 0?void 0:ke.length)>0);if((Ze.newGeometry||Ze.removeAllProperties||Ut)&&(vt=Object.assign({},vt),ae.set(Ze.id,vt),Ut&&(vt.properties=Object.assign({},vt.properties))),Ze.newGeometry&&(vt.geometry=Ze.newGeometry),Ze.removeAllProperties)vt.properties={};else if(((Ke=Ze.removeProperties)===null||Ke===void 0?void 0:Ke.length)>0)for(const Qt of Ze.removeProperties)Object.prototype.hasOwnProperty.call(vt.properties,Qt)&&delete vt.properties[Qt];if(((ut=Ze.addOrUpdateProperties)===null||ut===void 0?void 0:ut.length)>0)for(const{key:Qt,value:Fn}of Ze.addOrUpdateProperties)vt.properties[Qt]=Fn}})(this._dataUpdateable,K.dataDiff,oe),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(K){return L._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(K){return this._geoJSONIndex.getClusterExpansionZoom(K.clusterId)}getClusterChildren(K){return this._geoJSONIndex.getChildren(K.clusterId)}getClusterLeaves(K){return this._geoJSONIndex.getLeaves(K.clusterId,K.limit,K.offset)}}class gr{constructor(K){this.self=K,this.actor=new L.F(K),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Y,oe)=>{if(this.externalWorkerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.externalWorkerSourceTypes[Y]=oe},this.self.addProtocol=L.bi,this.self.removeProtocol=L.bj,this.self.registerRTLTextPlugin=Y=>{if(L.bD.isParsed())throw new Error("RTL text plugin already registered.");L.bD.setMethods(Y)},this.actor.registerMessageHandler("LDT",((Y,oe)=>this._getDEMWorkerSource(Y,oe.source).loadTile(oe))),this.actor.registerMessageHandler("RDT",((Y,oe)=>L._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(Y,oe.source).removeTile(oe)})))),this.actor.registerMessageHandler("GCEZ",((Y,oe)=>L._(this,void 0,void 0,(function*(){return this._getWorkerSource(Y,oe.type,oe.source).getClusterExpansionZoom(oe)})))),this.actor.registerMessageHandler("GCC",((Y,oe)=>L._(this,void 0,void 0,(function*(){return this._getWorkerSource(Y,oe.type,oe.source).getClusterChildren(oe)})))),this.actor.registerMessageHandler("GCL",((Y,oe)=>L._(this,void 0,void 0,(function*(){return this._getWorkerSource(Y,oe.type,oe.source).getClusterLeaves(oe)})))),this.actor.registerMessageHandler("LD",((Y,oe)=>this._getWorkerSource(Y,oe.type,oe.source).loadData(oe))),this.actor.registerMessageHandler("GD",((Y,oe)=>this._getWorkerSource(Y,oe.type,oe.source).getData())),this.actor.registerMessageHandler("LT",((Y,oe)=>this._getWorkerSource(Y,oe.type,oe.source).loadTile(oe))),this.actor.registerMessageHandler("RT",((Y,oe)=>this._getWorkerSource(Y,oe.type,oe.source).reloadTile(oe))),this.actor.registerMessageHandler("AT",((Y,oe)=>this._getWorkerSource(Y,oe.type,oe.source).abortTile(oe))),this.actor.registerMessageHandler("RMT",((Y,oe)=>this._getWorkerSource(Y,oe.type,oe.source).removeTile(oe))),this.actor.registerMessageHandler("RS",((Y,oe)=>L._(this,void 0,void 0,(function*(){if(!this.workerSources[Y]||!this.workerSources[Y][oe.type]||!this.workerSources[Y][oe.type][oe.source])return;const ae=this.workerSources[Y][oe.type][oe.source];delete this.workerSources[Y][oe.type][oe.source],ae.removeSource!==void 0&&ae.removeSource(oe)})))),this.actor.registerMessageHandler("RM",(Y=>L._(this,void 0,void 0,(function*(){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y]})))),this.actor.registerMessageHandler("SR",((Y,oe)=>L._(this,void 0,void 0,(function*(){this.referrer=oe})))),this.actor.registerMessageHandler("SRPS",((Y,oe)=>this._syncRTLPluginState(Y,oe))),this.actor.registerMessageHandler("IS",((Y,oe)=>L._(this,void 0,void 0,(function*(){this.self.importScripts(oe)})))),this.actor.registerMessageHandler("SI",((Y,oe)=>this._setImages(Y,oe))),this.actor.registerMessageHandler("UL",((Y,oe)=>L._(this,void 0,void 0,(function*(){this._getLayerIndex(Y).update(oe.layers,oe.removedIds)})))),this.actor.registerMessageHandler("SL",((Y,oe)=>L._(this,void 0,void 0,(function*(){this._getLayerIndex(Y).replace(oe)}))))}_setImages(K,Y){return L._(this,void 0,void 0,(function*(){this.availableImages[K]=Y;for(const oe in this.workerSources[K]){const ae=this.workerSources[K][oe];for(const Ee in ae)ae[Ee].availableImages=Y}}))}_syncRTLPluginState(K,Y){return L._(this,void 0,void 0,(function*(){if(L.bD.isParsed())return L.bD.getState();if(Y.pluginStatus!=="loading")return L.bD.setState(Y),Y;const oe=Y.pluginURL;if(this.self.importScripts(oe),L.bD.isParsed()){const ae={pluginStatus:"loaded",pluginURL:oe};return L.bD.setState(ae),ae}throw L.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${oe}`)}))}_getAvailableImages(K){let Y=this.availableImages[K];return Y||(Y=[]),Y}_getLayerIndex(K){let Y=this.layerIndexes[K];return Y||(Y=this.layerIndexes[K]=new c),Y}_getWorkerSource(K,Y,oe){if(this.workerSources[K]||(this.workerSources[K]={}),this.workerSources[K][Y]||(this.workerSources[K][Y]={}),!this.workerSources[K][Y][oe]){const ae={sendAsync:(Ee,Me)=>(Ee.targetMapId=K,this.actor.sendAsync(Ee,Me))};switch(Y){case"vector":this.workerSources[K][Y][oe]=new F(ae,this._getLayerIndex(K),this._getAvailableImages(K));break;case"geojson":this.workerSources[K][Y][oe]=new Ai(ae,this._getLayerIndex(K),this._getAvailableImages(K));break;default:this.workerSources[K][Y][oe]=new this.externalWorkerSourceTypes[Y](ae,this._getLayerIndex(K),this._getAvailableImages(K))}}return this.workerSources[K][Y][oe]}_getDEMWorkerSource(K,Y){return this.demWorkerSources[K]||(this.demWorkerSources[K]={}),this.demWorkerSources[K][Y]||(this.demWorkerSources[K][Y]=new q),this.demWorkerSources[K][Y]}}return L.i(self)&&(self.worker=new gr(self)),gr})),T("index",["exports","./shared"],(function(L,c){var W="4.7.1";let ee,Q;const F={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:_=>new Promise(((e,o)=>{const d=requestAnimationFrame(e);_.signal.addEventListener("abort",(()=>{cancelAnimationFrame(d),o(c.c())}))})),getImageData(_,e=0){return this.getImageCanvasContext(_).getImageData(-e,-e,_.width+2*e,_.height+2*e)},getImageCanvasContext(_){const e=window.document.createElement("canvas"),o=e.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return e.width=_.width,e.height=_.height,o.drawImage(_,0,0,_.width,_.height),o},resolveURL:_=>(ee||(ee=document.createElement("a")),ee.href=_,ee.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Q==null&&(Q=matchMedia("(prefers-reduced-motion: reduce)")),Q.matches)}};class q{static testProp(e){if(!q.docStyle)return e[0];for(let o=0;o<e.length;o++)if(e[o]in q.docStyle)return e[o];return e[0]}static create(e,o,d){const p=window.document.createElement(e);return o!==void 0&&(p.className=o),d&&d.appendChild(p),p}static createNS(e,o){return window.document.createElementNS(e,o)}static disableDrag(){q.docStyle&&q.selectProp&&(q.userSelect=q.docStyle[q.selectProp],q.docStyle[q.selectProp]="none")}static enableDrag(){q.docStyle&&q.selectProp&&(q.docStyle[q.selectProp]=q.userSelect)}static setTransform(e,o){e.style[q.transformProp]=o}static addEventListener(e,o,d,p={}){e.addEventListener(o,d,"passive"in p?p:p.capture)}static removeEventListener(e,o,d,p={}){e.removeEventListener(o,d,"passive"in p?p:p.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",q.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",q.suppressClickInternal,!0)}),0)}static getScale(e){const o=e.getBoundingClientRect();return{x:o.width/e.offsetWidth||1,y:o.height/e.offsetHeight||1,boundingClientRect:o}}static getPoint(e,o,d){const p=o.boundingClientRect;return new c.P((d.clientX-p.left)/o.x-e.clientLeft,(d.clientY-p.top)/o.y-e.clientTop)}static mousePos(e,o){const d=q.getScale(e);return q.getPoint(e,d,o)}static touchPos(e,o){const d=[],p=q.getScale(e);for(let y=0;y<o.length;y++)d.push(q.getPoint(e,p,o[y]));return d}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,q.selectProp=q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),q.transformProp=q.testProp(["transform","WebkitTransform"]);const se={supported:!1,testSupport:function(_){!Ie&&fe&&(Be?Ce(_):le=_)}};let le,fe,Ie=!1,Be=!1;function Ce(_){const e=_.createTexture();_.bindTexture(_.TEXTURE_2D,e);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,fe),_.isContextLost())return;se.supported=!0}catch{}_.deleteTexture(e),Ie=!0}var Ge;typeof document<"u"&&(fe=document.createElement("img"),fe.onload=()=>{le&&Ce(le),le=null,Be=!0},fe.onerror=()=>{Ie=!0,le=null},fe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(_){let e,o,d,p;_.resetRequestQueue=()=>{e=[],o=0,d=0,p={}},_.addThrottleControl=D=>{const V=d++;return p[V]=D,V},_.removeThrottleControl=D=>{delete p[D],P()},_.getImage=(D,V,$=!0)=>new Promise(((Z,te)=>{se.supported&&(D.headers||(D.headers={}),D.headers.accept="image/webp,*/*"),c.e(D,{type:"image"}),e.push({abortController:V,requestParameters:D,supportImageRefresh:$,state:"queued",onError:ue=>{te(ue)},onSuccess:ue=>{Z(ue)}}),P()}));const y=D=>c._(this,void 0,void 0,(function*(){D.state="running";const{requestParameters:V,supportImageRefresh:$,onError:Z,onSuccess:te,abortController:ue}=D,he=$===!1&&!c.i(self)&&!c.g(V.url)&&(!V.headers||Object.keys(V.headers).reduce(((ve,Se)=>ve&&Se==="accept"),!0));o++;const pe=he?A(V,ue):c.m(V,ue);try{const ve=yield pe;delete D.abortController,D.state="completed",ve.data instanceof HTMLImageElement||c.b(ve.data)?te(ve):ve.data&&te({data:yield(ge=ve.data,typeof createImageBitmap=="function"?c.d(ge):c.f(ge)),cacheControl:ve.cacheControl,expires:ve.expires})}catch(ve){delete D.abortController,Z(ve)}finally{o--,P()}var ge})),P=()=>{const D=(()=>{for(const V of Object.keys(p))if(p[V]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let V=o;V<D&&e.length>0;V++){const $=e.shift();$.abortController.signal.aborted?V--:y($)}},A=(D,V)=>new Promise((($,Z)=>{const te=new Image,ue=D.url,he=D.credentials;he&&he==="include"?te.crossOrigin="use-credentials":(he&&he==="same-origin"||!c.s(ue))&&(te.crossOrigin="anonymous"),V.signal.addEventListener("abort",(()=>{te.src="",Z(c.c())})),te.fetchPriority="high",te.onload=()=>{te.onerror=te.onload=null,$({data:te})},te.onerror=()=>{te.onerror=te.onload=null,V.signal.aborted||Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},te.src=ue}))})(Ge||(Ge={})),Ge.resetRequestQueue();class it{constructor(e){this._transformRequestFn=e}transformRequest(e,o){return this._transformRequestFn&&this._transformRequestFn(e,o)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function We(_){var e=new c.A(3);return e[0]=_[0],e[1]=_[1],e[2]=_[2],e}var tt,at=function(_,e,o){return _[0]=e[0]-o[0],_[1]=e[1]-o[1],_[2]=e[2]-o[2],_};tt=new c.A(3),c.A!=Float32Array&&(tt[0]=0,tt[1]=0,tt[2]=0);var ht=function(_){var e=_[0],o=_[1];return e*e+o*o};function ft(_){const e=[];if(typeof _=="string")e.push({id:"default",url:_});else if(_&&_.length>0){const o=[];for(const{id:d,url:p}of _){const y=`${d}${p}`;o.indexOf(y)===-1&&(o.push(y),e.push({id:d,url:p}))}}return e}function $t(_,e,o){const d=_.split("?");return d[0]+=`${e}${o}`,d.join("?")}(function(){var _=new c.A(2);c.A!=Float32Array&&(_[0]=0,_[1]=0)})();class wt{constructor(e,o,d,p){this.context=e,this.format=d,this.texture=e.gl.createTexture(),this.update(o,p)}update(e,o,d){const{width:p,height:y}=e,P=!(this.size&&this.size[0]===p&&this.size[1]===y||d),{context:A}=this,{gl:D}=A;if(this.useMipmap=!!(o&&o.useMipmap),D.bindTexture(D.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!o||o.premultiply!==!1)),P)this.size=[p,y],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,e):D.texImage2D(D.TEXTURE_2D,0,this.format,p,y,0,this.format,D.UNSIGNED_BYTE,e.data);else{const{x:V,y:$}=d||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?D.texSubImage2D(D.TEXTURE_2D,0,V,$,D.RGBA,D.UNSIGNED_BYTE,e):D.texSubImage2D(D.TEXTURE_2D,0,V,$,p,y,D.RGBA,D.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&D.generateMipmap(D.TEXTURE_2D)}bind(e,o,d){const{context:p}=this,{gl:y}=p;y.bindTexture(y.TEXTURE_2D,this.texture),d!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=y.LINEAR),e!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,e),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,d||e),this.filter=e),o!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,o),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Zt(_){const{userImage:e}=_;return!!(e&&e.render&&e.render())&&(_.data.replace(new Uint8Array(e.data.buffer)),!0)}class Bt extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:o,promiseResolve:d}of this.requestors)d(this._getImagesForIds(o));this.requestors=[]}}getImage(e){const o=this.images[e];if(o&&!o.data&&o.spriteData){const d=o.spriteData;o.data=new c.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),o.spriteData=null}return o}addImage(e,o){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,o)&&(this.images[e]=o)}_validate(e,o){let d=!0;const p=o.data||o.spriteData;return this._validateStretch(o.stretchX,p&&p.width)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchX" value`))),d=!1),this._validateStretch(o.stretchY,p&&p.height)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchY" value`))),d=!1),this._validateContent(o.content,o)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "content" value`))),d=!1),d}_validateStretch(e,o){if(!e)return!0;let d=0;for(const p of e){if(p[0]<d||p[1]<p[0]||o<p[1])return!1;d=p[1]}return!0}_validateContent(e,o){if(!e)return!0;if(e.length!==4)return!1;const d=o.spriteData,p=d&&d.width||o.data.width,y=d&&d.height||o.data.height;return!(e[0]<0||p<e[0]||e[1]<0||y<e[1]||e[2]<0||p<e[2]||e[3]<0||y<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,o,d=!0){const p=this.getImage(e);if(d&&(p.data.width!==o.data.width||p.data.height!==o.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=p.version+1,this.images[e]=o,this.updatedImages[e]=!0}removeImage(e){const o=this.images[e];delete this.images[e],delete this.patterns[e],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((o,d)=>{let p=!0;if(!this.isLoaded())for(const y of e)this.images[y]||(p=!1);this.isLoaded()||p?o(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:o})}))}_getImagesForIds(e){const o={};for(const d of e){let p=this.getImage(d);p||(this.fire(new c.k("styleimagemissing",{id:d})),p=this.getImage(d)),p?o[d]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,textFitWidth:p.textFitWidth,textFitHeight:p.textFitHeight,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:c.w(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:e,height:o}=this.atlasImage;return{width:e,height:o}}getPattern(e){const o=this.patterns[e],d=this.getImage(e);if(!d)return null;if(o&&o.position.version===d.version)return o.position;if(o)o.position.version=d.version;else{const p={w:d.data.width+2,h:d.data.height+2,x:0,y:0},y=new c.I(p,d);this.patterns[e]={bin:p,position:y}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const o=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new wt(e,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const y in this.patterns)e.push(this.patterns[y].bin);const{w:o,h:d}=c.p(e),p=this.atlasImage;p.resize({width:o||1,height:d||1});for(const y in this.patterns){const{bin:P}=this.patterns[y],A=P.x+1,D=P.y+1,V=this.getImage(y).data,$=V.width,Z=V.height;c.R.copy(V,p,{x:0,y:0},{x:A,y:D},{width:$,height:Z}),c.R.copy(V,p,{x:0,y:Z-1},{x:A,y:D-1},{width:$,height:1}),c.R.copy(V,p,{x:0,y:0},{x:A,y:D+Z},{width:$,height:1}),c.R.copy(V,p,{x:$-1,y:0},{x:A-1,y:D},{width:1,height:Z}),c.R.copy(V,p,{x:0,y:0},{x:A+$,y:D},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const o of e){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const d=this.getImage(o);d||c.w(`Image with ID: "${o}" was not found`),Zt(d)&&this.updateImage(o,d)}}}const je=1e20;function zt(_,e,o,d,p,y,P,A,D){for(let V=e;V<e+d;V++)an(_,o*y+V,y,p,P,A,D);for(let V=o;V<o+p;V++)an(_,V*y+e,1,d,P,A,D)}function an(_,e,o,d,p,y,P){y[0]=0,P[0]=-je,P[1]=je,p[0]=_[e];for(let A=1,D=0,V=0;A<d;A++){p[A]=_[e+A*o];const $=A*A;do{const Z=y[D];V=(p[A]-p[Z]+$-Z*Z)/(A-Z)/2}while(V<=P[D]&&--D>-1);D++,y[D]=A,P[D]=V,P[D+1]=je}for(let A=0,D=0;A<d;A++){for(;P[D+1]<A;)D++;const V=y[D],$=A-V;_[e+A*o]=p[V]+$*$}}class rn{constructor(e,o){this.requestManager=e,this.localIdeographFontFamily=o,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,(function*(){const o=[];for(const y in e)for(const P of e[y])o.push(this._getAndCacheGlyphsPromise(y,P));const d=yield Promise.all(o),p={};for(const{stack:y,id:P,glyph:A}of d)p[y]||(p[y]={}),p[y][P]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};return p}))}_getAndCacheGlyphsPromise(e,o){return c._(this,void 0,void 0,(function*(){let d=this.entries[e];d||(d=this.entries[e]={glyphs:{},requests:{},ranges:{}});let p=d.glyphs[o];if(p!==void 0)return{stack:e,id:o,glyph:p};if(p=this._tinySDF(d,e,o),p)return d.glyphs[o]=p,{stack:e,id:o,glyph:p};const y=Math.floor(o/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(d.ranges[y])return{stack:e,id:o,glyph:p};if(!this.url)throw new Error("glyphsUrl is not set");if(!d.requests[y]){const A=rn.loadGlyphRange(e,y,this.url,this.requestManager);d.requests[y]=A}const P=yield d.requests[y];for(const A in P)this._doesCharSupportLocalGlyph(+A)||(d.glyphs[+A]=P[+A]);return d.ranges[y]=!0,{stack:e,id:o,glyph:P[o]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,o,d){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(d))return;let y=e.tinySDF;if(!y){let A="400";/bold/i.test(o)?A="900":/medium/i.test(o)?A="500":/light/i.test(o)&&(A="200"),y=e.tinySDF=new rn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:A})}const P=y.draw(String.fromCharCode(d));return{id:d,bitmap:new c.o({width:P.width||60,height:P.height||60},P.data),metrics:{width:P.glyphWidth/2||24,height:P.glyphHeight/2||24,left:P.glyphLeft/2+.5||0,top:P.glyphTop/2-27.5||-8,advance:P.glyphAdvance/2||24,isDoubleResolution:!0}}}}rn.loadGlyphRange=function(_,e,o,d){return c._(this,void 0,void 0,(function*(){const p=256*e,y=p+255,P=d.transformRequest(o.replace("{fontstack}",_).replace("{range}",`${p}-${y}`),"Glyphs"),A=yield c.l(P,new AbortController);if(!A||!A.data)throw new Error(`Could not load glyph range. range: ${e}, ${p}-${y}`);const D={};for(const V of c.n(A.data))D[V.id]=V;return D}))},rn.TinySDF=class{constructor({fontSize:_=24,buffer:e=3,radius:o=8,cutoff:d=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:P="normal"}={}){this.buffer=e,this.cutoff=d,this.radius=o;const A=this.size=_+4*e,D=this._createCanvas(A),V=this.ctx=D.getContext("2d",{willReadFrequently:!0});V.font=`${P} ${y} ${_}px ${p}`,V.textBaseline="alphabetic",V.textAlign="left",V.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(_){const e=document.createElement("canvas");return e.width=e.height=_,e}draw(_){const{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:d,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(_),P=Math.ceil(o),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),D=Math.min(this.size-this.buffer,P+Math.ceil(d)),V=A+2*this.buffer,$=D+2*this.buffer,Z=Math.max(V*$,0),te=new Uint8ClampedArray(Z),ue={data:te,width:V,height:$,glyphWidth:A,glyphHeight:D,glyphTop:P,glyphLeft:0,glyphAdvance:e};if(A===0||D===0)return ue;const{ctx:he,buffer:pe,gridInner:ge,gridOuter:ve}=this;he.clearRect(pe,pe,A,D),he.fillText(_,pe,pe+P);const Se=he.getImageData(pe,pe,A,D);ve.fill(je,0,Z),ge.fill(0,0,Z);for(let me=0;me<D;me++)for(let Ae=0;Ae<A;Ae++){const Oe=Se.data[4*(me*A+Ae)+3]/255;if(Oe===0)continue;const qe=(me+pe)*V+Ae+pe;if(Oe===1)ve[qe]=0,ge[qe]=je;else{const ot=.5-Oe;ve[qe]=ot>0?ot*ot:0,ge[qe]=ot<0?ot*ot:0}}zt(ve,0,0,V,$,V,this.f,this.v,this.z),zt(ge,pe,pe,A,D,V,this.f,this.v,this.z);for(let me=0;me<Z;me++){const Ae=Math.sqrt(ve[me])-Math.sqrt(ge[me]);te[me]=Math.round(255-255*(Ae/this.radius+this.cutoff))}return ue}};class bt{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,o){return c.x(e.expression.evaluate(o))}interpolate(e,o,d){return{x:c.y.number(e.x,o.x,d),y:c.y.number(e.y,o.y,d),z:c.y.number(e.z,o.z,d)}}}let jt;class nt extends c.E{constructor(e){super(),jt=jt||new c.q({anchor:new c.D(c.v.light.anchor),position:new bt,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(jt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,o={}){if(!this._validate(c.r,e,o))for(const d in e){const p=e[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),p):this._transitionable.setValue(d,p)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,d){return(!d||d.validate!==!1)&&c.t(this,e.call(c.u,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const Re=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class rt extends c.E{constructor(e){super(),this._transitionable=new c.T(Re),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0))}setSky(e,o={}){if(!this._validate(c.B,e,o)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const d in e){const p=e[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),p):this._transitionable.setValue(d,p)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,d={}){return d?.validate!==!1&&c.t(this,e.call(c.u,c.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class on{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,o){const d=e.join(",")+String(o);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(e,o)),this.dashEntry[d]}getDashRanges(e,o,d){const p=[];let y=e.length%2==1?-e[e.length-1]*d:0,P=e[0]*d,A=!0;p.push({left:y,right:P,isDash:A,zeroLength:e[0]===0});let D=e[0];for(let V=1;V<e.length;V++){A=!A;const $=e[V];y=D*d,D+=$,P=D*d,p.push({left:y,right:P,isDash:A,zeroLength:$===0})}return p}addRoundDash(e,o,d){const p=o/2;for(let y=-d;y<=d;y++){const P=this.width*(this.nextRow+d+y);let A=0,D=e[A];for(let V=0;V<this.width;V++){V/D.right>1&&(D=e[++A]);const $=Math.abs(V-D.left),Z=Math.abs(V-D.right),te=Math.min($,Z);let ue;const he=y/d*(p+1);if(D.isDash){const pe=p-Math.abs(he);ue=Math.sqrt(te*te+pe*pe)}else ue=p-Math.sqrt(te*te+he*he);this.data[P+V]=Math.max(0,Math.min(255,ue+128))}}}addRegularDash(e){for(let A=e.length-1;A>=0;--A){const D=e[A],V=e[A+1];D.zeroLength?e.splice(A,1):V&&V.isDash===D.isDash&&(V.left=D.left,e.splice(A,1))}const o=e[0],d=e[e.length-1];o.isDash===d.isDash&&(o.left=d.left-this.width,d.right=o.right+this.width);const p=this.width*this.nextRow;let y=0,P=e[y];for(let A=0;A<this.width;A++){A/P.right>1&&(P=e[++y]);const D=Math.abs(A-P.left),V=Math.abs(A-P.right),$=Math.min(D,V);this.data[p+A]=Math.max(0,Math.min(255,(P.isDash?$:-$)+128))}}addDash(e,o){const d=o?7:0,p=2*d+1;if(this.nextRow+p>this.height)return c.w("LineAtlas out of space"),null;let y=0;for(let A=0;A<e.length;A++)y+=e[A];if(y!==0){const A=this.width/y,D=this.getDashRanges(e,this.width,A);o?this.addRoundDash(D,A,d):this.addRegularDash(D)}const P={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:y};return this.nextRow+=p,this.dirty=!0,P}bind(e){const o=e.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const Pt="maplibre_preloaded_worker_pool";class yn{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<yn.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((o=>{o.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Pt]}numActive(){return Object.keys(this.active).length}}const Dn=Math.floor(F.hardwareConcurrency/2);let Rn,Ne;function ei(){return Rn||(Rn=new yn),Rn}yn.workerCount=c.C(globalThis)?Math.max(Math.min(Dn,3),1):1;class Cn{constructor(e,o){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=o;const d=this.workerPool.acquire(o);for(let p=0;p<d.length;p++){const y=new c.F(d[p],o);y.name=`Worker ${p}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,o){const d=[];for(const p of this.actors)d.push(p.sendAsync({type:e,data:o}));return Promise.all(d)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((o=>{o.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,o){for(const d of this.actors)d.registerMessageHandler(e,o)}}function Kt(){return Ne||(Ne=new Cn(ei(),c.G),Ne.registerMessageHandler("GR",((_,e,o)=>c.m(e,o)))),Ne}function we(_,e){const o=c.H();return c.J(o,o,[1,1,0]),c.K(o,o,[.5*_.width,.5*_.height,1]),c.L(o,o,_.calculatePosMatrix(e.toUnwrapped()))}function $i(_,e,o,d,p,y){const P=(function(Z,te,ue){if(Z)for(const he of Z){const pe=te[he];if(pe&&pe.source===ue&&pe.type==="fill-extrusion")return!0}else for(const he in te){const pe=te[he];if(pe.source===ue&&pe.type==="fill-extrusion")return!0}return!1})(p&&p.layers,e,_.id),A=y.maxPitchScaleFactor(),D=_.tilesIn(d,A,P);D.sort(Vr);const V=[];for(const Z of D)V.push({wrappedTileID:Z.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(e,o,_._state,Z.queryGeometry,Z.cameraQueryGeometry,Z.scale,p,y,A,we(_.transform,Z.tileID))});const $=(function(Z){const te={},ue={};for(const he of Z){const pe=he.queryResults,ge=he.wrappedTileID,ve=ue[ge]=ue[ge]||{};for(const Se in pe){const me=pe[Se],Ae=ve[Se]=ve[Se]||{},Oe=te[Se]=te[Se]||[];for(const qe of me)Ae[qe.featureIndex]||(Ae[qe.featureIndex]=!0,Oe.push(qe))}}return te})(V);for(const Z in $)$[Z].forEach((te=>{const ue=te.feature,he=_.getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=he}));return $}function Vr(_,e){const o=_.tileID,d=e.tileID;return o.overscaledZ-d.overscaledZ||o.canonical.y-d.canonical.y||o.wrap-d.wrap||o.canonical.x-d.canonical.x}function Rr(_,e,o){return c._(this,void 0,void 0,(function*(){let d=_;if(_.url?d=(yield c.h(e.transformRequest(_.url,"Source"),o)).data:yield F.frameAsync(o),!d)return null;const p=c.M(c.e(d,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in d&&d.vector_layers&&(p.vectorLayerIds=d.vector_layers.map((y=>y.id))),p}))}class Ye{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}extend(e){const o=this._sw,d=this._ne;let p,y;if(e instanceof c.N)p=e,y=e;else{if(!(e instanceof Ye))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ye.convert(e)):this.extend(c.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.N.convert(e)):this;if(p=e._sw,y=e._ne,!p||!y)return this}return o||d?(o.lng=Math.min(p.lng,o.lng),o.lat=Math.min(p.lat,o.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new c.N(p.lng,p.lat),this._ne=new c.N(y.lng,y.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:d}=c.N.convert(e);let p=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&p}static convert(e){return e instanceof Ye?e:e&&new Ye(e)}static fromLngLat(e,o=0){const d=360*o/40075017,p=d/Math.cos(Math.PI/180*e.lat);return new Ye(new c.N(e.lng-p,e.lat-d),new c.N(e.lng+p,e.lat+d))}adjustAntiMeridian(){const e=new c.N(this._sw.lng,this._sw.lat),o=new c.N(this._ne.lng,this._ne.lat);return new Ye(e,e.lng>o.lng?new c.N(o.lng+360,o.lat):o)}}class ds{constructor(e,o,d){this.bounds=Ye.convert(this.validateBounds(e)),this.minzoom=o||0,this.maxzoom=d||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const o=Math.pow(2,e.z),d=Math.floor(c.O(this.bounds.getWest())*o),p=Math.floor(c.Q(this.bounds.getNorth())*o),y=Math.ceil(c.O(this.bounds.getEast())*o),P=Math.ceil(c.Q(this.bounds.getSouth())*o);return e.x>=d&&e.x<y&&e.y>=p&&e.y<P}}class Co extends c.E{constructor(e,o,d,p){if(super(),this.id=e,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(o,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Rr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new ds(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,(function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(o,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};d.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((y,P)=>{e.reloadPromise={resolve:y,reject:P}}))}else e.actor=this.dispatcher.getActor(),p="LT";e.abortController=new AbortController;try{const y=yield e.actor.sendAsync({type:p,data:d},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,y)}catch(y){if(delete e.abortController,e.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,o){if(o&&o.resourceTiming&&(e.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&e.setExpiryData(o),e.loadVectorData(o,this.map.painter),e.reloadPromise){const d=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(d.resolve).catch(d.reject)}}abortTile(e){return c._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return c._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class lt extends c.E{constructor(e,o,d,p){super(),this.id=e,this.dispatcher=d,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},o),c.e(this,c.M(o,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Rr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(c.e(this,e),e.bounds&&(this.tileBounds=new ds(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,(function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const d=yield Ge.getImage(this.map._requestManager.transformRequest(o,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const p=this.map.painter.context,y=p.gl,P=d.data;e.texture=this.map.painter.getTileTexture(P.width),e.texture?e.texture.update(P,{useMipmap:!0}):(e.texture=new wt(p,P,y.RGBA,{useMipmap:!0}),e.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}}))}abortTile(e){return c._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return c._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class ai extends lt{constructor(e,o,d,p){super(e,o,d,p),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(e){return c._(this,void 0,void 0,(function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d=this.map._requestManager.transformRequest(o,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const p=yield Ge.getImage(d,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(p&&p.data){const y=p.data;this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&e.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const P=c.b(y)&&c.U()?y:yield this.readImageNow(y),A={type:this.type,uid:e.uid,source:this.id,rawImageData:P,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const D=yield e.actor.sendAsync({type:"LDT",data:A});e.dem=D,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(p){if(delete e.abortController,e.aborted)e.state="unloaded";else if(p)throw e.state="errored",p}}))}readImageNow(e){return c._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&c.V()){const o=e.width+2,d=e.height+2;try{return new c.R({width:o,height:d},yield c.W(e,-1,-1,o,d))}catch{}}return F.getImageData(e,1)}))}_getNeighboringTiles(e){const o=e.canonical,d=Math.pow(2,o.z),p=(o.x-1+d)%d,y=o.x===0?e.wrap-1:e.wrap,P=(o.x+1+d)%d,A=o.x+1===d?e.wrap+1:e.wrap,D={};return D[new c.S(e.overscaledZ,y,o.z,p,o.y).key]={backfilled:!1},D[new c.S(e.overscaledZ,A,o.z,P,o.y).key]={backfilled:!1},o.y>0&&(D[new c.S(e.overscaledZ,y,o.z,p,o.y-1).key]={backfilled:!1},D[new c.S(e.overscaledZ,e.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},D[new c.S(e.overscaledZ,A,o.z,P,o.y-1).key]={backfilled:!1}),o.y+1<d&&(D[new c.S(e.overscaledZ,y,o.z,p,o.y+1).key]={backfilled:!1},D[new c.S(e.overscaledZ,e.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},D[new c.S(e.overscaledZ,A,o.z,P,o.y+1).key]={backfilled:!1}),D}unloadTile(e){return c._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class ps extends c.E{constructor(e,o,d,p){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(p),this._data=o.data,this._options=c.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const y=c.X/this.tileSize;o.clusterMaxZoom!==void 0&&this.maxzoom<=o.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${o.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*y,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*y,extent:c.X,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:c.X,radius:(o.clusterRadius||50)*y,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,(function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,o,d){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:o,offset:d}})}_updateWorkerData(e){return c._(this,void 0,void 0,(function*(){const o=c.e({type:this.type},this.workerOptions);e?o.dataDiff=e:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(F.resolveURL(this._data),"Source"),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{const d=yield this.actor.sendAsync({type:"LD",data:o});if(this._pendingLoads--,this._removed||d.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let p=null;d.resourceTiming&&d.resourceTiming[this.id]&&(p=d.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&p&&p.length>0&&c.e(y,{resourceTiming:p}),this.fire(new c.k("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(d){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(d))}}))}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,(function*(){const o=e.actor?"RT":"LT";e.actor=this.actor;const d={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const p=yield this.actor.sendAsync({type:o,data:d},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(p,this.map.painter,o==="RT")}))}abortTile(e){return c._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return c._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var pr=c.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class As extends c.E{constructor(e,o,d,p){super(),this.id=e,this.dispatcher=d,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=o}load(e){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield Ge.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,e&&(this.coordinates=e),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new c.j(o))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const o=e.map(c.Z.fromLngLat);this.tileID=(function(p){let y=1/0,P=1/0,A=-1/0,D=-1/0;for(const te of p)y=Math.min(y,te.x),P=Math.min(P,te.y),A=Math.max(A,te.x),D=Math.max(D,te.y);const V=Math.max(A-y,D-P),$=Math.max(0,Math.floor(-Math.log(V)/Math.LN2)),Z=Math.pow(2,$);return new c.a1($,Math.floor((y+A)/2*Z),Math.floor((P+D)/2*Z))})(o),this.minzoom=this.maxzoom=this.tileID.z;const d=o.map((p=>this.tileID.getTilePoint(p)._round()));return this._boundsArray=new c.$,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,c.X,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,c.X),this._boundsArray.emplaceBack(d[2].x,d[2].y,c.X,c.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,o=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,pr.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new wt(e,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let d=!1;for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,d=!0)}d&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class vn extends As{constructor(e,o,d,p){super(e,o,d,p),this.roundZoom=!0,this.type="video",this.options=o}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const o of e.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield c.a3(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new c.j(o))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const o=this.video.seekable;e<o.start(0)||e>o.end(0)?this.fire(new c.j(new c.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,o=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,pr.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new wt(e,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let d=!1;for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,d=!0)}d&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ir extends As{constructor(e,o,d,p){super(e,o,d,p),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some((y=>!Array.isArray(y)||y.length!==2||y.some((P=>typeof P!="number"))))||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new c.j(new c.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,d=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,pr.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new wt(o,this.canvas,d.RGBA,{premultiply:!0});let p=!1;for(const y in this.tiles){const P=this.tiles[y];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,p=!0)}p&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const aa={},oa=_=>{switch(_){case"geojson":return ps;case"image":return As;case"raster":return lt;case"raster-dem":return ai;case"vector":return Co;case"video":return vn;case"canvas":return ir}return aa[_]},Qe="RTLPluginLoaded";class Ur extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Kt()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((o=>{throw this.status="error",o}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,(function*(o,d=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=F.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!d)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return c._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(Qe))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let dn=null;function tn(){return dn||(dn=new Ur),dn}class Aa{constructor(e,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const o=e+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,o,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(p,y){const P={};if(!y)return P;for(const A of p){const D=A.layerIds.map((V=>y.getLayer(V))).filter(Boolean);if(D.length!==0){A.layers=D,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map((V=>D.filter(($=>$.id===V))[0])));for(const V of D)P[V.id]=A}}return P})(e.buckets,o.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const y=this.buckets[p];if(y instanceof c.a6){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const y=this.buckets[p];if(y instanceof c.a6&&y.hasRTLText){this.hasRTLText=!0,tn().lazyLoad();break}}this.queryPadding=0;for(const p in this.buckets){const y=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(p).queryRadius(y))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const d in this.buckets){const p=this.buckets[d];p.uploadPending()&&p.upload(e)}const o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new wt(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new wt(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,d,p,y,P,A,D,V,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:P,tileSize:this.tileSize,pixelPosMatrix:$,transform:D,params:A,queryPadding:this.queryPadding*V},e,o,d):{}}querySourceFeatures(e,o){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const p=d.loadVTLayers(),y=o&&o.sourceLayer?o.sourceLayer:"",P=p._geojsonTileLayer||p[y];if(!P)return;const A=c.a7(o&&o.filter),{z:D,x:V,y:$}=this.tileID.canonical,Z={z:D,x:V,y:$};for(let te=0;te<P.length;te++){const ue=P.feature(te);if(A.needGeometry){const ge=c.a8(ue,!0);if(!A.filter(new c.z(this.tileID.overscaledZ),ge,this.tileID.canonical))continue}else if(!A.filter(new c.z(this.tileID.overscaledZ),ue))continue;const he=d.getId(ue,y),pe=new c.a9(ue,D,V,$,he);pe.tile=Z,e.push(pe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const o=this.expirationTime;if(e.cacheControl){const d=c.aa(e.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const d=Date.now();let p=!1;if(this.expirationTime>d)p=!1;else if(o)if(this.expirationTime<o)p=!0;else{const y=this.expirationTime-o;y?this.expirationTime=d+Math.max(y,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!o.style.hasLayer(p))continue;const y=this.buckets[p],P=y.layers[0].sourceLayer||"_geojsonTileLayer",A=d[P],D=e[P];if(!A||!D||Object.keys(D).length===0)continue;y.update(D,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});const V=o&&o.style&&o.style.getLayer(p);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<F.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=F.now()+e}setDependencies(e,o){const d={};for(const p of o)d[p]=!0;this.dependencies[e]=d}hasDependency(e,o){for(const d of e){const p=this.dependencies[d];if(p){for(const y of o)if(p[y])return!0}}return!1}}class _t{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(const e in this.data)for(const o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,d){const p=e.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const y={value:o,timeout:void 0};if(d!==void 0&&(y.timeout=setTimeout((()=>{this.remove(e,y)}),d)),this.data[p].push(y),this.order.push(p),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){const o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;const d=e.wrapped().key,p=o===void 0?0:this.data[d].indexOf(o),y=this.data[d][p];return this.data[d].splice(p,1),y.timeout&&clearTimeout(y.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){const o=[];for(const d in this.data)for(const p of this.data[d])e(p.value)||o.push(p);for(const d of o)this.remove(d.value.tileID,d)}}class In{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,d){const p=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][p]=this.stateChanges[e][p]||{},c.e(this.stateChanges[e][p],d),this.deletedStates[e]===null){this.deletedStates[e]={};for(const y in this.state[e])y!==p&&(this.deletedStates[e][y]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][p]===null){this.deletedStates[e][p]={};for(const y in this.state[e][p])d[y]||(this.deletedStates[e][p][y]=null)}else for(const y in d)this.deletedStates[e]&&this.deletedStates[e][p]&&this.deletedStates[e][p][y]===null&&delete this.deletedStates[e][p][y]}removeFeatureState(e,o,d){if(this.deletedStates[e]===null)return;const p=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},d&&o!==void 0)this.deletedStates[e][p]!==null&&(this.deletedStates[e][p]=this.deletedStates[e][p]||{},this.deletedStates[e][p][d]=null);else if(o!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][p])for(d in this.deletedStates[e][p]={},this.stateChanges[e][p])this.deletedStates[e][p][d]=null;else this.deletedStates[e][p]=null;else this.deletedStates[e]=null}getState(e,o){const d=String(o),p=c.e({},(this.state[e]||{})[d],(this.stateChanges[e]||{})[d]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const y=this.deletedStates[e][o];if(y===null)return{};for(const P in y)delete p[P]}return p}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){const d={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const y={};for(const P in this.stateChanges[p])this.state[p][P]||(this.state[p][P]={}),c.e(this.state[p][P],this.stateChanges[p][P]),y[P]=this.state[p][P];d[p]=y}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const y={};if(this.deletedStates[p]===null)for(const P in this.state[p])y[P]={},this.state[p][P]={};else for(const P in this.deletedStates[p]){if(this.deletedStates[p][P]===null)this.state[p][P]={};else for(const A of Object.keys(this.deletedStates[p][P]))delete this.state[p][P][A];y[P]=this.state[p][P]}d[p]=d[p]||{},c.e(d[p],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const p in e)e[p].setFeatureState(d,o)}}class pt extends c.E{constructor(e,o,d){super(),this.id=e,this.dispatcher=d,this.on("data",(p=>this._dataHandler(p))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((p,y,P,A)=>{const D=new(oa(y.type))(p,y,P,A);if(D.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${D.id}`);return D})(e,o,d,this),this._tiles={},this._cache=new _t(0,(p=>this._unloadTile(p))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new In,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const o=this._tiles[e];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,o,d){return c._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,o,d)}catch(p){e.state="errored",p.status!==404?this._source.fire(new c.j(p,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const d=this._tiles[o];d.upload(e),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(mr).map((e=>e.key))}getRenderableIds(e){const o=[];for(const d in this._tiles)this._isIdRenderable(d,e)&&o.push(this._tiles[d]);return e?o.sort(((d,p)=>{const y=d.tileID,P=p.tileID,A=new c.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),D=new c.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-P.overscaledZ||D.y-A.y||D.x-A.x})).map((d=>d.tileID.key)):o.map((d=>d.tileID)).sort(mr).map((d=>d.key))}hasRenderableParent(e){const o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,o){return c._(this,void 0,void 0,(function*(){const d=this._tiles[e];d&&(d.state!=="loading"&&(d.state=o),yield this._loadTile(d,e,o))}))}_tileLoaded(e,o,d){e.timeAdded=F.now(),d==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const o=this.getRenderableIds();for(let p=0;p<o.length;p++){const y=o[p];if(e.neighboringTiles&&e.neighboringTiles[y]){const P=this.getTileByID(y);d(e,P),d(P,e)}}function d(p,y){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let P=y.tileID.canonical.x-p.tileID.canonical.x;const A=y.tileID.canonical.y-p.tileID.canonical.y,D=Math.pow(2,p.tileID.canonical.z),V=y.tileID.key;P===0&&A===0||Math.abs(A)>1||(Math.abs(P)>1&&(Math.abs(P+D)===1?P+=D:Math.abs(P-D)===1&&(P-=D)),y.dem&&p.dem&&(p.dem.backfillBorder(y.dem,P,A),p.neighboringTiles&&p.neighboringTiles[V]&&(p.neighboringTiles[V].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,d,p){for(const y in this._tiles){let P=this._tiles[y];if(p[y]||!P.hasData()||P.tileID.overscaledZ<=o||P.tileID.overscaledZ>d)continue;let A=P.tileID;for(;P&&P.tileID.overscaledZ>o+1;){const V=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[V.key],P&&P.hasData()&&(A=V)}let D=A;for(;D.overscaledZ>o;)if(D=D.scaledTo(D.overscaledZ-1),e[D.key]){p[A.key]=A;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){const d=this._loadedParentTiles[e.key];return d&&d.tileID.overscaledZ>=o?d:null}for(let d=e.overscaledZ-1;d>=o;d--){const p=e.scaledTo(d),y=this._getLoadedTile(p);if(y)return y}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const o=Math.ceil(e.width/this._source.tileSize)+1,d=Math.ceil(e.height/this._source.tileSize)+1,p=Math.floor(o*d*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(y)}handleWrapJump(e){const o=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,o){const d={};for(const p in this._tiles){const y=this._tiles[p];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+o),d[y.tileID.key]=y}this._tiles=d;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}_updateCoveredAndRetainedTiles(e,o,d,p,y,P){const A={},D={},V=Object.keys(e),$=F.now();for(const Z of V){const te=e[Z],ue=this._tiles[Z];if(!ue||ue.fadeEndTime!==0&&ue.fadeEndTime<=$)continue;const he=this.findLoadedParent(te,o),pe=this.findLoadedSibling(te),ge=he||pe||null;ge&&(this._addTile(ge.tileID),A[ge.tileID.key]=ge.tileID),D[Z]=te}this._retainLoadedChildren(D,p,d,e);for(const Z in A)e[Z]||(this._coveredTiles[Z]=!0,e[Z]=A[Z]);if(P){const Z={},te={};for(const ue of y)this._tiles[ue.key].hasData()?Z[ue.key]=ue:te[ue.key]=ue;for(const ue in te){const he=te[ue].children(this._source.maxzoom);this._tiles[he[0].key]&&this._tiles[he[1].key]&&this._tiles[he[2].key]&&this._tiles[he[3].key]&&(Z[he[0].key]=e[he[0].key]=he[0],Z[he[1].key]=e[he[1].key]=he[1],Z[he[2].key]=e[he[2].key]=he[2],Z[he[3].key]=e[he[3].key]=he[3],delete te[ue])}for(const ue in te){const he=te[ue],pe=this.findLoadedParent(he,this._source.minzoom),ge=this.findLoadedSibling(he),ve=pe||ge||null;if(ve){Z[ve.tileID.key]=e[ve.tileID.key]=ve.tileID;for(const Se in Z)Z[Se].isChildOf(ve.tileID)&&delete Z[Se]}}for(const ue in this._tiles)Z[ue]||(this._coveredTiles[ue]=!0)}}update(e,o){if(!this._sourceLoaded||this._paused)return;let d;this.transform=e,this.terrain=o,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(($=>new c.S($.canonical.z,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y))):(d=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(d=d.filter(($=>this._source.hasTile($))))):d=[];const p=e.coveringZoomLevel(this._source),y=Math.max(p-pt.maxOverzooming,this._source.minzoom),P=Math.max(p+pt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const $={};for(const Z of d)if(Z.canonical.z>this._source.minzoom){const te=Z.scaledTo(Z.canonical.z-1);$[te.key]=te;const ue=Z.scaledTo(Math.max(this._source.minzoom,Math.min(Z.canonical.z,5)));$[ue.key]=ue}d=d.concat(Object.values($))}const A=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,A&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const D=this._updateRetainedTiles(d,p);qr(this._source.type)&&this._updateCoveredAndRetainedTiles(D,y,P,p,d,o);for(const $ in D)this._tiles[$].clearFadeHold();const V=c.ab(this._tiles,D);for(const $ of V){const Z=this._tiles[$];Z.hasSymbolBuckets&&!Z.holdingForFade()?Z.setHoldDuration(this.map._fadeDuration):Z.hasSymbolBuckets&&!Z.symbolFadeFinished()||this._removeTile($)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,o){var d;const p={},y={},P=Math.max(o-pt.maxOverzooming,this._source.minzoom),A=Math.max(o+pt.maxUnderzooming,this._source.minzoom),D={};for(const V of e){const $=this._addTile(V);p[V.key]=V,$.hasData()||o<this._source.maxzoom&&(D[V.key]=V)}this._retainLoadedChildren(D,o,A,p);for(const V of e){let $=this._tiles[V.key];if($.hasData())continue;if(o+1>this._source.maxzoom){const te=V.children(this._source.maxzoom)[0],ue=this.getTile(te);if(ue&&ue.hasData()){p[te.key]=te;continue}}else{const te=V.children(this._source.maxzoom);if(p[te[0].key]&&p[te[1].key]&&p[te[2].key]&&p[te[3].key])continue}let Z=$.wasRequested();for(let te=V.overscaledZ-1;te>=P;--te){const ue=V.scaledTo(te);if(y[ue.key])break;if(y[ue.key]=!0,$=this.getTile(ue),!$&&Z&&($=this._addTile(ue)),$){const he=$.hasData();if((he||!(!((d=this.map)===null||d===void 0)&&d.cancelPendingTileRequestsWhileZooming)||Z)&&(p[ue.key]=ue),Z=$.wasRequested(),he)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const o=[];let d,p=this._tiles[e].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){d=this._loadedParentTiles[p.key];break}o.push(p.key);const y=p.scaledTo(p.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;p=y}for(const y of o)this._loadedParentTiles[y]=d}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const o=this._tiles[e].tileID,d=this._getLoadedTile(o);this._loadedSiblingTiles[o.key]=d}}_addTile(e){let o=this._tiles[e.key];if(o)return o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));const d=o;return o||(o=new Aa(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(o,e.key,o.state)),o.uses++,this._tiles[e.key]=o,d||this._source.fire(new c.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const d=o.getExpiryTimeout();d&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),d))}_removeTile(e){const o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(e){const o=e.sourceDataType;e.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&o==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,o,d){const p=[],y=this.transform;if(!y)return p;const P=d?y.getCameraQueryGeometry(e):e,A=e.map((he=>y.pointCoordinate(he,this.terrain))),D=P.map((he=>y.pointCoordinate(he,this.terrain))),V=this.getIds();let $=1/0,Z=1/0,te=-1/0,ue=-1/0;for(const he of D)$=Math.min($,he.x),Z=Math.min(Z,he.y),te=Math.max(te,he.x),ue=Math.max(ue,he.y);for(let he=0;he<V.length;he++){const pe=this._tiles[V[he]];if(pe.holdingForFade())continue;const ge=pe.tileID,ve=Math.pow(2,y.zoom-pe.tileID.overscaledZ),Se=o*pe.queryPadding*c.X/pe.tileSize/ve,me=[ge.getTilePoint(new c.Z($,Z)),ge.getTilePoint(new c.Z(te,ue))];if(me[0].x-Se<c.X&&me[0].y-Se<c.X&&me[1].x+Se>=0&&me[1].y+Se>=0){const Ae=A.map((qe=>ge.getTilePoint(qe))),Oe=D.map((qe=>ge.getTilePoint(qe)));p.push({tile:pe,tileID:ge,queryGeometry:Ae,cameraQueryGeometry:Oe,scale:ve})}}return p}getVisibleCoordinates(e){const o=this.getRenderableIds(e).map((d=>this._tiles[d].tileID));for(const d of o)d.posMatrix=this.transform.calculatePosMatrix(d.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(qr(this._source.type)){const e=F.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=e)return!0}return!1}setFeatureState(e,o,d){this._state.updateState(e=e||"_geojsonTileLayer",o,d)}removeFeatureState(e,o,d){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,d)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,d){const p=this._tiles[e];p&&p.setDependencies(o,d)}reloadTilesForDependencies(e,o){for(const d in this._tiles)this._tiles[d].hasDependency(e,o)&&this._reloadTile(d,"reloading");this._cache.filter((d=>!d.hasDependency(e,o)))}}function mr(_,e){const o=Math.abs(2*_.wrap)-+(_.wrap<0),d=Math.abs(2*e.wrap)-+(e.wrap<0);return _.overscaledZ-e.overscaledZ||d-o||e.canonical.y-_.canonical.y||e.canonical.x-_.canonical.x}function qr(_){return _==="raster"||_==="image"||_==="video"}pt.maxOverzooming=10,pt.maxUnderzooming=3;class pn{constructor(e,o){this.reset(e,o)}reset(e,o){this.points=e||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ac(e,0,1);let o=1,d=this._distances[o];const p=e*this.paddedLength+this.padding;for(;d<p&&o<this._distances.length;)d=this._distances[++o];const y=o-1,P=this._distances[y],A=d-P,D=A>0?(p-P)/A:0;return this.points[y].mult(1-D).add(this.points[o].mult(D))}}function Si(_,e){let o=!0;return _==="always"||_!=="never"&&e!=="never"||(o=!1),o}class Sr{constructor(e,o,d){const p=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(e/d),this.yCellCount=Math.ceil(o/d);for(let P=0;P<this.xCellCount*this.yCellCount;P++)p.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=o,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,o,d,p,y){this._forEachCell(o,d,p,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(o),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(y)}insertCircle(e,o,d,p){this._forEachCell(o-p,d-p,o+p,d+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(o),this.circles.push(d),this.circles.push(p)}_insertBoxCell(e,o,d,p,y,P){this.boxCells[y].push(P)}_insertCircleCell(e,o,d,p,y,P){this.circleCells[y].push(P)}_query(e,o,d,p,y,P,A){if(d<0||e>this.width||p<0||o>this.height)return[];const D=[];if(e<=0&&o<=0&&this.width<=d&&this.height<=p){if(y)return[{key:null,x1:e,y1:o,x2:d,y2:p}];for(let V=0;V<this.boxKeys.length;V++)D.push({key:this.boxKeys[V],x1:this.bboxes[4*V],y1:this.bboxes[4*V+1],x2:this.bboxes[4*V+2],y2:this.bboxes[4*V+3]});for(let V=0;V<this.circleKeys.length;V++){const $=this.circles[3*V],Z=this.circles[3*V+1],te=this.circles[3*V+2];D.push({key:this.circleKeys[V],x1:$-te,y1:Z-te,x2:$+te,y2:Z+te})}}else this._forEachCell(e,o,d,p,this._queryCell,D,{hitTest:y,overlapMode:P,seenUids:{box:{},circle:{}}},A);return D}query(e,o,d,p){return this._query(e,o,d,p,!1,null)}hitTest(e,o,d,p,y,P){return this._query(e,o,d,p,!0,y,P).length>0}hitTestCircle(e,o,d,p,y){const P=e-d,A=e+d,D=o-d,V=o+d;if(A<0||P>this.width||V<0||D>this.height)return!1;const $=[];return this._forEachCell(P,D,A,V,this._queryCellCircle,$,{hitTest:!0,overlapMode:p,circle:{x:e,y:o,radius:d},seenUids:{box:{},circle:{}}},y),$.length>0}_queryCell(e,o,d,p,y,P,A,D){const{seenUids:V,hitTest:$,overlapMode:Z}=A,te=this.boxCells[y];if(te!==null){const he=this.bboxes;for(const pe of te)if(!V.box[pe]){V.box[pe]=!0;const ge=4*pe,ve=this.boxKeys[pe];if(e<=he[ge+2]&&o<=he[ge+3]&&d>=he[ge+0]&&p>=he[ge+1]&&(!D||D(ve))&&(!$||!Si(Z,ve.overlapMode))&&(P.push({key:ve,x1:he[ge],y1:he[ge+1],x2:he[ge+2],y2:he[ge+3]}),$))return!0}}const ue=this.circleCells[y];if(ue!==null){const he=this.circles;for(const pe of ue)if(!V.circle[pe]){V.circle[pe]=!0;const ge=3*pe,ve=this.circleKeys[pe];if(this._circleAndRectCollide(he[ge],he[ge+1],he[ge+2],e,o,d,p)&&(!D||D(ve))&&(!$||!Si(Z,ve.overlapMode))){const Se=he[ge],me=he[ge+1],Ae=he[ge+2];if(P.push({key:ve,x1:Se-Ae,y1:me-Ae,x2:Se+Ae,y2:me+Ae}),$)return!0}}}return!1}_queryCellCircle(e,o,d,p,y,P,A,D){const{circle:V,seenUids:$,overlapMode:Z}=A,te=this.boxCells[y];if(te!==null){const he=this.bboxes;for(const pe of te)if(!$.box[pe]){$.box[pe]=!0;const ge=4*pe,ve=this.boxKeys[pe];if(this._circleAndRectCollide(V.x,V.y,V.radius,he[ge+0],he[ge+1],he[ge+2],he[ge+3])&&(!D||D(ve))&&!Si(Z,ve.overlapMode))return P.push(!0),!0}}const ue=this.circleCells[y];if(ue!==null){const he=this.circles;for(const pe of ue)if(!$.circle[pe]){$.circle[pe]=!0;const ge=3*pe,ve=this.circleKeys[pe];if(this._circlesCollide(he[ge],he[ge+1],he[ge+2],V.x,V.y,V.radius)&&(!D||D(ve))&&!Si(Z,ve.overlapMode))return P.push(!0),!0}}}_forEachCell(e,o,d,p,y,P,A,D){const V=this._convertToXCellCoord(e),$=this._convertToYCellCoord(o),Z=this._convertToXCellCoord(d),te=this._convertToYCellCoord(p);for(let ue=V;ue<=Z;ue++)for(let he=$;he<=te;he++)if(y.call(this,e,o,d,p,this.xCellCount*he+ue,P,A,D))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,o,d,p,y,P){const A=p-e,D=y-o,V=d+P;return V*V>A*A+D*D}_circleAndRectCollide(e,o,d,p,y,P,A){const D=(P-p)/2,V=Math.abs(e-(p+D));if(V>D+d)return!1;const $=(A-y)/2,Z=Math.abs(o-(y+$));if(Z>$+d)return!1;if(V<=D||Z<=$)return!0;const te=V-D,ue=Z-$;return te*te+ue*ue<=d*d}}function Ai(_,e,o,d,p){const y=c.H();return e?(c.K(y,y,[1/p,1/p,1]),o||c.ad(y,y,d.angle)):c.L(y,d.labelPlaneMatrix,_),y}function gr(_,e,o,d,p){if(e){const y=c.ae(_);return c.K(y,y,[p,p,1]),o||c.ad(y,y,-d.angle),y}return d.glCoordMatrix}function _e(_,e,o,d){let p;d?(p=[_,e,d(_,e),1],c.af(p,p,o)):(p=[_,e,0,1],Fn(p,p,o));const y=p[3];return{point:new c.P(p[0]/y,p[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function K(_,e){return .5+_/e*.5}function Y(_,e){return _.x>=-e[0]&&_.x<=e[0]&&_.y>=-e[1]&&_.y<=e[1]}function oe(_,e,o,d,p,y,P,A,D,V,$,Z,te,ue,he){const pe=d?_.textSizeData:_.iconSizeData,ge=c.ag(pe,o.transform.zoom),ve=[256/o.width*2+1,256/o.height*2+1],Se=d?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;Se.clear();const me=_.lineVertexArray,Ae=d?_.text.placedSymbolArray:_.icon.placedSymbolArray,Oe=o.transform.width/o.transform.height;let qe=!1;for(let ot=0;ot<Ae.length;ot++){const yt=Ae.get(ot);if(yt.hidden||yt.writingMode===c.ah.vertical&&!qe){Qt(yt.numGlyphs,Se);continue}qe=!1;const St=_e(yt.anchorX,yt.anchorY,e,he);if(!Y(St.point,ve)){Qt(yt.numGlyphs,Se);continue}const Lt=K(o.transform.cameraToCenterDistance,St.signedDistanceFromCamera),Et=c.ai(pe,ge,yt),kt=P?Et/Lt:Et*Lt,qt={getElevation:he,labelPlaneMatrix:p,lineVertexArray:me,pitchWithMap:P,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:V,tileAnchorPoint:new c.P(yt.anchorX,yt.anchorY),unwrappedTileID:$,width:Z,height:te,translation:ue},gn=Me(qt,yt,kt,!1,A,e,y,_.glyphOffsetArray,Se,Oe,D);qe=gn.useVertical,(gn.notEnoughRoom||qe||gn.needsFlipping&&Me(qt,yt,kt,!0,A,e,y,_.glyphOffsetArray,Se,Oe,D).notEnoughRoom)&&Qt(yt.numGlyphs,Se)}d?_.text.dynamicLayoutVertexBuffer.updateData(Se):_.icon.dynamicLayoutVertexBuffer.updateData(Se)}function ae(_,e,o,d,p,y,P,A){const D=y.glyphStartIndex+y.numGlyphs,V=y.lineStartIndex,$=y.lineStartIndex+y.lineLength,Z=e.getoffsetX(y.glyphStartIndex),te=e.getoffsetX(D-1),ue=vt(_*Z,o,d,p,y.segment,V,$,A,P);if(!ue)return null;const he=vt(_*te,o,d,p,y.segment,V,$,A,P);return he?A.projectionCache.anyProjectionOccluded?null:{first:ue,last:he}:null}function Ee(_,e,o,d){return _===c.ah.horizontal&&Math.abs(o.y-e.y)>Math.abs(o.x-e.x)*d?{useVertical:!0}:(_===c.ah.vertical?e.y<o.y:e.x>o.x)?{needsFlipping:!0}:null}function Me(_,e,o,d,p,y,P,A,D,V,$){const Z=o/24,te=e.lineOffsetX*Z,ue=e.lineOffsetY*Z;let he;if(e.numGlyphs>1){const pe=e.glyphStartIndex+e.numGlyphs,ge=e.lineStartIndex,ve=e.lineStartIndex+e.lineLength,Se=ae(Z,A,te,ue,d,e,$,_);if(!Se)return{notEnoughRoom:!0};const me=_e(Se.first.point.x,Se.first.point.y,P,_.getElevation).point,Ae=_e(Se.last.point.x,Se.last.point.y,P,_.getElevation).point;if(p&&!d){const Oe=Ee(e.writingMode,me,Ae,V);if(Oe)return Oe}he=[Se.first];for(let Oe=e.glyphStartIndex+1;Oe<pe-1;Oe++)he.push(vt(Z*A.getoffsetX(Oe),te,ue,d,e.segment,ge,ve,_,$));he.push(Se.last)}else{if(p&&!d){const ge=_e(_.tileAnchorPoint.x,_.tileAnchorPoint.y,y,_.getElevation).point,ve=e.lineStartIndex+e.segment+1,Se=new c.P(_.lineVertexArray.getx(ve),_.lineVertexArray.gety(ve)),me=_e(Se.x,Se.y,y,_.getElevation),Ae=me.signedDistanceFromCamera>0?me.point:(function(qe,ot,yt,St,Lt,Et){return Fe(qe,ot,yt,1,Lt,Et)})(_.tileAnchorPoint,Se,ge,0,y,_),Oe=Ee(e.writingMode,ge,Ae,V);if(Oe)return Oe}const pe=vt(Z*A.getoffsetX(e.glyphStartIndex),te,ue,d,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,_,$);if(!pe||_.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};he=[pe]}for(const pe of he)c.aj(D,pe.point,pe.angle);return{}}function Fe(_,e,o,d,p,y){const P=_.add(_.sub(e)._unit()),A=p!==void 0?_e(P.x,P.y,p,y.getElevation).point:Ke(P.x,P.y,y).point,D=o.sub(A);return o.add(D._mult(d/D.mag()))}function ke(_,e,o){const d=e.projectionCache;if(d.projections[_])return d.projections[_];const p=new c.P(e.lineVertexArray.getx(_),e.lineVertexArray.gety(_)),y=Ke(p.x,p.y,e);if(y.signedDistanceFromCamera>0)return d.projections[_]=y.point,d.anyProjectionOccluded=d.anyProjectionOccluded||y.isOccluded,y.point;const P=_-o.direction;return(function(A,D,V,$,Z){return Fe(A,D,V,$,void 0,Z)})(o.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(P),e.lineVertexArray.gety(P)),p,o.previousVertex,o.absOffsetX-o.distanceFromAnchor+1,e)}function Ke(_,e,o){const d=_+o.translation[0],p=e+o.translation[1];let y;return!o.pitchWithMap&&o.projection.useSpecialProjectionForSymbols?(y=o.projection.projectTileCoordinates(d,p,o.unwrappedTileID,o.getElevation),y.point.x=(.5*y.point.x+.5)*o.width,y.point.y=(.5*-y.point.y+.5)*o.height):(y=_e(d,p,o.labelPlaneMatrix,o.getElevation),y.isOccluded=!1),y}function ut(_,e,o){return _._unit()._perp()._mult(e*o)}function Ze(_,e,o,d,p,y,P,A,D){if(A.projectionCache.offsets[_])return A.projectionCache.offsets[_];const V=o.add(e);if(_+D.direction<d||_+D.direction>=p)return A.projectionCache.offsets[_]=V,V;const $=ke(_+D.direction,A,D),Z=ut($.sub(o),P,D.direction),te=o.add(Z),ue=$.add(Z);return A.projectionCache.offsets[_]=c.ak(y,V,te,ue)||V,A.projectionCache.offsets[_]}function vt(_,e,o,d,p,y,P,A,D){const V=d?_-e:_+e;let $=V>0?1:-1,Z=0;d&&($*=-1,Z=Math.PI),$<0&&(Z+=Math.PI);let te,ue=$>0?y+p:y+p+1;A.projectionCache.cachedAnchorPoint?te=A.projectionCache.cachedAnchorPoint:(te=Ke(A.tileAnchorPoint.x,A.tileAnchorPoint.y,A).point,A.projectionCache.cachedAnchorPoint=te);let he,pe,ge=te,ve=te,Se=0,me=0;const Ae=Math.abs(V),Oe=[];let qe;for(;Se+me<=Ae;){if(ue+=$,ue<y||ue>=P)return null;Se+=me,ve=ge,pe=he;const St={absOffsetX:Ae,direction:$,distanceFromAnchor:Se,previousVertex:ve};if(ge=ke(ue,A,St),o===0)Oe.push(ve),qe=ge.sub(ve);else{let Lt;const Et=ge.sub(ve);Lt=Et.mag()===0?ut(ke(ue+$,A,St).sub(ge),o,$):ut(Et,o,$),pe||(pe=ve.add(Lt)),he=Ze(ue,Lt,ge,y,P,pe,o,A,St),Oe.push(pe),qe=he.sub(pe)}me=qe.mag()}const ot=qe._mult((Ae-Se)/me)._add(pe||ve),yt=Z+Math.atan2(ge.y-ve.y,ge.x-ve.x);return Oe.push(ot),{point:ot,angle:D?yt:0,path:Oe}}const Ut=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Qt(_,e){for(let o=0;o<_;o++){const d=e.length;e.resize(d+4),e.float32.set(Ut,3*d)}}function Fn(_,e,o){const d=e[0],p=e[1];return _[0]=o[0]*d+o[4]*p+o[12],_[1]=o[1]*d+o[5]*p+o[13],_[3]=o[3]*d+o[7]*p+o[15],_}const bn=100;class kn{constructor(e,o,d=new Sr(e.width+200,e.height+200,25),p=new Sr(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=o,this.grid=d,this.ignoredGrid=p,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+bn,this.screenBottomBoundary=e.height+bn,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,o,d,p,y,P,A,D,V,$,Z){const te=e.anchorPointX+D[0],ue=e.anchorPointY+D[1],he=this.projectAndGetPerspectiveRatio(p,te,ue,y,$),pe=d*he.perspectiveRatio;let ge;if(P||A)ge=this._projectCollisionBox(e,pe,p,y,P,A,D,he,$,Z);else{const Oe=he.point.x+(Z?Z.x*pe:0),qe=he.point.y+(Z?Z.y*pe:0);ge={allPointsOccluded:!1,box:[Oe+e.x1*pe,qe+e.y1*pe,Oe+e.x2*pe,qe+e.y2*pe]}}const[ve,Se,me,Ae]=ge.box;return this.mapProjection.useSpecialProjectionForSymbols&&(P?ge.allPointsOccluded:this.mapProjection.isOccluded(te,ue,y))||he.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ve,Se,me,Ae)||o!=="always"&&this.grid.hitTest(ve,Se,me,Ae,o,V)?{box:[ve,Se,me,Ae],placeable:!1,offscreen:!1}:{box:[ve,Se,me,Ae],placeable:!0,offscreen:this.isOffscreen(ve,Se,me,Ae)}}placeCollisionCircles(e,o,d,p,y,P,A,D,V,$,Z,te,ue,he,pe,ge){const ve=[],Se=new c.P(o.anchorX,o.anchorY),me=this.getPerspectiveRatio(P,Se.x,Se.y,A,ge),Ae=(Z?y/me:y*me)/c.ap,Oe={getElevation:ge,labelPlaneMatrix:D,lineVertexArray:d,pitchWithMap:Z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Se,unwrappedTileID:A,width:this.transform.width,height:this.transform.height,translation:pe},qe=ae(Ae,p,o.lineOffsetX*Ae,o.lineOffsetY*Ae,!1,o,!1,Oe);let ot=!1,yt=!1,St=!0;if(qe){const Lt=.5*ue*me+he,Et=new c.P(-100,-100),kt=new c.P(this.screenRightBoundary,this.screenBottomBoundary),qt=new pn,gn=qe.first,It=qe.last;let Ct=[];for(let En=gn.path.length-1;En>=1;En--)Ct.push(gn.path[En]);for(let En=1;En<It.path.length;En++)Ct.push(It.path[En]);const mn=2.5*Lt;if(V){const En=this.projectPathToScreenSpace(Ct,Oe,V);Ct=En.some((Pn=>Pn.signedDistanceFromCamera<=0))?[]:En.map((Pn=>Pn.point))}let li=[];if(Ct.length>0){const En=Ct[0].clone(),Pn=Ct[0].clone();for(let ci=1;ci<Ct.length;ci++)En.x=Math.min(En.x,Ct[ci].x),En.y=Math.min(En.y,Ct[ci].y),Pn.x=Math.max(Pn.x,Ct[ci].x),Pn.y=Math.max(Pn.y,Ct[ci].y);li=En.x>=Et.x&&Pn.x<=kt.x&&En.y>=Et.y&&Pn.y<=kt.y?[Ct]:Pn.x<Et.x||En.x>kt.x||Pn.y<Et.y||En.y>kt.y?[]:c.al([Ct],Et.x,Et.y,kt.x,kt.y)}for(const En of li){qt.reset(En,.25*Lt);let Pn=0;Pn=qt.length<=.5*Lt?1:Math.ceil(qt.paddedLength/mn)+1;for(let ci=0;ci<Pn;ci++){const wr=ci/Math.max(Pn-1,1),bs=qt.lerp(wr),hi=bs.x+bn,or=bs.y+bn;ve.push(hi,or,Lt,0);const bi=hi-Lt,Zi=or-Lt,Pr=hi+Lt,ya=or+Lt;if(St=St&&this.isOffscreen(bi,Zi,Pr,ya),yt=yt||this.isInsideGrid(bi,Zi,Pr,ya),e!=="always"&&this.grid.hitTestCircle(hi,or,Lt,e,te)&&(ot=!0,!$))return{circles:[],offscreen:!1,collisionDetected:ot}}}}return{circles:!$&&ot||!yt||me<this.perspectiveRatioCutoff?[]:ve,offscreen:St,collisionDetected:ot}}projectPathToScreenSpace(e,o,d){return e.map((p=>_e(p.x,p.y,d,o.getElevation)))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let d=1/0,p=1/0,y=-1/0,P=-1/0;for(const $ of e){const Z=new c.P($.x+bn,$.y+bn);d=Math.min(d,Z.x),p=Math.min(p,Z.y),y=Math.max(y,Z.x),P=Math.max(P,Z.y),o.push(Z)}const A=this.grid.query(d,p,y,P).concat(this.ignoredGrid.query(d,p,y,P)),D={},V={};for(const $ of A){const Z=$.key;if(D[Z.bucketInstanceId]===void 0&&(D[Z.bucketInstanceId]={}),D[Z.bucketInstanceId][Z.featureIndex])continue;const te=[new c.P($.x1,$.y1),new c.P($.x2,$.y1),new c.P($.x2,$.y2),new c.P($.x1,$.y2)];c.am(o,te)&&(D[Z.bucketInstanceId][Z.featureIndex]=!0,V[Z.bucketInstanceId]===void 0&&(V[Z.bucketInstanceId]=[]),V[Z.bucketInstanceId].push(Z.featureIndex))}return V}insertCollisionBox(e,o,d,p,y,P){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:P,overlapMode:o},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,o,d,p,y,P){const A=d?this.ignoredGrid:this.grid,D={bucketInstanceId:p,featureIndex:y,collisionGroupID:P,overlapMode:o};for(let V=0;V<e.length;V+=4)A.insertCircle(D,e[V],e[V+1],e[V+2])}projectAndGetPerspectiveRatio(e,o,d,p,y){let P;y?(P=[o,d,y(o,d),1],c.af(P,P,e)):(P=[o,d,0,1],Fn(P,P,e));const A=P[3];return{point:new c.P((P[0]/A+1)/2*this.transform.width+bn,(-P[1]/A+1)/2*this.transform.height+bn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/A*.5,isOccluded:!1,signedDistanceFromCamera:A}}getPerspectiveRatio(e,o,d,p,y){const P=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(o,d,p,y):_e(o,d,e,y);return .5+this.transform.cameraToCenterDistance/P.signedDistanceFromCamera*.5}isOffscreen(e,o,d,p){return d<bn||e>=this.screenRightBoundary||p<bn||o>this.screenBottomBoundary}isInsideGrid(e,o,d,p){return d>=0&&e<this.gridRightBoundary&&p>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const e=c.an([]);return c.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,o,d,p,y,P,A,D,V,$){let Z=new c.P(1,0),te=new c.P(0,1);const ue=new c.P(e.anchorPointX+A[0],e.anchorPointY+A[1]);if(P&&!y){const St=this.projectAndGetPerspectiveRatio(d,ue.x+1,ue.y,p,V).point.sub(D.point).unit(),Lt=Math.atan(St.y/St.x)+(St.x<0?Math.PI:0),Et=Math.sin(Lt),kt=Math.cos(Lt);Z=new c.P(kt,Et),te=new c.P(-Et,kt)}else if(!P&&y){const St=-this.transform.angle,Lt=Math.sin(St),Et=Math.cos(St);Z=new c.P(Et,Lt),te=new c.P(-Lt,Et)}let he=D.point,pe=o;if(y){he=ue;const St=this.transform.zoom-Math.floor(this.transform.zoom);pe=Math.pow(2,-St),pe*=this.mapProjection.getPitchedTextCorrection(this.transform,ue,p),$||(pe*=c.ac(.5+D.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}$&&(he=he.add(Z.mult($.x*pe)).add(te.mult($.y*pe)));const ge=e.x1*pe,ve=e.x2*pe,Se=(ge+ve)/2,me=e.y1*pe,Ae=e.y2*pe,Oe=(me+Ae)/2,qe=[{offsetX:ge,offsetY:me},{offsetX:Se,offsetY:me},{offsetX:ve,offsetY:me},{offsetX:ve,offsetY:Oe},{offsetX:ve,offsetY:Ae},{offsetX:Se,offsetY:Ae},{offsetX:ge,offsetY:Ae},{offsetX:ge,offsetY:Oe}];let ot=[];for(const{offsetX:St,offsetY:Lt}of qe)ot.push(new c.P(he.x+Z.x*St+te.x*Lt,he.y+Z.y*St+te.y*Lt));let yt=!1;if(y){const St=ot.map((Lt=>this.projectAndGetPerspectiveRatio(d,Lt.x,Lt.y,p,V)));yt=St.some((Lt=>!Lt.isOccluded)),ot=St.map((Lt=>Lt.point))}else yt=!0;return{box:c.ao(ot),allPointsOccluded:!yt}}}function Sn(_,e,o){return e*(c.X/(_.tileSize*Math.pow(2,o-_.tileID.overscaledZ)))}class pi{constructor(e,o,d,p){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?o:-o))):p&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class ti{constructor(e,o,d,p,y){this.text=new pi(e?e.text:null,o,d,y),this.icon=new pi(e?e.icon:null,o,p,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xn{constructor(e,o,d){this.text=e,this.icon=o,this.skipFade=d}}class Hn{constructor(){this.invProjMatrix=c.H(),this.viewportMatrix=c.H(),this.circles=[]}}class ri{constructor(e,o,d,p,y){this.bucketInstanceId=e,this.featureIndex=o,this.sourceLayerIndex=d,this.bucketIndex=p,this.tileID=y}}class Ei{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const o=++this.maxGroupID;this.collisionGroups[e]={ID:o,predicate:d=>d.collisionGroupID===o}}return this.collisionGroups[e]}}function Bn(_,e,o,d,p){const{horizontalAlign:y,verticalAlign:P}=c.au(_);return new c.P(-(y-.5)*e+d[0]*p,-(P-.5)*o+d[1]*p)}class Er{constructor(e,o,d,p,y,P){this.transform=e.clone(),this.terrain=d,this.collisionIndex=new kn(this.transform,o),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Ei(y),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=P,P&&(P.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const o=this.terrain;return o?(d,p)=>o.getElevation(e,d,p):null}getBucketParts(e,o,d,p){const y=d.getBucket(o),P=d.latestFeatureIndex;if(!y||!P||o.id!==y.layerIds[0])return;const A=d.collisionBoxArray,D=y.layers[0].layout,V=y.layers[0].paint,$=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),Z=d.tileSize/c.X,te=d.tileID.toUnwrapped(),ue=this.transform.calculatePosMatrix(te),he=D.get("text-pitch-alignment")==="map",pe=D.get("text-rotation-alignment")==="map",ge=Sn(d,1,this.transform.zoom),ve=this.collisionIndex.mapProjection.translatePosition(this.transform,d,V.get("text-translate"),V.get("text-translate-anchor")),Se=this.collisionIndex.mapProjection.translatePosition(this.transform,d,V.get("icon-translate"),V.get("icon-translate-anchor")),me=Ai(ue,he,pe,this.transform,ge);let Ae=null;if(he){const qe=gr(ue,he,pe,this.transform,ge);Ae=c.L([],this.transform.labelPlaneMatrix,qe)}this.retainedQueryData[y.bucketInstanceId]=new ri(y.bucketInstanceId,P,y.sourceLayerIndex,y.index,d.tileID);const Oe={bucket:y,layout:D,translationText:ve,translationIcon:Se,posMatrix:ue,unwrappedTileID:te,textLabelPlaneMatrix:me,labelToScreenMatrix:Ae,scale:$,textPixelRatio:Z,holdingForFade:d.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:c.ag(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(p)for(const qe of y.sortKeyRanges){const{sortKey:ot,symbolInstanceStart:yt,symbolInstanceEnd:St}=qe;e.push({sortKey:ot,symbolInstanceStart:yt,symbolInstanceEnd:St,parameters:Oe})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:Oe})}attemptAnchorPlacement(e,o,d,p,y,P,A,D,V,$,Z,te,ue,he,pe,ge,ve,Se,me){const Ae=c.aq[e.textAnchor],Oe=[e.textOffset0,e.textOffset1],qe=Bn(Ae,d,p,Oe,y),ot=this.collisionIndex.placeCollisionBox(o,te,D,V,$,A,P,ge,Z.predicate,me,qe);if((!Se||this.collisionIndex.placeCollisionBox(Se,te,D,V,$,A,P,ve,Z.predicate,me,qe).placeable)&&ot.placeable){let yt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID].text&&(yt=this.prevPlacement.variableOffsets[ue.crossTileID].anchor),ue.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ue.crossTileID]={textOffset:Oe,width:d,height:p,anchor:Ae,textBoxScale:y,prevAnchor:yt},this.markUsedJustification(he,Ae,ue,pe),he.allowVerticalPlacement&&(this.markUsedOrientation(he,pe,ue),this.placedOrientations[ue.crossTileID]=pe),{shift:qe,placedGlyphBoxes:ot}}}placeLayerBucketPart(e,o,d){const{bucket:p,layout:y,translationText:P,translationIcon:A,posMatrix:D,unwrappedTileID:V,textLabelPlaneMatrix:$,labelToScreenMatrix:Z,textPixelRatio:te,holdingForFade:ue,collisionBoxArray:he,partiallyEvaluatedTextSize:pe,collisionGroup:ge}=e.parameters,ve=y.get("text-optional"),Se=y.get("icon-optional"),me=c.ar(y,"text-overlap","text-allow-overlap"),Ae=me==="always",Oe=c.ar(y,"icon-overlap","icon-allow-overlap"),qe=Oe==="always",ot=y.get("text-rotation-alignment")==="map",yt=y.get("text-pitch-alignment")==="map",St=y.get("icon-text-fit")!=="none",Lt=y.get("symbol-z-order")==="viewport-y",Et=Ae&&(qe||!p.hasIconData()||Se),kt=qe&&(Ae||!p.hasTextData()||ve);!p.collisionArrays&&he&&p.deserializeCollisionBoxes(he);const qt=this._getTerrainElevationFunc(this.retainedQueryData[p.bucketInstanceId].tileID),gn=(It,Ct,mn)=>{var li,En;if(o[It.crossTileID])return;if(ue)return void(this.placements[It.crossTileID]=new xn(!1,!1,!1));let Pn=!1,ci=!1,wr=!0,bs=null,hi={box:null,placeable:!1,offscreen:null},or={placeable:!1},bi=null,Zi=null,Pr=null,ya=0,is=0,_a=0;Ct.textFeatureIndex?ya=Ct.textFeatureIndex:It.useRuntimeCollisionCircles&&(ya=It.featureIndex),Ct.verticalTextFeatureIndex&&(is=Ct.verticalTextFeatureIndex);const Bo=Ct.textBox;if(Bo){const Wr=Wi=>{let Pi=c.ah.horizontal;if(p.allowVerticalPlacement&&!Wi&&this.prevPlacement){const Mr=this.prevPlacement.placedOrientations[It.crossTileID];Mr&&(this.placedOrientations[It.crossTileID]=Mr,Pi=Mr,this.markUsedOrientation(p,Pi,It))}return Pi},Ss=(Wi,Pi)=>{if(p.allowVerticalPlacement&&It.numVerticalGlyphVertices>0&&Ct.verticalTextBox){for(const Mr of p.writingModes)if(Mr===c.ah.vertical?(hi=Pi(),or=hi):hi=Wi(),hi&&hi.placeable)break}else hi=Wi()},va=It.textAnchorOffsetStartIndex,Zs=It.textAnchorOffsetEndIndex;if(Zs===va){const Wi=(Pi,Mr)=>{const Ln=this.collisionIndex.placeCollisionBox(Pi,me,te,D,V,yt,ot,P,ge.predicate,qt);return Ln&&Ln.placeable&&(this.markUsedOrientation(p,Mr,It),this.placedOrientations[It.crossTileID]=Mr),Ln};Ss((()=>Wi(Bo,c.ah.horizontal)),(()=>{const Pi=Ct.verticalTextBox;return p.allowVerticalPlacement&&It.numVerticalGlyphVertices>0&&Pi?Wi(Pi,c.ah.vertical):{box:null,offscreen:null}})),Wr(hi&&hi.placeable)}else{let Wi=c.aq[(En=(li=this.prevPlacement)===null||li===void 0?void 0:li.variableOffsets[It.crossTileID])===null||En===void 0?void 0:En.anchor];const Pi=(Ln,Es,jo)=>{const xa=Ln.x2-Ln.x1,wc=Ln.y2-Ln.y1,bc=It.textBoxScale,zi=St&&Oe==="never"?Es:null;let wa=null,Gu=me==="never"?1:2,Vl="never";Wi&&Gu++;for(let Vo=0;Vo<Gu;Vo++){for(let Ul=va;Ul<Zs;Ul++){const Ua=p.textAnchorOffsets.get(Ul);if(Wi&&Ua.textAnchor!==Wi)continue;const fi=this.attemptAnchorPlacement(Ua,Ln,xa,wc,bc,ot,yt,te,D,V,ge,Vl,It,p,jo,P,A,zi,qt);if(fi&&(wa=fi.placedGlyphBoxes,wa&&wa.placeable))return Pn=!0,bs=fi.shift,wa}Wi?Wi=null:Vl=me}return d&&!wa&&(wa={box:this.collisionIndex.placeCollisionBox(Bo,"always",te,D,V,yt,ot,P,ge.predicate,qt,new c.P(0,0)).box,offscreen:!1,placeable:!1}),wa};Ss((()=>Pi(Bo,Ct.iconBox,c.ah.horizontal)),(()=>{const Ln=Ct.verticalTextBox;return p.allowVerticalPlacement&&(!hi||!hi.placeable)&&It.numVerticalGlyphVertices>0&&Ln?Pi(Ln,Ct.verticalIconBox,c.ah.vertical):{box:null,occluded:!0,offscreen:null}})),hi&&(Pn=hi.placeable,wr=hi.offscreen);const Mr=Wr(hi&&hi.placeable);if(!Pn&&this.prevPlacement){const Ln=this.prevPlacement.variableOffsets[It.crossTileID];Ln&&(this.variableOffsets[It.crossTileID]=Ln,this.markUsedJustification(p,Ln.anchor,It,Mr))}}}if(bi=hi,Pn=bi&&bi.placeable,wr=bi&&bi.offscreen,It.useRuntimeCollisionCircles){const Wr=p.text.placedSymbolArray.get(It.centerJustifiedTextSymbolIndex),Ss=c.ai(p.textSizeData,pe,Wr),va=y.get("text-padding");Zi=this.collisionIndex.placeCollisionCircles(me,Wr,p.lineVertexArray,p.glyphOffsetArray,Ss,D,V,$,Z,d,yt,ge.predicate,It.collisionCircleDiameter,va,P,qt),Zi.circles.length&&Zi.collisionDetected&&!d&&c.w("Collisions detected, but collision boxes are not shown"),Pn=Ae||Zi.circles.length>0&&!Zi.collisionDetected,wr=wr&&Zi.offscreen}if(Ct.iconFeatureIndex&&(_a=Ct.iconFeatureIndex),Ct.iconBox){const Wr=Ss=>this.collisionIndex.placeCollisionBox(Ss,Oe,te,D,V,yt,ot,A,ge.predicate,qt,St&&bs?bs:void 0);or&&or.placeable&&Ct.verticalIconBox?(Pr=Wr(Ct.verticalIconBox),ci=Pr.placeable):(Pr=Wr(Ct.iconBox),ci=Pr.placeable),wr=wr&&Pr.offscreen}const ks=ve||It.numHorizontalGlyphVertices===0&&It.numVerticalGlyphVertices===0,$s=Se||It.numIconVertices===0;ks||$s?$s?ks||(ci=ci&&Pn):Pn=ci&&Pn:ci=Pn=ci&&Pn;const Va=ci&&Pr.placeable;if(Pn&&bi.placeable&&this.collisionIndex.insertCollisionBox(bi.box,me,y.get("text-ignore-placement"),p.bucketInstanceId,or&&or.placeable&&is?is:ya,ge.ID),Va&&this.collisionIndex.insertCollisionBox(Pr.box,Oe,y.get("icon-ignore-placement"),p.bucketInstanceId,_a,ge.ID),Zi&&Pn&&this.collisionIndex.insertCollisionCircles(Zi.circles,me,y.get("text-ignore-placement"),p.bucketInstanceId,ya,ge.ID),d&&this.storeCollisionData(p.bucketInstanceId,mn,Ct,bi,Pr,Zi),It.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[It.crossTileID]=new xn(Pn||Et,ci||kt,wr||p.justReloaded),o[It.crossTileID]=!0};if(Lt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const It=p.getSortedSymbolIndexes(this.transform.angle);for(let Ct=It.length-1;Ct>=0;--Ct){const mn=It[Ct];gn(p.symbolInstances.get(mn),p.collisionArrays[mn],mn)}}else for(let It=e.symbolInstanceStart;It<e.symbolInstanceEnd;It++)gn(p.symbolInstances.get(It),p.collisionArrays[It],It);if(d&&p.bucketInstanceId in this.collisionCircleArrays){const It=this.collisionCircleArrays[p.bucketInstanceId];c.as(It.invProjMatrix,D),It.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}storeCollisionData(e,o,d,p,y,P){if(d.textBox||d.iconBox){let A,D;this.collisionBoxArrays.has(e)?A=this.collisionBoxArrays.get(e):(A=new Map,this.collisionBoxArrays.set(e,A)),A.has(o)?D=A.get(o):(D={text:null,icon:null},A.set(o,D)),d.textBox&&(D.text=p.box),d.iconBox&&(D.icon=y.box)}if(P){let A=this.collisionCircleArrays[e];A===void 0&&(A=this.collisionCircleArrays[e]=new Hn);for(let D=0;D<P.circles.length;D+=4)A.circles.push(P.circles[D+0]),A.circles.push(P.circles[D+1]),A.circles.push(P.circles[D+2]),A.circles.push(P.collisionDetected?1:0)}}markUsedJustification(e,o,d,p){let y;y=p===c.ah.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[c.at(o)];const P=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const A of P)A>=0&&(e.text.placedSymbolArray.get(A).crossTileID=y>=0&&A!==y?0:d.crossTileID)}markUsedOrientation(e,o,d){const p=o===c.ah.horizontal||o===c.ah.horizontalOnly?o:0,y=o===c.ah.vertical?o:0,P=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const A of P)e.text.placedSymbolArray.get(A).placedOrientation=p;d.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let d=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const p=o?o.symbolFadeChange(e):1,y=o?o.opacities:{},P=o?o.variableOffsets:{},A=o?o.placedOrientations:{};for(const D in this.placements){const V=this.placements[D],$=y[D];$?(this.opacities[D]=new ti($,p,V.text,V.icon),d=d||V.text!==$.text.placed||V.icon!==$.icon.placed):(this.opacities[D]=new ti(null,p,V.text,V.icon,V.skipFade),d=d||V.text||V.icon)}for(const D in y){const V=y[D];if(!this.opacities[D]){const $=new ti(V,p,!1,!1);$.isHidden()||(this.opacities[D]=$,d=d||V.text.placed||V.icon.placed)}}for(const D in P)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=P[D]);for(const D in A)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=A[D]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:e)}updateLayerOpacities(e,o){const d={};for(const p of o){const y=p.getBucket(e);y&&p.latestFeatureIndex&&e.id===y.layerIds[0]&&this.updateBucketOpacities(y,p.tileID,d,p.collisionBoxArray)}}updateBucketOpacities(e,o,d,p){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const y=e.layers[0],P=y.layout,A=new ti(null,0,!1,!1,!0),D=P.get("text-allow-overlap"),V=P.get("icon-allow-overlap"),$=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Z=P.get("text-rotation-alignment")==="map",te=P.get("text-pitch-alignment")==="map",ue=P.get("icon-text-fit")!=="none",he=new ti(null,0,D&&(V||!e.hasIconData()||P.get("icon-optional")),V&&(D||!e.hasTextData()||P.get("text-optional")),!0);!e.collisionArrays&&p&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(p);const pe=(ve,Se,me)=>{for(let Ae=0;Ae<Se/4;Ae++)ve.opacityVertexArray.emplaceBack(me);ve.hasVisibleVertices=ve.hasVisibleVertices||me!==sr},ge=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ve=0;ve<e.symbolInstances.length;ve++){const Se=e.symbolInstances.get(ve),{numHorizontalGlyphVertices:me,numVerticalGlyphVertices:Ae,crossTileID:Oe}=Se;let qe=this.opacities[Oe];d[Oe]?qe=A:qe||(qe=he,this.opacities[Oe]=qe),d[Oe]=!0;const ot=Se.numIconVertices>0,yt=this.placedOrientations[Se.crossTileID],St=yt===c.ah.vertical,Lt=yt===c.ah.horizontal||yt===c.ah.horizontalOnly;if(me>0||Ae>0){const kt=Bi(qe.text);pe(e.text,me,St?sr:kt),pe(e.text,Ae,Lt?sr:kt);const qt=qe.text.isHidden();[Se.rightJustifiedTextSymbolIndex,Se.centerJustifiedTextSymbolIndex,Se.leftJustifiedTextSymbolIndex].forEach((Ct=>{Ct>=0&&(e.text.placedSymbolArray.get(Ct).hidden=qt||St?1:0)})),Se.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Se.verticalPlacedTextSymbolIndex).hidden=qt||Lt?1:0);const gn=this.variableOffsets[Se.crossTileID];gn&&this.markUsedJustification(e,gn.anchor,Se,yt);const It=this.placedOrientations[Se.crossTileID];It&&(this.markUsedJustification(e,"left",Se,It),this.markUsedOrientation(e,It,Se))}if(ot){const kt=Bi(qe.icon),qt=!(ue&&Se.verticalPlacedIconSymbolIndex&&St);Se.placedIconSymbolIndex>=0&&(pe(e.icon,Se.numIconVertices,qt?kt:sr),e.icon.placedSymbolArray.get(Se.placedIconSymbolIndex).hidden=qe.icon.isHidden()),Se.verticalPlacedIconSymbolIndex>=0&&(pe(e.icon,Se.numVerticalIconVertices,qt?sr:kt),e.icon.placedSymbolArray.get(Se.verticalPlacedIconSymbolIndex).hidden=qe.icon.isHidden())}const Et=ge&&ge.has(ve)?ge.get(ve):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const kt=e.collisionArrays[ve];if(kt){let qt=new c.P(0,0);if(kt.textBox||kt.verticalTextBox){let gn=!0;if($){const It=this.variableOffsets[Oe];It?(qt=Bn(It.anchor,It.width,It.height,It.textOffset,It.textBoxScale),Z&&qt._rotate(te?this.transform.angle:-this.transform.angle)):gn=!1}if(kt.textBox||kt.verticalTextBox){let It;kt.textBox&&(It=St),kt.verticalTextBox&&(It=Lt),Po(e.textCollisionBox.collisionVertexArray,qe.text.placed,!gn||It,Et.text,qt.x,qt.y)}}if(kt.iconBox||kt.verticalIconBox){const gn=!!(!Lt&&kt.verticalIconBox);let It;kt.iconBox&&(It=gn),kt.verticalIconBox&&(It=!gn),Po(e.iconCollisionBox.collisionVertexArray,qe.icon.placed,It,Et.icon,ue?qt.x:0,ue?qt.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const ve=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=ve.invProjMatrix,e.placementViewportMatrix=ve.viewportMatrix,e.collisionCircleArray=ve.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,o){const d=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*d>e}setStale(){this.stale=!0}}function Po(_,e,o,d,p,y){d&&d.length!==0||(d=[0,0,0,0]);const P=d[0]-bn,A=d[1]-bn,D=d[2]-bn,V=d[3]-bn;_.emplaceBack(e?1:0,o?1:0,p||0,y||0,P,A),_.emplaceBack(e?1:0,o?1:0,p||0,y||0,D,A),_.emplaceBack(e?1:0,o?1:0,p||0,y||0,D,V),_.emplaceBack(e?1:0,o?1:0,p||0,y||0,P,V)}const fn=Math.pow(2,25),Ha=Math.pow(2,24),Xa=Math.pow(2,17),yr=Math.pow(2,16),rr=Math.pow(2,9),hc=Math.pow(2,8),Ii=Math.pow(2,1);function Bi(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const e=_.placed?1:0,o=Math.floor(127*_.opacity);return o*fn+e*Ha+o*Xa+e*yr+o*rr+e*hc+o*Ii+e}const sr=0;function Qr(){return{isOccluded:(_,e,o)=>!1,getPitchedTextCorrection:(_,e,o)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(_,e,o,d){throw new Error("Not implemented.")},translatePosition:(_,e,o,d)=>(function(p,y,P,A,D=!1){if(!P[0]&&!P[1])return[0,0];const V=D?A==="map"?p.angle:0:A==="viewport"?-p.angle:0;if(V){const $=Math.sin(V),Z=Math.cos(V);P=[P[0]*Z-P[1]*$,P[0]*$+P[1]*Z]}return[D?P[0]:Sn(y,P[0],p.zoom),D?P[1]:Sn(y,P[1],p.zoom)]})(_,e,o,d),getCircleRadiusCorrection:_=>1}}class Wn{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,o,d,p,y){const P=this._bucketParts;for(;this._currentTileIndex<e.length;)if(o.getBucketParts(P,p,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort(((A,D)=>A.sortKey-D.sortKey)));this._currentPartIndex<P.length;)if(o.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,y())return!0;return!1}}class Xo{constructor(e,o,d,p,y,P,A,D){this.placement=new Er(e,Qr(),o,P,A,D),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(e,o,d){const p=F.now(),y=()=>!this._forceFullPlacement&&F.now()-p>2;for(;this._currentPlacementIndex>=0;){const P=o[e[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=A)&&(!P.maxzoom||P.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Wn(P)),this._inProgressLayer.continuePlacement(d[P.source],this.placement,this._showCollisionBoxes,P,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ms=512/c.X/2;class ji{constructor(e,o,d){this.tileID=e,this.bucketInstanceId=d,this._symbolsByKey={};const p=new Map;for(let y=0;y<o.length;y++){const P=o.get(y),A=P.key,D=p.get(A);D?D.push(P):p.set(A,[P])}for(const[y,P]of p){const A={positions:P.map((D=>({x:Math.floor(D.anchorX*ms),y:Math.floor(D.anchorY*ms)}))),crossTileIDs:P.map((D=>D.crossTileID))};if(A.positions.length>128){const D=new c.av(A.positions.length,16,Uint16Array);for(const{x:V,y:$}of A.positions)D.add(V,$);D.finish(),delete A.positions,A.index=D}this._symbolsByKey[y]=A}}getScaledCoordinates(e,o){const{x:d,y:p,z:y}=this.tileID.canonical,{x:P,y:A,z:D}=o.canonical,V=ms/Math.pow(2,D-y),$=(A*c.X+e.anchorY)*V,Z=p*c.X*ms;return{x:Math.floor((P*c.X+e.anchorX)*V-d*c.X*ms),y:Math.floor($-Z)}}findMatches(e,o,d){const p=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let y=0;y<e.length;y++){const P=e.get(y);if(P.crossTileID)continue;const A=this._symbolsByKey[P.key];if(!A)continue;const D=this.getScaledCoordinates(P,o);if(A.index){const V=A.index.range(D.x-p,D.y-p,D.x+p,D.y+p).sort();for(const $ of V){const Z=A.crossTileIDs[$];if(!d[Z]){d[Z]=!0,P.crossTileID=Z;break}}}else if(A.positions)for(let V=0;V<A.positions.length;V++){const $=A.positions[V],Z=A.crossTileIDs[V];if(Math.abs($.x-D.x)<=p&&Math.abs($.y-D.y)<=p&&!d[Z]){d[Z]=!0,P.crossTileID=Z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class La{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ir{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const o=Math.round((e-this.lng)/360);if(o!==0)for(const d in this.indexes){const p=this.indexes[d],y={};for(const P in p){const A=p[P];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+o),y[A.tileID.key]=A}this.indexes[d]=y}this.lng=e}addBucket(e,o,d){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let y=0;y<o.symbolInstances.length;y++)o.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const p=this.usedCrossTileIDs[e.overscaledZ];for(const y in this.indexes){const P=this.indexes[y];if(Number(y)>e.overscaledZ)for(const A in P){const D=P[A];D.tileID.isChildOf(e)&&D.findMatches(o.symbolInstances,e,p)}else{const A=P[e.scaledTo(Number(y)).key];A&&A.findMatches(o.symbolInstances,e,p)}}for(let y=0;y<o.symbolInstances.length;y++){const P=o.symbolInstances.get(y);P.crossTileID||(P.crossTileID=d.generate(),p[P.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new ji(e,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(e,o){for(const d of o.getCrossTileIDsLists())for(const p of d)delete this.usedCrossTileIDs[e][p]}removeStaleBuckets(e){let o=!1;for(const d in this.indexes){const p=this.indexes[d];for(const y in p)e[p[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,p[y]),delete p[y],o=!0)}return o}}class Ls{constructor(){this.layerIndexes={},this.crossTileIDs=new La,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,o,d){let p=this.layerIndexes[e.id];p===void 0&&(p=this.layerIndexes[e.id]=new Ir);let y=!1;const P={};p.handleWrapJump(d);for(const A of o){const D=A.getBucket(e);D&&e.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(A.tileID,D,this.crossTileIDs)&&(y=!0),P[D.bucketInstanceId]=!0)}return p.removeStaleBuckets(P)&&(y=!0),y}pruneUnusedLayers(e){const o={};e.forEach((d=>{o[d]=!0}));for(const d in this.layerIndexes)o[d]||delete this.layerIndexes[d]}}const Li=(_,e)=>c.t(_,e&&e.filter((o=>o.identifier!=="source.canvas"))),Ra=c.aw();class Wo extends c.E{constructor(e,o={}){super(),this._rtlPluginLoaded=()=>{for(const d in this.sourceCaches){const p=this.sourceCaches[d].getSource().type;p!=="vector"&&p!=="geojson"||this.sourceCaches[d].reload()}},this.map=e,this.dispatcher=new Cn(ei(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((d,p)=>this.getGlyphs(d,p))),this.dispatcher.registerMessageHandler("GI",((d,p)=>this.getImages(d,p))),this.imageManager=new Bt,this.imageManager.setEventedParent(this),this.glyphManager=new rn(e._requestManager,o.localIdeographFontFamily),this.lineAtlas=new on(256,512),this.crossTileSymbolIndex=new Ls,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.ay()),tn().on(Qe,this._rtlPluginLoaded),this.on("data",(d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const p=this.sourceCaches[d.sourceId];if(!p)return;const y=p.getSource();if(y&&y.vectorLayerIds)for(const P in this._layers){const A=this._layers[P];A.source===y.id&&this._validateLayer(A)}}))}loadURL(e,o={},d){this.fire(new c.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const p=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;c.h(p,this._loadStyleRequest).then((P=>{this._loadStyleRequest=null,this._load(P.data,o,d)})).catch((P=>{this._loadStyleRequest=null,P&&!y.signal.aborted&&this.fire(new c.j(P))}))}loadJSON(e,o={},d){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,F.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(e,o,d)})).catch((()=>{}))}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(Ra,{validate:!1})}_load(e,o,d){var p;const y=o.transformStyle?o.transformStyle(d,e):e;if(!o.validate||!Li(this,c.u(y))){this._loaded=!0,this.stylesheet=y;for(const P in y.sources)this.addSource(P,y.sources[P],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new nt(this.stylesheet.light),this.sky=new rt(this.stylesheet.sky),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const e=c.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((o=>o.id)),this._layers={},this._serializedLayers=null;for(const o of e){const d=c.aA(o);d.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=d}}_loadSprite(e,o=!1,d=void 0){let p;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(y,P,A,D){return c._(this,void 0,void 0,(function*(){const V=ft(y),$=A>1?"@2x":"",Z={},te={};for(const{id:ue,url:he}of V){const pe=P.transformRequest($t(he,$,".json"),"SpriteJSON");Z[ue]=c.h(pe,D);const ge=P.transformRequest($t(he,$,".png"),"SpriteImage");te[ue]=Ge.getImage(ge,D)}return yield Promise.all([...Object.values(Z),...Object.values(te)]),(function(ue,he){return c._(this,void 0,void 0,(function*(){const pe={};for(const ge in ue){pe[ge]={};const ve=F.getImageCanvasContext((yield he[ge]).data),Se=(yield ue[ge]).data;for(const me in Se){const{width:Ae,height:Oe,x:qe,y:ot,sdf:yt,pixelRatio:St,stretchX:Lt,stretchY:Et,content:kt,textFitWidth:qt,textFitHeight:gn}=Se[me];pe[ge][me]={data:null,pixelRatio:St,sdf:yt,stretchX:Lt,stretchY:Et,content:kt,textFitWidth:qt,textFitHeight:gn,spriteData:{width:Ae,height:Oe,x:qe,y:ot,context:ve}}}}return pe}))})(Z,te)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((y=>{if(this._spriteRequest=null,y)for(const P in y){this._spritesImagesIds[P]=[];const A=this._spritesImagesIds[P]?this._spritesImagesIds[P].filter((D=>!(D in y))):[];for(const D of A)this.imageManager.removeImage(D),this._changedImages[D]=!0;for(const D in y[P]){const V=P==="default"?D:`${P}:${D}`;this._spritesImagesIds[P].push(V),V in this.imageManager.images?this.imageManager.updateImage(V,y[P][D],!1):this.imageManager.addImage(V,y[P][D]),o&&(this._changedImages[V]=!0)}}})).catch((y=>{this._spriteRequest=null,p=y,this.fire(new c.j(p))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),d&&d(p)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(e){const o=this.sourceCaches[e.source];if(!o)return;const d=e.sourceLayer;if(!d)return;const p=o.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(d)===-1)&&this.fire(new c.j(new Error(`Source layer "${d}" does not exist on source "${p.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,o=!1){const d=this._serializedAllLayers();if(!e||e.length===0)return Object.values(o?c.aB(d):d);const p=[];for(const y of e)if(d[y]){const P=o?c.aB(d[y]):d[y];p.push(P)}return p}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const o=Object.keys(this._layers);for(const d of o){const p=this._layers[d];p.type!=="custom"&&(e[d]=p.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const o=this._changed;if(o){const p=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(p.length||y.length)&&this._updateWorkerLayers(p,y);for(const P in this._updatedSources){const A=this._updatedSources[P];if(A==="reload")this._reloadSource(P);else{if(A!=="clear")throw new Error(`Invalid action ${A}`);this._clearSource(P)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const d={};for(const p in this.sourceCaches){const y=this.sourceCaches[p];d[p]=y.used,y.used=!1}for(const p of this._order){const y=this._layers[p];y.recalculate(e,this._availableImages),!y.isHidden(e.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const p in d){const y=this.sourceCaches[p];!!d[p]!=!!y.used&&y.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,o&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,o={}){var d;this._checkLoaded();const p=this.serialize();if(e=o.transformStyle?o.transformStyle(p,e):e,((d=o.validate)===null||d===void 0||d)&&Li(this,c.u(e)))return!1;(e=c.aB(e)).layers=c.az(e.layers);const y=c.aC(p,e),P=this._getOperationsToPerform(y);if(P.unimplemented.length>0)throw new Error(`Unimplemented: ${P.unimplemented.join(", ")}.`);if(P.operations.length===0)return!1;for(const A of P.operations)A();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const o=[],d=[];for(const p of e)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":o.push((()=>this.addLayer.apply(this,p.args)));break;case"removeLayer":o.push((()=>this.removeLayer.apply(this,p.args)));break;case"setPaintProperty":o.push((()=>this.setPaintProperty.apply(this,p.args)));break;case"setLayoutProperty":o.push((()=>this.setLayoutProperty.apply(this,p.args)));break;case"setFilter":o.push((()=>this.setFilter.apply(this,p.args)));break;case"addSource":o.push((()=>this.addSource.apply(this,p.args)));break;case"removeSource":o.push((()=>this.removeSource.apply(this,p.args)));break;case"setLayerZoomRange":o.push((()=>this.setLayerZoomRange.apply(this,p.args)));break;case"setLight":o.push((()=>this.setLight.apply(this,p.args)));break;case"setGeoJSONSourceData":o.push((()=>this.setGeoJSONSourceData.apply(this,p.args)));break;case"setGlyphs":o.push((()=>this.setGlyphs.apply(this,p.args)));break;case"setSprite":o.push((()=>this.setSprite.apply(this,p.args)));break;case"setSky":o.push((()=>this.setSky.apply(this,p.args)));break;case"setTerrain":o.push((()=>this.map.setTerrain.apply(this,p.args)));break;case"setTransition":o.push((()=>{}));break;default:d.push(p.command)}return{operations:o,unimplemented:d}}addImage(e,o){if(this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,o),this._afterImageUpdated(e)}updateImage(e,o){this.imageManager.updateImage(e,o)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,o,d={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(c.u.source,`sources.${e}`,o,null,d))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const p=this.sourceCaches[e]=new pt(e,o,this.dispatcher);p.style=this,p.setEventedParent(this,(()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:e}))),p.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===e)return this.fire(new c.j(new Error(`Source "${e}" cannot be removed while layer "${d}" is using it.`)));const o=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],o.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,o){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const d=this.sourceCaches[e].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(o),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,o,d={}){this._checkLoaded();const p=e.id;if(this.getLayer(p))return void this.fire(new c.j(new Error(`Layer "${p}" already exists on this map.`)));let y;if(e.type==="custom"){if(Li(this,c.aD(e)))return;y=c.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(p,e.source),e=c.aB(e),e=c.e(e,{source:p})),this._validate(c.u.layer,`layers.${p}`,e,{arrayIndex:-1},d))return;y=c.aA(e),this._validateLayer(y),y.setEventedParent(this,{layer:{id:p}})}const P=o?this._order.indexOf(o):this._order.length;if(o&&P===-1)this.fire(new c.j(new Error(`Cannot add layer "${p}" before non-existing layer "${o}".`)));else{if(this._order.splice(P,0,p),this._layerOrderChanged=!0,this._layers[p]=y,this._removedLayers[p]&&y.source&&y.type!=="custom"){const A=this._removedLayers[p];delete this._removedLayers[p],A.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(e,o){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===o)return;const d=this._order.indexOf(e);this._order.splice(d,1);const p=o?this._order.indexOf(o):this._order.length;o&&p===-1?this.fire(new c.j(new Error(`Cannot move layer "${e}" before non-existing layer "${o}".`))):(this._order.splice(p,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const o=this._layers[e];if(!o)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${e}".`)));o.setEventedParent(null);const d=this._order.indexOf(e);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=o,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],o.onRemove&&o.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,o,d){this._checkLoaded();const p=this.getLayer(e);p?p.minzoom===o&&p.maxzoom===d||(o!=null&&(p.minzoom=o),d!=null&&(p.maxzoom=d),this._updateLayer(p)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,o,d={}){this._checkLoaded();const p=this.getLayer(e);if(p){if(!c.aE(p.filter,o))return o==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(c.u.filter,`layers.${p.id}.filter`,o,null,d)||(p.filter=c.aB(o),this._updateLayer(p)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.aB(this.getLayer(e).filter)}setLayoutProperty(e,o,d,p={}){this._checkLoaded();const y=this.getLayer(e);y?c.aE(y.getLayoutProperty(o),d)||(y.setLayoutProperty(o,d,p),this._updateLayer(y)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,o){const d=this.getLayer(e);if(d)return d.getLayoutProperty(o);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,o,d,p={}){this._checkLoaded();const y=this.getLayer(e);y?c.aE(y.getPaintProperty(o),d)||(y.setPaintProperty(o,d,p)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,o){return this.getLayer(e).getPaintProperty(o)}setFeatureState(e,o){this._checkLoaded();const d=e.source,p=e.sourceLayer,y=this.sourceCaches[d];if(y===void 0)return void this.fire(new c.j(new Error(`The source '${d}' does not exist in the map's style.`)));const P=y.getSource().type;P==="geojson"&&p?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||p?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(p,e.id,o)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,o){this._checkLoaded();const d=e.source,p=this.sourceCaches[d];if(p===void 0)return void this.fire(new c.j(new Error(`The source '${d}' does not exist in the map's style.`)));const y=p.getSource().type,P=y==="vector"?e.sourceLayer:void 0;y!=="vector"||P?o&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(P,e.id,o):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const o=e.source,d=e.sourceLayer,p=this.sourceCaches[o];if(p!==void 0)return p.getSource().type!=="vector"||d?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),p.getFeatureState(d,e.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.aF(this.sourceCaches,(y=>y.serialize())),o=this._serializeByIds(this._order,!0),d=this.map.getTerrain()||void 0,p=this.stylesheet;return c.aG({version:p.version,name:p.name,metadata:p.metadata,light:p.light,sky:p.sky,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,sources:e,layers:o,terrain:d},(y=>y!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const o=P=>this._layers[P].type==="fill-extrusion",d={},p=[];for(let P=this._order.length-1;P>=0;P--){const A=this._order[P];if(o(A)){d[A]=P;for(const D of e){const V=D[A];if(V)for(const $ of V)p.push($)}}}p.sort(((P,A)=>A.intersectionZ-P.intersectionZ));const y=[];for(let P=this._order.length-1;P>=0;P--){const A=this._order[P];if(o(A))for(let D=p.length-1;D>=0;D--){const V=p[D].feature;if(d[V.layer.id]<P)break;y.push(V),p.pop()}else for(const D of e){const V=D[A];if(V)for(const $ of V)y.push($.feature)}}return y}queryRenderedFeatures(e,o,d){o&&o.filter&&this._validate(c.u.filter,"queryRenderedFeatures.filter",o.filter,null,o);const p={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const A of o.layers){const D=this._layers[A];if(!D)return this.fire(new c.j(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];p[D.source]=!0}}const y=[];o.availableImages=this._availableImages;const P=this._serializedAllLayers();for(const A in this.sourceCaches)o.layers&&!p[A]||y.push($i(this.sourceCaches[A],this._layers,P,e,o,d));return this.placement&&y.push((function(A,D,V,$,Z,te,ue){const he={},pe=te.queryRenderedSymbols($),ge=[];for(const ve of Object.keys(pe).map(Number))ge.push(ue[ve]);ge.sort(Vr);for(const ve of ge){const Se=ve.featureIndex.lookupSymbolFeatures(pe[ve.bucketInstanceId],D,ve.bucketIndex,ve.sourceLayerIndex,Z.filter,Z.layers,Z.availableImages,A);for(const me in Se){const Ae=he[me]=he[me]||[],Oe=Se[me];Oe.sort(((qe,ot)=>{const yt=ve.featureSortOrder;if(yt){const St=yt.indexOf(qe.featureIndex);return yt.indexOf(ot.featureIndex)-St}return ot.featureIndex-qe.featureIndex}));for(const qe of Oe)Ae.push(qe)}}for(const ve in he)he[ve].forEach((Se=>{const me=Se.feature,Ae=V[A[ve].source].getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=Ae}));return he})(this._layers,P,this.sourceCaches,e,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(e,o){o&&o.filter&&this._validate(c.u.filter,"querySourceFeatures.filter",o.filter,null,o);const d=this.sourceCaches[e];return d?(function(p,y){const P=p.getRenderableIds().map((V=>p.getTileByID(V))),A=[],D={};for(let V=0;V<P.length;V++){const $=P[V],Z=$.tileID.canonical.key;D[Z]||(D[Z]=!0,$.querySourceFeatures(A,y))}return A})(d,o):[]}getLight(){return this.light.getLight()}setLight(e,o={}){this._checkLoaded();const d=this.light.getLight();let p=!1;for(const P in e)if(!c.aE(e[P],d[P])){p=!0;break}if(!p)return;const y={now:F.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,o),this.light.updateTransitions(y)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,o={}){const d=this.getSky();let p=!1;if(!e&&!d)return;if(e&&!d)p=!0;else if(!e&&d)p=!0;else for(const P in e)if(!c.aE(e[P],d[P])){p=!0;break}if(!p)return;const y={now:F.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,o),this.sky.updateTransitions(y)}_validate(e,o,d,p,y={}){return(!y||y.validate!==!1)&&Li(this,e.call(c.u,c.e({key:o,style:this.serialize(),value:d,styleSpec:c.v},p)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),tn().off(Qe,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const d=this.sourceCaches[o];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const o in this.sourceCaches)this.sourceCaches[o].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,o,d,p,y=!1){let P=!1,A=!1;const D={};for(const V of this._order){const $=this._layers[V];if($.type!=="symbol")continue;if(!D[$.source]){const te=this.sourceCaches[$.source];D[$.source]=te.getRenderableIds(!0).map((ue=>te.getTileByID(ue))).sort(((ue,he)=>he.tileID.overscaledZ-ue.tileID.overscaledZ||(ue.tileID.isLessThan(he.tileID)?-1:1)))}const Z=this.crossTileSymbolIndex.addLayer($,D[$.source],e.center.lng);P=P||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(F.now(),e.zoom))&&(this.pauseablePlacement=new Xo(e,this.map.terrain,this._order,y,o,d,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(F.now()),A=!0),P&&this.pauseablePlacement.placement.setStale()),A||P)for(const V of this._order){const $=this._layers[V];$.type==="symbol"&&this.placement.updateLayerOpacities($,D[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(F.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,o){return c._(this,void 0,void 0,(function*(){const d=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const p=this.sourceCaches[o.source];return p&&p.setDependencies(o.tileID.key,o.type,o.icons),d}))}getGlyphs(e,o){return c._(this,void 0,void 0,(function*(){const d=yield this.glyphManager.getGlyphs(o.stacks),p=this.sourceCaches[o.source];return p&&p.setDependencies(o.tileID.key,o.type,[""]),d}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,o={}){this._checkLoaded(),e&&this._validate(c.u.glyphs,"glyphs",e,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,o,d={},p){this._checkLoaded();const y=[{id:e,url:o}],P=[...ft(this.stylesheet.sprite),...y];this._validate(c.u.sprite,"sprite",P,null,d)||(this.stylesheet.sprite=P,this._loadSprite(y,!0,p))}removeSprite(e){this._checkLoaded();const o=ft(this.stylesheet.sprite);if(o.find((d=>d.id===e))){if(this._spritesImagesIds[e])for(const d of this._spritesImagesIds[e])this.imageManager.removeImage(d),this._changedImages[d]=!0;o.splice(o.findIndex((d=>d.id===e)),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return ft(this.stylesheet.sprite)}setSprite(e,o={},d){this._checkLoaded(),e&&this._validate(c.u.sprite,"sprite",e,null,o)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,d):(this._unloadSprite(),d&&d(null)))}}var Nr=c.Y([{name:"a_pos",type:"Int16",components:2}]);const la={prelude:Un(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Un(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Un(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Un(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Un("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Un(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Un(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Un("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Un("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Un("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Un(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Un(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Un(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Un(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Un(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Un(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Un(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Un(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Un(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Un(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Un(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Un(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Un(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Un("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Un("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Un("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Un("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Un(_,e){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=e.match(/attribute ([\w]+) ([\w]+)/g),p=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=y?y.concat(p):p,A={};return{fragmentSource:_=_.replace(o,((D,V,$,Z,te)=>(A[te]=!0,V==="define"?`
#ifndef HAS_UNIFORM_u_${te}
varying ${$} ${Z} ${te};
#else
uniform ${$} ${Z} u_${te};
#endif
`:`
#ifdef HAS_UNIFORM_u_${te}
    ${$} ${Z} ${te} = u_${te};
#endif
`))),vertexSource:e=e.replace(o,((D,V,$,Z,te)=>{const ue=Z==="float"?"vec2":"vec4",he=te.match(/color/)?"color":ue;return A[te]?V==="define"?`
#ifndef HAS_UNIFORM_u_${te}
uniform lowp float u_${te}_t;
attribute ${$} ${ue} a_${te};
varying ${$} ${Z} ${te};
#else
uniform ${$} ${Z} u_${te};
#endif
`:he==="vec4"?`
#ifndef HAS_UNIFORM_u_${te}
    ${te} = a_${te};
#else
    ${$} ${Z} ${te} = u_${te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${te}
    ${te} = unpack_mix_${he}(a_${te}, u_${te}_t);
#else
    ${$} ${Z} ${te} = u_${te};
#endif
`:V==="define"?`
#ifndef HAS_UNIFORM_u_${te}
uniform lowp float u_${te}_t;
attribute ${$} ${ue} a_${te};
#else
uniform ${$} ${Z} u_${te};
#endif
`:he==="vec4"?`
#ifndef HAS_UNIFORM_u_${te}
    ${$} ${Z} ${te} = a_${te};
#else
    ${$} ${Z} ${te} = u_${te};
#endif
`:`
#ifndef HAS_UNIFORM_u_${te}
    ${$} ${Z} ${te} = unpack_mix_${he}(a_${te}, u_${te}_t);
#else
    ${$} ${Z} ${te} = u_${te};
#endif
`})),staticAttributes:d,staticUniforms:P}}class Wa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,o,d,p,y,P,A,D,V){this.context=e;let $=this.boundPaintVertexBuffers.length!==p.length;for(let Z=0;!$&&Z<p.length;Z++)this.boundPaintVertexBuffers[Z]!==p[Z]&&($=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==d||$||this.boundIndexBuffer!==y||this.boundVertexOffset!==P||this.boundDynamicVertexBuffer!==A||this.boundDynamicVertexBuffer2!==D||this.boundDynamicVertexBuffer3!==V?this.freshBind(o,d,p,y,P,A,D,V):(e.bindVertexArray.set(this.vao),A&&A.bind(),y&&y.dynamicDraw&&y.bind(),D&&D.bind(),V&&V.bind())}freshBind(e,o,d,p,y,P,A,D){const V=e.numAttributes,$=this.context,Z=$.gl;this.vao&&this.destroy(),this.vao=$.createVertexArray(),$.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=p,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=A,this.boundDynamicVertexBuffer3=D,o.enableAttributes(Z,e);for(const te of d)te.enableAttributes(Z,e);P&&P.enableAttributes(Z,e),A&&A.enableAttributes(Z,e),D&&D.enableAttributes(Z,e),o.bind(),o.setVertexAttribPointers(Z,e,y);for(const te of d)te.bind(),te.setVertexAttribPointers(Z,e,y);P&&(P.bind(),P.setVertexAttribPointers(Z,e,y)),p&&p.bind(),A&&(A.bind(),A.setVertexAttribPointers(Z,e,y)),D&&(D.bind(),D.setVertexAttribPointers(Z,e,y)),$.currentNumAttributes=V}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const au=(_,e,o,d,p)=>({u_matrix:_,u_texture:0,u_ele_delta:e,u_fog_matrix:o,u_fog_color:d?d.properties.get("fog-color"):c.aM.white,u_fog_ground_blend:d?d.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:d?d.calculateFogBlendOpacity(p):0,u_horizon_color:d?d.properties.get("horizon-color"):c.aM.white,u_horizon_fog_blend:d?d.properties.get("horizon-fog-blend"):1});function ua(_){const e=[];for(let o=0;o<_.length;o++){if(_[o]===null)continue;const d=_[o].split(" ");e.push(d.pop())}return e}class qn{constructor(e,o,d,p,y,P){const A=e.gl;this.program=A.createProgram();const D=ua(o.staticAttributes),V=d?d.getBinderAttributes():[],$=D.concat(V),Z=la.prelude.staticUniforms?ua(la.prelude.staticUniforms):[],te=o.staticUniforms?ua(o.staticUniforms):[],ue=d?d.getBinderUniforms():[],he=Z.concat(te).concat(ue),pe=[];for(const qe of he)pe.indexOf(qe)<0&&pe.push(qe);const ge=d?d.defines():[];y&&ge.push("#define OVERDRAW_INSPECTOR;"),P&&ge.push("#define TERRAIN3D;");const ve=ge.concat(la.prelude.fragmentSource,o.fragmentSource).join(`
`),Se=ge.concat(la.prelude.vertexSource,o.vertexSource).join(`
`),me=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(me,ve),A.compileShader(me),!A.getShaderParameter(me,A.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${A.getShaderInfoLog(me)}`);A.attachShader(this.program,me);const Ae=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(Ae,Se),A.compileShader(Ae),!A.getShaderParameter(Ae,A.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${A.getShaderInfoLog(Ae)}`);A.attachShader(this.program,Ae),this.attributes={};const Oe={};this.numAttributes=$.length;for(let qe=0;qe<this.numAttributes;qe++)$[qe]&&(A.bindAttribLocation(this.program,qe,$[qe]),this.attributes[$[qe]]=qe);if(A.linkProgram(this.program),!A.getProgramParameter(this.program,A.LINK_STATUS))throw new Error(`Program failed to link: ${A.getProgramInfoLog(this.program)}`);A.deleteShader(Ae),A.deleteShader(me);for(let qe=0;qe<pe.length;qe++){const ot=pe[qe];if(ot&&!Oe[ot]){const yt=A.getUniformLocation(this.program,ot);yt&&(Oe[ot]=yt)}}this.fixedUniforms=p(e,Oe),this.terrainUniforms=((qe,ot)=>({u_depth:new c.aH(qe,ot.u_depth),u_terrain:new c.aH(qe,ot.u_terrain),u_terrain_dim:new c.aI(qe,ot.u_terrain_dim),u_terrain_matrix:new c.aJ(qe,ot.u_terrain_matrix),u_terrain_unpack:new c.aK(qe,ot.u_terrain_unpack),u_terrain_exaggeration:new c.aI(qe,ot.u_terrain_exaggeration)}))(e,Oe),this.binderUniforms=d?d.getUniforms(e,Oe):[]}draw(e,o,d,p,y,P,A,D,V,$,Z,te,ue,he,pe,ge,ve,Se){const me=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(d),e.setStencilMode(p),e.setColorMode(y),e.setCullFace(P),D){e.activeTexture.set(me.TEXTURE2),me.bindTexture(me.TEXTURE_2D,D.depthTexture),e.activeTexture.set(me.TEXTURE3),me.bindTexture(me.TEXTURE_2D,D.texture);for(const Oe in this.terrainUniforms)this.terrainUniforms[Oe].set(D[Oe])}for(const Oe in this.fixedUniforms)this.fixedUniforms[Oe].set(A[Oe]);pe&&pe.setUniforms(e,this.binderUniforms,ue,{zoom:he});let Ae=0;switch(o){case me.LINES:Ae=2;break;case me.TRIANGLES:Ae=3;break;case me.LINE_STRIP:Ae=1}for(const Oe of te.get()){const qe=Oe.vaos||(Oe.vaos={});(qe[V]||(qe[V]=new Wa)).bind(e,this,$,pe?pe.getPaintVertexBuffers():[],Z,Oe.vertexOffset,ge,ve,Se),me.drawElements(o,Oe.primitiveLength*Ae,me.UNSIGNED_SHORT,Oe.primitiveOffset*Ae*2)}}}function Mo(_,e,o){const d=1/Sn(o,1,e.transform.tileZoom),p=Math.pow(2,o.tileID.overscaledZ),y=o.tileSize*Math.pow(2,e.transform.tileZoom)/p,P=y*(o.tileID.canonical.x+o.tileID.wrap*p),A=y*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[d,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[P>>16,A>>16],u_pixel_coord_lower:[65535&P,65535&A]}}const Ao=(_,e,o,d)=>{const p=e.style.light,y=p.properties.get("position"),P=[y.x,y.y,y.z],A=(function(){var V=new c.A(9);return c.A!=Float32Array&&(V[1]=0,V[2]=0,V[3]=0,V[5]=0,V[6]=0,V[7]=0),V[0]=1,V[4]=1,V[8]=1,V})();p.properties.get("anchor")==="viewport"&&(function(V,$){var Z=Math.sin($),te=Math.cos($);V[0]=te,V[1]=Z,V[2]=0,V[3]=-Z,V[4]=te,V[5]=0,V[6]=0,V[7]=0,V[8]=1})(A,-e.transform.angle),(function(V,$,Z){var te=$[0],ue=$[1],he=$[2];V[0]=te*Z[0]+ue*Z[3]+he*Z[6],V[1]=te*Z[1]+ue*Z[4]+he*Z[7],V[2]=te*Z[2]+ue*Z[5]+he*Z[8]})(P,P,A);const D=p.properties.get("color");return{u_matrix:_,u_lightpos:P,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+o,u_opacity:d}},Ya=(_,e,o,d,p,y,P)=>c.e(Ao(_,e,o,d),Mo(y,e,P),{u_height_factor:-Math.pow(2,p.overscaledZ)/P.tileSize/8}),Ka=_=>({u_matrix:_}),Yo=(_,e,o,d)=>c.e(Ka(_),Mo(o,e,d)),mi=(_,e)=>({u_matrix:_,u_world:e}),Rs=(_,e,o,d,p)=>c.e(Yo(_,e,o,d),{u_world:p}),yl=(_,e,o,d)=>{const p=_.transform;let y,P;if(d.paint.get("circle-pitch-alignment")==="map"){const A=Sn(o,1,p.zoom);y=!0,P=[A,A]}else y=!1,P=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:_.translatePosMatrix(e.posMatrix,o,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:P}},_r=(_,e,o)=>({u_matrix:_,u_inv_matrix:e,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}),Ti=(_,e,o=1)=>({u_matrix:_,u_color:e,u_overlay:0,u_overlay_scale:o}),Yn=_=>({u_matrix:_}),Vi=(_,e,o,d)=>({u_matrix:_,u_extrude_scale:Sn(e,1,o),u_intensity:d}),Na=(_,e,o,d)=>{const p=c.H();c.aP(p,0,_.width,_.height,0,0,1);const y=_.context.gl;return{u_matrix:p,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:o,u_color_ramp:d,u_opacity:e.paint.get("heatmap-opacity")}};function gs(_,e){const o=Math.pow(2,e.canonical.z),d=e.canonical.y;return[new c.Z(0,d/o).toLngLat().lat,new c.Z(0,(d+1)/o).toLngLat().lat]}const Ko=(_,e,o,d)=>{const p=_.transform;return{u_matrix:zr(_,e,o,d),u_ratio:1/Sn(e,1,p.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Lo=(_,e,o,d,p)=>c.e(Ko(_,e,o,p),{u_image:0,u_image_height:d}),Ns=(_,e,o,d,p)=>{const y=_.transform,P=Xn(e,y);return{u_matrix:zr(_,e,o,p),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Sn(e,1,y.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[P,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Lu=(_,e,o,d,p,y)=>{const P=_.lineAtlas,A=Xn(e,_.transform),D=o.layout.get("line-cap")==="round",V=P.getDash(d.from,D),$=P.getDash(d.to,D),Z=V.width*p.fromScale,te=$.width*p.toScale;return c.e(Ko(_,e,o,y),{u_patternscale_a:[A/Z,-V.height/2],u_patternscale_b:[A/te,-$.height/2],u_sdfgamma:P.width/(256*Math.min(Z,te)*_.pixelRatio)/2,u_image:0,u_tex_y_a:V.y,u_tex_y_b:$.y,u_mix:p.t})};function Xn(_,e){return 1/Sn(_,1,e.tileZoom)}function zr(_,e,o,d){return _.translatePosMatrix(d?d.posMatrix:e.tileID.posMatrix,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const _l=(_,e,o,d,p)=>{return{u_matrix:_,u_tl_parent:e,u_scale_parent:o,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(P=p.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(y=p.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Ru(p.paint.get("raster-hue-rotate"))};var y,P};function Ru(_){_*=Math.PI/180;const e=Math.sin(_),o=Math.cos(_);return[(2*o+1)/3,(-Math.sqrt(3)*e-o+1)/3,(Math.sqrt(3)*e-o+1)/3]}const zs=(_,e,o,d,p,y,P,A,D,V,$,Z,te,ue)=>{const he=P.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:he.cameraToCenterDistance,u_pitch:he.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:he.width/he.height,u_fade_change:P.options.fadeDuration?P.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:D,u_coord_matrix:V,u_is_text:+Z,u_pitch_with_map:+d,u_is_along_line:p,u_is_variable_anchor:y,u_texsize:te,u_texture:0,u_translation:$,u_pitched_scale:ue}},Ds=(_,e,o,d,p,y,P,A,D,V,$,Z,te,ue,he)=>{const pe=P.transform;return c.e(zs(_,e,o,d,p,y,P,A,D,V,$,Z,te,he),{u_gamma_scale:d?Math.cos(pe._pitch)*pe.cameraToCenterDistance:1,u_device_pixel_ratio:P.pixelRatio,u_is_halo:1})},Ri=(_,e,o,d,p,y,P,A,D,V,$,Z,te,ue)=>c.e(Ds(_,e,o,d,p,y,P,A,D,V,$,!0,Z,!0,ue),{u_texsize_icon:te,u_texture_icon:1}),za=(_,e,o)=>({u_matrix:_,u_opacity:e,u_color:o}),Jo=(_,e,o,d,p,y)=>c.e((function(P,A,D,V){const $=D.imageManager.getPattern(P.from.toString()),Z=D.imageManager.getPattern(P.to.toString()),{width:te,height:ue}=D.imageManager.getPixelSize(),he=Math.pow(2,V.tileID.overscaledZ),pe=V.tileSize*Math.pow(2,D.transform.tileZoom)/he,ge=pe*(V.tileID.canonical.x+V.tileID.wrap*he),ve=pe*V.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:$.tl,u_pattern_br_a:$.br,u_pattern_tl_b:Z.tl,u_pattern_br_b:Z.br,u_texsize:[te,ue],u_mix:A.t,u_pattern_size_a:$.displaySize,u_pattern_size_b:Z.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/Sn(V,1,D.transform.tileZoom),u_pixel_coord_upper:[ge>>16,ve>>16],u_pixel_coord_lower:[65535&ge,65535&ve]}})(d,y,o,p),{u_matrix:_,u_opacity:e}),vl={fillExtrusion:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_lightpos:new c.aN(_,e.u_lightpos),u_lightintensity:new c.aI(_,e.u_lightintensity),u_lightcolor:new c.aN(_,e.u_lightcolor),u_vertical_gradient:new c.aI(_,e.u_vertical_gradient),u_opacity:new c.aI(_,e.u_opacity)}),fillExtrusionPattern:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_lightpos:new c.aN(_,e.u_lightpos),u_lightintensity:new c.aI(_,e.u_lightintensity),u_lightcolor:new c.aN(_,e.u_lightcolor),u_vertical_gradient:new c.aI(_,e.u_vertical_gradient),u_height_factor:new c.aI(_,e.u_height_factor),u_image:new c.aH(_,e.u_image),u_texsize:new c.aO(_,e.u_texsize),u_pixel_coord_upper:new c.aO(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(_,e.u_pixel_coord_lower),u_scale:new c.aN(_,e.u_scale),u_fade:new c.aI(_,e.u_fade),u_opacity:new c.aI(_,e.u_opacity)}),fill:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix)}),fillPattern:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_image:new c.aH(_,e.u_image),u_texsize:new c.aO(_,e.u_texsize),u_pixel_coord_upper:new c.aO(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(_,e.u_pixel_coord_lower),u_scale:new c.aN(_,e.u_scale),u_fade:new c.aI(_,e.u_fade)}),fillOutline:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_world:new c.aO(_,e.u_world)}),fillOutlinePattern:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_world:new c.aO(_,e.u_world),u_image:new c.aH(_,e.u_image),u_texsize:new c.aO(_,e.u_texsize),u_pixel_coord_upper:new c.aO(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(_,e.u_pixel_coord_lower),u_scale:new c.aN(_,e.u_scale),u_fade:new c.aI(_,e.u_fade)}),circle:(_,e)=>({u_camera_to_center_distance:new c.aI(_,e.u_camera_to_center_distance),u_scale_with_map:new c.aH(_,e.u_scale_with_map),u_pitch_with_map:new c.aH(_,e.u_pitch_with_map),u_extrude_scale:new c.aO(_,e.u_extrude_scale),u_device_pixel_ratio:new c.aI(_,e.u_device_pixel_ratio),u_matrix:new c.aJ(_,e.u_matrix)}),collisionBox:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_pixel_extrude_scale:new c.aO(_,e.u_pixel_extrude_scale)}),collisionCircle:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_inv_matrix:new c.aJ(_,e.u_inv_matrix),u_camera_to_center_distance:new c.aI(_,e.u_camera_to_center_distance),u_viewport_size:new c.aO(_,e.u_viewport_size)}),debug:(_,e)=>({u_color:new c.aL(_,e.u_color),u_matrix:new c.aJ(_,e.u_matrix),u_overlay:new c.aH(_,e.u_overlay),u_overlay_scale:new c.aI(_,e.u_overlay_scale)}),clippingMask:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix)}),heatmap:(_,e)=>({u_extrude_scale:new c.aI(_,e.u_extrude_scale),u_intensity:new c.aI(_,e.u_intensity),u_matrix:new c.aJ(_,e.u_matrix)}),heatmapTexture:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_world:new c.aO(_,e.u_world),u_image:new c.aH(_,e.u_image),u_color_ramp:new c.aH(_,e.u_color_ramp),u_opacity:new c.aI(_,e.u_opacity)}),hillshade:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_image:new c.aH(_,e.u_image),u_latrange:new c.aO(_,e.u_latrange),u_light:new c.aO(_,e.u_light),u_shadow:new c.aL(_,e.u_shadow),u_highlight:new c.aL(_,e.u_highlight),u_accent:new c.aL(_,e.u_accent)}),hillshadePrepare:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_image:new c.aH(_,e.u_image),u_dimension:new c.aO(_,e.u_dimension),u_zoom:new c.aI(_,e.u_zoom),u_unpack:new c.aK(_,e.u_unpack)}),line:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_ratio:new c.aI(_,e.u_ratio),u_device_pixel_ratio:new c.aI(_,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(_,e.u_units_to_pixels)}),lineGradient:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_ratio:new c.aI(_,e.u_ratio),u_device_pixel_ratio:new c.aI(_,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(_,e.u_units_to_pixels),u_image:new c.aH(_,e.u_image),u_image_height:new c.aI(_,e.u_image_height)}),linePattern:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_texsize:new c.aO(_,e.u_texsize),u_ratio:new c.aI(_,e.u_ratio),u_device_pixel_ratio:new c.aI(_,e.u_device_pixel_ratio),u_image:new c.aH(_,e.u_image),u_units_to_pixels:new c.aO(_,e.u_units_to_pixels),u_scale:new c.aN(_,e.u_scale),u_fade:new c.aI(_,e.u_fade)}),lineSDF:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_ratio:new c.aI(_,e.u_ratio),u_device_pixel_ratio:new c.aI(_,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(_,e.u_units_to_pixels),u_patternscale_a:new c.aO(_,e.u_patternscale_a),u_patternscale_b:new c.aO(_,e.u_patternscale_b),u_sdfgamma:new c.aI(_,e.u_sdfgamma),u_image:new c.aH(_,e.u_image),u_tex_y_a:new c.aI(_,e.u_tex_y_a),u_tex_y_b:new c.aI(_,e.u_tex_y_b),u_mix:new c.aI(_,e.u_mix)}),raster:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_tl_parent:new c.aO(_,e.u_tl_parent),u_scale_parent:new c.aI(_,e.u_scale_parent),u_buffer_scale:new c.aI(_,e.u_buffer_scale),u_fade_t:new c.aI(_,e.u_fade_t),u_opacity:new c.aI(_,e.u_opacity),u_image0:new c.aH(_,e.u_image0),u_image1:new c.aH(_,e.u_image1),u_brightness_low:new c.aI(_,e.u_brightness_low),u_brightness_high:new c.aI(_,e.u_brightness_high),u_saturation_factor:new c.aI(_,e.u_saturation_factor),u_contrast_factor:new c.aI(_,e.u_contrast_factor),u_spin_weights:new c.aN(_,e.u_spin_weights)}),symbolIcon:(_,e)=>({u_is_size_zoom_constant:new c.aH(_,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(_,e.u_is_size_feature_constant),u_size_t:new c.aI(_,e.u_size_t),u_size:new c.aI(_,e.u_size),u_camera_to_center_distance:new c.aI(_,e.u_camera_to_center_distance),u_pitch:new c.aI(_,e.u_pitch),u_rotate_symbol:new c.aH(_,e.u_rotate_symbol),u_aspect_ratio:new c.aI(_,e.u_aspect_ratio),u_fade_change:new c.aI(_,e.u_fade_change),u_matrix:new c.aJ(_,e.u_matrix),u_label_plane_matrix:new c.aJ(_,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(_,e.u_coord_matrix),u_is_text:new c.aH(_,e.u_is_text),u_pitch_with_map:new c.aH(_,e.u_pitch_with_map),u_is_along_line:new c.aH(_,e.u_is_along_line),u_is_variable_anchor:new c.aH(_,e.u_is_variable_anchor),u_texsize:new c.aO(_,e.u_texsize),u_texture:new c.aH(_,e.u_texture),u_translation:new c.aO(_,e.u_translation),u_pitched_scale:new c.aI(_,e.u_pitched_scale)}),symbolSDF:(_,e)=>({u_is_size_zoom_constant:new c.aH(_,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(_,e.u_is_size_feature_constant),u_size_t:new c.aI(_,e.u_size_t),u_size:new c.aI(_,e.u_size),u_camera_to_center_distance:new c.aI(_,e.u_camera_to_center_distance),u_pitch:new c.aI(_,e.u_pitch),u_rotate_symbol:new c.aH(_,e.u_rotate_symbol),u_aspect_ratio:new c.aI(_,e.u_aspect_ratio),u_fade_change:new c.aI(_,e.u_fade_change),u_matrix:new c.aJ(_,e.u_matrix),u_label_plane_matrix:new c.aJ(_,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(_,e.u_coord_matrix),u_is_text:new c.aH(_,e.u_is_text),u_pitch_with_map:new c.aH(_,e.u_pitch_with_map),u_is_along_line:new c.aH(_,e.u_is_along_line),u_is_variable_anchor:new c.aH(_,e.u_is_variable_anchor),u_texsize:new c.aO(_,e.u_texsize),u_texture:new c.aH(_,e.u_texture),u_gamma_scale:new c.aI(_,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(_,e.u_device_pixel_ratio),u_is_halo:new c.aH(_,e.u_is_halo),u_translation:new c.aO(_,e.u_translation),u_pitched_scale:new c.aI(_,e.u_pitched_scale)}),symbolTextAndIcon:(_,e)=>({u_is_size_zoom_constant:new c.aH(_,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(_,e.u_is_size_feature_constant),u_size_t:new c.aI(_,e.u_size_t),u_size:new c.aI(_,e.u_size),u_camera_to_center_distance:new c.aI(_,e.u_camera_to_center_distance),u_pitch:new c.aI(_,e.u_pitch),u_rotate_symbol:new c.aH(_,e.u_rotate_symbol),u_aspect_ratio:new c.aI(_,e.u_aspect_ratio),u_fade_change:new c.aI(_,e.u_fade_change),u_matrix:new c.aJ(_,e.u_matrix),u_label_plane_matrix:new c.aJ(_,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(_,e.u_coord_matrix),u_is_text:new c.aH(_,e.u_is_text),u_pitch_with_map:new c.aH(_,e.u_pitch_with_map),u_is_along_line:new c.aH(_,e.u_is_along_line),u_is_variable_anchor:new c.aH(_,e.u_is_variable_anchor),u_texsize:new c.aO(_,e.u_texsize),u_texsize_icon:new c.aO(_,e.u_texsize_icon),u_texture:new c.aH(_,e.u_texture),u_texture_icon:new c.aH(_,e.u_texture_icon),u_gamma_scale:new c.aI(_,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(_,e.u_device_pixel_ratio),u_is_halo:new c.aH(_,e.u_is_halo),u_translation:new c.aO(_,e.u_translation),u_pitched_scale:new c.aI(_,e.u_pitched_scale)}),background:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_opacity:new c.aI(_,e.u_opacity),u_color:new c.aL(_,e.u_color)}),backgroundPattern:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_opacity:new c.aI(_,e.u_opacity),u_image:new c.aH(_,e.u_image),u_pattern_tl_a:new c.aO(_,e.u_pattern_tl_a),u_pattern_br_a:new c.aO(_,e.u_pattern_br_a),u_pattern_tl_b:new c.aO(_,e.u_pattern_tl_b),u_pattern_br_b:new c.aO(_,e.u_pattern_br_b),u_texsize:new c.aO(_,e.u_texsize),u_mix:new c.aI(_,e.u_mix),u_pattern_size_a:new c.aO(_,e.u_pattern_size_a),u_pattern_size_b:new c.aO(_,e.u_pattern_size_b),u_scale_a:new c.aI(_,e.u_scale_a),u_scale_b:new c.aI(_,e.u_scale_b),u_pixel_coord_upper:new c.aO(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(_,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aI(_,e.u_tile_units_to_pixels)}),terrain:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_texture:new c.aH(_,e.u_texture),u_ele_delta:new c.aI(_,e.u_ele_delta),u_fog_matrix:new c.aJ(_,e.u_fog_matrix),u_fog_color:new c.aL(_,e.u_fog_color),u_fog_ground_blend:new c.aI(_,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.aI(_,e.u_fog_ground_blend_opacity),u_horizon_color:new c.aL(_,e.u_horizon_color),u_horizon_fog_blend:new c.aI(_,e.u_horizon_fog_blend)}),terrainDepth:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_ele_delta:new c.aI(_,e.u_ele_delta)}),terrainCoords:(_,e)=>({u_matrix:new c.aJ(_,e.u_matrix),u_texture:new c.aH(_,e.u_texture),u_terrain_coords_id:new c.aI(_,e.u_terrain_coords_id),u_ele_delta:new c.aI(_,e.u_ele_delta)}),sky:(_,e)=>({u_sky_color:new c.aL(_,e.u_sky_color),u_horizon_color:new c.aL(_,e.u_horizon_color),u_horizon:new c.aI(_,e.u_horizon),u_sky_horizon_blend:new c.aI(_,e.u_sky_horizon_blend)})};class Gr{constructor(e,o,d){this.context=e;const p=e.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ro{constructor(e,o,d,p){this.length=o.length,this.attributes=d,this.itemSize=o.bytesPerElement,this.dynamicDraw=p,this.context=e;const y=e.gl;this.buffer=y.createBuffer(),e.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,o){for(let d=0;d<this.attributes.length;d++){const p=o.attributes[this.attributes[d].name];p!==void 0&&e.enableVertexAttribArray(p)}}setVertexAttribPointers(e,o,d){for(let p=0;p<this.attributes.length;p++){const y=this.attributes[p],P=o.attributes[y.name];P!==void 0&&e.vertexAttribPointer(P,y.components,e[xl[y.type]],!1,this.itemSize,y.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const vr=new WeakMap;function Ji(_){var e;if(vr.has(_))return vr.get(_);{const o=(e=_.getParameter(_.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return vr.set(_,o),o}}class Gn{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Qi extends Gn{getDefault(){return c.aM.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ja extends Gn{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ca extends Gn{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class ha extends Gn{getDefault(){return[!0,!0,!0,!0]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class wl extends Gn{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class er extends Gn{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Qa extends Gn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const o=this.current;(e.func!==o.func||e.ref!==o.ref||e.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Dr extends Gn{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class eo extends Gn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=e,this.dirty=!1}}class Nu extends Gn{getDefault(){return[0,1]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class bl extends Gn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=e,this.dirty=!1}}class kl extends Gn{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ys extends Gn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.BLEND):o.disable(o.BLEND),this.current=e,this.dirty=!1}}class Qo extends Gn{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class zu extends Gn{getDefault(){return c.aM.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Du extends Gn{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class _s extends Gn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=e,this.dirty=!1}}class $r extends Gn{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class No extends Gn{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Ou extends Gn{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class fc extends Gn{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Sl extends Gn{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ou extends Gn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class El extends Gn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class el extends Gn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class es extends Gn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class tl extends Gn{getDefault(){return null}set(e){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ui extends Gn{getDefault(){return null}set(e){var o;if(e===this.current&&!this.dirty)return;const d=this.gl;Ji(d)?d.bindVertexArray(e):(o=d.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class to extends Gn{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class nl extends Gn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Il extends Gn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class il extends Gn{constructor(e,o){super(e),this.context=e,this.parent=o}getDefault(){return null}}class Tl extends il{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Os extends il{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class lu extends il{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class dc{constructor(e,o,d,p,y){this.context=e,this.width=o,this.height=d;const P=e.gl,A=this.framebuffer=P.createFramebuffer();if(this.colorAttachment=new Tl(e,A),p)this.depthAttachment=y?new lu(e,A):new Os(e,A);else if(y)throw new Error("Stencil cannot be set without depth");if(P.checkFramebufferStatus(P.FRAMEBUFFER)!==P.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,o=this.colorAttachment.get();if(o&&e.deleteTexture(o),this.depthAttachment){const d=this.depthAttachment.get();d&&e.deleteRenderbuffer(d)}e.deleteFramebuffer(this.framebuffer)}}class Ni{constructor(e,o,d){this.blendFunction=e,this.blendColor=o,this.mask=d}}Ni.Replace=[1,0],Ni.disabled=new Ni(Ni.Replace,c.aM.transparent,[!1,!1,!1,!1]),Ni.unblended=new Ni(Ni.Replace,c.aM.transparent,[!0,!0,!0,!0]),Ni.alphaBlended=new Ni([1,771],c.aM.transparent,[!0,!0,!0,!0]);class pc{constructor(e){var o,d;if(this.gl=e,this.clearColor=new Qi(this),this.clearDepth=new Ja(this),this.clearStencil=new ca(this),this.colorMask=new ha(this),this.depthMask=new wl(this),this.stencilMask=new er(this),this.stencilFunc=new Qa(this),this.stencilOp=new Dr(this),this.stencilTest=new eo(this),this.depthRange=new Nu(this),this.depthTest=new bl(this),this.depthFunc=new kl(this),this.blend=new ys(this),this.blendFunc=new Qo(this),this.blendColor=new zu(this),this.blendEquation=new Du(this),this.cullFace=new _s(this),this.cullFaceSide=new $r(this),this.frontFace=new No(this),this.program=new Ou(this),this.activeTexture=new fc(this),this.viewport=new Sl(this),this.bindFramebuffer=new ou(this),this.bindRenderbuffer=new El(this),this.bindTexture=new el(this),this.bindVertexBuffer=new es(this),this.bindElementBuffer=new tl(this),this.bindVertexArray=new Ui(this),this.pixelStoreUnpack=new to(this),this.pixelStoreUnpackPremultiplyAlpha=new nl(this),this.pixelStoreUnpackFlipY=new Il(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Ji(e)){this.HALF_FLOAT=e.HALF_FLOAT;const p=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=e.RGBA16F)!==null&&o!==void 0?o:p?.RGBA16F_EXT,this.RGB16F=(d=e.RGB16F)!==null&&d!==void 0?d:p?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const p=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=p?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,o){return new Gr(this,e,o)}createVertexBuffer(e,o,d){return new Ro(this,e,o,d)}createRenderbuffer(e,o,d){const p=this.gl,y=p.createRenderbuffer();return this.bindRenderbuffer.set(y),p.renderbufferStorage(p.RENDERBUFFER,e,o,d),this.bindRenderbuffer.set(null),y}createFramebuffer(e,o,d,p){return new dc(this,e,o,d,p)}clear({color:e,depth:o,stencil:d}){const p=this.gl;let y=0;e&&(y|=p.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(y|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),d!==void 0&&(y|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),p.clear(y)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.aE(e.blendFunction,Ni.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Ji(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var o;return Ji(this.gl)?this.gl.deleteVertexArray(e):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Mn{constructor(e,o,d){this.func=e,this.mask=o,this.range=d}}Mn.ReadOnly=!1,Mn.ReadWrite=!0,Mn.disabled=new Mn(519,Mn.ReadOnly,[0,1]);const Cl=7680;class oi{constructor(e,o,d,p,y,P){this.test=e,this.ref=o,this.mask=d,this.fail=p,this.depthFail=y,this.pass=P}}oi.disabled=new oi({func:519,mask:0},0,0,Cl,Cl,Cl);class Qn{constructor(e,o,d){this.enable=e,this.mode=o,this.frontFace=d}}let ts;function rl(_,e,o,d,p){const y=_.context,P=y.gl,A=_.useProgram("collisionBox"),D=[];let V=0,$=0;for(let ve=0;ve<d.length;ve++){const Se=d[ve],me=e.getTile(Se).getBucket(o);if(!me)continue;const Ae=p?me.textCollisionBox:me.iconCollisionBox,Oe=me.collisionCircleArray;if(Oe.length>0){const qe=c.H();c.aQ(qe,me.placementInvProjMatrix,_.transform.glCoordMatrix),c.aQ(qe,qe,me.placementViewportMatrix),D.push({circleArray:Oe,circleOffset:$,transform:Se.posMatrix,invTransform:qe,coord:Se}),V+=Oe.length/4,$=V}Ae&&A.draw(y,P.LINES,Mn.disabled,oi.disabled,_.colorModeForRenderPass(),Qn.disabled,{u_matrix:Se.posMatrix,u_pixel_extrude_scale:[1/(Z=_.transform).width,1/Z.height]},_.style.map.terrain&&_.style.map.terrain.getTerrainData(Se),o.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,null,_.transform.zoom,null,null,Ae.collisionVertexBuffer)}var Z;if(!p||!D.length)return;const te=_.useProgram("collisionCircle"),ue=new c.aR;ue.resize(4*V),ue._trim();let he=0;for(const ve of D)for(let Se=0;Se<ve.circleArray.length/4;Se++){const me=4*Se,Ae=ve.circleArray[me+0],Oe=ve.circleArray[me+1],qe=ve.circleArray[me+2],ot=ve.circleArray[me+3];ue.emplace(he++,Ae,Oe,qe,ot,0),ue.emplace(he++,Ae,Oe,qe,ot,1),ue.emplace(he++,Ae,Oe,qe,ot,2),ue.emplace(he++,Ae,Oe,qe,ot,3)}(!ts||ts.length<2*V)&&(ts=(function(ve){const Se=2*ve,me=new c.aT;me.resize(Se),me._trim();for(let Ae=0;Ae<Se;Ae++){const Oe=6*Ae;me.uint16[Oe+0]=4*Ae+0,me.uint16[Oe+1]=4*Ae+1,me.uint16[Oe+2]=4*Ae+2,me.uint16[Oe+3]=4*Ae+2,me.uint16[Oe+4]=4*Ae+3,me.uint16[Oe+5]=4*Ae+0}return me})(V));const pe=y.createIndexBuffer(ts,!0),ge=y.createVertexBuffer(ue,c.aS.members,!0);for(const ve of D){const Se=_r(ve.transform,ve.invTransform,_.transform);te.draw(y,P.TRIANGLES,Mn.disabled,oi.disabled,_.colorModeForRenderPass(),Qn.disabled,Se,_.style.map.terrain&&_.style.map.terrain.getTerrainData(ve.coord),o.id,ge,pe,c.a0.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,_.transform.zoom,null,null,null)}ge.destroy(),pe.destroy()}Qn.disabled=new Qn(!1,1029,2305),Qn.backCCW=new Qn(!0,1029,2305);const no=c.an(new Float32Array(16));function Pl(_,e,o,d,p,y){const{horizontalAlign:P,verticalAlign:A}=c.au(_);return new c.P((-(P-.5)*e/p+d[0])*y,(-(A-.5)*o/p+d[1])*y)}function Da(_,e,o,d,p,y){const P=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let A=d.mult(y);o||(A=A.rotate(-p));const D=P.add(A);return _e(D.x,D.y,e.labelPlaneMatrix,e.getElevation).point}if(o){const A=Ke(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(_),D=Math.atan(A.y/A.x)+(A.x<0?Math.PI:0);return _.add(d.rotate(D))}return _.add(d)}function io(_,e,o,d,p,y,P,A,D,V,$,Z,te,ue){const he=_.text.placedSymbolArray,pe=_.text.dynamicLayoutVertexArray,ge=_.icon.dynamicLayoutVertexArray,ve={};pe.clear();for(let Se=0;Se<he.length;Se++){const me=he.get(Se),Ae=me.hidden||!me.crossTileID||_.allowVerticalPlacement&&!me.placedOrientation?null:d[me.crossTileID];if(Ae){const Oe=new c.P(me.anchorX,me.anchorY),qe={getElevation:ue,width:p.width,height:p.height,labelPlaneMatrix:y,pitchWithMap:o,projection:$,tileAnchorPoint:Oe,translation:Z,unwrappedTileID:te},ot=o?_e(Oe.x,Oe.y,P,ue):Ke(Oe.x,Oe.y,qe),yt=K(p.cameraToCenterDistance,ot.signedDistanceFromCamera);let St=c.ai(_.textSizeData,D,me)*yt/c.ap;o&&(St*=_.tilePixelRatio/A);const{width:Lt,height:Et,anchor:kt,textOffset:qt,textBoxScale:gn}=Ae,It=Pl(kt,Lt,Et,qt,gn,St),Ct=$.getPitchedTextCorrection(p,Oe.add(new c.P(Z[0],Z[1])),te),mn=Da(ot.point,qe,e,It,p.angle,Ct),li=_.allowVerticalPlacement&&me.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let En=0;En<me.numGlyphs;En++)c.aj(pe,mn,li);V&&me.associatedIconIndex>=0&&(ve[me.associatedIconIndex]={shiftedAnchor:mn,angle:li})}else Qt(me.numGlyphs,pe)}if(V){ge.clear();const Se=_.icon.placedSymbolArray;for(let me=0;me<Se.length;me++){const Ae=Se.get(me);if(Ae.hidden)Qt(Ae.numGlyphs,ge);else{const Oe=ve[me];if(Oe)for(let qe=0;qe<Ae.numGlyphs;qe++)c.aj(ge,Oe.shiftedAnchor,Oe.angle);else Qt(Ae.numGlyphs,ge)}}_.icon.dynamicLayoutVertexBuffer.updateData(ge)}_.text.dynamicLayoutVertexBuffer.updateData(pe)}function Zr(_,e,o){return o.iconsInText&&e?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function Oa(_,e,o,d,p,y,P,A,D,V,$,Z){const te=_.context,ue=te.gl,he=_.transform,pe=Qr(),ge=A==="map",ve=D==="map",Se=A!=="viewport"&&o.layout.get("symbol-placement")!=="point",me=ge&&!ve&&!Se,Ae=!ve&&Se,Oe=!o.layout.get("symbol-sort-key").isConstant();let qe=!1;const ot=_.depthModeForSublayer(0,Mn.ReadOnly),yt=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),St=[],Lt=pe.getCircleRadiusCorrection(he);for(const Et of d){const kt=e.getTile(Et),qt=kt.getBucket(o);if(!qt)continue;const gn=p?qt.text:qt.icon;if(!gn||!gn.segments.get().length||!gn.hasVisibleVertices)continue;const It=gn.programConfigurations.get(o.id),Ct=p||qt.sdfIcons,mn=p?qt.textSizeData:qt.iconSizeData,li=ve||he.pitch!==0,En=_.useProgram(Zr(Ct,p,qt),It),Pn=c.ag(mn,he.zoom),ci=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Et);let wr,bs,hi,or,bi=[0,0],Zi=null;if(p)bs=kt.glyphAtlasTexture,hi=ue.LINEAR,wr=kt.glyphAtlasTexture.size,qt.iconsInText&&(bi=kt.imageAtlasTexture.size,Zi=kt.imageAtlasTexture,or=li||_.options.rotating||_.options.zooming||mn.kind==="composite"||mn.kind==="camera"?ue.LINEAR:ue.NEAREST);else{const Ln=o.layout.get("icon-size").constantOr(0)!==1||qt.iconsNeedLinear;bs=kt.imageAtlasTexture,hi=Ct||_.options.rotating||_.options.zooming||Ln||li?ue.LINEAR:ue.NEAREST,wr=kt.imageAtlasTexture.size}const Pr=Sn(kt,1,_.transform.zoom),ya=Ae?Et.posMatrix:no,is=Ai(ya,ve,ge,_.transform,Pr),_a=gr(ya,ve,ge,_.transform,Pr),Bo=gr(Et.posMatrix,ve,ge,_.transform,Pr),ks=pe.translatePosition(_.transform,kt,y,P),$s=yt&&qt.hasTextData(),Va=o.layout.get("icon-text-fit")!=="none"&&$s&&qt.hasIconData();if(Se){const Ln=_.style.map.terrain?(jo,xa)=>_.style.map.terrain.getElevation(Et,jo,xa):null,Es=o.layout.get("text-rotation-alignment")==="map";oe(qt,Et.posMatrix,_,p,is,Bo,ve,V,Es,pe,Et.toUnwrapped(),he.width,he.height,ks,Ln)}const Wr=Et.posMatrix,Ss=p&&yt||Va,va=Se||Ss?no:is,Zs=_a,Wi=Ct&&o.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Pi;Pi=Ct?qt.iconsInText?Ri(mn.kind,Pn,me,ve,Se,Ss,_,Wr,va,Zs,ks,wr,bi,Lt):Ds(mn.kind,Pn,me,ve,Se,Ss,_,Wr,va,Zs,ks,p,wr,!0,Lt):zs(mn.kind,Pn,me,ve,Se,Ss,_,Wr,va,Zs,ks,p,wr,Lt);const Mr={program:En,buffers:gn,uniformValues:Pi,atlasTexture:bs,atlasTextureIcon:Zi,atlasInterpolation:hi,atlasInterpolationIcon:or,isSDF:Ct,hasHalo:Wi};if(Oe&&qt.canOverlap){qe=!0;const Ln=gn.segments.get();for(const Es of Ln)St.push({segments:new c.a0([Es]),sortKey:Es.sortKey,state:Mr,terrainData:ci})}else St.push({segments:gn.segments,sortKey:0,state:Mr,terrainData:ci})}qe&&St.sort(((Et,kt)=>Et.sortKey-kt.sortKey));for(const Et of St){const kt=Et.state;if(te.activeTexture.set(ue.TEXTURE0),kt.atlasTexture.bind(kt.atlasInterpolation,ue.CLAMP_TO_EDGE),kt.atlasTextureIcon&&(te.activeTexture.set(ue.TEXTURE1),kt.atlasTextureIcon&&kt.atlasTextureIcon.bind(kt.atlasInterpolationIcon,ue.CLAMP_TO_EDGE)),kt.isSDF){const qt=kt.uniformValues;kt.hasHalo&&(qt.u_is_halo=1,uu(kt.buffers,Et.segments,o,_,kt.program,ot,$,Z,qt,Et.terrainData)),qt.u_is_halo=0}uu(kt.buffers,Et.segments,o,_,kt.program,ot,$,Z,kt.uniformValues,Et.terrainData)}}function uu(_,e,o,d,p,y,P,A,D,V){const $=d.context;p.draw($,$.gl.TRIANGLES,y,P,A,Qn.disabled,D,V,o.id,_.layoutVertexBuffer,_.indexBuffer,e,o.paint,d.transform.zoom,_.programConfigurations.get(o.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function cu(_,e,o,d){const p=_.context,y=p.gl,P=oi.disabled,A=new Ni([y.ONE,y.ONE],c.aM.transparent,[!0,!0,!0,!0]),D=e.getBucket(o);if(!D)return;const V=d.key;let $=o.heatmapFbos.get(V);$||($=ro(p,e.tileSize,e.tileSize),o.heatmapFbos.set(V,$)),p.bindFramebuffer.set($.framebuffer),p.viewport.set([0,0,e.tileSize,e.tileSize]),p.clear({color:c.aM.transparent});const Z=D.programConfigurations.get(o.id),te=_.useProgram("heatmap",Z),ue=_.style.map.terrain.getTerrainData(d);te.draw(p,y.TRIANGLES,Mn.disabled,P,A,Qn.disabled,Vi(d.posMatrix,e,_.transform.zoom,o.paint.get("heatmap-intensity")),ue,o.id,D.layoutVertexBuffer,D.indexBuffer,D.segments,o.paint,_.transform.zoom,Z)}function Fa(_,e,o){const d=_.context,p=d.gl;d.setColorMode(_.colorModeForRenderPass());const y=so(d,e),P=o.key,A=e.heatmapFbos.get(P);A&&(d.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,A.colorAttachment.get()),d.activeTexture.set(p.TEXTURE1),y.bind(p.LINEAR,p.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(d,p.TRIANGLES,Mn.disabled,oi.disabled,_.colorModeForRenderPass(),Qn.disabled,Na(_,e,0,1),null,e.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments,e.paint,_.transform.zoom),A.destroy(),e.heatmapFbos.delete(P))}function ro(_,e,o){var d,p;const y=_.gl,P=y.createTexture();y.bindTexture(y.TEXTURE_2D,P),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const A=(d=_.HALF_FLOAT)!==null&&d!==void 0?d:y.UNSIGNED_BYTE,D=(p=_.RGBA16F)!==null&&p!==void 0?p:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,D,e,o,0,y.RGBA,A,null);const V=_.createFramebuffer(e,o,!1,!1);return V.colorAttachment.set(P),V}function so(_,e){return e.colorRampTexture||(e.colorRampTexture=new wt(_,e.colorRamp,_.gl.RGBA)),e.colorRampTexture}function Fs(_,e,o,d,p){if(!o||!d||!d.imageAtlas)return;const y=d.imageAtlas.patternPositions;let P=y[o.to.toString()],A=y[o.from.toString()];if(!P&&A&&(P=A),!A&&P&&(A=P),!P||!A){const D=p.getPaintProperty(e);P=y[D],A=y[D]}P&&A&&_.setConstantPatternPositions(P,A)}function Bs(_,e,o,d,p,y,P){const A=_.context.gl,D="fill-pattern",V=o.paint.get(D),$=V&&V.constantOr(1),Z=o.getCrossfadeParameters();let te,ue,he,pe,ge;P?(ue=$&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",te=A.LINES):(ue=$?"fillPattern":"fill",te=A.TRIANGLES);const ve=V.constantOr(null);for(const Se of d){const me=e.getTile(Se);if($&&!me.patternsLoaded())continue;const Ae=me.getBucket(o);if(!Ae)continue;const Oe=Ae.programConfigurations.get(o.id),qe=_.useProgram(ue,Oe),ot=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Se);$&&(_.context.activeTexture.set(A.TEXTURE0),me.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Oe.updatePaintBuffers(Z)),Fs(Oe,D,ve,me,o);const yt=ot?Se:null,St=_.translatePosMatrix(yt?yt.posMatrix:Se.posMatrix,me,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(P){pe=Ae.indexBuffer2,ge=Ae.segments2;const Lt=[A.drawingBufferWidth,A.drawingBufferHeight];he=ue==="fillOutlinePattern"&&$?Rs(St,_,Z,me,Lt):mi(St,Lt)}else pe=Ae.indexBuffer,ge=Ae.segments,he=$?Yo(St,_,Z,me):Ka(St);qe.draw(_.context,te,p,_.stencilModeForClipping(Se),y,Qn.disabled,he,ot,o.id,Ae.layoutVertexBuffer,pe,ge,o.paint,_.transform.zoom,Oe)}}function zo(_,e,o,d,p,y,P){const A=_.context,D=A.gl,V="fill-extrusion-pattern",$=o.paint.get(V),Z=$.constantOr(1),te=o.getCrossfadeParameters(),ue=o.paint.get("fill-extrusion-opacity"),he=$.constantOr(null);for(const pe of d){const ge=e.getTile(pe),ve=ge.getBucket(o);if(!ve)continue;const Se=_.style.map.terrain&&_.style.map.terrain.getTerrainData(pe),me=ve.programConfigurations.get(o.id),Ae=_.useProgram(Z?"fillExtrusionPattern":"fillExtrusion",me);Z&&(_.context.activeTexture.set(D.TEXTURE0),ge.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),me.updatePaintBuffers(te)),Fs(me,V,he,ge,o);const Oe=_.translatePosMatrix(pe.posMatrix,ge,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),qe=o.paint.get("fill-extrusion-vertical-gradient"),ot=Z?Ya(Oe,_,qe,ue,pe,te,ge):Ao(Oe,_,qe,ue);Ae.draw(A,A.gl.TRIANGLES,p,y,P,Qn.backCCW,ot,Se,o.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,o.paint,_.transform.zoom,me,_.style.map.terrain&&ve.centroidVertexBuffer)}}function fa(_,e,o,d,p,y,P){const A=_.context,D=A.gl,V=o.fbo;if(!V)return;const $=_.useProgram("hillshade"),Z=_.style.map.terrain&&_.style.map.terrain.getTerrainData(e);A.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,V.colorAttachment.get()),$.draw(A,D.TRIANGLES,p,y,P,Qn.disabled,((te,ue,he,pe)=>{const ge=he.paint.get("hillshade-shadow-color"),ve=he.paint.get("hillshade-highlight-color"),Se=he.paint.get("hillshade-accent-color");let me=he.paint.get("hillshade-illumination-direction")*(Math.PI/180);he.paint.get("hillshade-illumination-anchor")==="viewport"&&(me-=te.transform.angle);const Ae=!te.options.moving;return{u_matrix:pe?pe.posMatrix:te.transform.calculatePosMatrix(ue.tileID.toUnwrapped(),Ae),u_image:0,u_latrange:gs(0,ue.tileID),u_light:[he.paint.get("hillshade-exaggeration"),me],u_shadow:ge,u_highlight:ve,u_accent:Se}})(_,o,d,Z?e:null),Z,d.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}function ao(_,e,o,d,p,y){const P=_.context,A=P.gl,D=e.dem;if(D&&D.data){const V=D.dim,$=D.stride,Z=D.getPixels();if(P.activeTexture.set(A.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||_.getTileTexture($),e.demTexture){const ue=e.demTexture;ue.update(Z,{premultiply:!1}),ue.bind(A.NEAREST,A.CLAMP_TO_EDGE)}else e.demTexture=new wt(P,Z,A.RGBA,{premultiply:!1}),e.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);P.activeTexture.set(A.TEXTURE0);let te=e.fbo;if(!te){const ue=new wt(P,{width:V,height:V,data:null},A.RGBA);ue.bind(A.LINEAR,A.CLAMP_TO_EDGE),te=e.fbo=P.createFramebuffer(V,V,!0,!1),te.colorAttachment.set(ue.texture)}P.bindFramebuffer.set(te.framebuffer),P.viewport.set([0,0,V,V]),_.useProgram("hillshadePrepare").draw(P,A.TRIANGLES,d,p,y,Qn.disabled,((ue,he)=>{const pe=he.stride,ge=c.H();return c.aP(ge,0,c.X,-c.X,0,0,1),c.J(ge,ge,[0,-c.X,0]),{u_matrix:ge,u_image:1,u_dimension:[pe,pe],u_zoom:ue.overscaledZ,u_unpack:he.getUnpackVector()}})(e.tileID,D),null,o.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Ml(_,e,o,d,p,y){const P=d.paint.get("raster-fade-duration");if(!y&&P>0){const A=F.now(),D=(A-_.timeAdded)/P,V=e?(A-e.timeAdded)/P:-1,$=o.getSource(),Z=p.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),te=!e||Math.abs(e.tileID.overscaledZ-Z)>Math.abs(_.tileID.overscaledZ-Z),ue=te&&_.refreshedUponExpiration?1:c.ac(te?D:1-V,0,1);return _.refreshedUponExpiration&&D>=1&&(_.refreshedUponExpiration=!1),e?{opacity:1,mix:1-ue}:{opacity:ue,mix:0}}return{opacity:1,mix:0}}const sl=new c.aM(1,0,0,1),jn=new c.aM(0,1,0,1),js=new c.aM(0,0,1,1),Fu=new c.aM(1,0,1,1),Al=new c.aM(0,1,1,1);function ar(_,e,o,d){f(_,0,e+o/2,_.transform.width,o,d)}function vs(_,e,o,d){f(_,e-o/2,0,o,_.transform.height,d)}function f(_,e,o,d,p,y){const P=_.context,A=P.gl;A.enable(A.SCISSOR_TEST),A.scissor(e*_.pixelRatio,o*_.pixelRatio,d*_.pixelRatio,p*_.pixelRatio),P.clear({color:y}),A.disable(A.SCISSOR_TEST)}function i(_,e,o){const d=_.context,p=d.gl,y=o.posMatrix,P=_.useProgram("debug"),A=Mn.disabled,D=oi.disabled,V=_.colorModeForRenderPass(),$="$debug",Z=_.style.map.terrain&&_.style.map.terrain.getTerrainData(o);d.activeTexture.set(p.TEXTURE0);const te=e.getTileByID(o.key).latestRawTileData,ue=Math.floor((te&&te.byteLength||0)/1024),he=e.getTile(o).tileSize,pe=512/Math.min(he,512)*(o.overscaledZ/_.transform.zoom)*.5;let ge=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(ge+=` => ${o.overscaledZ}`),(function(ve,Se){ve.initDebugOverlayCanvas();const me=ve.debugOverlayCanvas,Ae=ve.context.gl,Oe=ve.debugOverlayCanvas.getContext("2d");Oe.clearRect(0,0,me.width,me.height),Oe.shadowColor="white",Oe.shadowBlur=2,Oe.lineWidth=1.5,Oe.strokeStyle="white",Oe.textBaseline="top",Oe.font="bold 36px Open Sans, sans-serif",Oe.fillText(Se,5,5),Oe.strokeText(Se,5,5),ve.debugOverlayTexture.update(me),ve.debugOverlayTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE)})(_,`${ge} ${ue}kB`),P.draw(d,p.TRIANGLES,A,D,Ni.alphaBlended,Qn.disabled,Ti(y,c.aM.transparent,pe),null,$,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),P.draw(d,p.LINE_STRIP,A,D,V,Qn.disabled,Ti(y,c.aM.red),Z,$,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function s(_,e,o){const d=_.context,p=d.gl,y=_.colorModeForRenderPass(),P=new Mn(p.LEQUAL,Mn.ReadWrite,_.depthRangeFor3D),A=_.useProgram("terrain"),D=e.getTerrainMesh();d.bindFramebuffer.set(null),d.viewport.set([0,0,_.width,_.height]);for(const V of o){const $=_.renderToTexture.getTexture(V),Z=e.getTerrainData(V.tileID);d.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,$.texture);const te=_.transform.calculatePosMatrix(V.tileID.toUnwrapped()),ue=e.getMeshFrameDelta(_.transform.zoom),he=_.transform.calculateFogMatrix(V.tileID.toUnwrapped()),pe=au(te,ue,he,_.style.sky,_.transform.pitch);A.draw(d,p.TRIANGLES,P,oi.disabled,y,Qn.backCCW,pe,Z,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}}class h{constructor(e,o,d){this.vertexBuffer=e,this.indexBuffer=o,this.segments=d}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class b{constructor(e,o){this.context=new pc(e),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=pt.maxUnderzooming+pt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ls}resize(e,o,d){if(this.width=Math.floor(e*d),this.height=Math.floor(o*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const e=this.context,o=new c.aX;o.emplaceBack(0,0),o.emplaceBack(c.X,0),o.emplaceBack(0,c.X),o.emplaceBack(c.X,c.X),this.tileExtentBuffer=e.createVertexBuffer(o,Nr.members),this.tileExtentSegments=c.a0.simpleSegment(0,0,4,2);const d=new c.aX;d.emplaceBack(0,0),d.emplaceBack(c.X,0),d.emplaceBack(0,c.X),d.emplaceBack(c.X,c.X),this.debugBuffer=e.createVertexBuffer(d,Nr.members),this.debugSegments=c.a0.simpleSegment(0,0,4,5);const p=new c.$;p.emplaceBack(0,0,0,0),p.emplaceBack(c.X,0,c.X,0),p.emplaceBack(0,c.X,0,c.X),p.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=e.createVertexBuffer(p,pr.members),this.rasterBoundsSegments=c.a0.simpleSegment(0,0,4,2);const y=new c.aX;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,Nr.members),this.viewportSegments=c.a0.simpleSegment(0,0,4,2);const P=new c.aZ;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(P);const A=new c.aY;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(A);const D=this.context.gl;this.stencilClearMode=new oi({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO)}clearStencil(){const e=this.context,o=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=c.H();c.aP(d,0,this.width,this.height,0,0,1),c.K(d,d,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,o.TRIANGLES,Mn.disabled,this.stencilClearMode,Ni.disabled,Qn.disabled,Yn(d),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,o){if(this.currentStencilSource===e.source||!e.isTileClipped()||!o||!o.length)return;this.currentStencilSource=e.source;const d=this.context,p=d.gl;this.nextStencilID+o.length>256&&this.clearStencil(),d.setColorMode(Ni.disabled),d.setDepthMode(Mn.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of o){const A=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P);y.draw(d,p.TRIANGLES,Mn.disabled,new oi({func:p.ALWAYS,mask:0},A,255,p.KEEP,p.KEEP,p.REPLACE),Ni.disabled,Qn.disabled,Yn(P.posMatrix),D,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,o=this.context.gl;return new oi({func:o.NOTEQUAL,mask:255},e,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(e){const o=this.context.gl;return new oi({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(e){const o=this.context.gl,d=e.sort(((P,A)=>A.overscaledZ-P.overscaledZ)),p=d[d.length-1].overscaledZ,y=d[0].overscaledZ-p+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const P={};for(let A=0;A<y;A++)P[A+p]=new oi({func:o.GEQUAL,mask:255},A+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=y,[P,d]}return[{[p]:oi.disabled},d]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Ni([e.CONSTANT_COLOR,e.ONE],new c.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ni.unblended:Ni.alphaBlended}depthModeForSublayer(e,o,d){if(!this.opaquePassEnabledForLayer())return Mn.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Mn(d||this.context.gl.LEQUAL,o,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,o){this.style=e,this.options=o,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(F.now()),this.imageManager.beginFrame();const d=this.style._order,p=this.style.sourceCaches,y={},P={},A={};for(const D in p){const V=p[D];V.used&&V.prepare(this.context),y[D]=V.getVisibleCoordinates(),P[D]=y[D].slice().reverse(),A[D]=V.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<d.length;D++)if(this.style._layers[d[D]].is3D()){this.opaquePassCutoff=D;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const D of d){const V=this.style._layers[D];if(!V.hasOffscreenPass()||V.isHidden(this.transform.zoom))continue;const $=P[V.source];(V.type==="custom"||$.length)&&this.renderLayer(this,p[V.source],V,$)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?c.aM.black:c.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(D,V){const $=D.context,Z=$.gl,te=((ve,Se,me)=>({u_sky_color:ve.properties.get("sky-color"),u_horizon_color:ve.properties.get("horizon-color"),u_horizon:(Se.height/2+Se.getHorizon())*me,u_sky_horizon_blend:ve.properties.get("sky-horizon-blend")*Se.height/2*me}))(V,D.style.map.transform,D.pixelRatio),ue=new Mn(Z.LEQUAL,Mn.ReadWrite,[0,1]),he=oi.disabled,pe=D.colorModeForRenderPass(),ge=D.useProgram("sky");if(!V.mesh){const ve=new c.aX;ve.emplaceBack(-1,-1),ve.emplaceBack(1,-1),ve.emplaceBack(1,1),ve.emplaceBack(-1,1);const Se=new c.aY;Se.emplaceBack(0,1,2),Se.emplaceBack(0,2,3),V.mesh=new h($.createVertexBuffer(ve,Nr.members),$.createIndexBuffer(Se),c.a0.simpleSegment(0,0,ve.length,Se.length))}ge.draw($,Z.TRIANGLES,ue,he,pe,Qn.disabled,te,void 0,"sky",V.mesh.vertexBuffer,V.mesh.indexBuffer,V.mesh.segments)})(this,this.style.sky),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[d[this.currentLayer]],V=p[D.source],$=y[D.source];this._renderTileClippingMasks(D,$),this.renderLayer(this,V,D,$)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const D=this.style._layers[d[this.currentLayer]],V=p[D.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(D))continue;const $=(D.type==="symbol"?A:P)[D.source];this._renderTileClippingMasks(D,y[D.source]),this.renderLayer(this,V,D,$)}if(this.options.showTileBoundaries){const D=(function(V,$){let Z=null;const te=Object.values(V._layers).flatMap((ge=>ge.source&&!ge.isHidden($)?[V.sourceCaches[ge.source]]:[])),ue=te.filter((ge=>ge.getSource().type==="vector")),he=te.filter((ge=>ge.getSource().type!=="vector")),pe=ge=>{(!Z||Z.getSource().maxzoom<ge.getSource().maxzoom)&&(Z=ge)};return ue.forEach((ge=>pe(ge))),Z||he.forEach((ge=>pe(ge))),Z})(this.style,this.transform.zoom);D&&(function(V,$,Z){for(let te=0;te<Z.length;te++)i(V,$,Z[te])})(this,D,D.getVisibleCoordinates())}this.options.showPadding&&(function(D){const V=D.transform.padding;ar(D,D.transform.height-(V.top||0),3,sl),ar(D,V.bottom||0,3,jn),vs(D,V.left||0,3,js),vs(D,D.transform.width-(V.right||0),3,Fu);const $=D.transform.centerPoint;(function(Z,te,ue,he){f(Z,te-1,ue-10,2,20,he),f(Z,te-10,ue-1,20,2,he)})(D,$.x,D.transform.height-$.y,Al)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,d=this.transform.modelViewProjectionMatrix;let p=this.terrainFacilitator.dirty;p||(p=e?!c.a_(o,d):!c.a$(o,d)),p||(p=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),p&&(c.b0(o,d),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(y,P){const A=y.context,D=A.gl,V=Ni.unblended,$=new Mn(D.LEQUAL,Mn.ReadWrite,[0,1]),Z=P.getTerrainMesh(),te=P.sourceCache.getRenderableTiles(),ue=y.useProgram("terrainDepth");A.bindFramebuffer.set(P.getFramebuffer("depth").framebuffer),A.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),A.clear({color:c.aM.transparent,depth:1});for(const he of te){const pe=P.getTerrainData(he.tileID),ge={u_matrix:y.transform.calculatePosMatrix(he.tileID.toUnwrapped()),u_ele_delta:P.getMeshFrameDelta(y.transform.zoom)};ue.draw(A,D.TRIANGLES,$,oi.disabled,V,Qn.backCCW,ge,pe,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}A.bindFramebuffer.set(null),A.viewport.set([0,0,y.width,y.height])})(this,this.style.map.terrain),(function(y,P){const A=y.context,D=A.gl,V=Ni.unblended,$=new Mn(D.LEQUAL,Mn.ReadWrite,[0,1]),Z=P.getTerrainMesh(),te=P.getCoordsTexture(),ue=P.sourceCache.getRenderableTiles(),he=y.useProgram("terrainCoords");A.bindFramebuffer.set(P.getFramebuffer("coords").framebuffer),A.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),A.clear({color:c.aM.transparent,depth:1}),P.coordsIndex=[];for(const pe of ue){const ge=P.getTerrainData(pe.tileID);A.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,te.texture);const ve={u_matrix:y.transform.calculatePosMatrix(pe.tileID.toUnwrapped()),u_terrain_coords_id:(255-P.coordsIndex.length)/255,u_texture:0,u_ele_delta:P.getMeshFrameDelta(y.transform.zoom)};he.draw(A,D.TRIANGLES,$,oi.disabled,V,Qn.backCCW,ve,ge,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments),P.coordsIndex.push(pe.tileID.key)}A.bindFramebuffer.set(null),A.viewport.set([0,0,y.width,y.height])})(this,this.style.map.terrain))}renderLayer(e,o,d,p){if(!d.isHidden(this.transform.zoom)&&(d.type==="background"||d.type==="custom"||(p||[]).length))switch(this.id=d.id,d.type){case"symbol":(function(y,P,A,D,V){if(y.renderPass!=="translucent")return;const $=oi.disabled,Z=y.colorModeForRenderPass();(A._unevaluatedLayout.hasValue("text-variable-anchor")||A._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(te,ue,he,pe,ge,ve,Se,me,Ae){const Oe=ue.transform,qe=Qr(),ot=ge==="map",yt=ve==="map";for(const St of te){const Lt=pe.getTile(St),Et=Lt.getBucket(he);if(!Et||!Et.text||!Et.text.segments.get().length)continue;const kt=c.ag(Et.textSizeData,Oe.zoom),qt=Sn(Lt,1,ue.transform.zoom),gn=Ai(St.posMatrix,yt,ot,ue.transform,qt),It=he.layout.get("icon-text-fit")!=="none"&&Et.hasIconData();if(kt){const Ct=Math.pow(2,Oe.zoom-Lt.tileID.overscaledZ),mn=ue.style.map.terrain?(En,Pn)=>ue.style.map.terrain.getElevation(St,En,Pn):null,li=qe.translatePosition(Oe,Lt,Se,me);io(Et,ot,yt,Ae,Oe,gn,St.posMatrix,Ct,kt,It,qe,li,St.toUnwrapped(),mn)}}})(D,y,A,P,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),V),A.paint.get("icon-opacity").constantOr(1)!==0&&Oa(y,P,A,D,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),$,Z),A.paint.get("text-opacity").constantOr(1)!==0&&Oa(y,P,A,D,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),$,Z),P.map.showCollisionBoxes&&(rl(y,P,A,D,!0),rl(y,P,A,D,!1))})(e,o,d,p,this.style.placement.variableOffsets);break;case"circle":(function(y,P,A,D){if(y.renderPass!=="translucent")return;const V=A.paint.get("circle-opacity"),$=A.paint.get("circle-stroke-width"),Z=A.paint.get("circle-stroke-opacity"),te=!A.layout.get("circle-sort-key").isConstant();if(V.constantOr(1)===0&&($.constantOr(1)===0||Z.constantOr(1)===0))return;const ue=y.context,he=ue.gl,pe=y.depthModeForSublayer(0,Mn.ReadOnly),ge=oi.disabled,ve=y.colorModeForRenderPass(),Se=[];for(let me=0;me<D.length;me++){const Ae=D[me],Oe=P.getTile(Ae),qe=Oe.getBucket(A);if(!qe)continue;const ot=qe.programConfigurations.get(A.id),yt=y.useProgram("circle",ot),St=qe.layoutVertexBuffer,Lt=qe.indexBuffer,Et=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ae),kt={programConfiguration:ot,program:yt,layoutVertexBuffer:St,indexBuffer:Lt,uniformValues:yl(y,Ae,Oe,A),terrainData:Et};if(te){const qt=qe.segments.get();for(const gn of qt)Se.push({segments:new c.a0([gn]),sortKey:gn.sortKey,state:kt})}else Se.push({segments:qe.segments,sortKey:0,state:kt})}te&&Se.sort(((me,Ae)=>me.sortKey-Ae.sortKey));for(const me of Se){const{programConfiguration:Ae,program:Oe,layoutVertexBuffer:qe,indexBuffer:ot,uniformValues:yt,terrainData:St}=me.state;Oe.draw(ue,he.TRIANGLES,pe,ge,ve,Qn.disabled,yt,St,A.id,qe,ot,me.segments,A.paint,y.transform.zoom,Ae)}})(e,o,d,p);break;case"heatmap":(function(y,P,A,D){if(A.paint.get("heatmap-opacity")===0)return;const V=y.context;if(y.style.map.terrain){for(const $ of D){const Z=P.getTile($);P.hasRenderableParent($)||(y.renderPass==="offscreen"?cu(y,Z,A,$):y.renderPass==="translucent"&&Fa(y,A,$))}V.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?(function($,Z,te,ue){const he=$.context,pe=he.gl,ge=oi.disabled,ve=new Ni([pe.ONE,pe.ONE],c.aM.transparent,[!0,!0,!0,!0]);(function(Se,me,Ae){const Oe=Se.gl;Se.activeTexture.set(Oe.TEXTURE1),Se.viewport.set([0,0,me.width/4,me.height/4]);let qe=Ae.heatmapFbos.get(c.aU);qe?(Oe.bindTexture(Oe.TEXTURE_2D,qe.colorAttachment.get()),Se.bindFramebuffer.set(qe.framebuffer)):(qe=ro(Se,me.width/4,me.height/4),Ae.heatmapFbos.set(c.aU,qe))})(he,$,te),he.clear({color:c.aM.transparent});for(let Se=0;Se<ue.length;Se++){const me=ue[Se];if(Z.hasRenderableParent(me))continue;const Ae=Z.getTile(me),Oe=Ae.getBucket(te);if(!Oe)continue;const qe=Oe.programConfigurations.get(te.id),ot=$.useProgram("heatmap",qe),{zoom:yt}=$.transform;ot.draw(he,pe.TRIANGLES,Mn.disabled,ge,ve,Qn.disabled,Vi(me.posMatrix,Ae,yt,te.paint.get("heatmap-intensity")),null,te.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,te.paint,$.transform.zoom,qe)}he.viewport.set([0,0,$.width,$.height])})(y,P,A,D):y.renderPass==="translucent"&&(function($,Z){const te=$.context,ue=te.gl;te.setColorMode($.colorModeForRenderPass());const he=Z.heatmapFbos.get(c.aU);he&&(te.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_2D,he.colorAttachment.get()),te.activeTexture.set(ue.TEXTURE1),so(te,Z).bind(ue.LINEAR,ue.CLAMP_TO_EDGE),$.useProgram("heatmapTexture").draw(te,ue.TRIANGLES,Mn.disabled,oi.disabled,$.colorModeForRenderPass(),Qn.disabled,Na($,Z,0,1),null,Z.id,$.viewportBuffer,$.quadTriangleIndexBuffer,$.viewportSegments,Z.paint,$.transform.zoom))})(y,A)})(e,o,d,p);break;case"line":(function(y,P,A,D){if(y.renderPass!=="translucent")return;const V=A.paint.get("line-opacity"),$=A.paint.get("line-width");if(V.constantOr(1)===0||$.constantOr(1)===0)return;const Z=y.depthModeForSublayer(0,Mn.ReadOnly),te=y.colorModeForRenderPass(),ue=A.paint.get("line-dasharray"),he=A.paint.get("line-pattern"),pe=he.constantOr(1),ge=A.paint.get("line-gradient"),ve=A.getCrossfadeParameters(),Se=pe?"linePattern":ue?"lineSDF":ge?"lineGradient":"line",me=y.context,Ae=me.gl;let Oe=!0;for(const qe of D){const ot=P.getTile(qe);if(pe&&!ot.patternsLoaded())continue;const yt=ot.getBucket(A);if(!yt)continue;const St=yt.programConfigurations.get(A.id),Lt=y.context.program.get(),Et=y.useProgram(Se,St),kt=Oe||Et.program!==Lt,qt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(qe),gn=he.constantOr(null);if(gn&&ot.imageAtlas){const mn=ot.imageAtlas,li=mn.patternPositions[gn.to.toString()],En=mn.patternPositions[gn.from.toString()];li&&En&&St.setConstantPatternPositions(li,En)}const It=qt?qe:null,Ct=pe?Ns(y,ot,A,ve,It):ue?Lu(y,ot,A,ue,ve,It):ge?Lo(y,ot,A,yt.lineClipsArray.length,It):Ko(y,ot,A,It);if(pe)me.activeTexture.set(Ae.TEXTURE0),ot.imageAtlasTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),St.updatePaintBuffers(ve);else if(ue&&(kt||y.lineAtlas.dirty))me.activeTexture.set(Ae.TEXTURE0),y.lineAtlas.bind(me);else if(ge){const mn=yt.gradients[A.id];let li=mn.texture;if(A.gradientVersion!==mn.version){let En=256;if(A.stepInterpolant){const Pn=P.getSource().maxzoom,ci=qe.canonical.z===Pn?Math.ceil(1<<y.transform.maxZoom-qe.canonical.z):1;En=c.ac(c.aV(yt.maxLineLength/c.X*1024*ci),256,me.maxTextureSize)}mn.gradient=c.aW({expression:A.gradientExpression(),evaluationKey:"lineProgress",resolution:En,image:mn.gradient||void 0,clips:yt.lineClipsArray}),mn.texture?mn.texture.update(mn.gradient):mn.texture=new wt(me,mn.gradient,Ae.RGBA),mn.version=A.gradientVersion,li=mn.texture}me.activeTexture.set(Ae.TEXTURE0),li.bind(A.stepInterpolant?Ae.NEAREST:Ae.LINEAR,Ae.CLAMP_TO_EDGE)}Et.draw(me,Ae.TRIANGLES,Z,y.stencilModeForClipping(qe),te,Qn.disabled,Ct,qt,A.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,A.paint,y.transform.zoom,St,yt.layoutVertexBuffer2),Oe=!1}})(e,o,d,p);break;case"fill":(function(y,P,A,D){const V=A.paint.get("fill-color"),$=A.paint.get("fill-opacity");if($.constantOr(1)===0)return;const Z=y.colorModeForRenderPass(),te=A.paint.get("fill-pattern"),ue=y.opaquePassEnabledForLayer()&&!te.constantOr(1)&&V.constantOr(c.aM.transparent).a===1&&$.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===ue){const he=y.depthModeForSublayer(1,y.renderPass==="opaque"?Mn.ReadWrite:Mn.ReadOnly);Bs(y,P,A,D,he,Z,!1)}if(y.renderPass==="translucent"&&A.paint.get("fill-antialias")){const he=y.depthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,Mn.ReadOnly);Bs(y,P,A,D,he,Z,!0)}})(e,o,d,p);break;case"fill-extrusion":(function(y,P,A,D){const V=A.paint.get("fill-extrusion-opacity");if(V!==0&&y.renderPass==="translucent"){const $=new Mn(y.context.gl.LEQUAL,Mn.ReadWrite,y.depthRangeFor3D);if(V!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))zo(y,P,A,D,$,oi.disabled,Ni.disabled),zo(y,P,A,D,$,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const Z=y.colorModeForRenderPass();zo(y,P,A,D,$,oi.disabled,Z)}}})(e,o,d,p);break;case"hillshade":(function(y,P,A,D){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const V=y.context,$=y.depthModeForSublayer(0,Mn.ReadOnly),Z=y.colorModeForRenderPass(),[te,ue]=y.renderPass==="translucent"?y.stencilConfigForOverlap(D):[{},D];for(const he of ue){const pe=P.getTile(he);pe.needsHillshadePrepare!==void 0&&pe.needsHillshadePrepare&&y.renderPass==="offscreen"?ao(y,pe,A,$,oi.disabled,Z):y.renderPass==="translucent"&&fa(y,he,pe,A,$,te[he.overscaledZ],Z)}V.viewport.set([0,0,y.width,y.height])})(e,o,d,p);break;case"raster":(function(y,P,A,D){if(y.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!D.length)return;const V=y.context,$=V.gl,Z=P.getSource(),te=y.useProgram("raster"),ue=y.colorModeForRenderPass(),[he,pe]=Z instanceof As?[{},D]:y.stencilConfigForOverlap(D),ge=pe[pe.length-1].overscaledZ,ve=!y.options.moving;for(const Se of pe){const me=y.depthModeForSublayer(Se.overscaledZ-ge,A.paint.get("raster-opacity")===1?Mn.ReadWrite:Mn.ReadOnly,$.LESS),Ae=P.getTile(Se);Ae.registerFadeDuration(A.paint.get("raster-fade-duration"));const Oe=P.findLoadedParent(Se,0),qe=P.findLoadedSibling(Se),ot=Ml(Ae,Oe||qe||null,P,A,y.transform,y.style.map.terrain);let yt,St;const Lt=A.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR;V.activeTexture.set($.TEXTURE0),Ae.texture.bind(Lt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),V.activeTexture.set($.TEXTURE1),Oe?(Oe.texture.bind(Lt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),yt=Math.pow(2,Oe.tileID.overscaledZ-Ae.tileID.overscaledZ),St=[Ae.tileID.canonical.x*yt%1,Ae.tileID.canonical.y*yt%1]):Ae.texture.bind(Lt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),Ae.texture.useMipmap&&V.extTextureFilterAnisotropic&&y.transform.pitch>20&&$.texParameterf($.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const Et=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Se),kt=Et?Se:null,qt=kt?kt.posMatrix:y.transform.calculatePosMatrix(Se.toUnwrapped(),ve),gn=_l(qt,St||[0,0],yt||1,ot,A);Z instanceof As?te.draw(V,$.TRIANGLES,me,oi.disabled,ue,Qn.disabled,gn,Et,A.id,Z.boundsBuffer,y.quadTriangleIndexBuffer,Z.boundsSegments):te.draw(V,$.TRIANGLES,me,he[Se.overscaledZ],ue,Qn.disabled,gn,Et,A.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(e,o,d,p);break;case"background":(function(y,P,A,D){const V=A.paint.get("background-color"),$=A.paint.get("background-opacity");if($===0)return;const Z=y.context,te=Z.gl,ue=y.transform,he=ue.tileSize,pe=A.paint.get("background-pattern");if(y.isPatternMissing(pe))return;const ge=!pe&&V.a===1&&$===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ge)return;const ve=oi.disabled,Se=y.depthModeForSublayer(0,ge==="opaque"?Mn.ReadWrite:Mn.ReadOnly),me=y.colorModeForRenderPass(),Ae=y.useProgram(pe?"backgroundPattern":"background"),Oe=D||ue.coveringTiles({tileSize:he,terrain:y.style.map.terrain});pe&&(Z.activeTexture.set(te.TEXTURE0),y.imageManager.bind(y.context));const qe=A.getCrossfadeParameters();for(const ot of Oe){const yt=D?ot.posMatrix:y.transform.calculatePosMatrix(ot.toUnwrapped()),St=pe?Jo(yt,$,y,pe,{tileID:ot,tileSize:he},qe):za(yt,$,V),Lt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ot);Ae.draw(Z,te.TRIANGLES,Se,ve,me,Qn.disabled,St,Lt,A.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(e,0,d,p);break;case"custom":(function(y,P,A){const D=y.context,V=A.implementation;if(y.renderPass==="offscreen"){const $=V.prerender;$&&(y.setCustomLayerDefaults(),D.setColorMode(y.colorModeForRenderPass()),$.call(V,D.gl,y.transform.customLayerMatrix()),D.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),D.setColorMode(y.colorModeForRenderPass()),D.setStencilMode(oi.disabled);const $=V.renderingMode==="3d"?new Mn(y.context.gl.LEQUAL,Mn.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,Mn.ReadOnly);D.setDepthMode($),V.render(D.gl,y.transform.customLayerMatrix(),{farZ:y.transform.farZ,nearZ:y.transform.nearZ,fov:y.transform._fov,modelViewProjectionMatrix:y.transform.modelViewProjectionMatrix,projectionMatrix:y.transform.projectionMatrix}),D.setDirty(),y.setBaseState(),D.bindFramebuffer.set(null)}})(e,0,d)}}translatePosMatrix(e,o,d,p,y){if(!d[0]&&!d[1])return e;const P=y?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(P){const V=Math.sin(P),$=Math.cos(P);d=[d[0]*$-d[1]*V,d[0]*V+d[1]*$]}const A=[y?d[0]:Sn(o,d[0],this.transform.zoom),y?d[1]:Sn(o,d[1],this.transform.zoom),0],D=new Float32Array(16);return c.J(D,e,A),D}saveTileTexture(e){const o=this._tileTextures[e.size[0]];o?o.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const o=this._tileTextures[e];return o&&o.length>0?o.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const o=this.imageManager.getPattern(e.from.toString()),d=this.imageManager.getPattern(e.to.toString());return!o||!d}useProgram(e,o){this.cache=this.cache||{};const d=e+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[d]||(this.cache[d]=new qn(this.context,la[e],o,vl[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new wt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:o}=this.context.gl;return this.width!==e||this.height!==o}}class R{constructor(e,o){this.points=e,this.planes=o}static fromInvProjectionMatrix(e,o,d){const p=Math.pow(2,d),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((A=>{const D=1/(A=c.af([],A,e))[3]/o*p;return c.b1(A,A,[D,D,1/A[3],D])})),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((A=>{const D=(function(te,ue){var he=ue[0],pe=ue[1],ge=ue[2],ve=he*he+pe*pe+ge*ge;return ve>0&&(ve=1/Math.sqrt(ve)),te[0]=ue[0]*ve,te[1]=ue[1]*ve,te[2]=ue[2]*ve,te})([],(function(te,ue,he){var pe=ue[0],ge=ue[1],ve=ue[2],Se=he[0],me=he[1],Ae=he[2];return te[0]=ge*Ae-ve*me,te[1]=ve*Se-pe*Ae,te[2]=pe*me-ge*Se,te})([],at([],y[A[0]],y[A[1]]),at([],y[A[2]],y[A[1]]))),V=-(($=D)[0]*(Z=y[A[1]])[0]+$[1]*Z[1]+$[2]*Z[2]);var $,Z;return D.concat(V)}));return new R(y,P)}}class B{constructor(e,o){this.min=e,this.max=o,this.center=(function(d,p,y){return d[0]=.5*p[0],d[1]=.5*p[1],d[2]=.5*p[2],d})([],(function(d,p,y){return d[0]=p[0]+y[0],d[1]=p[1]+y[1],d[2]=p[2]+y[2],d})([],this.min,this.max))}quadrant(e){const o=[e%2==0,e<2],d=We(this.min),p=We(this.max);for(let y=0;y<o.length;y++)d[y]=o[y]?this.min[y]:this.center[y],p[y]=o[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new B(d,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let d=!0;for(let p=0;p<e.planes.length;p++){const y=e.planes[p];let P=0;for(let A=0;A<o.length;A++)c.b2(y,o[A])>=0&&P++;if(P===0)return 0;P!==o.length&&(d=!1)}if(d)return 2;for(let p=0;p<3;p++){let y=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let A=0;A<e.points.length;A++){const D=e.points[A][p]-this.min[p];y=Math.min(y,D),P=Math.max(P,D)}if(P<0||y>this.max[p]-this.min[p])return 0}return 1}}class H{constructor(e=0,o=0,d=0,p=0){if(isNaN(e)||e<0||isNaN(o)||o<0||isNaN(d)||d<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=o,this.left=d,this.right=p}interpolate(e,o,d){return o.top!=null&&e.top!=null&&(this.top=c.y.number(e.top,o.top,d)),o.bottom!=null&&e.bottom!=null&&(this.bottom=c.y.number(e.bottom,o.bottom,d)),o.left!=null&&e.left!=null&&(this.left=c.y.number(e.left,o.left,d)),o.right!=null&&e.right!=null&&(this.right=c.y.number(e.right,o.right,d)),this}getCenter(e,o){const d=c.ac((this.left+e-this.right)/2,0,e),p=c.ac((this.top+o-this.bottom)/2,0,o);return new c.P(d,p)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new H(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const re=85.051129;class de{constructor(e,o,d,p,y){this.tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=e||0,this._maxZoom=o||22,this._minPitch=d??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new H,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new de(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const o=-c.b3(e,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=(function(){var d=new c.A(4);return c.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d})(),(function(d,p,y){var P=p[0],A=p[1],D=p[2],V=p[3],$=Math.sin(y),Z=Math.cos(y);d[0]=P*Z+D*$,d[1]=A*Z+V*$,d[2]=P*-$+D*Z,d[3]=A*-$+V*Z})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const o=c.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const o=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,o,d){this._unmodified=!1,this._edgeInsets.interpolate(e,o,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const o=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(e){const o=[new c.b4(0,e)];if(this._renderWorldCopies){const d=this.pointCoordinate(new c.P(0,0)),p=this.pointCoordinate(new c.P(this.width,0)),y=this.pointCoordinate(new c.P(this.width,this.height)),P=this.pointCoordinate(new c.P(0,this.height)),A=Math.floor(Math.min(d.x,p.x,y.x,P.x)),D=Math.floor(Math.max(d.x,p.x,y.x,P.x)),V=1;for(let $=A-V;$<=D+V;$++)$!==0&&o.push(new c.b4($,e))}return o}coveringTiles(e){var o,d;let p=this.coveringZoomLevel(e);const y=p;if(e.minzoom!==void 0&&p<e.minzoom)return[];e.maxzoom!==void 0&&p>e.maxzoom&&(p=e.maxzoom);const P=this.pointCoordinate(this.getCameraPoint()),A=c.Z.fromLngLat(this.center),D=Math.pow(2,p),V=[D*P.x,D*P.y,0],$=[D*A.x,D*A.y,0],Z=R.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,p);let te=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(te=p);const ue=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,he=me=>({aabb:new B([me*D,0,0],[(me+1)*D,D,0]),zoom:0,x:0,y:0,wrap:me,fullyVisible:!1}),pe=[],ge=[],ve=p,Se=e.reparseOverscaled?y:p;if(this._renderWorldCopies)for(let me=1;me<=3;me++)pe.push(he(-me)),pe.push(he(me));for(pe.push(he(0));pe.length>0;){const me=pe.pop(),Ae=me.x,Oe=me.y;let qe=me.fullyVisible;if(!qe){const Et=me.aabb.intersects(Z);if(Et===0)continue;qe=Et===2}const ot=e.terrain?V:$,yt=me.aabb.distanceX(ot),St=me.aabb.distanceY(ot),Lt=Math.max(Math.abs(yt),Math.abs(St));if(me.zoom===ve||Lt>ue+(1<<ve-me.zoom)-2&&me.zoom>=te){const Et=ve-me.zoom,kt=V[0]-.5-(Ae<<Et),qt=V[1]-.5-(Oe<<Et);ge.push({tileID:new c.S(me.zoom===ve?Se:me.zoom,me.wrap,me.zoom,Ae,Oe),distanceSq:ht([$[0]-.5-Ae,$[1]-.5-Oe]),tileDistanceToCamera:Math.sqrt(kt*kt+qt*qt)})}else for(let Et=0;Et<4;Et++){const kt=(Ae<<1)+Et%2,qt=(Oe<<1)+(Et>>1),gn=me.zoom+1;let It=me.aabb.quadrant(Et);if(e.terrain){const Ct=new c.S(gn,me.wrap,gn,kt,qt),mn=e.terrain.getMinMaxElevation(Ct),li=(o=mn.minElevation)!==null&&o!==void 0?o:this.elevation,En=(d=mn.maxElevation)!==null&&d!==void 0?d:this.elevation;It=new B([It.min[0],It.min[1],li],[It.max[0],It.max[1],En])}pe.push({aabb:It,zoom:gn,x:kt,y:qt,wrap:me.wrap,fullyVisible:qe})}}return ge.sort(((me,Ae)=>me.distanceSq-Ae.distanceSq)).map((me=>me.tileID))}resize(e,o){this.width=e,this.height=o,this.pixelsToGLUnits=[2/e,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const o=c.ac(e.lat,-85.051129,re);return new c.P(c.O(e.lng)*this.worldSize,c.Q(o)*this.worldSize)}unproject(e){return new c.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const o=this.elevation,d=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,p=this.pointLocation(this.centerPoint,e),y=e.getElevationForLngLatZoom(p,this.tileZoom);if(!(this.elevation-y))return;const P=d+o-y,A=Math.cos(this._pitch)*this.cameraToCenterDistance/P/c.b5(1,p.lat),D=this.scaleZoom(A/this.tileSize);this._elevation=y,this._center=p,this.zoom=D}setLocationAtPoint(e,o){const d=this.pointCoordinate(o),p=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(e),P=new c.Z(y.x-(d.x-p.x),y.y-(d.y-p.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,o){return o?this.coordinatePoint(this.locationCoordinate(e),o.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,o){return this.coordinateLocation(this.pointCoordinate(e,o))}locationCoordinate(e){return c.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,o){if(o){const te=o.pointCoordinate(e);if(te!=null)return te}const d=[e.x,e.y,0,1],p=[e.x,e.y,1,1];c.af(d,d,this.pixelMatrixInverse),c.af(p,p,this.pixelMatrixInverse);const y=d[3],P=p[3],A=d[1]/y,D=p[1]/P,V=d[2]/y,$=p[2]/P,Z=V===$?0:(0-V)/($-V);return new c.Z(c.y.number(d[0]/y,p[0]/P,Z)/this.worldSize,c.y.number(A,D,Z)/this.worldSize)}coordinatePoint(e,o=0,d=this.pixelMatrix){const p=[e.x*this.worldSize,e.y*this.worldSize,o,1];return c.af(p,p,d),new c.P(p[0]/p[3],p[1]/p[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new Ye().extend(this.pointLocation(new c.P(0,e))).extend(this.pointLocation(new c.P(this.width,e))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ye([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,re])}calculateTileMatrix(e){const o=e.canonical,d=this.worldSize/this.zoomScale(o.z),p=o.x+Math.pow(2,o.z)*e.wrap,y=c.an(new Float64Array(16));return c.J(y,y,[p*d,o.y*d,0]),c.K(y,y,[d/c.X,d/c.X,1]),y}calculatePosMatrix(e,o=!1){const d=e.key,p=o?this._alignedPosMatrixCache:this._posMatrixCache;if(p[d])return p[d];const y=this.calculateTileMatrix(e);return c.L(y,o?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,y),p[d]=new Float32Array(y),p[d]}calculateFogMatrix(e){const o=e.key,d=this._fogMatrixCache;if(d[o])return d[o];const p=this.calculateTileMatrix(e);return c.L(p,this.fogMatrix,p),d[o]=new Float32Array(p),d[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,o){o=c.ac(+o,this.minZoom,this.maxZoom);const d={center:new c.N(e.lng,e.lat),zoom:o};let p=this.lngRange;if(!this._renderWorldCopies&&p===null){const me=179.9999999999;p=[-me,me]}const y=this.tileSize*this.zoomScale(d.zoom);let P=0,A=y,D=0,V=y,$=0,Z=0;const{x:te,y:ue}=this.size;if(this.latRange){const me=this.latRange;P=c.Q(me[1])*y,A=c.Q(me[0])*y,A-P<ue&&($=ue/(A-P))}p&&(D=c.b3(c.O(p[0])*y,0,y),V=c.b3(c.O(p[1])*y,0,y),V<D&&(V+=y),V-D<te&&(Z=te/(V-D)));const{x:he,y:pe}=this.project.call({worldSize:y},e);let ge,ve;const Se=Math.max(Z||0,$||0);if(Se){const me=new c.P(Z?(V+D)/2:he,$?(A+P)/2:pe);return d.center=this.unproject.call({worldSize:y},me).wrap(),d.zoom+=this.scaleZoom(Se),d}if(this.latRange){const me=ue/2;pe-me<P&&(ve=P+me),pe+me>A&&(ve=A-me)}if(p){const me=(D+V)/2;let Ae=he;this._renderWorldCopies&&(Ae=c.b3(he,me-y/2,me+y/2));const Oe=te/2;Ae-Oe<D&&(ge=D+Oe),Ae+Oe>V&&(ge=V-Oe)}if(ge!==void 0||ve!==void 0){const me=new c.P(ge??he,ve??pe);d.center=this.unproject.call({worldSize:y},me).wrap()}return d}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:o,zoom:d}=this.getConstrained(this.center,this.zoom);this.center=o,this.zoom=d,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,o=this.point.x,d=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b5(1,this.center.lat)*this.worldSize;let p=c.an(new Float64Array(16));c.K(p,p,[this.width/2,-this.height/2,1]),c.J(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=c.an(new Float64Array(16)),c.K(p,p,[1,-1,1]),c.J(p,p,[-1,-1,0]),c.K(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),P=Math.min(this.elevation,this.minElevationForCurrentTile),A=y-P*this._pixelPerMeter/Math.cos(this._pitch),D=P<0?A:y,V=Math.PI/2+this._pitch,$=this._fov*(.5+e.y/this.height),Z=Math.sin($)*D/Math.sin(c.ac(Math.PI-V-$,.01,Math.PI-.01)),te=this.getHorizon(),ue=2*Math.atan(te/this.cameraToCenterDistance)*(.5+e.y/(2*te)),he=Math.sin(ue)*D/Math.sin(c.ac(Math.PI-V-ue,.01,Math.PI-.01)),pe=Math.min(Z,he);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*pe+D),this.nearZ=this.height/50,p=new Float64Array(16),c.b6(p,this._fov,this.width/this.height,this.nearZ,this.farZ),p[8]=2*-e.x/this.width,p[9]=2*e.y/this.height,this.projectionMatrix=c.ae(p),c.K(p,p,[1,-1,1]),c.J(p,p,[0,0,-this.cameraToCenterDistance]),c.b7(p,p,this._pitch),c.ad(p,p,this.angle),c.J(p,p,[-o,-d,0]),this.mercatorMatrix=c.K([],p,[this.worldSize,this.worldSize,this.worldSize]),c.K(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.L(new Float64Array(16),this.labelPlaneMatrix,p),c.J(p,p,[0,0,-this.elevation]),this.modelViewProjectionMatrix=p,this.invModelViewProjectionMatrix=c.as([],p),this.fogMatrix=new Float64Array(16),c.b6(this.fogMatrix,this._fov,this.width/this.height,y,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,c.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b7(this.fogMatrix,this.fogMatrix,this._pitch),c.ad(this.fogMatrix,this.fogMatrix,this.angle),c.J(this.fogMatrix,this.fogMatrix,[-o,-d,0]),c.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=c.L(new Float64Array(16),this.labelPlaneMatrix,p);const ge=this.width%2/2,ve=this.height%2/2,Se=Math.cos(this.angle),me=Math.sin(this.angle),Ae=o-Math.round(o)+Se*ge+me*ve,Oe=d-Math.round(d)+Se*ve+me*ge,qe=new Float64Array(p);if(c.J(qe,qe,[Ae>.5?Ae-1:Ae,Oe>.5?Oe-1:Oe,0]),this.alignedModelViewProjectionMatrix=qe,p=c.as(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new c.P(0,0)),o=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.af(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,e))}getCameraQueryGeometry(e){const o=this.getCameraPoint();if(e.length===1)return[e[0],o];{let d=o.x,p=o.y,y=o.x,P=o.y;for(const A of e)d=Math.min(d,A.x),p=Math.min(p,A.y),y=Math.max(y,A.x),P=Math.max(P,A.y);return[new c.P(d,p),new c.P(y,p),new c.P(y,P),new c.P(d,P),new c.P(d,p)]}}lngLatToCameraDepth(e,o){const d=this.locationCoordinate(e),p=[d.x*this.worldSize,d.y*this.worldSize,o,1];return c.af(p,p,this.modelViewProjectionMatrix),p[2]/p[3]}}function De(_,e){let o,d=!1,p=null,y=null;const P=()=>{p=null,d&&(_.apply(y,o),p=setTimeout(P,e),d=!1)};return(...A)=>(d=!0,y=this,o=A,p||P(),p)}class $e{constructor(e){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let d;return o.split("&").map((p=>p.split("="))).forEach((p=>{p[0]===this._hashName&&(d=p)})),(d&&d[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(o.length>=3&&!o.some((d=>isNaN(d)))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:d,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,o)},this._removeHash=()=>{const o=this._getCurrentHash();if(o.length===0)return;const d=o.join("/");let p=d;p.split("&").length>0&&(p=p.split("&")[0]),this._hashName&&(p=`${this._hashName}=${d}`);let y=window.location.hash.replace(p,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let P=window.location.href.replace(/(#.+)?$/,y);P=P.replace("&&","&"),window.history.replaceState(window.history.state,null,P)},this._updateHash=De(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const o=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,p=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,p),P=Math.round(o.lng*y)/y,A=Math.round(o.lat*y)/y,D=this._map.getBearing(),V=this._map.getPitch();let $="";if($+=e?`/${P}/${A}/${d}`:`${d}/${A}/${P}`,(D||V)&&($+="/"+Math.round(10*D)/10),V&&($+=`/${Math.round(V)}`),this._hashName){const Z=this._hashName;let te=!1;const ue=window.location.hash.slice(1).split("&").map((he=>{const pe=he.split("=")[0];return pe===Z?(te=!0,`${pe}=${$}`):he})).filter((he=>he));return te||ue.push(`${Z}=${$}`),`#${ue.join("&")}`}return`#${$}`}}const ct={linearity:.3,easing:c.b8(0,0,.3,1)},At=c.e({deceleration:2500,maxSpeed:1400},ct),Ht=c.e({deceleration:20,maxSpeed:1400},ct),ln=c.e({deceleration:1e3,maxSpeed:360},ct),Nn=c.e({deceleration:1e3,maxSpeed:90},ct);class An{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:F.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,o=F.now();for(;e.length>0&&o-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)o.zoom+=y.zoomDelta||0,o.bearing+=y.bearingDelta||0,o.pitch+=y.pitchDelta||0,y.panDelta&&o.pan._add(y.panDelta),y.around&&(o.around=y.around),y.pinchAround&&(o.pinchAround=y.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(o.pan.mag()){const y=Ci(o.pan.mag(),d,c.e({},At,e||{}));p.offset=o.pan.mult(y.amount/o.pan.mag()),p.center=this._map.transform.center,Vn(p,y)}if(o.zoom){const y=Ci(o.zoom,d,Ht);p.zoom=this._map.transform.zoom+y.amount,Vn(p,y)}if(o.bearing){const y=Ci(o.bearing,d,ln);p.bearing=this._map.transform.bearing+c.ac(y.amount,-179,179),Vn(p,y)}if(o.pitch){const y=Ci(o.pitch,d,Nn);p.pitch=this._map.transform.pitch+y.amount,Vn(p,y)}if(p.zoom||p.bearing){const y=o.pinchAround===void 0?o.around:o.pinchAround;p.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),c.e(p,{noMoveStart:!0})}}function Vn(_,e){(!_.duration||_.duration<e.duration)&&(_.duration=e.duration,_.easing=e.easing)}function Ci(_,e,o){const{maxSpeed:d,linearity:p,deceleration:y}=o,P=c.ac(_*p/(e/1e3),-d,d),A=Math.abs(P)/(y*p);return{easing:o.easing,duration:1e3*A,amount:P*(A/2)}}class Kn extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,d,p={}){const y=q.mousePos(o.getCanvas(),d),P=o.unproject(y);super(e,c.e({point:y,lngLat:P,originalEvent:d},p)),this._defaultPrevented=!1,this.target=o}}class xr extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,d){const p=e==="touchend"?d.changedTouches:d.touches,y=q.touchPos(o.getCanvasContainer(),p),P=y.map((D=>o.unproject(D))),A=y.reduce(((D,V,$,Z)=>D.add(V.div(Z.length))),new c.P(0,0));super(e,{points:y,point:A,lngLats:P,lngLat:o.unproject(A),originalEvent:d}),this._defaultPrevented=!1}}class oo extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,d){super(e,{originalEvent:d}),this._defaultPrevented=!1}}class Ll{constructor(e,o){this._map=e,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new oo(e.type,this._map,e))}mousedown(e,o){return this._mousedownPos=o,this._firePreventable(new Kn(e.type,this._map,e))}mouseup(e){this._map.fire(new Kn(e.type,this._map,e))}click(e,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Kn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Kn(e.type,this._map,e))}mouseover(e){this._map.fire(new Kn(e.type,this._map,e))}mouseout(e){this._map.fire(new Kn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new xr(e.type,this._map,e))}touchmove(e){this._map.fire(new xr(e.type,this._map,e))}touchend(e){this._map.fire(new xr(e.type,this._map,e))}touchcancel(e){this._map.fire(new xr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xi{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Kn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Kn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Kn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hr{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(c.P.convert(e),this._map.terrain)}}class Tr{constructor(e,o){this._map=e,this._tr=new Hr(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,o){this.isEnabled()&&e.shiftKey&&e.button===0&&(q.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(e,o){if(!this._active)return;const d=o;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=d,this._box||(this._box=q.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const y=Math.min(p.x,d.x),P=Math.max(p.x,d.x),A=Math.min(p.y,d.y),D=Math.max(p.y,d.y);q.setTransform(this._box,`translate(${y}px,${A}px)`),this._box.style.width=P-y+"px",this._box.style.height=D-A+"px"}mouseupWindow(e,o){if(!this._active||e.button!==0)return;const d=this._startPos,p=o;if(this.reset(),q.suppressClick(),d.x!==p.x||d.y!==p.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:e})),{cameraAnimation:y=>y.fitScreenCoordinates(d,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(q.remove(this._box),this._box=null),q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,o){return this._map.fire(new c.k(e,{originalEvent:o}))}}function lo(_,e){if(_.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${e.length}`);const o={};for(let d=0;d<_.length;d++)o[_[d].identifier]=e[d];return o}class xs{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,o,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),d.length===this.numTouches&&(this.centroid=(function(p){const y=new c.P(0,0);for(const P of p)y._add(P);return y.div(p.length)})(o),this.touches=lo(d,o)))}touchmove(e,o,d){if(this.aborted||!this.centroid)return;const p=lo(d,o);for(const y in this.touches){const P=p[y];(!P||P.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(e,o,d){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Ba{constructor(e){this.singleTap=new xs(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,o,d){this.singleTap.touchstart(e,o,d)}touchmove(e,o,d){this.singleTap.touchmove(e,o,d)}touchend(e,o,d){const p=this.singleTap.touchend(e,o,d);if(p){const y=e.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(p)<30;if(y&&P||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Vs{constructor(e){this._tr=new Hr(e),this._zoomIn=new Ba({numTouches:1,numTaps:2}),this._zoomOut=new Ba({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,o,d){this._zoomIn.touchstart(e,o,d),this._zoomOut.touchstart(e,o,d)}touchmove(e,o,d){this._zoomIn.touchmove(e,o,d),this._zoomOut.touchmove(e,o,d)}touchend(e,o,d){const p=this._zoomIn.touchend(e,o,d),y=this._zoomOut.touchend(e,o,d),P=this._tr;return p?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:P.zoom+1,around:P.unproject(p)},{originalEvent:e})}):y?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:P.zoom-1,around:P.unproject(y)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uo{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const o=this._moveFunction(...e);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(e,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,o){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const p=o.length?o[0]:o;return!this._moved&&p.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(d,p))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&q.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const mc={0:1,2:2};class Do{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const o=q.mouseButton(e);this._eventButton=o}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(o,d){const p=mc[d];return o.buttons===void 0||(o.buttons&p)!==p})(e,this._eventButton)}isValidEndEvent(e){return q.mouseButton(e)===this._eventButton}}class gc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const hu=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=e=>{e.preventDefault()}},Bu=({enable:_,clickTolerance:e,bearingDegreesPerPixelMoved:o=.8})=>{const d=new Do({checkCorrectEvent:p=>q.mouseButton(p)===0&&p.ctrlKey||q.mouseButton(p)===2});return new uo({clickTolerance:e,move:(p,y)=>({bearingDelta:(y.x-p.x)*o}),moveStateManager:d,enable:_,assignEvents:hu})},gi=({enable:_,clickTolerance:e,pitchDegreesPerPixelMoved:o=-.5})=>{const d=new Do({checkCorrectEvent:p=>q.mouseButton(p)===0&&p.ctrlKey||q.mouseButton(p)===2});return new uo({clickTolerance:e,move:(p,y)=>({pitchDelta:(y.y-p.y)*o}),moveStateManager:d,enable:_,assignEvents:hu})};class co{constructor(e,o){this._clickTolerance=e.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,o,d){return this._calculateTransform(e,o,d)}touchmove(e,o,d){if(this._active){if(!this._shouldBePrevented(d.length))return e.preventDefault(),this._calculateTransform(e,o,d);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,o,d){this._calculateTransform(e,o,d),this._active&&this._shouldBePrevented(d.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,o,d){d.length>0&&(this._active=!0);const p=lo(d,o),y=new c.P(0,0),P=new c.P(0,0);let A=0;for(const V in p){const $=p[V],Z=this._touches[V];Z&&(y._add($),P._add($.sub(Z)),A++,p[V]=$)}if(this._touches=p,this._shouldBePrevented(A)||!P.mag())return;const D=P.div(A);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(A),panDelta:D}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class al{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,o,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([o[0],o[1]]))}touchmove(e,o,d){if(!this._firstTwoTouches)return;e.preventDefault();const[p,y]=this._firstTwoTouches,P=ho(d,o,p),A=ho(d,o,y);if(!P||!A)return;const D=this._aroundCenter?null:P.add(A).div(2);return this._move([P,A],D,e)}touchend(e,o,d){if(!this._firstTwoTouches)return;const[p,y]=this._firstTwoTouches,P=ho(d,o,p),A=ho(d,o,y);P&&A||(this._active&&q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ho(_,e,o){for(let d=0;d<_.length;d++)if(_[d].identifier===o)return e[d]}function ju(_,e){return Math.log(_/e)/Math.LN2}class fu extends al{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,o){const d=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ju(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ju(this._distance,d),pinchAround:o}}}function ol(_,e){return 180*_.angleWith(e)/Math.PI}class Rl extends al{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,o,d){const p=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ol(this._vector,p),pinchAround:o}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const o=25/(Math.PI*this._minDiameter)*360,d=ol(e,this._startVector);return Math.abs(d)<o}}function fo(_){return Math.abs(_.y)>Math.abs(_.x)}class Nl extends al{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,o,d){super.touchstart(e,o,d),this._currentTouchCount=d.length}_start(e){this._lastPoints=e,fo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,o,d){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const p=e[0].sub(this._lastPoints[0]),y=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,y,d.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(p.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(e,o,d){if(this._valid!==void 0)return this._valid;const p=e.mag()>=2,y=o.mag()>=2;if(!p&&!y)return;if(!p||!y)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const P=e.y>0==o.y>0;return fo(e)&&fo(o)&&P}}const rh={panStep:100,bearingStep:15,pitchStep:10};class Us{constructor(e){this._tr=new Hr(e);const o=rh;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let o=0,d=0,p=0,y=0,P=0;switch(e.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:e.shiftKey?d=-1:(e.preventDefault(),y=-1);break;case 39:e.shiftKey?d=1:(e.preventDefault(),y=1);break;case 38:e.shiftKey?p=1:(e.preventDefault(),P=-1);break;case 40:e.shiftKey?p=-1:(e.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(d=0,p=0),{cameraAnimation:A=>{const D=this._tr;A.easeTo({duration:300,easeId:"keyboardHandler",easing:da,zoom:o?Math.round(D.zoom)+o*(e.shiftKey?2:1):D.zoom,bearing:D.bearing+d*this._bearingStep,pitch:D.pitch+p*this._pitchStep,offset:[-y*this._panStep,-P*this._panStep],center:D.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function da(_){return _*(2-_)}const zl=4.000244140625;class ns{constructor(e,o){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=e,this._tr=new Hr(e),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let o=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const d=F.now(),p=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,o!==0&&o%zl==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(p*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),e.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=e,this._delta-=o,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=q.mousePos(this._map.getCanvas(),e),d=this._tr;this._around=o.y>d.transform.height/2-d.transform.getHorizon()?c.N.convert(this._aroundCenter?d.center:d.unproject(o)):c.N.convert(d.center),this._aroundPoint=d.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>zl?this._wheelZoomRate:this._defaultZoomRate;let V=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&V!==0&&(V=1/V);const $=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom($*V))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,d=this._startZoom,p=this._easing;let y,P=!1;const A=F.now()-this._lastWheelEventTime;if(this._type==="wheel"&&d&&p&&A){const D=Math.min(A/200,1),V=p(D);y=c.y.number(d,o,V),D<1?this._frameId||(this._frameId=!0):P=!0}else y=o,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:y-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let o=c.b9;if(this._prevEase){const d=this._prevEase,p=(F.now()-d.start)/d.duration,y=d.easing(p+.01)-d.easing(p),P=.27/Math.sqrt(y*y+1e-4)*.01,A=Math.sqrt(.0729-P*P);o=c.b8(P,A,.25,1)}return this._prevEase={start:F.now(),duration:e,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class po{constructor(e,o){this._clickZoom=e,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yc{constructor(e){this._tr=new Hr(e),this.reset()}reset(){this._active=!1}dblclick(e,o){return e.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _c{constructor(){this._tap=new Ba({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,o,d){if(!this._swipePoint)if(this._tapTime){const p=o[0],y=e.timeStamp-this._tapTime<500,P=this._tapPoint.dist(p)<30;y&&P?d.length>0&&(this._swipePoint=p,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(e,o,d)}touchmove(e,o,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const p=o[0],y=p.y-this._swipePoint.y;return this._swipePoint=p,e.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(e,o,d)}touchend(e,o,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{const p=this._tap.touchend(e,o,d);p&&(this._tapTime=e.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vu{constructor(e,o,d){this._el=e,this._mousePan=o,this._touchPan=d}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class sh{constructor(e,o,d){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=o,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Uu{constructor(e,o,d,p){this._el=e,this._touchZoom=o,this._touchRotate=d,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Dl{constructor(e,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=q.create("div","maplibregl-cooperative-gesture-screen",e);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const d=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=o,this._container.appendChild(p);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=d,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(q.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,o){this._enabled&&(this._map.fire(new c.k("cooperativegestureprevented",{gestureType:e,originalEvent:o})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const qs=_=>_.zoom||_.drag||_.pitch||_.rotate;class Ot extends c.k{}function pa(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class qu{constructor(e,o){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,y)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const P=p.type==="renderFrame"?void 0:p,A={needsRenderFrame:!1},D={},V={},$=p.touches,Z=$?this._getMapTouches($):void 0,te=Z?q.touchPos(this._map.getCanvas(),Z):q.mousePos(this._map.getCanvas(),p);for(const{handlerName:pe,handler:ge,allowed:ve}of this._handlers){if(!ge.isEnabled())continue;let Se;this._blockedByActive(V,ve,pe)?ge.reset():ge[y||p.type]&&(Se=ge[y||p.type](p,te,Z),this.mergeHandlerResult(A,D,Se,pe,P),Se&&Se.needsRenderFrame&&this._triggerRenderFrame()),(Se||ge.isActive())&&(V[pe]=ge)}const ue={};for(const pe in this._previousActiveHandlers)V[pe]||(ue[pe]=P);this._previousActiveHandlers=V,(Object.keys(ue).length||pa(A))&&(this._changes.push([A,D,ue]),this._triggerRenderFrame()),(Object.keys(V).length||pa(A))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:he}=A;he&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],he(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new An(e),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,y,P]of this._listeners)q.addEventListener(p,y,p===document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[e,o,d]of this._listeners)q.removeEventListener(e,o,e===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(e){const o=this._map,d=o.getCanvasContainer();this._add("mapEvent",new Ll(o,e));const p=o.boxZoom=new Tr(o,e);this._add("boxZoom",p),e.interactive&&e.boxZoom&&p.enable();const y=o.cooperativeGestures=new Dl(o,e.cooperativeGestures);this._add("cooperativeGestures",y),e.cooperativeGestures&&y.enable();const P=new Vs(o),A=new yc(o);o.doubleClickZoom=new po(A,P),this._add("tapZoom",P),this._add("clickZoom",A),e.interactive&&e.doubleClickZoom&&o.doubleClickZoom.enable();const D=new _c;this._add("tapDragZoom",D);const V=o.touchPitch=new Nl(o);this._add("touchPitch",V),e.interactive&&e.touchPitch&&o.touchPitch.enable(e.touchPitch);const $=Bu(e),Z=gi(e);o.dragRotate=new sh(e,$,Z),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate"]),e.interactive&&e.dragRotate&&o.dragRotate.enable();const te=(({enable:Se,clickTolerance:me})=>{const Ae=new Do({checkCorrectEvent:Oe=>q.mouseButton(Oe)===0&&!Oe.ctrlKey});return new uo({clickTolerance:me,move:(Oe,qe)=>({around:qe,panDelta:qe.sub(Oe)}),activateOnStart:!0,moveStateManager:Ae,enable:Se,assignEvents:hu})})(e),ue=new co(e,o);o.dragPan=new Vu(d,te,ue),this._add("mousePan",te),this._add("touchPan",ue,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&o.dragPan.enable(e.dragPan);const he=new Rl,pe=new fu;o.touchZoomRotate=new Uu(d,pe,he,D),this._add("touchRotate",he,["touchPan","touchZoom"]),this._add("touchZoom",pe,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&o.touchZoomRotate.enable(e.touchZoomRotate);const ge=o.scrollZoom=new ns(o,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ge,["mousePan"]),e.interactive&&e.scrollZoom&&o.scrollZoom.enable(e.scrollZoom);const ve=o.keyboard=new Us(o);this._add("keyboard",ve),e.interactive&&e.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new xi(o))}_add(e,o,d){this._handlers.push({handlerName:e,handler:o,allowed:d}),this._handlersById[e]=o}stop(e){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!qs(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,o,d){for(const p in e)if(p!==d&&(!o||o.indexOf(p)<0))return!0;return!1}_getMapTouches(e){const o=[];for(const d of e)this._el.contains(d.target)&&o.push(d);return o}mergeHandlerResult(e,o,d,p,y){if(!d)return;c.e(e,d);const P={handlerName:p,originalEvent:d.originalEvent||y};d.zoomDelta!==void 0&&(o.zoom=P),d.panDelta!==void 0&&(o.drag=P),d.pitchDelta!==void 0&&(o.pitch=P),d.bearingDelta!==void 0&&(o.rotate=P)}_applyChanges(){const e={},o={},d={};for(const[p,y,P]of this._changes)p.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(p.panDelta)),p.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(e.around=p.around),p.pinchAround!==void 0&&(e.pinchAround=p.pinchAround),p.noInertia&&(e.noInertia=p.noInertia),c.e(o,y),c.e(d,P);this._updateMapTransform(e,o,d),this._changes=[]}_updateMapTransform(e,o,d){const p=this._map,y=p._getTransformForUpdate(),P=p.terrain;if(!(pa(e)||P&&this._terrainMovement))return this._fireEvents(o,d,!0);let{panDelta:A,zoomDelta:D,bearingDelta:V,pitchDelta:$,around:Z,pinchAround:te}=e;te!==void 0&&(Z=te),p._stop(!0),Z=Z||p.transform.centerPoint;const ue=y.pointLocation(A?Z.sub(A):Z);V&&(y.bearing+=V),$&&(y.pitch+=$),D&&(y.zoom+=D),P?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(A)):y.setLocationAtPoint(ue,Z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(ue,Z)):y.setLocationAtPoint(ue,Z),p._applyUpdatedTransform(y),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(o,d,!0)}_fireEvents(e,o,d){const p=qs(this._eventsInProgress),y=qs(e),P={};for(const Z in e){const{originalEvent:te}=e[Z];this._eventsInProgress[Z]||(P[`${Z}start`]=te),this._eventsInProgress[Z]=e[Z]}!p&&y&&this._fireEvent("movestart",y.originalEvent);for(const Z in P)this._fireEvent(Z,P[Z]);y&&this._fireEvent("move",y.originalEvent);for(const Z in e){const{originalEvent:te}=e[Z];this._fireEvent(Z,te)}const A={};let D;for(const Z in this._eventsInProgress){const{handlerName:te,originalEvent:ue}=this._eventsInProgress[Z];this._handlersById[te].isActive()||(delete this._eventsInProgress[Z],D=o[te]||ue,A[`${Z}end`]=D)}for(const Z in A)this._fireEvent(Z,A[Z]);const V=qs(this._eventsInProgress),$=(p||y)&&!V;if($&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const Z=this._map._getTransformForUpdate();Z.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(Z)}if(d&&$){this._updatingCamera=!0;const Z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),te=ue=>ue!==0&&-this._bearingSnap<ue&&ue<this._bearingSnap;!Z||!Z.essential&&F.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:D})),te(this._map.getBearing())&&this._map.resetNorth()):(te(Z.bearing||this._map.getBearing())&&(Z.bearing=0),Z.freezeElevation=!0,this._map.easeTo(Z,{originalEvent:D})),this._updatingCamera=!1}}_fireEvent(e,o){this._map.fire(new c.k(e,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Ot("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ll extends c.E{constructor(e,o){super(),this._renderFrameCallback=()=>{const d=Math.min((F.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=o.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,o){return this.jumpTo({center:e},o)}panBy(e,o,d){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},o),d)}panTo(e,o,d){return this.easeTo(c.e({center:e},o),d)}getZoom(){return this.transform.zoom}setZoom(e,o){return this.jumpTo({zoom:e},o),this}zoomTo(e,o,d){return this.easeTo(c.e({zoom:e},o),d)}zoomIn(e,o){return this.zoomTo(this.getZoom()+1,e,o),this}zoomOut(e,o){return this.zoomTo(this.getZoom()-1,e,o),this}getBearing(){return this.transform.bearing}setBearing(e,o){return this.jumpTo({bearing:e},o),this}getPadding(){return this.transform.padding}setPadding(e,o){return this.jumpTo({padding:e},o),this}rotateTo(e,o,d){return this.easeTo(c.e({bearing:e},o),d)}resetNorth(e,o){return this.rotateTo(0,c.e({duration:1e3},e),o),this}resetNorthPitch(e,o){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},e),o),this}snapToNorth(e,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,o):this}getPitch(){return this.transform.pitch}setPitch(e,o){return this.jumpTo({pitch:e},o),this}cameraForBounds(e,o){e=Ye.convert(e).adjustAntiMeridian();const d=o&&o.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),d,o)}_cameraForBoxAndBearing(e,o,d,p){const y={top:0,bottom:0,right:0,left:0};if(typeof(p=c.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const Et=p.padding;p.padding={top:Et,bottom:Et,right:Et,left:Et}}p.padding=c.e(y,p.padding);const P=this.transform,A=P.padding,D=new Ye(e,o),V=P.project(D.getNorthWest()),$=P.project(D.getNorthEast()),Z=P.project(D.getSouthEast()),te=P.project(D.getSouthWest()),ue=c.ba(-d),he=V.rotate(ue),pe=$.rotate(ue),ge=Z.rotate(ue),ve=te.rotate(ue),Se=new c.P(Math.max(he.x,pe.x,ve.x,ge.x),Math.max(he.y,pe.y,ve.y,ge.y)),me=new c.P(Math.min(he.x,pe.x,ve.x,ge.x),Math.min(he.y,pe.y,ve.y,ge.y)),Ae=Se.sub(me),Oe=(P.width-(A.left+A.right+p.padding.left+p.padding.right))/Ae.x,qe=(P.height-(A.top+A.bottom+p.padding.top+p.padding.bottom))/Ae.y;if(qe<0||Oe<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ot=Math.min(P.scaleZoom(P.scale*Math.min(Oe,qe)),p.maxZoom),yt=c.P.convert(p.offset),St=new c.P((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(c.ba(d)),Lt=yt.add(St).mult(P.scale/P.zoomScale(ot));return{center:P.unproject(V.add(Z).div(2).sub(Lt)),zoom:ot,bearing:d}}fitBounds(e,o,d){return this._fitInternal(this.cameraForBounds(e,o),o,d)}fitScreenCoordinates(e,o,d,p,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(e)),this.transform.pointLocation(c.P.convert(o)),d,p),p,y)}_fitInternal(e,o,d){return e?(delete(o=c.e(e,o)).padding,o.linear?this.easeTo(o,d):this.flyTo(o,d)):this}jumpTo(e,o){this.stop();const d=this._getTransformForUpdate();let p=!1,y=!1,P=!1;return"zoom"in e&&d.zoom!==+e.zoom&&(p=!0,d.zoom=+e.zoom),e.center!==void 0&&(d.center=c.N.convert(e.center)),"bearing"in e&&d.bearing!==+e.bearing&&(y=!0,d.bearing=+e.bearing),"pitch"in e&&d.pitch!==+e.pitch&&(P=!0,d.pitch=+e.pitch),e.padding==null||d.isPaddingEqual(e.padding)||(d.padding=e.padding),this._applyUpdatedTransform(d),this.fire(new c.k("movestart",o)).fire(new c.k("move",o)),p&&this.fire(new c.k("zoomstart",o)).fire(new c.k("zoom",o)).fire(new c.k("zoomend",o)),y&&this.fire(new c.k("rotatestart",o)).fire(new c.k("rotate",o)).fire(new c.k("rotateend",o)),P&&this.fire(new c.k("pitchstart",o)).fire(new c.k("pitch",o)).fire(new c.k("pitchend",o)),this.fire(new c.k("moveend",o))}calculateCameraOptionsFromTo(e,o,d,p=0){const y=c.Z.fromLngLat(e,o),P=c.Z.fromLngLat(d,p),A=P.x-y.x,D=P.y-y.y,V=P.z-y.z,$=Math.hypot(A,D,V);if($===0)throw new Error("Can't calculate camera options with same From and To");const Z=Math.hypot(A,D),te=this.transform.scaleZoom(this.transform.cameraToCenterDistance/$/this.transform.tileSize),ue=180*Math.atan2(A,-D)/Math.PI;let he=180*Math.acos(Z/$)/Math.PI;return he=V<0?90-he:90+he,{center:P.toLngLat(),zoom:te,pitch:he,bearing:ue}}easeTo(e,o){var d;this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.b9},e)).animate===!1||!e.essential&&F.prefersReducedMotion)&&(e.duration=0);const p=this._getTransformForUpdate(),y=p.zoom,P=p.bearing,A=p.pitch,D=p.padding,V="bearing"in e?this._normalizeBearing(e.bearing,P):P,$="pitch"in e?+e.pitch:A,Z="padding"in e?e.padding:p.padding,te=c.P.convert(e.offset);let ue=p.centerPoint.add(te);const he=p.pointLocation(ue),{center:pe,zoom:ge}=p.getConstrained(c.N.convert(e.center||he),(d=e.zoom)!==null&&d!==void 0?d:y);this._normalizeCenter(pe,p);const ve=p.project(he),Se=p.project(pe).sub(ve),me=p.zoomScale(ge-y);let Ae,Oe;e.around&&(Ae=c.N.convert(e.around),Oe=p.locationPoint(Ae));const qe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ge!==y,this._rotating=this._rotating||P!==V,this._pitching=this._pitching||$!==A,this._padding=!p.isPaddingEqual(Z),this._easeId=e.easeId,this._prepareEase(o,e.noMoveStart,qe),this.terrain&&this._prepareElevation(pe),this._ease((ot=>{if(this._zooming&&(p.zoom=c.y.number(y,ge,ot)),this._rotating&&(p.bearing=c.y.number(P,V,ot)),this._pitching&&(p.pitch=c.y.number(A,$,ot)),this._padding&&(p.interpolatePadding(D,Z,ot),ue=p.centerPoint.add(te)),this.terrain&&!e.freezeElevation&&this._updateElevation(ot),Ae)p.setLocationAtPoint(Ae,Oe);else{const yt=p.zoomScale(p.zoom-y),St=ge>y?Math.min(2,me):Math.max(.5,me),Lt=Math.pow(St,1-ot),Et=p.unproject(ve.add(Se.mult(ot*Lt)).mult(yt));p.setLocationAtPoint(p.renderWorldCopies?Et.wrap():Et,ue)}this._applyUpdatedTransform(p),this._fireMoveEvents(o)}),(ot=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o,ot)}),e),this}_prepareEase(e,o,d={}){this._moving=!0,o||d.moving||this.fire(new c.k("movestart",e)),this._zooming&&!d.zooming&&this.fire(new c.k("zoomstart",e)),this._rotating&&!d.rotating&&this.fire(new c.k("rotatestart",e)),this._pitching&&!d.pitching&&this.fire(new c.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&o!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(d-(o-(d*e+this._elevationStart))/(1-e)),this._elevationTarget=o}this.transform.elevation=c.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const o=e.getCameraPosition(),d=this.terrain.getElevationForLngLatZoom(o.lngLat,e.zoom);if(o.altitude<d){const p=this.calculateCameraOptionsFromTo(o.lngLat,d,e.center,e.elevation);return{pitch:p.pitch,zoom:p.zoom}}return{}}_applyUpdatedTransform(e){const o=[];if(this.terrain&&o.push((p=>this._elevateCameraIfInsideTerrain(p))),this.transformCameraUpdate&&o.push((p=>this.transformCameraUpdate(p))),!o.length)return;const d=e.clone();for(const p of o){const y=d.clone(),{center:P,zoom:A,pitch:D,bearing:V,elevation:$}=p(y);P&&(y.center=P),A!==void 0&&(y.zoom=A),D!==void 0&&(y.pitch=D),V!==void 0&&(y.bearing=V),$!==void 0&&(y.elevation=$),d.apply(y)}this.transform.apply(d)}_fireMoveEvents(e){this.fire(new c.k("move",e)),this._zooming&&this.fire(new c.k("zoom",e)),this._rotating&&this.fire(new c.k("rotate",e)),this._pitching&&this.fire(new c.k("pitch",e))}_afterEase(e,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const d=this._zooming,p=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new c.k("zoomend",e)),p&&this.fire(new c.k("rotateend",e)),y&&this.fire(new c.k("pitchend",e)),this.fire(new c.k("moveend",e))}flyTo(e,o){var d;if(!e.essential&&F.prefersReducedMotion){const Ct=c.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ct,o)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b9},e);const p=this._getTransformForUpdate(),y=p.zoom,P=p.bearing,A=p.pitch,D=p.padding,V="bearing"in e?this._normalizeBearing(e.bearing,P):P,$="pitch"in e?+e.pitch:A,Z="padding"in e?e.padding:p.padding,te=c.P.convert(e.offset);let ue=p.centerPoint.add(te);const he=p.pointLocation(ue),{center:pe,zoom:ge}=p.getConstrained(c.N.convert(e.center||he),(d=e.zoom)!==null&&d!==void 0?d:y);this._normalizeCenter(pe,p);const ve=p.zoomScale(ge-y),Se=p.project(he),me=p.project(pe).sub(Se);let Ae=e.curve;const Oe=Math.max(p.width,p.height),qe=Oe/ve,ot=me.mag();if("minZoom"in e){const Ct=c.ac(Math.min(e.minZoom,y,ge),p.minZoom,p.maxZoom),mn=Oe/p.zoomScale(Ct-y);Ae=Math.sqrt(mn/ot*2)}const yt=Ae*Ae;function St(Ct){const mn=(qe*qe-Oe*Oe+(Ct?-1:1)*yt*yt*ot*ot)/(2*(Ct?qe:Oe)*yt*ot);return Math.log(Math.sqrt(mn*mn+1)-mn)}function Lt(Ct){return(Math.exp(Ct)-Math.exp(-Ct))/2}function Et(Ct){return(Math.exp(Ct)+Math.exp(-Ct))/2}const kt=St(!1);let qt=function(Ct){return Et(kt)/Et(kt+Ae*Ct)},gn=function(Ct){return Oe*((Et(kt)*(Lt(mn=kt+Ae*Ct)/Et(mn))-Lt(kt))/yt)/ot;var mn},It=(St(!0)-kt)/Ae;if(Math.abs(ot)<1e-6||!isFinite(It)){if(Math.abs(Oe-qe)<1e-6)return this.easeTo(e,o);const Ct=qe<Oe?-1:1;It=Math.abs(Math.log(qe/Oe))/Ae,gn=()=>0,qt=mn=>Math.exp(Ct*Ae*mn)}return e.duration="duration"in e?+e.duration:1e3*It/("screenSpeed"in e?+e.screenSpeed/Ae:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=P!==V,this._pitching=$!==A,this._padding=!p.isPaddingEqual(Z),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(pe),this._ease((Ct=>{const mn=Ct*It,li=1/qt(mn);p.zoom=Ct===1?ge:y+p.scaleZoom(li),this._rotating&&(p.bearing=c.y.number(P,V,Ct)),this._pitching&&(p.pitch=c.y.number(A,$,Ct)),this._padding&&(p.interpolatePadding(D,Z,Ct),ue=p.centerPoint.add(te)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ct);const En=Ct===1?pe:p.unproject(Se.add(me.mult(gn(mn))).mult(li));p.setLocationAtPoint(p.renderWorldCopies?En.wrap():En,ue),this._applyUpdatedTransform(p),this._fireMoveEvents(o)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,o){var d;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,o)}return e||(d=this.handlers)===null||d===void 0||d.stop(!1),this}_ease(e,o,d){d.animate===!1||d.duration===0?(e(1),o()):(this._easeStart=F.now(),this._easeOptions=d,this._onEaseFrame=e,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,o){e=c.b3(e,-180,180);const d=Math.abs(e-o);return Math.abs(e-360-o)<d&&(e-=360),Math.abs(e+360-o)<d&&(e+=360),e}_normalizeCenter(e,o){if(!o.renderWorldCopies||o.lngRange)return;const d=e.lng-o.center.lng;e.lng+=d>180?-360:d<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const Xr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ja{constructor(e=Xr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=q.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,o){const d=this._map._getUIString(`AttributionControl.${o}`);e.title=d,e.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((p=>typeof p!="string"?"":p))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const o=this._map.style.sourceCaches;for(const p in o){const y=o[p];if(y.used||y.usedForTerrain){const P=y.getSource();P.attribution&&e.indexOf(P.attribution)<0&&e.push(P.attribution)}}e=e.filter((p=>String(p).trim())),e.sort(((p,y)=>p.length-y.length)),e=e.filter(((p,y)=>{for(let P=y+1;P<e.length;P++)if(e[P].indexOf(p)>=0)return!1;return!0}));const d=e.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,e.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ma{constructor(e={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const d=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=q.create("div","maplibregl-ctrl");const o=q.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class zn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const o=++this._id;return this._queue.push({callback:e,id:o,cancelled:!1}),o}remove(e){const o=this._currentlyRunning,d=o?this._queue.concat(o):this._queue;for(const p of d)if(p.id===e)return void(p.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const d of o)if(!d.cancelled&&(d.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var vc=c.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Kh extends c.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,o){this.sourceCache.update(e,o),this._renderableTilesKeys=[];const d={};for(const p of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))d[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),c.aP(p.posMatrix,0,c.X,0,c.X,0,1),this._tiles[p.key]=new Aa(p,this.tileSize));for(const p in this._tiles)d[p]||delete this._tiles[p]}freeRtt(e){for(const o in this._tiles){const d=this._tiles[o];(!e||d.tileID.equals(e)||d.tileID.isChildOf(e)||e.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const o={};for(const d of this._renderableTilesKeys){const p=this._tiles[d].tileID;if(p.canonical.equals(e.canonical)){const y=e.clone();y.posMatrix=new Float64Array(16),c.aP(y.posMatrix,0,c.X,0,c.X,0,1),o[d]=y}else if(p.canonical.isChildOf(e.canonical)){const y=e.clone();y.posMatrix=new Float64Array(16);const P=p.canonical.z-e.canonical.z,A=p.canonical.x-(p.canonical.x>>P<<P),D=p.canonical.y-(p.canonical.y>>P<<P),V=c.X>>P;c.aP(y.posMatrix,0,V,0,V,0,1),c.J(y.posMatrix,y.posMatrix,[-A*V,-D*V,0]),o[d]=y}else if(e.canonical.isChildOf(p.canonical)){const y=e.clone();y.posMatrix=new Float64Array(16);const P=e.canonical.z-p.canonical.z,A=e.canonical.x-(e.canonical.x>>P<<P),D=e.canonical.y-(e.canonical.y>>P<<P),V=c.X>>P;c.aP(y.posMatrix,0,c.X,0,c.X,0,1),c.J(y.posMatrix,y.posMatrix,[A*V,D*V,0]),c.K(y.posMatrix,y.posMatrix,[1/2**P,1/2**P,0]),o[d]=y}}return o}getSourceTile(e,o){const d=this.sourceCache._source;let p=e.overscaledZ-this.deltaZoom;if(p>d.maxzoom&&(p=d.maxzoom),p<d.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(p).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!y||!y.dem)&&o)for(;p>=d.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(e.scaledTo(p--).key);return y}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter((o=>o.timeAdded>=e))}}class mo{constructor(e,o,d){this.painter=e,this.sourceCache=new Kh(o),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,o,d,p=c.X){var y;if(!(o>=0&&o<p&&d>=0&&d<p))return 0;const P=this.getTerrainData(e),A=(y=P.tile)===null||y===void 0?void 0:y.dem;if(!A)return 0;const D=(function(he,pe,ge){var ve=pe[0],Se=pe[1];return he[0]=ge[0]*ve+ge[4]*Se+ge[12],he[1]=ge[1]*ve+ge[5]*Se+ge[13],he})([],[o/p*c.X,d/p*c.X],P.u_terrain_matrix),V=[D[0]*A.dim,D[1]*A.dim],$=Math.floor(V[0]),Z=Math.floor(V[1]),te=V[0]-$,ue=V[1]-Z;return A.get($,Z)*(1-te)*(1-ue)+A.get($+1,Z)*te*(1-ue)+A.get($,Z+1)*(1-te)*ue+A.get($+1,Z+1)*te*ue}getElevationForLngLatZoom(e,o){if(!c.bb(o,e.wrap()))return 0;const{tileID:d,mercatorX:p,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(e,o);return this.getElevation(d,p%c.X,y%c.X,c.X)}getElevation(e,o,d,p=c.X){return this.getDEMElevation(e,o,d,p)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const p=this.painter.context,y=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new wt(p,y,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new wt(p,new c.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}const o=this.sourceCache.getSourceTile(e,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const p=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new wt(p,o.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),o.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const d=o&&o+o.tileID.key+e.key;if(d&&!this._demMatrixCache[d]){const p=this.sourceCache.sourceCache._source.maxzoom;let y=e.canonical.z-o.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=p?y=e.canonical.z-p:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const P=e.canonical.x-(e.canonical.x>>y<<y),A=e.canonical.y-(e.canonical.y>>y<<y),D=c.bc(new Float64Array(16),[1/(c.X<<y),1/(c.X<<y),0]);c.J(D,D,[P*c.X,A*c.X,0]),this._demMatrixCache[e.key]={matrix:D,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(e){const o=this.painter,d=o.width/devicePixelRatio,p=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new wt(o.context,{width:d,height:p,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new wt(o.context,{width:d,height:p,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(d,p,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,d,p))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,P=0;y<this._coordsTextureSize;y++)for(let A=0;A<this._coordsTextureSize;A++,P+=4)o[P+0]=255&A,o[P+1]=255&y,o[P+2]=A>>8<<4|y>>8,o[P+3]=0;const d=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),p=new wt(e,d,e.gl.RGBA,{premultiply:!1});return p.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),d=this.painter.context,p=d.gl,y=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),P=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),A=Math.round(this.painter.height/devicePixelRatio);d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(y,A-P-1,1,1,p.RGBA,p.UNSIGNED_BYTE,o),d.bindFramebuffer.set(null);const D=o[0]+(o[2]>>4<<8),V=o[1]+((15&o[2])<<8),$=this.coordsIndex[255-o[3]],Z=$&&this.sourceCache.getTileByID($);if(!Z)return null;const te=this._coordsTextureSize,ue=(1<<Z.tileID.canonical.z)*te;return new c.Z((Z.tileID.canonical.x*te+D)/ue+Z.tileID.wrap,(Z.tileID.canonical.y*te+V)/ue,this.getElevation(Z.tileID,D,V,te))}depthAtPoint(e){const o=new Uint8Array(4),d=this.painter.context,p=d.gl;return d.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,o),d.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,o=new c.bd,d=new c.aY,p=this.meshSize,y=c.X/p,P=p*p;for(let Z=0;Z<=p;Z++)for(let te=0;te<=p;te++)o.emplaceBack(te*y,Z*y,0);for(let Z=0;Z<P;Z+=p+1)for(let te=0;te<p;te++)d.emplaceBack(te+Z,p+te+Z+1,p+te+Z+2),d.emplaceBack(te+Z,p+te+Z+2,te+Z+1);const A=o.length,D=A+2*(p+1);for(const Z of[0,1])for(let te=0;te<=p;te++)for(const ue of[0,1])o.emplaceBack(te*y,Z*c.X,ue);for(let Z=0;Z<2*p;Z+=2)d.emplaceBack(D+Z,D+Z+1,D+Z+3),d.emplaceBack(D+Z,D+Z+3,D+Z+2),d.emplaceBack(A+Z,A+Z+3,A+Z+1),d.emplaceBack(A+Z,A+Z+2,A+Z+3);const V=o.length,$=V+2*(p+1);for(const Z of[0,1])for(let te=0;te<=p;te++)for(const ue of[0,1])o.emplaceBack(Z*c.X,te*y,ue);for(let Z=0;Z<2*p;Z+=2)d.emplaceBack(V+Z,V+Z+1,V+Z+3),d.emplaceBack(V+Z,V+Z+3,V+Z+2),d.emplaceBack($+Z,$+Z+3,$+Z+1),d.emplaceBack($+Z,$+Z+2,$+Z+3);return this._mesh=new h(e.createVertexBuffer(o,vc.members),e.createIndexBuffer(d),c.a0.simpleSegment(0,0,o.length,d.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*c.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,o){var d;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(e,o);return(d=this.getMinMaxElevation(p).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(e){const o=this.getTerrainData(e).tile,d={minElevation:null,maxElevation:null};return o&&o.dem&&(d.minElevation=o.dem.min*this.exaggeration,d.maxElevation=o.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(e,o){const d=c.Z.fromLngLat(e.wrap()),p=(1<<o)*c.X,y=d.x*p,P=d.y*p,A=Math.floor(y/c.X),D=Math.floor(P/c.X);return{tileID:new c.S(o,0,o,A,D),mercatorX:y,mercatorY:P}}}class du{constructor(e,o,d){this._context=e,this._size=o,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new wt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(d.texture),{id:e,fbo:o,texture:d,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((o=>e.id!==o)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const ga={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class pu{constructor(e,o){this.painter=e,this.terrain=o,this.pool=new du(e.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((d=>!e._layers[d].isHidden(o))),this._coordsDescendingInv={};for(const d in e.sourceCaches){this._coordsDescendingInv[d]={};const p=e.sourceCaches[d].getVisibleCoordinates();for(const y of p){const P=this.terrain.sourceCache.getTerrainCoords(y);for(const A in P)this._coordsDescendingInv[d][A]||(this._coordsDescendingInv[d][A]=[]),this._coordsDescendingInv[d][A].push(P[A])}}this._coordsDescendingInvStr={};for(const d of e._order){const p=e._layers[d],y=p.source;if(ga[p.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const P in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][P]=this._coordsDescendingInv[y][P].map((A=>A.key)).sort().join()}}for(const d of this._renderableTiles)for(const p in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[p][d.tileID.key];y&&y!==d.rttCoords[p]&&(d.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const o=e.type,d=this.painter,p=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(ga[o]&&(this._prevType&&ga[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(e.id),!p))return!0;if(ga[this._prevType]||ga[o]&&p){this._prevType=o;const y=this._stacks.length-1,P=this._stacks[y]||[];for(const A of this._renderableTiles){if(this.pool.isFull()&&(s(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(A),A.rtt[y]){const V=this.pool.getObjectForId(A.rtt[y].id);if(V.stamp===A.rtt[y].stamp){this.pool.useObject(V);continue}}const D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),A.rtt[y]={id:D.id,stamp:D.stamp},d.context.bindFramebuffer.set(D.fbo.framebuffer),d.context.clear({color:c.aM.transparent,stencil:0}),d.currentStencilSource=void 0;for(let V=0;V<P.length;V++){const $=d.style._layers[P[V]],Z=$.source?this._coordsDescendingInv[$.source][A.tileID.key]:[A.tileID];d.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),d._renderTileClippingMasks($,Z),d.renderLayer(d,d.style.sourceCaches[$.source],$,Z),$.source&&(A.rttCoords[$.source]=this._coordsDescendingInvStr[$.source][A.tileID.key])}}return s(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ga[o]}return!1}}const mu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ul=W,Oo={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Xr,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},yi=_=>{_.touchstart=_.dragStart,_.touchmoveWindow=_.dragMove,_.touchend=_.dragEnd},wi={showCompass:!0,showZoom:!0,visualizePitch:!1};class Fo{constructor(e,o,d=!1){this.mousedown=P=>{this.startMouse(c.e({},P,{ctrlKey:!0,preventDefault:()=>P.preventDefault()}),q.mousePos(this.element,P)),q.addEventListener(window,"mousemove",this.mousemove),q.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=P=>{this.moveMouse(P,q.mousePos(this.element,P))},this.mouseup=P=>{this.mouseRotate.dragEnd(P),this.mousePitch&&this.mousePitch.dragEnd(P),this.offTemp()},this.touchstart=P=>{P.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=q.touchPos(this.element,P.targetTouches)[0],this.startTouch(P,this._startPos),q.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.addEventListener(window,"touchend",this.touchend))},this.touchmove=P=>{P.targetTouches.length!==1?this.reset():(this._lastPos=q.touchPos(this.element,P.targetTouches)[0],this.moveTouch(P,this._lastPos))},this.touchend=P=>{P.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const p=e.dragRotate._mouseRotate.getClickTolerance(),y=e.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=Bu({clickTolerance:p,enable:!0}),this.touchRotate=(({enable:P,clickTolerance:A,bearingDegreesPerPixelMoved:D=.8})=>{const V=new gc;return new uo({clickTolerance:A,move:($,Z)=>({bearingDelta:(Z.x-$.x)*D}),moveStateManager:V,enable:P,assignEvents:yi})})({clickTolerance:p,enable:!0}),this.map=e,d&&(this.mousePitch=gi({clickTolerance:y,enable:!0}),this.touchPitch=(({enable:P,clickTolerance:A,pitchDegreesPerPixelMoved:D=-.5})=>{const V=new gc;return new uo({clickTolerance:A,move:($,Z)=>({pitchDelta:(Z.y-$.y)*D}),moveStateManager:V,enable:P,assignEvents:yi})})({clickTolerance:y,enable:!0})),q.addEventListener(o,"mousedown",this.mousedown),q.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),q.addEventListener(o,"touchcancel",this.reset)}startMouse(e,o){this.mouseRotate.dragStart(e,o),this.mousePitch&&this.mousePitch.dragStart(e,o),q.disableDrag()}startTouch(e,o){this.touchRotate.dragStart(e,o),this.touchPitch&&this.touchPitch.dragStart(e,o),q.disableDrag()}moveMouse(e,o){const d=this.map,{bearingDelta:p}=this.mouseRotate.dragMove(e,o)||{};if(p&&d.setBearing(d.getBearing()+p),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(e,o)||{};y&&d.setPitch(d.getPitch()+y)}}moveTouch(e,o){const d=this.map,{bearingDelta:p}=this.touchRotate.dragMove(e,o)||{};if(p&&d.setBearing(d.getBearing()+p),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(e,o)||{};y&&d.setPitch(d.getPitch()+y)}}off(){const e=this.element;q.removeEventListener(e,"mousedown",this.mousedown),q.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend),q.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){q.enableDrag(),q.removeEventListener(window,"mousemove",this.mousemove),q.removeEventListener(window,"mouseup",this.mouseup),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend)}}let ui;function On(_,e,o){const d=new c.N(_.lng,_.lat);if(_=new c.N(_.lng,_.lat),e){const p=new c.N(_.lng-360,_.lat),y=new c.N(_.lng+360,_.lat),P=o.locationPoint(_).distSqr(e);o.locationPoint(p).distSqr(e)<P?_=p:o.locationPoint(y).distSqr(e)<P&&(_=y)}for(;Math.abs(_.lng-o.center.lng)>180;){const p=o.locationPoint(_);if(p.x>=0&&p.y>=0&&p.x<=o.width&&p.y<=o.height)break;_.lng>o.center.lng?_.lng-=360:_.lng+=360}return _.lng!==d.lng&&o.locationPoint(_).y>o.height/2-o.getHorizon()?_:d}const Gs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function go(_,e,o){const d=_.classList;for(const p in Gs)d.remove(`maplibregl-${o}-anchor-${p}`);d.add(`maplibregl-${o}-anchor-${e}`)}class Cr extends c.E{constructor(e){if(super(),this._onKeyPress=o=>{const d=o.code,p=o.charCode||o.keyCode;d!=="Space"&&d!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=o=>{const d=o.originalEvent.target,p=this._element;this._popup&&(d===p||p.contains(d))&&this.togglePopup()},this._update=o=>{var d;if(!this._map)return;const p=this._map.loaded()&&!this._map.isMoving();(o?.type==="terrain"||o?.type==="render"&&!p)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?On(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let P="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?P="rotateX(0deg)":this._pitchAlignment==="map"&&(P=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||o&&o.type!=="moveend"||(this._pos=this._pos.round()),q.setTransform(this._element,`${Gs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${P} ${y}`),F.frameAsync(new AbortController).then((()=>{this._updateOpacity(o&&o.type==="moveend")})).catch((()=>{}))},this._onMove=o=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=q.create("div");const o=q.createNS("http://www.w3.org/2000/svg","svg"),d=41,p=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${d}px`),o.setAttributeNS(null,"width",`${p}px`),o.setAttributeNS(null,"viewBox",`0 0 ${p} ${d}`);const y=q.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const P=q.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");const A=q.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(3.0, 29.0)"),A.setAttributeNS(null,"fill","#000000");const D=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ve of D){const Se=q.createNS("http://www.w3.org/2000/svg","ellipse");Se.setAttributeNS(null,"opacity","0.04"),Se.setAttributeNS(null,"cx","10.5"),Se.setAttributeNS(null,"cy","5.80029008"),Se.setAttributeNS(null,"rx",ve.rx),Se.setAttributeNS(null,"ry",ve.ry),A.appendChild(Se)}const V=q.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"fill",this._color);const $=q.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),V.appendChild($);const Z=q.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"fill","#000000");const te=q.createNS("http://www.w3.org/2000/svg","path");te.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Z.appendChild(te);const ue=q.createNS("http://www.w3.org/2000/svg","g");ue.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ue.setAttributeNS(null,"fill","#FFFFFF");const he=q.createNS("http://www.w3.org/2000/svg","g");he.setAttributeNS(null,"transform","translate(8.0, 8.0)");const pe=q.createNS("http://www.w3.org/2000/svg","circle");pe.setAttributeNS(null,"fill","#000000"),pe.setAttributeNS(null,"opacity","0.25"),pe.setAttributeNS(null,"cx","5.5"),pe.setAttributeNS(null,"cy","5.5"),pe.setAttributeNS(null,"r","5.4999962");const ge=q.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#FFFFFF"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962"),he.appendChild(pe),he.appendChild(ge),P.appendChild(A),P.appendChild(V),P.appendChild(Z),P.appendChild(ue),P.appendChild(he),o.appendChild(P),o.setAttributeNS(null,"height",d*this._scale+"px"),o.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(o),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(o=>{o.preventDefault()})),this._element.addEventListener("mousedown",(o=>{o.preventDefault()})),go(this._element,this._anchor,"marker"),e&&e.className)for(const o of e.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const p=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var o,d;if(!(!((o=this._map)===null||o===void 0)&&o.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const p=this._map,y=p.terrain.depthAtPoint(this._pos),P=p.terrain.getElevationForLngLatZoom(this._lngLat,p.transform.tileZoom);if(p.transform.lngLatToCameraDepth(this._lngLat,P)-y<.006)return void(this._element.style.opacity=this._opacity);const A=-this._offset.y/p.transform._pixelPerMeter,D=Math.sin(p.getPitch()*Math.PI/180)*A,V=p.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),$=p.transform.lngLatToCameraDepth(this._lngLat,P+D)-V>.006;!((d=this._popup)===null||d===void 0)&&d.isOpen()&&$&&this._popup.remove(),this._element.style.opacity=$?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,o){return e===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const gu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ol=0,Fl=!1;const ws={maxWidth:100,unit:"metric"};function Bl(_,e,o){const d=o&&o.maxWidth||100,p=_._container.clientHeight/2,y=_.unproject([0,p]),P=_.unproject([d,p]),A=y.distanceTo(P);if(o&&o.unit==="imperial"){const D=3.2808*A;D>5280?Ft(e,d,D/5280,_._getUIString("ScaleControl.Miles")):Ft(e,d,D,_._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Ft(e,d,A/1852,_._getUIString("ScaleControl.NauticalMiles")):A>=1e3?Ft(e,d,A/1e3,_._getUIString("ScaleControl.Kilometers")):Ft(e,d,A,_._getUIString("ScaleControl.Meters"))}function Ft(_,e,o,d){const p=(function(y){const P=Math.pow(10,`${Math.floor(y)}`.length-1);let A=y/P;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:(function(D){const V=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*V)/V})(A),P*A})(o);_.style.width=e*(p/o)+"px",_.innerHTML=`${p}&nbsp;${d}`}const sn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},jl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function yu(_){if(_){if(typeof _=="number"){const e=Math.round(Math.abs(_)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,_),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-_),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(_,0),right:new c.P(-_,0)}}if(_ instanceof c.P||Array.isArray(_)){const e=c.P.convert(_);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(_.center||[0,0]),top:c.P.convert(_.top||[0,0]),"top-left":c.P.convert(_["top-left"]||[0,0]),"top-right":c.P.convert(_["top-right"]||[0,0]),bottom:c.P.convert(_.bottom||[0,0]),"bottom-left":c.P.convert(_["bottom-left"]||[0,0]),"bottom-right":c.P.convert(_["bottom-right"]||[0,0]),left:c.P.convert(_.left||[0,0]),right:c.P.convert(_.right||[0,0])}}return yu(new c.P(0,0))}const xc=W;L.AJAXError=c.bh,L.Evented=c.E,L.LngLat=c.N,L.MercatorCoordinate=c.Z,L.Point=c.P,L.addProtocol=c.bi,L.config=c.a,L.removeProtocol=c.bj,L.AttributionControl=ja,L.BoxZoomHandler=Tr,L.CanvasSource=ir,L.CooperativeGesturesHandler=Dl,L.DoubleClickZoomHandler=po,L.DragPanHandler=Vu,L.DragRotateHandler=sh,L.EdgeInsets=H,L.FullscreenControl=class extends c.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var e;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=o?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=q.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);q.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},L.GeoJSONSource=ps,L.GeolocateControl=class extends c.E{constructor(_){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const o=new c.N(e.coords.longitude,e.coords.latitude),d=e.coords.accuracy,p=this._map.getBearing(),y=c.e({bearing:p},this.options.fitBoundsOptions),P=Ye.fromLngLat(o,d);this._map.fitBounds(P,y,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const o=new c.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Fl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=q.create("button","maplibregl-ctrl-geolocate",this._container),q.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Cr({element:this._dotElement}),this._circleElement=q.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))}))}},this.options=c.e({},gu,_)}onAdd(_){return this._map=_,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return c._(this,arguments,void 0,(function*(e=!1){if(ui!==void 0&&!e)return ui;if(window.navigator.permissions===void 0)return ui=!!window.navigator.geolocation,ui;try{ui=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ui=!!window.navigator.geolocation}return ui}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ol=0,Fl=!1}_isOutOfMapMaxBounds(_){const e=this._map.getMaxBounds(),o=_.coords;return e&&(o.longitude<e.getWest()||o.longitude>e.getEast()||o.latitude<e.getSouth()||o.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const _=this._map.getBounds(),e=_.getSouthEast(),o=_.getNorthEast(),d=e.distanceTo(o),p=Math.ceil(this._accuracy/(d/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ol--,Fl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ol++,Ol>1?(_={maximumAge:6e5,timeout:0},Fl=!0):(_=this.options.positionOptions,Fl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},L.Hash=$e,L.ImageSource=As,L.KeyboardHandler=Us,L.LngLatBounds=Ye,L.LogoControl=ma,L.Map=class extends ll{constructor(_){c.bf.mark(c.bg.create);const e=Object.assign(Object.assign({},Oo),_);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new de(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new zn,this._controls=[],this._mapId=c.a4(),this._contextLost=o=>{o.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},mu),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ge.addThrottleControl((()=>this.isMoving())),this._requestManager=new it(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))).on("moveend",(()=>this._update(!1))).on("zoom",(()=>this._update(!0))).on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})).once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const d=De((p=>{this._trackResize&&!this._removed&&(this.resize(p),this.redraw())}),50);this._resizeObserver=new ResizeObserver((p=>{o?d(p):o=!0})),this._resizeObserver.observe(this._container)}this.handlers=new qu(this,e),this._hash=e.hash&&new $e(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,c.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new ja(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new ma,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(o=>{this._update(o.dataType==="style"),this.fire(new c.k(`${o.dataType}data`,o))})),this.on("dataloading",(o=>{this.fire(new c.k(`${o.dataType}dataloading`,o))})),this.on("dataabort",(o=>{this.fire(new c.k("sourcedataabort",o))}))}_getMapId(){return this._mapId}addControl(_,e){if(e===void 0&&(e=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=_.onAdd(this);this._controls.push(_);const d=this._controlPositions[e];return e.indexOf("bottom")!==-1?d.insertBefore(o,d.firstChild):d.appendChild(o),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(_);return e>-1&&this._controls.splice(e,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}calculateCameraOptionsFromTo(_,e,o,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,e,o,d)}resize(_){var e;const o=this._containerDimensions(),d=o[0],p=o[1],y=this._getClampedPixelRatio(d,p);if(this._resizeCanvas(d,p,y),this.painter.resize(d,p,y),this.painter.overLimit()){const A=this.painter.context.gl;this._maxCanvasSize=[A.drawingBufferWidth,A.drawingBufferHeight];const D=this._getClampedPixelRatio(d,p);this._resizeCanvas(d,p,D),this.painter.resize(d,p,D)}this.transform.resize(d,p),(e=this._requestedCameraState)===null||e===void 0||e.resize(d,p);const P=!this._moving;return P&&(this.stop(),this.fire(new c.k("movestart",_)).fire(new c.k("move",_))),this.fire(new c.k("resize",_)),P&&this.fire(new c.k("moveend",_)),this}_getClampedPixelRatio(_,e){const{0:o,1:d}=this._maxCanvasSize,p=this.getPixelRatio(),y=_*p,P=e*p;return Math.min(y>o?o/y:1,P>d?d/P:1)*p}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(Ye.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this._update()}project(_){return this.transform.locationPoint(c.N.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.pointLocation(c.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,e,o){if(_==="mouseenter"||_==="mouseover"){let d=!1;return{layers:e,listener:o,delegates:{mousemove:y=>{const P=e.filter((D=>this.getLayer(D))),A=P.length!==0?this.queryRenderedFeatures(y.point,{layers:P}):[];A.length?d||(d=!0,o.call(this,new Kn(_,this,y.originalEvent,{features:A}))):d=!1},mouseout:()=>{d=!1}}}}if(_==="mouseleave"||_==="mouseout"){let d=!1;return{layers:e,listener:o,delegates:{mousemove:P=>{const A=e.filter((D=>this.getLayer(D)));(A.length!==0?this.queryRenderedFeatures(P.point,{layers:A}):[]).length?d=!0:d&&(d=!1,o.call(this,new Kn(_,this,P.originalEvent)))},mouseout:P=>{d&&(d=!1,o.call(this,new Kn(_,this,P.originalEvent)))}}}}{const d=p=>{const y=e.filter((A=>this.getLayer(A))),P=y.length!==0?this.queryRenderedFeatures(p.point,{layers:y}):[];P.length&&(p.features=P,o.call(this,p),delete p.features)};return{layers:e,listener:o,delegates:{[_]:d}}}}_saveDelegatedListener(_,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(e)}_removeDelegatedListener(_,e,o){if(!this._delegatedListeners||!this._delegatedListeners[_])return;const d=this._delegatedListeners[_];for(let p=0;p<d.length;p++){const y=d[p];if(y.listener===o&&y.layers.length===e.length&&y.layers.every((P=>e.includes(P)))){for(const P in y.delegates)this.off(P,y.delegates[P]);return void d.splice(p,1)}}}on(_,e,o){if(o===void 0)return super.on(_,e);const d=this._createDelegatedListener(_,typeof e=="string"?[e]:e,o);this._saveDelegatedListener(_,d);for(const p in d.delegates)this.on(p,d.delegates[p]);return this}once(_,e,o){if(o===void 0)return super.once(_,e);const d=typeof e=="string"?[e]:e,p=this._createDelegatedListener(_,d,o);for(const y in p.delegates){const P=p.delegates[y];p.delegates[y]=(...A)=>{this._removeDelegatedListener(_,d,o),P(...A)}}this._saveDelegatedListener(_,p);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(_,e,o){return o===void 0?super.off(_,e):(this._removeDelegatedListener(_,typeof e=="string"?[e]:e,o),this)}queryRenderedFeatures(_,e){if(!this.style)return[];let o;const d=_ instanceof c.P||Array.isArray(_),p=d?_:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(d?{}:_)||{},p instanceof c.P||typeof p[0]=="number")o=[c.P.convert(p)];else{const y=c.P.convert(p[0]),P=c.P.convert(p[1]);o=[y,new c.P(P.x,y.y),P,new c.P(y.x,P.y),y]}return this.style.queryRenderedFeatures(o,e,this.transform)}querySourceFeatures(_,e){return this.style.querySourceFeatures(_,e)}setStyle(_,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(_,e))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const e=this._locale[_];if(e==null)throw new Error(`Missing UI string '${_}'`);return e}_updateStyle(_,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(_,e)));const o=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new Wo(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,e,o):this.style.loadJSON(_,e,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Wo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,e){if(typeof _=="string"){const o=this._requestManager.transformRequest(_,"Style");c.h(o,new AbortController).then((d=>{this._updateDiff(d.data,e)})).catch((d=>{d&&this.fire(new c.j(d))}))}else typeof _=="object"&&this._updateDiff(_,e)}_updateDiff(_,e){try{this.style.setState(_,e)&&this._update(!0)}catch(o){c.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(_,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(_,e){return this._lazyInitEmptyStyle(),this.style.addSource(_,e),this._update(!0)}isSourceLoaded(_){const e=this.style&&this.style.sourceCaches[_];if(e!==void 0)return e.loaded();this.fire(new c.j(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const e=this.style.sourceCaches[_.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&e.reload();for(const o in this.style._layers){const d=this.style._layers[o];d.type==="hillshade"&&d.source===_.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new mo(this.painter,e,_),this.painter.renderToTexture=new pu(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==_.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:_})),this}getTerrain(){var _,e;return(e=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const e in _){const o=_[e]._tiles;for(const d in o){const p=o[d];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,e,o={}){const{pixelRatio:d=1,sdf:p=!1,stretchX:y,stretchY:P,content:A,textFitWidth:D,textFitHeight:V}=o;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:$,height:Z,data:te}=e,ue=e;return this.style.addImage(_,{data:new c.R({width:$,height:Z},new Uint8Array(te)),pixelRatio:d,stretchX:y,stretchY:P,content:A,textFitWidth:D,textFitHeight:V,sdf:p,version:0,userImage:ue}),ue.onAdd&&ue.onAdd(this,_),this}}{const{width:$,height:Z,data:te}=F.getImageData(e);this.style.addImage(_,{data:new c.R({width:$,height:Z},te),pixelRatio:d,stretchX:y,stretchY:P,content:A,textFitWidth:D,textFitHeight:V,sdf:p,version:0})}}updateImage(_,e){const o=this.style.getImage(_);if(!o)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=e instanceof HTMLImageElement||c.b(e)?F.getImageData(e):e,{width:p,height:y,data:P}=d;if(p===void 0||y===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==o.data.width||y!==o.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const A=!(e instanceof HTMLImageElement||c.b(e));return o.data.replace(P,A),this.style.updateImage(_,o),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return Ge.getImage(this._requestManager.transformRequest(_,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,e){return this._lazyInitEmptyStyle(),this.style.addLayer(_,e),this._update(!0)}moveLayer(_,e){return this.style.moveLayer(_,e),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,e,o){return this.style.setLayerZoomRange(_,e,o),this._update(!0)}setFilter(_,e,o={}){return this.style.setFilter(_,e,o),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,e,o,d={}){return this.style.setPaintProperty(_,e,o,d),this._update(!0)}getPaintProperty(_,e){return this.style.getPaintProperty(_,e)}setLayoutProperty(_,e,o,d={}){return this.style.setLayoutProperty(_,e,o,d),this._update(!0)}getLayoutProperty(_,e){return this.style.getLayoutProperty(_,e)}setGlyphs(_,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,e,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,e,o,(d=>{d||this._update(!0)})),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,e,(o=>{o||this._update(!0)})),this}setLight(_,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(_){return this._lazyInitEmptyStyle(),this.style.setSky(_),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(_,e){return this.style.setFeatureState(_,e),this._update()}removeFeatureState(_,e){return this.style.removeFeatureState(_,e),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,e=0;return this._container&&(_=this._container.clientWidth||400,e=this._container.clientHeight||300),[_,e]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const e=this._canvasContainer=q.create("div","maplibregl-canvas-container",_);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=q.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),d=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],d);const p=this._controlContainer=q.create("div","maplibregl-control-container",_),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((P=>{y[P]=q.create("div",`maplibregl-ctrl-${P} `,p)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,e,o){this._canvas.width=Math.floor(o*_),this._canvas.height=Math.floor(o*e),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const _={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",(d=>{e={requestedAttributes:_},d&&(e.statusMessage=d.statusMessage,e.type=d.type)}),{once:!0});const o=this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_);if(!o){const d="Failed to initialize WebGL";throw e?(e.message=d,new Error(JSON.stringify(e))):new Error(d)}this.painter=new b(o,this.transform),se.testSupport(o)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const p=this.transform.zoom,y=F.now();this.style.zoomHistory.update(p,y);const P=new c.z(p,{now:y,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),A=P.crossFadingFactor();A===1&&A===this._crossFadingFactor||(o=!0,this._crossFadingFactor=A),this.style.update(P)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bf.mark(c.bg.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,c.bf.mark(c.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ge.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),q.remove(this._canvasContainer),q.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bf.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,F.frameAsync(this._frameRequest).then((_=>{c.bf.frame(_),this._frameRequest=null,this._render(_)})).catch((()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return ul}getCameraTargetElevation(){return this.transform.elevation}},L.MapMouseEvent=Kn,L.MapTouchEvent=xr,L.MapWheelEvent=oo,L.Marker=Cr,L.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const e=this._map.getZoom(),o=e===this._map.getMaxZoom(),d=e===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,o)=>{const d=this._map._getUIString(`NavigationControl.${o}`);e.title=d,e.setAttribute("aria-label",d)},this.options=c.e({},wi,_),this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),q.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),q.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=q.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Fo(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,e){const o=q.create("button",_,this._container);return o.type="button",o.addEventListener("click",e),o}},L.Popup=class extends c.E{constructor(_){super(),this.remove=()=>(this._content&&q.remove(this._content),this._container&&(q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var o;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=q.create("div","maplibregl-popup",this._map.getContainer()),this._tip=q.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const A of this.options.className.split(" "))this._container.classList.add(A);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?On(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._trackPointer&&!e)return;const d=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let p=this.options.anchor;const y=yu(this.options.offset);if(!p){const A=this._container.offsetWidth,D=this._container.offsetHeight;let V;V=d.y+y.bottom.y<D?["top"]:d.y>this._map.transform.height-D?["bottom"]:[],d.x<A/2?V.push("left"):d.x>this._map.transform.width-A/2&&V.push("right"),p=V.length===0?"bottom":V.join("-")}let P=d.add(y[p]);this.options.subpixelPositioning||(P=P.round()),q.setTransform(this._container,`${Gs[p]} translate(${P.x}px,${P.y}px)`),go(this._container,p,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(sn),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=c.N.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const e=document.createDocumentFragment(),o=document.createElement("body");let d;for(o.innerHTML=_;d=o.firstChild,d;)e.appendChild(d);return this.setDOMContent(e)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=q.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){return this._container&&this._container.classList.add(_),this}removeClassName(_){return this._container&&this._container.classList.remove(_),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=q.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(jl);_&&_.focus()}},L.RasterDEMTileSource=ai,L.RasterTileSource=lt,L.ScaleControl=class{constructor(_){this._onMove=()=>{Bl(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Bl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ws),_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},L.ScrollZoomHandler=ns,L.Style=Wo,L.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=q.create("button","maplibregl-ctrl-terrain",this._container),q.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},L.TwoFingersTouchPitchHandler=Nl,L.TwoFingersTouchRotateHandler=Rl,L.TwoFingersTouchZoomHandler=fu,L.TwoFingersTouchZoomRotateHandler=Uu,L.VectorTileSource=Co,L.VideoSource=vn,L.addSourceType=(_,e)=>c._(void 0,void 0,void 0,(function*(){if(oa(_))throw new Error(`A source type called "${_}" already exists.`);((o,d)=>{aa[o]=d})(_,e)})),L.clearPrewarmedResources=function(){const _=Rn;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(Pt),Rn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},L.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},L.getRTLTextPluginStatus=function(){return tn().getRTLTextPluginStatus()},L.getVersion=function(){return xc},L.getWorkerCount=function(){return yn.workerCount},L.getWorkerUrl=function(){return c.a.WORKER_URL},L.importScriptInWorkers=function(_){return Kt().broadcast("IS",_)},L.prewarm=function(){ei().acquire(Pt)},L.setMaxParallelImageRequests=function(_){c.a.MAX_PARALLEL_IMAGE_REQUESTS=_},L.setRTLTextPlugin=function(_,e){return tn().setRTLTextPlugin(_,e)},L.setWorkerCount=function(_){yn.workerCount=_},L.setWorkerUrl=function(_){c.a.WORKER_URL=_}}));var N=S;return N}))})(Xd)),Xd.exports}var B0=F0();const j0=Uf(B0);function V0(k){return{type:"FeatureCollection",features:k?[{type:"Feature",properties:{},geometry:k}]:[]}}const U0="candidate";function q0(){const k=vi.useRef(null),w=vi.useRef(null),S=vi.useRef(null),E=Zn(F=>F.candidate),T=Zn(F=>F.seekerLngLat),N=Zn(F=>F.isBusy),L=Zn(F=>F.busyMessage),[c,W]=vi.useState(!1),ee=vi.useMemo(()=>{if(!E)return null;try{const se=Sv({type:"Feature",properties:{},geometry:E},{tolerance:5e-4,highQuality:!0})?.geometry;return se&&(se.type==="Polygon"||se.type==="MultiPolygon")?se:E}catch{return E}},[E]),Q=vi.useMemo(()=>V0(ee),[ee]);return vi.useEffect(()=>{if(k.current){console.error("VITE_MAPTILER_KEY is not set");return}},[]),vi.useEffect(()=>{let F=null;return N?F=setTimeout(()=>W(!0),150):W(!1),()=>{F&&clearTimeout(F)}},[N]),vi.useEffect(()=>{const F=w.current;if(!F||!F.isStyleLoaded())return;const q=F.getSource(U0);if(q&&(q.setData(Q),E)){const se=oc(E);F.fitBounds([[se[0],se[1]],[se[2],se[3]]],{padding:40,duration:450})}},[Q,E]),vi.useEffect(()=>{const F=w.current;if(!F||(S.current?.remove(),S.current=null,!T))return;const q=new j0.Marker().setLngLat(T).addTo(F);S.current=q},[T]),Le.jsxs("div",{className:"mapPane",children:[Le.jsx("div",{className:"mapRoot",ref:k}),c&&Le.jsx("div",{className:"mapOverlay",children:Le.jsx("div",{className:"mapOverlayBox",children:L||"Loading"})})]})}function G0(){const k=Zn(Ce=>Ce.candidate),w=Zn(Ce=>Ce.seekerLngLat),S=Zn(Ce=>Ce.seekerAccuracyM),E=Zn(Ce=>Ce.seekerLastUpdatedMs),T=Zn(Ce=>Ce.isTrackingGPS),N=Zn(Ce=>Ce.updateSeekerFromGPS),L=Zn(Ce=>Ce.startGPSTracking),c=Zn(Ce=>Ce.stopGPSTracking),W=Zn(Ce=>Ce.undo),ee=Zn(Ce=>Ce.redo),Q=Zn(Ce=>Ce.resetCandidateToCountry),F=Zn(Ce=>Ce.searchQuery),q=Zn(Ce=>Ce.searchResults),se=Zn(Ce=>Ce.setSearchQuery),le=Zn(Ce=>Ce.runSearch),fe=Zn(Ce=>Ce.selectSearchResult),Ie=async()=>{try{await le()}catch(Ce){alert(String(Ce instanceof Error?Ce.message:Ce))}},Be=(Ce,Ge=50)=>Ce.length<=Ge?Ce:Ce.slice(0,Ge-3)+"...";return Le.jsxs(Le.Fragment,{children:[Le.jsxs("section",{className:"panel",children:[Le.jsx("div",{className:"panelHeader search",children:"SEARCH AREA"}),Le.jsxs("div",{className:"panelBody",children:[!k&&Le.jsx("div",{style:{fontSize:"12px",color:"#666",fontStyle:"italic"},children:"Select an area to begin"}),Le.jsxs("div",{className:"row",children:[Le.jsx("input",{type:"text",value:F,onChange:Ce=>se(Ce.target.value),onKeyDown:Ce=>{Ce.key==="Enter"&&Ie()},placeholder:"e.g., Los Angeles, California, Europe"}),Le.jsx("button",{className:"btn",onClick:Ie,children:"Search"})]}),q.length>0&&Le.jsx("div",{className:"search-results",children:q.map((Ce,Ge)=>Le.jsxs("div",{className:"search-result-item",onClick:()=>fe(Ce),children:[Le.jsx("div",{className:"search-result-title",children:Be(Ce.display_name)}),Le.jsxs("div",{className:"search-result-meta",children:[Ce.class&&Ce.type&&`${Ce.class}/${Ce.type}`,Ce.address?.country&&Le.jsxs("span",{children:[Ce.class&&Ce.type?"  ":"",Ce.address.country]})]})]},Ge))})]})]}),Le.jsxs("section",{className:"panel",children:[Le.jsx("div",{className:"panelHeader seeker",children:"SEEKER GPS"}),Le.jsxs("div",{className:"panelBody",children:[Le.jsxs("div",{className:"row",children:[Le.jsx("button",{className:"btn primary",onClick:()=>N().catch(Ce=>alert(Ce?.message??String(Ce))),children:"Use GPS"}),Le.jsx("button",{className:"btn",onClick:()=>{if(T)c();else try{L()}catch(Ce){alert(Ce instanceof Error?Ce.message:String(Ce))}},children:T?"Stop Tracking":"Track GPS"}),Le.jsx("button",{className:"btn",onClick:Q,children:"Reset Area"}),Le.jsx("button",{className:"btn",onClick:W,children:"Undo"}),Le.jsx("button",{className:"btn",onClick:ee,children:"Redo"})]}),w?Le.jsxs("div",{className:"coords-display",children:[w[0].toFixed(5),", ",w[1].toFixed(5),S&&`  ${Math.round(S)}m`,E&&Le.jsxs(Le.Fragment,{children:[Le.jsx("br",{}),"Last updated: ",new Date(E).toLocaleTimeString()]})]}):Le.jsx("div",{className:"coords-display",style:{color:"#999",fontStyle:"italic"},children:"No seeker position yet."})]})]})]})}function th(k){return new Date(k).toLocaleString()}function $0(){const k=Zn(w=>w.history);return Le.jsxs("div",{className:"history-panel",children:[Le.jsx("strong",{children:"History"}),Le.jsxs("div",{className:"history-list",children:[k.length===0&&Le.jsx("small",{className:"muted",children:"No actions yet."}),k.slice().reverse().map(w=>{switch(w.type){case"SET_COUNTRY":return Le.jsxs("div",{className:"history-item",children:[Le.jsx("div",{className:"history-timestamp",children:th(w.ts)}),Le.jsxs("div",{className:"history-action",children:[Le.jsx("span",{className:"history-action-label",children:"Area:"})," ",w.name??w.isoA2," (",w.isoA2,")"]})]},w.id);case"SET_AREA":return Le.jsxs("div",{className:"history-item",children:[Le.jsx("div",{className:"history-timestamp",children:th(w.ts)}),Le.jsxs("div",{className:"history-action",children:[Le.jsx("span",{className:"history-action-label",children:"Area:"})," ",w.label]})]},w.id);case"POI_WITHIN":return Le.jsxs("div",{className:"history-item",children:[Le.jsx("div",{className:"history-timestamp",children:th(w.ts)}),Le.jsxs("div",{className:"history-action",children:[Le.jsx("span",{className:"history-action-label",children:"POI:"})," ",w.kind," ",w.radiusMiles," mi ",w.answer," (",w.poiCount," found)"]})]},w.id);case"RADAR":return Le.jsxs("div",{className:"history-item",children:[Le.jsx("div",{className:"history-timestamp",children:th(w.ts)}),Le.jsxs("div",{className:"history-action",children:[Le.jsx("span",{className:"history-action-label",children:"Radar:"})," ",w.hit?"Hit":"Miss"," ",w.radiusMiles," mi"]})]},w.id);case"THERMOMETER":return Le.jsxs("div",{className:"history-item",children:[Le.jsx("div",{className:"history-timestamp",children:th(w.ts)}),Le.jsxs("div",{className:"history-action",children:[Le.jsx("span",{className:"history-action-label",children:"Thermometer:"})," ",w.hotter?"Hotter":"Colder"]})]},w.id);case"MATCHING":return Le.jsxs("div",{className:"history-item",children:[Le.jsx("div",{className:"history-timestamp",children:th(w.ts)}),Le.jsxs("div",{className:"history-action",children:[Le.jsx("span",{className:"history-action-label",children:"Matching:"})," ",w.kind," ",w.answer," (",w.poiCount," POIs)"]})]},w.id);case"MEASURING":return Le.jsxs("div",{className:"history-item",children:[Le.jsx("div",{className:"history-timestamp",children:th(w.ts)}),Le.jsxs("div",{className:"history-action",children:[Le.jsx("span",{className:"history-action-label",children:"Measuring:"})," ",w.kind," ",w.answer," (",w.poiCount," POIs)"]})]},w.id);default:return null}})]})]})}function Z0({isOpen:k,onClose:w,initialQuery:S=""}){const E=Zn(le=>le.searchQuery),T=Zn(le=>le.searchResults),N=Zn(le=>le.setSearchQuery),L=Zn(le=>le.runSearch),c=Zn(le=>le.selectSearchResult),W=vi.useRef(null),ee=vi.useRef(null),[Q,F]=vi.useState(-1);if(vi.useEffect(()=>{k&&W.current&&(setTimeout(()=>{W.current?.focus()},0),S?(N(S),setTimeout(()=>{L().catch(()=>{})},50)):E||N(""),F(-1))},[k,S,N,E,L]),vi.useEffect(()=>{if(!k)return;const le=fe=>{fe.key==="Escape"&&(w(),fe.preventDefault(),fe.stopPropagation())};return window.addEventListener("keydown",le,!0),()=>{window.removeEventListener("keydown",le,!0)}},[k,w]),vi.useEffect(()=>()=>{ee.current&&clearTimeout(ee.current)},[]),vi.useEffect(()=>{T.length>0&&Q>=T.length&&F(-1)},[T.length,Q]),!k)return null;const q=(le,fe=60)=>le.length<=fe?le:le.slice(0,fe-3)+"...",se=le=>{c(le),w()};return Le.jsx("div",{className:"quick-search-overlay",onClick:w,children:Le.jsxs("div",{className:"quick-search-panel",onClick:le=>le.stopPropagation(),children:[Le.jsx("input",{ref:W,type:"text",className:"quick-search-input",value:E,onChange:le=>{N(le.target.value),F(-1),ee.current&&clearTimeout(ee.current),ee.current=setTimeout(()=>{L().catch(()=>{})},300)},onKeyDown:le=>{le.key==="ArrowDown"?(le.preventDefault(),F(fe=>fe<T.length-1?fe+1:fe)):le.key==="ArrowUp"?(le.preventDefault(),F(fe=>fe>0?fe-1:-1)):le.key==="Enter"?(le.preventDefault(),T.length>0&&Q>=0?(c(T[Q]),w()):T.length>0&&(c(T[0]),w())):le.key==="Escape"&&le.stopPropagation()},placeholder:"Search for a place..."}),T.length>0&&Le.jsx("div",{className:"quick-search-results",children:T.map((le,fe)=>Le.jsxs("div",{className:`quick-search-result-item ${fe===Q?"highlighted":""}`,onClick:()=>se(le),onMouseEnter:()=>F(fe),children:[Le.jsx("div",{className:"quick-search-result-title",children:q(le.display_name)}),Le.jsxs("div",{className:"quick-search-result-meta",children:[le.class&&le.type&&`${le.class}/${le.type}`,le.address?.country&&Le.jsxs("span",{children:[le.class&&le.type?"  ":"",le.address.country]})]})]},fe))})]})})}const Rf={Matching:Le.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20",children:Le.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})}),Measuring:Le.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20",children:Le.jsx("path",{d:"M21.71 11.29l-9-9c-.39-.39-1.02-.39-1.41 0l-9 9c-.39.39-.39 1.02 0 1.41l9 9c.39.39 1.02.39 1.41 0l9-9c.39-.38.39-1.01 0-1.41zM14 14.5V12h-4v3H8v-4c0-.55.45-1 1-1h5V7.5l3.5 3.5-3.5 3.5z"})}),Radar:Le.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20",children:[Le.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5.5-2.5l7.51-3.27-7.5-3.22zm6.31-4.06l-2.06.9 2.06.91z"}),Le.jsx("circle",{cx:"12",cy:"12",r:"2"})]}),Thermometer:Le.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20",children:Le.jsx("path",{d:"M15 13V5c0-1.66-1.34-3-3-3S9 3.34 9 5v8c-1.21.91-2 2.37-2 4 0 2.76 2.24 5 5 5s5-2.24 5-5c0-1.63-.79-3.09-2-4zm-4-2V5c0-.55.45-1 1-1s1 .45 1 1v1h-1v1h1v2h-2z"})}),Tentacles:Le.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"20",height:"20",children:[Le.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),Le.jsx("path",{d:"M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z"})]})};function H0({kind:k,label:w,onClose:S,onAnswer:E}){const[T,N]=vi.useState(5),L=[1,3,5,10,25],c=W=>{E(T,W),S()};return Le.jsx("div",{className:"poi-modal-overlay",onClick:S,children:Le.jsxs("div",{className:"poi-modal-panel",onClick:W=>W.stopPropagation(),children:[Le.jsxs("div",{className:"poi-modal-header",children:[Le.jsxs("h3",{children:["POI  ",w]}),Le.jsx("button",{className:"poi-modal-close",onClick:S,children:""})]}),Le.jsxs("div",{className:"poi-modal-content",children:[Le.jsxs("div",{className:"poi-modal-prompt",children:["Within ",Le.jsxs("strong",{children:[T," mi"]})," of a ",Le.jsx("strong",{children:w.toLowerCase()}),"?"]}),Le.jsxs("div",{className:"poi-modal-radii",children:[Le.jsx("div",{className:"section-label",children:"Radius"}),Le.jsx("div",{className:"tile-grid",children:L.map(W=>Le.jsxs("button",{className:`tile-button ${T===W?"selected":""}`,onClick:()=>N(W),children:[W," mi"]},W))})]}),Le.jsxs("div",{className:"poi-modal-answers",children:[Le.jsx("button",{className:"tile-button yellow large",onClick:()=>c("YES"),children:"YES"}),Le.jsx("button",{className:"tile-button yellow large",onClick:()=>c("NO"),children:"NO"})]})]})]})})}const Yg=[{miles:.5,label:"0.5 MI"},{miles:1,label:"1 MI"},{miles:3,label:"3 MI"},{miles:5,label:"5 MI"},{miles:10,label:"10 MI"},{miles:25,label:"25 MI"},{miles:50,label:"50 MI"},{miles:100,label:"100 MI"}],Qp=[{id:"airport",label:"Airport",kind:"airport"},{id:"rail",label:"Rail Station",kind:"trainstation"},{id:"transit_line",label:"Transit Line",kind:"metro_station"},{id:"highway",label:"Highway Access",kind:"highway_access"},{id:"admin1",label:"Admin 1",adminLevel:1},{id:"admin2",label:"Admin 2",adminLevel:2},{id:"admin3",label:"Admin 3",adminLevel:3},{id:"admin4",label:"Admin 4",adminLevel:4},{id:"mountain",label:"Mountain",kind:"peak"},{id:"park",label:"Park",kind:"park"},{id:"water",label:"Water/Coast",kind:"water"},{id:"landmass",label:"Landmass",disabled:!0,reason:"Requires landmask dataset"},{id:"hospital",label:"Hospital",kind:"hospital"},{id:"library",label:"Library",kind:"library"},{id:"government",label:"Government",kind:"government"}],X0=[{label:"Airport",kind:"airport"},{label:"Rail Station",kind:"trainstation"},{label:"Transit Line",kind:"metro_station"},{label:"Mountain",kind:"peak"},{label:"Park",kind:"park"},{label:"Water/Coast",kind:"water"},{label:"Hospital",kind:"hospital"},{label:"Library",kind:"library"},{label:"Museum",kind:"museum"},{label:"Zoo",kind:"zoo"},{label:"Government",kind:"government"}],W0=[{label:"Airport",kind:"airport",radiusMiles:15,distLabel:"15 mi"},{label:"Park",kind:"park",radiusMiles:15,distLabel:"15 mi"},{label:"Mountain",kind:"peak",radiusMiles:15,distLabel:"15 mi"},{label:"Transit",kind:"transit_station",radiusMiles:15,distLabel:"15 mi"},{label:"Airport",kind:"airport",radiusMiles:1,distLabel:"1 mi"},{label:"Park",kind:"park",radiusMiles:1,distLabel:"1 mi"},{label:"Mountain",kind:"peak",radiusMiles:1,distLabel:"1 mi"},{label:"Transit",kind:"transit_station",radiusMiles:1,distLabel:"1 mi"}],Y0=[{kind:"zoo",label:"Zoo"},{kind:"hospital",label:"Hospital"},{kind:"museum",label:"Museum"},{kind:"library",label:"Library"},{kind:"university",label:"University"},{kind:"school",label:"School"},{kind:"police",label:"Police"},{kind:"firestation",label:"Fire Station"},{kind:"courthouse",label:"Courthouse"},{kind:"townhall",label:"Town Hall"},{kind:"embassy",label:"Embassy"},{kind:"park",label:"Park"},{kind:"stadium",label:"Stadium"},{kind:"themepark",label:"Theme Park"},{kind:"castle",label:"Castle"},{kind:"peak",label:"Peak"},{kind:"airport",label:"Airport"},{kind:"trainstation",label:"Train Station"},{kind:"ferry",label:"Ferry Terminal"}];function K0(){const k=Zn(je=>je.candidate),w=Zn(je=>je.seekerLngLat),S=Zn(je=>je.thermoStart),E=Zn(je=>je.thermoEnd),T=Zn(je=>je.setThermoStartNow),N=Zn(je=>je.setThermoEndNow),L=Zn(je=>je.applyRadarNow),c=Zn(je=>je.applyThermo),W=Zn(je=>je.applyPoiWithin),ee=Zn(je=>je.applyMatching),Q=Zn(je=>je.applyMatchingAdmin),F=Zn(je=>je.applyMeasuring),[q,se]=vi.useState(null),[le,fe]=vi.useState(""),[Ie,Be]=vi.useState(null),[Ce,Ge]=vi.useState(null),[it,We]=vi.useState("CLOSER"),[tt,at]=vi.useState(null),[ht,ft]=vi.useState(""),[$t,wt]=vi.useState(null),Zt=(je,zt)=>{se(je),fe(zt)},Bt=async(je,zt)=>{q&&await W(q,je,zt)};return Le.jsxs("div",{className:"jlMenu",children:[Le.jsx("div",{className:"jlBanner",children:"QUESTION MENU"}),Le.jsxs("div",{className:"jlColumns",children:[Le.jsx("section",{className:"jlCol",children:Le.jsxs("div",{className:"jlCategory",children:[Le.jsxs("div",{className:"jlCatHeader",children:[Le.jsx("div",{className:"jlCatIcon matching",children:Rf.Matching}),Le.jsxs("div",{className:"jlCatTitles",children:[Le.jsx("div",{className:"jlCatTitle",children:"MATCHING"}),Le.jsx("div",{className:"jlCatSub",children:"DRAW 3, PICK 1"})]})]}),!w&&Le.jsx("div",{style:{fontSize:"11px",color:"#d32f2f",fontWeight:600,marginTop:"4px"},children:"Requires seeker GPS"}),Le.jsx("div",{className:"jlGrid matching",children:Qp.map(je=>{const zt=je.disabled||!k||!w,an=je.id==="landmass"?je.reason:w?k?"":"Requires area":"Requires seeker GPS";return Le.jsx("button",{className:`jlTile matching${zt?" disabled":""}`,disabled:zt,onClick:()=>Be(je.id),type:"button",title:an,children:je.label},je.id)})}),Ie&&Le.jsxs("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap"},children:[Le.jsx("button",{type:"button",className:"tileBtn",onClick:()=>{const je=Qp.find(zt=>zt.id===Ie);if(je){if("adminLevel"in je)return Q(je.adminLevel,"YES");if("kind"in je)return ee(je.kind,"YES")}},disabled:!k||!w,children:"YES"}),Le.jsx("button",{type:"button",className:"tileBtn",onClick:()=>{const je=Qp.find(zt=>zt.id===Ie);if(je){if("adminLevel"in je)return Q(je.adminLevel,"NO");if("kind"in je)return ee(je.kind,"NO")}},disabled:!k||!w,children:"NO"}),Le.jsx("button",{type:"button",className:"tileBtn",onClick:()=>Be(null),children:"Clear"})]})]})}),Le.jsx("section",{className:"jlCol",children:Le.jsxs("div",{className:"jlCategory",children:[Le.jsxs("div",{className:"jlCatHeader",children:[Le.jsx("div",{className:"jlCatIcon measuring",children:Rf.Measuring}),Le.jsxs("div",{className:"jlCatTitles",children:[Le.jsx("div",{className:"jlCatTitle",children:"MEASURING"}),Le.jsx("div",{className:"jlCatSub",children:"DRAW 3, PICK 1"})]})]}),!w&&Le.jsx("div",{style:{fontSize:"11px",color:"#d32f2f",fontWeight:600,marginTop:"4px"},children:"Requires seeker GPS"}),Le.jsx("div",{className:"jlGrid measuring",children:X0.map(je=>Le.jsx("button",{className:"jlTile measuring",disabled:!k||!w,onClick:()=>{Ge(je.kind),F(je.kind,it)},type:"button",children:je.label},je.kind))}),Ce&&Le.jsxs("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap"},children:[Le.jsx("button",{type:"button",className:"tileBtn",onClick:()=>{We("CLOSER"),F(Ce,"CLOSER")},disabled:!k||!w,children:"CLOSER"}),Le.jsx("button",{type:"button",className:"tileBtn",onClick:()=>{We("FARTHER"),F(Ce,"FARTHER")},disabled:!k||!w,children:"FARTHER"}),Le.jsx("button",{type:"button",className:"tileBtn",onClick:()=>Ge(null),children:"Clear"})]})]})}),Le.jsx("section",{className:"jlCol",children:Le.jsxs("div",{className:"jlCategory",children:[Le.jsxs("div",{className:"jlCatHeader",children:[Le.jsx("div",{className:"jlCatIcon radar",children:Rf.Radar}),Le.jsxs("div",{className:"jlCatTitles",children:[Le.jsx("div",{className:"jlCatTitle",children:"RADAR"}),Le.jsx("div",{className:"jlCatSub",children:"DRAW 2, PICK 1"})]})]}),!w&&Le.jsx("div",{style:{fontSize:"11px",color:"#d32f2f",fontWeight:600,marginTop:"4px"},children:"Requires seeker GPS"}),Le.jsx("div",{className:"section-label",style:{marginTop:"8px",fontSize:"10px",opacity:.7},children:"HIT"}),Le.jsxs("div",{className:"jlGrid radar",children:[Yg.map(je=>Le.jsxs("button",{className:"jlTile radar",onClick:()=>L(je.miles,!0),disabled:!w||!k,style:{flexDirection:"column",gap:2,lineHeight:1},children:[Le.jsx("span",{style:{fontSize:10,opacity:.8},children:"HIT"}),Le.jsx("span",{children:je.label})]},`hit-${je.miles}`)),Le.jsxs("button",{className:"jlTile radar",onClick:()=>at("HIT"),disabled:!w||!k,style:{flexDirection:"column",gap:2,lineHeight:1},type:"button",children:[Le.jsx("span",{style:{fontSize:10,opacity:.8},children:"HIT"}),Le.jsx("span",{children:"CUSTOM"})]})]}),Le.jsx("div",{className:"section-label",style:{marginTop:"14px",fontSize:"10px",opacity:.7},children:"MISS"}),Le.jsxs("div",{className:"jlGrid radar",children:[Yg.map(je=>Le.jsxs("button",{className:"jlTile radar",onClick:()=>L(je.miles,!1),disabled:!w||!k,style:{flexDirection:"column",gap:2,lineHeight:1},children:[Le.jsx("span",{style:{fontSize:10,opacity:.8},children:"MISS"}),Le.jsx("span",{children:je.label})]},`miss-${je.miles}`)),Le.jsxs("button",{className:"jlTile radar",onClick:()=>at("MISS"),disabled:!w||!k,style:{flexDirection:"column",gap:2,lineHeight:1},type:"button",children:[Le.jsx("span",{style:{fontSize:10,opacity:.8},children:"MISS"}),Le.jsx("span",{children:"CUSTOM"})]})]}),tt&&Le.jsxs("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap",alignItems:"center"},children:[Le.jsxs("div",{style:{fontSize:12,fontWeight:800},children:["Custom ",tt.toLowerCase()," (miles):"]}),Le.jsx("input",{value:ht,onChange:je=>ft(je.target.value),inputMode:"decimal",placeholder:"e.g. 7.5",style:{width:110,padding:"10px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,.2)"}}),Le.jsx("button",{type:"button",className:"tileBtn",onClick:()=>{const je=Number(ht);!Number.isFinite(je)||je<=0||(L(je,tt==="HIT"),at(null),ft(""))},disabled:!w||!k,children:"Apply"}),Le.jsx("button",{type:"button",className:"tileBtn",onClick:()=>{at(null),ft("")},children:"Cancel"})]})]})}),Le.jsxs("section",{className:"jlCol",children:[Le.jsxs("div",{className:"jlCategory",children:[Le.jsxs("div",{className:"jlCatHeader",children:[Le.jsx("div",{className:"jlCatIcon thermo",children:Rf.Thermometer}),Le.jsxs("div",{className:"jlCatTitles",children:[Le.jsx("div",{className:"jlCatTitle",children:"THERMOMETER"}),Le.jsx("div",{className:"jlCatSub",children:"DRAW 2, PICK 1"})]})]}),Le.jsxs("div",{className:"jlGrid thermo",children:[Le.jsxs("button",{className:"jlTile thermo",onClick:T,disabled:!w||!k,style:{flexDirection:"column",gap:2,lineHeight:1},children:[Le.jsx("span",{children:"SET"}),Le.jsx("span",{children:"START"})]}),Le.jsxs("button",{className:"jlTile thermo",onClick:N,disabled:!w||!k,style:{flexDirection:"column",gap:2,lineHeight:1},children:[Le.jsx("span",{children:"SET"}),Le.jsx("span",{children:"END"})]}),Le.jsx("button",{className:"jlTile thermo",onClick:()=>c(!0),disabled:!k||!S||!E,children:"HOTTER"}),Le.jsx("button",{className:"jlTile thermo",onClick:()=>c(!1),disabled:!k||!S||!E,children:"COLDER"})]})]}),Le.jsxs("div",{className:"jlCategory",style:{marginTop:"24px"},children:[Le.jsxs("div",{className:"jlCatHeader",children:[Le.jsx("div",{className:"jlCatIcon tentacles",children:Rf.Tentacles}),Le.jsxs("div",{className:"jlCatTitles",children:[Le.jsx("div",{className:"jlCatTitle",children:"TENTACLES"}),Le.jsx("div",{className:"jlCatSub",children:"DRAW 4, PICK 2"})]})]}),!w&&Le.jsx("div",{style:{fontSize:"11px",color:"#d32f2f",fontWeight:600,marginTop:"4px"},children:"Requires seeker GPS"}),Le.jsx("div",{className:"jlGrid tentacles",children:W0.map((je,zt)=>{const an=!w||!k;return Le.jsxs("button",{className:`jlTile tentacles${an?" disabled":""}`,disabled:an,onClick:()=>wt({label:je.label,kind:je.kind,radiusMiles:je.radiusMiles}),style:{flexDirection:"column",gap:2,lineHeight:1},type:"button",title:w?k?"":"Requires area":"Requires seeker GPS",children:[Le.jsx("span",{children:je.label}),Le.jsx("span",{style:{fontSize:"10px",opacity:.8},children:je.distLabel})]},zt)})}),$t&&Le.jsxs("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap"},children:[Le.jsx("button",{type:"button",className:"tileBtn",onClick:async()=>{await W($t.kind,$t.radiusMiles,"YES"),wt(null)},disabled:!k||!w,children:"YES"}),Le.jsx("button",{type:"button",className:"tileBtn",onClick:async()=>{await W($t.kind,$t.radiusMiles,"NO"),wt(null)},disabled:!k||!w,children:"NO"}),Le.jsx("button",{type:"button",className:"tileBtn",onClick:()=>wt(null),children:"Clear"})]}),Le.jsx("div",{className:"section-label",style:{marginTop:"16px",fontSize:"10px",opacity:.7},children:"PLACES (OSM)"}),Le.jsx("div",{className:"jlGrid poi",children:Y0.map(({kind:je,label:zt})=>Le.jsx("button",{className:"jlTile poi",onClick:()=>Zt(je,zt),disabled:!k||!w,children:zt},je))})]})]})]}),q&&Le.jsx(H0,{kind:q,label:le,onClose:()=>{se(null),fe("")},onAnswer:Bt})]})}function J0(){const[k,w]=vi.useState(!1),[S,E]=vi.useState(""),T=Zn(L=>L.lastToast),N=Zn(L=>L.setLastToast);return vi.useEffect(()=>{const L=c=>{const W=c.target,ee=W.tagName==="INPUT"||W.tagName==="TEXTAREA"||W.tagName==="SELECT",Q=W.isContentEditable;if((c.metaKey||c.ctrlKey)&&c.key==="k"){c.preventDefault(),E(""),w(!0);return}ee||Q||c.key.length===1&&!c.ctrlKey&&!c.metaKey&&!c.altKey&&(E(c.key),w(!0),c.preventDefault())};return window.addEventListener("keydown",L),()=>{window.removeEventListener("keydown",L)}},[]),vi.useEffect(()=>{if(T){const L=setTimeout(()=>{N(null)},3e3);return()=>clearTimeout(L)}},[T,N]),Le.jsxs("div",{className:"app",children:[Le.jsxs("aside",{className:"sidebar",children:[T&&Le.jsx("div",{className:"toast-message",children:T}),Le.jsxs("div",{className:"sidebarInner",children:[Le.jsx(G0,{}),Le.jsx(K0,{}),Le.jsx($0,{})]})]}),Le.jsx("main",{className:"mapWrap",children:Le.jsx(q0,{})}),Le.jsx(Z0,{isOpen:k,onClose:()=>w(!1),initialQuery:S})]})}i_.createRoot(document.getElementById("root")).render(Le.jsx(Kg.StrictMode,{children:Le.jsx(J0,{})}));
